{"config":{"lang":["en","zh","ja"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"\u76ee\u5f55","text":""},{"location":"#_1","title":"\u300a\u5927\u6a21\u578b\u6570\u636e\u5de5\u7a0b\uff1a\u67b6\u6784\u3001\u7b97\u6cd5\u53ca\u9879\u76ee\u5b9e\u6218\u300b","text":""},{"location":"#_2","title":"\u5168\u4e66\u76ee\u5f55\u6982\u89c8","text":"<ul> <li>\u7b2c\u4e00\u90e8\u5206\uff1a\u57fa\u7840\u8bbe\u65bd\u4e0e\u6838\u5fc3\u7406\u5ff5 (\u6784\u5efa\u6570\u636e\u5e95\u5ea7)</li> <li>\u7b2c\u4e8c\u90e8\u5206\uff1a\u6d77\u91cf\u6587\u672c\u9884\u8bad\u7ec3\u5de5\u7a0b (\u6e05\u6d17\u3001\u53bb\u91cd\u3001\u8d28\u91cf\u63a7\u5236)</li> <li>\u7b2c\u4e09\u90e8\u5206\uff1a\u591a\u6a21\u6001\u6570\u636e\u5de5\u7a0b (\u56fe\u6587\u3001\u89c6\u9891\u4e0e\u97f3\u9891)</li> <li>\u7b2c\u56db\u90e8\u5206\uff1a\u5bf9\u9f50\u4e0e\u5408\u6210\u6570\u636e\u5de5\u7a0b (\u6307\u4ee4\u4e0e\u8d28\u91cf)</li> <li>\u7b2c\u4e94\u90e8\u5206\uff1a\u5e94\u7528\u7ea7\u6570\u636e\u5de5\u7a0b (RAG\u4e0eAgent)</li> <li>\u7b2c\u516d\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee\u96c6 (Capstone Projects) (\u7aef\u5230\u7aef\u4ee3\u7801\u5b9e\u73b0)</li> </ul>"},{"location":"#_3","title":"\u8be6\u7ec6\u5927\u7eb2\u5185\u5bb9","text":""},{"location":"#_4","title":"\u7b2c\u4e00\u90e8\u5206\uff1a\u57fa\u7840\u8bbe\u65bd\u4e0e\u6838\u5fc3\u7406\u5ff5","text":"<p>\u76ee\u6807\uff1a \u5efa\u7acb Data-Centric AI \u7684\u8ba4\u77e5\uff0c\u5b8c\u6210\u9ad8\u6027\u80fd\u6570\u636e\u5904\u7406\u73af\u5883\u7684\u642d\u5efa\u3002</p>"},{"location":"#1-data-ops-ai-ops","title":"\u7b2c1\u7ae0\uff1a\u5927\u6a21\u578b\u65f6\u4ee3\u7684\u6570\u636e\u53d8\u9769\uff08\u4ece Data Ops \u5230 AI Ops\uff09","text":"<ul> <li>1_1 Scaling Laws \u7684\u542f\u793a\uff1a \u6570\u636e\u8d28\u91cf &gt; \u6570\u91cf\uff0c\u4ece\u201c\u5927\u6570\u636e\u201d\u5230\u201c\u9ad8\u8d28\u91cf\u6570\u636e\u201d\u7684\u8303\u5f0f\u8f6c\u79fb\u3002</li> <li>1_2 LLM \u6570\u636e\u5168\u751f\u547d\u5468\u671f\uff1a \u9884\u8bad\u7ec3(Pre-train) \\(\\rightarrow\\) \u5fae\u8c03(SFT) \\(\\rightarrow\\) \u5f3a\u5316\u5b66\u4e60(RLHF) \\(\\rightarrow\\) \u68c0\u7d22\u589e\u5f3a(RAG)\u3002</li> <li>1_3 \u6311\u6218\u4e0e\u673a\u9047\uff1a \u5f02\u6784\u591a\u6a21\u6001\u3001\u7248\u6743\u5408\u89c4\u4e0e\u7b97\u529b\u6210\u672c\u7684\u535a\u5f08\u3002</li> </ul>"},{"location":"#2ai","title":"\u7b2c2\u7ae0\uff1aAI \u539f\u751f\u6570\u636e\u6808","text":"<ul> <li>2_1 AI \u539f\u751f\u6570\u636e\u6808 (AI-Native Data Stack)\uff1a</li> <li>\u5b58\u50a8\uff1a\u5bf9\u8c61\u5b58\u50a8 (S3/MinIO) vs \u6570\u636e\u6e56 (Iceberg/Hudi)\u3002</li> <li>\u8ba1\u7b97\uff1aSpark vs Ray Data vs Dask \u4e09\u5927\u5206\u5e03\u5f0f\u6846\u67b6\u5bf9\u6bd4\u3002</li> <li>\u5411\u91cf\u6570\u636e\u5e93\uff1aMilvus / Qdrant / Weaviate / Pinecone \u9009\u578b\u4e0e QPS vs Recall \u6743\u8861\u3002</li> <li>2_2 \u6570\u636e\u683c\u5f0f\u4e0eI/O\u4f18\u5316\uff1a</li> <li>Parquet vs JSONL vs WebDataset (\u591a\u6a21\u6001\u573a\u666f)\u3002</li> <li>\u538b\u7f29\u7b97\u6cd5\u4e0e\u8bfb\u53d6\u6027\u80fd\u4f18\u5316\uff0cGPU \u8bad\u7ec3 I/O \u74f6\u9888\u4f18\u5316\u7b56\u7565\u3002</li> <li>2_3 \u6570\u636e\u7248\u672c\u63a7\u5236 (DataOps)\uff1a \u4f7f\u7528 DVC\u3001LakeFS \u548c Pachyderm \u7ba1\u7406 PB \u7ea7\u6570\u636e\u96c6\u3002</li> </ul>"},{"location":"#_5","title":"\u7b2c\u4e8c\u90e8\u5206\uff1a\u6d77\u91cf\u6587\u672c\u9884\u8bad\u7ec3\u5de5\u7a0b","text":"<p>\u76ee\u6807\uff1a \u5904\u7406\u6d77\u91cf\u65e0\u7ed3\u6784\u6587\u672c\uff0c\u6784\u5efa\u6a21\u578b\u7684\u8bed\u8a00\u8ba4\u77e5\u57fa\u5ea7\u3002</p>"},{"location":"#3commoncrawl","title":"\u7b2c3\u7ae0\uff1a\u6570\u636e\u83b7\u53d6\uff08CommonCrawl \u89e3\u6790\u4e0e\u9ad8\u5e76\u53d1\u722c\u866b\uff09","text":"<ul> <li>3_1 \u5f00\u6e90\u6570\u636e\u96c6\u89e3\u6784\uff1a Common Crawl, C4, RefinedWeb, The Pile \u6df1\u5ea6\u5256\u6790\u3002</li> <li>3_2 \u9ad8\u6027\u80fd\u722c\u866b\u7cfb\u7edf\uff1a <code>Trafilatura</code> \u89e3\u6790\u5e93\u5e94\u7528\u4e0e\u5206\u5e03\u5f0f\u722c\u866b\u67b6\u6784\u8bbe\u8ba1\u3002</li> <li>3_3 \u7279\u79cd\u6570\u636e\u83b7\u53d6\uff1a \u4ee3\u7801 (GitHub)\u3001\u8bba\u6587 (ArXiv/S2ORC)\u3001\u4e66\u7c4d\u6570\u636e\u7684\u63d0\u53d6\u7b56\u7565\u3002</li> </ul>"},{"location":"#4-cleaning-quality-control","title":"\u7b2c4\u7ae0\uff1a\u6e05\u6d17\u4e0e\u8d28\u91cf\u63a7\u5236 (Cleaning &amp; Quality Control)","text":"<ul> <li>4_1 \u542f\u53d1\u5f0f\u8fc7\u6ee4\u89c4\u5219\uff1a \u8bed\u8a00\u8bc6\u522b (FastText)\u3001\u56f0\u60d1\u5ea6 (Perplexity) \u8fc7\u6ee4\u3001\u957f\u5ea6\u4e0e\u6807\u70b9\u5206\u5e03\u3002</li> <li>4_2 \u5927\u89c4\u6a21\u53bb\u91cd\uff08\u7cbe\u786e vs \u6a21\u7cca\uff09\uff1a</li> <li>\u7cbe\u786e\u53bb\u91cd\uff1a \u54c8\u5e0c\u65b9\u6cd5\u5feb\u901f\u79fb\u9664\u5b8c\u5168\u76f8\u540c\u6587\u6863\u3002</li> <li>\u6a21\u7cca\u53bb\u91cd (Fuzzy Deduplication)\uff1a MinHash LSH \u7b97\u6cd5\u539f\u7406\u4e0e\u5206\u5e03\u5f0f\u5b9e\u73b0\u3002</li> <li>\u6587\u6863\u5185\u53bb\u91cd\uff1a \u6d88\u9664\u91cd\u590d\u6bb5\u843d\u4e0e\u5bfc\u822a\u680f\u3002</li> <li>4_3 \u9690\u79c1\u6e05\u6d17 (PII Removal)\uff1a \u4f7f\u7528 Presidio \u8bc6\u522b\u5e76\u63a9\u76d6 Email\u3001IP\u3001\u7535\u8bdd\u3001\u5730\u5740\u3002</li> <li>4_4 \u57fa\u51c6\u6d4b\u8bd5\u96c6\u9632\u6c61\u67d3\uff1a \u786e\u4fdd\u8bad\u7ec3\u6570\u636e\u4e0d\u5305\u542b GSM8K\u3001MMLU \u7b49\u6d4b\u8bd5\u96c6\u539f\u9898\u3002</li> <li>4_5 \u57fa\u4e8e\u6a21\u578b\u7684\u8d28\u91cf\u8bc4\u5206\uff1a \u4f7f\u7528 fastText/BERT \u8fdb\u884c\"\u6559\u79d1\u4e66\u7ea7\u8d28\u91cf\"\u6253\u5206\uff08\u53c2\u8003 LLaMA 2\uff09\u3002</li> </ul>"},{"location":"#5-tokenization-dataloader","title":"\u7b2c5\u7ae0\uff1a\u5206\u8bcd\u3001\u5e8f\u5217\u5316\u4e0e\u9ad8\u6548\u52a0\u8f7d (Tokenization &amp; DataLoader)","text":"<ul> <li>5_1 \u5206\u8bcd\u5668\u539f\u7406\uff1a BPE, WordPiece, Unigram \u53ca Byte-Level BPE \u6df1\u5165\u89e3\u6790\u3002</li> <li>5_2 \u9ad8\u6548\u8bcd\u8868\u6784\u5efa\uff1a \u9886\u57df\u7279\u5b9a\u8bcd\u8868\u6269\u5145\u4e0e LLaMA \u4e2d\u6587\u8bcd\u8868\u6269\u5145\u5de5\u7a0b\u5b9e\u8df5\u3002</li> <li>5_3 \u6570\u636e\u6df7\u5408 (Data Mixing)\uff1a \u52a8\u6001\u91c7\u6837\u7b56\u7565\u4e0e Curriculum Learning (\u8bfe\u7a0b\u5b66\u4e60) \u6570\u636e\u6392\u5e03\u3002</li> </ul>"},{"location":"#multimodal-data-engineering","title":"\u7b2c\u4e09\u90e8\u5206\uff1a\u591a\u6a21\u6001\u6570\u636e\u5de5\u7a0b (Multimodal Data Engineering)","text":"<p>\u76ee\u6807\uff1a \u5904\u7406\u56fe\u50cf\u3001\u89c6\u9891\u4e0e\u97f3\u9891\uff0c\u652f\u6301 GPT-4V/Sora \u7c7b\u6a21\u578b\u7684\u8bad\u7ec3\u3002</p>"},{"location":"#6-image-text-pairs","title":"\u7b2c6\u7ae0\uff1a\u56fe\u6587\u5bf9\u6570\u636e\u5904\u7406 (Image-Text Pairs)","text":"<ul> <li>6_1 \u6570\u636e\u8303\u5f0f\uff1a \u56fe\u6587\u5bf9 (LAION-5B) vs \u4ea4\u9519\u6587\u6863 (OBELICS/MMC4)\u3002</li> <li>6_2 \u56fe\u50cf\u83b7\u53d6\u4e0e\u9884\u5904\u7406\uff1a</li> <li><code>img2dataset</code> \u9ad8\u5e76\u53d1\u4e0b\u8f7d\u5b9e\u6218\u3002</li> <li>GPU \u52a0\u901f\u89e3\u7801\u4e0e\u53d8\u6362 (NVIDIA DALI)\u3002</li> <li>6_3 \u591a\u6a21\u6001\u6e05\u6d17\u6d41\u6c34\u7ebf\uff1a</li> <li>\u7f8e\u5b66\u8bc4\u5206 (Aesthetics)\uff1a \u4f7f\u7528 CLIP-Score \u7b5b\u9009\u9ad8\u7f8e\u611f\u56fe\u7247\u3002</li> <li>\u56fe\u6587\u5bf9\u9f50\u8fc7\u6ee4\uff1a \u5254\u9664\u63cf\u8ff0\u4e0e\u56fe\u7247\u4e0d\u7b26\u7684\u6837\u672c\u3002</li> <li>\u5b89\u5168\u6027\u68c0\u6d4b\uff1a NSFW \u4e0e\u6c34\u5370\u8bc6\u522b\u3002</li> </ul>"},{"location":"#7-recaptioning","title":"\u7b2c7\u7ae0\uff1a\u6570\u636e\u91cd\u63cf\u8ff0 (Recaptioning)","text":"<ul> <li>7_1 Alt-text \u7684\u5c40\u9650\u6027\uff1a \u4e3a\u4ec0\u4e48\u539f\u59cb\u7f51\u9875\u63cf\u8ff0\u4e0d\u53ef\u7528\uff1f</li> <li>7_2 \u5408\u6210\u63cf\u8ff0\u5de5\u5382\uff1a</li> <li>\u5229\u7528 BLIP-2 / LLaVA / CogVLM \u91cd\u65b0\u751f\u6210\u8be6\u7ec6 Caption\u3002</li> <li>Prompt \u7b56\u7565\uff1a \u63a7\u5236\u751f\u6210\u63cf\u8ff0\u7684\u9897\u7c92\u5ea6\uff08\u7b80\u7565 vs \u8be6\u5c3d\uff09\u3002</li> <li>7_3 OCR \u589e\u5f3a\uff1a \u63d0\u53d6\u56fe\u4e2d\u6587\u5b57\u5e76\u878d\u5408\u8fdb\u6587\u672c\u63cf\u8ff0\uff08\u5bf9\u6587\u6863\u7406\u89e3\u81f3\u5173\u91cd\u8981\uff09\u3002</li> </ul>"},{"location":"#8","title":"\u7b2c8\u7ae0\uff1a\u89c6\u9891\u4e0e\u97f3\u9891\u6570\u636e","text":"<ul> <li>8_1 \u89c6\u9891\u5904\u7406\u6d41\u6c34\u7ebf\uff1a \u573a\u666f\u5207\u5206 (Scene Detection) \u4e0e\u5173\u952e\u5e27\u63d0\u53d6\u7b56\u7565\u3002</li> <li>8_2 \u89c6\u9891 Tokenization\uff1a \u89c6\u9891\u538b\u7f29\u4e0e\u79bb\u6563\u5316\u8868\u793a\u3002</li> <li>8_3 \u97f3\u9891\u5bf9\u9f50\uff1a \u4f7f\u7528 Whisper \u8fdb\u884c\u5927\u89c4\u6a21 ASR \u53ca Force Alignment (\u65f6\u95f4\u6233\u5bf9\u9f50)\u3002</li> </ul>"},{"location":"#alignment-synthetic-data","title":"\u7b2c\u56db\u90e8\u5206\uff1a\u5bf9\u9f50\u4e0e\u5408\u6210\u6570\u636e\u5de5\u7a0b (Alignment &amp; Synthetic Data)","text":"<p>\u76ee\u6807\uff1a \u8ba9\u6a21\u578b\u542c\u61c2\u6307\u4ee4\uff0c\u5e76\u7a81\u7834\u4eba\u7c7b\u6570\u636e\u7684\u74f6\u9888\u3002</p>"},{"location":"#9-sft-data","title":"\u7b2c9\u7ae0\uff1a\u6307\u4ee4\u5fae\u8c03\u6570\u636e (SFT Data)","text":"<ul> <li>9_1 Prompt Engineering \u4e3a\u6570\u636e\u751f\u4ea7\u670d\u52a1\uff1a \u7f16\u5199\u9ad8\u9c81\u68d2\u6027\u7684 System Prompt\u3002</li> <li>9_2 \u81ea\u52a8\u5316\u6784\u9020\u65b9\u6cd5\uff1a</li> <li>Self-Instruct\uff1a \u5229\u7528\u5f3a\u6a21\u578b\u751f\u6210\u6307\u4ee4\u3002</li> <li>Evol-Instruct\uff1a \u6307\u4ee4\u590d\u6742\u5ea6\u7684\u8fdb\u5316\u7b56\u7565\u3002</li> <li>9_3 \u601d\u7ef4\u94fe (CoT) \u6570\u636e\uff1a \u6784\u9020 Step-by-Step \u7684\u63a8\u7406\u6837\u672c\u3002</li> </ul>"},{"location":"#10-synthetic-data","title":"\u7b2c10\u7ae0\uff1a\u5408\u6210\u6570\u636e (Synthetic Data)","text":"<ul> <li>10_1 \u6559\u79d1\u4e66\u7ea7\u6570\u636e (Textbooks Are All You Need)\uff1a \u5408\u6210\u9ad8\u8d28\u91cf\u9886\u57df\u77e5\u8bc6\u3002</li> <li>10_2 \u4ee3\u7801\u4e0e\u6570\u5b66\u5408\u6210\uff1a</li> <li>PoT (Program of Thought)\uff1a \u751f\u6210\u4ee3\u7801\u5e76\u6267\u884c\uff0c\u4ee5\u6267\u884c\u7ed3\u679c\u9a8c\u8bc1\u6570\u636e\u6b63\u786e\u6027\u3002</li> <li>10_3 \u591a\u6a21\u6001\u6307\u4ee4\u5408\u6210\uff1a \u5229\u7528 GPT-4o \u6784\u9020\u57fa\u4e8e\u56fe\u50cf\u7684\u590d\u6742\u63a8\u7406\u95ee\u7b54\u3002</li> </ul>"},{"location":"#11-rlhfdpo","title":"\u7b2c11\u7ae0\uff1a\u4eba\u7c7b\u504f\u597d\u6570\u636e (RLHF/DPO)","text":"<ul> <li>11_1 \u504f\u597d\u6570\u636e\u683c\u5f0f\uff1a Chosen vs Rejected \u6837\u672c\u5bf9\u6784\u5efa\u3002</li> <li>11_2 \u6807\u6ce8\u5e73\u53f0\u4e0e\u8d28\u68c0\uff1a \u4f17\u5305\u7ba1\u7406\u4e0e IAA (\u6807\u6ce8\u4e00\u81f4\u6027) \u5206\u6790\u3002</li> <li>11_3 RLAIF (AI Feedback)\uff1a \u4f7f\u7528 LLM \u4ee3\u66ff\u4eba\u7c7b\u8fdb\u884c\u504f\u597d\u6253\u5206\u3002</li> </ul>"},{"location":"#rag-agent","title":"\u7b2c\u4e94\u90e8\u5206\uff1a\u5e94\u7528\u7ea7\u6570\u636e\u5de5\u7a0b (RAG &amp; Agent)","text":"<p>\u76ee\u6807\uff1a \u9762\u5411\u4f01\u4e1a\u843d\u5730\uff0c\u89e3\u51b3\u5916\u90e8\u77e5\u8bc6\u5e93\u7684\u89e3\u6790\u4e0e\u68c0\u7d22\u3002</p>"},{"location":"#12rag","title":"\u7b2c12\u7ae0\uff1aRAG \u6570\u636e\u6d41\u6c34\u7ebf","text":"<ul> <li>12_1 \u6587\u6863\u6df1\u5ea6\u89e3\u6790\uff1a</li> <li>\u590d\u6742 PDF \u5904\u7406\uff1a\u8868\u683c\u8fd8\u539f\u3001\u591a\u680f\u8bc6\u522b (<code>Unstructured</code>, <code>LlamaParse</code>).</li> <li>12_2 \u5207\u7247\u7b56\u7565 (Chunking)\uff1a \u8bed\u4e49\u5207\u7247\u3001\u9012\u5f52\u5207\u7247\u4e0e\u7236\u5b50\u7d22\u5f15 (Parent-Child Indexing)\u3002</li> <li>12_3 \u5411\u91cf\u5316\u4e0e\u5b58\u50a8\uff1a Embedding \u6a21\u578b\u5fae\u8c03\u4e0e\u5411\u91cf\u6570\u636e\u5e93\u4f18\u5316\u3002</li> </ul>"},{"location":"#13-rag","title":"\u7b2c13\u7ae0\uff1a\u591a\u6a21\u6001 RAG","text":"<ul> <li>13_1 \u8de8\u6a21\u6001\u68c0\u7d22\uff1a \u4f7f\u7528 CLIP/SigLIP \u5b9e\u73b0\u201c\u4ee5\u6587\u641c\u56fe\u201d\u4e0e\u201c\u4ee5\u56fe\u641c\u6587\u201d\u3002</li> <li>13_2 ColPali \u67b6\u6784\u5b9e\u6218\uff1a \u57fa\u4e8e\u89c6\u89c9\u8bed\u8a00\u6a21\u578b\u7684\u6587\u6863\u68c0\u7d22\uff08\u8df3\u8fc7 OCR\uff0c\u76f4\u63a5\u7406\u89e3\u6587\u6863\u56fe\u50cf\uff09\u3002</li> </ul>"},{"location":"#capstone-projects","title":"\u7b2c\u516d\u90e8\u5206\uff1a\u5b9e\u6218\u9879\u76ee\u96c6 (Capstone Projects)","text":"<p>\u76ee\u6807\uff1a \u901a\u8fc7 5 \u4e2a\u7aef\u5230\u7aef\u9879\u76ee\uff0c\u4e32\u8054\u5168\u4e66\u6280\u672f\u70b9\uff0c\u63d0\u4f9b\u53ef\u8fd0\u884c\u7684\u4ee3\u7801\u5e93\u3002</p>"},{"location":"#mini-c4","title":"\u9879\u76ee\u4e00\uff1a\u6784\u5efa\u201cMini-C4\u201d\u9884\u8bad\u7ec3\u96c6","text":"<ul> <li>\u573a\u666f\uff1a \u4ece Common Crawl \u539f\u59cb\u6570\u636e (WARC) \u5230\u9ad8\u8d28\u91cf Parquet \u6570\u636e\u3002</li> <li>\u6838\u5fc3\u6280\u672f\uff1a Trafilatura \u89e3\u6790\u3001Spark/Ray \u5206\u5e03\u5f0f MinHash \u53bb\u91cd\u3001KenLM \u8d28\u91cf\u8fc7\u6ee4\u3002</li> <li>\u8f93\u51fa\uff1a \u6e05\u6d17\u540e\u7684\u7eaf\u6587\u672c\u8bed\u6599\u5e93\u4e0e\u5904\u7406 Pipeline\u3002</li> </ul>"},{"location":"#sft","title":"\u9879\u76ee\u4e8c\uff1a\u5782\u76f4\u9886\u57df\u4e13\u5bb6 SFT (\u6cd5\u5f8b/\u533b\u7597)","text":"<ul> <li>\u573a\u666f\uff1a \u57fa\u4e8e\u975e\u7ed3\u6784\u5316 PDF \u6587\u6863\u6784\u5efa\u884c\u4e1a\u4e13\u5bb6\u5fae\u8c03\u6570\u636e\u3002</li> <li>\u6838\u5fc3\u6280\u672f\uff1a Self-Instruct \u6784\u9020\u6307\u4ee4\u3001CoT \u63a8\u7406\u589e\u5f3a\u3001\u6570\u636e\u591a\u6837\u6027\u5e73\u8861\u3002</li> <li>\u8f93\u51fa\uff1a <code>domain_expert.jsonl</code> \u6307\u4ee4\u5fae\u8c03\u96c6\u3002</li> </ul>"},{"location":"#llava","title":"\u9879\u76ee\u4e09\uff1a\u6784\u5efa LLaVA \u591a\u6a21\u6001\u6307\u4ee4\u96c6","text":"<ul> <li>\u573a\u666f\uff1a \u8bad\u7ec3\u4e00\u4e2a\u80fd\u770b\u61c2\u56fe\u7247\u7684\u591a\u6a21\u6001\u6a21\u578b\u3002</li> <li>\u6838\u5fc3\u6280\u672f\uff1a \u4f7f\u7528 GPT-4o API \u751f\u6210\u591a\u8f6e\u56fe\u6587\u5bf9\u8bdd\u3001Bounding Box \u6570\u636e\u5bf9\u9f50\u3001\u591a\u56fe\u4ea4\u9519\u683c\u5f0f\u5904\u7406\u3002</li> <li>\u8f93\u51fa\uff1a \u5305\u542b\u89c6\u89c9\u6307\u4ee4\u7684\u56fe\u6587\u6570\u636e\u96c6\u3002</li> </ul>"},{"location":"#_6","title":"\u9879\u76ee\u56db\uff1a\u5408\u6210\u6570\u5b66/\u4ee3\u7801\u6559\u79d1\u4e66","text":"<ul> <li>\u573a\u666f\uff1a \u63d0\u5347\u5c0f\u6a21\u578b\u7684\u903b\u8f91\u63a8\u7406\u80fd\u529b\u3002</li> <li>\u6838\u5fc3\u6280\u672f\uff1a Evol-Instruct \u8fdb\u5316\u7b56\u7565\u3001Python \u4ee3\u7801\u6267\u884c\u6c99\u7bb1 (Sandbox) \u9a8c\u8bc1\u3001PoT \u6570\u636e\u683c\u5f0f\u5316\u3002</li> <li>\u8f93\u51fa\uff1a \u7ecf\u8fc7\u9a8c\u8bc1\u7684\u9ad8\u8d28\u91cf\u5408\u6210\u63a8\u7406\u6570\u636e\u96c6\u3002</li> </ul>"},{"location":"#rag","title":"\u9879\u76ee\u4e94\uff1a\u591a\u6a21\u6001 RAG \u4f01\u4e1a\u8d22\u62a5\u52a9\u624b","text":"<ul> <li>\u573a\u666f\uff1a \u68c0\u7d22\u5e76\u56de\u7b54\u5305\u542b\u590d\u6742\u56fe\u8868\u7684\u5e74\u5ea6\u8d22\u62a5\u95ee\u9898\u3002</li> <li>\u6838\u5fc3\u6280\u672f\uff1a PDF \u8868\u683c\u4e0e\u56fe\u8868\u89e3\u6790\u3001\u591a\u8def\u53ec\u56de (\u6df7\u5408\u68c0\u7d22)\u3001ColPali \u89c6\u89c9\u68c0\u7d22\u5e94\u7528\u3002</li> <li>\u8f93\u51fa\uff1a \u4e00\u4e2a\u652f\u6301\u56fe\u8868\u95ee\u7b54\u7684 RAG \u77e5\u8bc6\u5e93\u7cfb\u7edf\u3002</li> </ul>"},{"location":"#_7","title":"\u9644\u5f55","text":"<ul> <li>\u9644\u5f55 A\uff1a \u5e38\u7528\u5de5\u5177\u901f\u67e5 (Hugging Face Datasets, LangChain, Ray Data)\u3002</li> <li>\u9644\u5f55 B\uff1a \u6570\u636e\u5408\u89c4\u81ea\u67e5\u6e05\u5355 (\u7248\u6743\u3001GDPR\u3001\u673a\u5668\u4eba\u534f\u8bae)\u3002</li> <li>\u9644\u5f55 C\uff1a \u7b97\u529b\u6210\u672c\u4f30\u7b97\u8868 (\u4e0d\u540c\u89c4\u6a21\u6570\u636e\u6e05\u6d17\u7684 GPU/CPU \u6d88\u8017\u53c2\u8003)\u3002</li> </ul>"},{"location":"part1/1_1_data_change/","title":"\u7b2c1\u7ae0\uff1a\u5927\u6a21\u578b\u65f6\u4ee3\u7684\u6570\u636e\u53d8\u9769","text":""},{"location":"part1/1_1_data_change/#1-data-ops-ai-ops","title":"\u7b2c1\u7ae0\uff1a\u5927\u6a21\u578b\u65f6\u4ee3\u7684\u6570\u636e\u53d8\u9769\uff08\u4ece Data Ops \u5230 AI Ops\uff09","text":""},{"location":"part1/1_1_data_change/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u5927\u6a21\u578b\uff08Large Language Models, LLMs\uff09\u7684\u5d1b\u8d77\u6539\u53d8\u4e86\u4eba\u5de5\u667a\u80fd\u7684\u8303\u5f0f\u3002\u7136\u800c\uff0c\u6a21\u578b\u67b6\u6784\u7684\u521b\u65b0\u5df2\u8d8b\u4e8e\u6536\u655b\uff0c\u771f\u6b63\u51b3\u5b9a\u6a21\u578b\u80fd\u529b\u4e0a\u9650\u7684\u662f\u6570\u636e\u8d28\u91cf\u3002\u672c\u7ae0\u5c06\u4ece Scaling Laws \u51fa\u53d1\uff0c\u5efa\u7acb\"\u6570\u636e\u5373\u6838\u5fc3\u8d44\u4ea7\"\u7684\u8ba4\u77e5\uff0c\u7cfb\u7edf\u6027\u5730\u4ecb\u7ecd LLM \u6570\u636e\u5168\u751f\u547d\u5468\u671f\uff0c\u5e76\u6df1\u5165\u63a2\u8ba8\u5f02\u6784\u591a\u6a21\u6001\u3001\u7248\u6743\u5408\u89c4\u4e0e\u7b97\u529b\u6210\u672c\u7b49\u73b0\u5b9e\u6311\u6218\u3002</p>"},{"location":"part1/1_1_data_change/#_2","title":"\u573a\u666f\u5f15\u5165","text":"<p>\u4f60\u662f\u4e00\u5bb6 AI \u521b\u4e1a\u516c\u53f8\u7684\u6570\u636e\u8d1f\u8d23\u4eba\u3002\u56e2\u961f\u521a\u521a\u82b1\u8d39\u4e09\u4e2a\u6708\u65f6\u95f4\uff0c\u4ece\u516c\u7f51\u722c\u53d6\u4e86 50TB \u7684\u4e2d\u6587\u8bed\u6599\uff0c\u4fe1\u5fc3\u6ee1\u6ee1\u5730\u5f00\u59cb\u9884\u8bad\u7ec3\u4e00\u4e2a 7B \u53c2\u6570\u7684\u57fa\u5ea7\u6a21\u578b\u3002</p> <p>\u7136\u800c\uff0c\u8bad\u7ec3\u4e24\u5468\u540e\uff0cLoss \u66f2\u7ebf\u5728\u67d0\u4e2a\u70b9\u7a81\u7136\"\u8eba\u5e73\"\uff0c\u6a21\u578b\u8f93\u51fa\u5145\u65a5\u7740\u5e7f\u544a\u6587\u6848\u3001\u91cd\u590d\u7684 SEO \u5783\u573e\uff0c\u751a\u81f3\u8fd8\u80fd\u80cc\u8bf5\u51fa\u67d0\u4e9b\u7f51\u7ad9\u7684\u7528\u6237\u534f\u8bae\u3002\u590d\u76d8\u4f1a\u8bae\u4e0a\uff0c\u8d44\u6df1\u5de5\u7a0b\u5e08\u629b\u51fa\u4e86\u4e00\u4e2a\u5c16\u9510\u7684\u95ee\u9898\uff1a\"\u6211\u4eec\u82b1\u4e86 100 \u4e07\u7b97\u529b\u8d39\u8bad\u7ec3\u7684\uff0c\u5230\u5e95\u662f\u4e00\u4e2a\u8bed\u8a00\u6a21\u578b\uff0c\u8fd8\u662f\u4e00\u4e2a\u4e92\u8054\u7f51\u5783\u573e\u7684\u538b\u7f29\u7d22\u5f15\uff1f\"</p> <p>\u8fd9\u4e2a\u573a\u666f\u5e76\u975e\u675c\u64b0\u3002OpenAI\u3001Google\u3001Meta \u7b49\u9876\u7ea7\u5b9e\u9a8c\u5ba4\u65e9\u5df2\u8fbe\u6210\u5171\u8bc6\uff1a\u5728\u6a21\u578b\u67b6\u6784\u8d8b\u540c\u7684\u4eca\u5929\uff0c\u6570\u636e\u8d28\u91cf\u662f\u51b3\u5b9a\u6a21\u578b\u667a\u80fd\u4e0a\u9650\u7684\u6838\u5fc3\u53d8\u91cf\u3002</p>"},{"location":"part1/1_1_data_change/#11-scaling-laws","title":"1.1 Scaling Laws \u7684\u542f\u793a\uff1a\u4ece\"\u5927\u6570\u636e\"\u5230\"\u9ad8\u8d28\u91cf\u6570\u636e\"\u7684\u8303\u5f0f\u8f6c\u79fb","text":""},{"location":"part1/1_1_data_change/#111-scaling-laws","title":"1.1.1 \u4ec0\u4e48\u662f Scaling Laws\uff1f","text":"<p>2020 \u5e74\uff0cOpenAI \u53d1\u8868\u4e86\u91cc\u7a0b\u7891\u5f0f\u7684\u8bba\u6587\u300aScaling Laws for Neural Language Models\u300b\uff0c\u63ed\u793a\u4e86\u4e00\u4e2a\u7b80\u6d01\u800c\u6df1\u523b\u7684\u89c4\u5f8b\uff1a\u6a21\u578b\u6027\u80fd\uff08\u4ee5 Loss \u8861\u91cf\uff09\u4e0e\u4e09\u4e2a\u6838\u5fc3\u56e0\u7d20\u5448\u5e42\u5f8b\u5173\u7cfb\uff08Power Law\uff09\u2014\u2014\u6a21\u578b\u53c2\u6570\u91cf \\(N\\)\u3001\u6570\u636e\u96c6\u5927\u5c0f \\(D\\)\u3001\u4ee5\u53ca\u8ba1\u7b97\u91cf \\(C\\)\u3002</p> \\[ L(N, D, C) \\approx \\left(\\frac{N_c}{N}\\right)^{\\alpha_N} + \\left(\\frac{D_c}{D}\\right)^{\\alpha_D} + \\left(\\frac{C_c}{C}\\right)^{\\alpha_C} \\] <p>\u5176\u4e2d \\(L\\) \u4e3a\u6a21\u578b\u7684\u4ea4\u53c9\u71b5\u635f\u5931\uff0c\\(N_c, D_c, C_c\\) \u4e3a\u5e38\u6570\uff0c\\(\\alpha\\) \u4e3a\u5e42\u5f8b\u6307\u6570\u3002\u901a\u4fd7\u5730\u7406\u89e3\uff0c\u60f3\u8ba9\u6a21\u578b\u66f4\u806a\u660e\uff0c\u8981\u4e48\u589e\u5927\u6a21\u578b\u89c4\u6a21\u3001\u8981\u4e48\u589e\u52a0\u6570\u636e\u91cf\u3001\u8981\u4e48\u6295\u5165\u66f4\u591a\u7b97\u529b\u3002\u8fd9\u4e09\u8005\u76f8\u4e92\u5236\u7ea6\uff0c\u5f62\u6210\u4e86\u5927\u6a21\u578b\u65f6\u4ee3\u7684\"\u4e0d\u53ef\u80fd\u4e09\u89d2\"\u3002</p> <p>\u8fd9\u4e00\u53d1\u73b0\u5728\u5b66\u672f\u754c\u548c\u5de5\u4e1a\u754c\u5f15\u53d1\u4e86\u5de8\u5927\u7684\u9707\u52a8\u3002\u5728\u6b64\u4e4b\u524d\uff0c\u6df1\u5ea6\u5b66\u4e60\u7684\u53d1\u5c55\u66f4\u50cf\u662f\u4e00\u95e8\"\u70bc\u91d1\u672f\"\u2014\u2014\u7814\u7a76\u8005\u4eec\u51ed\u501f\u76f4\u89c9\u548c\u7ecf\u9a8c\u8c03\u6574\u6a21\u578b\u7ed3\u6784\uff0c\u671f\u671b\u5076\u7136\u53d1\u73b0\u6027\u80fd\u7a81\u7834\u3002Scaling Laws \u7684\u51fa\u73b0\uff0c\u7b2c\u4e00\u6b21\u5c06\u5927\u6a21\u578b\u8bad\u7ec3\u4ece\u827a\u672f\u63a8\u5411\u4e86\u5de5\u7a0b\u79d1\u5b66\uff0c\u4f7f\u5f97\u4f01\u4e1a\u53ef\u4ee5\u57fa\u4e8e\u7cbe\u786e\u7684\u6570\u5b66\u6a21\u578b\u6765\u89c4\u5212\u8d44\u6e90\u6295\u5165\u548c\u9884\u671f\u4ea7\u51fa\u3002</p>"},{"location":"part1/1_1_data_change/#112","title":"1.1.2 \u6570\u636e\u8d28\u91cf\u7684\"\u9690\u85cf\u53d8\u91cf\"","text":"<p>\u7136\u800c\uff0c\u539f\u59cb Scaling Laws \u5b58\u5728\u4e00\u4e2a\u81f4\u547d\u76f2\u70b9\uff1a\u5b83\u5047\u8bbe\u6240\u6709\u6570\u636e\u7684\"\u8d28\u91cf\"\u662f\u5747\u5300\u7684\u3002\u8fd9\u4e2a\u5047\u8bbe\u5728\u73b0\u5b9e\u4e2d\u663e\u7136\u4e0d\u6210\u7acb\u3002\u4e92\u8054\u7f51\u4e0a\u7684\u6587\u672c\u8d28\u91cf\u53c2\u5dee\u4e0d\u9f50\uff0c\u4ece\u7cbe\u5fc3\u64b0\u5199\u7684\u5b66\u672f\u8bba\u6587\u5230\u5145\u65a5\u7740\u9519\u522b\u5b57\u7684\u5783\u573e\u8bc4\u8bba\uff0c\u6570\u636e\u4e4b\u95f4\u7684\u4ef7\u503c\u5dee\u5f02\u53ef\u80fd\u9ad8\u8fbe\u6570\u4e2a\u6570\u91cf\u7ea7\u3002</p> <p>2022 \u5e74\uff0cDeepMind \u7684 Chinchilla \u8bba\u6587\u6253\u7834\u4e86\u8fd9\u4e00\u5047\u8bbe\u3002\u7814\u7a76\u56e2\u961f\u8fdb\u884c\u4e86\u4e00\u9879\u5927\u89c4\u6a21\u5b9e\u9a8c\uff1a\u5728\u76f8\u540c\u7684\u8ba1\u7b97\u9884\u7b97\u4e0b\uff0c\u6bd4\u8f83\u4e0d\u540c\u6a21\u578b\u89c4\u6a21\u4e0e\u6570\u636e\u91cf\u914d\u6bd4\u7684\u6548\u679c\u3002\u7ed3\u679c\u4ee4\u4e1a\u754c\u5927\u5403\u4e00\u60ca\u2014\u2014\u4e00\u4e2a\u53c2\u6570\u91cf\u4ec5\u4e3a Gopher \u6a21\u578b\u56db\u5206\u4e4b\u4e00\u7684 Chinchilla\uff0870B \u53c2\u6570\uff09\uff0c\u901a\u8fc7\u4f7f\u7528\u56db\u500d\u7684\u9ad8\u8d28\u91cf\u8bad\u7ec3\u6570\u636e\uff081.4T tokens\uff09\uff0c\u5728\u51e0\u4e4e\u6240\u6709\u8bc4\u6d4b\u4efb\u52a1\u4e0a\u90fd\u8d85\u8d8a\u4e86 280B \u53c2\u6570\u7684 Gopher\u3002</p> \u6a21\u578b \u53c2\u6570\u91cf \u8bad\u7ec3 Token \u6570 \u6700\u7ec8\u6027\u80fd Gopher 280B 300B tokens \u57fa\u51c6 Chinchilla 70B 1.4T tokens \u8d85\u8d8a Gopher <p>\u8fd9\u9879\u7814\u7a76\u63ed\u793a\u4e86\u4e00\u4e2a\u88ab\u957f\u671f\u5ffd\u89c6\u7684\u4e8b\u5b9e\uff1a\u8fc7\u53bb\u4e1a\u754c\u4e25\u91cd\"\u8fc7\u62df\u5408\"\u4e8e\u6a21\u578b\u89c4\u6a21\uff0c\u800c\u4f4e\u4f30\u4e86\u6570\u636e\u91cf\u7684\u91cd\u8981\u6027\u3002Chinchilla \u8bba\u6587\u7ed9\u51fa\u7684\"\u6700\u4f18\u914d\u6bd4\"\u5efa\u8bae\u662f\uff1a\u6bcf\u589e\u52a0 1 \u4e2a\u53c2\u6570\uff0c\u5e94\u914d\u5957\u7ea6 20 \u4e2a Token \u7684\u8bad\u7ec3\u6570\u636e\u3002\u8fd9\u610f\u5473\u7740\u8bad\u7ec3\u4e00\u4e2a 7B \u6a21\u578b\uff0c\u7406\u8bba\u4e0a\u9700\u8981\u7ea6 140B Token \u7684\u9ad8\u8d28\u91cf\u8bed\u6599\u2014\u2014\u8fd9\u4e2a\u6570\u5b57\u8fdc\u8fdc\u8d85\u51fa\u4e86\u8bb8\u591a\u56e2\u961f\u6700\u521d\u7684\u9884\u671f\u3002</p>"},{"location":"part1/1_1_data_change/#113-vs-phi","title":"1.1.3 \u8d28\u91cf vs \u6570\u91cf\uff1aPhi \u7cfb\u5217\u7684\u6781\u7aef\u5b9e\u9a8c","text":"<p>\u5982\u679c\u8bf4 Chinchilla \u8bc1\u660e\u4e86\"\u6570\u636e\u91cf\u88ab\u4f4e\u4f30\"\uff0c\u90a3\u4e48\u5fae\u8f6f\u7684 Phi \u7cfb\u5217\u6a21\u578b\u5219\u8bc1\u660e\u4e86\u4e00\u4e2a\u66f4\u52a0\u6fc0\u8fdb\u7684\u89c2\u70b9\uff1a\u6570\u636e\u8d28\u91cf\u53ef\u4ee5\u98a0\u8986\u89c4\u6a21\u5b9a\u5f8b\u3002</p> <p>2023 \u5e74\uff0c\u5fae\u8f6f\u7814\u7a76\u9662\u53d1\u5e03\u4e86 Phi-1 \u6a21\u578b\u3002\u8fd9\u662f\u4e00\u4e2a\u4ec5\u6709 1.3B \u53c2\u6570\u7684\"\u5c0f\"\u6a21\u578b\uff0c\u8bad\u7ec3\u6570\u636e\u4ec5\u4f7f\u7528\u4e86 7B Token\u2014\u2014\u4e0e\u5f53\u65f6\u52a8\u8f84\u6570\u767e B \u751a\u81f3 T \u7ea7\u522b\u7684\u4e3b\u6d41\u505a\u6cd5\u5f62\u6210\u9c9c\u660e\u5bf9\u6bd4\u3002\u7136\u800c\uff0c\u8fd9\u4e2a\u770b\u4f3c\"\u8425\u517b\u4e0d\u826f\"\u7684\u6a21\u578b\uff0c\u5728\u4ee3\u7801\u751f\u6210\u4efb\u52a1\u4e0a\u5374\u8d85\u8d8a\u4e86\u53c2\u6570\u91cf\u662f\u5176\u5341\u500d\u7684\u7ade\u4e89\u5bf9\u624b\u3002</p> <p>Phi-1 \u7684\u79d8\u5bc6\u6b66\u5668\u4e0d\u662f\u6d77\u91cf\u722c\u866b\u6570\u636e\uff0c\u800c\u662f\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u3001\u5177\u6709\u6559\u5b66\u610f\u4e49\u7684\u5408\u6210\u6570\u636e\u3002\u7814\u7a76\u8005\u4f7f\u7528 GPT-4 \u751f\u6210\u4e86\u5927\u91cf\u7ed3\u6784\u6e05\u6670\u3001\u5faa\u5e8f\u6e10\u8fdb\u7684\u7f16\u7a0b\u6559\u7a0b\uff0c\u4ece\u57fa\u7840\u8bed\u6cd5\u5230\u9ad8\u7ea7\u7b97\u6cd5\uff0c\u5f62\u6210\u4e86\u4e00\u5957\u5b8c\u6574\u7684\"\u4eba\u9020\u6559\u79d1\u4e66\"\u3002\u8fd9\u4e9b\u5408\u6210\u6570\u636e\u5177\u6709\u771f\u5b9e\u7f51\u7edc\u6570\u636e\u96be\u4ee5\u6bd4\u62df\u7684\u4f18\u52bf\uff1a\u6ca1\u6709\u566a\u58f0\u3001\u6ca1\u6709\u9519\u8bef\u3001\u903b\u8f91\u6e05\u6670\u3001\u96be\u5ea6\u9012\u8fdb\u3002\u7528\u8fd9\u4e9b\"\u4eba\u9020\u6559\u79d1\u4e66\"\u8bad\u7ec3\u7684\u5c0f\u6a21\u578b\uff0c\u5728\u89e3\u51b3\u5b9e\u9645\u7f16\u7a0b\u95ee\u9898\u65f6\u8868\u73b0\u51fa\u4e86\u60ca\u4eba\u7684\u80fd\u529b\u3002</p> <p></p> <p>\u56fe1-1\uff1a\u6570\u636e\u8d28\u91cf\u4e0e\u6a21\u578b\u6027\u80fd\u5173\u7cfb \u2014\u2014 \u4f4e\u8d28\u91cf\u6570\u636e\uff08\u566a\u58f040%\uff09\u7ecf\u8fc7\u6e05\u6d17\u540e\u8f6c\u5316\u4e3a\u9ad8\u8d28\u91cf\u6570\u636e\uff08\u566a\u58f05%\uff09</p> <p>Phi \u7cfb\u5217\u7684\u6210\u529f\u5f15\u53d1\u4e86\u4e1a\u754c\u5bf9\"\u5408\u6210\u6570\u636e\"\u7684\u70ed\u70c8\u8ba8\u8bba\u3002\u5982\u679c\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u5408\u6210\u6570\u636e\u53ef\u4ee5\u4ea7\u751f\u5982\u6b64\u4f18\u5f02\u7684\u6548\u679c\uff0c\u90a3\u4e48\u4f20\u7edf\u7684\"\u722c\u866b-\u6e05\u6d17-\u8bad\u7ec3\"\u8303\u5f0f\u662f\u5426\u9700\u8981\u88ab\u98a0\u8986\uff1f\u6211\u4eec\u5c06\u5728\u7b2c\u4e03\u7ae0\u8be6\u7ec6\u63a2\u8ba8\u5408\u6210\u6570\u636e\u7684\u65b9\u6cd5\u8bba\u548c\u6700\u4f73\u5b9e\u8df5\u3002</p>"},{"location":"part1/1_1_data_change/#114","title":"1.1.4 \u6570\u636e\u5de5\u7a0b\u5e08\u7684\u6838\u5fc3\u4f7f\u547d","text":"<p>\u7efc\u5408\u4ee5\u4e0a\u7814\u7a76\uff0c\u6211\u4eec\u53ef\u4ee5\u63d0\u70bc\u51fa\u5927\u6a21\u578b\u65f6\u4ee3\u6570\u636e\u5de5\u7a0b\u5e08\u7684\u6838\u5fc3\u4f7f\u547d\u3002\u4f20\u7edf\u89c2\u5ff5\u8ba4\u4e3a\"\u6570\u636e\u8d8a\u591a\u8d8a\u597d\"\uff0c\u65b0\u8303\u5f0f\u5219\u5f3a\u8c03\u6570\u636e\u8d28\u91cf\u51b3\u5b9a\u6027\u80fd\u4e0a\u9650\uff0c\u566a\u58f0\u6570\u636e\u4e0d\u4ec5\u65e0\u76ca\u53cd\u800c\u53ef\u80fd\u6709\u5bb3\u3002\u8fc7\u53bb\u4eba\u4eec\u76f8\u4fe1\"\u6a21\u578b\u67b6\u6784\u662f\u6838\u5fc3\u7ade\u4e89\u529b\"\uff0c\u800c\u4eca\u5929\u67b6\u6784\u5df2\u8d8b\u4e8e\u8d8b\u540c\uff0c\u6570\u636e\u6210\u4e3a\u5dee\u5f02\u5316\u7684\u5173\u952e\u3002\u66fe\u7ecf\"\u6e05\u6d17\u662f\u9884\u5904\u7406\u7684\u5c0f\u73af\u8282\"\u7684\u770b\u6cd5\u5df2\u7ecf\u8fc7\u65f6\uff0c\u73b0\u5728\u6570\u636e\u6e05\u6d17\u88ab\u89c6\u4e3a\u6a21\u578b\u8bad\u7ec3\u6210\u529f\u7684\u57fa\u77f3\u3002\u540c\u6837\uff0c\"\u4eba\u5de5\u6807\u6ce8\u4e0d\u53ef\u66ff\u4ee3\"\u7684\u4f20\u7edf\u8ba4\u77e5\u4e5f\u88ab\u6253\u7834\uff0c\u9ad8\u8d28\u91cf\u5408\u6210\u6570\u636e\u5728\u67d0\u4e9b\u573a\u666f\u4e0b\u53ef\u4ee5\u8d85\u8d8a\u771f\u5b9e\u6570\u636e\u3002</p> <p>\u9700\u8981\u7279\u522b\u5f3a\u8c03\u7684\u662f\uff0c\u4e0d\u5e94\u5c06\"\u8d28\u91cf\u5927\u4e8e\u6570\u91cf\"\u8bef\u8bfb\u4e3a\"\u53ea\u8981\u8d28\u91cf\u4e0d\u8981\u6570\u91cf\"\u3002Scaling Laws \u4f9d\u7136\u6709\u6548\uff0c\u53ea\u662f\u5728\u540c\u7b49\u7b97\u529b\u9884\u7b97\u4e0b\uff0c\u5e94\u4f18\u5148\u6295\u8d44\u4e8e\u6570\u636e\u8d28\u91cf\u3002\u4e00\u4e2a\u6781\u7aef\u7684\u4f8b\u5b50\uff1a\u7528 100 \u6761\u5b8c\u7f8e\u6570\u636e\u8bad\u7ec3\u7684\u6a21\u578b\uff0c\u6c38\u8fdc\u4e0d\u53ef\u80fd\u8d85\u8d8a\u7528 1T \u9ad8\u8d28\u91cf\u6570\u636e\u8bad\u7ec3\u7684\u6a21\u578b\u3002\u8d28\u91cf\u548c\u6570\u91cf\u5e76\u975e\u5bf9\u7acb\u5173\u7cfb\uff0c\u800c\u662f\u9700\u8981\u5728\u5b9e\u9645\u7ea6\u675f\u6761\u4ef6\u4e0b\u5bfb\u6c42\u6700\u4f18\u5e73\u8861\u3002</p>"},{"location":"part1/1_1_data_change/#12-llm","title":"1.2 LLM \u6570\u636e\u5168\u751f\u547d\u5468\u671f","text":"<p>\u4e00\u4e2a\u5927\u8bed\u8a00\u6a21\u578b\u4ece\"\u8bde\u751f\"\u5230\"\u4e0a\u5c97\"\uff0c\u9700\u8981\u7ecf\u5386\u591a\u4e2a\u9636\u6bb5\u7684\u8bad\u7ec3\uff0c\u6bcf\u4e2a\u9636\u6bb5\u5bf9\u6570\u636e\u7684\u9700\u6c42\u622a\u7136\u4e0d\u540c\u3002\u7406\u89e3\u8fd9\u4e2a\u5168\u751f\u547d\u5468\u671f\uff0c\u662f\u6210\u4e3a\u5408\u683c\u6570\u636e\u5de5\u7a0b\u5e08\u7684\u7b2c\u4e00\u6b65\u3002</p>"},{"location":"part1/1_1_data_change/#121-pre-train-sft-rlhf-rag","title":"1.2.1 \u56db\u9636\u6bb5\u8303\u5f0f\uff1aPre-train \u2192 SFT \u2192 RLHF \u2192 RAG","text":"<p>\u56fe1-2\uff1aLLM \u8bad\u7ec3\u6570\u636e\u6d41\u6c34\u7ebf \u2014\u2014 \u4ece TB \u7ea7\u9884\u8bad\u7ec3\u5230 KB \u7ea7 RAG\uff0c\u6570\u636e\u91cf\u9012\u51cf\u4f46\u8d28\u91cf\u8981\u6c42\u9012\u589e</p> <p>\u9884\u8bad\u7ec3\u9636\u6bb5\uff08Pre-training\uff09 \u662f\u5927\u6a21\u578b\u751f\u547d\u7684\u8d77\u70b9\u3002\u5728\u8fd9\u4e2a\u9636\u6bb5\uff0c\u6a21\u578b\u9700\u8981\u4ece\u6d77\u91cf\u7684\u65e0\u6807\u7b7e\u6587\u672c\u4e2d\u5b66\u4e60\u8bed\u8a00\u7684\u672c\u8d28\u2014\u2014\u8bed\u6cd5\u7ed3\u6784\u3001\u5e38\u8bc6\u77e5\u8bc6\u3001\u4e16\u754c\u8fd0\u4f5c\u7684\u89c4\u5f8b\u3002\u9884\u8bad\u7ec3\u6570\u636e\u7684\u89c4\u6a21\u901a\u5e38\u5728 TB \u7ea7\u522b\uff0c\u5305\u542b\u6570\u4e07\u4ebf\u4e2a Token\uff0c\u6765\u6e90\u6db5\u76d6\u7f51\u9875\u3001\u4e66\u7c4d\u3001\u4ee3\u7801\u3001\u5b66\u672f\u8bba\u6587\u7b49\u5404\u7c7b\u6587\u672c\u3002\u8fd9\u4e2a\u9636\u6bb5\u7684\u6838\u5fc3\u6311\u6218\u5728\u4e8e\u53bb\u91cd\u3001\u53bb\u566a\u3001\u8d28\u91cf\u8fc7\u6ee4\u4ee5\u53ca\u591a\u6837\u6027\u5e73\u8861\u3002\u5178\u578b\u7684\u9884\u8bad\u7ec3\u6570\u636e\u96c6\u5305\u62ec Common Crawl\u3001The Pile \u548c RefinedWeb\u3002</p> <p>\u76d1\u7763\u5fae\u8c03\u9636\u6bb5\uff08Supervised Fine-Tuning, SFT\uff09 \u662f\u6a21\u578b\u5b66\u4e60\"\u9075\u5faa\u6307\u4ee4\"\u7684\u5173\u952e\u65f6\u671f\u3002\u7ecf\u8fc7\u9884\u8bad\u7ec3\u7684\u6a21\u578b\u867d\u7136\u5177\u5907\u4e86\u5f3a\u5927\u7684\u8bed\u8a00\u7406\u89e3\u80fd\u529b\uff0c\u4f46\u5e76\u4e0d\u77e5\u9053\u5982\u4f55\u4e0e\u4eba\u7c7b\u8fdb\u884c\u6709\u6548\u5bf9\u8bdd\u3002SFT \u9636\u6bb5\u901a\u8fc7\u6210\u5bf9\u7684\u6307\u4ee4-\u56de\u590d\u6570\u636e\uff0c\u6559\u4f1a\u6a21\u578b\u7406\u89e3\u7528\u6237\u610f\u56fe\u5e76\u7ed9\u51fa\u6709\u5e2e\u52a9\u7684\u56de\u590d\u3002\u8fd9\u4e2a\u9636\u6bb5\u7684\u6570\u636e\u89c4\u6a21\u964d\u81f3 GB \u7ea7\u522b\uff0c\u5305\u542b\u6570\u5341\u4e07\u5230\u6570\u767e\u4e07\u6761\u7cbe\u5fc3\u6784\u9020\u7684\u5bf9\u8bdd\u6837\u672c\u3002\u5173\u952e\u6311\u6218\u5728\u4e8e\u4fdd\u8bc1\u6307\u4ee4\u7684\u591a\u6837\u6027\u3001\u56de\u590d\u7684\u8d28\u91cf\u4ee5\u53ca\u683c\u5f0f\u7684\u89c4\u8303\u6027\u3002Alpaca\u3001ShareGPT\u3001OpenAssistant \u662f\u8fd9\u4e2a\u9636\u6bb5\u5e38\u7528\u7684\u6570\u636e\u96c6\u3002</p> <p>\u57fa\u4e8e\u4eba\u7c7b\u53cd\u9988\u7684\u5f3a\u5316\u5b66\u4e60\u9636\u6bb5\uff08RLHF/DPO\uff09 \u81f4\u529b\u4e8e\u8ba9\u6a21\u578b\u7684\u8f93\u51fa\u66f4\u52a0\"\u5bf9\u9f50\"\u4eba\u7c7b\u504f\u597d\u3002\u6240\u8c13\u5bf9\u9f50\uff0c\u6307\u7684\u662f\u8ba9\u6a21\u578b\u53d8\u5f97\u66f4\u5b89\u5168\uff08\u4e0d\u4ea7\u751f\u6709\u5bb3\u5185\u5bb9\uff09\u3001\u66f4\u6709\u5e2e\u52a9\uff08\u771f\u6b63\u89e3\u51b3\u7528\u6237\u95ee\u9898\uff09\u3001\u66f4\u8bda\u5b9e\uff08\u4e0d\u7f16\u9020\u4e8b\u5b9e\uff09\u3002\u8fd9\u4e2a\u9636\u6bb5\u4f7f\u7528\u7684\u662f\u504f\u597d\u5bf9\u6bd4\u6570\u636e\uff0c\u5373\u4eba\u7c7b\u6807\u6ce8\u8005\u5728\u4e24\u4e2a\u5019\u9009\u56de\u590d\u4e2d\u9009\u62e9\u66f4\u597d\u7684\u90a3\u4e2a\u3002\u6570\u636e\u89c4\u6a21\u8fdb\u4e00\u6b65\u7f29\u51cf\u5230\u6570\u4e07\u81f3\u6570\u5341\u4e07\u6761\uff0c\u4f46\u5bf9\u6807\u6ce8\u8d28\u91cf\u7684\u8981\u6c42\u6781\u9ad8\u3002\u6807\u6ce8\u8005\u4e00\u81f4\u6027\uff08Inter-Annotator Agreement\uff09\u3001\u504f\u597d\u4fe1\u53f7\u7684\u51c6\u786e\u6027\u3001\u6837\u672c\u5206\u5e03\u7684\u8986\u76d6\u5ea6\u90fd\u662f\u9700\u8981\u7cbe\u5fc3\u628a\u63a7\u7684\u8981\u7d20\u3002</p> <p>\u68c0\u7d22\u589e\u5f3a\u751f\u6210\u9636\u6bb5\uff08Retrieval-Augmented Generation, RAG\uff09 \u89e3\u51b3\u7684\u662f\u6a21\u578b\u77e5\u8bc6\u66f4\u65b0\u548c\u5e7b\u89c9\u95ee\u9898\u3002\u65e0\u8bba\u9884\u8bad\u7ec3\u591a\u4e48\u5145\u5206\uff0c\u6a21\u578b\u7684\u77e5\u8bc6\u90fd\u6709\u622a\u6b62\u65e5\u671f\uff0c\u4e14\u65e0\u6cd5\u5b8c\u5168\u907f\u514d\"\u4e00\u672c\u6b63\u7ecf\u5730\u80e1\u8bf4\u516b\u9053\"\u3002RAG \u901a\u8fc7\u8ba9\u6a21\u578b\"\u67e5\u9605\u5916\u90e8\u8d44\u6599\"\u7684\u65b9\u5f0f\uff0c\u5c06\u4f01\u4e1a\u77e5\u8bc6\u5e93\u3001\u6700\u65b0\u6587\u6863\u7b49\u5916\u90e8\u4fe1\u606f\u6ce8\u5165\u5230\u751f\u6210\u8fc7\u7a0b\u4e2d\u3002\u8fd9\u4e2a\u9636\u6bb5\u7684\u6570\u636e\u6765\u6e90\u901a\u5e38\u662f\u4f01\u4e1a\u79c1\u6709\u7684\uff0c\u5305\u62ec PDF \u6587\u6863\u3001\u6570\u636e\u5e93\u8bb0\u5f55\u3001\u7f51\u9875\u5185\u5bb9\u7b49\u7ed3\u6784\u5316\u6216\u534a\u7ed3\u6784\u5316\u6570\u636e\u3002\u5173\u952e\u6311\u6218\u5728\u4e8e\u6587\u6863\u89e3\u6790\u3001\u8bed\u4e49\u5207\u7247\u3001\u5411\u91cf\u5316\u4ee5\u53ca\u68c0\u7d22\u51c6\u786e\u6027\u7684\u4f18\u5316\u3002</p>"},{"location":"part1/1_1_data_change/#122","title":"1.2.2 \u6570\u636e\u6d41\u7684\"\u6f0f\u6597\u6a21\u578b\"","text":"<p>\u7406\u89e3\u6570\u636e\u751f\u547d\u5468\u671f\u7684\u53e6\u4e00\u4e2a\u89c6\u89d2\u662f\"\u6f0f\u6597\u6a21\u578b\"\u3002\u4ece\u539f\u59cb\u7f51\u9875\u6570\u636e\u5230\u6700\u7ec8\u53ef\u7528\u4e8e\u8bad\u7ec3\u7684\u9ad8\u8d28\u91cf\u8bed\u6599\uff0c\u6570\u636e\u91cf\u4f1a\u7ecf\u5386\u6025\u5267\u7684\u7f29\u51cf\u3002</p> <p></p> <p>\u56fe1-3\uff1a\u6570\u636e\u8fc7\u6ee4\u6f0f\u6597 \u2014\u2014 \u4ece 100PB \u539f\u59cb\u6570\u636e\u5230 10GB SFT \u6570\u636e\uff0c\u4fdd\u7559\u7387\u4ec5 0.00001%</p> <p>\u4ee5\u4e00\u4e2a\u5178\u578b\u7684\u9884\u8bad\u7ec3\u6570\u636e\u5904\u7406\u6d41\u7a0b\u4e3a\u4f8b\uff1a\u5047\u8bbe\u6211\u4eec\u4ece Common Crawl \u83b7\u53d6\u4e86 100PB \u7684\u539f\u59cb\u7f51\u9875\u6570\u636e\u3002\u7ecf\u8fc7 URL \u53bb\u91cd\u548c\u5b8c\u5168\u76f8\u540c\u5185\u5bb9\u7684\u53bb\u91cd\u540e\uff0c\u6570\u636e\u91cf\u53ef\u80fd\u964d\u81f3 30PB\uff08\u4fdd\u7559\u7387 30%\uff09\u3002\u63a5\u4e0b\u6765\u8fdb\u884c\u8bed\u8a00\u8bc6\u522b\u548c\u8d28\u91cf\u8fc7\u6ee4\u2014\u2014\u79fb\u9664\u975e\u76ee\u6807\u8bed\u8a00\u3001\u8272\u60c5\u66b4\u529b\u3001\u6781\u77ed\u6587\u672c\u3001\u4e71\u7801\u7b49\u2014\u2014\u6570\u636e\u91cf\u8fdb\u4e00\u6b65\u964d\u81f3 5PB\uff08\u4fdd\u7559\u7387 5%\uff09\u3002\u7136\u540e\u8fdb\u884c\u66f4\u7cbe\u7ec6\u7684\u8d28\u91cf\u8bc4\u4f30\uff0c\u4f7f\u7528\u56f0\u60d1\u5ea6\u3001\u91cd\u590d\u7387\u3001\u4fe1\u606f\u5bc6\u5ea6\u7b49\u6307\u6807\u7b5b\u9009\uff0c\u6700\u7ec8\u7684\u9884\u8bad\u7ec3\u8bed\u6599\u53ef\u80fd\u53ea\u6709 1PB\uff08\u4fdd\u7559\u7387 1%\uff09\u3002\u800c\u5982\u679c\u8fd8\u9700\u8981\u4ece\u4e2d\u62bd\u53d6\u6216\u6784\u9020 SFT \u6570\u636e\uff0c\u6700\u7ec8\u4ea7\u51fa\u53ef\u80fd\u4ec5\u6709 10GB\u2014\u2014\u76f8\u5bf9\u4e8e\u539f\u59cb\u6570\u636e\uff0c\u4fdd\u7559\u7387\u4f4e\u81f3\u5343\u4e07\u5206\u4e4b\u4e00\u3002</p> <p>\u5728\u5b9e\u9645\u5de5\u7a0b\u4e2d\uff0c\u7406\u89e3\u8fd9\u4e2a\u6bd4\u4f8b\u81f3\u5173\u91cd\u8981\u3002\u5b83\u76f4\u63a5\u5f71\u54cd\u722c\u53d6\u89c4\u6a21\u7684\u89c4\u5212\u3001\u5b58\u50a8\u6210\u672c\u7684\u9884\u7b97\u3001\u5904\u7406\u6d41\u6c34\u7ebf\u7684\u8bbe\u8ba1\u3002\u8bb8\u591a\u56e2\u961f\u5728\u9879\u76ee\u521d\u671f\u4f4e\u4f30\u4e86\u8fd9\u4e2a\"\u635f\u8017\u7387\"\uff0c\u5bfc\u81f4\u6570\u636e\u50a8\u5907\u4e0d\u8db3\uff0c\u4e0d\u5f97\u4e0d\u4e2d\u9014\u8fd4\u5de5\u3002</p>"},{"location":"part1/1_1_data_change/#13","title":"1.3 \u6311\u6218\u4e0e\u673a\u9047\uff1a\u5f02\u6784\u591a\u6a21\u6001\u3001\u7248\u6743\u5408\u89c4\u4e0e\u7b97\u529b\u6210\u672c\u7684\u535a\u5f08","text":""},{"location":"part1/1_1_data_change/#131","title":"1.3.1 \u6311\u6218\u4e00\uff1a\u5f02\u6784\u591a\u6a21\u6001\u6570\u636e\u7684\u5904\u7406\u590d\u6742\u6027","text":"<p>\u968f\u7740 GPT-4V\u3001Gemini\u3001Sora \u7b49\u591a\u6a21\u6001\u6a21\u578b\u7684\u6d8c\u73b0\uff0c\u6570\u636e\u5de5\u7a0b\u7684\u590d\u6742\u5ea6\u5448\u6307\u6570\u7ea7\u4e0a\u5347\u3002\u7eaf\u6587\u672c\u65f6\u4ee3\uff0c\u6240\u6709\u6570\u636e\u90fd\u662f\u7edf\u4e00\u7684 UTF-8 \u7f16\u7801\u5b57\u7b26\u4e32\uff0c\u5904\u7406\u5de5\u5177\u94fe\u6210\u719f\u4e14\u6807\u51c6\u5316\u3002\u800c\u591a\u6a21\u6001\u65f6\u4ee3\uff0c\u6570\u636e\u683c\u5f0f\u7206\u70b8\u5f0f\u589e\u957f\uff1a\u56fe\u7247\u6709 JPEG\u3001PNG\u3001WebP\uff1b\u89c6\u9891\u6709 MP4\u3001AVI\u3001MKV\uff1b\u97f3\u9891\u6709 WAV\u3001MP3\u3001FLAC\uff1b\u6587\u6863\u6709 PDF\u3001Word\u3001HTML\u3002\u6bcf\u79cd\u683c\u5f0f\u90fd\u6709\u5176\u72ec\u7279\u7684\u89e3\u6790\u65b9\u5f0f\u548c\u8d28\u91cf\u8bc4\u4f30\u6807\u51c6\u3002</p> \u7ef4\u5ea6 \u7eaf\u6587\u672c\u65f6\u4ee3 \u591a\u6a21\u6001\u65f6\u4ee3 \u6570\u636e\u683c\u5f0f \u7edf\u4e00\u7684 UTF-8 \u6587\u672c \u56fe\u7247\u3001\u89c6\u9891\u3001\u97f3\u9891\u3001\u6587\u6863\u3001\u7f51\u9875\u7b49\u591a\u79cd\u683c\u5f0f \u5b58\u50a8\u9700\u6c42 TB \u7ea7 PB \u7ea7\uff08\u56fe\u7247/\u89c6\u9891\u5360\u4e3b\u5bfc\uff09 \u5bf9\u9f50\u96be\u5ea6 \u65e0\uff08\u7eaf\u6587\u672c\u65e0\u9700\u5bf9\u9f50\uff09 \u6781\u9ad8\uff08\u56fe\u6587\u5bf9\u9f50\u3001\u97f3\u89c6\u9891\u540c\u6b65\u3001\u8de8\u6a21\u6001\u8bed\u4e49\u4e00\u81f4\u6027\uff09 \u6e05\u6d17\u5de5\u5177\u94fe \u6210\u719f\uff08FastText\u3001KenLM\uff09 \u788e\u7247\u5316\uff08\u6bcf\u79cd\u6a21\u6001\u90fd\u6709\u72ec\u7acb\u5de5\u5177\u94fe\uff09 \u8d28\u91cf\u8bc4\u4f30 \u56f0\u60d1\u5ea6\u3001\u53bb\u91cd\u7387 \u7f8e\u5b66\u8bc4\u5206\u3001CLIP-Score\u3001OCR \u51c6\u786e\u7387\u3001ASR \u9519\u8bef\u7387\u7b49 <p>\u66f4\u68d8\u624b\u7684\u662f\u8de8\u6a21\u6001\u5bf9\u9f50\u95ee\u9898\u3002\u4e00\u5f20\u56fe\u7247\u914d\u4e00\u6bb5\u63cf\u8ff0\u6587\u5b57\uff0c\u5982\u4f55\u786e\u4fdd\u6587\u5b57\u51c6\u786e\u63cf\u8ff0\u4e86\u56fe\u7247\u5185\u5bb9\uff1f\u4e00\u6bb5\u89c6\u9891\u4e2d\u7684\u8bed\u97f3\u548c\u753b\u9762\u5982\u4f55\u7cbe\u786e\u540c\u6b65\uff1f\u8fd9\u4e9b\u5bf9\u9f50\u95ee\u9898\u5728\u7eaf\u6587\u672c\u65f6\u4ee3\u6839\u672c\u4e0d\u5b58\u5728\uff0c\u5374\u662f\u591a\u6a21\u6001\u6570\u636e\u5de5\u7a0b\u7684\u6838\u5fc3\u96be\u9898\u3002</p> <p></p> <p>\u56fe1-4\uff1a\u591a\u6a21\u6001\u6570\u636e\u5904\u7406\u590d\u6742\u5ea6 \u2014\u2014 \u7ebf\u6761\u7c97\u7ec6\u8868\u793a\u5904\u7406\u96be\u5ea6\uff0c\u89c6\u9891(5/5)\u548cPDF(4/5)\u6700\u590d\u6742</p> <p>\u4ece\u5de5\u7a0b\u5b9e\u8df5\u7684\u89d2\u5ea6\uff0c\u591a\u6a21\u6001\u6570\u636e\u5904\u7406\u9700\u8981\u6a21\u5757\u5316\u8bbe\u8ba1\u2014\u2014\u6bcf\u79cd\u6a21\u6001\u72ec\u7acb\u5904\u7406\u540e\u518d\u8fdb\u884c\u8de8\u6a21\u6001\u5bf9\u9f50\u3002\u540c\u65f6\uff0c\u5e94\u4f18\u5148\u6295\u8d44\u4e8e\u7edf\u4e00\u7684\u6570\u636e\u683c\u5f0f\u6807\u51c6\uff0c\u5982 WebDataset\u3001TFDS \u7b49\uff0c\u4ee5\u964d\u4f4e\u4e0b\u6e38\u5904\u7406\u7684\u590d\u6742\u5ea6\u3002\u5efa\u7acb\u6a21\u6001\u611f\u77e5\u7684\u8d28\u91cf\u8bc4\u4f30\u4f53\u7cfb\u4e5f\u81f3\u5173\u91cd\u8981\uff1a\u56fe\u7247\u9700\u8981\u7f8e\u5b66\u8bc4\u5206\u548c CLIP \u76f8\u4f3c\u5ea6\uff0c\u8bed\u97f3\u9700\u8981 ASR \u51c6\u786e\u7387\u548c\u8bf4\u8bdd\u4eba\u5206\u79bb\u8d28\u91cf\uff0cPDF \u9700\u8981 OCR \u51c6\u786e\u7387\u548c\u7248\u9762\u5206\u6790\u7cbe\u5ea6\u3002</p>"},{"location":"part1/1_1_data_change/#132","title":"1.3.2 \u6311\u6218\u4e8c\uff1a\u7248\u6743\u5408\u89c4\u7684\u7070\u8272\u5730\u5e26","text":"<p>\u5927\u6a21\u578b\u8bad\u7ec3\u6570\u636e\u7684\u7248\u6743\u95ee\u9898\uff0c\u5df2\u4ece\u6280\u672f\u8ba8\u8bba\u6f14\u53d8\u4e3a\u6cd5\u5f8b\u6218\u573a\u30022023 \u5e74\uff0cGetty Images \u8d77\u8bc9 Stability AI\uff0c\u6307\u63a7\u5176\u672a\u7ecf\u6388\u6743\u4f7f\u7528\u6570\u767e\u4e07\u5f20\u7248\u6743\u56fe\u7247\u8bad\u7ec3 Stable Diffusion\u30022024 \u5e74\uff0c\u300a\u7ebd\u7ea6\u65f6\u62a5\u300b\u8d77\u8bc9 OpenAI \u548c Microsoft\uff0c\u6307\u63a7 GPT \u6a21\u578b\u4fb5\u72af\u7248\u6743\u3002\u591a\u56fd\u76d1\u7ba1\u673a\u6784\u5f00\u59cb\u8981\u6c42 AI \u516c\u53f8\u62ab\u9732\u8bad\u7ec3\u6570\u636e\u6765\u6e90\u3002</p> <p>\u8fd9\u4e9b\u6cd5\u5f8b\u8bc9\u8bbc\u7684\u7ed3\u679c\u5c06\u6df1\u523b\u5f71\u54cd AI \u884c\u4e1a\u7684\u53d1\u5c55\u8d70\u5411\uff0c\u4f46\u5bf9\u4e8e\u6570\u636e\u5de5\u7a0b\u5e08\u800c\u8a00\uff0c\u7b49\u5f85\u5c18\u57c3\u843d\u5b9a\u663e\u7136\u4e0d\u662f\u660e\u667a\u4e4b\u4e3e\u3002\u5f53\u524d\u7684\u5408\u89c4\u7b56\u7565\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u7740\u624b\uff1a\u9996\u5148\u662f\u6765\u6e90\u8ffd\u6eaf\uff0c\u4e3a\u6bcf\u6761\u8bad\u7ec3\u6570\u636e\u8bb0\u5f55\u5b8c\u6574\u7684\u6765\u6e90\u5143\u4fe1\u606f\uff0c\u5305\u62ec URL\u3001\u6293\u53d6\u65f6\u95f4\u3001\u539f\u59cb\u7248\u6743\u58f0\u660e\u7b49\uff1b\u5176\u6b21\u662f\u8bb8\u53ef\u8bc1\u8fc7\u6ee4\uff0c\u4f18\u5148\u4f7f\u7528\u660e\u786e\u5141\u8bb8 AI \u8bad\u7ec3\u4f7f\u7528\u7684\u6570\u636e\uff0c\u5982 CC0\u3001CC-BY \u7b49\u5f00\u653e\u8bb8\u53ef\u8bc1\u7684\u5185\u5bb9\uff1b\u7b2c\u4e09\u662f\u9075\u5b88 robots.txt \u534f\u8bae\uff0c\u5c0a\u91cd\u7f51\u7ad9\u6240\u6709\u8005\u7684\u722c\u866b\u9650\u5236\u58f0\u660e\uff1b\u6700\u540e\u662f\u6570\u636e\u8131\u654f\uff0c\u5bf9\u6d89\u53ca\u4e2a\u4eba\u9690\u79c1\u7684\u5185\u5bb9\u8fdb\u884c\u533f\u540d\u5316\u6216\u5220\u9664\u5904\u7406\u3002</p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\"Fair Use\"\uff08\u5408\u7406\u4f7f\u7528\uff09\u5728 AI \u8bad\u7ec3\u573a\u666f\u4e0b\u7684\u8fb9\u754c\u4ecd\u4e0d\u660e\u786e\uff0c\u5404\u56fd\u6cd5\u5f8b\u7684\u9002\u7528\u6807\u51c6\u4e5f\u5b58\u5728\u5dee\u5f02\u3002\u56e0\u6b64\uff0c\u5efa\u8bae\u5728\u6570\u636e\u7ba1\u7ebf\u4e2d\u9884\u7559\u7248\u6743\u8fc7\u6ee4\u7684\u63a5\u53e3\uff0c\u4ee5\u4fbf\u5728\u6cd5\u5f8b\u73af\u5883\u660e\u786e\u540e\u80fd\u591f\u5feb\u901f\u8c03\u6574\u6570\u636e\u5904\u7406\u7b56\u7565\u3002</p>"},{"location":"part1/1_1_data_change/#133","title":"1.3.3 \u6311\u6218\u4e09\uff1a\u7b97\u529b\u6210\u672c\u7684\"\u9690\u5f62\u6740\u624b\"","text":"<p>\u6570\u636e\u5904\u7406\u7684\u7b97\u529b\u6210\u672c\u5e38\u88ab\u4e25\u91cd\u4f4e\u4f30\u3002\u8bb8\u591a\u56e2\u961f\u5728\u9884\u7b97\u6a21\u578b\u8bad\u7ec3\u8d39\u7528\u65f6\uff0c\u53ea\u8ba1\u7b97 GPU \u8bad\u7ec3\u65f6\u95f4\uff0c\u5374\u5ffd\u7565\u4e86\u6570\u636e\u9884\u5904\u7406\u53ef\u80fd\u6d88\u8017\u540c\u7b49\u751a\u81f3\u66f4\u591a\u7684\u8d44\u6e90\u3002</p> <p>\u8003\u8651\u4e00\u4e2a\u5b9e\u9645\u573a\u666f\uff1a\u5904\u7406 10TB \u7684\u539f\u59cb\u7f51\u9875\u6570\u636e\u3002\u5047\u8bbe\u5e73\u5747\u6bcf\u6761\u6570\u636e\u9700\u8981\u7ecf\u8fc7 HTML \u89e3\u6790\u3001\u6587\u672c\u63d0\u53d6\u3001\u8bed\u8a00\u8bc6\u522b\u3001\u8d28\u91cf\u8bc4\u5206\u3001\u53bb\u91cd\u68c0\u67e5\u7b49\u4e94\u4e2a\u6b65\u9aa4\u3002\u6bcf\u4e2a\u6b65\u9aa4\u5355\u6761\u5904\u7406\u8017\u65f6 100 \u6beb\u79d2\uff08\u5df2\u7ecf\u662f\u76f8\u5f53\u5feb\u7684\u901f\u5ea6\uff09\u3002\u90a3\u4e48\u603b\u5904\u7406\u65f6\u95f4\u7ea6\u4e3a\uff1a10TB \u00f7 10KB/\u6761 \u00d7 0.5 \u79d2/\u6761 \u2248 15 \u4e07 GPU \u5c0f\u65f6\u3002\u6309\u7167\u4e91\u670d\u52a1\u5546\u7684\u5b9a\u4ef7\uff0c\u8fd9\u53ef\u80fd\u610f\u5473\u7740\u6570\u5341\u4e07\u7f8e\u5143\u7684\u6210\u672c\u2014\u2014\u4e0e\u6a21\u578b\u8bad\u7ec3\u672c\u8eab\u7684\u8d39\u7528\u76f8\u5f53\u3002</p> \u573a\u666f \u8bad\u7ec3\u6570\u636e\u91cf \u8bad\u7ec3\u6210\u672c\uff08A100 \u5c0f\u65f6\uff09 \u6a21\u578b\u6027\u80fd \u4e0d\u53bb\u91cd\uff0c\u76f4\u63a5\u8bad\u7ec3 10T Token 10,000 \u5c0f\u65f6 \u57fa\u51c6\uff08\u542b\u91cd\u590d\u5bfc\u81f4\u7684\"\u590d\u8bfb\u673a\"\u95ee\u9898\uff09 \u53bb\u91cd\u540e\u8bad\u7ec3 7T Token 7,000 \u5c0f\u65f6 \u9ad8\u4e8e\u57fa\u51c6\uff08\u91cd\u590d\u6570\u636e\u4f1a\u964d\u4f4e\u5b66\u4e60\u6548\u7387\uff09 \u51c0\u6536\u76ca - \u8282\u7701 3,000 \u5c0f\u65f6 + \u66f4\u597d\u7684\u6a21\u578b - <p>\u7136\u800c\uff0c\u6362\u4e00\u4e2a\u89d2\u5ea6\u770b\uff0c\u6570\u636e\u5de5\u7a0b\u7684\u6295\u8d44\u56de\u62a5\u7387\u53ef\u80fd\u6781\u9ad8\u3002\u4e0a\u8868\u5c55\u793a\u4e86\u4e00\u4e2a\u7b80\u5316\u7684\u6848\u4f8b\uff1a\u901a\u8fc7\u6295\u5165\u4e00\u5b9a\u8d44\u6e90\u8fdb\u884c\u6570\u636e\u53bb\u91cd\uff0c\u4e0d\u4ec5\u8282\u7701\u4e86 30% \u7684\u8bad\u7ec3\u6210\u672c\uff0c\u8fd8\u83b7\u5f97\u4e86\u66f4\u597d\u7684\u6a21\u578b\u6027\u80fd\u3002\u8fd9\u5c31\u662f\u6570\u636e\u5de5\u7a0b\u7684\"\u6760\u6746\u6548\u5e94\"\u2014\u2014\u5728\u5f53\u524d\u7b97\u529b\u4ef7\u683c\u4e0b\uff08A100 \u7ea6 $2/\u5c0f\u65f6\uff09\uff0c1 \u5c0f\u65f6\u6570\u636e\u5904\u7406\u5de5\u4f5c\u5982\u679c\u80fd\u51cf\u5c11 10 \u5c0f\u65f6\u65e0\u6548\u8bad\u7ec3\uff0c\u5c31\u662f 10 \u500d\u7684\u6295\u8d44\u56de\u62a5\u7387\u3002</p> <p></p> <p>\u56fe1-5\uff1a\u6570\u636e\u8d28\u91cf\u4e0e\u8bad\u7ec3\u6548\u7387\u5173\u7cfb \u2014\u2014 \u7eff\u8272\u66f2\u7ebf\uff08\u7cbe\u9009\u6570\u636e\uff09\u6548\u7387\u6700\u9ad8\uff0c30-70%\u8d28\u91cf\u533a\u95f4 ROI \u6700\u5927</p>"},{"location":"part1/1_1_data_change/#134","title":"1.3.4 \u673a\u9047\uff1a\u4e09\u5927\u8d8b\u52bf\u6b63\u5728\u964d\u4f4e\u95e8\u69db","text":"<p>\u5c3d\u7ba1\u6311\u6218\u91cd\u91cd\uff0c\u4f46\u5bf9\u4e8e\u6570\u636e\u5de5\u7a0b\u5e08\u800c\u8a00\uff0c\u5f53\u4e0b\u6b63\u662f\u5165\u573a\u7684\u9ec4\u91d1\u65f6\u671f\u3002\u4e09\u5927\u8d8b\u52bf\u6b63\u5728\u663e\u8457\u964d\u4f4e\u5927\u6a21\u578b\u6570\u636e\u5de5\u7a0b\u7684\u95e8\u69db\u3002</p> <p>\u7b2c\u4e00\u4e2a\u8d8b\u52bf\u662f\u5f00\u6e90\u9ad8\u8d28\u91cf\u6570\u636e\u96c6\u7684\u6d8c\u73b0\u3002\u533a\u522b\u4e8e\u65e9\u671f\u5c01\u95ed\u7684\u5546\u4e1a\u6570\u636e\uff0c\u8fd1\u5e74\u6765\u6d8c\u73b0\u4e86\u5927\u91cf\u9ad8\u8d28\u91cf\u7684\u5f00\u6e90\u9884\u8bad\u7ec3\u6570\u636e\u96c6\u3002HuggingFace \u7684 FineWeb \u63d0\u4f9b\u4e86\u7ecf\u8fc7\u7cbe\u5fc3\u6e05\u6d17\u7684 15T Token \u82f1\u6587\u7f51\u9875\u6570\u636e\u3002RedPajama \u5f00\u6e90\u4e86 LLaMA \u8bad\u7ec3\u6570\u636e\u7684\u5b8c\u6574\u590d\u73b0\u7248\u672c\u3002DCLM \u5219\u63d0\u4f9b\u4e86\u9488\u5bf9\u7279\u5b9a\u9886\u57df\u4f18\u5316\u7684\u6570\u636e\u96c6\u3002\u8fd9\u4e9b\u5f00\u6e90\u6570\u636e\u96c6\u5927\u5927\u964d\u4f4e\u4e86\u4e2d\u5c0f\u56e2\u961f\u6784\u5efa\u9884\u8bad\u7ec3\u8bed\u6599\u7684\u6210\u672c\uff0c\u4f7f\u5f97\u539f\u672c\u53ea\u6709\u5927\u5382\u624d\u80fd\u4f01\u53ca\u7684\u8d44\u6e90\u53d8\u5f97\u89e6\u624b\u53ef\u53ca\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u8d8b\u52bf\u662f AI \u539f\u751f\u6570\u636e\u5de5\u5177\u7684\u6210\u719f\u3002\u4f20\u7edf\u7684\u5927\u6570\u636e\u5de5\u5177\uff08\u5982 Hadoop\u3001Spark\uff09\u867d\u7136\u6210\u719f\uff0c\u4f46\u5e76\u975e\u4e3a AI \u8bad\u7ec3\u573a\u666f\u8bbe\u8ba1\u3002\u8fd1\u5e74\u6765\uff0c\u4e00\u6279\u4e13\u4e3a LLM \u6570\u636e\u5de5\u7a0b\u6253\u9020\u7684\u5de5\u5177\u5f00\u59cb\u6210\u719f\u3002\u963f\u91cc\u5df4\u5df4\u7684 Data-Juicer \u63d0\u4f9b\u4e86\u6a21\u5757\u5316\u7684\u6570\u636e\u5904\u7406\u6d41\u6c34\u7ebf\uff0c\u5305\u542b\u6570\u5341\u79cd\u5f00\u7bb1\u5373\u7528\u7684\u6e05\u6d17\u7b97\u5b50\u3002Dolma \u662f Allen AI \u5f00\u53d1\u7684\u5927\u89c4\u6a21\u6587\u672c\u5904\u7406\u5de5\u5177\u5305\uff0c\u4e13\u95e8\u9488\u5bf9\u9884\u8bad\u7ec3\u6570\u636e\u4f18\u5316\u3002\u8fd9\u4e9b\u5de5\u5177\u7684\u51fa\u73b0\uff0c\u4f7f\u5f97\u6570\u636e\u5de5\u7a0b\u5e08\u53ef\u4ee5\u7ad9\u5728\u5de8\u4eba\u7684\u80a9\u8180\u4e0a\uff0c\u65e0\u9700\u4ece\u96f6\u5f00\u59cb\u9020\u8f6e\u5b50\u3002</p> <p>\u7b2c\u4e09\u4e2a\u8d8b\u52bf\u662f\u5408\u6210\u6570\u636e\u7684\u4e3b\u6d41\u5316\u3002\u5982\u524d\u6240\u8ff0\uff0c\u5fae\u8f6f Phi \u7cfb\u5217\u7684\u6210\u529f\u8bc1\u660e\u4e86\u5408\u6210\u6570\u636e\u7684\u5de8\u5927\u6f5c\u529b\u3002\u5982\u4eca\uff0c\u4f7f\u7528 GPT-4\u3001Claude \u7b49\u5f3a\u5927\u6a21\u578b\u751f\u6210\u8bad\u7ec3\u6570\u636e\u5df2\u6210\u4e3a\u884c\u4e1a\u5e38\u6001\u3002\u8fd9\u79cd\"\u4ee5\u5f3a\u5e26\u5f31\"\u7684\u7b56\u7565\uff0c\u4f7f\u5f97\u9ad8\u8d28\u91cf\u6570\u636e\u7684\u83b7\u53d6\u4e0d\u518d\u5b8c\u5168\u4f9d\u8d56\u4eba\u5de5\u6807\u6ce8\uff0c\u5927\u5927\u52a0\u901f\u4e86\u6570\u636e\u51c6\u5907\u7684\u6548\u7387\u3002\u7136\u800c\uff0c\u5408\u6210\u6570\u636e\u4e5f\u5e26\u6765\u4e86\u65b0\u7684\u6311\u6218\uff1a\u5982\u4f55\u907f\u514d\u6a21\u578b\u584c\u7f29\uff08Model Collapse\uff09\uff1f\u5982\u4f55\u4fdd\u8bc1\u6570\u636e\u7684\u591a\u6837\u6027\uff1f\u8fd9\u4e9b\u95ee\u9898\u6211\u4eec\u5c06\u5728\u540e\u7eed\u7ae0\u8282\u8be6\u7ec6\u63a2\u8ba8\u3002</p>"},{"location":"part1/1_1_data_change/#14","title":"1.4 \u5e38\u89c1\u8bef\u533a\u4e0e\u907f\u5751\u6307\u5357","text":"<p>\u5728\u8fdb\u5165\u5177\u4f53\u7684\u6280\u672f\u5b9e\u8df5\u4e4b\u524d\uff0c\u6709\u5fc5\u8981\u5148\u6f84\u6e05\u51e0\u4e2a\u5e38\u89c1\u7684\u8ba4\u77e5\u8bef\u533a\u3002\u8fd9\u4e9b\u8bef\u533a\u8f7b\u5219\u5bfc\u81f4\u8d44\u6e90\u6d6a\u8d39\uff0c\u91cd\u5219\u5bfc\u81f4\u9879\u76ee\u5931\u8d25\u3002</p>"},{"location":"part1/1_1_data_change/#_3","title":"\u8bef\u533a\u4e00\uff1a\"\u6570\u636e\u91cf\u8d8a\u5927\u8d8a\u597d\"","text":"<p>\u8fd9\u662f\u6700\u5e38\u89c1\u4e5f\u662f\u5371\u5bb3\u6700\u5927\u7684\u8bef\u533a\u3002\u8bb8\u591a\u56e2\u961f\u5728\u9879\u76ee\u542f\u52a8\u65f6\uff0c\u7b2c\u4e00\u53cd\u5e94\u5c31\u662f\"\u722c\u53d6\u5c3d\u53ef\u80fd\u591a\u7684\u6570\u636e\"\u3002\u7136\u800c\uff0c\u5982\u524d\u6240\u8ff0\uff0c\u539f\u59cb\u6570\u636e\u7684\u4fdd\u7559\u7387\u901a\u5e38\u53ea\u6709 5-20%\u3002\u76f2\u76ee\u8ffd\u6c42\u6570\u636e\u91cf\uff0c\u610f\u5473\u7740 80% \u4ee5\u4e0a\u7684\u722c\u53d6\u3001\u5b58\u50a8\u3001\u521d\u6b65\u5904\u7406\u6210\u672c\u90fd\u662f\u6d6a\u8d39\u3002\u66f4\u7cdf\u7cd5\u7684\u662f\uff0c\u5982\u679c\u540e\u7eed\u7684\u8d28\u91cf\u8fc7\u6ee4\u4e0d\u591f\u4e25\u683c\uff0c\u4f4e\u8d28\u91cf\u6570\u636e\u6df7\u5165\u8bad\u7ec3\u96c6\uff0c\u53ef\u80fd\u4f1a\u5bf9\u6a21\u578b\u6027\u80fd\u4ea7\u751f\u8d1f\u9762\u5f71\u54cd\u3002</p> <p>\u6b63\u786e\u7684\u505a\u6cd5\u662f\uff1a\u5148\u7528\u5c0f\u89c4\u6a21\u6570\u636e\u9a8c\u8bc1\u6574\u4e2a\u5904\u7406\u6d41\u6c34\u7ebf\u7684\u6709\u6548\u6027\uff0c\u786e\u8ba4\u8d28\u91cf\u6807\u51c6\u548c\u8fc7\u6ee4\u7b56\u7565\u540e\uff0c\u518d\u8fdb\u884c\u5927\u89c4\u6a21\u6570\u636e\u91c7\u96c6\u3002\"\u5148\u8d28\u91cf\u3001\u540e\u6570\u91cf\"\u5e94\u8be5\u6210\u4e3a\u6570\u636e\u5de5\u7a0b\u7684\u57fa\u672c\u539f\u5219\u3002</p>"},{"location":"part1/1_1_data_change/#_4","title":"\u8bef\u533a\u4e8c\uff1a\"\u4e00\u6b21\u6027\u5904\u7406\u5b8c\u6240\u6709\u6570\u636e\"","text":"<p>\u6570\u636e\u5904\u7406\u662f\u4e00\u4e2a\u8fed\u4ee3\u7684\u8fc7\u7a0b\uff0c\u800c\u975e\u4e00\u6b21\u6027\u7684\u4efb\u52a1\u3002\u6a21\u578b\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u4f1a\u66b4\u9732\u6570\u636e\u95ee\u9898\uff08\u5982\u67d0\u7c7b\u6837\u672c\u8fc7\u591a\u5bfc\u81f4\u504f\u89c1\uff09\uff0c\u8bc4\u6d4b\u7ed3\u679c\u4f1a\u6307\u5bfc\u6570\u636e\u7b5b\u9009\u7b56\u7565\uff08\u5982\u9700\u8981\u589e\u5f3a\u67d0\u9886\u57df\u6570\u636e\uff09\uff0c\u6cd5\u5f8b\u5408\u89c4\u8981\u6c42\u53ef\u80fd\u53d1\u751f\u53d8\u5316\uff08\u5982\u9700\u8981\u79fb\u9664\u67d0\u4e9b\u6765\u6e90\u7684\u6570\u636e\uff09\u3002</p> <p>\u56e0\u6b64\uff0c\u6570\u636e\u5904\u7406\u6d41\u6c34\u7ebf\u5fc5\u987b\u8bbe\u8ba1\u4e3a\u53ef\u91cd\u590d\u6267\u884c\u3001\u53ef\u589e\u91cf\u66f4\u65b0\u3001\u53ef\u56de\u6eda\u7248\u672c\u3002\u7b2c\u4e8c\u7ae0\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 DVC\u3001LakeFS \u7b49\u5de5\u5177\u5b9e\u73b0\u6570\u636e\u7248\u672c\u63a7\u5236\u3002</p>"},{"location":"part1/1_1_data_change/#_5","title":"\u8bef\u533a\u4e09\uff1a\"\u53ea\u5173\u6ce8\u9884\u8bad\u7ec3\u6570\u636e\"","text":"<p>\u9884\u8bad\u7ec3\u6570\u636e\u786e\u5b9e\u662f LLM \u7684\u57fa\u7840\uff0c\u4f46\u5ffd\u89c6\u540e\u7eed\u9636\u6bb5\u7684\u6570\u636e\u540c\u6837\u5371\u9669\u3002\u4e00\u4e2a\u5728\u5927\u89c4\u6a21\u8bed\u6599\u4e0a\u9884\u8bad\u7ec3\u826f\u597d\u7684\u57fa\u5ea7\u6a21\u578b\uff0c\u5982\u679c SFT \u6570\u636e\u8d28\u91cf\u4f4e\u52a3\uff0c\u6700\u7ec8\u4ea7\u51fa\u7684\u5bf9\u8bdd\u6a21\u578b\u53ef\u80fd\u8868\u73b0\u5e73\u5e73\u3002\u540c\u6837\uff0cRLHF \u9636\u6bb5\u7684\u504f\u597d\u6570\u636e\u5982\u679c\u6807\u6ce8\u4e0d\u4e00\u81f4\uff0c\u53ef\u80fd\u5bfc\u81f4\u6a21\u578b\u884c\u4e3a\u4e0d\u7a33\u5b9a\u3002</p> <p>\u5168\u751f\u547d\u5468\u671f\u7684\u6570\u636e\u8d28\u91cf\u7ba1\u7406\u540c\u7b49\u91cd\u8981\u3002\u9884\u8bad\u7ec3\u3001SFT\u3001RLHF\u3001RAG \u56db\u4e2a\u9636\u6bb5\u7684\u6570\u636e\u5e94\u8be5\u6709\u5404\u81ea\u7684\u8d28\u91cf\u6807\u51c6\u548c\u8bc4\u4f30\u4f53\u7cfb\u3002</p>"},{"location":"part1/1_1_data_change/#_6","title":"\u8bef\u533a\u56db\uff1a\"\u5f00\u6e90\u6570\u636e\u62ff\u6765\u5373\u7528\"","text":"<p>\u5f00\u6e90\u6570\u636e\u96c6\u6781\u5927\u5730\u964d\u4f4e\u4e86\u5165\u95e8\u95e8\u69db\uff0c\u4f46\u76f4\u63a5\u4f7f\u7528\u5f00\u6e90\u6570\u636e\u800c\u4e0d\u8fdb\u884c\u4e8c\u6b21\u5ba1\u67e5\u662f\u5371\u9669\u7684\u3002\u5f00\u6e90\u6570\u636e\u96c6\u53ef\u80fd\u5b58\u5728\u4ee5\u4e0b\u95ee\u9898\uff1a\u8fc7\u65f6\uff08\u6293\u53d6\u65f6\u95f4\u8f83\u65e9\uff0c\u4e0d\u5305\u542b\u6700\u65b0\u77e5\u8bc6\uff09\u3001\u504f\u89c1\uff08\u6570\u636e\u5206\u5e03\u4e0d\u5747\u5300\uff09\u3001\u566a\u58f0\uff08\u90e8\u5206\u6837\u672c\u8d28\u91cf\u4e0d\u8fbe\u6807\uff09\u3001\u7248\u6743\u98ce\u9669\uff08\u8bb8\u53ef\u8bc1\u4e0d\u660e\u786e\uff09\u3002</p> <p>\u6b63\u786e\u7684\u505a\u6cd5\u662f\u5c06\u5f00\u6e90\u6570\u636e\u89c6\u4e3a\"\u539f\u6750\u6599\"\u800c\u975e\"\u6210\u54c1\"\u3002\u6839\u636e\u81ea\u8eab\u4efb\u52a1\u9700\u6c42\u8fdb\u884c\u4e8c\u6b21\u8fc7\u6ee4\u3001\u589e\u5f3a\u548c\u5e73\u8861\uff0c\u624d\u80fd\u53d1\u6325\u5f00\u6e90\u6570\u636e\u7684\u6700\u5927\u4ef7\u503c\u3002</p>"},{"location":"part1/1_1_data_change/#15","title":"1.5 \u672c\u7ae0\u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u4ece Scaling Laws \u51fa\u53d1\uff0c\u7cfb\u7edf\u8bba\u8ff0\u4e86\u5927\u6a21\u578b\u65f6\u4ee3\u6570\u636e\u5de5\u7a0b\u7684\u6838\u5fc3\u7406\u5ff5\u3002\u6211\u4eec\u9996\u5148\u63a2\u8ba8\u4e86\"\u8d28\u91cf\u4f18\u4e8e\u6570\u91cf\"\u7684\u8303\u5f0f\u8f6c\u79fb\uff0c\u4ece Chinchilla \u7684\u6700\u4f18\u914d\u6bd4\u5230 Phi \u7cfb\u5217\u7684\u6781\u7aef\u5b9e\u9a8c\uff0c\u8bba\u8bc1\u4e86\u9ad8\u8d28\u91cf\u6570\u636e\u5bf9\u4e8e\u6a21\u578b\u6027\u80fd\u7684\u51b3\u5b9a\u6027\u4f5c\u7528\u3002</p> <p>\u968f\u540e\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86 LLM \u6570\u636e\u5168\u751f\u547d\u5468\u671f\u7684\u56db\u4e2a\u9636\u6bb5\uff1a\u9884\u8bad\u7ec3\u3001SFT\u3001RLHF \u548c RAG\u3002\u6bcf\u4e2a\u9636\u6bb5\u7684\u6570\u636e\u9700\u6c42\u622a\u7136\u4e0d\u540c\uff0c\u4ece TB \u7ea7\u7684\u65e0\u6807\u7b7e\u6587\u672c\u5230\u6570\u4e07\u6761\u7684\u504f\u597d\u5bf9\u6bd4\u6570\u636e\uff0c\u6570\u636e\u91cf\u9012\u51cf\u4f46\u8d28\u91cf\u8981\u6c42\u9012\u589e\u3002\u7406\u89e3\u8fd9\u4e2a\"\u6f0f\u6597\u6a21\u578b\"\u662f\u89c4\u5212\u6570\u636e\u8d44\u6e90\u7684\u57fa\u7840\u3002</p> <p>\u5728\u6311\u6218\u4e0e\u673a\u9047\u90e8\u5206\uff0c\u6211\u4eec\u5256\u6790\u4e86\u591a\u6a21\u6001\u590d\u6742\u6027\u3001\u7248\u6743\u5408\u89c4\u548c\u7b97\u529b\u6210\u672c\u4e09\u5927\u73b0\u5b9e\u95ee\u9898\uff0c\u540c\u65f6\u4e5f\u770b\u5230\u4e86\u5f00\u6e90\u6570\u636e\u96c6\u3001AI \u539f\u751f\u5de5\u5177\u548c\u5408\u6210\u6570\u636e\u4e09\u5927\u8d8b\u52bf\u5e26\u6765\u7684\u673a\u9047\u3002</p> <p>\u6700\u540e\uff0c\u901a\u8fc7\u6f84\u6e05\u56db\u4e2a\u5e38\u89c1\u8bef\u533a\uff0c\u6211\u4eec\u4e3a\u8bfb\u8005\u5efa\u7acb\u4e86\u6b63\u786e\u7684\u6570\u636e\u5de5\u7a0b\u601d\u7ef4\u6a21\u5f0f\uff1a\u5148\u8d28\u91cf\u540e\u6570\u91cf\u3001\u8fed\u4ee3\u800c\u975e\u4e00\u6b21\u6027\u3001\u5168\u5468\u671f\u7ba1\u7406\u3001\u5f00\u6e90\u6570\u636e\u4e8c\u6b21\u52a0\u5de5\u3002</p> <p></p> <p>\u56fe1-6\uff1a\u7b2c1\u7ae0\u77e5\u8bc6\u7ed3\u6784 \u2014\u2014 \u6db5\u76d6 Scaling Laws\u3001\u6570\u636e\u751f\u547d\u5468\u671f\u3001\u6311\u6218\u4e0e\u673a\u9047\u56db\u5927\u4e3b\u9898</p>"},{"location":"part1/1_1_data_change/#_7","title":"\u5ef6\u4f38\u9605\u8bfb","text":"<p>\u6838\u5fc3\u8bba\u6587</p> <p>Kaplan \u7b49\u4eba\u4e8e 2020 \u5e74\u53d1\u8868\u7684 Scaling Laws for Neural Language Models \u662f\u7406\u89e3\u5927\u6a21\u578b\u8d44\u6e90\u914d\u7f6e\u7684\u5960\u57fa\u4e4b\u4f5c\u3002\u8fd9\u7bc7\u6765\u81ea OpenAI \u7684\u8bba\u6587\u9996\u6b21\u7cfb\u7edf\u6027\u5730\u63ed\u793a\u4e86\u6a21\u578b\u89c4\u6a21\u3001\u6570\u636e\u91cf\u548c\u8ba1\u7b97\u91cf\u4e4b\u95f4\u7684\u5e42\u5f8b\u5173\u7cfb\uff0c\u4e3a\u540e\u7eed\u7684\u5927\u6a21\u578b\u7814\u53d1\u63d0\u4f9b\u4e86\u7406\u8bba\u6307\u5bfc\u3002</p> <p>Hoffmann \u7b49\u4eba\u4e8e 2022 \u5e74\u53d1\u8868\u7684 Training Compute-Optimal Large Language Models\uff08\u5373 Chinchilla \u8bba\u6587\uff09\u6765\u81ea DeepMind\uff0c\u6307\u51fa\u4e86\u4e1a\u754c\u666e\u904d\u5b58\u5728\u7684\"\u8fc7\u5ea6\u53c2\u6570\u5316\"\u95ee\u9898\uff0c\u7ed9\u51fa\u4e86\u8ba1\u7b97\u6700\u4f18\u7684\u6a21\u578b-\u6570\u636e\u914d\u6bd4\u5efa\u8bae\u3002</p> <p>Gunasekar \u7b49\u4eba\u4e8e 2023 \u5e74\u53d1\u8868\u7684 Textbooks Are All You Need \u6765\u81ea\u5fae\u8f6f\u7814\u7a76\u9662\uff0c\u662f Phi \u7cfb\u5217\u7684\u5f00\u5c71\u4e4b\u4f5c\uff0c\u8bc1\u660e\u4e86\u9ad8\u8d28\u91cf\u5408\u6210\u6570\u636e\u53ef\u4ee5\u8ba9\u5c0f\u6a21\u578b\u5ab2\u7f8e\u5927\u6a21\u578b\u7684\u8868\u73b0\u3002</p> <p>\u5f00\u6e90\u6570\u636e\u96c6</p> <p>Penedo \u7b49\u4eba\u53d1\u5e03\u7684 FineWeb \u662f HuggingFace \u5f00\u6e90\u7684\u5927\u89c4\u6a21\u9ad8\u8d28\u91cf\u82f1\u6587\u7f51\u9875\u6570\u636e\u96c6\uff0c\u5305\u542b\u7ea6 15T Token\uff0c\u53ef\u4f5c\u4e3a\u9884\u8bad\u7ec3\u7684\u57fa\u7840\u8bed\u6599\u3002Together AI \u53d1\u5e03\u7684 RedPajama \u662f LLaMA \u8bad\u7ec3\u6570\u636e\u7684\u5f00\u6e90\u590d\u73b0\u7248\u672c\uff0c\u5bf9\u4e8e\u60f3\u8981\u590d\u73b0 LLaMA \u8bad\u7ec3\u8fc7\u7a0b\u7684\u56e2\u961f\u5177\u6709\u91cd\u8981\u53c2\u8003\u4ef7\u503c\u3002</p>"},{"location":"part1/1_1_data_change/#_8","title":"\u4e0b\u4e00\u7ae0\u9884\u544a","text":"<p>\u5728\u4e0b\u4e00\u7ae0\u300a\u6570\u636e\u57fa\u7840\u8bbe\u65bd\u9009\u578b\u300b\u4e2d\uff0c\u6211\u4eec\u5c06\u4ece\u7406\u5ff5\u5c42\u9762\u8fdb\u5165\u5de5\u7a0b\u5c42\u9762\u3002\u4f60\u5c06\u5b66\u4e60\u5982\u4f55\u9009\u62e9\u5408\u9002\u7684\u5b58\u50a8\u65b9\u6848\uff08S3 vs MinIO\uff09\u3001\u8ba1\u7b97\u6846\u67b6\uff08Spark vs Ray\uff09\u3001\u6570\u636e\u683c\u5f0f\uff08Parquet vs JSONL vs WebDataset\uff09\u4ee5\u53ca\u7248\u672c\u63a7\u5236\u5de5\u5177\uff08DVC vs LakeFS\uff09\u3002</p> <p>\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\u8fdb\u5165\u4e0b\u4e00\u7ae0\uff1a\u5728\u8d44\u6e90\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u4f55\u8bbe\u8ba1\u4e00\u5957\u65e2\u80fd\u652f\u6301\u5f53\u524d\u9700\u6c42\u3001\u53c8\u80fd\u5e73\u6ed1\u6269\u5c55\u7684\u6570\u636e\u57fa\u7840\u8bbe\u65bd\uff1f</p>"},{"location":"part1/1_2_data_infra/","title":"\u7b2c2\u7ae0\uff1a\u6570\u636e\u57fa\u7840\u8bbe\u65bd\u9009\u578b","text":""},{"location":"part1/1_2_data_infra/#2ai-rayspark","title":"\u7b2c2\u7ae0\uff1aAI \u539f\u751f\u6570\u636e\u6808\uff08\u5411\u91cf\u5e93\u3001\u5bf9\u8c61\u5b58\u50a8\u3001Ray/Spark \u5206\u5e03\u5f0f\u8ba1\u7b97\uff09","text":""},{"location":"part1/1_2_data_infra/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u5de5\u6b32\u5584\u5176\u4e8b\uff0c\u5fc5\u5148\u5229\u5176\u5668\u3002\u5728\u5904\u7406 TB \u7ea7\u751a\u81f3 PB \u7ea7\u7684 LLM \u8bad\u7ec3\u6570\u636e\u4e4b\u524d\uff0c\u9009\u62e9\u6b63\u786e\u7684\u57fa\u7840\u8bbe\u65bd\u662f\u51b3\u5b9a\u9879\u76ee\u6210\u8d25\u7684\u7b2c\u4e00\u6b65\u3002\u672c\u7ae0\u5c06\u4ece\u5b58\u50a8\u3001\u8ba1\u7b97\u3001\u5411\u91cf\u6570\u636e\u5e93\u3001\u683c\u5f0f\u3001\u7248\u672c\u63a7\u5236\u4e94\u4e2a\u7ef4\u5ea6\uff0c\u7cfb\u7edf\u6027\u5730\u4ecb\u7ecd AI \u539f\u751f\u6570\u636e\u6808\u7684\u6280\u672f\u9009\u578b\u3002\u6b64\u5916\uff0c\u6211\u4eec\u7279\u522b\u5173\u6ce8\u5206\u5e03\u5f0f\u6570\u636e\u5904\u7406\u6846\u67b6\uff08Ray Data\u3001Apache Spark\u3001Dask\uff09\u5728\u5927\u89c4\u6a21 Token \u5904\u7406\u4e2d\u7684\u5e94\u7528\uff0c\u4ee5\u53ca\u9488\u5bf9 GPU \u8bad\u7ec3\u7684 I/O \u74f6\u9888\u4f18\u5316\u7b56\u7565\uff0c\u5e2e\u52a9\u8bfb\u8005\u5efa\u7acb\u4e00\u5957\u9ad8\u6548\u3001\u53ef\u6269\u5c55\u3001\u53ef\u590d\u73b0\u7684\u6570\u636e\u5904\u7406\u5e73\u53f0\u3002</p>"},{"location":"part1/1_2_data_infra/#_2","title":"\u573a\u666f\u5f15\u5165","text":"<p>\u4f60\u521a\u52a0\u5165\u4e00\u5bb6 AI \u521d\u521b\u516c\u53f8\uff0c\u8d1f\u8d23\u642d\u5efa LLM \u9884\u8bad\u7ec3\u6570\u636e\u5904\u7406\u5e73\u53f0\u3002\u56e2\u961f\u7684\u73b0\u72b6\u4ee4\u4eba\u62c5\u5fe7\uff1a\u6570\u636e\u6563\u843d\u5728 50 \u53f0\u673a\u5668\u7684\u672c\u5730\u786c\u76d8\u4e0a\uff0c\u683c\u5f0f\u4e94\u82b1\u516b\u95e8\uff0c\u5305\u62ec <code>.txt</code>\u3001<code>.json</code>\u3001<code>.csv</code>\u3001<code>.parquet</code> \u7b49\u5404\u79cd\u7c7b\u578b\u3002\u6bcf\u6b21\u5904\u7406\u6570\u636e\uff0c\u90fd\u8981\u624b\u52a8\u7f16\u5199 Python \u811a\u672c\uff0c\u5728\u5355\u673a\u4e0a\u8fd0\u884c\u4e09\u5929\u624d\u80fd\u8dd1\u5b8c\u3002\u4e0a\u5468\u6709\u4eba\u4e0d\u5c0f\u5fc3\u8986\u76d6\u4e86\u4e00\u4e2a\u5173\u952e\u6570\u636e\u96c6\uff0c\u800c\u8fd9\u4efd\u6570\u636e\u6ca1\u6709\u4efb\u4f55\u5907\u4efd\u548c\u7248\u672c\u8bb0\u5f55\u3002\u8001\u677f\u95ee\u4f60\uff1a\"\u4e00\u4e2a\u6708\u540e\u6211\u4eec\u8981\u5f00\u59cb\u8bad\u7ec3\uff0c\u6570\u636e\u5e73\u53f0\u80fd\u4e0d\u80fd ready\uff1f\"</p> <p>\u4f60\u9762\u4e34\u7684\u7b2c\u4e00\u4e2a\u51b3\u7b56\u662f\uff1a\u662f\u7528\u56e2\u961f\u719f\u6089\u7684 Spark\uff0c\u8fd8\u662f\u8f6c\u5411\u53f7\u79f0\"AI \u539f\u751f\"\u7684 Ray\uff1f\u662f\u81ea\u5efa MinIO \u96c6\u7fa4\uff0c\u8fd8\u662f\u76f4\u63a5\u4e0a\u4e91\u7528 S3\uff1f\u8fd9\u4e9b\u95ee\u9898\u6ca1\u6709\"\u6807\u51c6\u7b54\u6848\"\uff0c\u4f46\u6709\u660e\u786e\u7684\u51b3\u7b56\u6846\u67b6\u3002\u672c\u7ae0\u5c06\u4e3a\u4f60\u63d0\u4f9b\u8fd9\u4e2a\u6846\u67b6\u3002</p>"},{"location":"part1/1_2_data_infra/#21-modern-data-stack","title":"2.1 \u73b0\u4ee3\u6570\u636e\u6808 (Modern Data Stack)","text":""},{"location":"part1/1_2_data_infra/#211","title":"2.1.1 \u4ec0\u4e48\u662f\u73b0\u4ee3\u6570\u636e\u6808\uff1f","text":"<p>\"\u73b0\u4ee3\u6570\u636e\u6808\"\uff08Modern Data Stack, MDS\uff09\u662f\u8fd1\u5e74\u6765\u6570\u636e\u5de5\u7a0b\u9886\u57df\u7684\u70ed\u95e8\u6982\u5ff5\uff0c\u6307\u7684\u662f\u4e00\u5957\u4e91\u539f\u751f\u3001\u6a21\u5757\u5316\u3001\u89e3\u8026\u5408\u7684\u6570\u636e\u57fa\u7840\u8bbe\u65bd\u7ec4\u5408\u3002\u4e0e\u4f20\u7edf\u7684\u4e00\u4f53\u5316\u6570\u636e\u5e73\u53f0\u76f8\u6bd4\uff0c\u73b0\u4ee3\u6570\u636e\u6808\u7684\u6838\u5fc3\u7406\u5ff5\u662f\u5c06\u5b58\u50a8\u3001\u8ba1\u7b97\u3001\u7f16\u6392\u7b49\u529f\u80fd\u62c6\u5206\u5230\u72ec\u7acb\u7684\u7ec4\u4ef6\u4e2d\uff0c\u6bcf\u4e2a\u7ec4\u4ef6\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u72ec\u7acb\u66ff\u6362\u548c\u6269\u5c55\u3002</p> <p></p> <p>\u56fe2-1\uff1a\u73b0\u4ee3\u6570\u636e\u6808\u67b6\u6784 \u2014\u2014 \u4ece\u5b58\u50a8\u5c42\u5230\u5e94\u7528\u5c42\u76845\u5c42\u89e3\u8026\u67b6\u6784\uff0c\u6bcf\u5c42\u53ef\u72ec\u7acb\u66ff\u6362</p> <p>\u4f20\u7edf\u6570\u636e\u5e73\u53f0\u5f80\u5f80\u90e8\u7f72\u5728\u672c\u5730\u673a\u623f\uff0c\u91c7\u7528\u4e00\u4f53\u5316\u7cfb\u7edf\uff0c\u5b58\u50a8\u4e0e\u8ba1\u7b97\u7d27\u5bc6\u7ed1\u5b9a\u3002\u4ee5 Hadoop \u751f\u6001\u4e3a\u4f8b\uff0cHDFS \u4e0e MapReduce \u7684\u8026\u5408\u4f7f\u5f97\u66f4\u6362\u4efb\u4f55\u4e00\u4e2a\u7ec4\u4ef6\u90fd\u975e\u5e38\u56f0\u96be\u3002\u6570\u636e\u683c\u5f0f\u4e5f\u5e38\u5e38\u662f\u79c1\u6709\u7684\uff0c\u5bfc\u81f4\u4e25\u91cd\u7684\u5382\u5546\u9501\u5b9a\u95ee\u9898\u3002\u6269\u5c55\u65b9\u5f0f\u4ee5\u5782\u76f4\u6269\u5c55\u4e3a\u4e3b\uff0c\u5373\u901a\u8fc7\u8d2d\u4e70\u66f4\u5f3a\u5927\u7684\u5355\u673a\u6765\u63d0\u5347\u6027\u80fd\uff0c\u524d\u671f\u6295\u5165\u6210\u672c\u9ad8\u6602\u3002</p> \u7279\u5f81 \u4f20\u7edf\u65b9\u6848 \u73b0\u4ee3\u6570\u636e\u6808 \u90e8\u7f72\u6a21\u5f0f \u672c\u5730\u673a\u623f\uff0c\u4e00\u4f53\u5316\u7cfb\u7edf \u4e91\u539f\u751f\uff0c\u6309\u9700\u5f39\u6027\u4f38\u7f29 \u7ec4\u4ef6\u8026\u5408 \u5b58\u50a8\u8ba1\u7b97\u7ed1\u5b9a\uff08\u5982 HDFS + MapReduce\uff09 \u5b58\u50a8\u8ba1\u7b97\u5206\u79bb\uff0c\u5404\u5c42\u53ef\u72ec\u7acb\u66ff\u6362 \u6570\u636e\u683c\u5f0f \u79c1\u6709\u683c\u5f0f\u3001\u5382\u5546\u9501\u5b9a \u5f00\u653e\u683c\u5f0f\uff08Parquet\u3001ORC\uff09 \u6269\u5c55\u6027 \u5782\u76f4\u6269\u5c55\u4e3a\u4e3b \u6c34\u5e73\u6269\u5c55\uff0c\u8fd1\u4e4e\u65e0\u9650 \u6210\u672c\u6a21\u5f0f \u56fa\u5b9a\u6295\u5165\uff0c\u524d\u671f\u6210\u672c\u9ad8 \u6309\u7528\u91cf\u4ed8\u8d39\uff0c\u5f39\u6027\u6210\u672c <p>\u73b0\u4ee3\u6570\u636e\u6808\u7684\u51fa\u73b0\u6539\u53d8\u4e86\u8fd9\u4e00\u5c40\u9762\u3002\u4e91\u539f\u751f\u7684\u90e8\u7f72\u6a21\u5f0f\u5141\u8bb8\u6309\u9700\u5f39\u6027\u4f38\u7f29\uff0c\u5b58\u50a8\u4e0e\u8ba1\u7b97\u5b8c\u5168\u5206\u79bb\u4f7f\u5f97\u5404\u5c42\u53ef\u4ee5\u72ec\u7acb\u6f14\u8fdb\u3002\u5f00\u653e\u7684\u6570\u636e\u683c\u5f0f\uff08\u5982 Parquet\u3001ORC\uff09\u6d88\u9664\u4e86\u5382\u5546\u9501\u5b9a\u98ce\u9669\u3002\u6c34\u5e73\u6269\u5c55\u80fd\u529b\u4f7f\u5f97\u7cfb\u7edf\u53ef\u4ee5\u5904\u7406\u8fd1\u4e4e\u65e0\u9650\u7684\u6570\u636e\u91cf\uff0c\u800c\u6309\u7528\u91cf\u4ed8\u8d39\u7684\u6210\u672c\u6a21\u5f0f\u5219\u5927\u5927\u964d\u4f4e\u4e86\u9879\u76ee\u542f\u52a8\u7684\u95e8\u69db\u3002</p>"},{"location":"part1/1_2_data_infra/#212","title":"2.1.2 \u5b58\u50a8\u5c42\uff1a\u5bf9\u8c61\u5b58\u50a8\u4e0e\u6570\u636e\u6e56","text":"<p>\u5bf9\u8c61\u5b58\u50a8\u662f\u73b0\u4ee3\u6570\u636e\u5e73\u53f0\u7684\u4e8b\u5b9e\u6807\u51c6\u5e95\u5ea7\u3002\u65e0\u8bba\u662f AWS S3\u3001Google Cloud Storage\u3001Azure Blob\uff0c\u8fd8\u662f\u5f00\u6e90\u7684 MinIO\uff0c\u5b83\u4eec\u7684\u6838\u5fc3\u7406\u5ff5\u76f8\u540c\uff1a\u91c7\u7528\u6241\u5e73\u5316\u547d\u540d\u7a7a\u95f4\uff0c\u6ca1\u6709\u771f\u6b63\u7684\u76ee\u5f55\u5c42\u7ea7\uff0c\u53ea\u6709 <code>bucket/key</code> \u7684\u4e8c\u5143\u7ed3\u6784\uff1b\u7406\u8bba\u4e0a\u53ef\u5b58\u50a8\u65e0\u9650\u6570\u636e\uff1b\u63d0\u4f9b\u6781\u9ad8\u7684\u6570\u636e\u6301\u4e45\u6027\uff08S3 \u58f0\u79f0\u8fbe\u5230 11 \u4e2a 9\uff0c\u5373 99.999999999%\uff09\uff1b\u6309\u7167\u5b9e\u9645\u4f7f\u7528\u91cf\u8ba1\u8d39\uff0c\u65e0\u9700\u524d\u671f\u5927\u989d\u6295\u5165\u3002</p> <p>\u5728\u5177\u4f53\u9009\u578b\u65f6\uff0c\u9700\u8981\u8003\u8651\u90e8\u7f72\u6a21\u5f0f\u3001\u517c\u5bb9\u6027\u3001\u6210\u672c\u7b49\u591a\u4e2a\u56e0\u7d20\u3002AWS S3 \u662f\u516c\u6709\u4e91\u6258\u7ba1\u7684\u6807\u6746\u4ea7\u54c1\uff0c\u751f\u6001\u6700\u4e3a\u6210\u719f\uff0c\u9002\u5408\u7edd\u5927\u591a\u6570\u751f\u4ea7\u73af\u5883\u3002MinIO \u662f S3 \u517c\u5bb9\u7684\u5f00\u6e90\u66ff\u4ee3\u65b9\u6848\uff0c\u9002\u5408\u6709\u6570\u636e\u5408\u89c4\u8981\u6c42\u9700\u8981\u79c1\u6709\u90e8\u7f72\u7684\u573a\u666f\uff0c\u6216\u7528\u4e8e\u5f00\u53d1\u6d4b\u8bd5\u73af\u5883\u3002Google Cloud Storage \u548c Azure Blob \u5206\u522b\u9002\u5408\u5df2\u7ecf\u6df1\u5ea6\u4f7f\u7528 GCP \u6216 Azure \u751f\u6001\u7684\u7528\u6237\u3002</p> \u7279\u6027 AWS S3 MinIO Google GCS Azure Blob \u90e8\u7f72\u6a21\u5f0f \u516c\u6709\u4e91\u6258\u7ba1 \u81ea\u5efa/\u79c1\u6709\u4e91 \u516c\u6709\u4e91\u6258\u7ba1 \u516c\u6709\u4e91\u6258\u7ba1 S3 \u517c\u5bb9\u6027 \u539f\u751f 100% \u517c\u5bb9 \u9700\u9002\u914d\u5c42 \u9700\u9002\u914d\u5c42 \u51b7\u70ed\u5206\u5c42 Glacier Tiering Nearline/Coldline Cool/Archive \u6700\u4f4e\u6210\u672c $0.023/GB/\u6708 \u786c\u4ef6\u6210\u672c $0.020/GB/\u6708 $0.018/GB/\u6708 \u9002\u7528\u573a\u666f \u751f\u4ea7\u73af\u5883\u9996\u9009 \u79c1\u6709\u90e8\u7f72/\u5f00\u53d1\u6d4b\u8bd5 GCP \u751f\u6001\u7528\u6237 Azure \u751f\u6001\u7528\u6237 <p>\u5bf9\u8c61\u5b58\u50a8\u89e3\u51b3\u4e86\"\u5b58\u50a8\"\u95ee\u9898\uff0c\u4f46\u7f3a\u4e4f\u4e8b\u52a1\u6027\u548c\u5143\u6570\u636e\u7ba1\u7406\u80fd\u529b\u3002\u76f4\u63a5\u5728 S3 \u4e0a\u64cd\u4f5c Parquet \u6587\u4ef6\u4f1a\u9047\u5230\u8bf8\u591a\u56f0\u96be\uff1a\u65e0\u6cd5\u8fdb\u884c ACID \u4e8b\u52a1\uff0c\u5e76\u53d1\u5199\u5165\u53ef\u80fd\u635f\u574f\u6570\u636e\uff1b\u65e0\u6cd5\u9ad8\u6548\u67e5\u8be2\uff0c\u6bcf\u6b21\u90fd\u8981\u626b\u63cf\u6240\u6709\u6587\u4ef6\u7684\u5143\u6570\u636e\uff1b\u65e0\u6cd5\u8fdb\u884c\u65f6\u95f4\u65c5\u884c\uff0c\u4e00\u65e6\u6570\u636e\u88ab\u8986\u76d6\u5c31\u65e0\u6cd5\u56de\u6eda\u5230\u5386\u53f2\u7248\u672c\u3002</p> <p>\u6570\u636e\u6e56\u8868\u683c\u5f0f\uff08Table Format\uff09\u6b63\u662f\u4e3a\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u800c\u751f\u3002\u5b83\u5728\u5bf9\u8c61\u5b58\u50a8\u4e4b\u4e0a\u589e\u52a0\u4e86\u4e00\u5c42\u5143\u6570\u636e\u7ba1\u7406\uff0c\u63d0\u4f9b\u4e86\u6570\u636e\u4ed3\u5e93\u7ea7\u522b\u7684\u80fd\u529b\u3002Apache Iceberg\u3001Apache Hudi \u548c Delta Lake \u662f\u76ee\u524d\u6700\u4e3b\u6d41\u7684\u4e09\u79cd\u6570\u636e\u6e56\u683c\u5f0f\u3002</p> <p></p> <p>\u56fe2-2\uff1a\u6570\u636e\u6e56\u4ed3\u67b6\u6784 \u2014\u2014 \u8868\u683c\u5f0f\u5c42\u63d0\u4f9bACID\u4e8b\u52a1\u3001\u65f6\u95f4\u65c5\u884c\u3001Schema\u6f14\u8fdb\u7b49\u80fd\u529b</p> <p>Apache Iceberg \u7531 Netflix \u5f00\u53d1\u5e76\u8d21\u732e\u7ed9 Apache \u57fa\u91d1\u4f1a\uff0c\u6700\u5927\u7684\u4f18\u52bf\u662f\u5f15\u64ce\u4e2d\u7acb\u6027\u2014\u2014\u5b83\u53ef\u4ee5\u4e0e Spark\u3001Flink\u3001Trino\u3001Dremio\u3001DuckDB \u7b49\u591a\u79cd\u8ba1\u7b97\u5f15\u64ce\u826f\u597d\u914d\u5408\u3002\u5bf9\u4e8e LLM \u6570\u636e\u5de5\u7a0b\u573a\u666f\uff0cIceberg \u662f\u6700\u63a8\u8350\u7684\u9009\u62e9\u3002Apache Hudi \u7531 Uber \u5f00\u53d1\uff0c\u7279\u70b9\u662f\u5bf9\u6d41\u6279\u4e00\u4f53\u548c\u5b9e\u65f6\u66f4\u65b0\u7684\u652f\u6301\u8f83\u597d\uff0c\u5982\u679c\u6709\u5927\u91cf\u5b9e\u65f6\u66f4\u65b0\u9700\u6c42\uff08\u5982 RAG \u77e5\u8bc6\u5e93\u7684\u6301\u7eed\u66f4\u65b0\uff09\uff0c\u53ef\u4ee5\u8003\u8651 Hudi\u3002Delta Lake \u7531 Databricks \u5f00\u53d1\uff0c\u4e0e Spark \u7684\u96c6\u6210\u6700\u4e3a\u7d27\u5bc6\uff0c\u5982\u679c\u5df2\u7ecf\u6df1\u5ea6\u4f7f\u7528 Databricks \u751f\u6001\uff0c\u9009\u62e9 Delta Lake \u53ef\u4ee5\u83b7\u5f97\u6700\u4f73\u4f53\u9a8c\u3002</p> \u7279\u6027 Apache Iceberg Apache Hudi Delta Lake \u80cc\u540e\u5382\u5546 Netflix \u2192 Apache Uber \u2192 Apache Databricks \u5f00\u6e90\u7a0b\u5ea6 \u5b8c\u5168\u5f00\u6e90 \u5b8c\u5168\u5f00\u6e90 \u6838\u5fc3\u5f00\u6e90\uff0c\u90e8\u5206\u529f\u80fd\u5546\u4e1a \u5f15\u64ce\u517c\u5bb9\u6027 Spark, Flink, Trino, DuckDB Spark, Flink, Presto \u4e3b\u8981 Spark \u9002\u7528\u573a\u666f \u591a\u5f15\u64ce\u6df7\u7528\u3001\u5382\u5546\u4e2d\u7acb \u6d41\u6279\u4e00\u4f53\u3001\u5b9e\u65f6\u66f4\u65b0 Databricks \u751f\u6001\u7528\u6237 <p>\u5728\u5b9e\u9645\u9009\u578b\u65f6\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u51b3\u7b56\u6811\u8fdb\u884c\uff1a\u9996\u5148\u5224\u65ad\u6570\u636e\u89c4\u6a21\u662f\u5426\u8d85\u8fc7 100TB\u3002\u5982\u679c\u8d85\u8fc7\uff0c\u8fdb\u4e00\u6b65\u8003\u8651\u662f\u5426\u9700\u8981 ACID \u4e8b\u52a1\u548c\u65f6\u95f4\u65c5\u884c\u80fd\u529b\u2014\u2014\u5982\u679c\u9700\u8981\uff0c\u4e14\u6709\u591a\u5f15\u64ce\u8bbf\u95ee\u9700\u6c42\uff0c\u63a8\u8350 Iceberg + S3\uff1b\u5982\u679c\u53ea\u7528 Spark\uff0c\u53ef\u4ee5\u9009\u62e9 Delta Lake \u6216 Hudi\u3002\u5982\u679c\u4e0d\u9700\u8981 ACID \u80fd\u529b\uff0c\u76f4\u63a5\u4f7f\u7528 S3/MinIO + Parquet \u5373\u53ef\u3002\u5bf9\u4e8e\u6570\u636e\u91cf\u5728 100TB \u4ee5\u4e0b\u7684\u573a\u666f\uff0c\u5982\u679c\u56e2\u961f\u89c4\u6a21\u8f83\u5c0f\uff08\u5c11\u4e8e 5 \u4eba\uff09\uff0c\u672c\u5730\u78c1\u76d8 + Parquet \u8db3\u4ee5\u6ee1\u8db3\u539f\u578b\u9a8c\u8bc1\u9700\u6c42\uff1b\u968f\u7740\u89c4\u6a21\u589e\u957f\uff0c\u518d\u9010\u6b65\u8fc1\u79fb\u5230 S3 + Parquet \u7684\u65b9\u6848\u3002</p> <p></p> <p>\u56fe2-3\uff1a\u5b58\u50a8\u5c42\u9009\u578b\u51b3\u7b56\u6811 \u2014\u2014 \u6839\u636e\u6570\u636e\u89c4\u6a21\u3001ACID\u9700\u6c42\u3001\u591a\u5f15\u64ce\u8bbf\u95ee\u7b49\u56e0\u7d20\u9009\u62e9\u6700\u4f73\u65b9\u6848</p>"},{"location":"part1/1_2_data_infra/#213-spark-vs-ray-data","title":"2.1.3 \u8ba1\u7b97\u5c42\uff1aSpark vs Ray Data","text":"<p>\u8fd9\u662f LLM \u6570\u636e\u5de5\u7a0b\u4e2d\u6700\u5e38\u89c1\u7684\"\u4e8c\u9009\u4e00\"\u96be\u9898\u3002\u4e24\u8005\u90fd\u662f\u5206\u5e03\u5f0f\u8ba1\u7b97\u6846\u67b6\uff0c\u4f46\u8bbe\u8ba1\u54f2\u5b66\u548c\u9002\u7528\u573a\u666f\u622a\u7136\u4e0d\u540c\u3002\u7406\u89e3\u5b83\u4eec\u7684\u5dee\u5f02\uff0c\u5bf9\u4e8e\u505a\u51fa\u6b63\u786e\u7684\u6280\u672f\u9009\u578b\u81f3\u5173\u91cd\u8981\u3002</p> <p>Apache Spark \u8bde\u751f\u4e8e 2009 \u5e74\u7684 Berkeley AMPLab\uff0c\u7ecf\u8fc7\u5341\u4e94\u5e74\u53d1\u5c55\uff0c\u5df2\u6210\u4e3a\u5927\u6570\u636e\u5904\u7406\u7684\"\u745e\u58eb\u519b\u5200\"\u3002Spark \u7684\u6838\u5fc3\u4f18\u52bf\u5728\u4e8e\u5176\u6210\u719f\u7a33\u5b9a\u2014\u2014\u7ecf\u8fc7 PB \u7ea7\u751f\u4ea7\u9a8c\u8bc1\uff0c\u6587\u6863\u548c\u793e\u533a\u8d44\u6e90\u6781\u5176\u4e30\u5bcc\u3002Spark SQL \u7684\u5b58\u5728\u4f7f\u5f97\u6570\u636e\u5206\u6790\u5e08\u4e5f\u80fd\u7f16\u5199\u5206\u5e03\u5f0f\u5904\u7406\u903b\u8f91\uff0c\u964d\u4f4e\u4e86\u4f7f\u7528\u95e8\u69db\u3002Structured Streaming \u652f\u6301\u5b9e\u65f6\u6570\u636e\u5904\u7406\uff0c\u5b9e\u73b0\u4e86\u6d41\u6279\u4e00\u4f53\u3002\u7136\u800c\uff0cSpark \u4e5f\u6709\u660e\u663e\u7684\u52a3\u52bf\uff1a\u7531\u4e8e\u6838\u5fc3\u662f JVM \u5b9e\u73b0\uff0cPython UDF \u9700\u8981\u8de8 JVM-Python \u5e8f\u5217\u5316\uff0c\u6027\u80fd\u635f\u8017\u8f83\u5927\uff1b\u5bf9 GPU \u548c PyTorch/TensorFlow \u7684\u96c6\u6210\u652f\u6301\u8f83\u5f31\uff0c\u4e0d\u591f\"AI \u539f\u751f\"\uff1b\u7b97\u5b50\u4e4b\u95f4\u5fc5\u987b\u7269\u5316\u4e2d\u95f4\u7ed3\u679c\uff0c\u5185\u5b58\u538b\u529b\u8f83\u5927\u3002</p> <p>Ray \u8bde\u751f\u4e8e 2017 \u5e74\u7684 Berkeley RISELab\uff0c\u6700\u521d\u662f\u4e00\u4e2a\u5206\u5e03\u5f0f\u5f3a\u5316\u5b66\u4e60\u6846\u67b6\uff0c\u540e\u6f14\u53d8\u4e3a\u901a\u7528\u7684 AI \u5e94\u7528\u57fa\u7840\u8bbe\u65bd\u3002Ray Data \u662f\u5176\u6570\u636e\u5904\u7406\u6a21\u5757\uff0c\u4e13\u4e3a AI \u5de5\u4f5c\u8d1f\u8f7d\u8bbe\u8ba1\u3002Ray Data \u7684\u6838\u5fc3\u4f18\u52bf\u5728\u4e8e Python \u539f\u751f\u2014\u2014\u6ca1\u6709 JVM \u5f00\u9500\uff0c\u4e0e PyTorch\u3001HuggingFace \u7b49 AI \u751f\u6001\u65e0\u7f1d\u96c6\u6210\u3002\u5b83\u5929\u7136\u652f\u6301\u6d41\u6c34\u7ebf\u5f0f\u6267\u884c\uff0c\u5185\u5b58\u6548\u7387\u9ad8\uff1b\u5185\u7f6e GPU \u8c03\u5ea6\uff0c\u8f7b\u677e\u8c03\u7528 CUDA \u7b97\u5b50\uff1bActor \u6a21\u578b\u9002\u5408\u6709\u72b6\u6001\u7684\u590d\u6742\u5904\u7406\uff0c\u5982\u9700\u8981\u52a0\u8f7d ML \u6a21\u578b\u7684\u63a8\u7406\u4efb\u52a1\u3002\u4e0d\u8fc7\uff0cRay \u76f8\u5bf9\u5e74\u8f7b\uff0c\u6587\u6863\u548c\u6700\u4f73\u5b9e\u8df5\u4e0d\u5982 Spark \u4e30\u5bcc\uff1bSQL \u652f\u6301\u8f83\u5f31\uff0c\u6ca1\u6709 Spark SQL \u90a3\u6837\u6210\u719f\u7684 SQL \u63a5\u53e3\uff1b\u4e0e\u4f20\u7edf\u5927\u6570\u636e\u751f\u6001\uff08Hive\u3001Iceberg\uff09\u7684\u96c6\u6210\u9700\u8981\u989d\u5916\u5de5\u4f5c\u3002</p> \u7ef4\u5ea6 Apache Spark Ray Data \u8bed\u8a00 Scala/Java \u6838\u5fc3\uff0cPython API Python \u539f\u751f \u8fd0\u884c\u65f6 JVM Python (Arrow-based) \u6570\u636e\u62bd\u8c61 DataFrame (\u6279\u5904\u7406\u601d\u7ef4) Dataset (\u6d41\u5904\u7406\u601d\u7ef4) GPU \u652f\u6301 \u9700\u8981 RAPIDS \u63d2\u4ef6 \u539f\u751f\u652f\u6301 PyTorch \u96c6\u6210 \u7e41\u7410 \u4e00\u7b49\u516c\u6c11 SQL \u652f\u6301 \u975e\u5e38\u6210\u719f \u6709\u9650 \u5178\u578b\u7528\u6237 \u4f20\u7edf\u5927\u6570\u636e\u56e2\u961f AI/ML \u56e2\u961f <p>\u4e3a\u4e86\u66f4\u76f4\u89c2\u5730\u7406\u89e3\u4e24\u8005\u7684\u5dee\u5f02\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e2a\u5177\u4f53\u7684\u4ee3\u7801\u5bf9\u6bd4\u3002\u5047\u8bbe\u4efb\u52a1\u662f\uff1a\u8bfb\u53d6 Parquet \u6587\u4ef6\uff0c\u8fc7\u6ee4\u77ed\u6587\u672c\uff0c\u8ba1\u7b97\u6587\u672c\u957f\u5ea6\uff0c\u4fdd\u5b58\u7ed3\u679c\u3002</p> <p>\u4f7f\u7528 Spark \u5b9e\u73b0\uff1a</p> <pre><code>from pyspark.sql import SparkSession\nfrom pyspark.sql.functions import length, col\n\n# \u521d\u59cb\u5316 Spark Session\nspark = SparkSession.builder \\\n    .appName(\"TextFilter\") \\\n    .config(\"spark.executor.memory\", \"8g\") \\\n    .getOrCreate()\n\n# \u8bfb\u53d6 \u2192 \u8fc7\u6ee4 \u2192 \u8ba1\u7b97 \u2192 \u4fdd\u5b58\ndf = spark.read.parquet(\"s3://my-bucket/raw_data/\")\ndf_filtered = df.filter(length(col(\"text\")) &gt; 100) \\\n                .withColumn(\"text_length\", length(col(\"text\")))\ndf_filtered.write.parquet(\"s3://my-bucket/processed_data/\")\n\nspark.stop()\n</code></pre> <p>\u4f7f\u7528 Ray Data \u5b9e\u73b0\uff1a</p> <pre><code>import ray\n\n# \u521d\u59cb\u5316 Ray\uff08\u81ea\u52a8\u68c0\u6d4b\u96c6\u7fa4\u8d44\u6e90\uff09\nray.init()\n\n# \u5b9a\u4e49\u5904\u7406\u51fd\u6570\ndef filter_and_compute(batch):\n    mask = batch[\"text\"].str.len() &gt; 100\n    filtered = batch[mask].copy()\n    filtered[\"text_length\"] = filtered[\"text\"].str.len()\n    return filtered\n\n# \u8bfb\u53d6 \u2192 \u5904\u7406 \u2192 \u4fdd\u5b58\uff08\u6d41\u6c34\u7ebf\u6267\u884c\uff09\nds = ray.data.read_parquet(\"s3://my-bucket/raw_data/\")\nds_processed = ds.map_batches(filter_and_compute, batch_format=\"pandas\")\nds_processed.write_parquet(\"s3://my-bucket/processed_data/\")\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0cSpark \u9700\u8981\u663e\u5f0f\u914d\u7f6e Executor \u5185\u5b58\uff0c\u4f7f\u7528\u58f0\u660e\u5f0f DataFrame API\uff1b\u800c Ray \u81ea\u52a8\u53d1\u73b0\u8d44\u6e90\uff0c\u4f7f\u7528\u51fd\u6570\u5f0f <code>map_batches</code> \u63a5\u53e3\u3002Spark \u4e2d\u7684\u81ea\u5b9a\u4e49\u903b\u8f91\u9700\u8981\u5b9a\u4e49 UDF\uff0c\u5b58\u5728\u5e8f\u5217\u5316\u5f00\u9500\uff1bRay \u4e2d\u76f4\u63a5\u4f7f\u7528\u666e\u901a Python \u51fd\u6570\uff0c\u66f4\u52a0\u81ea\u7136\u3002</p> <p></p> <p>\u56fe2-4\uff1a\u8ba1\u7b97\u6846\u67b6\u9009\u578b\u51b3\u7b56\u6811 \u2014\u2014 Spark\u9002\u5408SQL/ETL\u573a\u666f\uff0cRay\u9002\u5408GPU/ML\u573a\u666f</p> <p>\u5728\u5b9e\u9645\u51b3\u7b56\u65f6\uff0c\u53ef\u4ee5\u6309\u7167\u4ee5\u4e0b\u903b\u8f91\u8fdb\u884c\uff1a\u5982\u679c\u6570\u636e\u5904\u7406\u9700\u8981\u4f7f\u7528 GPU\uff08\u5982\u8c03\u7528 BERT \u6a21\u578b\u8fdb\u884c\u8d28\u91cf\u8bc4\u5206\uff09\uff0cRay Data \u662f\u66f4\u81ea\u7136\u7684\u9009\u62e9\u3002\u5982\u679c\u6709\u5927\u91cf SQL \u548c BI \u67e5\u8be2\u9700\u6c42\uff0cSpark \u7684 SQL \u751f\u6001\u66f4\u4e3a\u6210\u719f\u3002\u5982\u679c\u5df2\u6709\u5927\u91cf Spark \u57fa\u7840\u8bbe\u65bd\u548c\u4ee3\u7801\u8d44\u4ea7\uff0c\u9700\u8981\u8bc4\u4f30\u8fc1\u79fb\u6210\u672c\u2014\u2014\u6210\u672c\u9ad8\u5219\u4fdd\u7559 Spark\uff0c\u6210\u672c\u4f4e\u53ef\u8003\u8651\u9010\u6b65\u5f15\u5165 Ray\u3002\u5982\u679c\u662f\u65b0\u9879\u76ee\uff0c\u56e2\u961f\u80cc\u666f\u662f\u51b3\u5b9a\u6027\u56e0\u7d20\uff1a\u4f20\u7edf\u5927\u6570\u636e\u56e2\u961f\u9009 Spark \u66f4\u5bb9\u6613\u4e0a\u624b\uff0cAI/ML \u56e2\u961f\u9009 Ray \u66f4\u52a0\u987a\u7545\u3002</p> <p>\u503c\u5f97\u4e00\u63d0\u7684\u662f\uff0c\u5728\u5b9e\u9645\u5927\u578b\u9879\u76ee\u4e2d\uff0cSpark \u548c Ray \u5f80\u5f80\u5171\u5b58\u800c\u975e\u4e92\u65a5\u3002\u4e00\u79cd\u5e38\u89c1\u7684\u6df7\u5408\u7b56\u7565\u662f\uff1aSpark \u8d1f\u8d23\u4e0e\u6570\u636e\u6e56/\u6570\u636e\u4ed3\u5e93\u7684\u4ea4\u4e92\uff0c\u5305\u62ec\u8bfb\u5199 Iceberg/Hive \u8868\u3001\u6267\u884c SQL \u5206\u6790\u7b49 ETL \u4efb\u52a1\uff1bRay Data \u8d1f\u8d23 ML \u5bc6\u96c6\u578b\u5904\u7406\uff0c\u5982\u8c03\u7528\u5927\u6a21\u578b\u8fdb\u884c\u63a8\u7406\u3001\u4f7f\u7528 GPU \u8fdb\u884c\u6279\u91cf\u5904\u7406\u3002\u4e24\u8005\u901a\u8fc7\u5171\u4eab\u7684\u5bf9\u8c61\u5b58\u50a8\uff08S3 \u4e0a\u7684 Parquet \u6587\u4ef6\uff09\u8fdb\u884c\u6570\u636e\u4ea4\u6362\uff0c\u5404\u53f8\u5176\u804c\uff0c\u76f8\u5f97\u76ca\u5f70\u3002</p>"},{"location":"part1/1_2_data_infra/#daskpython","title":"Dask\uff1aPython \u539f\u751f\u7684\u7b2c\u4e09\u9009\u62e9","text":"<p>\u9664\u4e86 Spark \u548c Ray\uff0cDask \u662f\u53e6\u4e00\u4e2a\u503c\u5f97\u5173\u6ce8\u7684\u5206\u5e03\u5f0f\u8ba1\u7b97\u6846\u67b6\uff0c\u5c24\u5176\u9002\u5408\u5df2\u6709\u5927\u91cf Pandas/NumPy \u4ee3\u7801\u7684\u56e2\u961f\u3002Dask \u7684\u6838\u5fc3\u7406\u5ff5\u662f\"\u5e76\u884c\u5316 PyData \u751f\u6001\"\u2014\u2014\u5b83\u7684 API \u51e0\u4e4e\u4e0e Pandas/NumPy \u5b8c\u5168\u517c\u5bb9\uff0c\u53ef\u4ee5\u5c06\u5355\u673a\u4ee3\u7801\u4ee5\u6700\u5c0f\u6539\u52a8\u6269\u5c55\u5230\u96c6\u7fa4\u3002</p> <p>Dask \u7684\u6838\u5fc3\u4f18\u52bf\uff1a</p> <ul> <li>\u96f6\u5b66\u4e60\u6210\u672c\uff1a<code>dask.dataframe</code> \u7684 API \u4e0e Pandas \u51e0\u4e4e\u4e00\u81f4\uff0c\u56e2\u961f\u65e0\u9700\u5b66\u4e60\u65b0\u8bed\u6cd5\u3002</li> <li>\u7075\u6d3b\u7684\u8c03\u5ea6\uff1a\u65e2\u53ef\u4ee5\u5728\u5355\u673a\u591a\u6838\u8fd0\u884c\uff08\u66ff\u4ee3 multiprocessing\uff09\uff0c\u4e5f\u53ef\u4ee5\u6269\u5c55\u5230\u5206\u5e03\u5f0f\u96c6\u7fa4\u3002</li> <li>\u4e0e\u79d1\u5b66\u8ba1\u7b97\u751f\u6001\u7684\u96c6\u6210\uff1a\u4e0e scikit-learn\u3001XGBoost \u7b49 ML \u5e93\u6709\u826f\u597d\u7684\u96c6\u6210\u3002</li> <li>\u4f4e\u95e8\u69db\u90e8\u7f72\uff1a\u4e0d\u9700\u8981 JVM\uff08\u4e0d\u50cf Spark\uff09\uff0c\u4e0d\u9700\u8981\u590d\u6742\u7684\u96c6\u7fa4\u7ba1\u7406\uff08\u6bd4 Ray \u7b80\u5355\uff09\u3002</li> </ul> <p>Dask \u7684\u52a3\u52bf\uff1a</p> <ul> <li>\u5927\u89c4\u6a21\u6027\u80fd\u4e0d\u5982 Spark\uff1a\u5728 PB \u7ea7\u6570\u636e\u5904\u7406\u4e0a\uff0cDask \u7684\u4f18\u5316\u5668\u548c shuffle \u6027\u80fd\u4e0d\u5982 Spark \u6210\u719f\u3002</li> <li>\u6ca1\u6709 GPU \u539f\u751f\u652f\u6301\uff1a\u4e0d\u50cf Ray \u90a3\u6837\u5929\u7136\u652f\u6301 GPU \u8c03\u5ea6\uff08\u9700\u8981\u901a\u8fc7 Dask-CUDA \u63d2\u4ef6\uff09\u3002</li> <li>\u793e\u533a\u89c4\u6a21\u8f83\u5c0f\uff1a\u4e0d\u5982 Spark \u548c Ray \u7684\u793e\u533a\u6d3b\u8dc3\u5ea6\u9ad8\u3002</li> </ul> <pre><code>import dask.dataframe as dd\nimport dask\n\n# Dask vs Pandas\uff1a\u51e0\u4e4e\u76f8\u540c\u7684 API\ndef process_with_dask(input_path: str, output_path: str):\n    \"\"\"\u4f7f\u7528 Dask \u8fdb\u884c\u5206\u5e03\u5f0f\u6587\u672c\u5904\u7406\"\"\"\n    # \u8bfb\u53d6\uff08\u81ea\u52a8\u5206\u533a\uff0c\u5ef6\u8fdf\u6267\u884c\uff09\n    ddf = dd.read_parquet(input_path)\n\n    # \u8fc7\u6ee4\u77ed\u6587\u672c\uff08API \u4e0e Pandas \u5b8c\u5168\u4e00\u81f4\uff09\n    ddf_filtered = ddf[ddf['text'].str.len() &gt; 100]\n\n    # \u6dfb\u52a0\u8ba1\u7b97\u5217\n    ddf_filtered = ddf_filtered.assign(\n        text_length=ddf_filtered['text'].str.len()\n    )\n\n    # \u4fdd\u5b58\uff08\u89e6\u53d1\u5b9e\u9645\u8ba1\u7b97\uff09\n    ddf_filtered.to_parquet(output_path)\n\n# \u8fdb\u9636\uff1a\u4f7f\u7528 Dask Bag \u5904\u7406\u975e\u7ed3\u6784\u5316\u6570\u636e\nimport dask.bag as db\n\ndef process_jsonl_with_dask(input_pattern: str):\n    \"\"\"\u4f7f\u7528 Dask Bag \u5904\u7406 JSONL \u6587\u4ef6\"\"\"\n    bag = db.read_text(input_pattern).map(json.loads)\n\n    # \u94fe\u5f0f\u5904\u7406\n    result = (\n        bag\n        .filter(lambda x: len(x.get('text', '')) &gt; 100)\n        .map(lambda x: {**x, 'text_length': len(x['text'])})\n    )\n\n    # \u8f6c\u6362\u4e3a DataFrame \u540e\u4fdd\u5b58\n    result.to_dataframe().to_parquet('output/')\n</code></pre> <p>\u4e09\u5927\u6846\u67b6\u9009\u578b\u603b\u7ed3\uff1a</p> \u7ef4\u5ea6 Apache Spark Ray Data Dask \u6700\u4f73\u573a\u666f SQL/ETL\u3001\u6570\u636e\u6e56 GPU/ML \u63a8\u7406 Pandas \u5e76\u884c\u5316 \u5b66\u4e60\u66f2\u7ebf \u4e2d\u7b49\uff08\u9700\u5b66 Spark API\uff09 \u4e2d\u7b49\uff08\u9700\u5b66 Ray API\uff09 \u6781\u4f4e\uff08Pandas \u7528\u6237\u96f6\u95e8\u69db\uff09 PB \u7ea7\u6027\u80fd \u2b50\u2b50\u2b50 \u2b50\u2b50 \u2b50 GPU \u652f\u6301 \u63d2\u4ef6 \u539f\u751f \u63d2\u4ef6 \u63a8\u8350\u4eba\u7fa4 \u5927\u6570\u636e\u5de5\u7a0b\u5e08 AI/ML \u5de5\u7a0b\u5e08 \u6570\u636e\u79d1\u5b66\u5bb6 <p>\u5bf9\u4e8e LLM \u6570\u636e\u5de5\u7a0b\u7684\u5178\u578b\u573a\u666f\uff08TB \u7ea7\u6587\u672c\u6570\u636e + \u5076\u5c14\u9700\u8981 GPU \u63a8\u7406\uff09\uff0c\u63a8\u8350\u7684\u7ec4\u5408\u662f\uff1aSpark \u7528\u4e8e ETL\uff0cRay \u7528\u4e8e ML \u63a8\u7406\uff0cDask \u7528\u4e8e\u5feb\u901f\u539f\u578b\u9a8c\u8bc1\u548c\u4e2d\u5c0f\u89c4\u6a21\u5904\u7406\u3002</p>"},{"location":"part1/1_2_data_infra/#214","title":"2.1.4 \u5411\u91cf\u6570\u636e\u5e93\u9009\u578b","text":"<p>\u968f\u7740 RAG\uff08\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff09\u548c\u591a\u6a21\u6001\u641c\u7d22\u7684\u666e\u53ca\uff0c\u5411\u91cf\u6570\u636e\u5e93\u5df2\u6210\u4e3a AI \u6570\u636e\u6808\u4e2d\u4e0d\u53ef\u6216\u7f3a\u7684\u7ec4\u4ef6\u3002\u5411\u91cf\u6570\u636e\u5e93\u4e13\u95e8\u7528\u4e8e\u5b58\u50a8\u548c\u68c0\u7d22\u9ad8\u7ef4\u5411\u91cf\uff08Embedding\uff09\uff0c\u662f\u8fde\u63a5\u6570\u636e\u5de5\u7a0b\u4e0e\u6a21\u578b\u63a8\u7406\u7684\u6865\u6881\u3002</p>"},{"location":"part1/1_2_data_infra/#_3","title":"\u6838\u5fc3\u6982\u5ff5","text":"<p>\u5411\u91cf\u6570\u636e\u5e93\u7684\u6838\u5fc3\u64cd\u4f5c\u662f\u8fd1\u4f3c\u6700\u8fd1\u90bb\u641c\u7d22\uff08Approximate Nearest Neighbor, ANN\uff09\u3002\u7ed9\u5b9a\u4e00\u4e2a\u67e5\u8be2\u5411\u91cf \\(q\\)\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u627e\u5230\u4e0e \\(q\\) \u6700\u76f8\u4f3c\u7684 \\(k\\) \u4e2a\u5411\u91cf\u3002\u7cbe\u786e\u641c\u7d22\u5728\u9ad8\u7ef4\u7a7a\u95f4\u4e2d\u8ba1\u7b97\u4ee3\u4ef7\u6781\u9ad8\uff0c\u56e0\u6b64\u5b9e\u9645\u7cfb\u7edf\u5927\u591a\u91c7\u7528\u8fd1\u4f3c\u7b97\u6cd5\uff0c\u5728\u53ec\u56de\u7387\uff08Recall\uff09\u548c\u67e5\u8be2\u541e\u5410\u91cf\uff08QPS\uff09\u4e4b\u95f4\u8fdb\u884c\u6743\u8861\u3002</p> <p>\u4e3b\u6d41\u7684 ANN \u7d22\u5f15\u7b97\u6cd5\u5305\u62ec\uff1a</p> <ul> <li>HNSW\uff08Hierarchical Navigable Small World\uff09\uff1a\u57fa\u4e8e\u56fe\u7ed3\u6784\u7684\u7b97\u6cd5\uff0c\u53ec\u56de\u7387\u9ad8\u3001\u67e5\u8be2\u901f\u5ea6\u5feb\uff0c\u4f46\u5185\u5b58\u5360\u7528\u5927\u3002\u9002\u5408\u5bf9\u53ec\u56de\u7387\u8981\u6c42\u6781\u9ad8\u7684\u573a\u666f\u3002</li> <li>IVF\uff08Inverted File Index\uff09\uff1a\u57fa\u4e8e\u805a\u7c7b\u7684\u7b97\u6cd5\uff0c\u5c06\u5411\u91cf\u7a7a\u95f4\u5212\u5206\u4e3a\u591a\u4e2a Voronoi \u533a\u57df\uff0c\u67e5\u8be2\u65f6\u53ea\u641c\u7d22\u6700\u8fd1\u7684\u51e0\u4e2a\u533a\u57df\u3002\u5185\u5b58\u6548\u7387\u597d\uff0c\u9002\u5408\u5927\u89c4\u6a21\u6570\u636e\u3002</li> <li>ScaNN\uff08Scalable Nearest Neighbors\uff09\uff1aGoogle \u5f00\u53d1\u7684\u7b97\u6cd5\uff0c\u7ed3\u5408\u91cf\u5316\u548c\u526a\u679d\u6280\u672f\uff0c\u5728 QPS \u548c Recall \u4e4b\u95f4\u53d6\u5f97\u4f18\u5f02\u5e73\u8861\u3002</li> </ul>"},{"location":"part1/1_2_data_infra/#_4","title":"\u4e3b\u6d41\u5411\u91cf\u6570\u636e\u5e93\u5bf9\u6bd4","text":"\u7279\u6027 Milvus Qdrant Weaviate Pinecone FAISS \u90e8\u7f72\u6a21\u5f0f \u81ea\u5efa/\u4e91 \u81ea\u5efa/\u4e91 \u81ea\u5efa/\u4e91 \u7eaf SaaS \u5e93\uff08\u975e\u6570\u636e\u5e93\uff09 \u5f00\u6e90 \u662f \u662f \u662f \u5426 \u662f \u7d22\u5f15\u7b97\u6cd5 HNSW, IVF, DiskANN HNSW HNSW \u81ea\u7814 HNSW, IVF, PQ \u5206\u5e03\u5f0f \u539f\u751f\u652f\u6301 \u652f\u6301 \u652f\u6301 \u6258\u7ba1 \u624b\u52a8\u5206\u7247 \u6df7\u5408\u641c\u7d22 \u652f\u6301 \u652f\u6301 \u652f\u6301 \u652f\u6301 \u4e0d\u652f\u6301 \u6807\u91cf\u8fc7\u6ee4 \u9ad8\u6548 \u9ad8\u6548 \u9ad8\u6548 \u9ad8\u6548 \u9700\u540e\u5904\u7406 \u9002\u7528\u573a\u666f \u5927\u89c4\u6a21\u751f\u4ea7 \u4e2d\u5c0f\u89c4\u6a21\u3001\u9ad8\u6027\u80fd \u5168\u6808\u8bed\u4e49\u641c\u7d22 \u5feb\u901f\u4e0a\u624b\u3001\u65e0\u8fd0\u7ef4 \u7814\u7a76\u539f\u578b <p>\u9009\u578b\u51b3\u7b56\u8981\u70b9\uff1a</p> <ul> <li>QPS vs Recall \u6743\u8861\uff1a\u5bf9\u4e8e\u9884\u8bad\u7ec3\u6570\u636e\u53bb\u91cd\uff0c\u9700\u8981\u9ad8 Recall\uff08&gt;0.99\uff09\u4f46\u53ef\u4ee5\u5bb9\u5fcd\u8f83\u4f4e QPS\uff1b\u5bf9\u4e8e\u5728\u7ebf RAG \u68c0\u7d22\uff0c\u9700\u8981\u9ad8 QPS\uff08&gt;1000\uff09\u4f46\u53ef\u4ee5\u63a5\u53d7\u7565\u4f4e\u7684 Recall\u3002</li> <li>\u6570\u636e\u89c4\u6a21\uff1a\u767e\u4e07\u7ea7\u5411\u91cf\u4ee5\u4e0b\uff0cQdrant \u6216 FAISS \u5373\u53ef\uff1b\u5343\u4e07\u81f3\u4ebf\u7ea7\u5411\u91cf\uff0cMilvus \u7684\u5206\u5e03\u5f0f\u67b6\u6784\u66f4\u6709\u4f18\u52bf\u3002</li> <li>\u8fd0\u7ef4\u80fd\u529b\uff1a\u5982\u679c\u56e2\u961f\u6ca1\u6709\u8fd0\u7ef4\u7ecf\u9a8c\uff0cPinecone \u7684\u5168\u6258\u7ba1\u6a21\u5f0f\u662f\u6700\u4f4e\u98ce\u9669\u9009\u62e9\u3002</li> </ul> <pre><code># \u4f7f\u7528 Milvus \u8fdb\u884c\u5411\u91cf\u68c0\u7d22\u793a\u4f8b\nfrom pymilvus import connections, Collection, FieldSchema, CollectionSchema, DataType, utility\n\n# \u8fde\u63a5 Milvus\nconnections.connect(\"default\", host=\"localhost\", port=\"19530\")\n\n# \u5b9a\u4e49 Schema\nfields = [\n    FieldSchema(name=\"id\", dtype=DataType.VARCHAR, is_primary=True, max_length=64),\n    FieldSchema(name=\"text\", dtype=DataType.VARCHAR, max_length=65535),\n    FieldSchema(name=\"embedding\", dtype=DataType.FLOAT_VECTOR, dim=768)\n]\nschema = CollectionSchema(fields, description=\"Document embeddings\")\n\n# \u521b\u5efa Collection\ncollection = Collection(\"documents\", schema)\n\n# \u521b\u5efa HNSW \u7d22\u5f15\uff08\u9ad8\u53ec\u56de\u7387\u914d\u7f6e\uff09\nindex_params = {\n    \"metric_type\": \"COSINE\",\n    \"index_type\": \"HNSW\",\n    \"params\": {\n        \"M\": 16,               # \u6bcf\u4e2a\u8282\u70b9\u7684\u8fde\u63a5\u6570\uff0c\u8d8a\u5927\u53ec\u56de\u8d8a\u9ad8\u4f46\u5185\u5b58\u8d8a\u5927\n        \"efConstruction\": 256  # \u6784\u5efa\u65f6\u7684\u641c\u7d22\u5bbd\u5ea6\n    }\n}\ncollection.create_index(\"embedding\", index_params)\n\n# \u641c\u7d22\ncollection.load()\nresults = collection.search(\n    data=[query_embedding],\n    anns_field=\"embedding\",\n    param={\"metric_type\": \"COSINE\", \"params\": {\"ef\": 128}},\n    limit=10,\n    output_fields=[\"text\"]\n)\n</code></pre>"},{"location":"part1/1_2_data_infra/#_5","title":"\u5bf9\u8c61\u5b58\u50a8\u7684\u9ad8\u541e\u5410\u8bfb\u53d6\u4f18\u5316","text":"<p>\u5728 GPU \u8bad\u7ec3\u573a\u666f\u4e0b\uff0c\u6570\u636e\u52a0\u8f7d\u901f\u5ea6\u5f80\u5f80\u6210\u4e3a\u74f6\u9888\u3002\u5f53\u8bad\u7ec3\u6570\u636e\u5b58\u50a8\u5728 S3/MinIO \u4e0a\u65f6\uff0c\u7f51\u7edc I/O \u5ef6\u8fdf\u548c\u541e\u5410\u4e0a\u9650\u53ef\u80fd\u5bfc\u81f4 GPU \u5904\u4e8e\"\u9965\u997f\"\u72b6\u6001\u2014\u2014\u8ba1\u7b97\u5355\u5143\u7b49\u5f85\u6570\u636e\u5230\u8fbe\u3002\u4ee5\u4e0b\u662f\u51e0\u4e2a\u5173\u952e\u4f18\u5316\u7b56\u7565\uff1a</p> <p>\u9884\u53d6\u4e0e\u6d41\u6c34\u7ebf\u5316\uff1a\u5728 GPU \u5904\u7406\u5f53\u524d batch \u7684\u540c\u65f6\uff0cCPU \u9884\u53d6\u4e0b\u4e00\u4e2a batch \u7684\u6570\u636e\uff0c\u5b9e\u73b0\u8ba1\u7b97\u4e0e I/O \u7684\u91cd\u53e0\u3002</p> <p>\u672c\u5730 SSD \u7f13\u5b58\uff1a\u5c06\u9891\u7e41\u8bbf\u95ee\u7684\u70ed\u6570\u636e\u7f13\u5b58\u5230\u672c\u5730 NVMe SSD\uff0c\u9996\u6b21\u8bfb\u53d6\u4ece S3 \u62c9\u53d6\uff0c\u540e\u7eed\u8bfb\u53d6\u76f4\u63a5\u547d\u4e2d\u672c\u5730\u7f13\u5b58\u3002\u5de5\u5177\u5982 Alluxio\u3001JuiceFS \u53ef\u4ee5\u63d0\u4f9b\u900f\u660e\u7684\u7f13\u5b58\u5c42\u3002</p> <p>\u591a\u7ebf\u7a0b\u5e76\u53d1\u8bfb\u53d6\uff1aS3 \u652f\u6301\u5206\u6bb5\u4e0b\u8f7d\uff08Range Request\uff09\uff0c\u53ef\u4ee5\u5bf9\u5355\u4e2a\u5927\u6587\u4ef6\u53d1\u8d77\u591a\u4e2a\u5e76\u53d1\u5206\u6bb5\u8bf7\u6c42\uff0c\u5145\u5206\u5229\u7528\u7f51\u7edc\u5e26\u5bbd\u3002</p> <p>\u6570\u636e\u683c\u5f0f\u4f18\u5316\uff1a\u4f7f\u7528\u5217\u5f0f\u683c\u5f0f\uff08\u5982 Parquet\uff09\u914d\u5408\u5217\u88c1\u526a\uff0c\u53ea\u52a0\u8f7d\u8bad\u7ec3\u6240\u9700\u7684\u5217\uff1b\u4f7f\u7528 Arrow IPC \u683c\u5f0f\u5b9e\u73b0\u96f6\u62f7\u8d1d\u8bfb\u53d6\u3002</p> <pre><code>import ray\nimport s3fs\n\ndef optimized_data_loading(s3_path: str, num_workers: int = 8):\n    \"\"\"\u4f18\u5316\u7684 S3 \u6570\u636e\u52a0\u8f7d\uff0c\u5229\u7528 Ray \u5b9e\u73b0\u5e76\u884c\u9884\u53d6\"\"\"\n\n    # \u4f7f\u7528 Ray Data \u7684\u6d41\u5f0f\u8bfb\u53d6\uff0c\u81ea\u52a8\u7ba1\u7406\u9884\u53d6\u548c\u5e76\u884c\u5ea6\n    ds = ray.data.read_parquet(\n        s3_path,\n        parallelism=num_workers * 4,  # \u9884\u53d6\u500d\u6570\n        columns=[\"input_ids\", \"attention_mask\"],  # \u5217\u88c1\u526a\n    )\n\n    # \u6d41\u6c34\u7ebf\u5316\uff1a\u8fb9\u8bfb\u53d6\u8fb9\u5904\u7406\n    pipe = ds.iter_batches(\n        batch_size=1024,\n        prefetch_batches=4,  # \u9884\u53d6 4 \u4e2a batch\n        local_shuffle_buffer_size=10000  # \u672c\u5730 shuffle\n    )\n\n    return pipe\n</code></pre>"},{"location":"part1/1_2_data_infra/#22-io","title":"2.2 \u6570\u636e\u683c\u5f0f\u4e0e I/O \u4f18\u5316","text":"<p>\u9009\u5bf9\u4e86\u5b58\u50a8\u548c\u8ba1\u7b97\uff0c\u63a5\u4e0b\u6765\u8981\u9009\u62e9\u6570\u636e\u7684\u5e8f\u5217\u5316\u683c\u5f0f\u3002\u683c\u5f0f\u9009\u62e9\u770b\u4f3c\u662f\u4e00\u4e2a\u6280\u672f\u7ec6\u8282\uff0c\u5b9e\u9645\u4e0a\u76f4\u63a5\u5f71\u54cd\u5b58\u50a8\u6210\u672c\u3001\u8bfb\u53d6\u901f\u5ea6\u548c\u5de5\u5177\u517c\u5bb9\u6027\u3002\u4e0d\u540c\u683c\u5f0f\u7684\u538b\u7f29\u7387\u5dee\u5f02\u53ef\u8fbe\u5341\u500d\u4e4b\u591a\uff0c\u5217\u5f0f\u4e0e\u884c\u5f0f\u683c\u5f0f\u7684\u67e5\u8be2\u6027\u80fd\u5dee\u5f02\u540c\u6837\u5de8\u5927\uff0c\u800c\u4e14\u5e76\u975e\u6240\u6709\u6846\u67b6\u90fd\u652f\u6301\u6240\u6709\u683c\u5f0f\u3002</p>"},{"location":"part1/1_2_data_infra/#221","title":"2.2.1 \u4e3b\u6d41\u6570\u636e\u683c\u5f0f\u5bf9\u6bd4","text":"<p>Parquet \u662f\u76ee\u524d\u5927\u89c4\u6a21\u7ed3\u6784\u5316\u6570\u636e\u7684\u4e8b\u5b9e\u6807\u51c6\u3002\u5b83\u91c7\u7528\u5217\u5f0f\u5b58\u50a8\uff0c\u76f8\u540c\u5217\u7684\u6570\u636e\u7269\u7406\u4e0a\u8fde\u7eed\u5b58\u653e\uff0c\u8fd9\u5e26\u6765\u4e24\u4e2a\u663e\u8457\u4f18\u52bf\uff1a\u4e00\u662f\u5229\u4e8e\u538b\u7f29\uff0c\u76f8\u540c\u7c7b\u578b\u7684\u6570\u636e\u805a\u96c6\u5728\u4e00\u8d77\u53ef\u4ee5\u83b7\u5f97\u66f4\u9ad8\u7684\u538b\u7f29\u7387\uff1b\u4e8c\u662f\u5229\u4e8e\u5411\u91cf\u5316\u8bfb\u53d6\uff0c\u67e5\u8be2\u7279\u5b9a\u5217\u65f6\u65e0\u9700\u626b\u63cf\u6574\u4e2a\u6587\u4ef6\u3002Parquet \u6587\u4ef6\u662f\u81ea\u63cf\u8ff0\u7684\uff0cSchema \u5d4c\u5165\u5728\u6587\u4ef6\u4e2d\uff0c\u65e0\u9700\u5916\u90e8\u5143\u6570\u636e\u5b9a\u4e49\u3002\u5b83\u8fd8\u652f\u6301\u5d4c\u5957\u7c7b\u578b\uff0c\u53ef\u4ee5\u5b58\u50a8\u7c7b\u4f3c JSON \u7684\u590d\u6742\u7ed3\u6784\uff0c\u5e76\u4e14\u5929\u7136\u652f\u6301\u76ee\u5f55\u5206\u533a\u3002Parquet \u662f\u9884\u8bad\u7ec3\u8bed\u6599\u5b58\u50a8\u7684\u9996\u9009\u683c\u5f0f\uff0c\u7279\u522b\u662f\u9700\u8981\u6309\u5217\u8fc7\u6ee4\u7684\u5206\u6790\u67e5\u8be2\u573a\u666f\uff0c\u4e0e Spark\u3001DuckDB\u3001Pandas \u7b49\u5de5\u5177\u90fd\u80fd\u826f\u597d\u914d\u5408\u3002</p> <p>JSONL\uff08JSON Lines\uff09\u662f\u53e6\u4e00\u79cd\u5e38\u89c1\u683c\u5f0f\uff0c\u6bcf\u884c\u662f\u4e00\u4e2a\u72ec\u7acb\u7684 JSON \u5bf9\u8c61\u3002\u5b83\u7684\u6700\u5927\u4f18\u52bf\u662f\u4eba\u7c7b\u53ef\u8bfb\u2014\u2014\u53ef\u4ee5\u7528 <code>head</code>\u3001<code>cat</code> \u7b49\u547d\u4ee4\u76f4\u63a5\u67e5\u770b\u5185\u5bb9\u3002\u540c\u65f6\u5b83\u652f\u6301\u6d41\u5f0f\u5904\u7406\uff0c\u53ef\u4ee5\u9010\u884c\u8bfb\u53d6\u800c\u65e0\u9700\u52a0\u8f7d\u6574\u4e2a\u6587\u4ef6\u5230\u5185\u5b58\u3002Schema \u975e\u5e38\u7075\u6d3b\uff0c\u6bcf\u884c\u53ef\u4ee5\u6709\u4e0d\u540c\u7684\u5b57\u6bb5\u7ed3\u6784\u3002JSONL \u7279\u522b\u9002\u5408 SFT \u6307\u4ee4\u6570\u636e\uff0c\u56e0\u4e3a\u8fd9\u7c7b\u6570\u636e\u9700\u8981\u9891\u7e41\u4eba\u5de5\u67e5\u770b\u548c\u7f16\u8f91\u3002\u5b83\u4e5f\u5e38\u7528\u4e8e\u6570\u636e\u4ea4\u6362\u548c\u5c0f\u89c4\u6a21\u6570\u636e\u96c6\uff0810GB \u4ee5\u4e0b\uff09\u3002\u7136\u800c\uff0cJSONL \u7684\u52a3\u52bf\u4e5f\u5f88\u660e\u663e\uff1a\u65e0\u538b\u7f29\u65f6\u4f53\u79ef\u662f Parquet \u7684\u4e09\u5230\u4e94\u500d\uff0c\u8bfb\u53d6\u901f\u5ea6\u8f83\u6162\uff08\u9700\u8981\u89e3\u6790\u6bcf\u4e00\u884c\u7684 JSON \u5b57\u7b26\u4e32\uff09\u3002</p> <p>WebDataset \u662f NVIDIA \u4e3b\u5bfc\u5f00\u53d1\u7684\u683c\u5f0f\uff0c\u4e13\u4e3a\u56fe\u6587\u3001\u89c6\u9891\u7b49\u591a\u6a21\u6001\u6570\u636e\u8bbe\u8ba1\u3002\u5b83\u7684\u6838\u5fc3\u601d\u60f3\u662f\u5c06\u76f8\u5173\u6587\u4ef6\uff08\u5982\u4e00\u5f20\u56fe\u7247\u548c\u5bf9\u5e94\u7684\u63cf\u8ff0\u6587\u672c\uff09\u6253\u5305\u6210 TAR \u5f52\u6863\u3002\u8fd9\u79cd\u8bbe\u8ba1\u652f\u6301\u6d41\u5f0f\u8bfb\u53d6\uff0c\u65e0\u9700\u89e3\u538b\u5373\u53ef\u987a\u5e8f\u8bfb\u53d6\u5185\u5bb9\uff1b\u540c\u65f6\u5bf9\u5206\u5e03\u5f0f\u5904\u7406\u975e\u5e38\u53cb\u597d\uff0c\u6bcf\u4e2a TAR \u662f\u72ec\u7acb\u7684\u6570\u636e\u5206\u7247\u3002WebDataset \u662f LAION \u98ce\u683c\u56fe\u6587\u5bf9\u6570\u636e\u96c6\u548c\u89c6\u9891\u6570\u636e\u96c6\u7684\u6700\u4f73\u9009\u62e9\uff0c\u9002\u7528\u4e8e\u4efb\u4f55\u9700\u8981\u591a\u6587\u4ef6\u5173\u8054\u7684\u591a\u6a21\u6001\u6570\u636e\u3002</p> \u7279\u6027 Parquet JSONL WebDataset \u5b58\u50a8\u6548\u7387 \u9ad8\uff08\u5217\u5f0f\u538b\u7f29\uff09 \u4f4e\uff08\u6587\u672c\u5197\u4f59\u5927\uff09 \u4e2d\uff08\u65e0\u538b\u7f29\u4f46\u7d27\u51d1\uff09 \u8bfb\u53d6\u901f\u5ea6 \u5feb\uff08\u5411\u91cf\u5316\uff09 \u6162\uff08\u9010\u884c\u89e3\u6790\uff09 \u4e2d\uff08\u987a\u5e8f\u8bfb\u53d6\uff09 \u4eba\u7c7b\u53ef\u8bfb \u5426 \u662f \u5426 \u591a\u6a21\u6001\u652f\u6301 \u5f31\uff08\u9700\u7f16\u7801\uff09 \u5f31 \u5f3a\uff08\u539f\u751f\u652f\u6301\uff09 \u5178\u578b\u7528\u4f8b \u9884\u8bad\u7ec3\u6587\u672c\u8bed\u6599 SFT \u6307\u4ee4\u6570\u636e \u56fe\u6587\u5bf9\u3001\u89c6\u9891\u6570\u636e"},{"location":"part1/1_2_data_infra/#222","title":"2.2.2 \u538b\u7f29\u7b97\u6cd5\u9009\u578b","text":"<p>\u65e0\u8bba\u9009\u62e9\u4f55\u79cd\u683c\u5f0f\uff0c\u538b\u7f29\u7b97\u6cd5\u90fd\u4f1a\u663e\u8457\u5f71\u54cd\u5b58\u50a8\u6210\u672c\u548c\u8bfb\u53d6\u901f\u5ea6\u3002\u6b63\u786e\u7684\u538b\u7f29\u7b56\u7565\u9700\u8981\u5728\u7a7a\u95f4\u6548\u7387\u548c\u65f6\u95f4\u6548\u7387\u4e4b\u95f4\u627e\u5230\u5e73\u8861\u3002</p> <p>Snappy \u662f\u6700\u5e38\u7528\u7684\u9ed8\u8ba4\u9009\u62e9\u3002\u5b83\u7684\u538b\u7f29\u7387\u4e2d\u7b49\uff0c\u4f46\u538b\u7f29\u548c\u89e3\u538b\u901f\u5ea6\u90fd\u5f88\u5feb\uff0c\u9002\u5408\u8bfb\u5199\u5747\u8861\u7684\u573a\u666f\u3002LZ4 \u8ffd\u6c42\u6781\u81f4\u7684\u8bfb\u53d6\u901f\u5ea6\uff0c\u89e3\u538b\u6027\u80fd\u751a\u81f3\u6bd4 Snappy \u66f4\u5feb\uff0c\u538b\u7f29\u7387\u7565\u4f4e\uff0c\u9002\u5408\u5bf9\u8bfb\u53d6\u5ef6\u8fdf\u654f\u611f\u7684\u573a\u666f\u3002Zstandard\uff08ZSTD\uff09\u63d0\u4f9b\u6700\u9ad8\u7684\u538b\u7f29\u7387\uff0c\u5c24\u5176\u662f\u9ad8\u7ea7\u522b\uff08\u5982 level 19\uff09\u65f6\uff0c\u4f46\u538b\u7f29\u901f\u5ea6\u8f83\u6162\uff0c\u9002\u5408\u5b58\u50a8\u6210\u672c\u654f\u611f\u7684\u5f52\u6863\u573a\u666f\u3002Gzip \u662f\u517c\u5bb9\u6027\u6700\u597d\u7684\u9009\u62e9\uff0c\u51e0\u4e4e\u6240\u6709\u5de5\u5177\u90fd\u652f\u6301\uff0c\u9002\u5408\u9700\u8981\u4e0e\u5916\u90e8\u7cfb\u7edf\u4ea4\u6362\u6570\u636e\u7684\u573a\u666f\u3002</p> \u7b97\u6cd5 \u538b\u7f29\u7387 \u538b\u7f29\u901f\u5ea6 \u89e3\u538b\u901f\u5ea6 \u9002\u7528\u573a\u666f Snappy \u4e2d\u7b49 \u5feb \u5feb \u9ed8\u8ba4\u9009\u62e9\uff0c\u8bfb\u5199\u5747\u8861 LZ4 \u8f83\u4f4e \u6781\u5feb \u6781\u5feb \u6781\u81f4\u8bfb\u53d6\u901f\u5ea6 ZSTD \u9ad8 \u4e2d\u7b49 \u5feb \u5b58\u50a8\u6210\u672c\u654f\u611f Gzip \u9ad8 \u6162 \u4e2d\u7b49 \u517c\u5bb9\u6027\u8981\u6c42\u9ad8 <p>\u5728\u5b9e\u8df5\u4e2d\uff0c\u53ef\u4ee5\u91c7\u7528\u5206\u5c42\u7b56\u7565\uff1a\u51b7\u6570\u636e\uff08\u5f52\u6863\u5b58\u50a8\uff0c\u957f\u671f\u4e0d\u8bfb\u53d6\uff09\u4f7f\u7528 ZSTD level 19 \u4ee5\u83b7\u5f97\u6700\u5927\u538b\u7f29\u7387\uff1b\u70ed\u6570\u636e\uff08\u9891\u7e41\u8bfb\u53d6\u5904\u7406\uff09\u4f7f\u7528 Snappy \u6216 LZ4 \u4ee5\u51cf\u5c11\u89e3\u538b\u5f00\u9500\uff1b\u7f51\u7edc\u4f20\u8f93\u573a\u666f\u4f7f\u7528 ZSTD level 3\uff0c\u5728\u538b\u7f29\u7387\u548c\u901f\u5ea6\u4e4b\u95f4\u53d6\u5f97\u5e73\u8861\u3002</p>"},{"location":"part1/1_2_data_infra/#223-io","title":"2.2.3 I/O \u4f18\u5316\u5b9e\u6218\u6280\u5de7","text":"<p>\u5728\u5927\u89c4\u6a21\u6570\u636e\u5904\u7406\u4e2d\uff0cI/O \u5f80\u5f80\u662f\u6027\u80fd\u74f6\u9888\u3002\u4ee5\u4e0b\u4e09\u4e2a\u6280\u5de7\u53ef\u4ee5\u663e\u8457\u63d0\u5347 I/O \u6548\u7387\u3002</p> <p>\u5408\u7406\u8bbe\u7f6e\u6587\u4ef6\u5927\u5c0f\u662f\u7b2c\u4e00\u4e2a\u5173\u952e\u70b9\u3002\u5e38\u89c1\u7684\u9519\u8bef\u662f\u751f\u6210\u5927\u91cf\u5c0f\u6587\u4ef6\u2014\u2014\u4f8b\u5982 10 \u4e07\u4e2a 1MB \u7684\u6587\u4ef6\u3002\u8fd9\u4f1a\u5bfc\u81f4\u5143\u6570\u636e\u5f00\u9500\u5de8\u5927\uff0cS3 \u7684 ListObjects \u64cd\u4f5c\u53d8\u5f97\u6781\u6162\u3002\u6b63\u786e\u7684\u505a\u6cd5\u662f\u5c06\u6570\u636e\u5408\u5e76\u6210\u5c11\u91cf\u5927\u6587\u4ef6\uff0c\u6bcf\u4e2a Parquet \u6587\u4ef6\u7684\u5927\u5c0f\u5e94\u5728 128MB \u5230 1GB \u4e4b\u95f4\u3002\u592a\u5c0f\u4f1a\u5bfc\u81f4\u5143\u6570\u636e\u81a8\u80c0\u548c\u5e76\u884c\u5ea6\u4e0d\u8db3\uff0c\u592a\u5927\u4f1a\u5f71\u54cd\u4efb\u52a1\u7684\u8d1f\u8f7d\u5747\u8861\u3002</p> <pre><code># \u9519\u8bef\uff1a\u751f\u6210\u5927\u91cf\u5c0f\u6587\u4ef6\ndf.write.parquet(\"s3://bucket/data/\", maxRecordsPerFile=1000)\n\n# \u6b63\u786e\uff1a\u751f\u6210\u5c11\u91cf\u5927\u6587\u4ef6\uff08\u63a8\u8350 128MB - 1GB\uff09\ndf.coalesce(100).write.parquet(\"s3://bucket/data/\")\n</code></pre> <p>\u5206\u533a\u88c1\u526a\uff08Partition Pruning\uff09\u662f\u7b2c\u4e8c\u4e2a\u91cd\u8981\u6280\u5de7\u3002\u901a\u8fc7\u5728\u5199\u5165\u65f6\u6309\u7279\u5b9a\u5217\u8fdb\u884c\u5206\u533a\uff0c\u8bfb\u53d6\u65f6\u53ef\u4ee5\u53ea\u626b\u63cf\u9700\u8981\u7684\u5206\u533a\uff0c\u907f\u514d\u5168\u8868\u626b\u63cf\u3002\u5206\u533a\u5217\u5e94\u9009\u62e9\u4f4e\u57fa\u6570\uff08Cardinality\uff09\u7684\u5217\uff0c\u5982\u65e5\u671f\u3001\u8bed\u8a00\u3001\u6570\u636e\u6765\u6e90\uff1b\u5e94\u907f\u514d\u9ad8\u57fa\u6570\u5217\uff08\u5982\u7528\u6237 ID\uff09\uff0c\u5426\u5219\u4f1a\u4ea7\u751f\u6d77\u91cf\u5c0f\u76ee\u5f55\u3002</p> <pre><code># \u5199\u5165\u65f6\u6309\u65e5\u671f\u5206\u533a\ndf.write.partitionBy(\"date\").parquet(\"s3://bucket/data/\")\n\n# \u8bfb\u53d6\u65f6\u53ea\u626b\u63cf\u9700\u8981\u7684\u5206\u533a\nspark.read.parquet(\"s3://bucket/data/date=2024-01-01/\")\n</code></pre> <p>\u5217\u88c1\u526a\uff08Column Pruning\uff09\u662f\u7b2c\u4e09\u4e2a\u6280\u5de7\u3002\u5217\u5f0f\u5b58\u50a8\u7684\u6700\u5927\u4f18\u52bf\u5c31\u662f\u53ea\u8bfb\u53d6\u9700\u8981\u7684\u5217\u3002\u786e\u4fdd\u5728\u67e5\u8be2\u8bed\u53e5\u4e2d\u5c3d\u65e9\u8fdb\u884c\u5217\u9009\u62e9\uff0c\u907f\u514d\u5148\u8bfb\u53d6\u5168\u90e8\u5217\u518d\u8fc7\u6ee4\u3002</p> <pre><code># \u9519\u8bef\uff1a\u8bfb\u53d6\u5168\u90e8\u5217\ndf = spark.read.parquet(\"s3://bucket/data/\")  # \u5982\u679c\u6709 100 \u5217\uff0c\u5168\u90e8\u52a0\u8f7d\n\n# \u6b63\u786e\uff1a\u53ea\u8bfb\u53d6\u9700\u8981\u7684\u5217\ndf = spark.read.parquet(\"s3://bucket/data/\").select(\"text\", \"length\")\n</code></pre> <p></p> <p>\u56fe2-5\uff1aI/O\u4f18\u5316\u6548\u679c\u5bf9\u6bd4 \u2014\u2014 \u5206\u533a\u88c1\u526a+\u5217\u88c1\u526a\u53ef\u51cf\u5c1191%\u67e5\u8be2\u65f6\u95f4\u548c92%\u6570\u636e\u626b\u63cf\u91cf</p> <p>\u7efc\u5408\u4f7f\u7528\u8fd9\u4e09\u4e2a\u6280\u5de7\uff0c\u53ef\u4ee5\u5c06\u67e5\u8be2\u65f6\u95f4\u4ece 55 \u79d2\u964d\u4f4e\u5230 5 \u79d2\uff0c\u6570\u636e\u626b\u63cf\u91cf\u4ece 100GB \u964d\u4f4e\u5230 8GB\uff0c\u6548\u679c\u975e\u5e38\u663e\u8457\u3002</p>"},{"location":"part1/1_2_data_infra/#23-dataops","title":"2.3 \u6570\u636e\u7248\u672c\u63a7\u5236 (DataOps)","text":"<p>\u4ee3\u7801\u6709 Git\uff0c\u673a\u5668\u5b66\u4e60\u6a21\u578b\u6709 MLflow\uff0c\u90a3\u4e48 TB \u7ea7\u6570\u636e\u96c6\u5982\u4f55\u8fdb\u884c\u7248\u672c\u63a7\u5236\uff1f\u8fd9\u662f LLM \u6570\u636e\u5de5\u7a0b\u4e2d\u7ecf\u5e38\u88ab\u5ffd\u89c6\u4f46\u6781\u5176\u91cd\u8981\u7684\u95ee\u9898\u3002</p>"},{"location":"part1/1_2_data_infra/#231","title":"2.3.1 \u4e3a\u4ec0\u4e48\u6570\u636e\u9700\u8981\u7248\u672c\u63a7\u5236\uff1f","text":"<p>\u8003\u8651\u8fd9\u6837\u4e00\u4e2a\u573a\u666f\uff1a\u516d\u4e2a\u6708\u524d\u8bad\u7ec3\u7684\u6a21\u578b\u6548\u679c\u7279\u522b\u597d\uff0c\u8001\u677f\u8981\u6c42\u590d\u73b0\u3002\u4f60\u7ffb\u904d\u670d\u52a1\u5668\uff0c\u53d1\u73b0\u5f53\u65f6\u7684\u8bad\u7ec3\u6570\u636e\u5df2\u88ab\u6e05\u7406\u2014\u2014\"\u8c01\u8ba9\u4f60\u5220\u7684\uff1f\"\"\u5b83\u5360\u4e86 10TB \u554a\uff01\"\u6570\u636e\u5904\u7406\u811a\u672c\u5012\u662f\u8fd8\u5728\uff0c\u4f46\u4f9d\u8d56\u7684\u4e0a\u6e38\u6570\u636e\u4e5f\u53d8\u4e86\u3002\u91cd\u65b0\u8dd1\u4e00\u904d\u5904\u7406\u6d41\u7a0b\uff0c\u53d1\u73b0\u7ed3\u679c\u548c\u4e4b\u524d\u4e0d\u4e00\u6837\u3002\u7ed3\u8bba\uff1a\u65e0\u6cd5\u590d\u73b0\u3002</p> <p>\u8fd9\u4e2a\u573a\u666f\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\u5c61\u89c1\u4e0d\u9c9c\u3002\u6570\u636e\u7248\u672c\u63a7\u5236\u6b63\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u7c7b\u95ee\u9898\u800c\u5b58\u5728\u3002\u5b83\u7684\u6838\u5fc3\u4ef7\u503c\u4f53\u73b0\u5728\u56db\u4e2a\u65b9\u9762\uff1a\u53ef\u590d\u73b0\u6027\u2014\u2014\u4efb\u610f\u65f6\u523b\u53ef\u4ee5\u7cbe\u786e\u8fd8\u539f\u5f53\u65f6\u7684\u6570\u636e\u72b6\u6001\uff1b\u53ef\u8ffd\u6eaf\u6027\u2014\u2014\u8ffd\u8e2a\u6570\u636e\u4ece\u539f\u59cb\u8f93\u5165\u5230\u6700\u7ec8\u8f93\u51fa\u7684\u5b8c\u6574\u94fe\u8def\uff1b\u534f\u4f5c\u5b89\u5168\u2014\u2014\u591a\u4eba\u540c\u65f6\u4fee\u6539\u6570\u636e\u4e0d\u4f1a\u4ea7\u751f\u51b2\u7a81\uff1b\u56de\u6eda\u80fd\u529b\u2014\u2014\u53d1\u73b0\u6570\u636e\u95ee\u9898\u65f6\u53ef\u4ee5\u5feb\u901f\u56de\u5230\u4e4b\u524d\u7684\u7248\u672c\u3002</p>"},{"location":"part1/1_2_data_infra/#232-dvc-vs-lakefs","title":"2.3.2 \u5de5\u5177\u9009\u578b\uff1aDVC vs LakeFS","text":"<p>\u76ee\u524d\u6700\u4e3b\u6d41\u7684\u4e24\u4e2a\u6570\u636e\u7248\u672c\u63a7\u5236\u5de5\u5177\u662f DVC \u548c LakeFS\uff0c\u5b83\u4eec\u7684\u8bbe\u8ba1\u54f2\u5b66\u622a\u7136\u4e0d\u540c\u3002</p> <p>DVC\uff08Data Version Control\uff09\u7684\u8bbe\u8ba1\u54f2\u5b66\u662f\"Git for Data\"\u2014\u2014\u8ba9\u6570\u636e\u7248\u672c\u63a7\u5236\u7684\u4f53\u9a8c\u5c3d\u53ef\u80fd\u63a5\u8fd1 Git\u3002\u5176\u5de5\u4f5c\u539f\u7406\u662f\uff1a\u6570\u636e\u6587\u4ef6\u672c\u8eab\u5b58\u50a8\u5728\u8fdc\u7a0b\u5b58\u50a8\uff08S3/GCS\uff09\uff0cGit \u4ed3\u5e93\u53ea\u4fdd\u5b58\u6570\u636e\u7684\u5143\u6570\u636e\u6587\u4ef6\uff08<code>.dvc</code> \u6587\u4ef6\uff09\uff0c\u901a\u8fc7 <code>dvc push/pull</code> \u547d\u4ee4\u540c\u6b65\u5b9e\u9645\u6570\u636e\u3002</p> <pre><code># \u521d\u59cb\u5316 DVC\ndvc init\n\n# \u5c06\u6570\u636e\u96c6\u7eb3\u5165\u7248\u672c\u63a7\u5236\ndvc add data/training_corpus.parquet\n# \u4f1a\u751f\u6210 data/training_corpus.parquet.dvc \u548c .gitignore\n\n# \u63d0\u4ea4\u5230 Git\ngit add data/training_corpus.parquet.dvc .gitignore\ngit commit -m \"Add training corpus v1\"\n\n# \u63a8\u9001\u6570\u636e\u5230\u8fdc\u7a0b\u5b58\u50a8\ndvc push\n\n# \u5207\u6362\u5230\u5386\u53f2\u7248\u672c\ngit checkout v1_0\ndvc checkout  # \u540c\u6b65\u5bf9\u5e94\u7248\u672c\u7684\u6570\u636e\n</code></pre> <p>DVC \u7684\u4f18\u52bf\u5728\u4e8e\u4e0e\u73b0\u6709 Git \u5de5\u4f5c\u6d41\u65e0\u7f1d\u96c6\u6210\uff0c\u5b66\u4e60\u66f2\u7ebf\u5e73\u7f13\uff0c\u652f\u6301 ML \u6d41\u6c34\u7ebf\u5b9a\u4e49\uff08\u901a\u8fc7 <code>dvc.yaml</code>\uff09\uff0c\u9002\u5408\u6587\u4ef6\u7ea7\u522b\u7684\u7248\u672c\u63a7\u5236\u573a\u666f\u3002\u5176\u52a3\u52bf\u662f\u6bcf\u4e2a\u6570\u636e\u96c6\u9700\u8981\u5355\u72ec\u7684 <code>.dvc</code> \u6587\u4ef6\u7ba1\u7406\uff0c\u4e0d\u652f\u6301\u7ec6\u7c92\u5ea6\u7684\"\u8868\u7ea7\"\u64cd\u4f5c\uff08\u5982\u56de\u6eda\u67d0\u4e2a\u5206\u533a\uff09\u3002</p> <p>LakeFS \u7684\u8bbe\u8ba1\u54f2\u5b66\u662f\"Git for Data Lake\"\u2014\u2014\u5728\u5bf9\u8c61\u5b58\u50a8\u4e4b\u4e0a\u63d0\u4f9b Git \u98ce\u683c\u7684\u5206\u652f\u548c\u63d0\u4ea4\u3002\u5176\u5de5\u4f5c\u539f\u7406\u662f\uff1aLakeFS \u4f5c\u4e3a\u5bf9\u8c61\u5b58\u50a8\u7684\u4ee3\u7406\u5c42\uff0c\u6240\u6709\u8bfb\u5199\u8bf7\u6c42\u901a\u8fc7 LakeFS \u7684 S3 \u7f51\u5173\uff0c\u7cfb\u7edf\u652f\u6301\u5206\u652f\uff08Branch\uff09\u3001\u63d0\u4ea4\uff08Commit\uff09\u3001\u5408\u5e76\uff08Merge\uff09\u7b49 Git \u98ce\u683c\u7684\u64cd\u4f5c\u3002</p> <pre><code># \u521b\u5efa\u5f00\u53d1\u5206\u652f\nlakectl branch create lakefs://repo/dev --source lakefs://repo/main\n\n# \u5728\u5f00\u53d1\u5206\u652f\u4e0a\u4fee\u6539\u6570\u636e\uff08\u901a\u8fc7 S3 \u534f\u8bae\uff09\naws s3 cp new_data.parquet s3://lakefs-repo/dev/data/\n\n# \u63d0\u4ea4\u66f4\u6539\nlakectl commit lakefs://repo/dev -m \"Add new training data\"\n\n# \u9a8c\u8bc1\u901a\u8fc7\u540e\u5408\u5e76\u5230\u4e3b\u5206\u652f\nlakectl merge lakefs://repo/dev lakefs://repo/main\n</code></pre> <p>LakeFS \u7684\u6838\u5fc3\u4f18\u52bf\u662f\u96f6\u62f7\u8d1d\u5206\u652f\u2014\u2014\u521b\u5efa\u5206\u652f\u4e0d\u590d\u5236\u6570\u636e\uff0c\u53ea\u8bb0\u5f55\u5143\u6570\u636e\uff0c\u8fd9\u5bf9\u4e8e TB \u7ea7\u6570\u636e\u6e56\u6765\u8bf4\u81f3\u5173\u91cd\u8981\u3002\u5b83\u5b8c\u5168 S3 \u517c\u5bb9\uff0c\u73b0\u6709\u5de5\u5177\uff08Spark/Ray\uff09\u65e0\u9700\u4fee\u6539\u5373\u53ef\u4f7f\u7528\u3002\u5176\u52a3\u52bf\u662f\u9700\u8981\u90e8\u7f72\u989d\u5916\u7684\u670d\u52a1\uff08LakeFS Server\uff09\uff0c\u5b66\u4e60\u66f2\u7ebf\u6bd4 DVC \u7565\u9661\u3002</p> <p>Pachyderm \u662f\u7b2c\u4e09\u79cd\u503c\u5f97\u5173\u6ce8\u7684\u6570\u636e\u7248\u672c\u63a7\u5236\u5de5\u5177\uff0c\u5b83\u7684\u72ec\u7279\u4e4b\u5904\u5728\u4e8e\u5c06\u6570\u636e\u7248\u672c\u63a7\u5236\u4e0e\u6570\u636e\u6d41\u6c34\u7ebf\u878d\u4e3a\u4e00\u4f53\u3002Pachyderm \u57fa\u4e8e Kubernetes \u6784\u5efa\uff0c\u6bcf\u4e2a\u6570\u636e\u5904\u7406\u6b65\u9aa4\u90fd\u8fd0\u884c\u5728\u5bb9\u5668\u4e2d\uff0c\u7cfb\u7edf\u81ea\u52a8\u8ffd\u8e2a\u8f93\u5165\u6570\u636e\u3001\u5904\u7406\u4ee3\u7801\u548c\u8f93\u51fa\u6570\u636e\u4e4b\u95f4\u7684\u5bf9\u5e94\u5173\u7cfb\u3002</p> <pre><code># Pachyderm \u5de5\u4f5c\u6d41\u793a\u4f8b\n\n# \u521b\u5efa\u6570\u636e\u4ed3\u5e93\uff08\u7c7b\u4f3c Git repo\uff09\npachctl create repo raw_data\n\n# \u4e0a\u4f20\u6570\u636e\uff08\u81ea\u52a8\u7248\u672c\u5316\uff09\npachctl put file raw_data@master:/corpus.parquet -f corpus.parquet\n\n# \u521b\u5efa\u5904\u7406\u6d41\u6c34\u7ebf\uff08\u58f0\u660e\u5f0f YAML\uff09\npachctl create pipeline -f cleaning_pipeline.json\n# pipeline \u5b9a\u4e49\u4e86\uff1a\u8f93\u5165 repo\u3001\u5904\u7406\u5bb9\u5668\u3001\u8f93\u51fa repo\n# Pachyderm \u81ea\u52a8\u8ffd\u8e2a\u8f93\u5165\u2192\u5904\u7406\u2192\u8f93\u51fa\u7684\u5b8c\u6574\u8840\u7f18\n\n# \u67e5\u770b\u6570\u636e\u8840\u7f18\npachctl inspect commit cleaned_data@master\n# \u8f93\u51fa\u4f1a\u663e\u793a\u8be5\u6570\u636e\u662f\u7531 raw_data \u7684\u54ea\u4e2a commit \u7ecf\u8fc7\u54ea\u4e2a pipeline \u751f\u6210\u7684\n</code></pre> <p>Pachyderm \u7684\u6838\u5fc3\u4f18\u52bf\u662f\u81ea\u52a8\u5316\u8840\u7f18\u8ffd\u8e2a\u2014\u2014\u5f53\u8f93\u5165\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u4e0b\u6e38\u6d41\u6c34\u7ebf\u81ea\u52a8\u89e6\u53d1\u589e\u91cf\u5904\u7406\uff0c\u7cfb\u7edf\u5929\u7136\u8bb0\u5f55\u4e86\u5b8c\u6574\u7684\u6570\u636e\u8840\u7f18\u5173\u7cfb\u3002\u8fd9\u5728\u9700\u8981\u9891\u7e41\u8fed\u4ee3\u6570\u636e\u5904\u7406\u6d41\u7a0b\u7684 LLM \u9879\u76ee\u4e2d\u975e\u5e38\u6709\u4ef7\u503c\u3002\u5176\u52a3\u52bf\u662f\u9700\u8981 Kubernetes \u96c6\u7fa4\uff08\u90e8\u7f72\u590d\u6742\u5ea6\u6700\u9ad8\uff09\uff0c\u5b66\u4e60\u66f2\u7ebf\u4e5f\u6700\u9661\u5ced\u3002</p> \u7279\u6027 DVC LakeFS Pachyderm \u8bbe\u8ba1\u7406\u5ff5 Git \u7684\u6570\u636e\u6269\u5c55 \u5bf9\u8c61\u5b58\u50a8\u7684\u7248\u672c\u5c42 \u6570\u636e\u6d41\u6c34\u7ebf+\u7248\u672c\u63a7\u5236 \u7c92\u5ea6 \u6587\u4ef6\u7ea7 \u5bf9\u8c61\u7ea7\uff08\u66f4\u7ec6\uff09 \u6587\u4ef6/\u76ee\u5f55\u7ea7 \u5206\u652f\u5f00\u9500 \u9700\u590d\u5236 .dvc \u6587\u4ef6 \u96f6\u62f7\u8d1d \u96f6\u62f7\u8d1d S3 \u517c\u5bb9 \u9700\u8981 dvc \u547d\u4ee4 \u539f\u751f S3 API \u539f\u751f S3 API \u8840\u7f18\u8ffd\u8e2a \u624b\u52a8 \u624b\u52a8/\u96c6\u6210 \u81ea\u52a8 \u589e\u91cf\u5904\u7406 \u624b\u52a8 \u624b\u52a8 \u81ea\u52a8\u89e6\u53d1 \u90e8\u7f72\u590d\u6742\u5ea6 \u4f4e\uff08CLI \u5de5\u5177\uff09 \u4e2d\uff08\u9700\u8981\u670d\u52a1\u7aef\uff09 \u9ad8\uff08\u9700 Kubernetes\uff09 \u9002\u5408\u573a\u666f ML \u5b9e\u9a8c\u7ba1\u7406\u3001\u5c11\u91cf\u6570\u636e \u6570\u636e\u6e56\u7ba1\u7406\u3001\u5927\u89c4\u6a21\u6570\u636e \u7aef\u5230\u7aef\u6570\u636e\u6d41\u6c34\u7ebf <p></p> <p>\u56fe2-6\uff1aDVC vs LakeFS\u67b6\u6784\u5bf9\u6bd4 \u2014\u2014 DVC\u57fa\u4e8eGit\u7684\u6587\u4ef6\u7ea7\u7248\u672c\u63a7\u5236\uff0cLakeFS\u63d0\u4f9b\u96f6\u62f7\u8d1d\u5206\u652f\u7684\u5bf9\u8c61\u7ea7\u7248\u672c\u63a7\u5236</p> <p>\u9009\u578b\u5efa\u8bae\u5982\u4e0b\uff1a\u5982\u679c\u6570\u636e\u91cf\u5728 1TB \u4ee5\u4e0b\uff0c\u56e2\u961f\u719f\u6089 Git \u5de5\u4f5c\u6d41\uff0c\u4e3b\u8981\u7528\u4e8e ML \u5b9e\u9a8c\u7ba1\u7406\uff0c\u9009\u62e9 DVC\uff1b\u5982\u679c\u6570\u636e\u91cf\u5728 TB \u7ea7\u4ee5\u4e0a\uff0c\u9700\u8981\u6570\u636e\u6e56\u7ea7\u522b\u7684\u7248\u672c\u63a7\u5236\uff0c\u6709\u591a\u4e2a\u56e2\u961f\u5e76\u884c\u64cd\u4f5c\uff0c\u9009\u62e9 LakeFS\uff1b\u5982\u679c\u9700\u8981\u7aef\u5230\u7aef\u7684\u6570\u636e\u6d41\u6c34\u7ebf\u7ba1\u7406\uff0c\u4e14\u56e2\u961f\u6709 Kubernetes \u8fd0\u7ef4\u80fd\u529b\uff0c\u9009\u62e9 Pachyderm\u3002</p>"},{"location":"part1/1_2_data_infra/#233-data-lineage","title":"2.3.3 \u6570\u636e\u8840\u7f18\u8ffd\u8e2a (Data Lineage)","text":"<p>\u7248\u672c\u63a7\u5236\u89e3\u51b3\u4e86\"\u6570\u636e\u662f\u4ec0\u4e48\"\u7684\u95ee\u9898\uff0c\u8840\u7f18\u8ffd\u8e2a\u5219\u89e3\u51b3\u4e86\"\u6570\u636e\u4ece\u54ea\u6765\"\u7684\u95ee\u9898\u3002\u8840\u7f18\u8ffd\u8e2a\u8bb0\u5f55\u7684\u4fe1\u606f\u5305\u62ec\uff1a\u8fd9\u4efd\u6570\u636e\u662f\u7531\u54ea\u4e9b\u4e0a\u6e38\u6570\u636e\u5904\u7406\u5f97\u6765\u7684\uff1f\u4f7f\u7528\u4e86\u4ec0\u4e48\u5904\u7406\u811a\u672c\u548c\u53c2\u6570\uff1f\u4f55\u65f6\u3001\u7531\u8c01\u6267\u884c\u7684\u5904\u7406\uff1f</p> <p>\u5b9e\u73b0\u8840\u7f18\u8ffd\u8e2a\u6709\u591a\u79cd\u65b9\u6848\u3002\u5982\u679c\u4f7f\u7528 Spark\uff0c\u53ef\u4ee5\u901a\u8fc7 OpenLineage \u96c6\u6210\u83b7\u5f97\u81ea\u52a8\u5316\u7684\u8840\u7f18\u8ffd\u8e2a\u3002\u5982\u679c\u4f7f\u7528 Airflow \u7b49\u7f16\u6392\u5de5\u5177\uff0cMarquez \u662f\u4e00\u4e2a\u5f88\u597d\u7684\u9009\u62e9\u3002\u5bf9\u4e8e\u4f01\u4e1a\u7ea7\u6570\u636e\u6cbb\u7406\u9700\u6c42\uff0cDataHub \u548c Apache Atlas \u63d0\u4f9b\u4e86\u66f4\u5b8c\u5584\u7684\u529f\u80fd\u3002\u5bf9\u4e8e\u7b80\u5355\u573a\u666f\uff0c\u624b\u52a8\u57cb\u70b9\u751f\u6210\u5143\u6570\u636e\u6587\u4ef6\u4e5f\u662f\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u89e3\u51b3\u65b9\u6848\uff1a</p> <pre><code>import json\nfrom datetime import datetime\n\nmetadata = {\n    \"version\": \"v2_0\",\n    \"created_at\": datetime.now().isoformat(),\n    \"created_by\": \"data-pipeline-v3_2\",\n    \"inputs\": [\n        {\"path\": \"s3://bucket/raw/crawl_2024_01.parquet\", \"version\": \"abc123\"},\n        {\"path\": \"s3://bucket/raw/crawl_2024_02.parquet\", \"version\": \"def456\"}\n    ],\n    \"processing\": {\n        \"script\": \"cleaning_pipeline.py\",\n        \"git_commit\": \"789xyz\",\n        \"params\": {\"min_length\": 100, \"dedup_threshold\": 0.9}\n    },\n    \"outputs\": [\n        {\"path\": \"s3://bucket/processed/clean_2024_q1.parquet\", \"records\": 1000000}\n    ]\n}\n\nwith open(\"clean_2024_q1.metadata.json\", \"w\") as f:\n    json.dump(metadata, f, indent=2)\n</code></pre>"},{"location":"part1/1_2_data_infra/#24","title":"2.4 \u5e38\u89c1\u9519\u8bef\u4e0e\u907f\u5751\u6307\u5357","text":"<p>\u5728\u57fa\u7840\u8bbe\u65bd\u9009\u578b\u8fc7\u7a0b\u4e2d\uff0c\u5373\u4f7f\u662f\u7ecf\u9a8c\u4e30\u5bcc\u7684\u5de5\u7a0b\u5e08\u4e5f\u5bb9\u6613\u72af\u4e00\u4e9b\u5178\u578b\u9519\u8bef\u3002\u8fd9\u91cc\u603b\u7ed3\u4e09\u4e2a\u6700\u5e38\u89c1\u7684\u95ee\u9898\uff0c\u5e0c\u671b\u8bfb\u8005\u80fd\u591f\u5f15\u4ee5\u4e3a\u6212\u3002</p> <p>\u7b2c\u4e00\u4e2a\u5e38\u89c1\u9519\u8bef\u662f\u8fc7\u65e9\u4f18\u5316\u3001\u8fc7\u5ea6\u5de5\u7a0b\u3002 \u6709\u4e9b\u56e2\u961f\u89c4\u6a21\u53ea\u6709\u4e94\u4eba\uff0c\u6570\u636e\u91cf\u4ec5 500GB\uff0c\u5374\u642d\u5efa\u4e86 Spark \u96c6\u7fa4 + Iceberg + Airflow + LakeFS \u7684\"\u5168\u6808\"\u57fa\u7840\u8bbe\u65bd\u3002\u7ed3\u679c\u662f 80% \u7684\u65f6\u95f4\u82b1\u5728\u7ef4\u62a4\u57fa\u7840\u8bbe\u65bd\u4e0a\uff0c\u53ea\u6709 20% \u7684\u65f6\u95f4\u7528\u4e8e\u5b9e\u9645\u6570\u636e\u5904\u7406\u3002\u6b63\u786e\u7684\u505a\u6cd5\u662f\u4ece\u7b80\u5355\u5f00\u59cb\uff0c\u6309\u9700\u6f14\u8fdb\u3002500GB \u7684\u6570\u636e\u91cf\uff0c\u5355\u673a + Parquet + DVC \u5b8c\u5168\u591f\u7528\uff0c\u7b49\u6570\u636e\u91cf\u589e\u957f\u5230 10TB \u65f6\u518d\u8003\u8651\u5206\u5e03\u5f0f\u65b9\u6848\u4e5f\u4e0d\u8fdf\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u5e38\u89c1\u9519\u8bef\u662f\u76f2\u76ee\u8ffd\u65b0\u3001\u5ffd\u89c6\u751f\u6001\u3002 \u6709\u4e9b\u56e2\u961f\u770b\u4e86\u51e0\u7bc7\u535a\u5ba2\uff0c\u51b3\u5b9a\u629b\u5f03 Spark \u5168\u9762\u8f6c\u5411 Ray\uff0c\u7ed3\u679c\u53d1\u73b0\u516c\u53f8\u7684 Hive \u8868\u3001Iceberg \u8868\u5168\u90e8\u65e0\u6cd5\u76f4\u63a5\u8bfb\u53d6\u3002\u6700\u7ec8\u9700\u8981\u989d\u5916\u7f16\u5199\u5927\u91cf\u6570\u636e\u8f6c\u6362\u811a\u672c\uff0c\u589e\u52a0\u4e86\u6570\u636e\u4e00\u81f4\u6027\u98ce\u9669\u3002\u6b63\u786e\u7684\u505a\u6cd5\u662f\u5728\u505a\u6280\u672f\u9009\u578b\u524d\uff0c\u5145\u5206\u8bc4\u4f30\u73b0\u6709\u6570\u636e\u8d44\u4ea7\u548c\u4e0a\u4e0b\u6e38\u4f9d\u8d56\u3002\u6280\u672f\u9009\u578b\u4e0d\u662f\u5355\u70b9\u51b3\u7b56\uff0c\u800c\u662f\u7cfb\u7edf\u5de5\u7a0b\uff0c\u9700\u8981\u8003\u8651\u6574\u4f53\u751f\u6001\u7684\u517c\u5bb9\u6027\u3002</p> <p>\u7b2c\u4e09\u4e2a\u5e38\u89c1\u9519\u8bef\u662f\u5b58\u50a8\u6210\u672c\u4f18\u5316\u8fc7\u6fc0\u3002 \u6709\u4e9b\u56e2\u961f\u4e3a\u4e86\u8282\u7701\u5b58\u50a8\u8d39\u7528\uff0c\u628a\u6240\u6709\u6570\u636e\u538b\u7f29\u5230 ZSTD level 22\uff0c\u5e76\u5b58\u5165 S3 Glacier Deep Archive\u3002\u7ed3\u679c\u6bcf\u6b21\u9700\u8981\u8bfb\u53d6\u6570\u636e\uff0c\u8981\u7b49 12 \u5c0f\u65f6\u89e3\u51bb\uff0c\u89e3\u538b\u53c8\u8981 4 \u5c0f\u65f6\uff0c\u6a21\u578b\u8bad\u7ec3\u4e00\u6b21\u8981\u6392\u671f\u4e00\u5468\u3002\u6b63\u786e\u7684\u505a\u6cd5\u662f\u533a\u5206\u51b7\u70ed\u6570\u636e\u3002\u6d3b\u8dc3\u5904\u7406\u7684\u6570\u636e\u653e\u5728 S3 Standard + Snappy \u538b\u7f29\uff1b\u516d\u4e2a\u6708\u4ee5\u4e0a\u4e0d\u4f7f\u7528\u7684\u5f52\u6863\u6570\u636e\u518d\u653e\u5165 Glacier\u3002\u5b58\u50a8\u6210\u672c\u548c\u8bbf\u95ee\u6548\u7387\u9700\u8981\u627e\u5230\u5e73\u8861\u70b9\u3002</p>"},{"location":"part1/1_2_data_infra/#25","title":"2.5 \u672c\u7ae0\u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u7cfb\u7edf\u4ecb\u7ecd\u4e86 AI \u539f\u751f\u6570\u636e\u6808\u7684\u6280\u672f\u9009\u578b\uff0c\u6db5\u76d6\u5b58\u50a8\u3001\u8ba1\u7b97\u3001\u5411\u91cf\u6570\u636e\u5e93\u3001\u683c\u5f0f\u548c\u7248\u672c\u63a7\u5236\u4e94\u4e2a\u6838\u5fc3\u7ef4\u5ea6\u3002</p> <p>\u5728\u5b58\u50a8\u9009\u578b\u65b9\u9762\uff0c\u5bf9\u8c61\u5b58\u50a8\uff08S3/MinIO\uff09\u662f\u73b0\u4ee3\u6570\u636e\u6808\u7684\u57fa\u7840\u8bbe\u65bd\uff0c\u6570\u636e\u6e56\u683c\u5f0f\uff08Iceberg/Hudi/Delta\uff09\u89e3\u51b3\u4e86 ACID \u4e8b\u52a1\u3001\u65f6\u95f4\u65c5\u884c\u7b49\u95ee\u9898\u3002\u5bf9\u4e8e LLM \u573a\u666f\uff0c\u63a8\u8350\u7ec4\u5408\u662f S3 + Iceberg\uff0c\u56e0\u4e3a Iceberg \u7684\u5f15\u64ce\u4e2d\u7acb\u6027\u6700\u597d\u3002\u9488\u5bf9 GPU \u8bad\u7ec3\u573a\u666f\uff0cI/O \u74f6\u9888\u9700\u8981\u901a\u8fc7\u9884\u53d6\u6d41\u6c34\u7ebf\u5316\u3001\u672c\u5730 SSD \u7f13\u5b58\u548c\u5e76\u53d1\u8bfb\u53d6\u7b49\u7b56\u7565\u4f18\u5316\u3002</p> <p>\u5728\u8ba1\u7b97\u9009\u578b\u65b9\u9762\uff0cSpark \u4ee5\u5176\u6210\u719f\u7a33\u5b9a\u548c\u5f3a\u5927\u7684 SQL \u751f\u6001\u8457\u79f0\uff0c\u9002\u5408\u4f20\u7edf\u5927\u6570\u636e\u56e2\u961f\uff1bRay Data \u662f Python \u539f\u751f\u7684 AI \u53cb\u597d\u6846\u67b6\uff0c\u9002\u5408 ML/AI \u56e2\u961f\u3002\u4e24\u8005\u5e76\u4e0d\u4e92\u65a5\uff0c\u53ef\u4ee5\u6df7\u7528\uff1aSpark \u8d1f\u8d23 ETL\uff0cRay \u8d1f\u8d23 ML \u5904\u7406\u3002</p> <p>\u5728\u5411\u91cf\u6570\u636e\u5e93\u65b9\u9762\uff0cMilvus\u3001Qdrant\u3001Weaviate \u7b49\u7cfb\u7edf\u4e3a RAG \u548c\u8bed\u4e49\u68c0\u7d22\u63d0\u4f9b\u4e86\u57fa\u7840\u80fd\u529b\u3002\u9009\u578b\u65f6\u9700\u8981\u5728 QPS \u548c Recall \u4e4b\u95f4\u6743\u8861\uff0c\u5e76\u6839\u636e\u6570\u636e\u89c4\u6a21\u548c\u8fd0\u7ef4\u80fd\u529b\u505a\u51fa\u51b3\u7b56\u3002</p> <p>\u5728\u6570\u636e\u683c\u5f0f\u65b9\u9762\uff0cParquet \u662f\u7ed3\u6784\u5316\u6570\u636e\u7684\u9ed8\u8ba4\u9009\u62e9\uff0cJSONL \u9002\u5408\u9700\u8981\u4eba\u5de5\u67e5\u770b\u7684\u5c0f\u89c4\u6a21\u6570\u636e\uff0cWebDataset \u662f\u591a\u6a21\u6001\u6570\u636e\u7684\u6700\u4f73\u683c\u5f0f\u3002\u538b\u7f29\u7b97\u6cd5\u548c I/O \u4f18\u5316\u6280\u5de7\u53ef\u4ee5\u663e\u8457\u5f71\u54cd\u6027\u80fd\u548c\u6210\u672c\u3002</p> <p>\u5728\u7248\u672c\u63a7\u5236\u65b9\u9762\uff0cDVC \u8f7b\u91cf\u7ea7\u4e14\u4e0e Git \u7d27\u5bc6\u96c6\u6210\uff0c\u9002\u5408 ML \u5b9e\u9a8c\uff1bLakeFS \u63d0\u4f9b\u6570\u636e\u6e56\u7ea7\u522b\u7684\u7248\u672c\u63a7\u5236\uff0c\u9002\u5408\u5927\u89c4\u6a21\u751f\u4ea7\u73af\u5883\u3002</p> <p>\u8d2f\u7a7f\u59cb\u7ec8\u7684\u6838\u5fc3\u539f\u5219\u662f\uff1a\u4ece\u7b80\u5355\u5f00\u59cb\uff0c\u6309\u9700\u6f14\u8fdb\uff0c\u907f\u514d\u8fc7\u5ea6\u5de5\u7a0b\u3002\u6280\u672f\u9009\u578b\u5e94\u8be5\u670d\u52a1\u4e8e\u4e1a\u52a1\u76ee\u6807\uff0c\u800c\u975e\u4e3a\u4e86\u8ffd\u6c42\u6280\u672f\u5148\u8fdb\u6027\u3002</p> <p></p> <p>\u56fe2-7\uff1a\u6570\u636e\u57fa\u7840\u8bbe\u65bd\u9009\u578b\u901f\u67e5\u8868 \u2014\u2014 \u5b58\u50a8\u3001\u8868\u683c\u5f0f\u3001\u8ba1\u7b97\u3001\u7248\u672c\u63a7\u5236\u56db\u8c61\u9650\u51b3\u7b56\u6307\u5357</p>"},{"location":"part1/1_2_data_infra/#_6","title":"\u5ef6\u4f38\u9605\u8bfb","text":"<p>\u5bf9\u4e8e\u5e0c\u671b\u6df1\u5165\u4e86\u89e3\u672c\u7ae0\u5185\u5bb9\u7684\u8bfb\u8005\uff0c\u4ee5\u4e0b\u8d44\u6e90\u503c\u5f97\u53c2\u8003\uff1a</p> <p>Ray Data \u5b98\u65b9\u6587\u6863\uff08docs.ray.io\uff09\u63d0\u4f9b\u4e86 Ray Data \u7684\u6700\u4f73\u5b9e\u8df5\u548c\u8be6\u7ec6 API \u8bf4\u660e\u3002Apache Iceberg \u5b98\u65b9\u6587\u6863\uff08iceberg.apache.org\uff09\u5305\u542b\u8868\u683c\u5f0f\u7684\u8be6\u7ec6\u89c4\u8303\u548c\u5404\u5f15\u64ce\u96c6\u6210\u6307\u5357\u3002DVC \u5b98\u65b9\u6559\u7a0b\uff08dvc.org/doc\uff09\u662f\u5feb\u901f\u5165\u95e8\u7684\u597d\u8d77\u70b9\u3002LakeFS \u5b98\u65b9\u6587\u6863\uff08docs.lakefs.io\uff09\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u67b6\u6784\u8bbe\u8ba1\u548c\u90e8\u7f72\u65b9\u6848\u3002</p> <p>Databricks \u53d1\u5e03\u7684\u6570\u636e\u6e56\u9009\u578b\u767d\u76ae\u4e66\u5bf9 Delta\u3001Iceberg\u3001Hudi \u4e09\u79cd\u683c\u5f0f\u8fdb\u884c\u4e86\u6df1\u5ea6\u5bf9\u6bd4\u5206\u6790\u3002Uber \u53d1\u8868\u7684\"Scaling MLOps at Uber\"\u4e00\u6587\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728 PB \u7ea7\u89c4\u6a21\u7ba1\u7406 ML \u6570\u636e\u3002\u8fd9\u4e9b\u8d44\u6599\u53ef\u4ee5\u5e2e\u52a9\u8bfb\u8005\u5efa\u7acb\u66f4\u5168\u9762\u7684\u6280\u672f\u89c6\u91ce\u3002</p>"},{"location":"part1/1_2_data_infra/#_7","title":"\u4e0b\u4e00\u7ae0\u9884\u544a","text":"<p>\u5728\u4e0b\u4e00\u7ae0\u300a\u6570\u636e\u83b7\u53d6\u4e0e\u91c7\u96c6\u300b\u4e2d\uff0c\u6211\u4eec\u5c06\u6b63\u5f0f\u8fdb\u5165\u9884\u8bad\u7ec3\u6570\u636e\u7684\u5904\u7406\u6d41\u7a0b\u3002\u4f60\u5c06\u5b66\u4e60\u5982\u4f55\u83b7\u53d6\u548c\u89e3\u6790 Common Crawl\u3001The Pile \u7b49\u5f00\u6e90\u6570\u636e\u96c6\uff0c\u5982\u4f55\u4f7f\u7528 Trafilatura \u6784\u5efa\u9ad8\u6027\u80fd\u7f51\u9875\u89e3\u6790\u5668\uff0c\u4ee5\u53ca\u4ece GitHub\u3001ArXiv \u6293\u53d6\u4ee3\u7801\u548c\u8bba\u6587\u7684\u7279\u79cd\u7b56\u7565\u3002</p> <p>\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\u8fdb\u5165\u4e0b\u4e00\u7ae0\uff1aCommon Crawl \u6bcf\u6708\u65b0\u589e 3-5PB \u6570\u636e\uff0c\u4f60\u5982\u4f55\u4ece\u4e2d\u9ad8\u6548\u63d0\u53d6\u9700\u8981\u7684\u5185\u5bb9\uff1f</p>"},{"location":"part2/2_1_data_acquisition/","title":"\u7b2c3\u7ae0\uff1a\u6570\u636e\u83b7\u53d6\u4e0e\u91c7\u96c6","text":""},{"location":"part2/2_1_data_acquisition/#3commoncrawl","title":"\u7b2c3\u7ae0\uff1a\u6570\u636e\u83b7\u53d6\uff08CommonCrawl \u89e3\u6790\u4e0e\u9ad8\u5e76\u53d1\u722c\u866b\uff09","text":""},{"location":"part2/2_1_data_acquisition/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u9884\u8bad\u7ec3\u6570\u636e\u662f\u5927\u6a21\u578b\u7684\"\u71c3\u6599\"\uff0c\u5176\u8d28\u91cf\u548c\u89c4\u6a21\u76f4\u63a5\u51b3\u5b9a\u4e86\u6a21\u578b\u7684\u57fa\u7840\u80fd\u529b\u3002\u672c\u7ae0\u5c06\u6df1\u5165\u63a2\u8ba8\u9884\u8bad\u7ec3\u6570\u636e\u7684\u83b7\u53d6\u7b56\u7565\uff0c\u4ece Common Crawl \u7b49\u5f00\u6e90\u6570\u636e\u96c6\u7684\u89e3\u6784\u4e0e\u4f7f\u7528\uff0c\u5230\u9ad8\u6027\u80fd\u7f51\u9875\u722c\u866b\u7cfb\u7edf\u7684\u8bbe\u8ba1\u4e0e\u5b9e\u73b0\uff0c\u518d\u5230\u4ee3\u7801\u3001\u8bba\u6587\u3001\u4e66\u7c4d\u7b49\u7279\u79cd\u6570\u636e\u7684\u83b7\u53d6\u6280\u5de7\u3002\u638c\u63e1\u8fd9\u4e9b\u5185\u5bb9\u540e\uff0c\u8bfb\u8005\u5c06\u5177\u5907\u6784\u5efa TB \u7ea7\u9884\u8bad\u7ec3\u8bed\u6599\u5e93\u7684\u80fd\u529b\u3002</p>"},{"location":"part2/2_1_data_acquisition/#_2","title":"\u573a\u666f\u5f15\u5165","text":"<p>\u4f60\u7684\u56e2\u961f\u51b3\u5b9a\u8bad\u7ec3\u4e00\u4e2a 7B \u53c2\u6570\u7684\u4e2d\u6587\u57fa\u5ea7\u6a21\u578b\u3002\u6309\u7167 Chinchilla \u7684\u6700\u4f18\u914d\u6bd4\uff0c\u8fd9\u9700\u8981\u7ea6 140B Token \u7684\u9ad8\u8d28\u91cf\u4e2d\u6587\u8bed\u6599\u2014\u2014\u6362\u7b97\u6210\u539f\u59cb\u6587\u672c\u5927\u7ea6\u662f 280GB\u3002\u53bb\u54ea\u91cc\u627e\u8fd9\u4e48\u591a\u6570\u636e\uff1f\u76f4\u63a5\u4ece\u7f51\u4e0a\u722c\u53d6\u663e\u7136\u4e0d\u73b0\u5b9e\uff0c\u4e00\u4e2a\u5c0f\u56e2\u961f\u4e0d\u53ef\u80fd\u5728\u77ed\u65f6\u95f4\u5185\u722c\u5b8c\u6574\u4e2a\u4e2d\u6587\u4e92\u8054\u7f51\u3002</p> <p>\u8fd9\u65f6\u6709\u4eba\u63d0\u8bae\u4f7f\u7528 Common Crawl\u2014\u2014\u8fd9\u662f\u4e00\u4e2a\u6bcf\u6708\u6293\u53d6\u6570\u5341\u4ebf\u7f51\u9875\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u7d2f\u8ba1\u6570\u636e\u91cf\u8d85\u8fc7 PB \u7ea7\u3002\u542c\u8d77\u6765\u662f\u5b8c\u7f8e\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u4f46\u5f53\u4f60\u771f\u6b63\u4e0b\u8f7d\u4e00\u4e2a\u6708\u7684\u6570\u636e\u540e\uff0c\u53d1\u73b0\u539f\u59cb\u7684 WARC \u6587\u4ef6\u5b8c\u5168\u65e0\u6cd5\u76f4\u63a5\u4f7f\u7528\uff1a\u5145\u65a5\u7740 HTML \u6807\u7b7e\u3001JavaScript \u4ee3\u7801\u3001\u5bfc\u822a\u680f\u3001\u5e7f\u544a\uff0c\u771f\u6b63\u6709\u4ef7\u503c\u7684\u6b63\u6587\u5185\u5bb9\u53ef\u80fd\u4e0d\u5230 10%\u3002</p> <p>\u5982\u4f55\u4ece\u8fd9\u7247\"\u6570\u636e\u6cbc\u6cfd\"\u4e2d\u63d0\u53d6\u51fa\u53ef\u7528\u4e8e\u8bad\u7ec3\u7684\"\u9ec4\u91d1\u8bed\u6599\"\uff1f\u8fd9\u6b63\u662f\u672c\u7ae0\u8981\u89e3\u51b3\u7684\u6838\u5fc3\u95ee\u9898\u3002</p>"},{"location":"part2/2_1_data_acquisition/#31","title":"3.1 \u5f00\u6e90\u6570\u636e\u96c6\u89e3\u6784","text":"<p>\u5728\u52a8\u624b\u722c\u53d6\u6570\u636e\u4e4b\u524d\uff0c\u9996\u5148\u5e94\u8be5\u5145\u5206\u5229\u7528\u5df2\u6709\u7684\u5f00\u6e90\u6570\u636e\u96c6\u3002\u8fd9\u4e9b\u6570\u636e\u96c6\u7ecf\u8fc7\u793e\u533a\u7684\u7cbe\u5fc3\u5904\u7406\uff0c\u53ef\u4ee5\u5927\u5927\u964d\u4f4e\u9884\u8bad\u7ec3\u6570\u636e\u51c6\u5907\u7684\u65f6\u95f4\u548c\u6210\u672c\u3002\u7406\u89e3\u5b83\u4eec\u7684\u6784\u6210\u548c\u5904\u7406\u65b9\u6cd5\uff0c\u4e5f\u662f\u8bbe\u8ba1\u81ea\u5df1\u6570\u636e\u7ba1\u7ebf\u7684\u91cd\u8981\u53c2\u8003\u3002</p>"},{"location":"part2/2_1_data_acquisition/#311-common-crawl","title":"3.1.1 Common Crawl\uff1a\u4e92\u8054\u7f51\u7684\u5feb\u7167","text":"<p>Common Crawl \u662f\u4e00\u4e2a\u975e\u8425\u5229\u7ec4\u7ec7\uff0c\u81ea 2008 \u5e74\u8d77\u6301\u7eed\u6293\u53d6\u4e92\u8054\u7f51\u7f51\u9875\uff0c\u5e76\u514d\u8d39\u63d0\u4f9b\u7ed9\u7814\u7a76\u548c\u5546\u4e1a\u4f7f\u7528\u3002\u5b83\u662f\u76ee\u524d\u7edd\u5927\u591a\u6570\u5927\u89c4\u6a21\u9884\u8bad\u7ec3\u6570\u636e\u96c6\u7684\u4e0a\u6e38\u6765\u6e90\uff0c\u65e0\u8bba\u662f GPT \u7cfb\u5217\u3001LLaMA \u8fd8\u662f\u56fd\u5185\u7684\u5404\u79cd\u5927\u6a21\u578b\uff0c\u90fd\u6216\u591a\u6216\u5c11\u5730\u4f7f\u7528\u4e86 Common Crawl \u7684\u6570\u636e\u3002</p> <p>Common Crawl \u7684\u6570\u636e\u4ee5\"\u6293\u53d6\u6279\u6b21\"\uff08Crawl\uff09\u4e3a\u5355\u4f4d\u7ec4\u7ec7\uff0c\u6bcf\u6708\u53d1\u5e03\u4e00\u4e2a\u65b0\u6279\u6b21\uff0c\u6bcf\u4e2a\u6279\u6b21\u5305\u542b\u6570\u5341\u4ebf\u4e2a\u7f51\u9875\u3002\u6570\u636e\u4ee5\u4e09\u79cd\u683c\u5f0f\u63d0\u4f9b\uff1aWARC\uff08Web ARChive\uff09\u6587\u4ef6\u5305\u542b\u539f\u59cb\u7684 HTTP \u54cd\u5e94\uff0c\u5305\u62ec\u54cd\u5e94\u5934\u548c\u5b8c\u6574\u7684 HTML \u5185\u5bb9\uff0c\u662f\u6700\u539f\u59cb\u4e5f\u6700\u5b8c\u6574\u7684\u683c\u5f0f\uff1bWAT \u6587\u4ef6\u662f WARC \u7684\u5143\u6570\u636e\u63d0\u53d6\u7248\u672c\uff0c\u5305\u542b URL\u3001\u54cd\u5e94\u5934\u3001\u94fe\u63a5\u5173\u7cfb\u7b49\u7ed3\u6784\u5316\u4fe1\u606f\uff1bWET \u6587\u4ef6\u662f\u7eaf\u6587\u672c\u63d0\u53d6\u7248\u672c\uff0c\u5df2\u7ecf\u53bb\u9664\u4e86 HTML \u6807\u7b7e\uff0c\u53ea\u4fdd\u7559\u6b63\u6587\u6587\u672c\u3002</p> \u683c\u5f0f \u5185\u5bb9 \u5355\u6708\u6570\u636e\u91cf \u9002\u7528\u573a\u666f WARC \u539f\u59cb HTTP \u54cd\u5e94 + HTML \u7ea6 80TB \u538b\u7f29 \u9700\u8981\u5b8c\u6574\u5185\u5bb9\u6216\u81ea\u5b9a\u4e49\u89e3\u6790 WAT \u7ed3\u6784\u5316\u5143\u6570\u636e \u7ea6 3TB \u538b\u7f29 URL \u5206\u6790\u3001\u94fe\u63a5\u56fe\u7814\u7a76 WET \u7eaf\u6587\u672c\u63d0\u53d6 \u7ea6 15TB \u538b\u7f29 \u5feb\u901f\u83b7\u53d6\u6587\u672c\u3001\u521d\u6b65\u5b9e\u9a8c <p></p> <p>\u56fe3-1\uff1aCommon Crawl \u6570\u636e\u6d41\u6c34\u7ebf \u2014\u2014 \u4ece\u4e92\u8054\u7f51\u6293\u53d6\u5230\u6e05\u6d01\u8bed\u6599\u7684\u5b8c\u6574\u5904\u7406\u6d41\u7a0b</p> <p>\u5bf9\u4e8e\u9884\u8bad\u7ec3\u6570\u636e\u5de5\u7a0b\u800c\u8a00\uff0cWARC \u548c WET \u662f\u6700\u5e38\u7528\u7684\u4e24\u79cd\u683c\u5f0f\u3002WET \u6587\u4ef6\u770b\u4f3c\u65b9\u4fbf\uff0c\u56e0\u4e3a\u5df2\u7ecf\u63d0\u53d6\u4e86\u7eaf\u6587\u672c\uff0c\u4f46\u5b9e\u9645\u4e0a Common Crawl \u7684\u9ed8\u8ba4\u6587\u672c\u63d0\u53d6\u8d28\u91cf\u8f83\u5dee\uff0c\u4f1a\u4fdd\u7559\u5927\u91cf\u566a\u58f0\uff08\u5982\u5bfc\u822a\u680f\u3001\u9875\u811a\u3001JavaScript \u6587\u672c\uff09\u3002\u56e0\u6b64\uff0c\u4e13\u4e1a\u7684\u6570\u636e\u5904\u7406\u6d41\u7a0b\u901a\u5e38\u4ece WARC \u6587\u4ef6\u5f00\u59cb\uff0c\u4f7f\u7528\u66f4\u9ad8\u8d28\u91cf\u7684\u89e3\u6790\u5668\uff08\u5982 Trafilatura\uff09\u91cd\u65b0\u63d0\u53d6\u6b63\u6587\u3002</p> <p>\u4f7f\u7528 Common Crawl \u6570\u636e\u9700\u8981\u6ce8\u610f\u51e0\u4e2a\u5173\u952e\u70b9\u3002\u9996\u5148\u662f\u7248\u672c\u9009\u62e9\uff1a\u6bcf\u6708\u7684\u6293\u53d6\u6279\u6b21\u8d28\u91cf\u7565\u6709\u5dee\u5f02\uff0c\u4e00\u822c\u5efa\u8bae\u4f7f\u7528\u8f83\u65b0\u7684\u7248\u672c\uff08\u5982 2023 \u5e74\u4ee5\u540e\u7684\u6279\u6b21\uff09\uff0c\u56e0\u4e3a Common Crawl \u6301\u7eed\u6539\u8fdb\u5176\u6293\u53d6\u7b56\u7565\u3002\u5176\u6b21\u662f\u8bed\u8a00\u8fc7\u6ee4\uff1aCommon Crawl \u4ee5\u82f1\u6587\u7f51\u9875\u4e3a\u4e3b\uff0c\u4e2d\u6587\u3001\u65e5\u6587\u7b49\u975e\u82f1\u8bed\u5185\u5bb9\u5360\u6bd4\u8f83\u4f4e\uff08\u901a\u5e38\u4e0d\u5230 10%\uff09\uff0c\u9700\u8981\u989d\u5916\u7684\u8bed\u8a00\u8bc6\u522b\u6b65\u9aa4\u8fdb\u884c\u7b5b\u9009\u3002\u6700\u540e\u662f\u6cd5\u5f8b\u5408\u89c4\uff1a\u867d\u7136 Common Crawl \u662f\u5f00\u653e\u6570\u636e\uff0c\u4f46\u5176\u4e2d\u6293\u53d6\u7684\u7f51\u9875\u5185\u5bb9\u53ef\u80fd\u6d89\u53ca\u7248\u6743\u95ee\u9898\uff0c\u4f7f\u7528\u65f6\u9700\u8981\u6839\u636e\u5f53\u5730\u6cd5\u5f8b\u8fdb\u884c\u8bc4\u4f30\u3002</p>"},{"location":"part2/2_1_data_acquisition/#312-refinedweb","title":"3.1.2 RefinedWeb\uff1a\u9ad8\u8d28\u91cf\u82f1\u6587\u8bed\u6599","text":"<p>RefinedWeb \u662f Falcon \u6a21\u578b\u56e2\u961f\uff08UAE \u7684 TII \u5b9e\u9a8c\u5ba4\uff09\u53d1\u5e03\u7684\u9ad8\u8d28\u91cf\u82f1\u6587\u9884\u8bad\u7ec3\u6570\u636e\u96c6\uff0c\u5305\u542b\u7ea6 5T Token\u3002\u4e0e\u76f4\u63a5\u4f7f\u7528 Common Crawl \u4e0d\u540c\uff0cRefinedWeb \u7ecf\u8fc7\u4e86\u4e25\u683c\u7684\u6e05\u6d17\u548c\u53bb\u91cd\u5904\u7406\uff0c\u88ab\u8ba4\u4e3a\u662f\u76ee\u524d\u516c\u5f00\u53ef\u7528\u7684\u6700\u9ad8\u8d28\u91cf\u82f1\u6587\u9884\u8bad\u7ec3\u8bed\u6599\u4e4b\u4e00\u3002</p> <p>RefinedWeb \u7684\u5904\u7406\u6d41\u7a0b\u5177\u6709\u5f88\u5f3a\u7684\u53c2\u8003\u4ef7\u503c\u3002\u5176\u6838\u5fc3\u6b65\u9aa4\u5305\u62ec\uff1aURL \u8fc7\u6ee4\uff08\u79fb\u9664\u6210\u4eba\u7f51\u7ad9\u3001\u5783\u573e\u7ad9\u70b9\u7b49\uff09\u3001\u6587\u672c\u63d0\u53d6\uff08\u4f7f\u7528 Trafilatura \u8fdb\u884c\u9ad8\u8d28\u91cf\u6b63\u6587\u63d0\u53d6\uff09\u3001\u8bed\u8a00\u8bc6\u522b\uff08\u4f7f\u7528 FastText \u4fdd\u7559\u82f1\u6587\u5185\u5bb9\uff09\u3001\u8d28\u91cf\u8fc7\u6ee4\uff08\u57fa\u4e8e\u542f\u53d1\u5f0f\u89c4\u5219\u79fb\u9664\u4f4e\u8d28\u91cf\u6587\u6863\uff09\u3001\u6a21\u7cca\u53bb\u91cd\uff08\u4f7f\u7528 MinHash LSH \u5728\u5927\u89c4\u6a21\u6570\u636e\u4e0a\u8fdb\u884c\u8fd1\u4f3c\u53bb\u91cd\uff09\u3002</p> <p>RefinedWeb \u8bba\u6587\u8be6\u7ec6\u8bb0\u5f55\u4e86\u6bcf\u4e2a\u6b65\u9aa4\u7684\u5b9e\u73b0\u7ec6\u8282\u548c\u6548\u679c\u8bc4\u4f30\uff0c\u662f\u5b66\u4e60\u9884\u8bad\u7ec3\u6570\u636e\u5904\u7406\u7684\u7edd\u4f73\u6559\u6750\u3002\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136 RefinedWeb \u516c\u5f00\u4e86\u6570\u636e\u96c6\u7684\u4e00\u4e2a\u5b50\u96c6\uff08\u7ea6 600B Token\uff09\uff0c\u4f46\u5b8c\u6574\u7248\u672c\u4ecd\u4fdd\u7559\u4e3a Falcon \u6a21\u578b\u7684\u72ec\u5bb6\u4f7f\u7528\u3002</p>"},{"location":"part2/2_1_data_acquisition/#313-the-pile","title":"3.1.3 The Pile\uff1a\u591a\u5143\u5316\u7684\u6570\u636e\u6df7\u5408","text":"<p>The Pile \u662f EleutherAI \u53d1\u5e03\u7684\u5f00\u6e90\u9884\u8bad\u7ec3\u6570\u636e\u96c6\uff0c\u89c4\u6a21\u7ea6 800GB\uff08\u89e3\u538b\u540e\uff09\uff0c\u5305\u542b\u7ea6 300B Token\u3002\u4e0e RefinedWeb \u4e13\u6ce8\u4e8e\u7f51\u9875\u6570\u636e\u4e0d\u540c\uff0cThe Pile \u7684\u8bbe\u8ba1\u7406\u5ff5\u662f\u591a\u5143\u5316\u2014\u2014\u5b83\u6df7\u5408\u4e86\u6765\u81ea 22 \u4e2a\u4e0d\u540c\u6765\u6e90\u7684\u6570\u636e\uff0c\u8986\u76d6\u7f51\u9875\u3001\u4e66\u7c4d\u3001\u4ee3\u7801\u3001\u8bba\u6587\u3001\u6cd5\u5f8b\u6587\u4ef6\u7b49\u591a\u4e2a\u9886\u57df\u3002</p> <p>The Pile \u7684\u6570\u636e\u6765\u6e90\u6784\u6210\u53cd\u6620\u4e86\u9884\u8bad\u7ec3\u6570\u636e\u591a\u6837\u6027\u7684\u91cd\u8981\u6027\u3002\u5176\u4e2d Pile-CC \u662f\u7ecf\u8fc7\u6e05\u6d17\u7684 Common Crawl \u5b50\u96c6\uff0c\u5360\u6bd4\u7ea6 30%\uff1bPubMed Central \u63d0\u4f9b\u751f\u7269\u533b\u5b66\u8bba\u6587\uff1bArXiv \u63d0\u4f9b\u79d1\u5b66\u9884\u5370\u672c\uff1bGitHub \u63d0\u4f9b\u5f00\u6e90\u4ee3\u7801\uff1bBooks3 \u63d0\u4f9b\u4e66\u7c4d\u6587\u672c\uff1bStackExchange \u63d0\u4f9b\u6280\u672f\u95ee\u7b54\uff1bWikipedia \u63d0\u4f9b\u767e\u79d1\u77e5\u8bc6\u3002\u8fd9\u79cd\u591a\u6765\u6e90\u6df7\u5408\u7b56\u7565\u88ab\u8bc1\u660e\u80fd\u591f\u63d0\u5347\u6a21\u578b\u5728\u5404\u7c7b\u4e0b\u6e38\u4efb\u52a1\u4e0a\u7684\u8868\u73b0\uff0c\u540e\u6765\u7684 LLaMA\u3001Mistral \u7b49\u6a21\u578b\u7684\u6570\u636e\u914d\u65b9\u90fd\u501f\u9274\u4e86\u7c7b\u4f3c\u7684\u601d\u8def\u3002</p> <p>\u7136\u800c\uff0cThe Pile \u5728\u6cd5\u5f8b\u5c42\u9762\u5b58\u5728\u4e89\u8bae\u3002\u5176\u4e2d\u7684 Books3 \u5b50\u96c6\u5305\u542b\u5927\u91cf\u7248\u6743\u4e66\u7c4d\uff0c\u5df2\u5f15\u53d1\u591a\u8d77\u8bc9\u8bbc\u3002\u5728\u4f7f\u7528 The Pile \u65f6\uff0c\u5efa\u8bae\u6839\u636e\u81ea\u8eab\u7684\u6cd5\u5f8b\u98ce\u9669\u627f\u53d7\u80fd\u529b\u8fdb\u884c\u8bc4\u4f30\uff0c\u6216\u8005\u9009\u62e9\u6027\u5730\u6392\u9664\u4e89\u8bae\u5b50\u96c6\u3002</p>"},{"location":"part2/2_1_data_acquisition/#314","title":"3.1.4 \u4e2d\u6587\u6570\u636e\u96c6\u6982\u89c8","text":"<p>\u5bf9\u4e8e\u8bad\u7ec3\u4e2d\u6587\u5927\u6a21\u578b\uff0c\u53ef\u7528\u7684\u5f00\u6e90\u6570\u636e\u96c6\u76f8\u5bf9\u8f83\u5c11\uff0c\u4f46\u8fd1\u5e74\u6765\u6709\u6240\u6539\u5584\u3002</p> <p>WuDaoCorpora \u662f\u667a\u6e90\u7814\u7a76\u9662\u53d1\u5e03\u7684\u5927\u89c4\u6a21\u4e2d\u6587\u8bed\u6599\u5e93\uff0c\u5305\u542b\u7ea6 3TB \u7684\u4e2d\u6587\u6587\u672c\uff0c\u6db5\u76d6\u767e\u79d1\u3001\u65b0\u95fb\u3001\u8bba\u575b\u3001\u95ee\u7b54\u7b49\u591a\u79cd\u6765\u6e90\u3002\u6570\u636e\u9700\u8981\u901a\u8fc7\u7533\u8bf7\u83b7\u53d6\uff0c\u4f7f\u7528\u65f6\u9700\u9075\u5b88\u76f8\u5173\u534f\u8bae\u3002ChineseCrawl \u662f\u4e2d\u6587\u7248\u7684 Common Crawl \u5b50\u96c6\u63d0\u53d6\uff0c\u6709\u591a\u4e2a\u793e\u533a\u7248\u672c\u53ef\u7528\u3002CLUECorpus \u662f CLUE \u57fa\u51c6\u56e2\u961f\u53d1\u5e03\u7684\u4e2d\u6587\u8bed\u6599\uff0c\u89c4\u6a21\u7ea6 100GB\uff0c\u9002\u5408\u4e2d\u5c0f\u89c4\u6a21\u5b9e\u9a8c\u3002</p> <p>\u76f8\u6bd4\u82f1\u6587\u6570\u636e\u96c6\u7684\u4e30\u5bcc\u7a0b\u5ea6\uff0c\u4e2d\u6587\u9884\u8bad\u7ec3\u6570\u636e\u4ecd\u7136\u662f\u4e00\u4e2a\"\u5356\u65b9\u5e02\u573a\"\u3002\u8fd9\u610f\u5473\u7740\u4e2d\u6587\u5927\u6a21\u578b\u56e2\u961f\u5f80\u5f80\u9700\u8981\u81ea\u884c\u4ece Common Crawl \u6216\u5176\u4ed6\u6765\u6e90\u83b7\u53d6\u548c\u5904\u7406\u4e2d\u6587\u6570\u636e\uff0c\u65e0\u6cd5\u5b8c\u5168\u4f9d\u8d56\u73b0\u6709\u5f00\u6e90\u6570\u636e\u96c6\u3002</p>"},{"location":"part2/2_1_data_acquisition/#32","title":"3.2 \u9ad8\u6027\u80fd\u7f51\u9875\u89e3\u6790","text":"<p>\u4ece Common Crawl \u6216\u81ea\u6709\u722c\u866b\u83b7\u53d6\u539f\u59cb HTML \u540e\uff0c\u4e0b\u4e00\u4e2a\u5173\u952e\u6b65\u9aa4\u662f\u4ece\u4e2d\u63d0\u53d6\u6b63\u6587\u6587\u672c\u3002\u8fd9\u770b\u4f3c\u7b80\u5355\uff0c\u5b9e\u9645\u4e0a\u662f\u6574\u4e2a\u6570\u636e\u7ba1\u7ebf\u4e2d\u6700\u5173\u952e\u7684\u73af\u8282\u4e4b\u4e00\u2014\u2014\u89e3\u6790\u8d28\u91cf\u76f4\u63a5\u51b3\u5b9a\u4e86\u6700\u7ec8\u8bed\u6599\u7684\u8d28\u91cf\u3002</p>"},{"location":"part2/2_1_data_acquisition/#321","title":"3.2.1 \u7f51\u9875\u89e3\u6790\u7684\u6311\u6218","text":"<p>\u73b0\u4ee3\u7f51\u9875\u8fdc\u6bd4\u8868\u9762\u770b\u8d77\u6765\u590d\u6742\u3002\u4e00\u4e2a\u5178\u578b\u7684\u7f51\u9875\u53ef\u80fd\u5305\u542b\uff1aHTML \u7ed3\u6784\u6807\u7b7e\u3001CSS \u6837\u5f0f\u5b9a\u4e49\u3001JavaScript \u4ee3\u7801\uff08\u5305\u62ec\u5185\u8054\u548c\u5916\u90e8\u5f15\u7528\uff09\u3001\u5bfc\u822a\u680f\u548c\u9875\u811a\u3001\u5e7f\u544a\u548c\u63a8\u5e7f\u5185\u5bb9\u3001\u8bc4\u8bba\u533a\u548c\u7528\u6237\u751f\u6210\u5185\u5bb9\u3001\u9875\u9762\u4fa7\u8fb9\u680f\u548c\u63a8\u8350\u5185\u5bb9\u3002\u800c\u6211\u4eec\u9700\u8981\u7684\u53ea\u662f\"\u6b63\u6587\"\u2014\u2014\u5373\u9875\u9762\u7684\u4e3b\u4f53\u5185\u5bb9\u90e8\u5206\u3002</p> <p>\u4f20\u7edf\u7684\u89e3\u6790\u65b9\u6cd5\uff08\u5982\u7b80\u5355\u5730\u53bb\u9664\u6240\u6709 HTML \u6807\u7b7e\uff09\u6548\u679c\u5f88\u5dee\uff0c\u56e0\u4e3a\u5b83\u65e0\u6cd5\u533a\u5206\u6b63\u6587\u548c\u566a\u58f0\u3002\u66f4\u9ad8\u7ea7\u7684\u65b9\u6cd5\u9700\u8981\u7406\u89e3\u7f51\u9875\u7684\u8bed\u4e49\u7ed3\u6784\uff0c\u8bc6\u522b\u54ea\u4e9b\u90e8\u5206\u662f\u771f\u6b63\u6709\u4ef7\u503c\u7684\u5185\u5bb9\u3002</p>"},{"location":"part2/2_1_data_acquisition/#322-trafilatura","title":"3.2.2 Trafilatura\uff1a\u5de5\u4e1a\u7ea7\u7684\u89e3\u6790\u5e93","text":"<p>Trafilatura \u662f\u76ee\u524d\u6700\u53d7\u63a8\u8350\u7684\u7f51\u9875\u6b63\u6587\u63d0\u53d6\u5e93\uff0c\u88ab RefinedWeb\u3001Dolma \u7b49\u4e3b\u6d41\u6570\u636e\u96c6\u91c7\u7528\u3002\u5b83\u7684\u6838\u5fc3\u4f18\u52bf\u5728\u4e8e\uff1a\u7cbe\u5fc3\u8c03\u4f18\u7684\u63d0\u53d6\u7b97\u6cd5\uff0c\u5728\u591a\u4e2a\u8bc4\u6d4b\u6570\u636e\u96c6\u4e0a\u8868\u73b0\u4f18\u5f02\uff1b\u826f\u597d\u7684\u591a\u8bed\u8a00\u652f\u6301\uff0c\u7279\u522b\u662f\u5bf9\u4e2d\u6587\u3001\u65e5\u6587\u7b49\u4e9a\u6d32\u8bed\u8a00\u7684\u5904\u7406\uff1b\u4e30\u5bcc\u7684\u914d\u7f6e\u9009\u9879\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u8c03\u6574\u63d0\u53d6\u7b56\u7565\uff1b\u5408\u7406\u7684\u6027\u80fd\u8868\u73b0\uff0c\u9002\u5408\u5927\u89c4\u6a21\u6570\u636e\u5904\u7406\u3002</p> <p>\u4f7f\u7528 Trafilatura \u7684\u57fa\u672c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <pre><code>import trafilatura\n\n# \u4ece HTML \u4e2d\u63d0\u53d6\u6b63\u6587\ndef extract_content(html: str, url: str = None) -&gt; dict:\n    \"\"\"\n    \u4ece HTML \u63d0\u53d6\u6b63\u6587\u5185\u5bb9\n\n    Args:\n        html: \u539f\u59cb HTML \u5b57\u7b26\u4e32\n        url: \u53ef\u9009\u7684 URL\uff0c\u7528\u4e8e\u89e3\u6790\u76f8\u5bf9\u94fe\u63a5\n\n    Returns:\n        \u5305\u542b\u6b63\u6587\u548c\u5143\u6570\u636e\u7684\u5b57\u5178\n    \"\"\"\n    # \u6838\u5fc3\u63d0\u53d6\n    result = trafilatura.extract(\n        html,\n        url=url,\n        include_comments=False,    # \u6392\u9664\u8bc4\u8bba\u533a\n        include_tables=True,       # \u4fdd\u7559\u8868\u683c\u5185\u5bb9\n        no_fallback=False,         # \u5141\u8bb8\u4f7f\u7528\u5907\u9009\u7b97\u6cd5\n        favor_precision=True,      # \u4f18\u5148\u4fdd\u8bc1\u7cbe\u786e\u5ea6\n        output_format='txt'        # \u8f93\u51fa\u7eaf\u6587\u672c\n    )\n\n    # \u63d0\u53d6\u5143\u6570\u636e\n    metadata = trafilatura.extract_metadata(html)\n\n    return {\n        'text': result,\n        'title': metadata.title if metadata else None,\n        'author': metadata.author if metadata else None,\n        'date': metadata.date if metadata else None,\n        'url': url\n    }\n</code></pre> <p>Trafilatura \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u914d\u7f6e\u9009\u9879\uff0c\u4e0d\u540c\u7684\u53c2\u6570\u7ec4\u5408\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f\u3002<code>include_comments</code> \u63a7\u5236\u662f\u5426\u4fdd\u7559\u9875\u9762\u8bc4\u8bba\u533a\u5185\u5bb9\uff0c\u5bf9\u4e8e\u8bba\u575b\u7c7b\u7f51\u7ad9\u53ef\u4ee5\u8bbe\u4e3a True\uff0c\u5bf9\u4e8e\u65b0\u95fb\u7f51\u7ad9\u901a\u5e38\u8bbe\u4e3a False\u3002<code>include_tables</code> \u63a7\u5236\u662f\u5426\u4fdd\u7559\u8868\u683c\uff0c\u5bf9\u4e8e\u6570\u636e\u7c7b\u9875\u9762\uff08\u5982 Wikipedia\uff09\u5e94\u8be5\u8bbe\u4e3a True\u3002<code>favor_precision</code> \u548c <code>favor_recall</code> \u662f\u4e00\u5bf9\u6743\u8861\u53c2\u6570\uff0c\u524d\u8005\u4f18\u5148\u4fdd\u8bc1\u63d0\u53d6\u5185\u5bb9\u7684\u51c6\u786e\u6027\uff08\u5b81\u53ef\u6f0f\u6389\u4e5f\u4e0d\u8981\u9519\u8bef\uff09\uff0c\u540e\u8005\u4f18\u5148\u4fdd\u8bc1\u63d0\u53d6\u7684\u5b8c\u6574\u6027\uff08\u5b81\u53ef\u6709\u566a\u58f0\u4e5f\u8981\u5b8c\u6574\uff09\u3002\u5bf9\u4e8e\u9884\u8bad\u7ec3\u6570\u636e\uff0c\u901a\u5e38\u9009\u62e9 <code>favor_precision=True</code>\uff0c\u56e0\u4e3a\u566a\u58f0\u6570\u636e\u5bf9\u6a21\u578b\u8bad\u7ec3\u6709\u5bb3\u3002</p>"},{"location":"part2/2_1_data_acquisition/#323","title":"3.2.3 \u5176\u4ed6\u89e3\u6790\u5de5\u5177\u5bf9\u6bd4","text":"<p>\u9664\u4e86 Trafilatura\uff0c\u8fd8\u6709\u51e0\u4e2a\u5e38\u7528\u7684\u7f51\u9875\u89e3\u6790\u5de5\u5177\uff0c\u5404\u6709\u7279\u70b9\u3002</p> <p>Readability \u6700\u521d\u7531 Mozilla \u5f00\u53d1\uff0c\u7528\u4e8e Firefox \u7684\u9605\u8bfb\u6a21\u5f0f\u3002\u5b83\u7684\u7b97\u6cd5\u76f8\u5bf9\u7b80\u5355\uff0c\u901f\u5ea6\u5feb\uff0c\u4f46\u5bf9\u590d\u6742\u9875\u9762\u7684\u5904\u7406\u6548\u679c\u4e00\u822c\u3002Python \u751f\u6001\u4e2d\u6709 readability-lxml \u7b49\u79fb\u690d\u7248\u672c\u3002</p> <p>Newspaper3k \u4e13\u95e8\u9488\u5bf9\u65b0\u95fb\u7f51\u7ad9\u4f18\u5316\uff0c\u80fd\u591f\u8f83\u597d\u5730\u63d0\u53d6\u6587\u7ae0\u6807\u9898\u3001\u6b63\u6587\u3001\u53d1\u5e03\u65e5\u671f\u3001\u4f5c\u8005\u7b49\u4fe1\u606f\u3002\u4f46\u5bf9\u975e\u65b0\u95fb\u7c7b\u7f51\u7ad9\u7684\u6548\u679c\u8f83\u5dee\uff0c\u4e14\u9879\u76ee\u7ef4\u62a4\u4e0d\u591f\u6d3b\u8dc3\u3002</p> <p>Justext \u662f\u4e00\u4e2a\u4e13\u6ce8\u4e8e\"\u6837\u677f\u6587\u672c\u53bb\u9664\"\uff08boilerplate removal\uff09\u7684\u5e93\uff0c\u7b97\u6cd5\u57fa\u4e8e\u6587\u672c\u5757\u7684\u94fe\u63a5\u5bc6\u5ea6\u548c\u6587\u672c\u5bc6\u5ea6\u3002\u5b83\u5728\u5b66\u672f\u7814\u7a76\u4e2d\u8f83\u5e38\u5f15\u7528\uff0c\u4f46\u5de5\u7a0b\u5b9e\u7528\u6027\u4e0d\u5982 Trafilatura\u3002</p> \u5de5\u5177 \u4f18\u52bf \u52a3\u52bf \u63a8\u8350\u573a\u666f Trafilatura \u7efc\u5408\u6548\u679c\u6700\u4f73\uff0c\u591a\u8bed\u8a00\u652f\u6301\u597d \u901f\u5ea6\u4e2d\u7b49 \u901a\u7528\u573a\u666f\uff0c\u9996\u9009 Readability \u901f\u5ea6\u5feb\uff0c\u7b97\u6cd5\u7b80\u5355 \u590d\u6742\u9875\u9762\u6548\u679c\u5dee \u5feb\u901f\u539f\u578b Newspaper3k \u65b0\u95fb\u7f51\u7ad9\u6548\u679c\u597d \u6cdb\u5316\u80fd\u529b\u5f31 \u65b0\u95fb\u8bed\u6599\u4e13\u9879 Justext \u5b66\u672f\u9a8c\u8bc1\u5145\u5206 \u5de5\u7a0b\u9002\u914d\u8f83\u5c11 \u7814\u7a76\u573a\u666f <p></p> <p>\u56fe3-2\uff1a\u7f51\u9875\u89e3\u6790\u5668\u8d28\u91cf\u5bf9\u6bd4 \u2014\u2014 Trafilatura \u5728 F1 \u5206\u6570\u4e0a\u9886\u5148\uff0c\u662f LLM \u6570\u636e\u5904\u7406\u7684\u9996\u9009\u5de5\u5177</p> <p>\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u4e00\u4e2a\u5e38\u89c1\u7684\u7b56\u7565\u662f\u4f7f\u7528 Trafilatura \u4f5c\u4e3a\u4e3b\u89e3\u6790\u5668\uff0c\u5f53\u63d0\u53d6\u7ed3\u679c\u4e3a\u7a7a\u6216\u8fc7\u77ed\u65f6\uff0c\u56de\u9000\u5230 Readability \u8fdb\u884c\u5c1d\u8bd5\u3002\u8fd9\u79cd\"\u4e3b\u5907\"\u7b56\u7565\u53ef\u4ee5\u63d0\u9ad8\u6574\u4f53\u7684\u63d0\u53d6\u6210\u529f\u7387\u3002</p>"},{"location":"part2/2_1_data_acquisition/#324","title":"3.2.4 \u5206\u5e03\u5f0f\u89e3\u6790\u67b6\u6784","text":"<p>\u5355\u673a\u5904\u7406\u80fd\u529b\u6709\u9650\uff0c\u9762\u5bf9 TB \u7ea7\u7684 WARC \u6587\u4ef6\uff0c\u9700\u8981\u6784\u5efa\u5206\u5e03\u5f0f\u89e3\u6790\u7cfb\u7edf\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u57fa\u4e8e Ray Data \u7684\u5206\u5e03\u5f0f\u89e3\u6790\u793a\u4f8b\uff1a</p> <pre><code>import ray\nimport trafilatura\nfrom warcio.archiveiterator import ArchiveIterator\nimport gzip\n\nray.init()\n\ndef parse_warc_record(record):\n    \"\"\"\u89e3\u6790\u5355\u6761 WARC \u8bb0\u5f55\"\"\"\n    if record.rec_type != 'response':\n        return None\n\n    url = record.rec_headers.get_header('WARC-Target-URI')\n    content_type = record.http_headers.get_header('Content-Type', '')\n\n    # \u53ea\u5904\u7406 HTML \u9875\u9762\n    if 'text/html' not in content_type:\n        return None\n\n    try:\n        html = record.content_stream().read().decode('utf-8', errors='ignore')\n        text = trafilatura.extract(html, url=url, favor_precision=True)\n\n        if text and len(text) &gt; 200:  # \u8fc7\u6ee4\u8fc7\u77ed\u7684\u5185\u5bb9\n            return {\n                'url': url,\n                'text': text,\n                'length': len(text)\n            }\n    except Exception as e:\n        return None\n\n    return None\n\ndef process_warc_file(warc_path: str):\n    \"\"\"\u5904\u7406\u5355\u4e2a WARC \u6587\u4ef6\"\"\"\n    results = []\n\n    with gzip.open(warc_path, 'rb') as f:\n        for record in ArchiveIterator(f):\n            result = parse_warc_record(record)\n            if result:\n                results.append(result)\n\n    return results\n\n# \u83b7\u53d6\u6240\u6709 WARC \u6587\u4ef6\u8def\u5f84\nwarc_files = [...]  # S3 \u6216\u672c\u5730\u8def\u5f84\u5217\u8868\n\n# \u5206\u5e03\u5f0f\u5e76\u884c\u5904\u7406\nds = ray.data.from_items(warc_files)\nds = ds.flat_map(process_warc_file)\n\n# \u4fdd\u5b58\u7ed3\u679c\nds.write_parquet(\"s3://bucket/parsed_data/\")\n</code></pre> <p>\u8fd9\u4e2a\u67b6\u6784\u7684\u5173\u952e\u8bbe\u8ba1\u70b9\u5305\u62ec\uff1a\u4f7f\u7528 Ray Data \u7684 <code>flat_map</code> \u7b97\u5b50\u5b9e\u73b0\u6587\u4ef6\u7ea7\u5e76\u884c\uff1b\u5728\u89e3\u6790\u51fd\u6570\u5185\u90e8\u8fdb\u884c\u9519\u8bef\u5904\u7406\uff0c\u907f\u514d\u5355\u6761\u6570\u636e\u7684\u5931\u8d25\u5f71\u54cd\u6574\u6279\u5904\u7406\uff1b\u901a\u8fc7 <code>len(text) &gt; 200</code> \u7b49\u6761\u4ef6\u8fdb\u884c\u65e9\u671f\u8fc7\u6ee4\uff0c\u51cf\u5c11\u4e0b\u6e38\u5904\u7406\u91cf\uff1b\u8f93\u51fa\u4e3a Parquet \u683c\u5f0f\uff0c\u4fbf\u4e8e\u540e\u7eed\u7684\u53bb\u91cd\u548c\u8fc7\u6ee4\u6b65\u9aa4\u3002</p>"},{"location":"part2/2_1_data_acquisition/#33","title":"3.3 \u7279\u79cd\u6570\u636e\u83b7\u53d6","text":"<p>\u9664\u4e86\u901a\u7528\u7684\u7f51\u9875\u6570\u636e\uff0c\u9884\u8bad\u7ec3\u8bed\u6599\u5e93\u901a\u5e38\u8fd8\u9700\u8981\u5305\u542b\u4ee3\u7801\u3001\u5b66\u672f\u8bba\u6587\u3001\u4e66\u7c4d\u7b49\u4e13\u95e8\u9886\u57df\u7684\u6570\u636e\u3002\u8fd9\u4e9b\"\u7279\u79cd\u6570\u636e\"\u7684\u83b7\u53d6\u548c\u5904\u7406\u6709\u5176\u72ec\u7279\u7684\u6311\u6218\u548c\u6280\u5de7\u3002</p>"},{"location":"part2/2_1_data_acquisition/#331-github-the-stack","title":"3.3.1 \u4ee3\u7801\u6570\u636e\uff1aGitHub \u4e0e The Stack","text":"<p>\u4ee3\u7801\u80fd\u529b\u662f\u73b0\u4ee3\u5927\u6a21\u578b\u7684\u6838\u5fc3\u7ade\u4e89\u529b\u4e4b\u4e00\uff0c\u800c\u9ad8\u8d28\u91cf\u4ee3\u7801\u6570\u636e\u7684\u83b7\u53d6\u662f\u5b9e\u73b0\u8fd9\u4e00\u80fd\u529b\u7684\u57fa\u7840\u3002\u76ee\u524d\u6700\u4e3b\u8981\u7684\u4ee3\u7801\u6570\u636e\u6765\u6e90\u662f GitHub\u3002</p> <p>\u76f4\u63a5\u4ece GitHub API \u83b7\u53d6\u4ee3\u7801\u662f\u53ef\u884c\u7684\uff0c\u4f46\u6548\u7387\u8f83\u4f4e\u4e14\u6709\u8bf7\u6c42\u9650\u5236\u3002\u66f4\u5e38\u89c1\u7684\u505a\u6cd5\u662f\u4f7f\u7528 GitHub \u7684\u516c\u5f00\u6570\u636e\u955c\u50cf\u3002Google BigQuery \u6258\u7ba1\u4e86 GitHub \u516c\u5f00\u4ed3\u5e93\u7684\u5b8c\u6574\u5feb\u7167\uff0c\u53ef\u4ee5\u4f7f\u7528 SQL \u8fdb\u884c\u67e5\u8be2\u548c\u5bfc\u51fa\u3002Software Heritage \u662f\u4e00\u4e2a\u81f4\u529b\u4e8e\u4fdd\u5b58\u4eba\u7c7b\u8f6f\u4ef6\u9057\u4ea7\u7684\u7ec4\u7ec7\uff0c\u7ef4\u62a4\u7740 GitHub \u7684\u5b8c\u6574\u5f52\u6863\u3002</p> <p>\u5bf9\u4e8e\u5927\u89c4\u6a21\u4ee3\u7801\u6570\u636e\u9700\u6c42\uff0c\u6700\u4fbf\u6377\u7684\u9009\u62e9\u662f\u4f7f\u7528 BigCode \u9879\u76ee\u53d1\u5e03\u7684 The Stack \u6570\u636e\u96c6\u3002\u8fd9\u4e2a\u6570\u636e\u96c6\u4ece GitHub \u722c\u53d6\u4e86\u8d85\u8fc7 300 \u79cd\u7f16\u7a0b\u8bed\u8a00\u7684\u4ee3\u7801\uff0c\u603b\u89c4\u6a21\u7ea6 3TB\u3002The Stack \u7684\u5904\u7406\u6d41\u7a0b\u5305\u62ec\uff1a\u57fa\u4e8e\u8bb8\u53ef\u8bc1\u8fc7\u6ee4\uff08\u53ea\u4fdd\u7559\u5f00\u6e90\u8bb8\u53ef\u8bc1\u5141\u8bb8\u4f7f\u7528\u7684\u4ee3\u7801\uff09\u3001\u53bb\u91cd\uff08\u79fb\u9664\u91cd\u590d\u7684\u6587\u4ef6\u548c\u4ee3\u7801\u7247\u6bb5\uff09\u3001PII \u6e05\u6d17\uff08\u79fb\u9664\u654f\u611f\u4fe1\u606f\uff09\u3002</p> <p>\u4f7f\u7528\u4ee3\u7801\u6570\u636e\u65f6\u9700\u8981\u7279\u522b\u6ce8\u610f\u4ee5\u4e0b\u51e0\u70b9\uff1a</p> <p>\u8bb8\u53ef\u8bc1\u5408\u89c4\u662f\u9996\u8981\u95ee\u9898\u3002\u4e0d\u540c\u7684\u5f00\u6e90\u8bb8\u53ef\u8bc1\u5bf9\u4ee3\u7801\u4f7f\u7528\u6709\u4e0d\u540c\u7684\u9650\u5236\u3002The Stack \u6570\u636e\u96c6\u63d0\u4f9b\u4e86\u8bb8\u53ef\u8bc1\u6807\u7b7e\uff0c\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u8fdb\u884c\u7b5b\u9009\u3002\u5bf9\u4e8e\u5546\u4e1a\u6a21\u578b\u8bad\u7ec3\uff0c\u5efa\u8bae\u53ea\u4f7f\u7528 MIT\u3001Apache 2.0 \u7b49\u5bbd\u677e\u8bb8\u53ef\u8bc1\u7684\u4ee3\u7801\u3002</p> <p>\u4ee3\u7801\u8d28\u91cf\u5dee\u5f02\u5de8\u5927\u3002GitHub \u4e0a\u65e2\u6709 Linux \u5185\u6838\u8fd9\u6837\u7684\u9ad8\u8d28\u91cf\u9879\u76ee\uff0c\u4e5f\u6709\u5927\u91cf\u5b66\u751f\u4f5c\u4e1a\u548c\u4e2a\u4eba\u5b9e\u9a8c\u4ee3\u7801\u3002\u5e38\u7528\u7684\u8d28\u91cf\u8fc7\u6ee4\u7b56\u7565\u5305\u62ec\uff1a\u6309\u4ed3\u5e93 star \u6570\u7b5b\u9009\uff08\u4fdd\u7559 star &gt; 10 \u7684\u4ed3\u5e93\uff09\u3001\u6309\u6587\u4ef6\u957f\u5ea6\u8fc7\u6ee4\uff08\u79fb\u9664\u8fc7\u77ed\u6216\u8fc7\u957f\u7684\u6587\u4ef6\uff09\u3001\u57fa\u4e8e AST \u89e3\u6790\u68c0\u6d4b\u8bed\u6cd5\u9519\u8bef\u3002</p> <p>\u5904\u7406\u4ee3\u7801\u6570\u636e\u7684\u793a\u4f8b\uff1a</p> <pre><code>import ast\nfrom typing import Optional\n\ndef is_valid_python(code: str) -&gt; bool:\n    \"\"\"\u68c0\u67e5 Python \u4ee3\u7801\u662f\u5426\u8bed\u6cd5\u6b63\u786e\"\"\"\n    try:\n        ast.parse(code)\n        return True\n    except SyntaxError:\n        return False\n\ndef extract_functions(code: str) -&gt; list:\n    \"\"\"\u63d0\u53d6\u4ee3\u7801\u4e2d\u7684\u51fd\u6570\u5b9a\u4e49\"\"\"\n    try:\n        tree = ast.parse(code)\n        functions = []\n        for node in ast.walk(tree):\n            if isinstance(node, ast.FunctionDef):\n                functions.append(ast.unparse(node))\n        return functions\n    except:\n        return []\n\ndef filter_code_quality(code: str, \n                        min_lines: int = 10, \n                        max_lines: int = 1000,\n                        require_docstring: bool = True) -&gt; Optional[str]:\n    \"\"\"\u4ee3\u7801\u8d28\u91cf\u8fc7\u6ee4\"\"\"\n    lines = code.split('\\n')\n\n    # \u957f\u5ea6\u8fc7\u6ee4\n    if not (min_lines &lt;= len(lines) &lt;= max_lines):\n        return None\n\n    # \u8bed\u6cd5\u68c0\u67e5\n    if not is_valid_python(code):\n        return None\n\n    # Docstring \u68c0\u67e5\uff08\u53ef\u9009\uff09\n    if require_docstring and '\"\"\"' not in code and \"'''\" not in code:\n        return None\n\n    return code\n</code></pre>"},{"location":"part2/2_1_data_acquisition/#332-arxiv-s2orc","title":"3.3.2 \u5b66\u672f\u8bba\u6587\uff1aArXiv \u4e0e S2ORC","text":"<p>\u5b66\u672f\u8bba\u6587\u662f\u9ad8\u8d28\u91cf\u77e5\u8bc6\u7684\u91cd\u8981\u6765\u6e90\uff0c\u5bf9\u4e8e\u63d0\u5347\u6a21\u578b\u7684\u63a8\u7406\u80fd\u529b\u548c\u4e13\u4e1a\u77e5\u8bc6\u6c34\u5e73\u6709\u663e\u8457\u5e2e\u52a9\u3002</p> <p>ArXiv \u662f\u6700\u91cd\u8981\u7684\u5f00\u653e\u83b7\u53d6\u9884\u5370\u672c\u5e73\u53f0\uff0c\u6db5\u76d6\u7269\u7406\u3001\u6570\u5b66\u3001\u8ba1\u7b97\u673a\u79d1\u5b66\u3001\u751f\u7269\u5b66\u7b49\u9886\u57df\u7684\u5b66\u672f\u8bba\u6587\u3002ArXiv \u63d0\u4f9b\u6279\u91cf\u4e0b\u8f7d\u670d\u52a1\uff0c\u53ef\u4ee5\u901a\u8fc7\u5176 S3 \u6876\u83b7\u53d6 LaTeX \u6e90\u6587\u4ef6\u548c PDF\u3002LaTeX \u6e90\u6587\u4ef6\u662f\u66f4\u7406\u60f3\u7684\u6570\u636e\u6765\u6e90\uff0c\u56e0\u4e3a\u5b83\u4fdd\u7559\u4e86\u8bba\u6587\u7684\u7ed3\u6784\u4fe1\u606f\uff08\u7ae0\u8282\u3001\u516c\u5f0f\u3001\u5f15\u7528\u7b49\uff09\uff0c\u4e14\u662f\u7eaf\u6587\u672c\u683c\u5f0f\uff0c\u6613\u4e8e\u5904\u7406\u3002</p> <p>\u5904\u7406 ArXiv LaTeX \u6570\u636e\u7684\u4e3b\u8981\u6311\u6218\u5728\u4e8e LaTeX \u8bed\u6cd5\u7684\u590d\u6742\u6027\u3002\u4e00\u7bc7\u8bba\u6587\u53ef\u80fd\u5305\u542b\u6570\u5341\u4e2a <code>.tex</code> \u6587\u4ef6\uff0c\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u5b8f\u548c\u6837\u5f0f\u3002\u4e00\u4e2a\u5b9e\u7528\u7684\u7b80\u5316\u7b56\u7565\u662f\uff1a\u53ea\u63d0\u53d6\u4e3b\u6587\u4ef6\uff08\u901a\u5e38\u662f <code>main.tex</code> \u6216\u4e0e\u8bba\u6587\u6807\u9898\u76f8\u5173\u7684\u6587\u4ef6\uff09\uff0c\u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u53bb\u9664\u56fe\u8868\u548c\u590d\u6742\u516c\u5f0f\u73af\u5883\uff0c\u4fdd\u7559\u6b63\u6587\u6587\u672c\u548c\u7b80\u5355\u7684\u6570\u5b66\u8868\u8fbe\u5f0f\u3002</p> <pre><code>import re\nimport tarfile\nfrom pathlib import Path\n\ndef extract_arxiv_text(latex_content: str) -&gt; str:\n    \"\"\"\u4ece LaTeX \u4e2d\u63d0\u53d6\u7eaf\u6587\u672c\"\"\"\n    text = latex_content\n\n    # \u79fb\u9664\u6ce8\u91ca\n    text = re.sub(r'%.*$', '', text, flags=re.MULTILINE)\n\n    # \u79fb\u9664\u56fe\u8868\u73af\u5883\n    text = re.sub(r'\\\\begin\\{figure\\}.*?\\\\end\\{figure\\}', '', text, flags=re.DOTALL)\n    text = re.sub(r'\\\\begin\\{table\\}.*?\\\\end\\{table\\}', '', text, flags=re.DOTALL)\n\n    # \u7b80\u5316\u5f15\u7528\n    text = re.sub(r'\\\\cite\\{[^}]+\\}', '[CITATION]', text)\n    text = re.sub(r'\\\\ref\\{[^}]+\\}', '[REF]', text)\n\n    # \u79fb\u9664\u5e38\u89c1\u7684\u547d\u4ee4\u4f46\u4fdd\u7559\u53c2\u6570\n    commands_to_strip = ['textbf', 'textit', 'emph', 'section', 'subsection', \n                         'paragraph', 'title', 'author']\n    for cmd in commands_to_strip:\n        text = re.sub(rf'\\\\{cmd}\\{{([^}}]+)\\}}', r'\\1', text)\n\n    # \u79fb\u9664\u5176\u4ed6\u547d\u4ee4\n    text = re.sub(r'\\\\[a-zA-Z]+(\\[[^\\]]*\\])?\\{[^}]*\\}', '', text)\n    text = re.sub(r'\\\\[a-zA-Z]+', '', text)\n\n    # \u6e05\u7406\u7a7a\u767d\n    text = re.sub(r'\\n\\s*\\n', '\\n\\n', text)\n    text = re.sub(r' +', ' ', text)\n\n    return text.strip()\n</code></pre> <p>Semantic Scholar Open Research Corpus (S2ORC) \u662f Allen AI \u53d1\u5e03\u7684\u5927\u89c4\u6a21\u5b66\u672f\u8bba\u6587\u6570\u636e\u96c6\uff0c\u5305\u542b\u8d85\u8fc7 80M \u7bc7\u8bba\u6587\u7684\u5143\u6570\u636e\u548c\u7ea6 8M \u7bc7\u8bba\u6587\u7684\u5168\u6587\u3002\u76f8\u6bd4 ArXiv\uff0cS2ORC \u8986\u76d6\u7684\u9886\u57df\u66f4\u5e7f\uff0c\u5305\u62ec PubMed\u3001ACL Anthology \u7b49\u591a\u4e2a\u6765\u6e90\u3002S2ORC \u7684\u5168\u6587\u5df2\u7ecf\u5904\u7406\u4e3a\u7ed3\u6784\u5316\u7684 JSON \u683c\u5f0f\uff0c\u7701\u53bb\u4e86 LaTeX/PDF \u89e3\u6790\u7684\u9ebb\u70e6\uff0c\u662f\u5feb\u901f\u83b7\u53d6\u8bba\u6587\u6570\u636e\u7684\u4fbf\u6377\u9009\u62e9\u3002</p>"},{"location":"part2/2_1_data_acquisition/#333","title":"3.3.3 \u4e66\u7c4d\u6570\u636e\uff1a\u7248\u6743\u4e0e\u66ff\u4ee3\u65b9\u6848","text":"<p>\u4e66\u7c4d\u662f\u9ad8\u8d28\u91cf\u957f\u6587\u672c\u7684\u91cd\u8981\u6765\u6e90\uff0c\u5bf9\u4e8e\u8bad\u7ec3\u6a21\u578b\u7684\u957f\u7a0b\u7406\u89e3\u80fd\u529b\u548c\u77e5\u8bc6\u6df1\u5ea6\u6709\u91cd\u8981\u4ef7\u503c\u3002\u7136\u800c\uff0c\u4e66\u7c4d\u6570\u636e\u7684\u7248\u6743\u95ee\u9898\u5c24\u4e3a\u654f\u611f\u3002</p> <p>The Pile \u4e2d\u7684 Books3 \u6570\u636e\u96c6\u5305\u542b\u7ea6 20 \u4e07\u672c\u4e66\u7c4d\uff0c\u6765\u81ea Bibliotik \u7b49\u6765\u6e90\u3002\u8fd9\u4e2a\u6570\u636e\u96c6\u5df2\u5f15\u53d1\u591a\u8d77\u7248\u6743\u8bc9\u8bbc\uff0c\u591a\u5bb6\u516c\u53f8\u56e0\u4f7f\u7528\u8be5\u6570\u636e\u96c6\u8bad\u7ec3\u6a21\u578b\u800c\u88ab\u8d77\u8bc9\u3002\u5728\u5f53\u524d\u7684\u6cd5\u5f8b\u73af\u5883\u4e0b\uff0c\u76f4\u63a5\u4f7f\u7528 Books3 \u5b58\u5728\u663e\u8457\u7684\u6cd5\u5f8b\u98ce\u9669\u3002</p> <p>\u5408\u89c4\u7684\u66ff\u4ee3\u65b9\u6848\u5305\u62ec\uff1a</p> <p></p> <p>\u56fe3-3\uff1a\u9884\u8bad\u7ec3\u6570\u636e\u6765\u6e90\u6df7\u5408 \u2014\u2014 \u591a\u6e90\u6df7\u5408\u7b56\u7565\u53ef\u63d0\u5347\u6a21\u578b\u7684\u7efc\u5408\u80fd\u529b</p> <p>Project Gutenberg \u662f\u4e00\u4e2a\u5fd7\u613f\u8005\u9879\u76ee\uff0c\u63d0\u4f9b\u7248\u6743\u8fc7\u671f\u7684\u7ecf\u5178\u4e66\u7c4d\u3002\u4e3b\u8981\u662f 1928 \u5e74\u524d\u51fa\u7248\u7684\u82f1\u6587\u4e66\u7c4d\uff0c\u7ea6 70,000 \u672c\u3002\u6570\u636e\u8d28\u91cf\u9ad8\uff0c\u4f46\u65f6\u4ee3\u8f83\u8fdc\uff0c\u73b0\u4ee3\u7528\u8bed\u8986\u76d6\u4e0d\u8db3\u3002</p> <p>Internet Archive \u7684 Open Library \u63d0\u4f9b\u53ef\u501f\u9605\u7684\u7535\u5b50\u4e66\u3002\u4f7f\u7528\u65f6\u9700\u8981\u9075\u5b88\u5176\u501f\u9605\u534f\u8bae\uff0c\u5927\u89c4\u6a21\u6279\u91cf\u83b7\u53d6\u53ef\u80fd\u8fdd\u53cd\u670d\u52a1\u6761\u6b3e\u3002</p> <p>\u7ef4\u57fa\u6587\u5e93\uff08Wikisource\uff09\u63d0\u4f9b\u516c\u5171\u9886\u57df\u7684\u6587\u5b66\u4f5c\u54c1\uff0c\u8986\u76d6\u591a\u79cd\u8bed\u8a00\uff0c\u5305\u62ec\u5927\u91cf\u4e2d\u6587\u53e4\u7c4d\u3002</p> <p>\u5b66\u672f\u6559\u6750\u548c\u5f00\u653e\u6559\u80b2\u8d44\u6e90\uff08OER\uff09\u5982 OpenStax \u63d0\u4f9b\u9ad8\u8d28\u91cf\u7684\u6559\u6750\u5185\u5bb9\uff0c\u9002\u5408\u7528\u4e8e\u6784\u5efa\u6559\u80b2\u7c7b\u9884\u8bad\u7ec3\u6570\u636e\u3002</p> <p>\u5bf9\u4e8e\u5546\u4e1a\u6a21\u578b\u8bad\u7ec3\uff0c\u6700\u5b89\u5168\u7684\u7b56\u7565\u662f\u53ea\u4f7f\u7528\u660e\u786e\u83b7\u5f97\u6388\u6743\u6216\u5904\u4e8e\u516c\u5171\u9886\u57df\u7684\u4e66\u7c4d\u6570\u636e\u3002\u867d\u7136\u8fd9\u4f1a\u9650\u5236\u6570\u636e\u89c4\u6a21\uff0c\u4f46\u53ef\u4ee5\u907f\u514d\u6f5c\u5728\u7684\u6cd5\u5f8b\u98ce\u9669\u3002</p>"},{"location":"part2/2_1_data_acquisition/#334","title":"3.3.4 \u591a\u8bed\u8a00\u6570\u636e\u5e73\u8861","text":"<p>\u8bad\u7ec3\u591a\u8bed\u8a00\u6a21\u578b\u65f6\uff0c\u4e0d\u540c\u8bed\u8a00\u7684\u6570\u636e\u53ef\u7528\u6027\u5dee\u5f02\u5de8\u5927\u3002\u82f1\u8bed\u6570\u636e\u6700\u4e3a\u4e30\u5bcc\uff0c\u4e2d\u6587\u3001\u65e5\u6587\u3001\u5fb7\u6587\u7b49\u4e3b\u8981\u8bed\u8a00\u6b21\u4e4b\uff0c\u800c\u5c0f\u8bed\u79cd\u7684\u9ad8\u8d28\u91cf\u6570\u636e\u5219\u6781\u4e3a\u7a00\u7f3a\u3002</p> <p>\u6570\u636e\u4e0d\u5e73\u8861\u4f1a\u5bfc\u81f4\u6a21\u578b\u80fd\u529b\u7684\u4e0d\u5747\u8861\u3002\u5982\u679c\u7b80\u5355\u6309\u539f\u59cb\u6bd4\u4f8b\u6df7\u5408\uff0c\u82f1\u8bed\u5c06\u5360\u636e\u7edd\u5bf9\u4f18\u52bf\uff0c\u5c0f\u8bed\u79cd\u51e0\u4e4e\u5b66\u4e0d\u5230\u3002\u5e38\u89c1\u7684\u89e3\u51b3\u7b56\u7565\u5305\u62ec\uff1a</p> <p>\u4e0a\u91c7\u6837\u5c0f\u8bed\u79cd\u662f\u6700\u76f4\u63a5\u7684\u65b9\u6cd5\uff0c\u901a\u8fc7\u91cd\u590d\u91c7\u6837\u63d0\u9ad8\u5c0f\u8bed\u79cd\u6570\u636e\u7684\u6743\u91cd\u3002\u4f46\u8fc7\u5ea6\u91cd\u590d\u53ef\u80fd\u5bfc\u81f4\u8fc7\u62df\u5408\u3002</p> <p>\u6e29\u5ea6\u91c7\u6837\u662f\u66f4\u7cbe\u7ec6\u7684\u65b9\u6cd5\u3002\u8bbe\u5b9a\u4e00\u4e2a\u6e29\u5ea6\u53c2\u6570 T\uff0c\u8bed\u8a00 L \u7684\u91c7\u6837\u6982\u7387\u4e3a \\(p_L \\propto n_L^{T}\\)\uff0c\u5176\u4e2d \\(n_L\\) \u662f\u8be5\u8bed\u8a00\u7684\u539f\u59cb\u6570\u636e\u91cf\u3002T=1 \u65f6\u9000\u5316\u4e3a\u539f\u59cb\u6bd4\u4f8b\uff0cT\u2192\u221e \u65f6\u63a5\u8fd1\u5747\u5300\u5206\u5e03\u3002LLaMA 2 \u4f7f\u7528\u4e86 T=0.3 \u5de6\u53f3\u7684\u6e29\u5ea6\u91c7\u6837\u3002 \u8d28\u91cf\u4ee3\u66ff\u6570\u91cf\u7684\u601d\u8def\u4e5f\u503c\u5f97\u8003\u8651\u3002\u5bf9\u4e8e\u6570\u636e\u7a00\u7f3a\u7684\u5c0f\u8bed\u79cd\uff0c\u53ef\u4ee5\u4f7f\u7528\u7ffb\u8bd1\u6216\u5408\u6210\u7684\u65b9\u5f0f\u589e\u5f3a\u6570\u636e\uff0c\u4f46\u9700\u8981\u6ce8\u610f\u7ffb\u8bd1\u8d28\u91cf\u548c\u7ffb\u8bd1\u8154\u95ee\u9898\u3002</p>"},{"location":"part2/2_1_data_acquisition/#34","title":"3.4 \u6570\u636e\u83b7\u53d6\u7684\u5de5\u7a0b\u5b9e\u8df5","text":"<p>\u5c06\u4e0a\u8ff0\u5404\u4e2a\u73af\u8282\u4e32\u8054\u8d77\u6765\uff0c\u6784\u5efa\u4e00\u4e2a\u5b8c\u6574\u7684\u6570\u636e\u83b7\u53d6\u6d41\u6c34\u7ebf\uff0c\u9700\u8981\u8003\u8651\u5de5\u7a0b\u5c42\u9762\u7684\u8bf8\u591a\u7ec6\u8282\u3002</p>"},{"location":"part2/2_1_data_acquisition/#341","title":"3.4.1 \u722c\u866b\u67b6\u6784\u8bbe\u8ba1","text":"<p>\u5bf9\u4e8e\u9700\u8981\u81ea\u4e3b\u722c\u53d6\u6570\u636e\u7684\u573a\u666f\uff08\u800c\u975e\u4f7f\u7528 Common Crawl\uff09\uff0c\u5206\u5e03\u5f0f\u722c\u866b\u67b6\u6784\u7684\u8bbe\u8ba1\u81f3\u5173\u91cd\u8981\u3002\u4e00\u4e2a\u5178\u578b\u7684\u67b6\u6784\u5305\u62ec\u4ee5\u4e0b\u7ec4\u4ef6\uff1a</p> <p>URL \u7ba1\u7406\u5668\u8d1f\u8d23\u7ef4\u62a4\u5f85\u722c\u53d6 URL \u7684\u961f\u5217\uff0c\u8bb0\u5f55\u5df2\u722c\u53d6 URL \u7684\u72b6\u6001\uff0c\u5904\u7406 URL \u7684\u53bb\u91cd\u548c\u4f18\u5148\u7ea7\u6392\u5e8f\u3002\u5e38\u7528\u7684\u5b9e\u73b0\u65b9\u5f0f\u5305\u62ec Redis \u961f\u5217\u914d\u5408 Bloom Filter \u53bb\u91cd\u3002</p> <p></p> <p>\u56fe3-4\uff1a\u5206\u5e03\u5f0f\u7f51\u9875\u722c\u53d6\u7cfb\u7edf\u67b6\u6784 \u2014\u2014 URL\u7ba1\u7406\u5668\u3001\u4e0b\u8f7d\u5668\u96c6\u7fa4\u3001\u89e3\u6790\u5668\u4e0e\u5b58\u50a8\u5c42\u7684\u534f\u4f5c</p> <p>\u4e0b\u8f7d\u5668\u96c6\u7fa4\u8d1f\u8d23\u5b9e\u9645\u7684 HTTP \u8bf7\u6c42\u3002\u5173\u952e\u8003\u8651\u56e0\u7d20\u5305\u62ec\uff1a\u5e76\u53d1\u63a7\u5236\uff08\u907f\u514d\u5bf9\u76ee\u6807\u7f51\u7ad9\u9020\u6210\u8fc7\u5927\u538b\u529b\uff09\u3001\u4ee3\u7406\u6c60\u7ba1\u7406\uff08\u5e94\u5bf9\u53cd\u722c\u866b\u673a\u5236\uff09\u3001\u91cd\u8bd5\u7b56\u7565\uff08\u5904\u7406\u7f51\u7edc\u6ce2\u52a8\u548c\u4e34\u65f6\u6545\u969c\uff09\u3001robots.txt \u9075\u5b88\uff08\u5c0a\u91cd\u7f51\u7ad9\u7684\u722c\u866b\u89c4\u5219\uff09\u3002</p> <p>\u89e3\u6790\u5668\u8d1f\u8d23\u4ece\u4e0b\u8f7d\u7684 HTML \u4e2d\u63d0\u53d6\u6b63\u6587\u548c\u5143\u6570\u636e\uff0c\u8fd9\u90e8\u5206\u5728\u4e0a\u4e00\u8282\u5df2\u8be6\u7ec6\u8ba8\u8bba\u3002</p> <p>\u5b58\u50a8\u5c42\u8d1f\u8d23\u6301\u4e45\u5316\u722c\u53d6\u7ed3\u679c\u3002\u5bf9\u4e8e\u5927\u89c4\u6a21\u722c\u53d6\uff0c\u5efa\u8bae\u76f4\u63a5\u5199\u5165\u5bf9\u8c61\u5b58\u50a8\uff08S3/MinIO\uff09\uff0c\u91c7\u7528 WARC \u6216 Parquet \u683c\u5f0f\u3002</p> <pre><code># \u7b80\u5316\u7684\u722c\u866b\u793a\u4f8b\nimport asyncio\nimport aiohttp\nfrom urllib.parse import urlparse\nimport trafilatura\n\nclass SimpleCrawler:\n    def __init__(self, max_concurrent: int = 100):\n        self.max_concurrent = max_concurrent\n        self.semaphore = asyncio.Semaphore(max_concurrent)\n        self.visited = set()\n\n    async def fetch(self, session: aiohttp.ClientSession, url: str) -&gt; dict:\n        \"\"\"\u5f02\u6b65\u83b7\u53d6\u5e76\u89e3\u6790\u5355\u4e2a URL\"\"\"\n        if url in self.visited:\n            return None\n        self.visited.add(url)\n\n        async with self.semaphore:\n            try:\n                async with session.get(url, timeout=30) as response:\n                    if response.status != 200:\n                        return None\n                    html = await response.text()\n                    text = trafilatura.extract(html, url=url)\n                    return {'url': url, 'text': text} if text else None\n            except Exception:\n                return None\n\n    async def crawl(self, urls: list) -&gt; list:\n        \"\"\"\u6279\u91cf\u722c\u53d6 URL \u5217\u8868\"\"\"\n        async with aiohttp.ClientSession() as session:\n            tasks = [self.fetch(session, url) for url in urls]\n            results = await asyncio.gather(*tasks)\n            return [r for r in results if r is not None]\n</code></pre>"},{"location":"part2/2_1_data_acquisition/#342","title":"3.4.2 \u589e\u91cf\u66f4\u65b0\u7b56\u7565","text":"<p>\u9884\u8bad\u7ec3\u6570\u636e\u4e0d\u662f\u4e00\u6b21\u6027\u4efb\u52a1\u3002\u968f\u7740\u65f6\u95f4\u63a8\u79fb\uff0c\u9700\u8981\u6301\u7eed\u5438\u6536\u65b0\u6570\u636e\u4ee5\u4fdd\u6301\u6a21\u578b\u77e5\u8bc6\u7684\u65f6\u6548\u6027\u3002\u589e\u91cf\u66f4\u65b0\u7684\u5173\u952e\u6311\u6218\u5728\u4e8e\uff1a</p> <p>\u8bc6\u522b\u65b0\u6570\u636e\uff1a\u5bf9\u4e8e Common Crawl\uff0c\u6bcf\u6708\u53d1\u5e03\u65b0\u6279\u6b21\uff0c\u53ef\u4ee5\u76f4\u63a5\u5904\u7406\u65b0\u6279\u6b21\u3002\u5bf9\u4e8e\u81ea\u4e3b\u722c\u53d6\uff0c\u9700\u8981\u7ef4\u62a4\u66f4\u65b0\u65f6\u95f4\u6233\uff0c\u5b9a\u671f\u91cd\u65b0\u8bbf\u95ee\u5df2\u77e5 URL \u68c0\u67e5\u66f4\u65b0\u3002</p> <p>\u907f\u514d\u91cd\u590d\u5904\u7406\uff1a\u5df2\u7ecf\u5904\u7406\u8fc7\u7684\u6570\u636e\u4e0d\u5e94\u91cd\u590d\u8fdb\u5165\u6d41\u6c34\u7ebf\u3002\u53ef\u4ee5\u901a\u8fc7 URL \u6307\u7eb9\u3001\u5185\u5bb9\u54c8\u5e0c\u7b49\u65b9\u5f0f\u8fdb\u884c\u53bb\u91cd\u3002</p> <p>\u7248\u672c\u7ba1\u7406\uff1a\u6bcf\u4e2a\u5904\u7406\u6279\u6b21\u5e94\u8be5\u6709\u660e\u786e\u7684\u7248\u672c\u6807\u8bc6\uff0c\u4fbf\u4e8e\u8ffd\u6eaf\u548c\u56de\u6eda\u3002\u8fd9\u4e0e\u7b2c\u4e8c\u7ae0\u8ba8\u8bba\u7684\u6570\u636e\u7248\u672c\u63a7\u5236\uff08DVC/LakeFS\uff09\u7d27\u5bc6\u76f8\u5173\u3002</p>"},{"location":"part2/2_1_data_acquisition/#343","title":"3.4.3 \u8d28\u91cf\u76d1\u63a7\u4e0e\u53cd\u9988","text":"<p>\u6570\u636e\u83b7\u53d6\u6d41\u6c34\u7ebf\u9700\u8981\u5efa\u7acb\u5b8c\u5584\u7684\u8d28\u91cf\u76d1\u63a7\u673a\u5236\u3002\u5173\u952e\u7684\u76d1\u63a7\u6307\u6807\u5305\u62ec\uff1a</p> <p>\u4e0b\u8f7d\u6210\u529f\u7387\uff1a\u5931\u8d25\u8bf7\u6c42\u7684\u6bd4\u4f8b\u3002\u5982\u679c\u7a81\u7136\u5347\u9ad8\uff0c\u53ef\u80fd\u662f\u76ee\u6807\u7f51\u7ad9\u5c01\u7981\u4e86\u722c\u866b\u3002</p> <p>\u89e3\u6790\u6210\u529f\u7387\uff1a\u6210\u529f\u63d0\u53d6\u6b63\u6587\u7684\u6bd4\u4f8b\u3002\u5982\u679c\u964d\u4f4e\uff0c\u53ef\u80fd\u662f\u76ee\u6807\u7f51\u7ad9\u6539\u53d8\u4e86\u9875\u9762\u7ed3\u6784\u3002</p> <p>\u5e73\u5747\u6587\u6863\u957f\u5ea6\uff1a\u6b63\u6587\u7684\u5e73\u5747\u5b57\u7b26\u6570\u3002\u5f02\u5e38\u6ce2\u52a8\u53ef\u80fd\u8868\u793a\u89e3\u6790\u5668\u6709\u95ee\u9898\u3002</p> <p>\u8bed\u8a00\u5206\u5e03\uff1a\u5404\u8bed\u8a00\u6570\u636e\u7684\u6bd4\u4f8b\u3002\u786e\u4fdd\u7b26\u5408\u9884\u671f\u7684\u8bed\u8a00\u914d\u6bd4\u3002</p> <p>\u91cd\u590d\u7387\uff1a\u4e0e\u5386\u53f2\u6570\u636e\u7684\u91cd\u590d\u6bd4\u4f8b\u3002\u8fc7\u9ad8\u7684\u91cd\u590d\u7387\u610f\u5473\u7740\u65b0\u589e\u6570\u636e\u7684\u8fb9\u9645\u4ef7\u503c\u964d\u4f4e\u3002</p> <p>\u5efa\u8bae\u5c06\u8fd9\u4e9b\u6307\u6807\u96c6\u6210\u5230\u76d1\u63a7\u7cfb\u7edf\u4e2d\uff08\u5982 Prometheus + Grafana\uff09\uff0c\u8bbe\u7f6e\u544a\u8b66\u9608\u503c\uff0c\u53ca\u65f6\u53d1\u73b0\u548c\u5904\u7406\u5f02\u5e38\u3002</p>"},{"location":"part2/2_1_data_acquisition/#35","title":"3.5 \u5e38\u89c1\u9677\u9631\u4e0e\u6700\u4f73\u5b9e\u8df5","text":"<p>\u5728\u6570\u636e\u83b7\u53d6\u9636\u6bb5\uff0c\u6709\u51e0\u4e2a\u5e38\u89c1\u7684\u9677\u9631\u503c\u5f97\u8b66\u60d5\u3002</p> <p>\u7b2c\u4e00\u4e2a\u9677\u9631\u662f\u8fc7\u5ea6\u4f9d\u8d56\u5355\u4e00\u6570\u636e\u6e90\u3002 \u5982\u679c\u9884\u8bad\u7ec3\u6570\u636e\u5168\u90e8\u6765\u81ea Common Crawl\uff0c\u6a21\u578b\u53ef\u80fd\u4f1a\u7ee7\u627f\u7f51\u9875\u6570\u636e\u7684\u504f\u89c1\u548c\u566a\u58f0\u3002\u5408\u7406\u7684\u505a\u6cd5\u662f\u6df7\u5408\u591a\u79cd\u6765\u6e90\uff1a\u7f51\u9875\u6570\u636e\u63d0\u4f9b\u5e7f\u5ea6\uff0c\u4e66\u7c4d\u548c\u8bba\u6587\u63d0\u4f9b\u6df1\u5ea6\uff0c\u4ee3\u7801\u6570\u636e\u63d0\u4f9b\u903b\u8f91\u80fd\u529b\u3002The Pile \u5f0f\u7684\u591a\u6e90\u6df7\u5408\u7b56\u7565\u88ab\u8bc1\u660e\u662f\u6709\u6548\u7684\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u9677\u9631\u662f\u5ffd\u89c6\u6570\u636e\u7684\u65f6\u6548\u6027\u3002 Common Crawl \u7684\u5386\u53f2\u6279\u6b21\u867d\u7136\u91cf\u5927\uff0c\u4f46\u53ef\u80fd\u5305\u542b\u8fc7\u65f6\u4fe1\u606f\u3002\u5bf9\u4e8e\u9700\u8981\u65f6\u6548\u6027\u7684\u5e94\u7528\uff08\u5982\u65b0\u95fb\u3001\u65f6\u4e8b\uff09\uff0c\u5e94\u8be5\u4f18\u5148\u4f7f\u7528\u6700\u8fd1\u7684\u6570\u636e\u6279\u6b21\u3002\u540c\u65f6\uff0c\u8fc7\u8001\u7684\u6570\u636e\u53ef\u80fd\u5305\u542b\u5df2\u5931\u6548\u7684\u94fe\u63a5\u3001\u5df2\u66f4\u6b63\u7684\u9519\u8bef\u4fe1\u606f\u7b49\u3002</p> <p>\u7b2c\u4e09\u4e2a\u9677\u9631\u662f\u4f4e\u4f30\u5408\u89c4\u98ce\u9669\u3002 \u7248\u6743\u95ee\u9898\u3001\u9690\u79c1\u95ee\u9898\u3001robots.txt \u8fdd\u89c4\u7b49\uff0c\u53ef\u80fd\u5728\u9879\u76ee\u540e\u671f\u5f15\u53d1\u4e25\u91cd\u7684\u6cd5\u5f8b\u95ee\u9898\u3002\u6700\u4f73\u5b9e\u8df5\u662f\u5728\u6570\u636e\u83b7\u53d6\u9636\u6bb5\u5c31\u5efa\u7acb\u5b8c\u5584\u7684\u5143\u6570\u636e\u8bb0\u5f55\u2014\u2014\u8bb0\u5f55\u6bcf\u6761\u6570\u636e\u7684\u6765\u6e90 URL\u3001\u83b7\u53d6\u65f6\u95f4\u3001\u58f0\u79f0\u7684\u8bb8\u53ef\u8bc1\u7b49\u4fe1\u606f\uff0c\u4e3a\u65e5\u540e\u53ef\u80fd\u7684\u5ba1\u8ba1\u7559\u4e0b\u4f9d\u636e\u3002</p> <p>\u7b2c\u56db\u4e2a\u9677\u9631\u662f\u91cd\u91c7\u96c6\u8f7b\u5904\u7406\u3002 \u8bb8\u591a\u56e2\u961f\u82b1\u8d39\u5927\u91cf\u7cbe\u529b\u6269\u5927\u6570\u636e\u91c7\u96c6\u89c4\u6a21\uff0c\u5374\u5728\u89e3\u6790\u548c\u6e05\u6d17\u73af\u8282\u8349\u8349\u4e86\u4e8b\u3002\u6b63\u5982\u7b2c\u4e00\u7ae0\u6240\u8ff0\uff0c\u6570\u636e\u8d28\u91cf\u7684\u91cd\u8981\u6027\u8fdc\u8d85\u6570\u636e\u6570\u91cf\u3002\u5b81\u53ef\u5c11\u91c7\u96c6\u4e00\u4e9b\uff0c\u4e5f\u8981\u786e\u4fdd\u6bcf\u4efd\u6570\u636e\u7ecf\u8fc7\u4e25\u683c\u7684\u8d28\u91cf\u628a\u5173\u3002</p>"},{"location":"part2/2_1_data_acquisition/#36","title":"3.6 \u672c\u7ae0\u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u7cfb\u7edf\u4ecb\u7ecd\u4e86\u9884\u8bad\u7ec3\u6570\u636e\u83b7\u53d6\u7684\u65b9\u6cd5\u8bba\u548c\u5de5\u7a0b\u5b9e\u8df5\u3002</p> <p>\u5728\u5f00\u6e90\u6570\u636e\u96c6\u65b9\u9762\uff0cCommon Crawl \u662f\u6700\u91cd\u8981\u7684\u4e0a\u6e38\u6570\u636e\u6e90\uff0c\u63d0\u4f9b WARC\u3001WAT\u3001WET \u4e09\u79cd\u683c\u5f0f\u3002RefinedWeb \u548c The Pile \u662f\u7ecf\u8fc7\u7cbe\u5fc3\u5904\u7406\u7684\u9ad8\u8d28\u91cf\u6570\u636e\u96c6\uff0c\u5176\u5904\u7406\u65b9\u6cd5\u503c\u5f97\u5b66\u4e60\u501f\u9274\u3002\u4e2d\u6587\u6570\u636e\u96c6\u76f8\u5bf9\u7a00\u7f3a\uff0c\u5f80\u5f80\u9700\u8981\u81ea\u884c\u4ece Common Crawl \u63d0\u53d6\u3002</p> <p>\u5728\u7f51\u9875\u89e3\u6790\u65b9\u9762\uff0cTrafilatura \u662f\u76ee\u524d\u6700\u63a8\u8350\u7684\u5de5\u4e1a\u7ea7\u89e3\u6790\u5e93\uff0c\u80fd\u591f\u4ece\u590d\u6742\u7684 HTML \u4e2d\u51c6\u786e\u63d0\u53d6\u6b63\u6587\u5185\u5bb9\u3002\u5206\u5e03\u5f0f\u89e3\u6790\u67b6\u6784\uff08\u5982\u57fa\u4e8e Ray Data\uff09\u662f\u5904\u7406 TB \u7ea7\u6570\u636e\u7684\u5fc5\u8981\u624b\u6bb5\u3002</p> <p>\u5728\u7279\u79cd\u6570\u636e\u65b9\u9762\uff0c\u4ee3\u7801\u6570\u636e\u53ef\u901a\u8fc7 The Stack \u6216 GitHub BigQuery \u83b7\u53d6\uff0c\u9700\u6ce8\u610f\u8bb8\u53ef\u8bc1\u5408\u89c4\uff1b\u5b66\u672f\u8bba\u6587\u53ef\u901a\u8fc7 ArXiv \u548c S2ORC \u83b7\u53d6\uff1b\u4e66\u7c4d\u6570\u636e\u7684\u7248\u6743\u98ce\u9669\u8f83\u9ad8\uff0c\u5efa\u8bae\u4f7f\u7528\u516c\u5171\u9886\u57df\u8d44\u6e90\u3002\u591a\u8bed\u8a00\u6570\u636e\u9700\u8981\u901a\u8fc7\u6e29\u5ea6\u91c7\u6837\u7b49\u7b56\u7565\u8fdb\u884c\u5e73\u8861\u3002</p> <p>\u5728\u5de5\u7a0b\u5b9e\u8df5\u65b9\u9762\uff0c\u5b8c\u6574\u7684\u6570\u636e\u83b7\u53d6\u6d41\u6c34\u7ebf\u9700\u8981\u8003\u8651\u722c\u866b\u67b6\u6784\u8bbe\u8ba1\u3001\u589e\u91cf\u66f4\u65b0\u7b56\u7565\u548c\u8d28\u91cf\u76d1\u63a7\u673a\u5236\u3002\u6838\u5fc3\u539f\u5219\u662f\u591a\u6e90\u6df7\u5408\u3001\u8d28\u91cf\u4f18\u5148\u3001\u5408\u89c4\u5148\u884c\u3002</p> <p></p> <p>\u56fe3-5\uff1a\u7b2c3\u7ae0\u77e5\u8bc6\u7ed3\u6784 \u2014\u2014 \u6db5\u76d6\u5f00\u6e90\u6570\u636e\u96c6\u3001\u7f51\u9875\u89e3\u6790\u3001\u7279\u79cd\u6570\u636e\u3001\u5de5\u7a0b\u5b9e\u8df5\u56db\u5927\u4e3b\u9898</p>"},{"location":"part2/2_1_data_acquisition/#_3","title":"\u5ef6\u4f38\u9605\u8bfb","text":"<p>\u5173\u4e8e\u9884\u8bad\u7ec3\u6570\u636e\u83b7\u53d6\u7684\u6df1\u5165\u5185\u5bb9\uff0c\u4ee5\u4e0b\u8d44\u6e90\u503c\u5f97\u53c2\u8003\uff1a</p> <p>Common Crawl \u5b98\u65b9\u6587\u6863\uff08commoncrawl.org/the-data\uff09\u8be6\u7ec6\u4ecb\u7ecd\u4e86\u6570\u636e\u683c\u5f0f\u548c\u83b7\u53d6\u65b9\u5f0f\u3002RefinedWeb \u8bba\u6587\uff08Falcon LLM: A Large Language Model for High-Quality Web Data\uff09\u8be6\u7ec6\u8bb0\u5f55\u4e86\u4ece Common Crawl \u6784\u5efa\u9ad8\u8d28\u91cf\u9884\u8bad\u7ec3\u96c6\u7684\u5b8c\u6574\u6d41\u7a0b\u3002The Pile \u8bba\u6587\uff08The Pile: An 800GB Dataset of Diverse Text for Language Modeling\uff09\u4ecb\u7ecd\u4e86\u591a\u6e90\u6df7\u5408\u7684\u6570\u636e\u6784\u5efa\u7b56\u7565\u3002Trafilatura \u6587\u6863\uff08trafilatura.readthedocs.io\uff09\u63d0\u4f9b\u4e86\u5168\u9762\u7684 API \u8bf4\u660e\u548c\u4f7f\u7528\u793a\u4f8b\u3002The Stack \u8bba\u6587\uff08StarCoder: May the Source Be with You!\uff09\u4ecb\u7ecd\u4e86\u5927\u89c4\u6a21\u4ee3\u7801\u6570\u636e\u96c6\u7684\u6784\u5efa\u65b9\u6cd5\u3002</p>"},{"location":"part2/2_1_data_acquisition/#_4","title":"\u4e0b\u4e00\u7ae0\u9884\u544a","text":"<p>\u83b7\u53d6\u539f\u59cb\u6570\u636e\u53ea\u662f\u7b2c\u4e00\u6b65\u3002\u5728\u4e0b\u4e00\u7ae0\u300a\u6e05\u6d17\u4e0e\u53bb\u566a\u300b\u4e2d\uff0c\u6211\u4eec\u5c06\u6df1\u5165\u63a2\u8ba8\u5982\u4f55\u4ece\u6d77\u91cf\u539f\u59cb\u6570\u636e\u4e2d\u7b5b\u9009\u51fa\u9ad8\u8d28\u91cf\u5185\u5bb9\u3002\u4f60\u5c06\u5b66\u4e60\u542f\u53d1\u5f0f\u8fc7\u6ee4\u89c4\u5219\uff08\u8bed\u8a00\u8bc6\u522b\u3001\u56f0\u60d1\u5ea6\u8fc7\u6ee4\u3001\u957f\u5ea6\u5206\u5e03\uff09\u3001\u5927\u89c4\u6a21\u53bb\u91cd\u6280\u672f\uff08MinHash LSH \u7684\u539f\u7406\u4e0e\u5206\u5e03\u5f0f\u5b9e\u73b0\uff09\uff0c\u4ee5\u53ca\u9690\u79c1\u6570\u636e\u6e05\u6d17\uff08PII \u8bc6\u522b\u4e0e\u79fb\u9664\uff09\u3002</p> <p>\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\u8fdb\u5165\u4e0b\u4e00\u7ae0\uff1a\u5982\u679c\u4e24\u7bc7\u6587\u6863\u6709 80% \u7684\u5185\u5bb9\u76f8\u540c\uff0c\u4f60\u5982\u4f55\u9ad8\u6548\u5730\u8bc6\u522b\u5e76\u5904\u7406\u5b83\u4eec\uff1f</p>"},{"location":"part2/2_2_cleaning_denoising/","title":"\u7b2c4\u7ae0\uff1a\u6e05\u6d17\u4e0e\u53bb\u566a","text":""},{"location":"part2/2_2_cleaning_denoising/#4pii","title":"\u7b2c4\u7ae0\uff1a\u6e05\u6d17\u4e0e\u8d28\u91cf\u63a7\u5236\uff08\u53bb\u91cd\u3001PII \u8131\u654f\u3001\u9632\u57fa\u51c6\u6c61\u67d3\uff09","text":""},{"location":"part2/2_2_cleaning_denoising/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u4ece\u4e92\u8054\u7f51\u83b7\u53d6\u7684\u539f\u59cb\u6570\u636e\u5c31\u50cf\u672a\u7ecf\u52a0\u5de5\u7684\u77ff\u77f3\uff0c\u5176\u4e2d\u771f\u6b63\u6709\u4ef7\u503c\u7684\"\u7cbe\u77ff\"\u53ef\u80fd\u53ea\u5360\u5f88\u5c0f\u7684\u6bd4\u4f8b\u3002\u672c\u7ae0\u5c06\u6df1\u5165\u63a2\u8ba8\u9884\u8bad\u7ec3\u6570\u636e\u6e05\u6d17\u7684\u4e09\u5927\u6838\u5fc3\u6280\u672f\uff1a\u542f\u53d1\u5f0f\u8fc7\u6ee4\u89c4\u5219\u7528\u4e8e\u5254\u9664\u4f4e\u8d28\u91cf\u6587\u6863\uff0c\u5927\u89c4\u6a21\u53bb\u91cd\u6280\u672f\u7528\u4e8e\u6d88\u9664\u91cd\u590d\u5185\u5bb9\uff0c\u9690\u79c1\u6570\u636e\u6e05\u6d17\u7528\u4e8e\u4fdd\u62a4\u7528\u6237\u4fe1\u606f\u3002\u638c\u63e1\u8fd9\u4e9b\u6280\u672f\u540e\uff0c\u8bfb\u8005\u5c06\u80fd\u591f\u6784\u5efa\u5de5\u4e1a\u7ea7\u7684\u6570\u636e\u6e05\u6d17\u6d41\u6c34\u7ebf\uff0c\u5c06\u539f\u59cb\u7f51\u9875\u6570\u636e\u8f6c\u5316\u4e3a\u9ad8\u8d28\u91cf\u7684\u9884\u8bad\u7ec3\u8bed\u6599\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#_2","title":"\u573a\u666f\u5f15\u5165","text":"<p>\u7ecf\u8fc7\u4e0a\u4e00\u7ae0\u7684\u52aa\u529b\uff0c\u4f60\u7684\u56e2\u961f\u6210\u529f\u4ece Common Crawl \u63d0\u53d6\u4e86 50TB \u7684\u4e2d\u6587\u7f51\u9875\u6587\u672c\u3002\u7136\u800c\uff0c\u5f53\u4f60\u968f\u673a\u62bd\u6837\u67e5\u770b\u6570\u636e\u65f6\uff0c\u53d1\u73b0\u4e86\u5404\u79cd\u4ee4\u4eba\u5934\u75bc\u7684\u95ee\u9898\uff1a\u5927\u91cf\u9875\u9762\u53ea\u6709\u51e0\u4e2a\u5b57\u7684\u5bfc\u822a\u6587\u672c\uff0c\u5b8c\u5168\u6ca1\u6709\u5b9e\u8d28\u5185\u5bb9\uff1b\u6709\u4e9b\u9875\u9762\u5168\u662f JavaScript \u4ee3\u7801\u6216 CSS \u6837\u5f0f\u7684\u6b8b\u7559\uff1b\u67d0\u4e9b\u7f51\u7ad9\u7684\u5185\u5bb9\u88ab\u91cd\u590d\u722c\u53d6\u4e86\u6570\u767e\u6b21\uff1b\u8fd8\u6709\u5927\u91cf\u5e26\u6709\u7528\u6237\u90ae\u7bb1\u3001\u624b\u673a\u53f7\u7801\u7684\u654f\u611f\u4fe1\u606f\u3002</p> <p>\u66f4\u7cdf\u7cd5\u7684\u662f\uff0c\u8bad\u7ec3\u5de5\u7a0b\u5e08\u544a\u8bc9\u4f60\uff0c\u4e0a\u6b21\u7528\u672a\u7ecf\u6e05\u6d17\u7684\u6570\u636e\u8bad\u7ec3\u7684\u6a21\u578b\u6709\u4e25\u91cd\u7684\"\u590d\u8bfb\u673a\"\u95ee\u9898\u2014\u2014\u6a21\u578b\u4f1a\u53cd\u590d\u8f93\u51fa\u76f8\u540c\u7684\u53e5\u5b50\uff0c\u751a\u81f3\u80fd\u591f\u80cc\u8bf5\u51fa\u67d0\u4e9b\u7f51\u7ad9\u7684\u5b8c\u6574\u5185\u5bb9\u3002\u8fd9\u663e\u7136\u662f\u6570\u636e\u91cd\u590d\u5bfc\u81f4\u7684\u3002</p> <p>\u5982\u4f55\u7cfb\u7edf\u6027\u5730\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff1f\u672c\u7ae0\u5c06\u7ed9\u51fa\u5b8c\u6574\u7684\u7b54\u6848\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#41","title":"4.1 \u542f\u53d1\u5f0f\u8fc7\u6ee4\u89c4\u5219","text":"<p>\u542f\u53d1\u5f0f\u8fc7\u6ee4\uff08Heuristic Filtering\uff09\u662f\u6570\u636e\u6e05\u6d17\u7684\u7b2c\u4e00\u9053\u9632\u7ebf\u3002\u5b83\u57fa\u4e8e\u4e00\u7cfb\u5217\u53ef\u91cf\u5316\u7684\u89c4\u5219\uff0c\u5feb\u901f\u7b5b\u9009\u51fa\u660e\u663e\u4f4e\u8d28\u91cf\u7684\u6587\u6863\u3002\u867d\u7136\u8fd9\u4e9b\u89c4\u5219\u770b\u8d77\u6765\u7b80\u5355\uff0c\u4f46\u5728\u5b9e\u8df5\u4e2d\u80fd\u591f\u8fc7\u6ee4\u6389\u5927\u90e8\u5206\u566a\u58f0\u6570\u636e\uff0c\u662f\u6027\u4ef7\u6bd4\u6781\u9ad8\u7684\u6e05\u6d17\u624b\u6bb5\u3002</p> <p></p> <p>\u56fe4-1\uff1a\u6570\u636e\u6e05\u6d17\u6d41\u6c34\u7ebf\u67b6\u6784 \u2014\u2014 \u4ece\u539f\u59cb\u6570\u636e\u5230\u6e05\u6d01\u8bed\u6599\u7684\u516b\u9636\u6bb5\u5904\u7406\u6d41\u7a0b</p>"},{"location":"part2/2_2_cleaning_denoising/#411","title":"4.1.1 \u8bed\u8a00\u8bc6\u522b","text":"<p>\u8bed\u8a00\u8bc6\u522b\u662f\u591a\u8bed\u8a00\u6570\u636e\u5904\u7406\u7684\u57fa\u7840\u6b65\u9aa4\u3002\u5bf9\u4e8e\u8bad\u7ec3\u4e2d\u6587\u6a21\u578b\u800c\u8a00\uff0c\u9996\u5148\u9700\u8981\u4ece Common Crawl \u7684\u6d77\u91cf\u6570\u636e\u4e2d\u7b5b\u9009\u51fa\u4e2d\u6587\u5185\u5bb9\uff0c\u8fd9\u5c31\u9700\u8981\u51c6\u786e\u7684\u8bed\u8a00\u8bc6\u522b\u80fd\u529b\u3002</p> <p>FastText \u8bed\u8a00\u8bc6\u522b\u5668\u662f\u76ee\u524d\u6700\u5e38\u7528\u7684\u5de5\u5177\u3002\u5b83\u7531 Facebook AI Research \u5f00\u53d1\uff0c\u9884\u8bad\u7ec3\u6a21\u578b\u652f\u6301 176 \u79cd\u8bed\u8a00\u7684\u8bc6\u522b\uff0c\u901f\u5ea6\u6781\u5feb\uff0c\u51c6\u786e\u7387\u4e5f\u76f8\u5f53\u9ad8\u3002FastText \u63d0\u4f9b\u4e24\u4e2a\u9884\u8bad\u7ec3\u6a21\u578b\uff1a<code>lid.176.bin</code> \u662f\u5b8c\u6574\u7248\u672c\uff0c\u51c6\u786e\u7387\u66f4\u9ad8\u4f46\u4f53\u79ef\u8f83\u5927\uff08\u7ea6 126MB\uff09\uff1b<code>lid.176.ftz</code> \u662f\u538b\u7f29\u7248\u672c\uff0c\u4f53\u79ef\u5c0f\uff08\u7ea6 917KB\uff09\u4f46\u51c6\u786e\u7387\u7565\u4f4e\u3002\u5bf9\u4e8e\u5927\u89c4\u6a21\u6570\u636e\u5904\u7406\uff0c\u5efa\u8bae\u4f7f\u7528\u5b8c\u6574\u7248\u672c\u3002</p> <pre><code>import fasttext\n\n# \u52a0\u8f7d\u8bed\u8a00\u8bc6\u522b\u6a21\u578b\nlang_model = fasttext.load_model('lid.176.bin')\n\ndef detect_language(text: str, min_confidence: float = 0.8) -&gt; tuple:\n    \"\"\"\n    \u8bc6\u522b\u6587\u672c\u8bed\u8a00\n\n    Args:\n        text: \u5f85\u8bc6\u522b\u7684\u6587\u672c\n        min_confidence: \u6700\u4f4e\u7f6e\u4fe1\u5ea6\u9608\u503c\n\n    Returns:\n        (\u8bed\u8a00\u4ee3\u7801, \u7f6e\u4fe1\u5ea6) \u6216 (None, 0) \u5982\u679c\u7f6e\u4fe1\u5ea6\u4e0d\u8db3\n    \"\"\"\n    # \u9884\u5904\u7406\uff1a\u79fb\u9664\u6362\u884c\u7b26\uff0c\u622a\u53d6\u524d 1000 \u5b57\u7b26\n    text = text.replace('\\n', ' ')[:1000]\n\n    # \u9884\u6d4b\n    predictions = lang_model.predict(text, k=1)\n    lang = predictions[0][0].replace('__label__', '')\n    confidence = predictions[1][0]\n\n    if confidence &gt;= min_confidence:\n        return lang, confidence\n    return None, confidence\n\ndef filter_by_language(documents: list, target_lang: str = 'zh') -&gt; list:\n    \"\"\"\u8fc7\u6ee4\u6307\u5b9a\u8bed\u8a00\u7684\u6587\u6863\"\"\"\n    results = []\n    for doc in documents:\n        lang, conf = detect_language(doc['text'])\n        if lang == target_lang:\n            doc['detected_lang'] = lang\n            doc['lang_confidence'] = conf\n            results.append(doc)\n    return results\n</code></pre> <p>\u8bed\u8a00\u8bc6\u522b\u5728\u5b9e\u8df5\u4e2d\u4f1a\u9047\u5230\u4e00\u4e9b\u8fb9\u754c\u60c5\u51b5\u3002\u6df7\u5408\u8bed\u8a00\u7684\u6587\u6863\uff08\u5982\u4e2d\u82f1\u6587\u6df7\u6742\u7684\u6280\u672f\u535a\u5ba2\uff09\u53ef\u80fd\u88ab\u9519\u8bef\u5206\u7c7b\u3002\u77ed\u6587\u672c\u7684\u8bc6\u522b\u51c6\u786e\u7387\u8f83\u4f4e\uff0c\u5efa\u8bae\u5bf9\u957f\u5ea6\u4e0d\u8db3 50 \u5b57\u7b26\u7684\u6587\u672c\u8df3\u8fc7\u8bed\u8a00\u8fc7\u6ee4\u3002\u4ee3\u7801\u7247\u6bb5\u53ef\u80fd\u88ab\u8bc6\u522b\u4e3a\u5404\u79cd\u8bed\u8a00\uff0c\u9700\u8981\u7ed3\u5408\u5185\u5bb9\u7c7b\u578b\u8fdb\u884c\u5224\u65ad\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#412","title":"4.1.2 \u6587\u672c\u8d28\u91cf\u8bc4\u5206","text":"<p>\u8bed\u8a00\u8bc6\u522b\u53ea\u80fd\u786e\u4fdd\u6587\u6863\u662f\u76ee\u6807\u8bed\u8a00\uff0c\u4f46\u65e0\u6cd5\u5224\u65ad\u5185\u5bb9\u8d28\u91cf\u3002\u4e00\u6bb5\u8bed\u6cd5\u6b63\u786e\u7684\u5783\u573e\u5e7f\u544a\u548c\u4e00\u7bc7\u4f18\u8d28\u7684\u6280\u672f\u6587\u7ae0\uff0c\u5728\u8bed\u8a00\u8bc6\u522b\u4e0a\u53ef\u80fd\u5f97\u5230\u76f8\u540c\u7684\u5206\u6570\u3002\u8fd9\u5c31\u9700\u8981\u66f4\u7cbe\u7ec6\u7684\u8d28\u91cf\u8bc4\u4f30\u673a\u5236\u3002</p> <p>\u56f0\u60d1\u5ea6\uff08Perplexity\uff09\u8fc7\u6ee4\u662f\u4e00\u79cd\u57fa\u4e8e\u8bed\u8a00\u6a21\u578b\u7684\u8d28\u91cf\u8bc4\u4f30\u65b9\u6cd5\u3002\u56f0\u60d1\u5ea6\u8861\u91cf\u7684\u662f\u8bed\u8a00\u6a21\u578b\u5bf9\u6587\u672c\u7684\"\u60ca\u8bb6\u7a0b\u5ea6\"\u2014\u2014\u5982\u679c\u4e00\u6bb5\u6587\u672c\u4e0e\u6a21\u578b\u8bad\u7ec3\u6570\u636e\u7684\u5206\u5e03\u76f8\u4f3c\uff0c\u56f0\u60d1\u5ea6\u5c31\u4f4e\uff1b\u5982\u679c\u6587\u672c\u5305\u542b\u5927\u91cf\u566a\u58f0\u3001\u4e71\u7801\u6216\u4e0d\u81ea\u7136\u7684\u8868\u8fbe\uff0c\u56f0\u60d1\u5ea6\u5c31\u9ad8\u3002</p> <p>KenLM \u662f\u8ba1\u7b97\u56f0\u60d1\u5ea6\u6700\u5e38\u7528\u7684\u5de5\u5177\u3002\u5b83\u57fa\u4e8e n-gram \u8bed\u8a00\u6a21\u578b\uff0c\u901f\u5ea6\u6781\u5feb\uff0c\u9002\u5408\u5927\u89c4\u6a21\u6570\u636e\u5904\u7406\u3002</p> <pre><code>import kenlm\n\nclass PerplexityFilter:\n    def __init__(self, model_path: str, max_perplexity: float = 500):\n        \"\"\"\n        \u521d\u59cb\u5316\u56f0\u60d1\u5ea6\u8fc7\u6ee4\u5668\n\n        Args:\n            model_path: KenLM \u6a21\u578b\u8def\u5f84 (.arpa \u6216 .bin)\n            max_perplexity: \u56f0\u60d1\u5ea6\u9608\u503c\uff0c\u8d85\u8fc7\u6b64\u503c\u7684\u6587\u6863\u5c06\u88ab\u8fc7\u6ee4\n        \"\"\"\n        self.model = kenlm.Model(model_path)\n        self.max_perplexity = max_perplexity\n\n    def compute_perplexity(self, text: str) -&gt; float:\n        \"\"\"\u8ba1\u7b97\u6587\u672c\u7684\u56f0\u60d1\u5ea6\"\"\"\n        # KenLM \u8fd4\u56de\u7684\u662f log10 \u6982\u7387\n        log_prob = self.model.score(text, bos=True, eos=True)\n        # \u8f6c\u6362\u4e3a\u56f0\u60d1\u5ea6\n        num_words = len(text.split()) + 1  # +1 for EOS\n        perplexity = 10 ** (-log_prob / num_words)\n        return perplexity\n\n    def filter(self, documents: list) -&gt; list:\n        \"\"\"\u8fc7\u6ee4\u9ad8\u56f0\u60d1\u5ea6\u6587\u6863\"\"\"\n        results = []\n        for doc in documents:\n            ppl = self.compute_perplexity(doc['text'])\n            if ppl &lt;= self.max_perplexity:\n                doc['perplexity'] = ppl\n                results.append(doc)\n        return results\n</code></pre> <p>\u56f0\u60d1\u5ea6\u9608\u503c\u7684\u8bbe\u5b9a\u9700\u8981\u6839\u636e\u5177\u4f53\u6570\u636e\u8fdb\u884c\u8c03\u4f18\u3002\u4e00\u822c\u800c\u8a00\uff0c\u9ad8\u8d28\u91cf\u7684\u65b0\u95fb\u548c\u767e\u79d1\u6587\u672c\u56f0\u60d1\u5ea6\u5728 100-200 \u4e4b\u95f4\uff0c\u666e\u901a\u7f51\u9875\u5185\u5bb9\u5728 200-500 \u4e4b\u95f4\uff0c\u4f4e\u8d28\u91cf\u5185\u5bb9\uff08\u5982\u4e71\u7801\u3001\u673a\u5668\u7ffb\u8bd1\uff09\u901a\u5e38\u8d85\u8fc7 500\u3002\u5efa\u8bae\u5148\u5728\u5c0f\u89c4\u6a21\u6837\u672c\u4e0a\u5206\u6790\u56f0\u60d1\u5ea6\u5206\u5e03\uff0c\u518d\u786e\u5b9a\u5408\u9002\u7684\u9608\u503c\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#413","title":"4.1.3 \u542f\u53d1\u5f0f\u89c4\u5219\u96c6","text":"<p>\u9664\u4e86\u8bed\u8a00\u8bc6\u522b\u548c\u56f0\u60d1\u5ea6\u8fc7\u6ee4\uff0c\u8fd8\u6709\u4e00\u7cfb\u5217\u7b80\u5355\u4f46\u6709\u6548\u7684\u542f\u53d1\u5f0f\u89c4\u5219\uff0c\u53ef\u4ee5\u5feb\u901f\u5254\u9664\u660e\u663e\u7684\u4f4e\u8d28\u91cf\u5185\u5bb9\u3002\u8fd9\u4e9b\u89c4\u5219\u7684\u8bbe\u8ba1\u6765\u6e90\u4e8e\u5bf9\u5927\u91cf\u6570\u636e\u7684\u89c2\u5bdf\u548c\u7ecf\u9a8c\u603b\u7ed3\u3002</p> <p>\u957f\u5ea6\u8fc7\u6ee4\u662f\u6700\u57fa\u672c\u7684\u89c4\u5219\u3002\u8fc7\u77ed\u7684\u6587\u6863\uff08\u5982\u53ea\u6709\u51e0\u4e2a\u8bcd\u7684\u5bfc\u822a\u6587\u672c\uff09\u6ca1\u6709\u8bad\u7ec3\u4ef7\u503c\uff0c\u5e94\u8be5\u76f4\u63a5\u79fb\u9664\u3002\u8fc7\u957f\u7684\u6587\u6863\u53ef\u80fd\u9700\u8981\u622a\u65ad\u6216\u5206\u6bb5\u5904\u7406\u3002\u5178\u578b\u7684\u9608\u503c\u8bbe\u5b9a\u662f\uff1a\u6700\u5c0f\u957f\u5ea6 200 \u5b57\u7b26\u6216 50 \u8bcd\uff0c\u6700\u5927\u957f\u5ea6 100,000 \u5b57\u7b26\u3002</p> <p>\u7279\u6b8a\u5b57\u7b26\u6bd4\u4f8b\u53ef\u4ee5\u8bc6\u522b\u51fa\u5927\u91cf\u566a\u58f0\u5185\u5bb9\u3002\u5982\u679c\u4e00\u4e2a\u6587\u6863\u4e2d\u975e\u5b57\u6bcd\u6570\u5b57\u5b57\u7b26\u7684\u6bd4\u4f8b\u8fc7\u9ad8\uff0c\u5f88\u53ef\u80fd\u662f\u4ee3\u7801\u6b8b\u7559\u3001\u4e71\u7801\u6216\u683c\u5f0f\u9519\u8bef\u3002\u7c7b\u4f3c\u5730\uff0c\u6570\u5b57\u6bd4\u4f8b\u8fc7\u9ad8\u53ef\u80fd\u8868\u793a\u662f\u65e5\u5fd7\u6587\u4ef6\u6216\u6570\u636e\u8868\u683c\u3002</p> <p>\u91cd\u590d\u884c\u6bd4\u4f8b\u53ef\u4ee5\u68c0\u6d4b\u51fa\u6a21\u677f\u5316\u7684\u4f4e\u8d28\u91cf\u9875\u9762\u3002\u5982\u679c\u4e00\u4e2a\u6587\u6863\u4e2d\u6709\u5927\u91cf\u5b8c\u5168\u76f8\u540c\u7684\u884c\uff08\u5982\u5bfc\u822a\u680f\u5728\u9875\u9762\u591a\u5904\u91cd\u590d\uff09\uff0c\u8bf4\u660e\u5185\u5bb9\u8d28\u91cf\u8f83\u4f4e\u3002</p> <p>\u8bcd\u6c47\u591a\u6837\u6027\u8861\u91cf\u6587\u6863\u7684\u4fe1\u606f\u4e30\u5bcc\u7a0b\u5ea6\u3002\u4e00\u4e2a\u53ea\u4f7f\u7528 10 \u4e2a\u4e0d\u540c\u8bcd\u6c47\u7684\u6587\u6863\u663e\u7136\u4e0d\u5982\u4f7f\u7528 500 \u4e2a\u4e0d\u540c\u8bcd\u6c47\u7684\u6587\u6863\u6709\u4ef7\u503c\u3002\u5e38\u7528\u7684\u6307\u6807\u662f Type-Token Ratio\uff08TTR\uff09\uff0c\u5373\u552f\u4e00\u8bcd\u6570\u4e0e\u603b\u8bcd\u6570\u7684\u6bd4\u503c\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7efc\u5408\u7684\u542f\u53d1\u5f0f\u8fc7\u6ee4\u5668\u5b9e\u73b0\uff1a</p> <pre><code>import re\nfrom collections import Counter\n\nclass HeuristicFilter:\n    def __init__(self, config: dict = None):\n        \"\"\"\n        \u521d\u59cb\u5316\u542f\u53d1\u5f0f\u8fc7\u6ee4\u5668\n\n        \u9ed8\u8ba4\u914d\u7f6e\u9002\u7528\u4e8e\u4e2d\u6587\u9884\u8bad\u7ec3\u6570\u636e\n        \"\"\"\n        self.config = config or {\n            'min_length': 200,           # \u6700\u5c0f\u5b57\u7b26\u6570\n            'max_length': 100000,        # \u6700\u5927\u5b57\u7b26\u6570\n            'min_words': 50,             # \u6700\u5c0f\u8bcd\u6570\n            'max_special_ratio': 0.3,    # \u6700\u5927\u7279\u6b8a\u5b57\u7b26\u6bd4\u4f8b\n            'max_digit_ratio': 0.3,      # \u6700\u5927\u6570\u5b57\u6bd4\u4f8b\n            'max_duplicate_line_ratio': 0.3,  # \u6700\u5927\u91cd\u590d\u884c\u6bd4\u4f8b\n            'min_avg_word_length': 2,    # \u6700\u5c0f\u5e73\u5747\u8bcd\u957f\n            'max_avg_word_length': 20,   # \u6700\u5927\u5e73\u5747\u8bcd\u957f\n            'min_unique_word_ratio': 0.1 # \u6700\u5c0f\u8bcd\u6c47\u591a\u6837\u6027\n        }\n\n    def check_length(self, text: str) -&gt; bool:\n        \"\"\"\u68c0\u67e5\u6587\u6863\u957f\u5ea6\"\"\"\n        length = len(text)\n        return self.config['min_length'] &lt;= length &lt;= self.config['max_length']\n\n    def check_special_chars(self, text: str) -&gt; bool:\n        \"\"\"\u68c0\u67e5\u7279\u6b8a\u5b57\u7b26\u6bd4\u4f8b\"\"\"\n        if len(text) == 0:\n            return False\n        special = len(re.findall(r'[^\\w\\s]', text, re.UNICODE))\n        ratio = special / len(text)\n        return ratio &lt;= self.config['max_special_ratio']\n\n    def check_digit_ratio(self, text: str) -&gt; bool:\n        \"\"\"\u68c0\u67e5\u6570\u5b57\u6bd4\u4f8b\"\"\"\n        if len(text) == 0:\n            return False\n        digits = len(re.findall(r'\\d', text))\n        ratio = digits / len(text)\n        return ratio &lt;= self.config['max_digit_ratio']\n\n    def check_duplicate_lines(self, text: str) -&gt; bool:\n        \"\"\"\u68c0\u67e5\u91cd\u590d\u884c\u6bd4\u4f8b\"\"\"\n        lines = [line.strip() for line in text.split('\\n') if line.strip()]\n        if len(lines) == 0:\n            return False\n        unique_lines = len(set(lines))\n        duplicate_ratio = 1 - (unique_lines / len(lines))\n        return duplicate_ratio &lt;= self.config['max_duplicate_line_ratio']\n\n    def check_vocabulary_diversity(self, text: str) -&gt; bool:\n        \"\"\"\u68c0\u67e5\u8bcd\u6c47\u591a\u6837\u6027\"\"\"\n        words = text.split()\n        if len(words) &lt; self.config['min_words']:\n            return False\n        unique_ratio = len(set(words)) / len(words)\n        return unique_ratio &gt;= self.config['min_unique_word_ratio']\n\n    def filter(self, text: str) -&gt; tuple:\n        \"\"\"\n        \u5e94\u7528\u6240\u6709\u8fc7\u6ee4\u89c4\u5219\n\n        Returns:\n            (\u662f\u5426\u901a\u8fc7, \u5931\u8d25\u539f\u56e0\u6216 None)\n        \"\"\"\n        checks = [\n            (self.check_length, 'length'),\n            (self.check_special_chars, 'special_chars'),\n            (self.check_digit_ratio, 'digit_ratio'),\n            (self.check_duplicate_lines, 'duplicate_lines'),\n            (self.check_vocabulary_diversity, 'vocabulary_diversity')\n        ]\n\n        for check_func, name in checks:\n            if not check_func(text):\n                return False, name\n\n        return True, None\n</code></pre>"},{"location":"part2/2_2_cleaning_denoising/#414","title":"4.1.4 \u8d28\u91cf\u5206\u5c42\u7b56\u7565","text":"<p>\u5728\u5b9e\u8df5\u4e2d\uff0c\u5c06\u6570\u636e\u7b80\u5355\u5730\u4e8c\u5206\u4e3a\"\u4fdd\u7559\"\u548c\"\u4e22\u5f03\"\u5f80\u5f80\u8fc7\u4e8e\u7c97\u66b4\u3002\u66f4\u7cbe\u7ec6\u7684\u505a\u6cd5\u662f\u5bf9\u6570\u636e\u8fdb\u884c\u8d28\u91cf\u5206\u5c42\uff0c\u4e3a\u4e0d\u540c\u8d28\u91cf\u5c42\u7ea7\u7684\u6570\u636e\u8d4b\u4e88\u4e0d\u540c\u7684\u91c7\u6837\u6743\u91cd\u3002</p> <p>\u4e00\u79cd\u5e38\u89c1\u7684\u5206\u5c42\u7b56\u7565\u662f\uff1a\u5c06\u6570\u636e\u5206\u4e3a\u9ad8\u3001\u4e2d\u3001\u4f4e\u4e09\u4e2a\u8d28\u91cf\u5c42\u7ea7\u3002\u9ad8\u8d28\u91cf\u6570\u636e\uff08\u5982\u6765\u81ea\u6743\u5a01\u7f51\u7ad9\u3001\u901a\u8fc7\u6240\u6709\u542f\u53d1\u5f0f\u68c0\u67e5\u3001\u56f0\u60d1\u5ea6\u4f4e\uff09\u8d4b\u4e88\u8f83\u9ad8\u7684\u91c7\u6837\u6743\u91cd\uff1b\u4e2d\u7b49\u8d28\u91cf\u6570\u636e\u8d4b\u4e88\u6b63\u5e38\u6743\u91cd\uff1b\u4f4e\u8d28\u91cf\u4f46\u4ecd\u53ef\u63a5\u53d7\u7684\u6570\u636e\u8d4b\u4e88\u8f83\u4f4e\u6743\u91cd\u3002\u8fd9\u79cd\u7b56\u7565\u53ef\u4ee5\u5728\u4fdd\u8bc1\u6570\u636e\u591a\u6837\u6027\u7684\u540c\u65f6\uff0c\u8ba9\u9ad8\u8d28\u91cf\u6570\u636e\u5728\u8bad\u7ec3\u4e2d\u53d1\u6325\u66f4\u5927\u4f5c\u7528\u3002</p> <p>RefinedWeb \u7684\u8bba\u6587\u8be6\u7ec6\u8bb0\u5f55\u4e86\u4ed6\u4eec\u7684\u5206\u5c42\u7b56\u7565\uff0c\u5c06\u6570\u636e\u5206\u4e3a\u4e94\u4e2a\u5c42\u7ea7\uff0c\u6bcf\u4e2a\u5c42\u7ea7\u4f7f\u7528\u4e0d\u540c\u7684\u8fc7\u6ee4\u9608\u503c\u3002\u8fd9\u79cd\u7cbe\u7ec6\u5316\u7684\u8d28\u91cf\u7ba1\u7406\u662f\u6784\u5efa\u9ad8\u8d28\u91cf\u9884\u8bad\u7ec3\u6570\u636e\u96c6\u7684\u5173\u952e\u3002</p> <p></p> <p>\u56fe4-2\uff1a\u6570\u636e\u8d28\u91cf\u8fc7\u6ee4\u6f0f\u6597 \u2014\u2014 \u4ece100%\u539f\u59cb\u6570\u636e\u5230\u6700\u7ec84%\u6e05\u6d01\u8bed\u6599\u7684\u9010\u5c42\u8fc7\u6ee4\u8fc7\u7a0b</p>"},{"location":"part2/2_2_cleaning_denoising/#42","title":"4.2 \u5927\u89c4\u6a21\u53bb\u91cd\uff1a\u7cbe\u786e\u53bb\u91cd\u4e0e\u6a21\u7cca\u53bb\u91cd","text":"<p>\u6570\u636e\u91cd\u590d\u662f\u9884\u8bad\u7ec3\u6570\u636e\u7684\u5927\u654c\u3002Common Crawl \u4e2d\uff0c\u540c\u4e00\u7bc7\u6587\u7ae0\u53ef\u80fd\u88ab\u591a\u4e2a\u7f51\u7ad9\u8f6c\u8f7d\uff0c\u540c\u4e00\u4e2a\u7f51\u9875\u53ef\u80fd\u5728\u4e0d\u540c\u6708\u4efd\u88ab\u53cd\u590d\u6293\u53d6\uff0c\u5bfc\u81f4\u5927\u91cf\u91cd\u590d\u5185\u5bb9\u3002\u7814\u7a76\u8868\u660e\uff0c\u672a\u7ecf\u53bb\u91cd\u7684\u6570\u636e\u4f1a\u5bfc\u81f4\u6a21\u578b\u8fc7\u62df\u5408\u4e8e\u91cd\u590d\u5185\u5bb9\uff0c\u4ea7\u751f\"\u590d\u8bfb\u673a\"\u73b0\u8c61\uff0c\u4e25\u91cd\u5f71\u54cd\u6a21\u578b\u8d28\u91cf\u3002</p> <p>\u53bb\u91cd\u53ef\u4ee5\u5206\u4e3a\u4e24\u4e2a\u5c42\u6b21\uff1a\u7cbe\u786e\u53bb\u91cd\uff08Exact Deduplication\uff09\u79fb\u9664\u5b8c\u5168\u76f8\u540c\u7684\u6587\u6863\uff1b\u6a21\u7cca\u53bb\u91cd\uff08Fuzzy Deduplication\uff09\u79fb\u9664\u9ad8\u5ea6\u76f8\u4f3c\u4f46\u4e0d\u5b8c\u5168\u76f8\u540c\u7684\u6587\u6863\uff08\u5982\u8f6c\u8f7d\u65f6\u7565\u6709\u4fee\u6539\u7684\u6587\u7ae0\uff09\u3002\u5728 TB \u7ea7\u6570\u636e\u4e0a\uff0c\u8fd9\u4e24\u79cd\u53bb\u91cd\u90fd\u9700\u8981\u9ad8\u6548\u7684\u7b97\u6cd5\u548c\u5206\u5e03\u5f0f\u5b9e\u73b0\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#421","title":"4.2.1 \u7cbe\u786e\u53bb\u91cd\uff1a\u54c8\u5e0c\u65b9\u6cd5","text":"<p>\u7cbe\u786e\u53bb\u91cd\u7684\u6838\u5fc3\u601d\u60f3\u662f\u4e3a\u6bcf\u4e2a\u6587\u6863\u8ba1\u7b97\u4e00\u4e2a\u6307\u7eb9\uff08fingerprint\uff09\uff0c\u76f8\u540c\u6307\u7eb9\u7684\u6587\u6863\u89c6\u4e3a\u91cd\u590d\u3002\u6700\u7b80\u5355\u7684\u65b9\u6cd5\u662f\u4f7f\u7528 MD5 \u6216 SHA256 \u7b49\u54c8\u5e0c\u51fd\u6570\u3002</p> <pre><code>import hashlib\n\ndef compute_hash(text: str) -&gt; str:\n    \"\"\"\u8ba1\u7b97\u6587\u672c\u7684 SHA256 \u54c8\u5e0c\"\"\"\n    return hashlib.sha256(text.encode('utf-8')).hexdigest()\n\ndef exact_dedup(documents: list) -&gt; list:\n    \"\"\"\u7cbe\u786e\u53bb\u91cd\uff1a\u4fdd\u7559\u6bcf\u4e2a\u54c8\u5e0c\u503c\u7684\u7b2c\u4e00\u4e2a\u6587\u6863\"\"\"\n    seen_hashes = set()\n    results = []\n\n    for doc in documents:\n        doc_hash = compute_hash(doc['text'])\n        if doc_hash not in seen_hashes:\n            seen_hashes.add(doc_hash)\n            doc['hash'] = doc_hash\n            results.append(doc)\n\n    return results\n</code></pre> <p>\u5bf9\u4e8e\u5206\u5e03\u5f0f\u573a\u666f\uff0c\u53ef\u4ee5\u4f7f\u7528 Spark \u6216 Ray \u8fdb\u884c\u5e76\u884c\u53bb\u91cd\uff1a</p> <pre><code>import ray\n\n@ray.remote\ndef compute_hashes_batch(documents: list) -&gt; list:\n    \"\"\"\u6279\u91cf\u8ba1\u7b97\u54c8\u5e0c\"\"\"\n    return [(compute_hash(doc['text']), doc) for doc in documents]\n\ndef distributed_exact_dedup(documents_path: str, output_path: str):\n    \"\"\"\u5206\u5e03\u5f0f\u7cbe\u786e\u53bb\u91cd\"\"\"\n    ds = ray.data.read_parquet(documents_path)\n\n    # \u8ba1\u7b97\u54c8\u5e0c\n    ds = ds.map(lambda doc: {**doc, 'hash': compute_hash(doc['text'])})\n\n    # \u6309\u54c8\u5e0c\u5206\u7ec4\uff0c\u6bcf\u7ec4\u4fdd\u7559\u7b2c\u4e00\u4e2a\n    ds = ds.groupby('hash').map_groups(lambda group: group.head(1))\n\n    # \u4fdd\u5b58\u7ed3\u679c\n    ds.write_parquet(output_path)\n</code></pre> <p>\u7cbe\u786e\u53bb\u91cd\u6548\u7387\u5f88\u9ad8\uff0c\u4f46\u53ea\u80fd\u5904\u7406\u5b8c\u5168\u76f8\u540c\u7684\u6587\u6863\u3002\u5bf9\u4e8e\u7565\u6709\u5dee\u5f02\u7684\u91cd\u590d\u5185\u5bb9\uff08\u5982\u540c\u4e00\u7bc7\u65b0\u95fb\u5728\u4e0d\u540c\u7f51\u7ad9\u7684\u8f6c\u8f7d\uff0c\u53ef\u80fd\u6709\u4e0d\u540c\u7684\u9875\u7709\u9875\u811a\uff09\uff0c\u7cbe\u786e\u53bb\u91cd\u65e0\u80fd\u4e3a\u529b\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#422-minhash-lsh","title":"4.2.2 \u6a21\u7cca\u53bb\u91cd\uff1aMinHash LSH","text":"<p>\u6a21\u7cca\u53bb\u91cd\u7684\u76ee\u6807\u662f\u8bc6\u522b\"\u9ad8\u5ea6\u76f8\u4f3c\u4f46\u4e0d\u5b8c\u5168\u76f8\u540c\"\u7684\u6587\u6863\u3002\u8fd9\u662f\u4e00\u4e2a\u8ba1\u7b97\u590d\u6742\u5ea6\u5f88\u9ad8\u7684\u95ee\u9898\u2014\u2014\u6734\u7d20\u5730\u6bd4\u8f83\u4efb\u610f\u4e24\u4e2a\u6587\u6863\u9700\u8981 O(n\u00b2) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u5bf9\u4e8e\u6570\u5341\u4ebf\u6587\u6863\u7684\u6570\u636e\u96c6\u5b8c\u5168\u4e0d\u53ef\u884c\u3002</p> <p>MinHash LSH\uff08Locality-Sensitive Hashing\uff09\u662f\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u7684\u6838\u5fc3\u7b97\u6cd5\u3002\u5b83\u7684\u57fa\u672c\u601d\u60f3\u662f\uff1a\u5148\u5c06\u6587\u6863\u8f6c\u6362\u4e3a n-gram \u96c6\u5408\uff0c\u7136\u540e\u4f7f\u7528 MinHash \u6280\u672f\u5c06\u96c6\u5408\u538b\u7f29\u4e3a\u56fa\u5b9a\u957f\u5ea6\u7684\u7b7e\u540d\uff0c\u6700\u540e\u4f7f\u7528 LSH \u5c06\u76f8\u4f3c\u7684\u7b7e\u540d\u805a\u96c6\u5230\u540c\u4e00\u4e2a\u6876\u4e2d\u3002\u53ea\u6709\u843d\u5165\u540c\u4e00\u4e2a\u6876\u7684\u6587\u6863\u5bf9\u624d\u9700\u8981\u8fdb\u884c\u7cbe\u7ec6\u6bd4\u8f83\uff0c\u5927\u5927\u51cf\u5c11\u4e86\u8ba1\u7b97\u91cf\u3002</p> <p>\u7406\u89e3 MinHash LSH \u9700\u8981\u5206\u4e09\u6b65\u6765\u770b\uff1a</p> <p>\u7b2c\u4e00\u6b65\u662f n-gram \u5206\u89e3\u3002 \u5c06\u6587\u6863\u89c6\u4e3a n-gram\uff08\u8fde\u7eed n \u4e2a\u5b57\u7b26\u6216\u8bcd\uff09\u7684\u96c6\u5408\u3002\u4f8b\u5982\uff0c\"\u5927\u6a21\u578b\u6570\u636e\" \u7684 3-gram \u96c6\u5408\u4e3a {\"\u5927\u6a21\u578b\", \"\u6a21\u578b\u6570\", \"\u578b\u6570\u636e\"}\u3002\u4f7f\u7528 n-gram \u800c\u975e\u6574\u4e2a\u6587\u6863\uff0c\u53ef\u4ee5\u66f4\u597d\u5730\u6355\u6349\u5c40\u90e8\u76f8\u4f3c\u6027\u3002</p> <p>\u7b2c\u4e8c\u6b65\u662f MinHash \u7b7e\u540d\u3002 MinHash \u662f\u4e00\u79cd\u5c06\u96c6\u5408\u538b\u7f29\u4e3a\u56fa\u5b9a\u957f\u5ea6\u7b7e\u540d\u7684\u6280\u672f\u3002\u4e24\u4e2a\u96c6\u5408\u7684 Jaccard \u76f8\u4f3c\u5ea6\u53ef\u4ee5\u901a\u8fc7\u5b83\u4eec MinHash \u7b7e\u540d\u7684\u5339\u914d\u7a0b\u5ea6\u6765\u8fd1\u4f3c\u4f30\u8ba1\u3002\u7b7e\u540d\u957f\u5ea6\u8d8a\u957f\uff0c\u4f30\u8ba1\u8d8a\u51c6\u786e\uff0c\u4f46\u5b58\u50a8\u548c\u8ba1\u7b97\u5f00\u9500\u4e5f\u8d8a\u5927\u3002</p> <p>\u7b2c\u4e09\u6b65\u662f LSH \u5206\u6876\u3002 \u5c06 MinHash \u7b7e\u540d\u5206\u6210\u82e5\u5e72\u4e2a band\uff0c\u6bcf\u4e2a band \u5305\u542b\u82e5\u5e72\u4e2a hash \u503c\u3002\u5982\u679c\u4e24\u4e2a\u6587\u6863\u5728\u4efb\u610f\u4e00\u4e2a band \u4e2d\u7684\u6240\u6709 hash \u503c\u90fd\u76f8\u540c\uff0c\u5219\u5b83\u4eec\u88ab\u653e\u5165\u540c\u4e00\u4e2a\u6876\u3002\u8c03\u6574 band \u7684\u6570\u91cf\u548c\u6bcf\u4e2a band \u7684\u5927\u5c0f\uff0c\u53ef\u4ee5\u63a7\u5236\u76f8\u4f3c\u5ea6\u9608\u503c\u548c\u53ec\u56de\u7387\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 MinHash LSH \u5b9e\u73b0\uff1a</p> <p></p> <p>\u56fe4-3\uff1aMinHash LSH \u7b97\u6cd5\u4e09\u6b65\u9aa4 \u2014\u2014 N-gram\u5206\u89e3\u3001MinHash\u7b7e\u540d\u8ba1\u7b97\u3001LSH\u5206\u6876\uff0c\u5c06\u590d\u6742\u5ea6\u4eceO(n\u00b2)\u964d\u81f3O(n)</p> <pre><code>import hashlib\nimport struct\nfrom typing import Set, List, Tuple\nimport numpy as np\n\nclass MinHashLSH:\n    def __init__(self, \n                 num_hashes: int = 128,\n                 num_bands: int = 16,\n                 ngram_size: int = 5,\n                 threshold: float = 0.8):\n        \"\"\"\n        \u521d\u59cb\u5316 MinHash LSH\n\n        Args:\n            num_hashes: MinHash \u7b7e\u540d\u957f\u5ea6\n            num_bands: LSH band \u6570\u91cf\n            ngram_size: n-gram \u5927\u5c0f\n            threshold: \u76f8\u4f3c\u5ea6\u9608\u503c\uff08\u53c2\u8003\u503c\uff0c\u5b9e\u9645\u9608\u503c\u7531 band \u53c2\u6570\u51b3\u5b9a\uff09\n        \"\"\"\n        self.num_hashes = num_hashes\n        self.num_bands = num_bands\n        self.rows_per_band = num_hashes // num_bands\n        self.ngram_size = ngram_size\n\n        # \u751f\u6210\u54c8\u5e0c\u51fd\u6570\u7684\u968f\u673a\u53c2\u6570\n        self.hash_params = [\n            (np.random.randint(1, 2**31), np.random.randint(0, 2**31))\n            for _ in range(num_hashes)\n        ]\n\n        # LSH \u6876\n        self.buckets = [{} for _ in range(num_bands)]\n\n    def get_ngrams(self, text: str) -&gt; Set[str]:\n        \"\"\"\u63d0\u53d6 n-gram \u96c6\u5408\"\"\"\n        text = text.lower().replace(' ', '')\n        ngrams = set()\n        for i in range(len(text) - self.ngram_size + 1):\n            ngrams.add(text[i:i + self.ngram_size])\n        return ngrams\n\n    def compute_minhash(self, ngrams: Set[str]) -&gt; np.ndarray:\n        \"\"\"\u8ba1\u7b97 MinHash \u7b7e\u540d\"\"\"\n        signature = np.full(self.num_hashes, np.inf)\n\n        for ngram in ngrams:\n            # \u8ba1\u7b97 ngram \u7684\u57fa\u7840\u54c8\u5e0c\u503c\n            h = int(hashlib.md5(ngram.encode()).hexdigest(), 16)\n\n            # \u4f7f\u7528\u591a\u4e2a\u54c8\u5e0c\u51fd\u6570\n            for i, (a, b) in enumerate(self.hash_params):\n                hash_val = (a * h + b) % (2**31 - 1)\n                if hash_val &lt; signature[i]:\n                    signature[i] = hash_val\n\n        return signature.astype(np.uint32)\n\n    def get_bands(self, signature: np.ndarray) -&gt; List[str]:\n        \"\"\"\u5c06\u7b7e\u540d\u5206\u5272\u4e3a bands\"\"\"\n        bands = []\n        for i in range(self.num_bands):\n            start = i * self.rows_per_band\n            end = start + self.rows_per_band\n            band = signature[start:end]\n            band_hash = hashlib.md5(band.tobytes()).hexdigest()\n            bands.append(band_hash)\n        return bands\n\n    def insert(self, doc_id: str, text: str):\n        \"\"\"\u63d2\u5165\u6587\u6863\u5230 LSH \u7d22\u5f15\"\"\"\n        ngrams = self.get_ngrams(text)\n        if len(ngrams) == 0:\n            return\n\n        signature = self.compute_minhash(ngrams)\n        bands = self.get_bands(signature)\n\n        for band_idx, band_hash in enumerate(bands):\n            if band_hash not in self.buckets[band_idx]:\n                self.buckets[band_idx][band_hash] = []\n            self.buckets[band_idx][band_hash].append(doc_id)\n\n    def find_candidates(self, text: str) -&gt; Set[str]:\n        \"\"\"\u67e5\u627e\u5019\u9009\u76f8\u4f3c\u6587\u6863\"\"\"\n        ngrams = self.get_ngrams(text)\n        if len(ngrams) == 0:\n            return set()\n\n        signature = self.compute_minhash(ngrams)\n        bands = self.get_bands(signature)\n\n        candidates = set()\n        for band_idx, band_hash in enumerate(bands):\n            if band_hash in self.buckets[band_idx]:\n                candidates.update(self.buckets[band_idx][band_hash])\n\n        return candidates\n\ndef jaccard_similarity(set1: Set, set2: Set) -&gt; float:\n    \"\"\"\u8ba1\u7b97 Jaccard \u76f8\u4f3c\u5ea6\"\"\"\n    intersection = len(set1 &amp; set2)\n    union = len(set1 | set2)\n    return intersection / union if union &gt; 0 else 0\n</code></pre>"},{"location":"part2/2_2_cleaning_denoising/#423","title":"4.2.3 \u5206\u5e03\u5f0f\u53bb\u91cd\u5b9e\u8df5","text":"<p>\u5728 TB \u7ea7\u6570\u636e\u4e0a\u8fd0\u884c MinHash LSH \u9700\u8981\u7cbe\u5fc3\u8bbe\u8ba1\u7684\u5206\u5e03\u5f0f\u7b56\u7565\u3002\u4e00\u4e2a\u5178\u578b\u7684\u6d41\u7a0b\u5305\u62ec\uff1a</p> <p>\u9636\u6bb5\u4e00\uff1a\u7b7e\u540d\u8ba1\u7b97\u3002 \u5e76\u884c\u904d\u5386\u6240\u6709\u6587\u6863\uff0c\u4e3a\u6bcf\u4e2a\u6587\u6863\u8ba1\u7b97 MinHash \u7b7e\u540d\u3002\u8fd9\u4e00\u6b65\u662f\u5b8c\u5168\u5e76\u884c\u7684\uff0c\u53ef\u4ee5\u5145\u5206\u5229\u7528\u5206\u5e03\u5f0f\u8ba1\u7b97\u8d44\u6e90\u3002</p> <p>\u9636\u6bb5\u4e8c\uff1aBand \u5206\u7ec4\u3002 \u5c06\u6bcf\u4e2a\u6587\u6863\u6309 band \u503c\u8fdb\u884c\u5206\u7ec4\u3002\u76f8\u540c band \u503c\u7684\u6587\u6863\u88ab\u5206\u914d\u5230\u540c\u4e00\u4e2a\u5206\u533a\uff0c\u4fbf\u4e8e\u540e\u7eed\u6bd4\u8f83\u3002</p> <p>\u9636\u6bb5\u4e09\uff1a\u7ec4\u5185\u53bb\u91cd\u3002 \u5728\u6bcf\u4e2a\u5206\u533a\u5185\uff0c\u5bf9\u5019\u9009\u91cd\u590d\u6587\u6863\u5bf9\u8fdb\u884c\u7cbe\u7ec6\u7684\u76f8\u4f3c\u5ea6\u8ba1\u7b97\uff0c\u786e\u5b9a\u771f\u6b63\u7684\u91cd\u590d\u5173\u7cfb\u3002</p> <p>\u9636\u6bb5\u56db\uff1a\u4f20\u9012\u95ed\u5305\u3002 \u5982\u679c\u6587\u6863 A \u4e0e B \u91cd\u590d\uff0cB \u4e0e C \u91cd\u590d\uff0c\u5219 A\u3001B\u3001C \u90fd\u5e94\u89c6\u4e3a\u4e00\u7ec4\u91cd\u590d\u3002\u9700\u8981\u8ba1\u7b97\u91cd\u590d\u5173\u7cfb\u7684\u4f20\u9012\u95ed\u5305\u3002</p> <p>\u9636\u6bb5\u4e94\uff1a\u9009\u62e9\u4fdd\u7559\u6587\u6863\u3002 \u5728\u6bcf\u7ec4\u91cd\u590d\u6587\u6863\u4e2d\u9009\u62e9\u4e00\u4e2a\u4ee3\u8868\uff08\u901a\u5e38\u9009\u62e9\u8d28\u91cf\u6700\u9ad8\u6216\u957f\u5ea6\u6700\u957f\u7684\uff09\u4fdd\u7559\uff0c\u5176\u4ed6\u5220\u9664\u3002</p> <pre><code>import ray\n\ndef distributed_fuzzy_dedup(input_path: str, output_path: str, \n                            threshold: float = 0.8):\n    \"\"\"\n    \u5206\u5e03\u5f0f\u6a21\u7cca\u53bb\u91cd\u6d41\u6c34\u7ebf\n    \"\"\"\n    # \u8bfb\u53d6\u6570\u636e\n    ds = ray.data.read_parquet(input_path)\n\n    # \u9636\u6bb5\u4e00\uff1a\u8ba1\u7b97 MinHash \u7b7e\u540d\n    def compute_signature(doc):\n        lsh = MinHashLSH()\n        ngrams = lsh.get_ngrams(doc['text'])\n        signature = lsh.compute_minhash(ngrams)\n        bands = lsh.get_bands(signature)\n        return {**doc, 'signature': signature.tolist(), 'bands': bands}\n\n    ds = ds.map(compute_signature)\n\n    # \u9636\u6bb5\u4e8c\uff1a\u6309 band \u503c\u5206\u7ec4\uff0c\u627e\u5019\u9009\u5bf9\n    # \uff08\u8fd9\u91cc\u7b80\u5316\u5904\u7406\uff0c\u5b9e\u9645\u5b9e\u73b0\u9700\u8981\u66f4\u590d\u6742\u7684\u5206\u7ec4\u903b\u8f91\uff09\n\n    # \u9636\u6bb5\u4e09&amp;\u56db\uff1a\u7ec4\u5185\u7cbe\u786e\u6bd4\u8f83\uff0c\u5efa\u7acb\u91cd\u590d\u5173\u7cfb\u56fe\n    # ...\n\n    # \u9636\u6bb5\u4e94\uff1a\u9009\u62e9\u4fdd\u7559\u6587\u6863\n    # ...\n\n    # \u4fdd\u5b58\u7ed3\u679c\n    ds.write_parquet(output_path)\n</code></pre> <p>\u5b9e\u9645\u5de5\u7a0b\u4e2d\uff0c\u63a8\u8350\u4f7f\u7528\u73b0\u6210\u7684\u5de5\u5177\u3002text-dedup \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u6587\u672c\u53bb\u91cd\u5e93\uff0c\u5b9e\u73b0\u4e86\u591a\u79cd\u53bb\u91cd\u7b97\u6cd5\uff0c\u5305\u62ec MinHash LSH\u3001SimHash\u3001Suffix Array \u7b49\uff0c\u5e76\u63d0\u4f9b\u4e86 Spark \u548c Ray \u7684\u5206\u5e03\u5f0f\u5b9e\u73b0\u3002Dolma \u7684\u53bb\u91cd\u6a21\u5757\u4e5f\u662f\u4e00\u4e2a\u9ad8\u8d28\u91cf\u7684\u53c2\u8003\u5b9e\u73b0\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#424","title":"4.2.4 \u6587\u6863\u5185\u53bb\u91cd","text":"<p>\u9664\u4e86\u6587\u6863\u7ea7\u522b\u7684\u53bb\u91cd\uff0c\u8fd8\u9700\u8981\u5904\u7406\u6587\u6863\u5185\u90e8\u7684\u91cd\u590d\u5185\u5bb9\u3002\u5e38\u89c1\u7684\u60c5\u51b5\u5305\u62ec\uff1a\u7f51\u9875\u4e2d\u53cd\u590d\u51fa\u73b0\u7684\u5bfc\u822a\u680f\u3001\u9875\u7709\u9875\u811a\uff1b\u7531\u4e8e JavaScript \u6e32\u67d3\u95ee\u9898\u5bfc\u81f4\u7684\u5185\u5bb9\u91cd\u590d\uff1b\u67d0\u4e9b CMS \u7cfb\u7edf\u751f\u6210\u7684\u6a21\u677f\u5316\u91cd\u590d\u6bb5\u843d\u3002</p> <p>\u6587\u6863\u5185\u53bb\u91cd\u7684\u7b56\u7565\u76f8\u5bf9\u7b80\u5355\uff1a\u5c06\u6587\u6863\u6309\u6bb5\u843d\u6216\u56fa\u5b9a\u957f\u5ea6\u5206\u5757\uff0c\u8ba1\u7b97\u6bcf\u4e2a\u5757\u7684\u54c8\u5e0c\u503c\uff0c\u79fb\u9664\u91cd\u590d\u7684\u5757\u3002</p> <pre><code>def remove_duplicate_paragraphs(text: str, min_length: int = 50) -&gt; str:\n    \"\"\"\u79fb\u9664\u6587\u6863\u5185\u7684\u91cd\u590d\u6bb5\u843d\"\"\"\n    paragraphs = text.split('\\n\\n')\n    seen_hashes = set()\n    unique_paragraphs = []\n\n    for para in paragraphs:\n        para = para.strip()\n        if len(para) &lt; min_length:\n            unique_paragraphs.append(para)\n            continue\n\n        para_hash = hashlib.md5(para.encode()).hexdigest()\n        if para_hash not in seen_hashes:\n            seen_hashes.add(para_hash)\n            unique_paragraphs.append(para)\n\n    return '\\n\\n'.join(unique_paragraphs)\n\ndef remove_duplicate_ngrams(text: str, n: int = 10, threshold: int = 3) -&gt; str:\n    \"\"\"\u79fb\u9664\u6587\u6863\u5185\u9ad8\u9891\u91cd\u590d\u7684 n-gram\"\"\"\n    words = text.split()\n    ngram_counts = Counter()\n\n    # \u8ba1\u7b97 n-gram \u9891\u6b21\n    for i in range(len(words) - n + 1):\n        ngram = tuple(words[i:i + n])\n        ngram_counts[ngram] += 1\n\n    # \u6807\u8bb0\u9700\u8981\u79fb\u9664\u7684\u4f4d\u7f6e\n    remove_positions = set()\n    for i in range(len(words) - n + 1):\n        ngram = tuple(words[i:i + n])\n        if ngram_counts[ngram] &gt;= threshold:\n            # \u4fdd\u7559\u7b2c\u4e00\u6b21\u51fa\u73b0\uff0c\u79fb\u9664\u540e\u7eed\u91cd\u590d\n            for j in range(i + n, len(words) - n + 1):\n                if tuple(words[j:j + n]) == ngram:\n                    for k in range(j, min(j + n, len(words))):\n                        remove_positions.add(k)\n\n    # \u91cd\u5efa\u6587\u672c\n    result_words = [w for i, w in enumerate(words) if i not in remove_positions]\n    return ' '.join(result_words)\n</code></pre>"},{"location":"part2/2_2_cleaning_denoising/#43-pii-removal","title":"4.3 \u9690\u79c1\u6570\u636e\u6e05\u6d17 (PII Removal)","text":"<p>\u9884\u8bad\u7ec3\u6570\u636e\u4e2d\u4e0d\u53ef\u907f\u514d\u5730\u5305\u542b\u4e2a\u4eba\u8eab\u4efd\u4fe1\u606f\uff08Personally Identifiable Information, PII\uff09\uff0c\u5982\u90ae\u7bb1\u5730\u5740\u3001\u7535\u8bdd\u53f7\u7801\u3001\u8eab\u4efd\u8bc1\u53f7\u3001\u94f6\u884c\u5361\u53f7\u3001\u5bb6\u5ead\u4f4f\u5740\u7b49\u3002\u5728\u6570\u636e\u5408\u89c4\u8981\u6c42\u65e5\u76ca\u4e25\u683c\u7684\u4eca\u5929\uff08\u5982 GDPR\u3001CCPA\u3001\u300a\u4e2a\u4eba\u4fe1\u606f\u4fdd\u62a4\u6cd5\u300b\uff09\uff0c\u6e05\u6d17 PII \u4e0d\u4ec5\u662f\u9053\u5fb7\u8d23\u4efb\uff0c\u4e5f\u662f\u6cd5\u5f8b\u4e49\u52a1\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#431-pii","title":"4.3.1 PII \u7684\u7c7b\u578b\u4e0e\u98ce\u9669","text":"<p>PII \u53ef\u4ee5\u5206\u4e3a\u76f4\u63a5\u6807\u8bc6\u7b26\u548c\u51c6\u6807\u8bc6\u7b26\u4e24\u7c7b\u3002\u76f4\u63a5\u6807\u8bc6\u7b26\u53ef\u4ee5\u5355\u72ec\u8bc6\u522b\u4e2a\u4eba\u8eab\u4efd\uff0c\u5982\u59d3\u540d\u3001\u8eab\u4efd\u8bc1\u53f7\u3001\u793e\u4f1a\u4fdd\u969c\u53f7\u3001\u7535\u8bdd\u53f7\u7801\u3001\u7535\u5b50\u90ae\u7bb1\u3002\u51c6\u6807\u8bc6\u7b26\u5355\u72ec\u96be\u4ee5\u8bc6\u522b\u4e2a\u4eba\uff0c\u4f46\u7ec4\u5408\u4f7f\u7528\u53ef\u80fd\u5bfc\u81f4\u8bc6\u522b\uff0c\u5982\u51fa\u751f\u65e5\u671f\u3001\u90ae\u653f\u7f16\u7801\u3001\u804c\u4e1a\u3001\u5de5\u4f5c\u5355\u4f4d\u3002</p> <p>\u5728\u9884\u8bad\u7ec3\u6570\u636e\u4e2d\u4fdd\u7559 PII \u5b58\u5728\u591a\u91cd\u98ce\u9669\u3002\u9996\u5148\u662f\u9690\u79c1\u6cc4\u9732\u98ce\u9669\uff1a\u6a21\u578b\u53ef\u80fd\"\u8bb0\u4f4f\"\u8bad\u7ec3\u6570\u636e\u4e2d\u7684\u654f\u611f\u4fe1\u606f\uff0c\u5728\u63a8\u7406\u65f6\u88ab\u6076\u610f\u63d0\u53d6\u3002\u5176\u6b21\u662f\u5408\u89c4\u98ce\u9669\uff1a\u8fdd\u53cd\u6570\u636e\u4fdd\u62a4\u6cd5\u89c4\u53ef\u80fd\u5bfc\u81f4\u5de8\u989d\u7f5a\u6b3e\u3002\u6700\u540e\u662f\u58f0\u8a89\u98ce\u9669\uff1a\u5982\u679c\u6a21\u578b\u8f93\u51fa\u4ed6\u4eba\u9690\u79c1\u4fe1\u606f\uff0c\u4f1a\u4e25\u91cd\u635f\u5bb3\u4f01\u4e1a\u5f62\u8c61\u3002</p> <p></p> <p>\u56fe4-4\uff1aPII\u7c7b\u578b\u4e0e\u98ce\u9669\u7b49\u7ea7 \u2014\u2014 \u76f4\u63a5\u6807\u8bc6\u7b26\uff08\u9ad8\u98ce\u9669\uff09\u4e0e\u51c6\u6807\u8bc6\u7b26\uff08\u4e2d\u98ce\u9669\uff09\u7684\u5206\u7c7b</p>"},{"location":"part2/2_2_cleaning_denoising/#432-microsoft-presidio","title":"4.3.2 Microsoft Presidio","text":"<p>Presidio \u662f\u5fae\u8f6f\u5f00\u6e90\u7684 PII \u8bc6\u522b\u548c\u533f\u540d\u5316\u5de5\u5177\u5305\uff0c\u652f\u6301\u591a\u79cd\u8bed\u8a00\u548c\u591a\u79cd PII \u7c7b\u578b\u3002\u5b83\u91c7\u7528\u6a21\u5757\u5316\u8bbe\u8ba1\uff0c\u5305\u542b\u4e24\u4e2a\u6838\u5fc3\u7ec4\u4ef6\uff1aAnalyzer \u8d1f\u8d23\u5728\u6587\u672c\u4e2d\u8bc6\u522b PII \u5b9e\u4f53\uff0cAnonymizer \u8d1f\u8d23\u5bf9\u8bc6\u522b\u51fa\u7684 PII \u8fdb\u884c\u5904\u7406\uff08\u5982\u66ff\u6362\u3001\u63a9\u7801\u3001\u5220\u9664\uff09\u3002</p> <pre><code>from presidio_analyzer import AnalyzerEngine\nfrom presidio_anonymizer import AnonymizerEngine\nfrom presidio_anonymizer.entities import OperatorConfig\n\n# \u521d\u59cb\u5316\u5f15\u64ce\nanalyzer = AnalyzerEngine()\nanonymizer = AnonymizerEngine()\n\ndef analyze_pii(text: str, language: str = 'en') -&gt; list:\n    \"\"\"\n    \u8bc6\u522b\u6587\u672c\u4e2d\u7684 PII\n\n    Returns:\n        PII \u5b9e\u4f53\u5217\u8868\uff0c\u5305\u542b\u7c7b\u578b\u3001\u4f4d\u7f6e\u548c\u7f6e\u4fe1\u5ea6\n    \"\"\"\n    results = analyzer.analyze(\n        text=text,\n        language=language,\n        entities=[\n            'EMAIL_ADDRESS', 'PHONE_NUMBER', 'CREDIT_CARD',\n            'IP_ADDRESS', 'PERSON', 'LOCATION', 'DATE_TIME'\n        ]\n    )\n    return results\n\ndef anonymize_pii(text: str, language: str = 'en') -&gt; str:\n    \"\"\"\n    \u533f\u540d\u5316\u6587\u672c\u4e2d\u7684 PII\n\n    \u5c06\u8bc6\u522b\u51fa\u7684 PII \u66ff\u6362\u4e3a\u5360\u4f4d\u7b26\n    \"\"\"\n    # \u5148\u8bc6\u522b\n    analyzer_results = analyzer.analyze(text=text, language=language)\n\n    # \u5b9a\u4e49\u533f\u540d\u5316\u7b56\u7565\n    operators = {\n        'EMAIL_ADDRESS': OperatorConfig('replace', {'new_value': '&lt;EMAIL&gt;'}),\n        'PHONE_NUMBER': OperatorConfig('replace', {'new_value': '&lt;PHONE&gt;'}),\n        'CREDIT_CARD': OperatorConfig('replace', {'new_value': '&lt;CREDIT_CARD&gt;'}),\n        'IP_ADDRESS': OperatorConfig('replace', {'new_value': '&lt;IP&gt;'}),\n        'PERSON': OperatorConfig('replace', {'new_value': '&lt;PERSON&gt;'}),\n        'LOCATION': OperatorConfig('replace', {'new_value': '&lt;LOCATION&gt;'}),\n        'DATE_TIME': OperatorConfig('keep', {})  # \u65e5\u671f\u65f6\u95f4\u901a\u5e38\u53ef\u4ee5\u4fdd\u7559\n    }\n\n    # \u533f\u540d\u5316\n    anonymized = anonymizer.anonymize(\n        text=text,\n        analyzer_results=analyzer_results,\n        operators=operators\n    )\n\n    return anonymized.text\n</code></pre>"},{"location":"part2/2_2_cleaning_denoising/#433-pii","title":"4.3.3 \u4e2d\u6587 PII \u5904\u7406","text":"<p>Presidio \u5bf9\u4e2d\u6587\u7684\u652f\u6301\u76f8\u5bf9\u6709\u9650\u3002\u5bf9\u4e8e\u4e2d\u6587\u9884\u8bad\u7ec3\u6570\u636e\uff0c\u901a\u5e38\u9700\u8981\u8865\u5145\u57fa\u4e8e\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u89c4\u5219\u5339\u914d\u3002</p> <pre><code>import re\n\nclass ChinesePIIFilter:\n    \"\"\"\u4e2d\u6587 PII \u8fc7\u6ee4\u5668\"\"\"\n\n    patterns = {\n        'phone': [\n            r'1[3-9]\\d{9}',  # \u624b\u673a\u53f7\n            r'0\\d{2,3}-?\\d{7,8}',  # \u56fa\u5b9a\u7535\u8bdd\n        ],\n        'id_card': [\n            r'\\d{17}[\\dXx]',  # 18\u4f4d\u8eab\u4efd\u8bc1\n            r'\\d{15}',  # 15\u4f4d\u8eab\u4efd\u8bc1\n        ],\n        'email': [\n            r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}',\n        ],\n        'bank_card': [\n            r'\\d{16,19}',  # \u94f6\u884c\u5361\u53f7\uff08\u9700\u8981\u7ed3\u5408\u4e0a\u4e0b\u6587\u5224\u65ad\uff09\n        ],\n        'ip_address': [\n            r'\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}',\n        ],\n        'qq': [\n            r'[Qq][Qq][:\uff1a]?\\s*\\d{5,11}',\n            r'[Qq][:\uff1a]?\\s*\\d{5,11}',\n        ],\n        'wechat': [\n            r'[Vv][Xx][:\uff1a]?\\s*[a-zA-Z0-9_-]{6,20}',\n            r'\u5fae\u4fe1[:\uff1a]?\\s*[a-zA-Z0-9_-]{6,20}',\n        ],\n    }\n\n    def __init__(self):\n        self.compiled_patterns = {}\n        for pii_type, patterns in self.patterns.items():\n            self.compiled_patterns[pii_type] = [\n                re.compile(p) for p in patterns\n            ]\n\n    def find_pii(self, text: str) -&gt; list:\n        \"\"\"\u67e5\u627e\u6240\u6709 PII\"\"\"\n        findings = []\n        for pii_type, patterns in self.compiled_patterns.items():\n            for pattern in patterns:\n                for match in pattern.finditer(text):\n                    findings.append({\n                        'type': pii_type,\n                        'value': match.group(),\n                        'start': match.start(),\n                        'end': match.end()\n                    })\n        return findings\n\n    def anonymize(self, text: str) -&gt; str:\n        \"\"\"\u533f\u540d\u5316 PII\"\"\"\n        findings = self.find_pii(text)\n\n        # \u6309\u4f4d\u7f6e\u5012\u5e8f\u5904\u7406\uff0c\u907f\u514d\u66ff\u6362\u5f71\u54cd\u540e\u7eed\u4f4d\u7f6e\n        findings.sort(key=lambda x: x['start'], reverse=True)\n\n        for finding in findings:\n            placeholder = f\"&lt;{finding['type'].upper()}&gt;\"\n            text = text[:finding['start']] + placeholder + text[finding['end']:]\n\n        return text\n</code></pre>"},{"location":"part2/2_2_cleaning_denoising/#434-pii","title":"4.3.4 PII \u5904\u7406\u7b56\u7565\u7684\u6743\u8861","text":"<p>PII \u5904\u7406\u9762\u4e34\u51c6\u786e\u7387\u4e0e\u53ec\u56de\u7387\u7684\u6743\u8861\u3002\u8fc7\u4e8e\u6fc0\u8fdb\u7684\u8fc7\u6ee4\u53ef\u80fd\u8bef\u4f24\u6b63\u5e38\u5185\u5bb9\uff08\u5982\u5c06\u666e\u901a\u6570\u5b57\u5e8f\u5217\u8bef\u5224\u4e3a\u7535\u8bdd\u53f7\u7801\uff09\uff0c\u8fc7\u4e8e\u4fdd\u5b88\u5219\u53ef\u80fd\u9057\u6f0f\u771f\u6b63\u7684\u654f\u611f\u4fe1\u606f\u3002</p> <p>\u5728\u5b9e\u8df5\u4e2d\uff0c\u5efa\u8bae\u91c7\u7528\u5206\u5c42\u7b56\u7565\u3002\u5bf9\u4e8e\u9ad8\u98ce\u9669 PII\uff08\u5982\u8eab\u4efd\u8bc1\u53f7\u3001\u94f6\u884c\u5361\u53f7\uff09\uff0c\u4f7f\u7528\u8f83\u4e25\u683c\u7684\u5339\u914d\u89c4\u5219\uff0c\u5b81\u53ef\u8bef\u5220\u4e5f\u4e0d\u9057\u6f0f\u3002\u5bf9\u4e8e\u4e2d\u98ce\u9669 PII\uff08\u5982\u7535\u8bdd\u53f7\u7801\u3001\u90ae\u7bb1\uff09\uff0c\u4f7f\u7528\u9002\u4e2d\u7684\u9608\u503c\uff0c\u5e73\u8861\u51c6\u786e\u7387\u548c\u53ec\u56de\u7387\u3002\u5bf9\u4e8e\u4f4e\u98ce\u9669\u4fe1\u606f\uff08\u5982\u65e5\u671f\u3001\u5730\u70b9\uff09\uff0c\u53ef\u4ee5\u6839\u636e\u5177\u4f53\u573a\u666f\u51b3\u5b9a\u662f\u5426\u5904\u7406\u3002</p> <p>\u53e6\u4e00\u4e2a\u91cd\u8981\u51b3\u7b56\u662f\u66ff\u6362\u7b56\u7565\u3002\u5e38\u89c1\u7684\u9009\u62e9\u5305\u62ec\uff1a\u5b8c\u5168\u5220\u9664\uff0c\u7b80\u5355\u4f46\u53ef\u80fd\u7834\u574f\u8bed\u53e5\u6d41\u7545\u6027\uff1b\u56fa\u5b9a\u5360\u4f4d\u7b26\u66ff\u6362\uff08\u5982 <code>&lt;EMAIL&gt;</code>\uff09\uff0c\u4fdd\u7559\u8bed\u4e49\u4fe1\u606f\u4f46\u53ef\u80fd\u5f15\u5165\u4e0d\u81ea\u7136\u7684\u6a21\u5f0f\uff1b\u968f\u673a\u751f\u6210\u66ff\u6362\uff08\u5982\u7528\u968f\u673a\u90ae\u7bb1\u66ff\u6362\u771f\u5b9e\u90ae\u7bb1\uff09\uff0c\u6700\u63a5\u8fd1\u539f\u59cb\u5206\u5e03\u4f46\u5b9e\u73b0\u590d\u6742\u3002\u5927\u591a\u6570\u9884\u8bad\u7ec3\u6570\u636e\u96c6\u91c7\u7528\u5360\u4f4d\u7b26\u66ff\u6362\u7b56\u7565\uff0c\u4f5c\u4e3a\u51c6\u786e\u7387\u548c\u590d\u6742\u5ea6\u7684\u5e73\u8861\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#44-benchmark-decontamination","title":"4.4 \u57fa\u51c6\u6d4b\u8bd5\u96c6\u9632\u6c61\u67d3 (Benchmark Decontamination)","text":"<p>\u5728\u8bc4\u4f30\u5927\u6a21\u578b\u771f\u5b9e\u80fd\u529b\u65f6\uff0c\u4e00\u4e2a\u5173\u952e\u95ee\u9898\u662f\uff1a\u6a21\u578b\u662f\u771f\u7684\"\u5b66\u4f1a\"\u4e86\u89e3\u51b3\u95ee\u9898\uff0c\u8fd8\u662f\u53ea\u662f\"\u80cc\u8fc7\"\u4e86\u6d4b\u8bd5\u9898\uff1f\u5982\u679c\u8bad\u7ec3\u6570\u636e\u4e2d\u5305\u542b\u4e86 GSM8K\u3001MMLU\u3001HumanEval \u7b49\u57fa\u51c6\u6d4b\u8bd5\u96c6\u7684\u539f\u9898\uff0c\u6a21\u578b\u5728\u8fd9\u4e9b\u6d4b\u8bd5\u4e0a\u7684\u9ad8\u5206\u5c31\u6beb\u65e0\u610f\u4e49\u3002</p> <p>\u8fd9\u5c31\u662f\"\u57fa\u51c6\u6c61\u67d3\"\uff08Benchmark Contamination\uff09\u95ee\u9898\u3002\u968f\u7740\u5927\u6a21\u578b\u8bad\u7ec3\u6570\u636e\u89c4\u6a21\u7684\u7206\u70b8\u6027\u589e\u957f\uff0c\u57fa\u51c6\u6d4b\u8bd5\u96c6\u7684\u5185\u5bb9\u5728\u4e92\u8054\u7f51\u4e0a\u88ab\u53cd\u590d\u8f6c\u8f7d\u3001\u8ba8\u8bba\u548c\u89e3\u6790\uff0c\u6781\u6613\u6df7\u5165\u7f51\u7edc\u722c\u53d6\u7684\u8bad\u7ec3\u8bed\u6599\u4e2d\u3002\u8fd9\u662f\u5f53\u524d\u8bc4\u4f30\u6a21\u578b\u771f\u5b9e\u80fd\u529b\u7684\u5173\u952e\u5de5\u7a0b\u6b65\u9aa4\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#441","title":"4.4.1 \u6c61\u67d3\u7684\u7c7b\u578b\u4e0e\u5371\u5bb3","text":"<p>\u57fa\u51c6\u6c61\u67d3\u53ef\u4ee5\u5206\u4e3a\u4e24\u79cd\u7c7b\u578b\uff1a</p> <p>\u76f4\u63a5\u6c61\u67d3\uff1a\u8bad\u7ec3\u6570\u636e\u4e2d\u5305\u542b\u4e86\u57fa\u51c6\u6d4b\u8bd5\u96c6\u7684\u539f\u9898\u6216\u539f\u9898\u7684\u8f7b\u5fae\u53d8\u4f53\u3002\u4f8b\u5982\uff0cGSM8K \u7684\u6570\u5b66\u9898\u76ee\u88ab\u6559\u80b2\u7f51\u7ad9\u8f6c\u8f7d\uff0c\u6216 MMLU \u7684\u9009\u62e9\u9898\u51fa\u73b0\u5728\u67d0\u4e2a\u5728\u7ebf\u6d4b\u9a8c\u5e73\u53f0\u4e0a\u3002</p> <p>\u95f4\u63a5\u6c61\u67d3\uff1a\u8bad\u7ec3\u6570\u636e\u4e2d\u5305\u542b\u4e86\u5bf9\u57fa\u51c6\u6d4b\u8bd5\u9898\u7684\u8be6\u7ec6\u89e3\u6790\u548c\u7b54\u6848\u3002\u867d\u7136\u4e0d\u662f\u539f\u9898\u672c\u8eab\uff0c\u4f46\u6a21\u578b\u53ef\u80fd\u901a\u8fc7\u8fd9\u4e9b\u89e3\u6790\"\u95f4\u63a5\u8bb0\u4f4f\"\u7b54\u6848\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#442","title":"4.4.2 \u9632\u6c61\u67d3\u68c0\u6d4b\u65b9\u6cd5","text":"<p>\u9632\u6c61\u67d3\u7684\u6838\u5fc3\u601d\u8def\u662f\uff1a\u5c06\u8bad\u7ec3\u6570\u636e\u4e0e\u5df2\u77e5\u7684\u57fa\u51c6\u6d4b\u8bd5\u96c6\u8fdb\u884c\u5339\u914d\uff0c\u79fb\u9664\u5339\u914d\u5230\u7684\u5185\u5bb9\u3002</p> <p>N-gram \u91cd\u53e0\u68c0\u6d4b\u662f\u6700\u5e38\u7528\u7684\u65b9\u6cd5\u3002\u8ba1\u7b97\u8bad\u7ec3\u6587\u6863\u4e0e\u57fa\u51c6\u6d4b\u8bd5\u96c6\u6837\u672c\u4e4b\u95f4\u7684 n-gram \u91cd\u53e0\u7387\uff0c\u5f53\u91cd\u53e0\u8d85\u8fc7\u9608\u503c\u65f6\u5c06\u8be5\u6587\u6863\u6807\u8bb0\u4e3a\u6c61\u67d3\u3002GPT-3\u3001LLaMA \u7b49\u6a21\u578b\u7684\u8bad\u7ec3\u90fd\u91c7\u7528\u4e86\u8fd9\u79cd\u65b9\u6cd5\u3002</p> <pre><code>from collections import Counter\nfrom typing import Set, List\n\nclass BenchmarkDecontaminator:\n    \"\"\"\u57fa\u51c6\u6d4b\u8bd5\u96c6\u9632\u6c61\u67d3\u5668\"\"\"\n\n    def __init__(self, ngram_size: int = 13, threshold: float = 0.8):\n        \"\"\"\n        Args:\n            ngram_size: n-gram \u5927\u5c0f\uff0cGPT-3 \u4f7f\u7528 13-gram\n            threshold: \u91cd\u53e0\u7387\u9608\u503c\uff0c\u8d85\u8fc7\u6b64\u503c\u89c6\u4e3a\u6c61\u67d3\n        \"\"\"\n        self.ngram_size = ngram_size\n        self.threshold = threshold\n        self.benchmark_ngrams: Set[tuple] = set()\n\n    def load_benchmarks(self, benchmark_datasets: dict):\n        \"\"\"\n        \u52a0\u8f7d\u57fa\u51c6\u6d4b\u8bd5\u96c6\n\n        Args:\n            benchmark_datasets: {\"\u540d\u79f0\": [\u6837\u672c\u6587\u672c\u5217\u8868]}\n        \"\"\"\n        for name, samples in benchmark_datasets.items():\n            for sample in samples:\n                ngrams = self._extract_ngrams(sample)\n                self.benchmark_ngrams.update(ngrams)\n\n        print(f\"\u52a0\u8f7d\u4e86 {len(self.benchmark_ngrams)} \u4e2a\u72ec\u7acb\u7684 {self.ngram_size}-gram\")\n\n    def _extract_ngrams(self, text: str) -&gt; Set[tuple]:\n        \"\"\"\u63d0\u53d6\u6587\u672c\u7684 n-gram \u96c6\u5408\"\"\"\n        # \u6807\u51c6\u5316\uff1a\u5c0f\u5199\u3001\u53bb\u9664\u591a\u4f59\u7a7a\u683c\n        text = ' '.join(text.lower().split())\n        words = text.split()\n\n        ngrams = set()\n        for i in range(len(words) - self.ngram_size + 1):\n            ngram = tuple(words[i:i + self.ngram_size])\n            ngrams.add(ngram)\n\n        return ngrams\n\n    def check_contamination(self, document: str) -&gt; dict:\n        \"\"\"\n        \u68c0\u67e5\u5355\u4e2a\u6587\u6863\u662f\u5426\u88ab\u6c61\u67d3\n\n        Returns:\n            {\n                'is_contaminated': bool,\n                'overlap_ratio': float,\n                'matched_ngrams': int\n            }\n        \"\"\"\n        doc_ngrams = self._extract_ngrams(document)\n\n        if len(doc_ngrams) == 0:\n            return {'is_contaminated': False, 'overlap_ratio': 0.0, 'matched_ngrams': 0}\n\n        matched = doc_ngrams &amp; self.benchmark_ngrams\n        overlap_ratio = len(matched) / len(doc_ngrams)\n\n        return {\n            'is_contaminated': overlap_ratio &gt; self.threshold,\n            'overlap_ratio': overlap_ratio,\n            'matched_ngrams': len(matched)\n        }\n\n    def decontaminate(self, documents: list) -&gt; list:\n        \"\"\"\u6279\u91cf\u9632\u6c61\u67d3\u8fc7\u6ee4\"\"\"\n        clean_docs = []\n        contaminated_count = 0\n\n        for doc in documents:\n            result = self.check_contamination(doc['text'])\n            if not result['is_contaminated']:\n                clean_docs.append(doc)\n            else:\n                contaminated_count += 1\n\n        print(f\"\u79fb\u9664\u4e86 {contaminated_count} \u4e2a\u6c61\u67d3\u6587\u6863 \"\n              f\"(\u5360\u6bd4 {contaminated_count/len(documents)*100:.2f}%)\")\n        return clean_docs\n\n# \u4f7f\u7528\u793a\u4f8b\ndecontaminator = BenchmarkDecontaminator(ngram_size=13, threshold=0.8)\n\n# \u52a0\u8f7d\u5e38\u89c1\u57fa\u51c6\u6d4b\u8bd5\u96c6\nbenchmarks = {\n    'gsm8k': [\"Janet's ducks lay 16 eggs per day...\", ...],\n    'mmlu': [\"What is the capital of France? A) London B) Paris...\", ...],\n    'humaneval': [\"def has_close_elements(numbers: List[float]...\", ...],\n}\ndecontaminator.load_benchmarks(benchmarks)\n\n# \u5bf9\u8bad\u7ec3\u6570\u636e\u8fdb\u884c\u9632\u6c61\u67d3\nclean_data = decontaminator.decontaminate(training_documents)\n</code></pre>"},{"location":"part2/2_2_cleaning_denoising/#443","title":"4.4.3 \u5de5\u7a0b\u5b9e\u8df5\u5efa\u8bae","text":"<ol> <li>\u5efa\u7acb\u57fa\u51c6\u5e93\uff1a\u7ef4\u62a4\u4e00\u4e2a\u5305\u542b\u6240\u6709\u5e38\u89c1\u57fa\u51c6\u6d4b\u8bd5\u96c6\u7684\u5e93\uff0c\u5305\u62ec GSM8K\u3001MMLU\u3001HumanEval\u3001MBPP\u3001HellaSwag\u3001ARC\u3001WinoGrande \u7b49\u3002\u6bcf\u6b21\u5904\u7406\u65b0\u6570\u636e\u65f6\uff0c\u5fc5\u987b\u8fc7\u8fd9\u4e2a\u5e93\u8fdb\u884c\u68c0\u67e5\u3002</li> <li>\u591a\u7c92\u5ea6\u68c0\u6d4b\uff1a\u9664\u4e86 n-gram \u91cd\u53e0\uff0c\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e0a\u4e00\u8282\u7684 MinHash LSH \u8fdb\u884c\u6a21\u7cca\u5339\u914d\uff0c\u6355\u6349\u7ecf\u8fc7\u6539\u5199\u7684\u6d4b\u8bd5\u9898\u3002</li> <li>\u5b9a\u671f\u66f4\u65b0\uff1a\u65b0\u7684\u57fa\u51c6\u6d4b\u8bd5\u96c6\u4e0d\u65ad\u6d8c\u73b0\uff0c\u9632\u6c61\u67d3\u5e93\u9700\u8981\u5b9a\u671f\u66f4\u65b0\u3002</li> <li>\u8bb0\u5f55\u4e0e\u62a5\u544a\uff1a\u5728\u6a21\u578b\u6280\u672f\u62a5\u544a\u4e2d\u660e\u786e\u62ab\u9732\u9632\u6c61\u67d3\u7684\u65b9\u6cd5\u548c\u7ed3\u679c\uff0c\u8fd9\u662f\u8d1f\u8d23\u4efb AI \u7814\u7a76\u7684\u57fa\u672c\u8981\u6c42\uff08\u53c2\u8003 LLaMA 3 \u3001DeepSeek \u7684\u6280\u672f\u62a5\u544a\uff09\u3002</li> </ol>"},{"location":"part2/2_2_cleaning_denoising/#45-model-based-quality-scoring","title":"4.5 \u57fa\u4e8e\u6a21\u578b\u7684\u8d28\u91cf\u8bc4\u5206 (Model-based Quality Scoring)","text":"<p>\u5728\u7b2c 4.1 \u8282\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u57fa\u4e8e\u542f\u53d1\u5f0f\u89c4\u5219\u7684\u8d28\u91cf\u8fc7\u6ee4\u3002\u8fd9\u4e9b\u89c4\u5219\u5feb\u901f\u6709\u6548\uff0c\u4f46\u65e0\u6cd5\u6355\u6349\u66f4\u6df1\u5c42\u7684\u8d28\u91cf\u5dee\u5f02\u3002\u4f8b\u5982\uff0c\u4e00\u7bc7\u901a\u8fc7\u6240\u6709\u542f\u53d1\u5f0f\u68c0\u67e5\u7684\u5e7f\u544a\u8f6f\u6587\uff0c\u548c\u4e00\u7bc7\u540c\u6837\u901a\u8fc7\u68c0\u67e5\u7684\u9ad8\u8d28\u91cf\u6280\u672f\u6587\u7ae0\uff0c\u5728\u542f\u53d1\u5f0f\u89c4\u5219\u4e0b\u53ef\u80fd\u83b7\u5f97\u76f8\u540c\u7684\u8bc4\u5206\u3002</p> <p>\u57fa\u4e8e\u6a21\u578b\u7684\u8d28\u91cf\u8bc4\u5206\u91c7\u7528\u8f7b\u91cf\u7ea7\u673a\u5668\u5b66\u4e60\u6a21\u578b\u5bf9\u6570\u636e\u8fdb\u884c\u66f4\u7cbe\u7ec6\u7684\u8d28\u91cf\u8bc4\u4f30\u3002\u8fd9\u4e00\u65b9\u6cd5\u5728 LLaMA 2 \u8bad\u7ec3\u4e2d\u88ab\u5e7f\u6cdb\u91c7\u7528\uff0cMeta \u7684\u56e2\u961f\u4f7f\u7528 fastText \u5206\u7c7b\u5668\u816b\u522b\"\u6559\u79d1\u4e66\u7ea7\u8d28\u91cf\"\u7684\u7f51\u9875\uff0c\u663e\u8457\u63d0\u5347\u4e86\u9884\u8bad\u7ec3\u6570\u636e\u7684\u6574\u4f53\u8d28\u91cf\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#451-fasttext","title":"4.5.1 fastText \u8d28\u91cf\u5206\u7c7b\u5668","text":"<p>fastText \u662f\u6700\u5e38\u7528\u7684\u8d28\u91cf\u8bc4\u5206\u5de5\u5177\uff0c\u56e0\u4e3a\u5b83\u63a8\u7406\u901f\u5ea6\u6781\u5feb\uff0c\u53ef\u4ee5\u5728 TB \u7ea7\u6570\u636e\u4e0a\u9ad8\u6548\u8fd0\u884c\u3002\u6838\u5fc3\u601d\u8def\u662f\uff1a</p> <ol> <li>\u6784\u5efa\u8bad\u7ec3\u96c6\uff1a\u4ece\u9ad8\u8d28\u91cf\u6765\u6e90\uff08\u5982 Wikipedia\u3001\u5b66\u672f\u671f\u520a\u3001\u7cbe\u9009\u7f51\u7ad9\uff09\u91c7\u6837\u6b63\u4f8b\uff0c\u4ece\u4f4e\u8d28\u91cf\u6765\u6e90\uff08\u5782\u573e\u7f51\u9875\u3001\u5e7f\u544a\u9875\u9762\uff09\u91c7\u6837\u8d1f\u4f8b\u3002</li> <li>\u8bad\u7ec3\u5206\u7c7b\u5668\uff1a\u4f7f\u7528 fastText \u8bad\u7ec3\u4e8c\u5206\u7c7b\u6a21\u578b\u3002</li> <li>\u6279\u91cf\u8bc4\u5206\uff1a\u5bf9\u6240\u6709\u5f85\u5904\u7406\u6570\u636e\u8fdb\u884c\u8bc4\u5206\uff0c\u6839\u636e\u5206\u6570\u8fdb\u884c\u8fc7\u6ee4\u6216\u5206\u5c42\u91c7\u6837\u3002</li> </ol> <pre><code>import fasttext\nimport random\n\ndef build_quality_training_data(\n    high_quality_texts: list,\n    low_quality_texts: list,\n    output_path: str\n):\n    \"\"\"\n    \u6784\u5efa fastText \u8d28\u91cf\u5206\u7c7b\u8bad\u7ec3\u6570\u636e\n\n    Args:\n        high_quality_texts: \u9ad8\u8d28\u91cf\u6587\u672c\u5217\u8868\uff08\u5982 Wikipedia \u6587\u7ae0\uff09\n        low_quality_texts: \u4f4e\u8d28\u91cf\u6587\u672c\u5217\u8868\uff08\u5982\u5782\u573e\u7f51\u9875\uff09\n        output_path: \u8f93\u51fa\u6587\u4ef6\u8def\u5f84\n    \"\"\"\n    with open(output_path, 'w') as f:\n        for text in high_quality_texts:\n            # fastText \u683c\u5f0f\uff1a__label__\u6807\u7b7e \u6587\u672c\n            clean_text = ' '.join(text.split()[:500])  # \u622a\u53d6\u524d 500 \u8bcd\n            f.write(f\"__label__hq {clean_text}\\n\")\n\n        for text in low_quality_texts:\n            clean_text = ' '.join(text.split()[:500])\n            f.write(f\"__label__lq {clean_text}\\n\")\n\ndef train_quality_classifier(training_data_path: str, model_path: str):\n    \"\"\"\u8bad\u7ec3\u8d28\u91cf\u5206\u7c7b\u5668\"\"\"\n    model = fasttext.train_supervised(\n        input=training_data_path,\n        lr=0.1,\n        epoch=25,\n        wordNgrams=2,\n        dim=100,\n        loss='softmax'\n    )\n    model.save_model(model_path)\n    return model\n\nclass ModelBasedQualityScorer:\n    \"\"\"\u57fa\u4e8e\u6a21\u578b\u7684\u8d28\u91cf\u8bc4\u5206\u5668\"\"\"\n\n    def __init__(self, model_path: str):\n        self.model = fasttext.load_model(model_path)\n\n    def score(self, text: str) -&gt; float:\n        \"\"\"\n        \u5bf9\u6587\u672c\u8fdb\u884c\u8d28\u91cf\u8bc4\u5206\n\n        Returns:\n            0-1 \u4e4b\u95f4\u7684\u8d28\u91cf\u5206\u6570\uff0c\u8d8a\u9ad8\u8d8a\u597d\n        \"\"\"\n        text = ' '.join(text.split()[:500])\n        labels, probs = self.model.predict(text, k=2)\n\n        # \u627e\u5230 __label__hq \u5bf9\u5e94\u7684\u6982\u7387\n        for label, prob in zip(labels, probs):\n            if label == '__label__hq':\n                return prob\n        return 0.0\n\n    def filter_by_quality(self, documents: list, \n                         min_score: float = 0.5) -&gt; list:\n        \"\"\"\u6309\u8d28\u91cf\u5206\u6570\u8fc7\u6ee4\u6587\u6863\"\"\"\n        filtered = []\n        for doc in documents:\n            score = self.score(doc['text'])\n            if score &gt;= min_score:\n                doc['quality_score'] = score\n                filtered.append(doc)\n        return filtered\n</code></pre>"},{"location":"part2/2_2_cleaning_denoising/#452-bert","title":"4.5.2 \u57fa\u4e8e BERT \u7684\u7cbe\u7ec6\u8d28\u91cf\u8bc4\u4f30","text":"<p>\u5bf9\u4e8e\u66f4\u9ad8\u7cbe\u5ea6\u7684\u8d28\u91cf\u8bc4\u4f30\u9700\u6c42\uff0c\u53ef\u4ee5\u4f7f\u7528 BERT \u6216\u5176\u53d8\u4f53\u8fdb\u884c\u5206\u7c7b\u3002\u8fd9\u79cd\u65b9\u6cd5\u6bd4 fastText \u66f4\u51c6\u786e\uff0c\u4f46\u63a8\u7406\u901f\u5ea6\u8f83\u6162\uff0c\u9002\u5408\u5728 fastText \u7c97\u7b5b\u4e4b\u540e\u5bf9\u8fb9\u754c\u6837\u672c\u8fdb\u884c\u7cbe\u7ec6\u5206\u7c7b\u3002</p> <pre><code>from transformers import AutoTokenizer, AutoModelForSequenceClassification\nimport torch\n\nclass BERTQualityScorer:\n    \"\"\"\u57fa\u4e8e BERT \u7684\u7cbe\u7ec6\u8d28\u91cf\u8bc4\u5206\u5668\"\"\"\n\n    def __init__(self, model_name: str = 'bert-base-chinese'):\n        self.tokenizer = AutoTokenizer.from_pretrained(model_name)\n        self.model = AutoModelForSequenceClassification.from_pretrained(\n            model_name, num_labels=2\n        )\n        self.model.eval()\n\n    def score_batch(self, texts: list) -&gt; list:\n        \"\"\"\u6279\u91cf\u8bc4\u5206\"\"\"\n        encodings = self.tokenizer(\n            texts, \n            padding=True, \n            truncation=True, \n            max_length=512, \n            return_tensors='pt'\n        )\n\n        with torch.no_grad():\n            outputs = self.model(**encodings)\n            probs = torch.softmax(outputs.logits, dim=-1)\n            quality_scores = probs[:, 1].tolist()  # \u9ad8\u8d28\u91cf\u7c7b\u7684\u6982\u7387\n\n        return quality_scores\n</code></pre>"},{"location":"part2/2_2_cleaning_denoising/#453","title":"4.5.3 \u8d28\u91cf\u8bc4\u5206\u7684\u5c42\u7ea7\u5316\u5e94\u7528","text":"<p>\u5728\u5b9e\u9645\u5de5\u7a0b\u4e2d\uff0c\u5efa\u8bae\u91c7\u7528\u201c\u7c97\u7b5b + \u7cbe\u7b5b\u201d\u7684\u4e24\u9636\u6bb5\u7b56\u7565\uff1a</p> <ol> <li>\u7b2c\u4e00\u9636\u6bb5\uff1a\u4f7f\u7528 fastText \u5bf9\u5168\u91cf\u6570\u636e\u8fdb\u884c\u5feb\u901f\u8bc4\u5206\uff0c\u79fb\u9664\u660e\u663e\u7684\u4f4e\u8d28\u91cf\u5185\u5bb9\uff08\u5982\u5206\u6570 &lt; 0.3\uff09\u3002</li> <li>\u7b2c\u4e8c\u9636\u6bb5\uff1a\u5bf9\u4e8e\u8fb9\u754c\u6837\u672c\uff08\u5982\u5206\u6570\u5728 0.3-0.7 \u4e4b\u95f4\uff09\uff0c\u4f7f\u7528 BERT \u8fdb\u884c\u7cbe\u7ec6\u5206\u7c7b\u3002</li> <li>\u8d28\u91cf\u5206\u5c42\uff1a\u6839\u636e\u6700\u7ec8\u5206\u6570\u5c06\u6570\u636e\u5206\u4e3a\u9ad8\u3001\u4e2d\u3001\u4f4e\u4e09\u4e2a\u5c42\u7ea7\uff0c\u5728\u8bad\u7ec3\u65f6\u8d4b\u4e88\u4e0d\u540c\u7684\u91c7\u6837\u6743\u91cd\u3002</li> </ol> <p>\u8fd9\u79cd\u5206\u5c42\u7b56\u7565\u88ab Meta \u5728 LLaMA 2 \u7684\u8bad\u7ec3\u4e2d\u91c7\u7528\uff0c\u901a\u8fc7\u589e\u52a0\u9ad8\u8d28\u91cf\u6570\u636e\u7684\u91c7\u6837\u6743\u91cd\uff0c\u663e\u8457\u63d0\u5347\u4e86\u6a21\u578b\u5728\u5404\u7c7b\u57fa\u51c6\u6d4b\u8bd5\u4e0a\u7684\u8868\u73b0\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#46","title":"4.6 \u5b8c\u6574\u6e05\u6d17\u6d41\u6c34\u7ebf","text":"<p>\u5c06\u524d\u9762\u4ecb\u7ecd\u7684\u5404\u4e2a\u7ec4\u4ef6\u4e32\u8054\u8d77\u6765\uff0c\u6784\u5efa\u4e00\u4e2a\u5b8c\u6574\u7684\u6570\u636e\u6e05\u6d17\u6d41\u6c34\u7ebf\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#461","title":"4.6.1 \u6d41\u6c34\u7ebf\u67b6\u6784","text":"<p>\u4e00\u4e2a\u5de5\u4e1a\u7ea7\u7684\u6e05\u6d17\u6d41\u6c34\u7ebf\u901a\u5e38\u5305\u62ec\u4ee5\u4e0b\u9636\u6bb5\uff0c\u6309\u987a\u5e8f\u6267\u884c\uff1a</p> <p>\u9636\u6bb5\u4e00\uff1a\u683c\u5f0f\u6807\u51c6\u5316\u3002 \u5c06\u5404\u79cd\u6765\u6e90\u7684\u6570\u636e\u8f6c\u6362\u4e3a\u7edf\u4e00\u683c\u5f0f\uff0c\u5904\u7406\u7f16\u7801\u95ee\u9898\uff0c\u63d0\u53d6\u5fc5\u8981\u7684\u5143\u6570\u636e\u3002</p> <p>\u9636\u6bb5\u4e8c\uff1a\u8bed\u8a00\u8fc7\u6ee4\u3002 \u4f7f\u7528 FastText \u8bc6\u522b\u8bed\u8a00\uff0c\u4fdd\u7559\u76ee\u6807\u8bed\u8a00\u7684\u6587\u6863\u3002\u5bf9\u4e8e\u6df7\u5408\u8bed\u8a00\u6587\u6863\uff0c\u6839\u636e\u4e3b\u8981\u8bed\u8a00\u8fdb\u884c\u5206\u7c7b\u3002</p> <p>\u9636\u6bb5\u4e09\uff1a\u542f\u53d1\u5f0f\u8fc7\u6ee4\u3002 \u5e94\u7528\u957f\u5ea6\u3001\u7279\u6b8a\u5b57\u7b26\u3001\u91cd\u590d\u884c\u7b49\u542f\u53d1\u5f0f\u89c4\u5219\uff0c\u5feb\u901f\u8fc7\u6ee4\u660e\u663e\u7684\u4f4e\u8d28\u91cf\u5185\u5bb9\u3002</p> <p>\u9636\u6bb5\u56db\uff1a\u6587\u6863\u5185\u53bb\u91cd\u3002 \u79fb\u9664\u6587\u6863\u5185\u90e8\u7684\u91cd\u590d\u6bb5\u843d\u548c\u91cd\u590d n-gram\u3002</p> <p>\u9636\u6bb5\u4e94\uff1aPII \u6e05\u6d17\u3002 \u8bc6\u522b\u5e76\u533f\u540d\u5316\u654f\u611f\u4e2a\u4eba\u4fe1\u606f\u3002</p> <p>\u9636\u6bb5\u4e03\uff1a\u57fa\u51c6\u9632\u6c61\u67d3\u3002 \u4f7f\u7528 N-gram \u91cd\u53e0\u68c0\u6d4b\uff0c\u79fb\u9664\u4e0e\u57fa\u51c6\u6d4b\u8bd5\u96c6\u9ad8\u5ea6\u91cd\u53e0\u7684\u6587\u6863\u3002</p> <p>\u9636\u6bb5\u516b\uff1a\u8d28\u91cf\u8bc4\u5206\u3002 \u4f7f\u7528 fastText/BERT \u8d28\u91cf\u5206\u7c7b\u5668\u5bf9\u6570\u636e\u8fdb\u884c\u7cbe\u7ec6\u7684\u8d28\u91cf\u8bc4\u5206\u3002</p> <p>\u9636\u6bb5\u4e5d\uff1a\u56f0\u60d1\u5ea6\u8bc4\u5206\u3002 \u8ba1\u7b97\u56f0\u60d1\u5ea6\u7b49\u8d28\u91cf\u6307\u6807\uff0c\u4e3a\u540e\u7eed\u7684\u8d28\u91cf\u5206\u5c42\u63d0\u4f9b\u4f9d\u636e\u3002</p> <p>\u9636\u6bb5\u5341\uff1a\u6587\u6863\u95f4\u53bb\u91cd\u3002 \u4f7f\u7528 MinHash LSH \u8fdb\u884c\u5927\u89c4\u6a21\u6a21\u7cca\u53bb\u91cd\uff0c\u79fb\u9664\u9ad8\u5ea6\u76f8\u4f3c\u7684\u6587\u6863\u3002</p> <p>\u9636\u6bb5\u5341\u4e00\uff1a\u8d28\u91cf\u5206\u5c42\u4e0e\u91c7\u6837\u3002 \u6839\u636e\u8d28\u91cf\u8bc4\u5206\u5c06\u6570\u636e\u5206\u5c42\uff0c\u786e\u5b9a\u5404\u5c42\u7684\u91c7\u6837\u6743\u91cd\u3002</p> <pre><code>import ray\nfrom dataclasses import dataclass\nfrom typing import Optional\n\n@dataclass\nclass CleaningConfig:\n    \"\"\"\u6e05\u6d17\u914d\u7f6e\"\"\"\n    target_language: str = 'zh'\n    min_length: int = 200\n    max_length: int = 100000\n    max_perplexity: float = 500\n    dedup_threshold: float = 0.8\n    anonymize_pii: bool = True\n\nclass DataCleaningPipeline:\n    def __init__(self, config: CleaningConfig):\n        self.config = config\n        self.lang_filter = LanguageFilter(config.target_language)\n        self.heuristic_filter = HeuristicFilter()\n        self.perplexity_filter = PerplexityFilter(max_perplexity=config.max_perplexity)\n        self.pii_filter = ChinesePIIFilter() if config.target_language == 'zh' else None\n        self.deduplicator = MinHashLSH(threshold=config.dedup_threshold)\n\n    def process_document(self, doc: dict) -&gt; Optional[dict]:\n        \"\"\"\u5904\u7406\u5355\u4e2a\u6587\u6863\"\"\"\n        text = doc.get('text', '')\n\n        # \u9636\u6bb5\u4e8c\uff1a\u8bed\u8a00\u8fc7\u6ee4\n        lang, conf = self.lang_filter.detect(text)\n        if lang != self.config.target_language:\n            return None\n\n        # \u9636\u6bb5\u4e09\uff1a\u542f\u53d1\u5f0f\u8fc7\u6ee4\n        passed, reason = self.heuristic_filter.filter(text)\n        if not passed:\n            return None\n\n        # \u9636\u6bb5\u56db\uff1a\u6587\u6863\u5185\u53bb\u91cd\n        text = remove_duplicate_paragraphs(text)\n\n        # \u9636\u6bb5\u4e94\uff1aPII \u6e05\u6d17\n        if self.config.anonymize_pii and self.pii_filter:\n            text = self.pii_filter.anonymize(text)\n\n        # \u9636\u6bb5\u516d\uff1a\u8d28\u91cf\u8bc4\u5206\n        perplexity = self.perplexity_filter.compute_perplexity(text)\n        if perplexity &gt; self.config.max_perplexity:\n            return None\n\n        return {\n            **doc,\n            'text': text,\n            'language': lang,\n            'lang_confidence': conf,\n            'perplexity': perplexity\n        }\n\n    def run(self, input_path: str, output_path: str):\n        \"\"\"\u8fd0\u884c\u5b8c\u6574\u6d41\u6c34\u7ebf\"\"\"\n        # \u8bfb\u53d6\u6570\u636e\n        ds = ray.data.read_parquet(input_path)\n\n        # \u9636\u6bb5\u4e00\u5230\u516d\uff1a\u5355\u6587\u6863\u5904\u7406\n        ds = ds.map(self.process_document)\n        ds = ds.filter(lambda x: x is not None)\n\n        # \u9636\u6bb5\u4e03\uff1a\u6587\u6863\u95f4\u53bb\u91cd\n        ds = self.deduplicator.deduplicate(ds)\n\n        # \u4fdd\u5b58\u7ed3\u679c\n        ds.write_parquet(output_path)\n</code></pre>"},{"location":"part2/2_2_cleaning_denoising/#462","title":"4.6.2 \u8d28\u91cf\u76d1\u63a7\u4e0e\u8fed\u4ee3","text":"<p>\u6e05\u6d17\u6d41\u6c34\u7ebf\u4e0d\u662f\u4e00\u6b21\u6027\u4efb\u52a1\uff0c\u800c\u662f\u9700\u8981\u6301\u7eed\u76d1\u63a7\u548c\u8fed\u4ee3\u4f18\u5316\u7684\u8fc7\u7a0b\u3002\u5efa\u8bae\u5efa\u7acb\u4ee5\u4e0b\u76d1\u63a7\u673a\u5236\uff1a</p> <p>\u8fc7\u6ee4\u7387\u76d1\u63a7\uff1a\u7edf\u8ba1\u6bcf\u4e2a\u9636\u6bb5\u7684\u8fc7\u6ee4\u7387\u3002\u5982\u679c\u67d0\u4e2a\u9636\u6bb5\u7a81\u7136\u8fc7\u6ee4\u6389\u5927\u91cf\u6570\u636e\uff0c\u53ef\u80fd\u662f\u9608\u503c\u8bbe\u7f6e\u4e0d\u5f53\u6216\u6570\u636e\u5206\u5e03\u53d1\u751f\u53d8\u5316\u3002</p> <p>\u6837\u672c\u62bd\u68c0\uff1a\u5b9a\u671f\u4eba\u5de5\u62bd\u68c0\u6e05\u6d17\u7ed3\u679c\uff0c\u8bc4\u4f30\u8fc7\u6ee4\u89c4\u5219\u7684\u51c6\u786e\u6027\u3002\u8bef\u5220\u7684\u597d\u6837\u672c\u548c\u6f0f\u5220\u7684\u574f\u6837\u672c\u90fd\u9700\u8981\u5173\u6ce8\u3002</p> <p>\u4e0b\u6e38\u53cd\u9988\uff1a\u6a21\u578b\u8bad\u7ec3\u540e\u7684\u8bc4\u6d4b\u7ed3\u679c\u662f\u6700\u7ec8\u7684\u8d28\u91cf\u9a8c\u8bc1\u3002\u5982\u679c\u6a21\u578b\u8868\u73b0\u4e0d\u4f73\uff0c\u9700\u8981\u56de\u6eaf\u5206\u6790\u6570\u636e\u662f\u5426\u5b58\u5728\u95ee\u9898\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#47","title":"4.7 \u672c\u7ae0\u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u7cfb\u7edf\u4ecb\u7ecd\u4e86\u9884\u8bad\u7ec3\u6570\u636e\u6e05\u6d17\u4e0e\u8d28\u91cf\u63a7\u5236\u7684\u6838\u5fc3\u6280\u672f\u3002</p> <p>\u5728\u542f\u53d1\u5f0f\u8fc7\u6ee4\u65b9\u9762\uff0c\u8bed\u8a00\u8bc6\u522b\u4f7f\u7528 FastText \u5feb\u901f\u7b5b\u9009\u76ee\u6807\u8bed\u8a00\u6587\u6863\uff0c\u56f0\u60d1\u5ea6\u8fc7\u6ee4\u4f7f\u7528 KenLM \u8bc4\u4f30\u6587\u672c\u8d28\u91cf\uff0c\u542f\u53d1\u5f0f\u89c4\u5219\u96c6\u6db5\u76d6\u957f\u5ea6\u3001\u7279\u6b8a\u5b57\u7b26\u3001\u91cd\u590d\u884c\u3001\u8bcd\u6c47\u591a\u6837\u6027\u7b49\u591a\u4e2a\u7ef4\u5ea6\u3002\u8d28\u91cf\u5206\u5c42\u7b56\u7565\u5c06\u6570\u636e\u5212\u5206\u4e3a\u4e0d\u540c\u7b49\u7ea7\uff0c\u4e3a\u540e\u7eed\u91c7\u6837\u63d0\u4f9b\u4f9d\u636e\u3002</p> <p>\u5728\u5927\u89c4\u6a21\u53bb\u91cd\u65b9\u9762\uff0c\u6211\u4eec\u660e\u786e\u533a\u5206\u4e86\u7cbe\u786e\u53bb\u91cd\u548c\u6a21\u7cca\u53bb\u91cd\u4e24\u79cd\u6280\u672f\u8def\u7ebf\u3002\u7cbe\u786e\u53bb\u91cd\u4f7f\u7528\u54c8\u5e0c\u65b9\u6cd5\u5feb\u901f\u79fb\u9664\u5b8c\u5168\u76f8\u540c\u7684\u6587\u6863\uff0c\u6a21\u7cca\u53bb\u91cd\u4f7f\u7528 MinHash LSH \u7b97\u6cd5\u8bc6\u522b\u9ad8\u5ea6\u76f8\u4f3c\u7684\u5185\u5bb9\u3002\u5206\u5e03\u5f0f\u5b9e\u73b0\u662f\u5904\u7406 TB \u7ea7\u6570\u636e\u7684\u5fc5\u8981\u624b\u6bb5\u3002\u6587\u6863\u5185\u53bb\u91cd\u5904\u7406\u6bb5\u843d\u548c n-gram \u7ea7\u522b\u7684\u91cd\u590d\u3002</p> <p>\u5728\u9690\u79c1\u6e05\u6d17\u65b9\u9762\uff0cPII \u8bc6\u522b\u53ef\u4ee5\u4f7f\u7528 Presidio \u6216\u81ea\u5b9a\u4e49\u6b63\u5219\u89c4\u5219\uff0c\u533f\u540d\u5316\u7b56\u7565\u9700\u8981\u5728\u51c6\u786e\u7387\u548c\u4fe1\u606f\u4fdd\u7559\u4e4b\u95f4\u6743\u8861\u3002\u4e2d\u6587 PII \u5904\u7406\u9700\u8981\u7279\u522b\u8bbe\u8ba1\u7684\u89c4\u5219\u96c6\u3002</p> <p>\u5728\u57fa\u51c6\u9632\u6c61\u67d3\u65b9\u9762\uff0c\u8fd9\u662f\u786e\u4fdd\u6a21\u578b\u8bc4\u4f30\u6709\u6548\u6027\u7684\u5173\u952e\u5de5\u7a0b\u6b65\u9aa4\u3002\u901a\u8fc7 N-gram \u91cd\u53e0\u68c0\u6d4b\u548c\u6a21\u7cca\u5339\u914d\uff0c\u79fb\u9664\u8bad\u7ec3\u6570\u636e\u4e2d\u5305\u542b\u7684\u57fa\u51c6\u6d4b\u8bd5\u96c6\u5185\u5bb9\uff08GSM8K\u3001MMLU\u3001HumanEval \u7b49\uff09\uff0c\u907f\u514d\u6a21\u578b\"\u80cc\u9898\"\u800c\u975e\u771f\u6b63\u5b66\u4e60\u3002</p> <p>\u5728\u8d28\u91cf\u8bc4\u5206\u65b9\u9762\uff0c\u57fa\u4e8e\u6a21\u578b\u7684\u8d28\u91cf\u8bc4\u4f30\uff08fastText/BERT\uff09\u5f25\u8865\u4e86\u542f\u53d1\u5f0f\u89c4\u5219\u7684\u4e0d\u8db3\uff0c\u80fd\u591f\u66f4\u7cbe\u7ec6\u5730\u533a\u5206\"\u6559\u79d1\u4e66\u7ea7\u8d28\u91cf\"\u4e0e\u666e\u901a\u7f51\u9875\u5185\u5bb9\u3002\u5206\u5c42\u7b56\u7565\uff08\u7c97\u7b5b+\u7cbe\u7b5b\uff09\u662f\u5e73\u8861\u6548\u7387\u548c\u7cbe\u5ea6\u7684\u6700\u4f73\u5de5\u7a0b\u5b9e\u8df5\u3002</p> <p>\u5b8c\u6574\u7684\u6e05\u6d17\u6d41\u6c34\u7ebf\u5c06\u5404\u4e2a\u7ec4\u4ef6\u4e32\u8054\uff0c\u6309\u7167\u683c\u5f0f\u6807\u51c6\u5316\u3001\u8bed\u8a00\u8fc7\u6ee4\u3001\u542f\u53d1\u5f0f\u8fc7\u6ee4\u3001\u6587\u6863\u5185\u53bb\u91cd\u3001PII \u6e05\u6d17\u3001\u57fa\u51c6\u9632\u6c61\u67d3\u3001\u8d28\u91cf\u8bc4\u5206\u3001\u56f0\u60d1\u5ea6\u8bc4\u5206\u3001\u6587\u6863\u95f4\u53bb\u91cd\u3001\u8d28\u91cf\u5206\u5c42\u7684\u987a\u5e8f\u6267\u884c\u3002\u6301\u7eed\u7684\u8d28\u91cf\u76d1\u63a7\u548c\u8fed\u4ee3\u4f18\u5316\u662f\u4fdd\u8bc1\u6570\u636e\u8d28\u91cf\u7684\u5173\u952e\u3002</p> <p></p> <p>\u56fe4-5\uff1a\u7b2c4\u7ae0\u77e5\u8bc6\u7ed3\u6784 \u2014\u2014 \u542f\u53d1\u5f0f\u8fc7\u6ee4\u3001\u5927\u89c4\u6a21\u53bb\u91cd\u3001PII\u6e05\u6d17\u4e09\u5927\u6838\u5fc3\u4e3b\u9898</p>"},{"location":"part2/2_2_cleaning_denoising/#_3","title":"\u5ef6\u4f38\u9605\u8bfb","text":"<p>\u5173\u4e8e\u6570\u636e\u6e05\u6d17\u7684\u6df1\u5165\u5185\u5bb9\uff0c\u4ee5\u4e0b\u8d44\u6e90\u503c\u5f97\u53c2\u8003\uff1a</p> <p>RefinedWeb \u8bba\u6587\u8be6\u7ec6\u8bb0\u5f55\u4e86\u4ece Common Crawl \u6784\u5efa\u9ad8\u8d28\u91cf\u9884\u8bad\u7ec3\u96c6\u7684\u5b8c\u6574\u6e05\u6d17\u6d41\u7a0b\u3002Dolma \u6570\u636e\u96c6\u7684\u6280\u672f\u62a5\u544a\u4ecb\u7ecd\u4e86 Allen AI \u7684\u6e05\u6d17\u7b56\u7565\u548c\u5de5\u5177\u3002text-dedup \u5f00\u6e90\u5e93\uff08github.com/ChenghaoMou/text-dedup\uff09\u63d0\u4f9b\u4e86\u591a\u79cd\u53bb\u91cd\u7b97\u6cd5\u7684\u5b9e\u73b0\u3002Microsoft Presidio \u6587\u6863\uff08microsoft.github.io/presidio\uff09\u662f PII \u5904\u7406\u7684\u6743\u5a01\u53c2\u8003\u3002CCNet \u8bba\u6587\u4ecb\u7ecd\u4e86 Facebook \u5904\u7406 Common Crawl \u6570\u636e\u7684\u65b9\u6cd5\uff0c\u7279\u522b\u662f\u56f0\u60d1\u5ea6\u8fc7\u6ee4\u7684\u7ec6\u8282\u3002</p>"},{"location":"part2/2_2_cleaning_denoising/#_4","title":"\u4e0b\u4e00\u7ae0\u9884\u544a","text":"<p>\u5728\u4e0b\u4e00\u7ae0\u300a\u5206\u8bcd\u4e0e\u5e8f\u5217\u5316\u300b\u4e2d\uff0c\u6211\u4eec\u5c06\u63a2\u8ba8\u9884\u8bad\u7ec3\u6570\u636e\u51c6\u5907\u7684\u6700\u540e\u4e00\u4e2a\u5173\u952e\u6b65\u9aa4\uff1a\u5982\u4f55\u5c06\u6e05\u6d17\u540e\u7684\u6587\u672c\u8f6c\u6362\u4e3a\u6a21\u578b\u53ef\u4ee5\u7406\u89e3\u7684 Token \u5e8f\u5217\u3002\u4f60\u5c06\u5b66\u4e60 BPE\u3001WordPiece\u3001Unigram \u7b49\u5206\u8bcd\u7b97\u6cd5\u7684\u539f\u7406\u4e0e\u9009\u62e9\uff0c\u5982\u4f55\u4e3a\u7279\u5b9a\u9886\u57df\u6269\u5145\u8bcd\u8868\uff0c\u4ee5\u53ca\u6570\u636e\u6df7\u5408\u4e0e\u8bfe\u7a0b\u5b66\u4e60\u7684\u91c7\u6837\u7b56\u7565\u3002</p> <p>\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\u8fdb\u5165\u4e0b\u4e00\u7ae0\uff1a\u5982\u679c\u4f60\u8981\u8bad\u7ec3\u4e00\u4e2a\u4e13\u95e8\u5904\u7406\u4ee3\u7801\u7684\u6a21\u578b\uff0c\u6807\u51c6\u7684 GPT-2 \u5206\u8bcd\u5668\u4f1a\u9047\u5230\u4ec0\u4e48\u95ee\u9898\uff1f</p>"},{"location":"part2/2_3_tokenization_serialization/","title":"\u7b2c5\u7ae0\uff1a\u5206\u8bcd\u4e0e\u5e8f\u5217\u5316","text":""},{"location":"part2/2_3_tokenization_serialization/#5dataloader","title":"\u7b2c5\u7ae0\uff1a\u5206\u8bcd\u3001\u5e8f\u5217\u5316\u4e0e\u9ad8\u6548\u52a0\u8f7d\uff08DataLoader \u4f18\u5316\uff09","text":""},{"location":"part2/2_3_tokenization_serialization/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u5206\u8bcd\uff08Tokenization\uff09\u662f\u8fde\u63a5\u539f\u59cb\u6587\u672c\u4e0e\u795e\u7ecf\u7f51\u7edc\u7684\u6865\u6881\u3002\u6e05\u6d17\u540e\u7684\u9ad8\u8d28\u91cf\u8bed\u6599\u9700\u8981\u8f6c\u6362\u4e3a\u6a21\u578b\u53ef\u4ee5\u7406\u89e3\u7684\u6570\u5b57\u5e8f\u5217\uff0c\u624d\u80fd\u8f93\u5165\u5230 Transformer \u4e2d\u8fdb\u884c\u8bad\u7ec3\u3002\u672c\u7ae0\u5c06\u6df1\u5165\u63a2\u8ba8\u5206\u8bcd\u5668\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5305\u62ec BPE\u3001WordPiece\u3001Unigram \u4e09\u5927\u4e3b\u6d41\u7b97\u6cd5\uff1b\u4ecb\u7ecd\u5982\u4f55\u4e3a\u7279\u5b9a\u9886\u57df\u6784\u5efa\u548c\u6269\u5145\u8bcd\u8868\uff1b\u6700\u540e\u8ba8\u8bba\u6570\u636e\u6df7\u5408\u4e0e\u8bfe\u7a0b\u5b66\u4e60\u7b56\u7565\uff0c\u8fd9\u4e9b\u7b56\u7565\u51b3\u5b9a\u4e86\u4e0d\u540c\u7c7b\u578b\u6570\u636e\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u7684\u5448\u73b0\u987a\u5e8f\u548c\u6bd4\u4f8b\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#_2","title":"\u573a\u666f\u5f15\u5165","text":"<p>\u4f60\u7684\u56e2\u961f\u6b63\u5728\u8bad\u7ec3\u4e00\u4e2a\u4e13\u95e8\u5904\u7406\u4ee3\u7801\u7684\u5927\u6a21\u578b\u3002\u4f7f\u7528\u6807\u51c6\u7684 GPT-2 \u5206\u8bcd\u5668\u8fdb\u884c\u521d\u6b65\u5b9e\u9a8c\u540e\uff0c\u53d1\u73b0\u4e86\u4e00\u4e2a\u5947\u602a\u7684\u73b0\u8c61\uff1a\u6a21\u578b\u751f\u6210\u7684\u4ee3\u7801\u7ecf\u5e38\u5728\u7f29\u8fdb\u5904\u51fa\u9519\uff0c\u628a\u56db\u4e2a\u7a7a\u683c\u62c6\u6210\u4e86\u591a\u4e2a\u4e0d\u540c\u7684 token\uff0c\u5bfc\u81f4\u7f29\u8fdb\u4e0d\u4e00\u81f4\u3002\u66f4\u7cdf\u7cd5\u7684\u662f\uff0c\u4e00\u4e9b\u5e38\u89c1\u7684\u7f16\u7a0b\u5173\u952e\u5b57\uff08\u5982 <code>def</code>\u3001<code>return</code>\uff09\u88ab\u62c6\u5206\u6210\u4e86\u591a\u4e2a\u5b50\u8bcd\uff0c\u6a21\u578b\u9700\u8981\u989d\u5916\u7684\u4e0a\u4e0b\u6587\u624d\u80fd\u7406\u89e3\u5b83\u4eec\u7684\u542b\u4e49\u3002</p> <p>\u7ecf\u8fc7\u5206\u6790\uff0c\u4f60\u53d1\u73b0\u95ee\u9898\u51fa\u5728\u5206\u8bcd\u5668\u4e0a\u3002GPT-2 \u7684\u5206\u8bcd\u5668\u662f\u5728\u7f51\u9875\u6587\u672c\u4e0a\u8bad\u7ec3\u7684\uff0c\u5bf9\u4ee3\u7801\u7684\u7279\u6b8a\u7ed3\u6784\uff08\u5982\u7a7a\u767d\u7b26\u3001\u9a7c\u5cf0\u547d\u540d\u3001\u7279\u6b8a\u7b26\u53f7\uff09\u5904\u7406\u5f97\u5e76\u4e0d\u597d\u3002\u4e3a\u4ee3\u7801\u4efb\u52a1\u8bbe\u8ba1\u4e13\u95e8\u7684\u5206\u8bcd\u5668\uff0c\u6210\u4e3a\u4e86\u63d0\u5347\u6a21\u578b\u6027\u80fd\u7684\u5173\u952e\u4e00\u6b65\u3002</p> <p>\u8fd9\u4e2a\u4f8b\u5b50\u8bf4\u660e\uff1a\u5206\u8bcd\u5668\u7edd\u975e\u53ef\u4ee5\u5ffd\u89c6\u7684\"\u9884\u5904\u7406\u7ec6\u8282\"\uff0c\u5b83\u5bf9\u6a21\u578b\u7684\u80fd\u529b\u6709\u5b9e\u8d28\u6027\u7684\u5f71\u54cd\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#51","title":"5.1 \u5206\u8bcd\u5668\u539f\u7406","text":"<p>\u5206\u8bcd\u5668\u7684\u6838\u5fc3\u4efb\u52a1\u662f\u5c06\u8fde\u7eed\u7684\u6587\u672c\u5b57\u7b26\u4e32\u5207\u5206\u4e3a\u79bb\u6563\u7684 token \u5e8f\u5217\uff0c\u5e76\u5c06\u6bcf\u4e2a token \u6620\u5c04\u5230\u4e00\u4e2a\u6574\u6570 ID\u3002\u8fd9\u4e2a\u770b\u4f3c\u7b80\u5355\u7684\u4efb\u52a1\uff0c\u5b9e\u9645\u4e0a\u6d89\u53ca\u5230\u590d\u6742\u7684\u7b97\u6cd5\u8bbe\u8ba1\u548c\u5de5\u7a0b\u6743\u8861\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#511","title":"5.1.1 \u4e3a\u4ec0\u4e48\u9700\u8981\u5b50\u8bcd\u5206\u8bcd\uff1f","text":"<p>\u5728\u6df1\u5ea6\u5b66\u4e60\u65f6\u4ee3\u65e9\u671f\uff0c\u81ea\u7136\u8bed\u8a00\u5904\u7406\u901a\u5e38\u91c7\u7528\u8bcd\u7ea7\u522b\uff08Word-level\uff09\u6216\u5b57\u7b26\u7ea7\u522b\uff08Character-level\uff09\u7684\u5206\u8bcd\u65b9\u5f0f\u3002\u8bcd\u7ea7\u522b\u5206\u8bcd\u5c06\u6bcf\u4e2a\u5b8c\u6574\u7684\u5355\u8bcd\u89c6\u4e3a\u4e00\u4e2a token\uff0c\u4f18\u70b9\u662f\u8bed\u4e49\u6e05\u6670\uff0c\u7f3a\u70b9\u662f\u8bcd\u8868\u89c4\u6a21\u5e9e\u5927\uff08\u9700\u8981\u8986\u76d6\u6240\u6709\u53ef\u80fd\u51fa\u73b0\u7684\u5355\u8bcd\uff09\uff0c\u4e14\u65e0\u6cd5\u5904\u7406\u672a\u767b\u5f55\u8bcd\uff08Out-of-Vocabulary, OOV\uff09\u3002\u5b57\u7b26\u7ea7\u522b\u5206\u8bcd\u5c06\u6bcf\u4e2a\u5b57\u7b26\u89c6\u4e3a\u4e00\u4e2a token\uff0c\u4f18\u70b9\u662f\u8bcd\u8868\u6781\u5c0f\u4e14\u6ca1\u6709 OOV \u95ee\u9898\uff0c\u7f3a\u70b9\u662f\u5e8f\u5217\u8fc7\u957f\uff0c\u6a21\u578b\u96be\u4ee5\u6355\u6349\u957f\u7a0b\u4f9d\u8d56\u3002</p> <p>\u5b50\u8bcd\u5206\u8bcd\uff08Subword Tokenization\uff09\u662f\u4e00\u79cd\u6298\u4e2d\u65b9\u6848\u3002\u5b83\u5c06\u6587\u672c\u5207\u5206\u4e3a\u6bd4\u5355\u8bcd\u66f4\u5c0f\u3001\u6bd4\u5b57\u7b26\u66f4\u5927\u7684\u5355\u5143\u3002\u9ad8\u9891\u8bcd\u4fdd\u6301\u5b8c\u6574\uff0c\u4f4e\u9891\u8bcd\u5219\u88ab\u62c6\u5206\u4e3a\u66f4\u5c0f\u7684\u5b50\u8bcd\u5355\u5143\u3002\u4f8b\u5982\uff0c\"unhappiness\" \u53ef\u80fd\u88ab\u62c6\u5206\u4e3a \"un\" + \"happi\" + \"ness\"\u3002\u8fd9\u79cd\u65b9\u5f0f\u65e2\u63a7\u5236\u4e86\u8bcd\u8868\u89c4\u6a21\uff0c\u53c8\u4fdd\u7559\u4e86\u4e00\u5b9a\u7684\u8bed\u4e49\u4fe1\u606f\uff0c\u8fd8\u80fd\u901a\u8fc7\u5b50\u8bcd\u7ec4\u5408\u5904\u7406\u672a\u89c1\u8fc7\u7684\u8bcd\u6c47\u3002</p> <p></p> <p>\u56fe5-1\uff1a\u5206\u8bcd\u7c92\u5ea6\u5bf9\u6bd4 \u2014\u2014 \u8bcd\u7ea7\u522b\u3001\u5b57\u7b26\u7ea7\u522b\u4e0e\u5b50\u8bcd\u7ea7\u522b\u7684\u6743\u8861</p> <p>\u76ee\u524d\u4e3b\u6d41\u7684\u5927\u8bed\u8a00\u6a21\u578b\u51e0\u4e4e\u90fd\u91c7\u7528\u5b50\u8bcd\u5206\u8bcd\u3002GPT \u7cfb\u5217\u4f7f\u7528 BPE\uff0cBERT \u4f7f\u7528 WordPiece\uff0cT5 \u548c LLaMA \u4f7f\u7528 SentencePiece\uff08\u652f\u6301 BPE \u548c Unigram\uff09\u3002\u7406\u89e3\u8fd9\u4e9b\u7b97\u6cd5\u7684\u539f\u7406\uff0c\u662f\u8fdb\u884c\u5206\u8bcd\u5668\u5b9a\u5236\u548c\u4f18\u5316\u7684\u57fa\u7840\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#512-bpe","title":"5.1.2 BPE\uff1a\u5b57\u8282\u5bf9\u7f16\u7801","text":"<p>BPE\uff08Byte Pair Encoding\uff09\u6700\u521d\u662f\u4e00\u79cd\u6570\u636e\u538b\u7f29\u7b97\u6cd5\uff0c\u540e\u88ab Sennrich \u7b49\u4eba\u5728 2015 \u5e74\u5f15\u5165\u5230\u795e\u7ecf\u673a\u5668\u7ffb\u8bd1\u4e2d\uff0c\u6210\u4e3a\u6700\u5e7f\u6cdb\u4f7f\u7528\u7684\u5b50\u8bcd\u5206\u8bcd\u7b97\u6cd5\u3002</p> <p>BPE \u7684\u6838\u5fc3\u601d\u60f3\u975e\u5e38\u76f4\u89c2\uff1a\u4ece\u5b57\u7b26\u7ea7\u522b\u5f00\u59cb\uff0c\u53cd\u590d\u5408\u5e76\u51fa\u73b0\u9891\u7387\u6700\u9ad8\u7684\u76f8\u90bb token \u5bf9\uff0c\u76f4\u5230\u8fbe\u5230\u9884\u5b9a\u7684\u8bcd\u8868\u5927\u5c0f\u3002\u5177\u4f53\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>\u5c06\u6240\u6709\u8bad\u7ec3\u6587\u672c\u62c6\u5206\u4e3a\u5b57\u7b26\u5e8f\u5217\uff0c\u6bcf\u4e2a\u5b57\u7b26\u4f5c\u4e3a\u521d\u59cb token</li> <li>\u7edf\u8ba1\u6240\u6709\u76f8\u90bb token \u5bf9\u7684\u51fa\u73b0\u9891\u7387</li> <li>\u5c06\u9891\u7387\u6700\u9ad8\u7684 token \u5bf9\u5408\u5e76\u4e3a\u4e00\u4e2a\u65b0 token</li> <li>\u91cd\u590d\u6b65\u9aa4 2-3\uff0c\u76f4\u5230\u8bcd\u8868\u8fbe\u5230\u76ee\u6807\u5927\u5c0f</li> </ol> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u7b80\u5316\u7684 BPE \u8bad\u7ec3\u5b9e\u73b0\uff1a</p> <pre><code>from collections import Counter, defaultdict\n\ndef train_bpe(corpus: list, vocab_size: int) -&gt; dict:\n    \"\"\"\n    \u8bad\u7ec3 BPE \u5206\u8bcd\u5668\n\n    Args:\n        corpus: \u8bad\u7ec3\u8bed\u6599\u5217\u8868\n        vocab_size: \u76ee\u6807\u8bcd\u8868\u5927\u5c0f\n\n    Returns:\n        \u5408\u5e76\u89c4\u5219\u5b57\u5178\n    \"\"\"\n    # \u521d\u59cb\u5316\uff1a\u5c06\u6bcf\u4e2a\u8bcd\u62c6\u5206\u4e3a\u5b57\u7b26\uff0c\u5e76\u6dfb\u52a0\u8bcd\u5c3e\u6807\u8bb0\n    word_freqs = Counter()\n    for text in corpus:\n        for word in text.split():\n            # \u6dfb\u52a0\u8bcd\u5c3e\u6807\u8bb0 &lt;/w&gt; \u4ee5\u533a\u5206\u8bcd\u4e2d\u548c\u8bcd\u5c3e\u7684\u76f8\u540c\u5b57\u7b26\n            word_freqs[' '.join(list(word)) + ' &lt;/w&gt;'] += 1\n\n    merges = {}\n    vocab = set()\n\n    # \u521d\u59cb\u8bcd\u8868\u4e3a\u6240\u6709\u5b57\u7b26\n    for word in word_freqs:\n        for char in word.split():\n            vocab.add(char)\n\n    while len(vocab) &lt; vocab_size:\n        # \u7edf\u8ba1\u76f8\u90bb token \u5bf9\u9891\u7387\n        pair_freqs = defaultdict(int)\n        for word, freq in word_freqs.items():\n            tokens = word.split()\n            for i in range(len(tokens) - 1):\n                pair = (tokens[i], tokens[i + 1])\n                pair_freqs[pair] += freq\n\n        if not pair_freqs:\n            break\n\n        # \u627e\u5230\u9891\u7387\u6700\u9ad8\u7684 pair\n        best_pair = max(pair_freqs, key=pair_freqs.get)\n\n        # \u5408\u5e76\u8fd9\u4e2a pair\n        new_token = best_pair[0] + best_pair[1]\n        merges[best_pair] = new_token\n        vocab.add(new_token)\n\n        # \u66f4\u65b0\u8bcd\u9891\u8868\n        new_word_freqs = {}\n        for word, freq in word_freqs.items():\n            new_word = word.replace(\n                best_pair[0] + ' ' + best_pair[1], \n                new_token\n            )\n            new_word_freqs[new_word] = freq\n        word_freqs = new_word_freqs\n\n    return merges\n\ndef apply_bpe(text: str, merges: dict) -&gt; list:\n    \"\"\"\u5e94\u7528 BPE \u5206\u8bcd\"\"\"\n    tokens = list(text) + ['&lt;/w&gt;']\n\n    while True:\n        # \u627e\u5230\u53ef\u4ee5\u5408\u5e76\u7684 pair\n        pairs = [(tokens[i], tokens[i+1]) for i in range(len(tokens)-1)]\n        merge_pair = None\n        for pair in pairs:\n            if pair in merges:\n                merge_pair = pair\n                break\n\n        if merge_pair is None:\n            break\n\n        # \u6267\u884c\u5408\u5e76\n        new_tokens = []\n        i = 0\n        while i &lt; len(tokens):\n            if i &lt; len(tokens) - 1 and (tokens[i], tokens[i+1]) == merge_pair:\n                new_tokens.append(merges[merge_pair])\n                i += 2\n            else:\n                new_tokens.append(tokens[i])\n                i += 1\n        tokens = new_tokens\n\n    return tokens\n</code></pre>"},{"location":"part2/2_3_tokenization_serialization/#516-byte-level-bpe","title":"5.1.6 Byte-Level BPE\uff1a\u6df1\u5165\u89e3\u6790","text":"<p>BPE \u7684\u4e00\u4e2a\u91cd\u8981\u53d8\u4f53\u662f Byte-level BPE\uff0c\u7531 GPT-2 \u9996\u5148\u5f15\u5165\u3002\u4f20\u7edf BPE \u5728\u5b57\u7b26\u7ea7\u522b\u64cd\u4f5c\uff0c\u9700\u8981\u5904\u7406 Unicode \u7f16\u7801\u95ee\u9898\u2014\u2014\u4e0d\u540c\u8bed\u8a00\u7684\u5b57\u7b26\u96c6\u5dee\u5f02\u5de8\u5927\uff0c\u4e14\u67d0\u4e9b\u5b57\u7b26\uff08\u5982 Emoji\u3001\u7279\u6b8a\u7b26\u53f7\uff09\u53ef\u80fd\u4e0d\u5728\u8bad\u7ec3\u6570\u636e\u4e2d\u51fa\u73b0\uff0c\u5bfc\u81f4 UNK\u3002</p> <p>Byte-level BPE \u76f4\u63a5\u5728\u5b57\u8282\u7ea7\u522b\u64cd\u4f5c\uff0c\u5c06\u6bcf\u4e2a\u5b57\u8282\uff080-255\uff09\u6620\u5c04\u5230\u4e00\u4e2a\u53ef\u6253\u5370\u5b57\u7b26\uff0c\u4ece\u800c\u907f\u514d\u4e86\u7f16\u7801\u95ee\u9898\uff0c\u4e14\u5929\u7136\u652f\u6301\u4efb\u4f55\u8bed\u8a00\u3002\u8fd9\u4e5f\u662f GPT \u7cfb\u5217\u6a21\u578b\u80fd\u591f\u5904\u7406\u4efb\u610f\u8bed\u8a00\u6587\u672c\u7684\u539f\u56e0\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#_3","title":"\u5de5\u4f5c\u539f\u7406","text":"<ol> <li>\u5b57\u8282\u7f16\u7801\uff1a\u5c06\u8f93\u5165\u6587\u672c\u7f16\u7801\u4e3a UTF-8 \u5b57\u8282\u5e8f\u5217\u3002\u4f8b\u5982\uff0c\u4e2d\u6587\u5b57\"\u4f60\"\u5728 UTF-8 \u4e2d\u7f16\u7801\u4e3a 3 \u4e2a\u5b57\u8282 <code>[0xe4, 0xbd, 0xa0]</code>\u3002</li> <li>\u5b57\u8282\u6620\u5c04\uff1a\u5c06 256 \u4e2a\u53ef\u80fd\u7684\u5b57\u8282\u503c\u6620\u5c04\u5230 256 \u4e2a\u53ef\u6253\u5370\u7684 Unicode \u5b57\u7b26\u3002\u8fd9\u6837\u53ef\u4ee5\u7528\u6807\u51c6\u7684\u5b57\u7b26\u7ea7 BPE \u7b97\u6cd5\u5904\u7406\u5b57\u8282\u5e8f\u5217\u3002</li> <li>BPE \u8bad\u7ec3\u4e0e\u5e94\u7528\uff1a\u5728\u6620\u5c04\u540e\u7684\u5b57\u8282\u5e8f\u5217\u4e0a\u6267\u884c\u6807\u51c6\u7684 BPE \u7b97\u6cd5\u3002</li> </ol>"},{"location":"part2/2_3_tokenization_serialization/#_4","title":"\u5bf9\u591a\u8bed\u8a00\u7684\u5f71\u54cd","text":"<p>Byte-level BPE \u5bf9\u4e0d\u540c\u8bed\u8a00\u7684\u5f71\u54cd\u5dee\u5f02\u663e\u8457\uff1a</p> <ul> <li>\u82f1\u6587\uff1aASCII \u5b57\u7b26\u53ea\u9700 1 \u4e2a\u5b57\u8282\uff0c\u4e0e\u5b57\u7b26\u7ea7 BPE \u51e0\u4e4e\u7b49\u4ef7\u3002</li> <li>\u4e2d\u6587\uff1a\u6bcf\u4e2a\u6c49\u5b57\u9700\u8981 3 \u4e2a\u5b57\u8282\uff0c\u5982\u679c\u8bcd\u8868\u4e2d\u6ca1\u6709\u5145\u5206\u7684\u4e2d\u6587 token\uff0c\u4e00\u4e2a\u6c49\u5b57\u53ef\u80fd\u88ab\u5206\u89e3\u4e3a 2-3 \u4e2a token\uff0c\u4e25\u91cd\u5f71\u54cd\u5e8f\u5217\u957f\u5ea6\u548c\u8ba1\u7b97\u6548\u7387\u3002</li> <li>\u65e5\u8bed/\u97e9\u8bed\uff1a\u5206\u522b\u9700\u8981 3 \u548c 3-4 \u4e2a\u5b57\u8282\uff0c\u4e5f\u5b58\u5728\u7c7b\u4f3c\u95ee\u9898\u3002</li> </ul> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u539f\u7248 LLaMA \u7684\u4e2d\u6587\u80fd\u529b\u8f83\u5dee\u2014\u2014\u5176\u8bcd\u8868\u4e3b\u8981\u57fa\u4e8e\u82f1\u6587\u8bad\u7ec3\uff0c\u4e2d\u6587\u5b57\u7b26\u88ab\u8fc7\u5ea6\u5207\u5206\uff0c\u5bfc\u81f4\u8f93\u5165\u5e8f\u5217\u957f\u5ea6\u81a8\u80c0\u3002\u89e3\u51b3\u65b9\u6848\u662f \u4e2d\u6587\u8bcd\u8868\u6269\u5145\uff0c\u6211\u4eec\u5c06\u5728 5.2.5 \u8282\u8be6\u7ec6\u8ba8\u8bba\u3002</p> <pre><code># Byte-level BPE \u7684\u5b57\u8282\u6620\u5c04\u7684\u6838\u5fc3\u5b9e\u73b0\ndef bytes_to_unicode():\n    \"\"\"\n    GPT-2 \u7684\u5b57\u8282\u5230 Unicode \u6620\u5c04\n    \u5c06 256 \u4e2a\u5b57\u8282\u503c\u6620\u5c04\u5230\u53ef\u6253\u5370\u7684 Unicode \u5b57\u7b26\n    \"\"\"\n    # \u53ef\u76f4\u63a5\u6253\u5370\u7684 ASCII \u8303\u56f4\n    bs = list(range(ord('!'), ord('~') + 1)) + \\\n         list(range(ord('\u00a1'), ord('\u00ac') + 1)) + \\\n         list(range(ord('\u00ae'), ord('\u00ff') + 1))\n\n    cs = bs[:]\n    n = 0\n    # \u5176\u4f59\u5b57\u8282\u6620\u5c04\u5230\u66f4\u9ad8\u7684 Unicode \u7801\u70b9\n    for b in range(256):\n        if b not in bs:\n            bs.append(b)\n            cs.append(256 + n)\n            n += 1\n\n    cs = [chr(n) for n in cs]\n    return dict(zip(bs, cs))\n\ndef analyze_byte_level_impact(text: str, tokenizer_name: str):\n    \"\"\"\u5206\u6790 Byte-level BPE \u5bf9\u4e0d\u540c\u8bed\u8a00\u7684\u5f71\u54cd\"\"\"\n    from transformers import AutoTokenizer\n\n    tokenizer = AutoTokenizer.from_pretrained(tokenizer_name)\n    tokens = tokenizer.tokenize(text)\n\n    # \u8ba1\u7b97\u538b\u7f29\u7387\n    utf8_bytes = len(text.encode('utf-8'))\n    num_tokens = len(tokens)\n    chars_per_token = len(text) / num_tokens\n    bytes_per_token = utf8_bytes / num_tokens\n\n    print(f\"\u6587\u672c: '{text[:50]}...'\")\n    print(f\"\u5b57\u7b26\u6570: {len(text)}, UTF-8 \u5b57\u8282\u6570: {utf8_bytes}\")\n    print(f\"Token \u6570: {num_tokens}\")\n    print(f\"\u6bcf\u4e2a token \u5e73\u5747\u5b57\u7b26\u6570: {chars_per_token:.2f}\")\n    print(f\"\u6bcf\u4e2a token \u5e73\u5747\u5b57\u8282\u6570: {bytes_per_token:.2f}\")\n    print(f\"Tokens: {tokens[:20]}\")\n\n    return {'num_tokens': num_tokens, 'chars_per_token': chars_per_token}\n</code></pre>"},{"location":"part2/2_3_tokenization_serialization/#513-wordpiecebert","title":"5.1.3 WordPiece\uff1aBERT \u7684\u9009\u62e9","text":"<p>WordPiece \u662f Google \u4e3a BERT \u5f00\u53d1\u7684\u5206\u8bcd\u7b97\u6cd5\uff0c\u4e0e BPE \u975e\u5e38\u76f8\u4f3c\uff0c\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u9009\u62e9\u5408\u5e76\u5bf9\u7684\u6807\u51c6\u3002</p> <p>BPE \u9009\u62e9\u51fa\u73b0\u9891\u7387\u6700\u9ad8\u7684 pair \u8fdb\u884c\u5408\u5e76\u3002WordPiece \u5219\u9009\u62e9\u80fd\u591f\u6700\u5927\u5316\u8bad\u7ec3\u6570\u636e\u4f3c\u7136\u7684 pair\u3002\u5177\u4f53\u6765\u8bf4\uff0c\u5bf9\u4e8e\u5019\u9009 pair (A, B)\uff0cWordPiece \u8ba1\u7b97\u5408\u5e76\u540e\u8bcd\u8868\u5bf9\u8bad\u7ec3\u6570\u636e\u7684\u8bed\u8a00\u6a21\u578b\u6982\u7387\u589e\u76ca\uff0c\u9009\u62e9\u589e\u76ca\u6700\u5927\u7684 pair \u8fdb\u884c\u5408\u5e76\u3002</p> <p>\u5728\u5b9e\u8df5\u4e2d\uff0c\u8fd9\u610f\u5473\u7740 WordPiece \u503e\u5411\u4e8e\u5408\u5e76\u90a3\u4e9b\"\u5728\u4e00\u8d77\u51fa\u73b0\u7684\u6982\u7387\u8fdc\u9ad8\u4e8e\u72ec\u7acb\u51fa\u73b0\u6982\u7387\u4e4b\u79ef\"\u7684 pair\u3002\u8fd9\u4e2a\u6807\u51c6\u4f7f\u5f97 WordPiece \u5bf9\u4e8e\u4f4e\u9891\u4f46\u6709\u610f\u4e49\u7684\u6a21\u5f0f\u66f4\u52a0\u654f\u611f\u3002</p> <p>WordPiece \u7684\u53e6\u4e00\u4e2a\u7279\u70b9\u662f\u4f7f\u7528 <code>##</code> \u524d\u7f00\u6765\u6807\u8bc6\u975e\u8bcd\u9996\u7684\u5b50\u8bcd\u3002\u4f8b\u5982\uff0c\"playing\" \u53ef\u80fd\u88ab\u5206\u8bcd\u4e3a [\"play\", \"##ing\"]\u3002\u8fd9\u79cd\u8868\u793a\u65b9\u5f0f\u660e\u786e\u533a\u5206\u4e86\u5b50\u8bcd\u5728\u539f\u8bcd\u4e2d\u7684\u4f4d\u7f6e\uff0c\u6709\u52a9\u4e8e\u6a21\u578b\u7406\u89e3\u8bcd\u6c47\u7ed3\u6784\u3002</p> <pre><code># WordPiece \u5206\u8bcd\u793a\u4f8b\uff08\u4f7f\u7528 HuggingFace tokenizers\uff09\nfrom tokenizers import Tokenizer\nfrom tokenizers.models import WordPiece\nfrom tokenizers.trainers import WordPieceTrainer\nfrom tokenizers.pre_tokenizers import Whitespace\n\n# \u521d\u59cb\u5316 WordPiece \u5206\u8bcd\u5668\ntokenizer = Tokenizer(WordPiece(unk_token=\"[UNK]\"))\ntokenizer.pre_tokenizer = Whitespace()\n\n# \u8bad\u7ec3\ntrainer = WordPieceTrainer(\n    vocab_size=30000,\n    special_tokens=[\"[UNK]\", \"[CLS]\", \"[SEP]\", \"[PAD]\", \"[MASK]\"]\n)\ntokenizer.train(files=[\"corpus.txt\"], trainer=trainer)\n\n# \u4f7f\u7528\noutput = tokenizer.encode(\"unhappiness\")\nprint(output.tokens)  # ['un', '##happi', '##ness']\n</code></pre>"},{"location":"part2/2_3_tokenization_serialization/#514-unigram","title":"5.1.4 Unigram\uff1a\u6982\u7387\u89c6\u89d2\u7684\u5206\u8bcd","text":"<p>Unigram \u5206\u8bcd\u7531 Kudo \u5728 2018 \u5e74\u63d0\u51fa\uff0c\u91c7\u7528\u4e86\u4e0e BPE/WordPiece \u5b8c\u5168\u4e0d\u540c\u7684\u601d\u8def\u3002BPE \u548c WordPiece \u90fd\u662f\u81ea\u5e95\u5411\u4e0a\u7684\u65b9\u6cd5\u2014\u2014\u4ece\u5c0f\u7684\u5355\u5143\u5f00\u59cb\uff0c\u9010\u6b65\u5408\u5e76\u6210\u5927\u7684\u5355\u5143\u3002Unigram \u5219\u662f\u81ea\u9876\u5411\u4e0b\u7684\u65b9\u6cd5\u2014\u2014\u4ece\u4e00\u4e2a\u5305\u542b\u6240\u6709\u53ef\u80fd\u5b50\u8bcd\u7684\u5927\u8bcd\u8868\u5f00\u59cb\uff0c\u9010\u6b65\u5220\u51cf\u5230\u76ee\u6807\u5927\u5c0f\u3002</p> <p>Unigram \u5c06\u5206\u8bcd\u5efa\u6a21\u4e3a\u4e00\u4e2a\u6982\u7387\u95ee\u9898\u3002\u7ed9\u5b9a\u8bcd\u8868 V \u548c\u6bcf\u4e2a token \u7684\u6982\u7387 P(t)\uff0c\u4e00\u4e2a\u6587\u672c\u7684\u5206\u8bcd\u7ed3\u679c\u662f\u4f7f\u5f97\u603b\u6982\u7387\u6700\u5927\u5316\u7684\u5207\u5206\u65b9\u5f0f\uff1a</p> \\[P(x_1, x_2, ..., x_n) = \\prod_{i=1}^{n} P(x_i)\\] <p>\u8bad\u7ec3\u8fc7\u7a0b\u4f7f\u7528 EM \u7b97\u6cd5\uff1aE \u6b65\u9aa4\u8ba1\u7b97\u5f53\u524d\u8bcd\u8868\u4e0b\u6bcf\u4e2a token \u7684\u671f\u671b\u51fa\u73b0\u6b21\u6570\uff0cM \u6b65\u9aa4\u66f4\u65b0 token \u6982\u7387\u3002\u7136\u540e\u5220\u9664\u90a3\u4e9b\u5220\u9664\u540e\u5bf9\u603b\u4f3c\u7136\u5f71\u54cd\u6700\u5c0f\u7684 token\uff0c\u76f4\u5230\u8fbe\u5230\u76ee\u6807\u8bcd\u8868\u5927\u5c0f\u3002</p> <p>Unigram \u7684\u4e00\u4e2a\u72ec\u7279\u4f18\u52bf\u662f\u5b83\u5929\u7136\u652f\u6301\u591a\u79cd\u5206\u8bcd\u7ed3\u679c\u7684\u6982\u7387\u5efa\u6a21\u3002\u5bf9\u4e8e\u4e00\u4e2a\u7ed9\u5b9a\u7684\u6587\u672c\uff0c\u53ef\u80fd\u5b58\u5728\u591a\u79cd\u5408\u6cd5\u7684\u5206\u8bcd\u65b9\u5f0f\uff0cUnigram \u53ef\u4ee5\u4e3a\u6bcf\u79cd\u65b9\u5f0f\u8d4b\u4e88\u4e00\u4e2a\u6982\u7387\u3002\u8fd9\u5728\u67d0\u4e9b\u5e94\u7528\u573a\u666f\uff08\u5982\u8bed\u97f3\u8bc6\u522b\u4e2d\u7684\u591a\u5047\u8bbe\u5904\u7406\uff09\u4e2d\u975e\u5e38\u6709\u7528\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#515","title":"5.1.5 \u4e09\u79cd\u7b97\u6cd5\u7684\u5bf9\u6bd4","text":"<p>\u4e09\u79cd\u4e3b\u6d41\u5b50\u8bcd\u5206\u8bcd\u7b97\u6cd5\u5404\u6709\u7279\u70b9\uff0c\u9009\u62e9\u65f6\u9700\u8981\u6839\u636e\u5177\u4f53\u573a\u666f\u6743\u8861\u3002</p> \u7b97\u6cd5 \u6838\u5fc3\u601d\u60f3 \u4f18\u52bf \u52a3\u52bf \u5178\u578b\u5e94\u7528 BPE \u81ea\u5e95\u5411\u4e0a\uff0c\u9891\u7387\u9a71\u52a8\u5408\u5e76 \u7b80\u5355\u76f4\u89c2\uff0c\u8bad\u7ec3\u5feb \u8d2a\u5fc3\u7b56\u7565\u53ef\u80fd\u975e\u6700\u4f18 GPT\u7cfb\u5217\u3001LLaMA WordPiece \u81ea\u5e95\u5411\u4e0a\uff0c\u4f3c\u7136\u9a71\u52a8\u5408\u5e76 \u5bf9\u4f4e\u9891\u6709\u610f\u4e49\u6a21\u5f0f\u654f\u611f \u8ba1\u7b97\u590d\u6742\u5ea6\u8f83\u9ad8 BERT\u3001DistilBERT Unigram \u81ea\u9876\u5411\u4e0b\uff0c\u6982\u7387\u5efa\u6a21 \u7406\u8bba\u4f18\u96c5\uff0c\u652f\u6301\u591a\u5206\u8bcd \u8bad\u7ec3\u8f83\u6162 T5\u3001mT5\u3001ALBERT <p></p> <p>\u56fe5-2\uff1aBPE\u3001WordPiece\u3001Unigram \u4e09\u79cd\u5206\u8bcd\u7b97\u6cd5\u7684\u5bf9\u6bd4</p> <p>\u5728\u5b9e\u9645\u5de5\u7a0b\u4e2d\uff0cSentencePiece \u662f\u6700\u5e38\u7528\u7684\u5206\u8bcd\u5de5\u5177\u5305\u3002\u5b83\u652f\u6301 BPE \u548c Unigram \u4e24\u79cd\u7b97\u6cd5\uff0c\u63d0\u4f9b\u4e86\u8bed\u8a00\u65e0\u5173\u7684\u9884\u5904\u7406\uff08\u4e0d\u4f9d\u8d56\u7a7a\u683c\u5206\u8bcd\uff09\uff0c\u5e76\u4e14\u4e0e\u4e3b\u6d41\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u65e0\u7f1d\u96c6\u6210\u3002</p> <pre><code>import sentencepiece as spm\n\n# \u8bad\u7ec3 SentencePiece \u6a21\u578b\nspm.SentencePieceTrainer.train(\n    input='corpus.txt',\n    model_prefix='my_tokenizer',\n    vocab_size=32000,\n    model_type='bpe',  # \u6216 'unigram'\n    character_coverage=0.9995,\n    num_threads=16\n)\n\n# \u52a0\u8f7d\u548c\u4f7f\u7528\nsp = spm.SentencePieceProcessor(model_file='my_tokenizer.model')\ntokens = sp.encode('Hello, world!', out_type=str)\nprint(tokens)  # ['\u2581Hello', ',', '\u2581world', '!']\nids = sp.encode('Hello, world!')\nprint(ids)  # [1234, 56, 789, 10]\n</code></pre>"},{"location":"part2/2_3_tokenization_serialization/#52","title":"5.2 \u8bcd\u8868\u8bbe\u8ba1\u4e0e\u6269\u5145","text":"<p>\u8bcd\u8868\uff08Vocabulary\uff09\u662f\u5206\u8bcd\u5668\u7684\u6838\u5fc3\u7ec4\u6210\u90e8\u5206\u3002\u8bcd\u8868\u7684\u5927\u5c0f\u3001\u8986\u76d6\u8303\u56f4\u548c\u7ed3\u6784\u76f4\u63a5\u5f71\u54cd\u6a21\u578b\u7684\u6027\u80fd\u548c\u6548\u7387\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#521","title":"5.2.1 \u8bcd\u8868\u5927\u5c0f\u7684\u6743\u8861","text":"<p>\u8bcd\u8868\u5927\u5c0f\u662f\u5206\u8bcd\u5668\u8bbe\u8ba1\u4e2d\u6700\u91cd\u8981\u7684\u8d85\u53c2\u6570\u4e4b\u4e00\u3002\u8f83\u5927\u7684\u8bcd\u8868\u610f\u5473\u7740\u66f4\u591a\u7684 token \u88ab\u4fdd\u7559\u4e3a\u5b8c\u6574\u5355\u5143\uff0c\u5e8f\u5217\u957f\u5ea6\u66f4\u77ed\uff0c\u4f46\u5d4c\u5165\u77e9\u9635\u66f4\u5927\uff0c\u53c2\u6570\u66f4\u591a\uff1b\u8f83\u5c0f\u7684\u8bcd\u8868\u610f\u5473\u7740\u66f4\u591a\u7684\u8bcd\u88ab\u62c6\u5206\u4e3a\u5b50\u8bcd\uff0c\u5e8f\u5217\u957f\u5ea6\u66f4\u957f\uff0c\u4f46\u6a21\u578b\u53c2\u6570\u66f4\u5c11\u3002</p> <p>\u4e3b\u6d41\u5927\u6a21\u578b\u7684\u8bcd\u8868\u5927\u5c0f\u901a\u5e38\u5728 32K \u5230 128K \u4e4b\u95f4\u3002GPT-2 \u4f7f\u7528 50,257 \u7684\u8bcd\u8868\uff0cLLaMA \u4f7f\u7528 32,000\uff0cGPT-4 \u636e\u62a5\u9053\u4f7f\u7528\u7ea6 100,000\u3002\u9009\u62e9\u8bcd\u8868\u5927\u5c0f\u65f6\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u56e0\u7d20\uff1a</p> <p>\u8ba1\u7b97\u6548\u7387\uff1a\u8bcd\u8868\u8d8a\u5927\uff0c\u5d4c\u5165\u5c42\u548c\u8f93\u51fa\u5c42\u7684\u53c2\u6570\u8d8a\u591a\u3002\u5bf9\u4e8e\u4e00\u4e2a d \u7ef4\u7684\u6a21\u578b\uff0c\u8bcd\u8868\u5927\u5c0f\u4e3a V \u65f6\uff0c\u5d4c\u5165\u77e9\u9635\u5305\u542b V \u00d7 d \u4e2a\u53c2\u6570\u3002\u5f53 V \u4ece 32K \u589e\u52a0\u5230 128K \u65f6\uff0c\u8fd9\u90e8\u5206\u53c2\u6570\u91cf\u589e\u52a0 4 \u500d\u3002</p> <p>\u5e8f\u5217\u957f\u5ea6\uff1a\u8bcd\u8868\u8d8a\u5927\uff0c\u5e73\u5747\u6bcf\u4e2a token \u8986\u76d6\u7684\u5b57\u7b26\u8d8a\u591a\uff0c\u540c\u6837\u7684\u6587\u672c\u88ab\u5206\u6210\u7684 token \u6570\u8d8a\u5c11\u3002\u8fd9\u5bf9\u4e8e\u5904\u7406\u957f\u6587\u6863\u5c24\u4e3a\u91cd\u8981\uff0c\u56e0\u4e3a Transformer \u7684\u8ba1\u7b97\u590d\u6742\u5ea6\u4e0e\u5e8f\u5217\u957f\u5ea6\u7684\u5e73\u65b9\u6210\u6b63\u6bd4\u3002</p> <p>\u7a00\u6709\u8bcd\u5904\u7406\uff1a\u8bcd\u8868\u8d8a\u5927\uff0c\u8d8a\u591a\u7684\u7a00\u6709\u8bcd\u53ef\u4ee5\u88ab\u4fdd\u7559\u4e3a\u5b8c\u6574 token\uff0c\u51cf\u5c11\u4e86 UNK \u548c\u8fc7\u5ea6\u5207\u5206\u7684\u95ee\u9898\u3002\u4f46\u8fd9\u4e5f\u610f\u5473\u7740\u7a00\u6709 token \u5728\u8bad\u7ec3\u4e2d\u89c1\u5230\u7684\u6837\u672c\u66f4\u5c11\uff0c\u53ef\u80fd\u5bfc\u81f4\u5d4c\u5165\u8d28\u91cf\u4e0d\u4f73\u3002</p> <pre><code># \u5206\u6790\u4e0d\u540c\u8bcd\u8868\u5927\u5c0f\u5bf9\u5e8f\u5217\u957f\u5ea6\u7684\u5f71\u54cd\ndef analyze_vocab_size_impact(text: str, vocab_sizes: list) -&gt; dict:\n    \"\"\"\u5206\u6790\u8bcd\u8868\u5927\u5c0f\u5bf9\u5206\u8bcd\u7ed3\u679c\u7684\u5f71\u54cd\"\"\"\n    import sentencepiece as spm\n\n    results = {}\n    for vocab_size in vocab_sizes:\n        # \u8bad\u7ec3\u4e0d\u540c\u8bcd\u8868\u5927\u5c0f\u7684\u5206\u8bcd\u5668\n        spm.SentencePieceTrainer.train(\n            input='corpus.txt',\n            model_prefix=f'tokenizer_{vocab_size}',\n            vocab_size=vocab_size,\n            model_type='bpe'\n        )\n\n        sp = spm.SentencePieceProcessor(model_file=f'tokenizer_{vocab_size}.model')\n        tokens = sp.encode(text)\n\n        results[vocab_size] = {\n            'num_tokens': len(tokens),\n            'chars_per_token': len(text) / len(tokens),\n            'compression_ratio': len(text.encode('utf-8')) / (len(tokens) * 2)\n        }\n\n    return results\n</code></pre>"},{"location":"part2/2_3_tokenization_serialization/#522","title":"5.2.2 \u591a\u8bed\u8a00\u8bcd\u8868\u8bbe\u8ba1","text":"<p>\u8bad\u7ec3\u591a\u8bed\u8a00\u6a21\u578b\u65f6\uff0c\u8bcd\u8868\u8bbe\u8ba1\u9762\u4e34\u989d\u5916\u7684\u6311\u6218\uff1a\u5982\u4f55\u5728\u6709\u9650\u7684\u8bcd\u8868\u7a7a\u95f4\u4e2d\u5e73\u8861\u4e0d\u540c\u8bed\u8a00\u7684\u8986\u76d6\uff1f</p> <p>\u4e00\u4e2a\u5e38\u89c1\u7684\u95ee\u9898\u662f\"\u8bcd\u8868\u8bc5\u5492\"\uff08Vocabulary Curse\uff09\u3002\u5982\u679c\u76f4\u63a5\u5728\u591a\u8bed\u8a00\u8bed\u6599\u4e0a\u8bad\u7ec3\u5206\u8bcd\u5668\uff0c\u9ad8\u8d44\u6e90\u8bed\u8a00\uff08\u5982\u82f1\u8bed\uff09\u4f1a\u5360\u636e\u5927\u90e8\u5206\u8bcd\u8868\u7a7a\u95f4\uff0c\u4f4e\u8d44\u6e90\u8bed\u8a00\u7684\u8986\u76d6\u4e25\u91cd\u4e0d\u8db3\u3002\u8fd9\u5bfc\u81f4\u4f4e\u8d44\u6e90\u8bed\u8a00\u7684\u6587\u672c\u88ab\u8fc7\u5ea6\u5207\u5206\uff0c\u5e8f\u5217\u957f\u5ea6\u81a8\u80c0\uff0c\u6a21\u578b\u6027\u80fd\u4e0b\u964d\u3002</p> <p>\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u7684\u5e38\u7528\u7b56\u7565\u5305\u62ec\uff1a</p> <p>\u8bed\u6599\u5e73\u8861\uff1a\u5728\u8bad\u7ec3\u5206\u8bcd\u5668\u4e4b\u524d\uff0c\u5bf9\u4e0d\u540c\u8bed\u8a00\u7684\u8bed\u6599\u8fdb\u884c\u4e0a\u91c7\u6837\u6216\u4e0b\u91c7\u6837\uff0c\u4f7f\u6bcf\u79cd\u8bed\u8a00\u7684\u6743\u91cd\u66f4\u52a0\u5747\u8861\u3002</p> <p>\u6e29\u5ea6\u91c7\u6837\uff1a\u7c7b\u4f3c\u4e8e\u6211\u4eec\u5728\u7b2c 3 \u7ae0\u8ba8\u8bba\u7684\u591a\u8bed\u8a00\u6570\u636e\u5e73\u8861\u7b56\u7565\uff0c\u4f7f\u7528\u6e29\u5ea6\u53c2\u6570\u63a7\u5236\u4e0d\u540c\u8bed\u8a00\u7684\u91c7\u6837\u6982\u7387\u3002</p> <p>\u8bed\u8a00\u7279\u5b9a\u7684\u5b57\u7b26\u8986\u76d6\uff1a\u786e\u4fdd\u6bcf\u79cd\u76ee\u6807\u8bed\u8a00\u7684\u57fa\u672c\u5b57\u7b26\u96c6\u90fd\u88ab\u7eb3\u5165\u8bcd\u8868\uff0c\u5373\u4f7f\u5b83\u4eec\u7684\u9891\u7387\u5f88\u4f4e\u3002SentencePiece \u63d0\u4f9b\u4e86 <code>character_coverage</code> \u53c2\u6570\u6765\u63a7\u5236\u8fd9\u4e00\u70b9\u3002</p> <pre><code># \u591a\u8bed\u8a00\u5206\u8bcd\u5668\u8bad\u7ec3\u793a\u4f8b\nimport sentencepiece as spm\n\n# \u4f7f\u7528\u5b57\u7b26\u8986\u76d6\u7387\u786e\u4fdd\u591a\u8bed\u8a00\u652f\u6301\nspm.SentencePieceTrainer.train(\n    input='multilingual_corpus.txt',\n    model_prefix='multilingual_tokenizer',\n    vocab_size=64000,\n    model_type='unigram',\n    character_coverage=0.9999,  # \u9ad8\u8986\u76d6\u7387\u786e\u4fdd\u7a00\u6709\u5b57\u7b26\u88ab\u5305\u542b\n    input_sentence_size=10000000,\n    shuffle_input_sentence=True,\n    # \u7279\u6b8a\u5904\u7406\u4e2d\u65e5\u97e9\u5b57\u7b26\n    byte_fallback=True  # \u672a\u77e5\u5b57\u7b26\u56de\u9000\u5230\u5b57\u8282\u7ea7\u522b\n)\n</code></pre>"},{"location":"part2/2_3_tokenization_serialization/#523","title":"5.2.3 \u9886\u57df\u7279\u5b9a\u8bcd\u8868\u6269\u5145","text":"<p>\u5728\u5c06\u9884\u8bad\u7ec3\u6a21\u578b\u5e94\u7528\u4e8e\u7279\u5b9a\u9886\u57df\uff08\u5982\u533b\u7597\u3001\u6cd5\u5f8b\u3001\u4ee3\u7801\uff09\u65f6\uff0c\u7ecf\u5e38\u4f1a\u9047\u5230\u5927\u91cf\u9886\u57df\u672f\u8bed\u88ab\u8fc7\u5ea6\u5207\u5206\u7684\u95ee\u9898\u3002\u8fd9\u4e0d\u4ec5\u589e\u52a0\u4e86\u5e8f\u5217\u957f\u5ea6\uff0c\u8fd8\u53ef\u80fd\u5f71\u54cd\u6a21\u578b\u5bf9\u4e13\u4e1a\u6982\u5ff5\u7684\u7406\u89e3\u3002</p> <p>\u8bcd\u8868\u6269\u5145\uff08Vocabulary Extension\uff09\u662f\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u7684\u6709\u6548\u624b\u6bb5\u3002\u57fa\u672c\u601d\u8def\u662f\uff1a\u5728\u4fdd\u7559\u539f\u6709\u8bcd\u8868\u7684\u57fa\u7840\u4e0a\uff0c\u6dfb\u52a0\u65b0\u7684\u9886\u57df\u7279\u5b9a token\u3002</p> <pre><code>from transformers import AutoTokenizer\n\ndef extend_tokenizer(base_tokenizer_name: str, \n                     domain_terms: list,\n                     output_dir: str) -&gt; None:\n    \"\"\"\n    \u6269\u5145\u9884\u8bad\u7ec3\u5206\u8bcd\u5668\u7684\u8bcd\u8868\n\n    Args:\n        base_tokenizer_name: \u57fa\u7840\u5206\u8bcd\u5668\u540d\u79f0\n        domain_terms: \u9886\u57df\u7279\u5b9a\u672f\u8bed\u5217\u8868\n        output_dir: \u8f93\u51fa\u76ee\u5f55\n    \"\"\"\n    # \u52a0\u8f7d\u57fa\u7840\u5206\u8bcd\u5668\n    tokenizer = AutoTokenizer.from_pretrained(base_tokenizer_name)\n\n    print(f\"\u539f\u59cb\u8bcd\u8868\u5927\u5c0f: {len(tokenizer)}\")\n\n    # \u8fc7\u6ee4\u5df2\u5b58\u5728\u7684 token\n    new_tokens = []\n    for term in domain_terms:\n        if term not in tokenizer.get_vocab():\n            new_tokens.append(term)\n\n    # \u6dfb\u52a0\u65b0 token\n    num_added = tokenizer.add_tokens(new_tokens)\n    print(f\"\u6dfb\u52a0\u4e86 {num_added} \u4e2a\u65b0 token\")\n    print(f\"\u65b0\u8bcd\u8868\u5927\u5c0f: {len(tokenizer)}\")\n\n    # \u4fdd\u5b58\u6269\u5145\u540e\u7684\u5206\u8bcd\u5668\n    tokenizer.save_pretrained(output_dir)\n\n    return tokenizer\n\n# \u793a\u4f8b\uff1a\u4e3a\u533b\u7597\u9886\u57df\u6269\u5145\u8bcd\u8868\nmedical_terms = [\n    '\u51a0\u72b6\u52a8\u8109',\n    '\u5fc3\u808c\u6897\u6b7b',\n    '\u52a8\u8109\u7ca5\u6837\u786c\u5316',\n    'COVID-19',\n    'mRNA\u75ab\u82d7',\n    '\u8ba1\u7b97\u673a\u65ad\u5c42\u626b\u63cf',\n    # ... \u66f4\u591a\u672f\u8bed\n]\n\ntokenizer = extend_tokenizer(\n    'meta-llama/Llama-2-7b',\n    medical_terms,\n    './medical_tokenizer'\n)\n</code></pre> <p>\u8bcd\u8868\u6269\u5145\u540e\uff0c\u9700\u8981\u540c\u6b65\u6269\u5c55\u6a21\u578b\u7684\u5d4c\u5165\u77e9\u9635\u3002\u65b0\u589e token \u7684\u5d4c\u5165\u901a\u5e38\u521d\u59cb\u5316\u4e3a\u968f\u673a\u503c\u6216\u73b0\u6709\u76f8\u5173 token \u7684\u5e73\u5747\u503c\uff0c\u7136\u540e\u901a\u8fc7\u7ee7\u7eed\u9884\u8bad\u7ec3\u6765\u5b66\u4e60\u6709\u610f\u4e49\u7684\u8868\u793a\u3002</p> <pre><code>from transformers import AutoModelForCausalLM\n\ndef resize_model_embeddings(model_name: str, \n                            tokenizer,\n                            output_dir: str) -&gt; None:\n    \"\"\"\u8c03\u6574\u6a21\u578b\u5d4c\u5165\u5c42\u5927\u5c0f\u4ee5\u5339\u914d\u6269\u5145\u540e\u7684\u8bcd\u8868\"\"\"\n    model = AutoModelForCausalLM.from_pretrained(model_name)\n\n    # \u8c03\u6574\u5d4c\u5165\u5c42\u5927\u5c0f\n    model.resize_token_embeddings(len(tokenizer))\n\n    # \u53ef\u9009\uff1a\u4f7f\u7528\u76f8\u4f3c token \u7684\u5747\u503c\u521d\u59cb\u5316\u65b0\u5d4c\u5165\n    # \u8fd9\u6bd4\u968f\u673a\u521d\u59cb\u5316\u901a\u5e38\u80fd\u5e26\u6765\u66f4\u597d\u7684\u6548\u679c\n\n    model.save_pretrained(output_dir)\n</code></pre>"},{"location":"part2/2_3_tokenization_serialization/#524-llama","title":"5.2.4 \u7ed9 LLaMA \u6269\u5145\u4e2d\u6587\u8bcd\u8868\uff1a\u5b9e\u6218\u5de5\u7a0b","text":"<p>\u5728\u5b9e\u9645\u5de5\u4f5c\u4e2d\uff0c\u7ed9 LLaMA \u7c7b\u6a21\u578b\u6269\u5145\u4e2d\u6587\u8bcd\u8868\u662f\u4e00\u4e2a\u975e\u5e38\u9ad8\u9891\u7684\u5de5\u7a0b\u4efb\u52a1\u3002\u7531\u4e8e LLaMA \u7684\u539f\u59cb\u8bcd\u8868\u4e3b\u8981\u57fa\u4e8e\u82f1\u6587\u8bed\u6599\u8bad\u7ec3\uff0c\u4e2d\u6587\u5b57\u7b26\u5728 Byte-level BPE \u4e0b\u88ab\u4e25\u91cd\u5207\u5206\uff08\u4e00\u4e2a\u6c49\u5b57\u53ef\u80fd\u88ab\u5206\u89e3\u4e3a 2-3 \u4e2a token\uff09\uff0c\u5bfc\u81f4\uff1a</p> <ol> <li>\u5e8f\u5217\u957f\u5ea6\u81a8\u80c0\uff1a\u540c\u6837\u5185\u5bb9\u7684\u4e2d\u6587\u6587\u672c\u6bd4\u82f1\u6587\u5360\u7528\u66f4\u591a token\uff0c\u6d6a\u8d39\u5b9d\u8d35\u7684\u4e0a\u4e0b\u6587\u7a97\u53e3\u3002</li> <li>\u8ba1\u7b97\u6210\u672c\u589e\u52a0\uff1aTransformer \u7684\u8ba1\u7b97\u590d\u6742\u5ea6\u4e0e\u5e8f\u5217\u957f\u5ea6\u7684\u5e73\u65b9\u6210\u6b63\u6bd4\uff0c\u5e8f\u5217\u957f\u5ea6\u589e\u52a0 2 \u500d\u610f\u5473\u7740\u8ba1\u7b97\u91cf\u589e\u52a0 4 \u500d\u3002</li> <li>\u8bed\u4e49\u7406\u89e3\u56f0\u96be\uff1a\u5b57\u8282\u7ea7\u5207\u5206\u7834\u574f\u4e86\u6c49\u5b57\u7684\u5b8c\u6574\u6027\uff0c\u589e\u52a0\u4e86\u6a21\u578b\u7406\u89e3\u4e2d\u6587\u8bed\u4e49\u7684\u96be\u5ea6\u3002</li> </ol> <p>\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5b8c\u6574\u7684 LLaMA \u4e2d\u6587\u8bcd\u8868\u6269\u5145\u6d41\u7a0b\uff1a</p> <pre><code>import sentencepiece as spm\nfrom transformers import AutoTokenizer, AutoModelForCausalLM\nimport os\n\ndef extend_llama_chinese_vocab(\n    base_model_name: str = 'meta-llama/Llama-2-7b',\n    chinese_corpus_path: str = 'chinese_corpus.txt',\n    target_chinese_vocab_size: int = 20000,\n    output_dir: str = './llama_zh_tokenizer'\n):\n    \"\"\"\n    \u7ed9 LLaMA \u6269\u5145\u4e2d\u6587\u8bcd\u8868\u7684\u5b8c\u6574\u6d41\u7a0b\n\n    \u6b65\u9aa4\uff1a\n    1. \u5728\u4e2d\u6587\u8bed\u6599\u4e0a\u8bad\u7ec3 SentencePiece \u5206\u8bcd\u5668\n    2. \u5408\u5e76\u539f\u59cb LLaMA \u8bcd\u8868\u548c\u4e2d\u6587\u8bcd\u8868\n    3. \u6269\u5c55\u6a21\u578b\u5d4c\u5165\u77e9\u9635\n    \"\"\"\n    # Step 1: \u5728\u4e2d\u6587\u8bed\u6599\u4e0a\u8bad\u7ec3\u5206\u8bcd\u5668\n    spm.SentencePieceTrainer.train(\n        input=chinese_corpus_path,\n        model_prefix='chinese_sp',\n        vocab_size=target_chinese_vocab_size,\n        model_type='bpe',\n        character_coverage=0.9999,\n        num_threads=16,\n        byte_fallback=True,  # \u5173\u952e\uff1a\u786e\u4fdd\u4e0e LLaMA \u7684\u5b57\u8282\u56de\u9000\u517c\u5bb9\n    )\n\n    # Step 2: \u52a0\u8f7d\u4e24\u4e2a\u8bcd\u8868\n    llama_tokenizer = AutoTokenizer.from_pretrained(base_model_name)\n    chinese_sp = spm.SentencePieceProcessor(model_file='chinese_sp.model')\n\n    # \u83b7\u53d6\u4e2d\u6587\u8bcd\u8868\u4e2d\u7684\u65b0 token\n    llama_vocab = set(llama_tokenizer.get_vocab().keys())\n    chinese_tokens = [\n        chinese_sp.id_to_piece(i) \n        for i in range(chinese_sp.get_piece_size())\n    ]\n\n    # \u8fc7\u6ee4\u5df2\u5b58\u5728\u7684 token \u548c\u7279\u6b8a token\n    new_tokens = [\n        token for token in chinese_tokens \n        if token not in llama_vocab \n        and not token.startswith('&lt;') \n        and len(token.strip()) &gt; 0\n    ]\n\n    print(f\"LLaMA \u539f\u59cb\u8bcd\u8868\u5927\u5c0f: {len(llama_tokenizer)}\")\n    print(f\"\u4e2d\u6587\u65b0\u589e token: {len(new_tokens)}\")\n\n    # Step 3: \u6dfb\u52a0\u65b0 token\n    num_added = llama_tokenizer.add_tokens(new_tokens)\n    print(f\"\u5b9e\u9645\u6dfb\u52a0: {num_added} \u4e2a token\")\n    print(f\"\u65b0\u8bcd\u8868\u5927\u5c0f: {len(llama_tokenizer)}\")\n\n    # Step 4: \u4fdd\u5b58\u6269\u5145\u540e\u7684\u5206\u8bcd\u5668\n    llama_tokenizer.save_pretrained(output_dir)\n\n    # Step 5: \u6269\u5c55\u6a21\u578b\u5d4c\u5165\u77e9\u9635\n    model = AutoModelForCausalLM.from_pretrained(base_model_name)\n    model.resize_token_embeddings(len(llama_tokenizer))\n\n    # \u65b0 token \u7684\u5d4c\u5165\u521d\u59cb\u5316\u4e3a\u73b0\u6709 token \u7684\u5747\u503c\n    # \u8fd9\u6bd4\u968f\u673a\u521d\u59cb\u5316\u6548\u679c\u66f4\u597d\n    with torch.no_grad():\n        embedding_layer = model.get_input_embeddings()\n        old_embeddings = embedding_layer.weight[:len(llama_vocab)]\n        mean_embedding = old_embeddings.mean(dim=0)\n\n        for i in range(len(llama_vocab), len(llama_tokenizer)):\n            embedding_layer.weight[i] = mean_embedding\n\n    model.save_pretrained(output_dir)\n\n    return llama_tokenizer, model\n\n# \u6548\u679c\u9a8c\u8bc1\ndef compare_tokenization(text: str, original_tokenizer, extended_tokenizer):\n    \"\"\"\u5bf9\u6bd4\u6269\u5145\u524d\u540e\u7684\u5206\u8bcd\u6548\u679c\"\"\"\n    orig_tokens = original_tokenizer.tokenize(text)\n    ext_tokens = extended_tokenizer.tokenize(text)\n\n    print(f\"\u539f\u6587: {text}\")\n    print(f\"\u539f\u59cb LLaMA: {len(orig_tokens)} tokens -&gt; {orig_tokens[:20]}\")\n    print(f\"\u6269\u5145\u540e: {len(ext_tokens)} tokens -&gt; {ext_tokens[:20]}\")\n    print(f\"\u538b\u7f29\u6bd4: {len(orig_tokens)/len(ext_tokens):.2f}x\")\n</code></pre> <p>\u901a\u8fc7\u4e2d\u6587\u8bcd\u8868\u6269\u5145\uff0c\u5178\u578b\u7684\u538b\u7f29\u6548\u679c\u662f\uff1a\u4e2d\u6587\u6587\u672c\u7684 token \u6570\u51cf\u5c11 50-70%\uff0c\u663e\u8457\u63d0\u5347\u8bad\u7ec3\u548c\u63a8\u7406\u6548\u7387\u3002\u5f53\u7136\uff0c\u8bcd\u8868\u6269\u5145\u540e\u9700\u8981\u5bf9\u6a21\u578b\u8fdb\u884c\u7ee7\u7eed\u9884\u8bad\u7ec3\uff08Continue Pre-training\uff09\uff0c\u8ba9\u65b0\u589e token \u7684\u5d4c\u5165\u5b66\u4e60\u5230\u6709\u610f\u4e49\u7684\u8868\u793a\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#525","title":"5.2.5 \u8bcd\u8868\u8bbe\u8ba1\u7684\u6700\u4f73\u5b9e\u8df5","text":"<p>\u57fa\u4e8e\u4e1a\u754c\u7684\u7ecf\u9a8c\uff0c\u4ee5\u4e0b\u662f\u8bcd\u8868\u8bbe\u8ba1\u7684\u4e00\u4e9b\u6700\u4f73\u5b9e\u8df5\uff1a</p> <p>\u4fdd\u7559\u8db3\u591f\u7684\u7279\u6b8a token \u4f4d\u7f6e\uff1a\u9884\u7559\u4e00\u4e9b token ID \u7528\u4e8e\u672a\u6765\u53ef\u80fd\u6dfb\u52a0\u7684\u7279\u6b8a token\uff08\u5982\u65b0\u7684\u63a7\u5236\u7b26\u3001\u9886\u57df\u6807\u8bb0\u7b49\uff09\u3002\u8bb8\u591a\u5206\u8bcd\u5668\u9884\u7559\u4e86 100-1000 \u4e2a\u4f4d\u7f6e\u3002</p> <p>\u786e\u4fdd\u6570\u5b57\u548c\u4ee3\u7801\u7b26\u53f7\u7684\u5408\u7406\u5207\u5206\uff1a\u6570\u5b57\u5728\u5f88\u591a\u4efb\u52a1\u4e2d\u5f88\u91cd\u8981\uff0c\u4f46\u6807\u51c6\u5206\u8bcd\u5668\u5f80\u5f80\u5bf9\u6570\u5b57\u5904\u7406\u4e0d\u4f73\u3002\u8003\u8651\u5c06\u5355\u4e2a\u6570\u5b57\u4f5c\u4e3a\u72ec\u7acb token\uff0c\u6216\u4f7f\u7528\u7279\u6b8a\u7684\u6570\u5b57\u7f16\u7801\u7b56\u7565\u3002</p> <p>\u6d4b\u8bd5\u8fb9\u754c\u60c5\u51b5\uff1a\u5728\u786e\u5b9a\u8bcd\u8868\u4e4b\u524d\uff0c\u6d4b\u8bd5\u5404\u79cd\u8fb9\u754c\u60c5\u51b5\uff1a\u8d85\u957f\u5355\u8bcd\u3001\u7279\u6b8a\u5b57\u7b26\u3001\u6df7\u5408\u8bed\u8a00\u6587\u672c\u3001\u4ee3\u7801\u7247\u6bb5\u7b49\u3002\u786e\u4fdd\u5206\u8bcd\u7ed3\u679c\u7b26\u5408\u9884\u671f\u3002</p> <p>\u6587\u6863\u5316\u8bcd\u8868\u51b3\u7b56\uff1a\u8bb0\u5f55\u8bcd\u8868\u5927\u5c0f\u3001\u8bad\u7ec3\u8bed\u6599\u3001\u7279\u6b8a token \u5217\u8868\u7b49\u4fe1\u606f\uff0c\u4fbf\u4e8e\u540e\u7eed\u7684\u6a21\u578b\u8fed\u4ee3\u548c\u95ee\u9898\u6392\u67e5\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#53","title":"5.3 \u6570\u636e\u6df7\u5408\u4e0e\u8bfe\u7a0b\u5b66\u4e60","text":"<p>\u786e\u5b9a\u4e86\u5206\u8bcd\u5668\u4e4b\u540e\uff0c\u4e0b\u4e00\u4e2a\u5173\u952e\u95ee\u9898\u662f\uff1a\u5982\u4f55\u7ec4\u7ec7\u548c\u5448\u73b0\u8bad\u7ec3\u6570\u636e\uff1f\u4e0d\u540c\u6765\u6e90\u3001\u4e0d\u540c\u8d28\u91cf\u7684\u6570\u636e\u5e94\u8be5\u4ee5\u600e\u6837\u7684\u6bd4\u4f8b\u6df7\u5408\uff1f\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u6570\u636e\u7684\u987a\u5e8f\u662f\u5426\u91cd\u8981\uff1f</p>"},{"location":"part2/2_3_tokenization_serialization/#531","title":"5.3.1 \u6570\u636e\u6df7\u5408\u7b56\u7565","text":"<p>\u6b63\u5982\u6211\u4eec\u5728\u7b2c 3 \u7ae0\u8ba8\u8bba\u7684\uff0c\u9ad8\u8d28\u91cf\u7684\u9884\u8bad\u7ec3\u6570\u636e\u96c6\u901a\u5e38\u6df7\u5408\u4e86\u591a\u79cd\u6765\u6e90\uff1a\u7f51\u9875\u3001\u4e66\u7c4d\u3001\u4ee3\u7801\u3001\u8bba\u6587\u3001\u5bf9\u8bdd\u7b49\u3002\u6bcf\u79cd\u6765\u6e90\u7684\u6570\u636e\u91cf\u548c\u8d28\u91cf\u90fd\u4e0d\u540c\uff0c\u7b80\u5355\u5730\u6309\u539f\u59cb\u6bd4\u4f8b\u6df7\u5408\u5f80\u5f80\u4e0d\u662f\u6700\u4f18\u7684\u3002</p> <p>\u9759\u6001\u6df7\u5408\u662f\u6700\u7b80\u5355\u7684\u7b56\u7565\uff1a\u5728\u8bad\u7ec3\u5f00\u59cb\u524d\u786e\u5b9a\u5404\u6765\u6e90\u7684\u6df7\u5408\u6bd4\u4f8b\uff0c\u5c06\u6570\u636e\u6253\u4e71\u540e\u987a\u5e8f\u8bad\u7ec3\u3002\u8fd9\u79cd\u65b9\u6cd5\u7b80\u5355\u6613\u5b9e\u73b0\uff0c\u4f46\u7f3a\u4e4f\u7075\u6d3b\u6027\u3002</p> <pre><code># \u9759\u6001\u6570\u636e\u6df7\u5408\u793a\u4f8b\nimport random\n\ndef static_mix(data_sources: dict, target_size: int) -&gt; list:\n    \"\"\"\n    \u9759\u6001\u6df7\u5408\u591a\u4e2a\u6570\u636e\u6e90\n\n    Args:\n        data_sources: {source_name: (data_list, weight)}\n        target_size: \u76ee\u6807\u6570\u636e\u96c6\u5927\u5c0f\n\n    Returns:\n        \u6df7\u5408\u540e\u7684\u6570\u636e\u5217\u8868\n    \"\"\"\n    mixed_data = []\n\n    # \u8ba1\u7b97\u6bcf\u4e2a\u6765\u6e90\u7684\u91c7\u6837\u6570\u91cf\n    total_weight = sum(w for _, w in data_sources.values())\n\n    for source_name, (data, weight) in data_sources.items():\n        num_samples = int(target_size * weight / total_weight)\n\n        # \u5982\u679c\u6570\u636e\u4e0d\u8db3\uff0c\u91cd\u590d\u91c7\u6837\n        if len(data) &lt; num_samples:\n            sampled = random.choices(data, k=num_samples)\n        else:\n            sampled = random.sample(data, num_samples)\n\n        mixed_data.extend(sampled)\n\n    random.shuffle(mixed_data)\n    return mixed_data\n\n# \u4f7f\u7528\u793a\u4f8b\ndata_sources = {\n    'web': (web_data, 0.6),\n    'books': (book_data, 0.15),\n    'code': (code_data, 0.1),\n    'papers': (paper_data, 0.1),\n    'wikipedia': (wiki_data, 0.05)\n}\n\nmixed = static_mix(data_sources, target_size=1000000)\n</code></pre> <p></p> <p>\u56fe5-3\uff1a\u9759\u6001\u6df7\u5408\u4e0e\u52a8\u6001\u6df7\u5408\u7b56\u7565\u5bf9\u6bd4</p> <p>\u52a8\u6001\u6df7\u5408\u5141\u8bb8\u5728\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u8c03\u6574\u6df7\u5408\u6bd4\u4f8b\u3002\u4e00\u4e9b\u7814\u7a76\u8868\u660e\uff0c\u4e0d\u540c\u8bad\u7ec3\u9636\u6bb5\u7684\u6700\u4f18\u6570\u636e\u914d\u6bd4\u53ef\u80fd\u4e0d\u540c\u3002\u4f8b\u5982\uff0c\u8bad\u7ec3\u65e9\u671f\u4f7f\u7528\u66f4\u591a\u6837\u5316\u7684\u6570\u636e\u5e2e\u52a9\u6a21\u578b\u5efa\u7acb\u5e7f\u6cdb\u7684\u8bed\u8a00\u7406\u89e3\uff1b\u8bad\u7ec3\u540e\u671f\u589e\u52a0\u9ad8\u8d28\u91cf\u6570\u636e\u7684\u6bd4\u4f8b\u4ee5\u63d0\u5347\u6a21\u578b\u7684\u7cbe\u7ec6\u80fd\u529b\u3002</p> <pre><code>class DynamicDataMixer:\n    \"\"\"\u52a8\u6001\u6570\u636e\u6df7\u5408\u5668\"\"\"\n\n    def __init__(self, data_sources: dict, schedule: list):\n        \"\"\"\n        \u521d\u59cb\u5316\u52a8\u6001\u6df7\u5408\u5668\n\n        Args:\n            data_sources: \u6570\u636e\u6e90\u5b57\u5178\n            schedule: [(step_threshold, weights_dict), ...]\n                     \u5728\u4e0d\u540c\u8bad\u7ec3\u6b65\u6570\u4f7f\u7528\u4e0d\u540c\u7684\u6df7\u5408\u6743\u91cd\n        \"\"\"\n        self.data_sources = data_sources\n        self.schedule = sorted(schedule, key=lambda x: x[0])\n        self.current_step = 0\n\n    def get_weights(self) -&gt; dict:\n        \"\"\"\u83b7\u53d6\u5f53\u524d\u6b65\u6570\u5bf9\u5e94\u7684\u6743\u91cd\"\"\"\n        for step_threshold, weights in reversed(self.schedule):\n            if self.current_step &gt;= step_threshold:\n                return weights\n        return self.schedule[0][1]\n\n    def sample_batch(self, batch_size: int) -&gt; list:\n        \"\"\"\u91c7\u6837\u4e00\u4e2a batch\"\"\"\n        weights = self.get_weights()\n        batch = []\n\n        for source_name, weight in weights.items():\n            num_samples = int(batch_size * weight)\n            data = self.data_sources[source_name]\n            batch.extend(random.choices(data, k=num_samples))\n\n        random.shuffle(batch)\n        self.current_step += 1\n        return batch[:batch_size]\n\n# \u4f7f\u7528\u793a\u4f8b\uff1a\u8bad\u7ec3\u65e9\u671f\u5f3a\u8c03\u591a\u6837\u6027\uff0c\u540e\u671f\u5f3a\u8c03\u8d28\u91cf\nschedule = [\n    (0, {'web': 0.5, 'books': 0.2, 'code': 0.15, 'papers': 0.1, 'wiki': 0.05}),\n    (100000, {'web': 0.4, 'books': 0.25, 'code': 0.15, 'papers': 0.15, 'wiki': 0.05}),\n    (500000, {'web': 0.3, 'books': 0.3, 'code': 0.2, 'papers': 0.15, 'wiki': 0.05}),\n]\n\nmixer = DynamicDataMixer(data_sources, schedule)\n</code></pre>"},{"location":"part2/2_3_tokenization_serialization/#532","title":"5.3.2 \u8bfe\u7a0b\u5b66\u4e60","text":"<p>\u8bfe\u7a0b\u5b66\u4e60\uff08Curriculum Learning\uff09\u662f\u4e00\u79cd\u53d7\u4eba\u7c7b\u5b66\u4e60\u8fc7\u7a0b\u542f\u53d1\u7684\u8bad\u7ec3\u7b56\u7565\u3002\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u5148\u8ba9\u6a21\u578b\u5b66\u4e60\"\u7b80\u5355\"\u7684\u6837\u672c\uff0c\u518d\u9010\u6e10\u8fc7\u6e21\u5230\"\u56f0\u96be\"\u7684\u6837\u672c\u3002\u8fd9\u79cd\u7b56\u7565\u5728\u591a\u9879\u7814\u7a76\u4e2d\u88ab\u8bc1\u660e\u53ef\u4ee5\u52a0\u901f\u6536\u655b\u5e76\u63d0\u5347\u6700\u7ec8\u6027\u80fd\u3002</p> <p>\u5728\u9884\u8bad\u7ec3\u573a\u666f\u4e0b\uff0c\"\u7b80\u5355\"\u548c\"\u56f0\u96be\"\u53ef\u4ee5\u6709\u591a\u79cd\u5b9a\u4e49\uff1a</p> <p>\u57fa\u4e8e\u957f\u5ea6\uff1a\u77ed\u6587\u672c\u901a\u5e38\u6bd4\u957f\u6587\u672c\u66f4\u5bb9\u6613\u5b66\u4e60\u3002\u8bfe\u7a0b\u53ef\u4ee5\u4ece\u77ed\u5e8f\u5217\u5f00\u59cb\uff0c\u9010\u6e10\u589e\u52a0\u5e8f\u5217\u957f\u5ea6\u3002</p> <p>\u57fa\u4e8e\u56f0\u60d1\u5ea6\uff1a\u56f0\u60d1\u5ea6\u4f4e\u7684\u6587\u672c\uff08\u8bed\u8a00\u6a21\u578b\u66f4\"\u719f\u6089\"\u7684\u6587\u672c\uff09\u53ef\u4ee5\u89c6\u4e3a\"\u7b80\u5355\"\u6837\u672c\u3002\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u9884\u8bad\u7ec3\u7684\u5c0f\u6a21\u578b\u8bc4\u4f30\u6837\u672c\u96be\u5ea6\uff0c\u7136\u540e\u6309\u96be\u5ea6\u6392\u5e8f\u5448\u73b0\u7ed9\u4e3b\u6a21\u578b\u3002</p> <p>\u57fa\u4e8e\u566a\u58f0\u6c34\u5e73\uff1a\u9ad8\u8d28\u91cf\u3001\u4f4e\u566a\u58f0\u7684\u6587\u672c\u5148\u5448\u73b0\uff0c\u7136\u540e\u9010\u6e10\u5f15\u5165\u8d28\u91cf\u8f83\u4f4e\u4f46\u53ef\u80fd\u5305\u542b\u72ec\u7279\u4fe1\u606f\u7684\u6587\u672c\u3002</p> <pre><code>import numpy as np\n\nclass CurriculumScheduler:\n    \"\"\"\u8bfe\u7a0b\u5b66\u4e60\u8c03\u5ea6\u5668\"\"\"\n\n    def __init__(self, \n                 data: list, \n                 difficulty_scores: list,\n                 total_steps: int,\n                 strategy: str = 'linear'):\n        \"\"\"\n        \u521d\u59cb\u5316\u8bfe\u7a0b\u8c03\u5ea6\u5668\n\n        Args:\n            data: \u6570\u636e\u5217\u8868\n            difficulty_scores: \u6bcf\u4e2a\u6837\u672c\u7684\u96be\u5ea6\u5206\u6570\uff08\u8d8a\u9ad8\u8d8a\u96be\uff09\n            total_steps: \u603b\u8bad\u7ec3\u6b65\u6570\n            strategy: \u8bfe\u7a0b\u7b56\u7565 ('linear', 'sqrt', 'exp')\n        \"\"\"\n        self.data = np.array(data)\n        self.difficulty_scores = np.array(difficulty_scores)\n        self.total_steps = total_steps\n        self.strategy = strategy\n\n        # \u6309\u96be\u5ea6\u6392\u5e8f\n        sorted_indices = np.argsort(self.difficulty_scores)\n        self.sorted_data = self.data[sorted_indices]\n        self.sorted_scores = self.difficulty_scores[sorted_indices]\n\n    def get_curriculum_fraction(self, current_step: int) -&gt; float:\n        \"\"\"\n        \u8ba1\u7b97\u5f53\u524d\u6b65\u6570\u5e94\u8be5\u4f7f\u7528\u7684\u6570\u636e\u6bd4\u4f8b\n\n        \u8fd4\u56de\u503c\u5728 [0, 1] \u4e4b\u95f4\uff0c\u8868\u793a\u4f7f\u7528\u6700\u7b80\u5355\u7684\u591a\u5c11\u6bd4\u4f8b\u7684\u6570\u636e\n        \"\"\"\n        progress = current_step / self.total_steps\n\n        if self.strategy == 'linear':\n            return progress\n        elif self.strategy == 'sqrt':\n            return np.sqrt(progress)\n        elif self.strategy == 'exp':\n            return 1 - np.exp(-3 * progress)\n        else:\n            return progress\n\n    def sample_batch(self, current_step: int, batch_size: int) -&gt; list:\n        \"\"\"\u6839\u636e\u5f53\u524d\u8fdb\u5ea6\u91c7\u6837 batch\"\"\"\n        fraction = self.get_curriculum_fraction(current_step)\n\n        # \u786e\u5b9a\u53ef\u7528\u6570\u636e\u8303\u56f4\n        available_size = max(int(len(self.sorted_data) * fraction), batch_size)\n        available_data = self.sorted_data[:available_size]\n\n        # \u4ece\u53ef\u7528\u8303\u56f4\u5185\u968f\u673a\u91c7\u6837\n        indices = np.random.choice(len(available_data), size=batch_size, replace=True)\n        return available_data[indices].tolist()\n</code></pre> <p></p> <p>\u56fe5-4\uff1a\u8bfe\u7a0b\u5b66\u4e60\u539f\u7406 \u2014\u2014 \u4ece\u7b80\u5355\u6837\u672c\u9010\u6e10\u8fc7\u6e21\u5230\u56f0\u96be\u6837\u672c</p>"},{"location":"part2/2_3_tokenization_serialization/#533","title":"5.3.3 \u6570\u636e\u91c7\u6837\u4e0e\u6279\u6b21\u6784\u5efa","text":"<p>\u5728\u5b9e\u9645\u8bad\u7ec3\u4e2d\uff0c\u6570\u636e\u7684\u7ec4\u7ec7\u65b9\u5f0f\u5bf9\u6548\u7387\u548c\u6548\u679c\u90fd\u6709\u5f71\u54cd\u3002\u4ee5\u4e0b\u662f\u4e00\u4e9b\u91cd\u8981\u7684\u5de5\u7a0b\u8003\u91cf\uff1a</p> <p>Pack \u6253\u5305\u7b56\u7565\uff1a\u4e3a\u4e86\u5145\u5206\u5229\u7528\u8ba1\u7b97\u8d44\u6e90\uff0c\u901a\u5e38\u5c06\u591a\u4e2a\u77ed\u5e8f\u5217\u6253\u5305\u5230\u4e00\u4e2a\u56fa\u5b9a\u957f\u5ea6\u7684\u5e8f\u5217\u4e2d\u3002\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11 padding \u5e26\u6765\u7684\u8ba1\u7b97\u6d6a\u8d39\u3002\u5173\u952e\u95ee\u9898\u662f\u5982\u4f55\u5904\u7406\u6253\u5305\u540e\u7684\u6ce8\u610f\u529b\u63a9\u7801\u2014\u2014\u4e0d\u540c\u6587\u6863\u4e4b\u95f4\u4e0d\u5e94\u8be5\u76f8\u4e92\u6ce8\u610f\u3002</p> <pre><code>def pack_sequences(sequences: list, max_length: int, eos_token_id: int) -&gt; list:\n    \"\"\"\n    \u5c06\u591a\u4e2a\u77ed\u5e8f\u5217\u6253\u5305\u5230\u56fa\u5b9a\u957f\u5ea6\n\n    Args:\n        sequences: token id \u5e8f\u5217\u5217\u8868\n        max_length: \u76ee\u6807\u5e8f\u5217\u957f\u5ea6\n        eos_token_id: \u5e8f\u5217\u7ed3\u675f\u7b26 ID\n\n    Returns:\n        \u6253\u5305\u540e\u7684\u5e8f\u5217\u5217\u8868\uff0c\u6bcf\u4e2a\u957f\u5ea6\u4e3a max_length\n    \"\"\"\n    packed = []\n    current_pack = []\n    current_length = 0\n\n    for seq in sequences:\n        seq_with_eos = seq + [eos_token_id]\n\n        if current_length + len(seq_with_eos) &lt;= max_length:\n            current_pack.extend(seq_with_eos)\n            current_length += len(seq_with_eos)\n        else:\n            # \u5f53\u524d pack \u5df2\u6ee1\uff0c\u5f00\u59cb\u65b0\u7684\n            if current_pack:\n                # padding \u5230 max_length\n                current_pack.extend([eos_token_id] * (max_length - current_length))\n                packed.append(current_pack)\n\n            current_pack = seq_with_eos\n            current_length = len(seq_with_eos)\n\n    # \u5904\u7406\u6700\u540e\u4e00\u4e2a pack\n    if current_pack:\n        current_pack.extend([eos_token_id] * (max_length - current_length))\n        packed.append(current_pack)\n\n    return packed\n</code></pre> <p>\u6587\u6863\u8fb9\u754c\u5904\u7406\uff1a\u5728\u6253\u5305\u5e8f\u5217\u65f6\uff0c\u9700\u8981\u521b\u5efa\u4e00\u4e2a\"\u6587\u6863\u8fb9\u754c\u63a9\u7801\"\uff0c\u786e\u4fdd\u6a21\u578b\u5728\u751f\u6210\u65f6\u4e0d\u4f1a\u8de8\u8d8a\u6587\u6863\u8fb9\u754c\u8fdb\u884c\u6ce8\u610f\u529b\u8ba1\u7b97\u3002</p> <p>\u6570\u636e\u52a0\u8f7d\u6548\u7387\uff1a\u5bf9\u4e8e TB \u7ea7\u6570\u636e\u96c6\uff0c\u6570\u636e\u52a0\u8f7d\u672c\u8eab\u53ef\u80fd\u6210\u4e3a\u74f6\u9888\u3002\u5e38\u7528\u7684\u4f18\u5316\u624b\u6bb5\u5305\u62ec\uff1a\u9884\u5904\u7406\u540e\u4ee5\u4e8c\u8fdb\u5236\u683c\u5f0f\u5b58\u50a8\uff08\u5982 numpy \u7684 memmap\uff09\u3001\u591a\u8fdb\u7a0b\u5e76\u884c\u52a0\u8f7d\u3001\u9884\u53d6\uff08prefetch\uff09\u4e0b\u4e00\u6279\u6570\u636e\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#534","title":"5.3.4 \u5e8f\u5217\u5316\u4e0e\u5b58\u50a8\u683c\u5f0f","text":"<p>\u5b8c\u6210\u5206\u8bcd\u540e\uff0c\u9700\u8981\u5c06 token \u5e8f\u5217\u4ee5\u9ad8\u6548\u7684\u683c\u5f0f\u5b58\u50a8\uff0c\u4ee5\u4fbf\u8bad\u7ec3\u65f6\u5feb\u901f\u8bfb\u53d6\u3002</p> <p>\u5e38\u89c1\u7684\u5b58\u50a8\u683c\u5f0f\u5305\u62ec\uff1a</p> <p>NumPy memmap\uff1a\u5c06 token ID \u5b58\u50a8\u4e3a numpy \u6570\u7ec4\uff0c\u4f7f\u7528\u5185\u5b58\u6620\u5c04\u8bbf\u95ee\u3002\u4f18\u70b9\u662f\u7b80\u5355\u76f4\u63a5\uff0c\u652f\u6301\u968f\u673a\u8bbf\u95ee\uff1b\u7f3a\u70b9\u662f\u4e0d\u652f\u6301\u538b\u7f29\uff0c\u5b58\u50a8\u7a7a\u95f4\u8f83\u5927\u3002</p> <pre><code>import numpy as np\n\ndef save_as_memmap(token_ids: list, output_path: str):\n    \"\"\"\u5c06 token ID \u5217\u8868\u4fdd\u5b58\u4e3a memmap \u683c\u5f0f\"\"\"\n    arr = np.array(token_ids, dtype=np.uint16)  # \u5047\u8bbe\u8bcd\u8868 &lt; 65536\n    fp = np.memmap(output_path, dtype='uint16', mode='w+', shape=arr.shape)\n    fp[:] = arr[:]\n    fp.flush()\n\ndef load_memmap(path: str, shape: tuple):\n    \"\"\"\u52a0\u8f7d memmap \u683c\u5f0f\u7684 token ID\"\"\"\n    return np.memmap(path, dtype='uint16', mode='r', shape=shape)\n</code></pre> <p>Arrow/Parquet\uff1a\u4f7f\u7528 Apache Arrow \u683c\u5f0f\u5b58\u50a8\uff0c\u652f\u6301\u538b\u7f29\u548c\u9ad8\u6548\u7684\u5217\u5f0f\u8bbf\u95ee\u3002HuggingFace Datasets \u5e93\u5185\u90e8\u4f7f\u7528\u8fd9\u79cd\u683c\u5f0f\u3002</p> <p>\u81ea\u5b9a\u4e49\u4e8c\u8fdb\u5236\u683c\u5f0f\uff1a\u4e00\u4e9b\u5927\u578b\u9879\u76ee\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684\u4e8c\u8fdb\u5236\u683c\u5f0f\uff0c\u9488\u5bf9\u7279\u5b9a\u7684\u8bbf\u95ee\u6a21\u5f0f\u4f18\u5316\u3002\u4f8b\u5982 GPT-NeoX \u4f7f\u7528\u7684\u4e8c\u8fdb\u5236\u6253\u5305\u683c\u5f0f\u3002</p> <pre><code># \u4f7f\u7528 HuggingFace Datasets \u5904\u7406\u5206\u8bcd\u540e\u7684\u6570\u636e\nfrom datasets import Dataset\n\ndef tokenize_and_save(raw_data: list, tokenizer, output_dir: str):\n    \"\"\"\u5206\u8bcd\u5e76\u4fdd\u5b58\u4e3a Datasets \u683c\u5f0f\"\"\"\n\n    def tokenize_function(examples):\n        return tokenizer(\n            examples['text'],\n            truncation=True,\n            max_length=2048,\n            return_attention_mask=False\n        )\n\n    # \u521b\u5efa Dataset\n    ds = Dataset.from_dict({'text': raw_data})\n\n    # \u5206\u8bcd\n    tokenized_ds = ds.map(\n        tokenize_function,\n        batched=True,\n        num_proc=16,\n        remove_columns=['text']\n    )\n\n    # \u4fdd\u5b58\n    tokenized_ds.save_to_disk(output_dir)\n</code></pre>"},{"location":"part2/2_3_tokenization_serialization/#54","title":"5.4 \u5b8c\u6574\u7684\u6570\u636e\u51c6\u5907\u6d41\u6c34\u7ebf","text":"<p>\u5c06\u524d\u9762\u8ba8\u8bba\u7684\u5404\u4e2a\u6b65\u9aa4\u4e32\u8054\u8d77\u6765\uff0c\u6784\u5efa\u4e00\u4e2a\u4ece\u539f\u59cb\u6587\u672c\u5230\u8bad\u7ec3\u5c31\u7eea\u6570\u636e\u7684\u5b8c\u6574\u6d41\u6c34\u7ebf\u3002</p> <pre><code>from dataclasses import dataclass\nfrom typing import Optional\nimport sentencepiece as spm\n\n@dataclass\nclass DataPrepConfig:\n    \"\"\"\u6570\u636e\u51c6\u5907\u914d\u7f6e\"\"\"\n    # \u5206\u8bcd\u5668\u914d\u7f6e\n    tokenizer_path: str\n    max_seq_length: int = 2048\n\n    # \u6570\u636e\u6df7\u5408\u914d\u7f6e\n    mix_weights: dict = None  # {source: weight}\n\n    # \u8bfe\u7a0b\u5b66\u4e60\u914d\u7f6e\n    use_curriculum: bool = False\n    curriculum_strategy: str = 'linear'\n\n    # \u8f93\u51fa\u914d\u7f6e\n    pack_sequences: bool = True\n    output_format: str = 'arrow'  # 'arrow', 'memmap', 'jsonl'\n\nclass DataPreparationPipeline:\n    \"\"\"\u6570\u636e\u51c6\u5907\u6d41\u6c34\u7ebf\"\"\"\n\n    def __init__(self, config: DataPrepConfig):\n        self.config = config\n        self.tokenizer = spm.SentencePieceProcessor(model_file=config.tokenizer_path)\n\n    def tokenize_document(self, text: str) -&gt; list:\n        \"\"\"\u5206\u8bcd\u5355\u4e2a\u6587\u6863\"\"\"\n        return self.tokenizer.encode(text)\n\n    def process_source(self, source_path: str, source_name: str) -&gt; list:\n        \"\"\"\u5904\u7406\u5355\u4e2a\u6570\u636e\u6e90\"\"\"\n        documents = self.load_documents(source_path)\n\n        tokenized = []\n        for doc in documents:\n            tokens = self.tokenize_document(doc['text'])\n            if len(tokens) &gt; 10:  # \u8fc7\u6ee4\u8fc7\u77ed\u7684\u6587\u6863\n                tokenized.append({\n                    'input_ids': tokens,\n                    'source': source_name,\n                    'length': len(tokens)\n                })\n\n        return tokenized\n\n    def mix_sources(self, sources: dict) -&gt; list:\n        \"\"\"\u6df7\u5408\u591a\u4e2a\u6570\u636e\u6e90\"\"\"\n        mixed = []\n        weights = self.config.mix_weights or {s: 1.0 for s in sources}\n        total_weight = sum(weights.values())\n\n        # \u786e\u5b9a\u6bcf\u4e2a\u6765\u6e90\u7684\u91c7\u6837\u6570\n        total_samples = sum(len(data) for data in sources.values())\n\n        for source_name, data in sources.items():\n            weight = weights.get(source_name, 1.0) / total_weight\n            num_samples = int(total_samples * weight)\n\n            if len(data) &gt;= num_samples:\n                sampled = random.sample(data, num_samples)\n            else:\n                sampled = random.choices(data, k=num_samples)\n\n            mixed.extend(sampled)\n\n        random.shuffle(mixed)\n        return mixed\n\n    def pack_and_save(self, data: list, output_path: str):\n        \"\"\"\u6253\u5305\u5e76\u4fdd\u5b58\u6570\u636e\"\"\"\n        if self.config.pack_sequences:\n            sequences = [d['input_ids'] for d in data]\n            packed = pack_sequences(\n                sequences, \n                self.config.max_seq_length,\n                self.tokenizer.eos_id()\n            )\n        else:\n            packed = [d['input_ids'] for d in data]\n\n        # \u6839\u636e\u914d\u7f6e\u9009\u62e9\u8f93\u51fa\u683c\u5f0f\n        if self.config.output_format == 'arrow':\n            self.save_as_arrow(packed, output_path)\n        elif self.config.output_format == 'memmap':\n            self.save_as_memmap(packed, output_path)\n        else:\n            self.save_as_jsonl(packed, output_path)\n\n    def run(self, source_paths: dict, output_path: str):\n        \"\"\"\u8fd0\u884c\u5b8c\u6574\u6d41\u6c34\u7ebf\"\"\"\n        # 1. \u5904\u7406\u5404\u6570\u636e\u6e90\n        sources = {}\n        for source_name, path in source_paths.items():\n            print(f\"Processing {source_name}...\")\n            sources[source_name] = self.process_source(path, source_name)\n\n        # 2. \u6df7\u5408\u6570\u636e\n        print(\"Mixing data sources...\")\n        mixed = self.mix_sources(sources)\n\n        # 3. \u53ef\u9009\uff1a\u5e94\u7528\u8bfe\u7a0b\u5b66\u4e60\u6392\u5e8f\n        if self.config.use_curriculum:\n            print(\"Applying curriculum ordering...\")\n            mixed = self.apply_curriculum(mixed)\n\n        # 4. \u6253\u5305\u5e76\u4fdd\u5b58\n        print(\"Packing and saving...\")\n        self.pack_and_save(mixed, output_path)\n\n        print(f\"Done! Saved {len(mixed)} samples to {output_path}\")\n</code></pre> <p></p> <p>\u56fe5-5\uff1a\u4ece\u539f\u59cb\u6587\u672c\u5230\u8bad\u7ec3\u5c31\u7eea\u6570\u636e\u7684\u5b8c\u6574\u6d41\u6c34\u7ebf</p>"},{"location":"part2/2_3_tokenization_serialization/#55","title":"5.5 \u672c\u7ae0\u5c0f\u7ed3","text":"<p>\u672c\u7ae0\u7cfb\u7edf\u4ecb\u7ecd\u4e86\u5206\u8bcd\u4e0e\u6570\u636e\u5e8f\u5217\u5316\u7684\u6838\u5fc3\u6280\u672f\u3002</p> <p>\u5728\u5206\u8bcd\u5668\u539f\u7406\u65b9\u9762\uff0c\u5b50\u8bcd\u5206\u8bcd\u662f\u5f53\u524d\u5927\u6a21\u578b\u7684\u4e3b\u6d41\u9009\u62e9\uff0c\u5728\u8bcd\u8868\u5927\u5c0f\u548c\u5e8f\u5217\u957f\u5ea6\u4e4b\u95f4\u53d6\u5f97\u4e86\u826f\u597d\u5e73\u8861\u3002BPE \u91c7\u7528\u9891\u7387\u9a71\u52a8\u7684\u81ea\u5e95\u5411\u4e0a\u5408\u5e76\u7b56\u7565\uff0c\u7b80\u5355\u9ad8\u6548\uff1bWordPiece \u4f7f\u7528\u4f3c\u7136\u9a71\u52a8\u7684\u5408\u5e76\u6807\u51c6\uff0c\u5bf9\u4f4e\u9891\u6709\u610f\u4e49\u6a21\u5f0f\u66f4\u654f\u611f\uff1bUnigram \u91c7\u7528\u81ea\u9876\u5411\u4e0b\u7684\u6982\u7387\u5efa\u6a21\u65b9\u6cd5\uff0c\u7406\u8bba\u4e0a\u66f4\u4f18\u96c5\u3002SentencePiece \u662f\u6700\u5e38\u7528\u7684\u5de5\u5177\u5305\uff0c\u652f\u6301\u591a\u79cd\u7b97\u6cd5\u548c\u8bed\u8a00\u65e0\u5173\u7684\u5904\u7406\u3002</p> <p>\u5728\u8bcd\u8868\u8bbe\u8ba1\u65b9\u9762\uff0c\u8bcd\u8868\u5927\u5c0f\u9700\u8981\u5728\u8ba1\u7b97\u6548\u7387\u3001\u5e8f\u5217\u957f\u5ea6\u548c\u7a00\u6709\u8bcd\u5904\u7406\u4e4b\u95f4\u6743\u8861\uff0c\u4e3b\u6d41\u6a21\u578b\u901a\u5e38\u4f7f\u7528 32K-128K \u7684\u8bcd\u8868\u3002\u591a\u8bed\u8a00\u8bcd\u8868\u8bbe\u8ba1\u9700\u8981\u5e73\u8861\u4e0d\u540c\u8bed\u8a00\u7684\u8986\u76d6\uff0c\u907f\u514d\"\u8bcd\u8868\u8bc5\u5492\"\u3002\u9886\u57df\u7279\u5b9a\u8bcd\u8868\u6269\u5145\u53ef\u4ee5\u6539\u5584\u4e13\u4e1a\u672f\u8bed\u7684\u5904\u7406\uff0c\u4f46\u9700\u8981\u914d\u5408\u6a21\u578b\u5d4c\u5165\u5c42\u7684\u6269\u5c55\u3002</p> <p>\u5728\u6570\u636e\u6df7\u5408\u65b9\u9762\uff0c\u9759\u6001\u6df7\u5408\u7b80\u5355\u76f4\u63a5\uff0c\u52a8\u6001\u6df7\u5408\u5141\u8bb8\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\u8c03\u6574\u914d\u6bd4\u3002\u8bfe\u7a0b\u5b66\u4e60\u7b56\u7565\u4ece\u7b80\u5355\u6837\u672c\u5f00\u59cb\u3001\u9010\u6e10\u8fc7\u6e21\u5230\u56f0\u96be\u6837\u672c\uff0c\u53ef\u4ee5\u52a0\u901f\u6536\u655b\u5e76\u63d0\u5347\u6027\u80fd\u3002\u6570\u636e\u6253\u5305\u548c\u9ad8\u6548\u7684\u5b58\u50a8\u683c\u5f0f\u5bf9\u4e8e\u5927\u89c4\u6a21\u8bad\u7ec3\u81f3\u5173\u91cd\u8981\u3002</p> <p></p> <p>\u56fe5-6\uff1a\u7b2c5\u7ae0\u77e5\u8bc6\u7ed3\u6784 \u2014\u2014 \u5206\u8bcd\u7b97\u6cd5\u3001\u8bcd\u8868\u8bbe\u8ba1\u3001\u6570\u636e\u7ec4\u7ec7\u4e09\u5927\u4e3b\u9898</p>"},{"location":"part2/2_3_tokenization_serialization/#_5","title":"\u5ef6\u4f38\u9605\u8bfb","text":"<p>\u5173\u4e8e\u5206\u8bcd\u4e0e\u6570\u636e\u5e8f\u5217\u5316\u7684\u6df1\u5165\u5185\u5bb9\uff0c\u4ee5\u4e0b\u8d44\u6e90\u503c\u5f97\u53c2\u8003\uff1a</p> <p>SentencePiece \u8bba\u6587\uff08Kudo and Richardson, 2018\uff09\u4ecb\u7ecd\u4e86\u8bed\u8a00\u65e0\u5173\u7684\u5b50\u8bcd\u5206\u8bcd\u65b9\u6cd5\u3002BPE \u8bba\u6587\uff08Sennrich et al., 2015\uff09\u662f\u5c06 BPE \u5f15\u5165 NLP \u7684\u5f00\u521b\u6027\u5de5\u4f5c\u3002Unigram \u8bba\u6587\uff08Kudo, 2018\uff09\u63d0\u4f9b\u4e86\u5b50\u8bcd\u5206\u8bcd\u7684\u6982\u7387\u89c6\u89d2\u3002HuggingFace Tokenizers \u5e93\u6587\u6863\uff08huggingface.co/docs/tokenizers\uff09\u662f\u5b9e\u8df5\u5c42\u9762\u7684\u6743\u5a01\u53c2\u8003\u3002\u5173\u4e8e\u8bfe\u7a0b\u5b66\u4e60\uff0cBengio \u7b49\u4eba\u7684\u7efc\u8ff0\u8bba\u6587\u63d0\u4f9b\u4e86\u5168\u9762\u7684\u7406\u8bba\u6846\u67b6\u3002</p>"},{"location":"part2/2_3_tokenization_serialization/#_6","title":"\u4e0b\u4e00\u7ae0\u9884\u544a","text":"<p>\u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86\u6587\u672c\u9884\u8bad\u7ec3\u6570\u636e\u5de5\u7a0b\u7684\u5168\u90e8\u5185\u5bb9\u3002\u5728\u4e0b\u4e00\u7ae0\u300a\u56fe\u6587\u5bf9\u6570\u636e\u5904\u7406\u300b\u4e2d\uff0c\u6211\u4eec\u5c06\u8fdb\u5165\u591a\u6a21\u6001\u6570\u636e\u5de5\u7a0b\u7684\u9886\u57df\u3002\u4f60\u5c06\u5b66\u4e60\u5982\u4f55\u5904\u7406 LAION-5B \u98ce\u683c\u7684\u56fe\u6587\u914d\u5bf9\u6570\u636e\uff0c\u5982\u4f55\u4f7f\u7528 img2dataset \u8fdb\u884c\u9ad8\u5e76\u53d1\u56fe\u50cf\u4e0b\u8f7d\uff0c\u4ee5\u53ca\u5982\u4f55\u6784\u5efa\u591a\u6a21\u6001\u6570\u636e\u6e05\u6d17\u6d41\u6c34\u7ebf\u3002</p> <p>\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\u8fdb\u5165\u4e0b\u4e00\u7ae0\uff1a\u4e00\u5f20\u56fe\u7247\u7684\"\u8d28\u91cf\"\u5e94\u8be5\u5982\u4f55\u5b9a\u4e49\uff1f\u9664\u4e86\u5206\u8fa8\u7387\u548c\u6e05\u6670\u5ea6\uff0c\u8fd8\u6709\u54ea\u4e9b\u7ef4\u5ea6\u9700\u8981\u8003\u8651\uff1f</p>"},{"location":"part3/3_1_image_text_pairs/","title":"\u7b2c6\u7ae0\uff1a\u56fe\u6587\u5bf9\u6570\u636e\u5904\u7406","text":""},{"location":"part3/3_1_image_text_pairs/#6-image-text-pairs","title":"\u7b2c6\u7ae0\uff1a\u56fe\u6587\u5bf9\u6570\u636e\u5904\u7406 (Image-Text Pairs)","text":""},{"location":"part3/3_1_image_text_pairs/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u5728\u6784\u5efa\u4e0b\u4e00\u4ee3\u57fa\u7840\u6a21\u578b\uff08Foundation Models\uff09\u7684\u5f81\u9014\u4e2d\uff0c\u6570\u636e\u5de5\u7a0b\u7684\u91cd\u5fc3\u5df2\u4ece\u5355\u7eaf\u7684\u6587\u672c\u6e05\u6d17\u8f6c\u5411\u4e86\u5bf9\u7269\u7406\u4e16\u754c\u591a\u7ef4\u4fe1\u53f7\u7684\u6355\u83b7\u3001\u5bf9\u9f50\u4e0e\u91cd\u6784\u3002\u5982\u679c\u8bf4\u8bed\u8a00\u6a21\u578b\u7684\u6570\u636e\u5de5\u7a0b\u662f\u5173\u4e8e\u201c\u53bb\u566a\u201d\uff0c\u90a3\u4e48\u591a\u6a21\u6001\u6570\u636e\u5de5\u7a0b\u5219\u662f\u5173\u4e8e\u201c\u5173\u8054\u201d\u4e0e\u201c\u5bf9\u9f50\u201d\u3002\u968f\u7740 GPT-4V\u3001Gemini \u548c Sora \u7684\u6a2a\u7a7a\u51fa\u4e16\uff0c\u6211\u4eec\u610f\u8bc6\u5230\u5355\u4e00\u6a21\u6001\u7684\u6570\u636e\u5df2\u65e0\u6cd5\u6ee1\u8db3\u6a21\u578b\u5bf9\u4e16\u754c\u8ba4\u77e5\u7684\u6e34\u671b\u3002</p> <p>\u672c\u7ae0\u5c06\u6df1\u5165\u5256\u6790\u6784\u5efa\u4ebf\u7ea7\u591a\u6a21\u6001\u6570\u636e\u96c6\u7684\u5b8c\u6574\u5de5\u7a0b\u94fe\u8def\u3002\u8fd9\u4e0d\u4ec5\u4ec5\u662f\u5199\u51e0\u4e2a\u811a\u672c\u4e0b\u8f7d\u56fe\u7247\u90a3\u4e48\u7b80\u5355\uff0c\u5b83\u662f\u4e00\u573a\u6d89\u53ca\u7f51\u7edc\u534f\u8bae\u3001\u5206\u5e03\u5f0f\u5b58\u50a8\u3001\u5f02\u6784\u8ba1\u7b97\u548c\u7f8e\u5b66\u8bc4\u4f30\u7684\u7efc\u5408\u6218\u5f79\u3002\u6211\u4eec\u5c06\u63a2\u8ba8\u6570\u636e\u8303\u5f0f\u7684\u5e95\u5c42\u903b\u8f91\uff0c\u89e3\u6790\u5982\u4f55\u5229\u7528\u5206\u5e03\u5f0f\u8ba1\u7b97\u6846\u67b6\u89e3\u51b3\u6d77\u91cf\u56fe\u7247\u7684\u9ad8\u5e76\u53d1\u83b7\u53d6\u96be\u9898\uff0c\u5e76\u5229\u7528 GPU \u786c\u4ef6\u52a0\u901f\u6280\u672f\u7a81\u7834\u56fe\u50cf\u9884\u5904\u7406\u7684 I/O \u74f6\u9888\u3002\u6b64\u5916\uff0c\u6211\u4eec\u5c06\u6784\u5efa\u4e00\u5957\u57fa\u4e8e\u8bed\u4e49\u548c\u7f8e\u5b66\u7684\u81ea\u52a8\u5316\u6e05\u6d17\u95ed\u73af\uff0c\u786e\u4fdd\u8f93\u5165\u6a21\u578b\u7684\u6570\u636e\u517c\u5177\u76f8\u5173\u6027\u4e0e\u5b89\u5168\u6027\u3002</p> <p>\u5b66\u4e60\u76ee\u6807 (Learning Objectives)\uff1a * \u6df1\u5ea6\u7406\u89e3 LAION-5B\uff08\u56fe\u6587\u5bf9\uff09\u4e0e OBELICS\uff08\u4ea4\u9519\u6587\u6863\uff09\u8303\u5f0f\u7684\u8bad\u7ec3\u6536\u76ca\u4e0e\u5de5\u7a0b\u6311\u6218\uff0c\u638c\u63e1\u6df7\u5408\u6570\u636e\u7b56\u7565\u7684\u8bbe\u8ba1\u65b9\u6cd5\u3002 * \u80fd\u591f\u7f16\u5199\u57fa\u4e8e PySpark \u548c Ray Data \u7684\u5206\u5e03\u5f0f\u4e0b\u8f7d\u5668\uff0c\u5904\u7406 DNS \u74f6\u9888\u4e0e\u957f\u5c3e\u5ef6\u8fdf\uff0c\u5b9e\u73b0 10,000+ img/s \u7684\u541e\u5410\u91cf\u3002 * \u7cbe\u901a NVIDIA DALI \u7684\u6d41\u6c34\u7ebf\u8bbe\u8ba1\uff0c\u89e3\u51b3 CPU \u89e3\u7801\u74f6\u9888\uff0c\u5229\u7528 GPU Direct \u601d\u60f3\u4f18\u5316\u6570\u636e\u52a0\u8f7d\u3002 * \u6784\u5efa\u5305\u542b CLIP \u8bed\u4e49\u8fc7\u6ee4\u3001\u7f8e\u5b66\u8bc4\u5206\u53ca\u5b89\u5168\u68c0\u6d4b\u7684\u591a\u7ea7\u6e05\u6d17\u6f0f\u6597\uff0c\u5e76\u638c\u63e1\u9488\u5bf9\u4e0d\u540c\u4e1a\u52a1\u573a\u666f\u7684\u9608\u503c\u8c03\u4f18\u7b56\u7565\u3002</p> <p>\u573a\u666f\u5f15\u5165\uff1a</p> <p>\u201c\u8bbe\u60f3\u8fd9\u6837\u4e00\u4e2a\u573a\u666f\uff1a\u6211\u4eec\u7684\u722c\u866b\u56e2\u961f\u521a\u521a\u4ece Common Crawl \u4e2d\u63d0\u53d6\u4e86 20 \u4ebf\u4e2a\u539f\u59cb URL\uff0c\u5b58\u50a8\u5728\u6570\u5343\u4e2a Parquet \u6587\u4ef6\u4e2d\u3002\u4f60\u7684\u4efb\u52a1\u662f\u5728\u4e24\u5468\u5185\u5c06\u8fd9\u4e9b\u6570\u636e\u8f6c\u5316\u4e3a\u53ef\u4f9b GPT-4V \u9884\u8bad\u7ec3\u7684\u9ad8\u8d28\u91cf\u6570\u636e\u96c6\u3002\u5f53\u4f60\u5c1d\u8bd5\u7528\u4f20\u7edf\u7684 Python requests \u5e93\u5355\u673a\u4e0b\u8f7d\u65f6\uff0c\u53d1\u73b0\u9884\u4f30\u8017\u65f6\u7adf\u7136\u9ad8\u8fbe 15 \u5e74\u2014\u2014\u8fd9\u662f\u5178\u578b\u7684\u7f51\u7edc I/O \u963b\u585e\u95ee\u9898\u3002\u66f4\u7cdf\u7cd5\u7684\u662f\uff0c\u521d\u6b65\u91c7\u6837\u663e\u793a\uff0c\u4e0b\u8f7d\u7684\u56fe\u7247\u4e2d\u6709 30% \u662f\u7535\u5546\u5e7f\u544a\u56fe\uff08\u5145\u6ee1\u566a\u70b9\uff09\uff0c15% \u5e26\u6709\u4e25\u91cd\u7684\u6c34\u5370\uff0c\u751a\u81f3\u8fd8\u6709\u4e25\u91cd\u7684 NSFW \u5185\u5bb9\u3002\u5982\u679c\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e9b\u6570\u636e\uff0c\u4e0d\u4ec5\u4f1a\u6d6a\u8d39\u6570\u767e\u4e07\u7f8e\u5143\u7684\u7b97\u529b\uff0c\u8bad\u7ec3\u51fa\u7684\u6a21\u578b\u8fd8\u53ef\u80fd\u56e0\u4e3a\u751f\u6210\u8fdd\u89c4\u5185\u5bb9\u800c\u9762\u4e34\u6cd5\u5f8b\u98ce\u9669\u3002\u6211\u4eec\u9700\u8981\u4e00\u5957\u5de5\u4e1a\u7ea7\u7684\u3001\u9ad8\u541e\u5410\u7684\u3001\u667a\u80fd\u7684\u6570\u636e\u5de5\u7a0b\u65b9\u6848\u6765\u5e94\u5bf9\u8fd9\u4e00\u6311\u6218\u3002\u201d</p>"},{"location":"part3/3_1_image_text_pairs/#61-laion-5b-vs-obelicsmmc4","title":"6.1 \u6570\u636e\u8303\u5f0f\uff1a\u56fe\u6587\u5bf9 (LAION-5B) vs \u4ea4\u9519\u6587\u6863 (OBELICS/MMC4)","text":"<p>\u5728\u8bbe\u8ba1\u6570\u636e\u7ba1\u9053\u4e4b\u524d\uff0c\u6211\u4eec\u7684\u9996\u8981\u804c\u8d23\u662f\u660e\u786e\u6570\u636e\u7684\u7ec4\u7ec7\u5f62\u5f0f\u3002\u8fd9\u4e0d\u4ec5\u5173\u4e4e\u5b58\u50a8\u7ed3\u6784\uff0c\u66f4\u76f4\u63a5\u51b3\u5b9a\u4e86\u4e0b\u6e38\u6a21\u578b\u7684\u8bad\u7ec3\u76ee\u6807\uff08Objective\uff09\u548c\u6d8c\u73b0\u80fd\u529b\uff08Emergent Capabilities\uff09\u3002\u4e0d\u540c\u7684\u6570\u636e\u5f62\u6001\uff0c\u672c\u8d28\u4e0a\u662f\u5bf9\u201c\u77e5\u8bc6\u5982\u4f55\u5b58\u5728\u4e8e\u4e16\u754c\u4e2d\u201d\u7684\u4e0d\u540c\u62bd\u8c61\u3002</p>"},{"location":"part3/3_1_image_text_pairs/#611","title":"6.1.1 \u6838\u5fc3\u6982\u5ff5\u4e0e\u539f\u7406","text":"<p>\u56fe\u6587\u5bf9 (Image-Text Pairs) \u662f\u591a\u6a21\u6001\u5b66\u4e60\u7684\u57fa\u77f3\uff0c\u4ee5 CLIP\u3001ALIGN \u548c LAION-5B \u4e3a\u4ee3\u8868\u3002 * \u7406\u8bba\u89e3\u6790\uff1a\u8fd9\u79cd\u8303\u5f0f\u5047\u8bbe\u56fe\u50cf \\(I\\) \u548c\u6587\u672c \\(T\\) \u4e4b\u95f4\u5b58\u5728\u5f3a\u8bed\u4e49\u5173\u8054\uff0c\u4e14\u8fd9\u79cd\u5173\u8054\u662f\u72ec\u7acb\u7684\u3001\u539f\u5b50\u7684\u3002\u8bad\u7ec3\u76ee\u6807\u901a\u5e38\u662f\u6700\u5927\u5316 \\(I\\) \u548c \\(T\\) \u5728\u5171\u4eab\u5d4c\u5165\u7a7a\u95f4\u4e2d\u7684\u4f59\u5f26\u76f8\u4f3c\u5ea6\uff08Contrastive Learning\uff09\u3002\u5b83\u7684\u4f18\u52bf\u5728\u4e8e\u6781\u9ad8\u7684\u201c\u4fe1\u566a\u6bd4\u201d\u63d0\u70bc\u6f5c\u529b\uff0c\u901a\u8fc7\u5bf9\u6bd4\u5b66\u4e60\uff0c\u6a21\u578b\u80fd\u5b66\u4f1a\u7269\u4f53\u4e0e\u8bcd\u6c47\u7684\u76f4\u63a5\u6620\u5c04\u3002 * \u5de5\u7a0b\u89c6\u89d2\uff1a\u6570\u636e\u7ed3\u6784\u7b80\u5355\uff0c\u901a\u5e38\u8868\u793a\u4e3a <code>(url, caption, metadata)</code> \u7684\u6241\u5e73\u5316\u8bb0\u5f55\u3002\u8fd9\u79cd\u6570\u636e\u6781\u6613\u4e8e\u5206\u7247\uff08Sharding\uff09\u548c\u968f\u673a\u6253\u6563\uff08Shuffle\uff09\u3002\u5728\u8bad\u7ec3\u65f6\uff0c\u7531\u4e8e\u6837\u672c\u95f4\u76f8\u4e92\u72ec\u7acb\uff0c\u6211\u4eec\u53ef\u4ee5\u8f7b\u6613\u5730\u5b9e\u73b0 Global Batch Shuffling\uff0c\u4ece\u800c\u63d0\u5347\u5bf9\u6bd4\u5b66\u4e60\u7684\u6548\u679c\u3002</p> <p>\u4ea4\u9519\u6587\u6863 (Interleaved Image-Text Documents) \u662f\u65b0\u4e00\u4ee3\u591a\u6a21\u6001\u5927\u6a21\u578b\uff08\u5982 Flamingo, GPT-4V, MM1\uff09\u7684\u5173\u952e\u71c3\u6599\uff0c\u4ee5 OBELICS \u548c MMC4 \u4e3a\u4ee3\u8868\u3002 * \u7406\u8bba\u89e3\u6790\uff1a\u8fd9\u79cd\u8303\u5f0f\u4fdd\u7559\u4e86\u7f51\u9875\u539f\u59cb\u7684 DOM \u7ed3\u6784\u987a\u5e8f\uff0c\u6570\u636e\u5448\u73b0\u4e3a <code>&lt;text&gt;, &lt;image&gt;, &lt;text&gt;...</code> \u7684\u5e8f\u5217\u3002\u8fd9\u8feb\u4f7f\u6a21\u578b\u5b66\u4e60\u201c\u591a\u6a21\u6001\u4e0a\u4e0b\u6587\u4f9d\u8d56\u201d\uff08Multimodal In-Context Learning\uff09\u3002\u4f8b\u5982\uff0c\u5728\u4e00\u4e2a\u201c\u5982\u4f55\u5236\u4f5c\u86cb\u7cd5\u201d\u7684\u7f51\u9875\u4e2d\uff0c\u56fe\u7247 1\uff08\u539f\u6599\u56fe\uff09\u548c\u56fe\u7247 5\uff08\u6210\u54c1\u56fe\uff09\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u4ee5\u53ca\u5b83\u4eec\u4e0e\u5468\u56f4\u6587\u672c\u7684\u903b\u8f91\u8054\u7cfb\uff0c\u662f\u56fe\u6587\u5bf9\u65e0\u6cd5\u63d0\u4f9b\u7684\u3002\u5b83\u6a21\u62df\u4e86\u4eba\u7c7b\u9605\u8bfb\u56fe\u6587\u6df7\u6392\u4e66\u7c4d\u7684\u8ba4\u77e5\u8fc7\u7a0b\u3002 * \u5de5\u7a0b\u89c6\u89d2\uff1a\u6570\u636e\u7ba1\u9053\u6781\u5176\u590d\u6742\u3002\u7531\u4e8e\u5355\u4e2a\u6837\u672c\uff08\u6587\u6863\uff09\u7684\u957f\u5ea6\u4e0d\u56fa\u5b9a\u4e14\u53ef\u80fd\u5305\u542b\u591a\u5f20\u56fe\u7247\uff0cBatch \u7684\u7ec4\u88c5\u53d8\u5f97\u56f0\u96be\u3002\u4f20\u7edf\u7684 Collator \u9700\u8981\u590d\u6742\u7684 Padding \u7b56\u7565\u3002\u6b64\u5916\uff0c\u6e05\u6d17\u65f6\u5fc5\u987b\u5c0f\u5fc3\u7ef4\u62a4\u6587\u6863\u7684\u5b8c\u6574\u6027\uff0c\u968f\u610f\u5220\u9664\u4e00\u5f20\u4f4e\u8d28\u91cf\u56fe\u7247\u53ef\u80fd\u4f1a\u7834\u574f\u4e0a\u4e0b\u6587\u903b\u8f91\uff0c\u5bfc\u81f4\u6a21\u578b\u5b66\u5230\u9519\u8bef\u7684\u6307\u4ee3\u5173\u7cfb\u3002</p>"},{"location":"part3/3_1_image_text_pairs/#612","title":"6.1.2 \u67b6\u6784\u51b3\u7b56\uff1a\u9009\u578b\u5bf9\u6bd4\u8868","text":"<p>\u5728\u8d44\u6e90\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u4f55\u6743\u8861\u8fd9\u4e24\u79cd\u6570\u636e\uff1f\u8fd9\u5e76\u975e\u4e00\u4e2a\u7b80\u5355\u7684\u4e8c\u5143\u9009\u62e9\uff0c\u800c\u662f\u6d89\u53ca\u5230\u6a21\u578b\u67b6\u6784\u3001\u8bad\u7ec3\u6210\u672c\u548c\u6700\u7ec8\u5e94\u7528\u573a\u666f\u7684\u6df1\u5ea6\u535a\u5f08\u3002</p> <p>\u5728\u65e9\u671f\u7684\u591a\u6a21\u6001\u7814\u7a76\u4e2d\uff08\u5982 2021 \u5e74\u4e4b\u524d\uff09\uff0c\u4e1a\u754c\u666e\u904d\u8ba4\u4e3a\u53ea\u8981\u6570\u636e\u91cf\u591f\u5927\uff08\u5982 CLIP \u7684 4\u4ebf\u5bf9\uff09\uff0c\u6a21\u578b\u5c31\u80fd\u5b66\u4f1a\u4e00\u5207\u3002\u4f46\u968f\u7740 GPT-4V \u7684\u51fa\u73b0\uff0c\u6211\u4eec\u53d1\u73b0\u4ec5\u9760\u56fe\u6587\u5bf9\u8bad\u7ec3\u51fa\u7684\u6a21\u578b\uff0c\u867d\u7136\u80fd\u51c6\u786e\u8bc6\u522b\u201c\u8fd9\u662f\u4e00\u53ea\u732b\u201d\uff0c\u5374\u65e0\u6cd5\u56de\u7b54\u201c\u56fe\u4e2d\u8fd9\u53ea\u732b\u53ef\u80fd\u4f1a\u505a\u4ec0\u4e48\u201d\uff0c\u56e0\u4e3a\u5b83\u7f3a\u4e4f\u903b\u8f91\u63a8\u7406\u7684\u4e0a\u4e0b\u6587\u3002\u53cd\u4e4b\uff0c\u4ea4\u9519\u6587\u6863\u867d\u7136\u5bcc\u542b\u903b\u8f91\uff0c\u4f46\u6570\u636e\u7a00\u758f\uff0c\u5904\u7406\u6210\u672c\u6781\u9ad8\u3002</p> <p>\u4e0b\u8868\u8be6\u7ec6\u5bf9\u6bd4\u4e86\u4e24\u79cd\u8303\u5f0f\u5728\u5de5\u7a0b\u843d\u5730\u5c42\u9762\u7684\u6838\u5fc3\u5dee\u5f02\uff0c\u65e8\u5728\u5e2e\u52a9\u67b6\u6784\u5e08\u6839\u636e\u5b9e\u9645\u9700\u6c42\u8fdb\u884c\u6280\u672f\u9009\u578b\uff1a</p> \u7279\u6027\u7ef4\u5ea6 \u56fe\u6587\u5bf9\u8303\u5f0f (LAION-style) \u4ea4\u9519\u6587\u6863\u8303\u5f0f (OBELICS-style) \u6df1\u5ea6\u89e3\u8bfb\u4e0e\u5efa\u8bae \u8bad\u7ec3\u76ee\u6807 \u5bf9\u6bd4\u5b66\u4e60 (CLIP), \u6587\u751f\u56fe (Stable Diffusion) \u4e0b\u4e00\u4e2aToken\u9884\u6d4b (Next-Token Prediction), \u591a\u6a21\u6001\u5bf9\u8bdd (GPT-4V) \u6df7\u5408\u7b56\u7565\u662f\u738b\u9053\u3002\u7814\u7a76\u8868\u660e\uff0c\u4ec5\u4f7f\u7528\u4ea4\u9519\u6587\u6863\u8bad\u7ec3\u89c6\u89c9\u7f16\u7801\u5668\u6548\u7387\u8f83\u4f4e\uff08\u56e0\u4e3a\u56fe\u7247\u4e0d\u591f\u5bc6\u96c6\uff09\uff0c\u800c\u4ec5\u4f7f\u7528\u56fe\u6587\u5bf9\u5219\u7f3a\u4e4f\u63a8\u7406\u80fd\u529b\u3002\u63a8\u8350\u91c7\u7528 Curriculum Learning\uff08\u8bfe\u7a0b\u5b66\u4e60\uff09\u7b56\u7565\u3002 \u6570\u636e\u6e90\u89e3\u6790 \u7b80\u5355\uff1a\u4ec5\u9700\u63d0\u53d6 <code>&lt;img&gt;</code> \u6807\u7b7e\u53ca\u5176 Alt-text \u590d\u6742\uff1a\u9700\u89e3\u6790 DOM \u6811\uff0c\u8fc7\u6ee4\u5e7f\u544a\u3001\u4fa7\u8fb9\u680f\uff0c\u4fdd\u7559\u6b63\u6587\u903b\u8f91 \u5de5\u7a0b\u590d\u6742\u5ea6\u9884\u8b66\u3002\u6784\u5efa\u4ea4\u9519\u6587\u6863\u9700\u8981\u5904\u7406\u6781\u5176\u590d\u6742\u7684 HTML \u6e32\u67d3\u903b\u8f91\u3002\u5efa\u8bae\u521d\u671f\u5229\u7528 Common Crawl \u7684 WET \u6587\u4ef6\u6784\u5efa\uff0c\u6216\u8005\u76f4\u63a5\u4f7f\u7528 OBELICS \u5f00\u6e90\u96c6\u505a\u589e\u5f3a\uff0c\u4e0d\u8981\u8bd5\u56fe\u4ece\u96f6\u5f00\u59cb\u91cd\u65b0\u6e05\u6d17\u6574\u4e2a\u4e92\u8054\u7f51\u3002 \u5b58\u50a8\u6210\u672c \u4e2d\u7b49\uff1a\u5143\u6570\u636e\u4ec5\u4e3a CSV/Parquet\uff0c\u56fe\u7247\u72ec\u7acb\u5b58\u50a8 \u9ad8\uff1a\u9700\u4fdd\u5b58\u6587\u6863\u62d3\u6251\u7ed3\u6784\uff0c\u5efa\u8bae\u4f7f\u7528 WebDataset \u6216 TFRecord \u5c01\u88c5 I/O \u6027\u80fd\u74f6\u9888\u3002\u5bf9\u4e8e\u4ea4\u9519\u6587\u6863\uff0c\u5fc5\u987b\u4f7f\u7528\u5206\u7247\u5f0f\u5b58\u50a8\uff08Sharding\uff09\uff0c\u907f\u514d\u5c0f\u6587\u4ef6\u788e\u7247\u5316\u3002\u8bfb\u53d6\u65f6\u9700\u9884\u8bfb\u6574\u4e2a\u6587\u6863\uff0c\u8fd9\u5bf9\u5185\u5b58\u5e26\u5bbd\u63d0\u51fa\u4e86\u66f4\u9ad8\u8981\u6c42\u3002 \u6e05\u6d17\u6311\u6218 \u5355\u70b9\u6e05\u6d17\uff1a\u6bcf\u5f20\u56fe\u72ec\u7acb\u5224\u65ad\uff0c\u6613\u4e8e\u5e76\u884c\u5316 \u4e0a\u4e0b\u6587\u6e05\u6d17\uff1a\u9700\u540c\u65f6\u8003\u8651\u6587\u672c\u8fde\u8d2f\u6027\u548c\u56fe\u7247\u8d28\u91cf\uff0c\u6e05\u6d17\u903b\u8f91\u8026\u5408 \u7b56\u7565\u9009\u62e9\u3002\u5728\u5904\u7406\u4ea4\u9519\u6587\u6863\u65f6\uff0c\u82e5\u67d0\u5f20\u56fe\u88ab\u5224\u5b9a\u4e3a NSFW\uff0c\u5efa\u8bae\u7528\u7279\u6b8a\u7684 <code>&lt;BLOCKED_IMAGE&gt;</code> Token \u66ff\u6362\uff0c\u800c\u975e\u76f4\u63a5\u5220\u9664\uff0c\u4ee5\u4fdd\u6301\u4f4d\u7f6e\u7f16\u7801\uff08Positional Embedding\uff09\u7684\u51c6\u786e\u6027\u3002 \u6a21\u578b\u6536\u76ca \u6781\u5f3a\u7684\u89c6\u89c9-\u8bed\u4e49\u5bf9\u9f50\uff0cZero-shot \u5206\u7c7b\u80fd\u529b\u5f3a \u5f3a\u5927\u7684 Few-shot Learning \u80fd\u529b\uff0c\u652f\u6301\u591a\u8f6e\u5bf9\u8bdd\u548c\u903b\u8f91\u63a8\u7406 \u4e1a\u52a1\u5bfc\u5411\u3002\u82e5\u4e1a\u52a1\u573a\u666f\u662f\u201c\u4ee5\u56fe\u641c\u56fe\u201d\uff0c\u56fe\u6587\u5bf9\u8db3\u77e3\uff1b\u82e5\u4e1a\u52a1\u6d89\u53ca\u590d\u6742\u6587\u6863\u7406\u89e3\uff08\u5982\u7814\u62a5\u5206\u6790\u3001\u957f\u7bc7\u6545\u4e8b\u751f\u6210\uff09\uff0c\u5fc5\u987b\u5f15\u5165\u4ea4\u9519\u6587\u6863\u6570\u636e\u3002 <p>tips\uff1a \u5728 MM1 \u548c Idefics2 \u7b49\u524d\u6cbf\u7814\u7a76\u4e2d\uff0c\u6700\u4f73\u5b9e\u8df5\u5e76\u975e\u4e8c\u9009\u4e00\uff0c\u800c\u662f\u914d\u6bd4\u3002\u901a\u5e38\u5efa\u8bae\u5728\u9884\u8bad\u7ec3\uff08Pre-training\uff09\u65e9\u671f\u9636\u6bb5\uff0c\u4f7f\u7528 80% \u7684\u56fe\u6587\u5bf9 \u6765\u5efa\u7acb\u575a\u5b9e\u7684\u89c6\u89c9-\u8bed\u8a00\u6620\u5c04\u57fa\u7840\uff0c\u540c\u65f6\u6df7\u5165 20% \u7684\u4ea4\u9519\u6587\u6863\uff1b\u5728\u9884\u8bad\u7ec3\u540e\u671f\uff08Annealing Phase\uff09\uff0c\u5927\u5e45\u589e\u52a0\u4ea4\u9519\u6587\u6863\u7684\u6bd4\u4f8b\uff0c\u4ee5\u6fc0\u53d1\u6a21\u578b\u7684\u957f\u7a97\u53e3\u63a8\u7406\u80fd\u529b\u3002\u8fd9\u79cd\u201c\u5148\u6253\u57fa\u7840\uff0c\u540e\u7ec3\u903b\u8f91\u201d\u7684\u7b56\u7565\u80fd\u6700\u5927\u5316\u7b97\u529b\u5229\u7528\u7387\u3002</p>"},{"location":"part3/3_1_image_text_pairs/#62","title":"6.2 \u56fe\u50cf\u83b7\u53d6\u4e0e\u9884\u5904\u7406","text":"<p>\u4e00\u65e6\u786e\u5b9a\u4e86\u6570\u636e\u6e05\u5355\uff08Manifest\uff09\uff0c\u4e0b\u4e00\u6b65\u5c31\u662f\u6784\u5efa\u9ad8\u541e\u5410\u7684\u4e0b\u8f7d\u4e0e\u9884\u5904\u7406\u6d41\u6c34\u7ebf\u3002\u8fd9\u662f\u4e00\u4e2a\u5178\u578b\u7684 IO \u5bc6\u96c6\u578b\u4efb\u52a1\uff0c\u4e3b\u8981\u74f6\u9888\u5728\u4e8e\u7f51\u7edc\u5e26\u5bbd\u3001DNS \u89e3\u6790\u5ef6\u8fdf\u4ee5\u53ca\u6d77\u91cf\u5c0f\u6587\u4ef6\u7684\u78c1\u76d8\u5199\u5165\u3002</p>"},{"location":"part3/3_1_image_text_pairs/#621-img2dataset","title":"6.2.1 img2dataset \u9ad8\u5e76\u53d1\u4e0b\u8f7d\u5b9e\u6218","text":"<p><code>img2dataset</code> \u662f\u76ee\u524d\u793e\u533a\u516c\u8ba4\u7684\u6700\u4f73\u5b9e\u8df5\u5de5\u5177\u3002\u5b83\u4e0d\u4ec5\u4ec5\u662f\u4e00\u4e2a\u4e0b\u8f7d\u811a\u672c\uff0c\u66f4\u662f\u4e00\u4e2a\u57fa\u4e8e MapReduce \u601d\u60f3\u7684\u5206\u5e03\u5f0f\u6570\u636e\u5904\u7406\u6846\u67b6\u3002</p> <p>\u6211\u4eec\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528\u4e13\u95e8\u7684\u5de5\u5177\u800c\u4e0d\u662f\u81ea\u5df1\u5199\u4e2a <code>requests.get</code> \u5faa\u73af\uff1f\u56e0\u4e3a\u4e92\u8054\u7f51\u73af\u5883\u662f\u6781\u5176\u6076\u52a3\u7684\u3002\u94fe\u63a5\u4f1a\u5931\u6548\uff08Link Rot\uff09\uff0c\u670d\u52a1\u5668\u4f1a\u9650\u6d41\uff08Rate Limiting\uff09\uff0cDNS \u4f1a\u8d85\u65f6\u3002\u5904\u7406 10 \u4ebf\u7ea7\u522b\u7684 URL\uff0c\u4efb\u4f55\u5fae\u5c0f\u7684\u957f\u5c3e\u5ef6\u8fdf\u90fd\u4f1a\u88ab\u653e\u5927\u6210\u6570\u5468\u7684\u65f6\u95f4\u6210\u672c\u3002</p> <p>\u6838\u5fc3\u539f\u7406\uff1a 1.  \u5206\u7247 (Sharding)\uff1a\u5c06 10 \u4ebf\u6761 URL \u5207\u5206\u4e3a\u6570\u4e07\u4e2a\u5c0f\u4efb\u52a1\uff08Shard\uff09\u3002\u8fd9\u662f\u5206\u5e03\u5f0f\u8ba1\u7b97\u7684\u57fa\u7840\u3002 2.  \u5f02\u6b65 I/O (Async I/O)\uff1a\u5229\u7528 Python \u7684 aiohttp \u6216 Go \u7684\u534f\u7a0b\uff0c\u5728\u5355\u6838\u4e0a\u5e76\u53d1\u53d1\u8d77\u6570\u767e\u4e2a\u7f51\u7edc\u8bf7\u6c42\uff0c\u63a9\u76d6\u7f51\u7edc\u5ef6\u8fdf\u3002 3.  \u6d41\u5f0f\u5f52\u6863 (Streaming Archival)\uff1a\u4e0b\u8f7d\u7684\u56fe\u7247\u4e0d\u843d\u76d8\uff0c\u76f4\u63a5\u5728\u5185\u5b58\u4e2d\u7ec4\u5408\u6210 tar \u5305\uff08WebDataset \u683c\u5f0f\uff09\uff0c\u7136\u540e\u6d41\u5f0f\u5199\u5165\u5bf9\u8c61\u5b58\u50a8\uff08S3/HDFS\uff09\u3002\u8fd9\u907f\u514d\u4e86\u5728\u4e00\u4e2a\u76ee\u5f55\u4e0b\u521b\u5efa\u767e\u4e07\u4e2a\u5c0f\u6587\u4ef6\u5bfc\u81f4\u7684\u6587\u4ef6\u7cfb\u7edf inode \u8017\u5c3d\u95ee\u9898\u2014\u2014\u8fd9\u662f\u65b0\u624b\u6700\u5bb9\u6613\u8e29\u7684\u5751\u3002</p> <p>\u5de5\u7a0b\u5b9e\u73b0\uff1aPySpark \u5206\u5e03\u5f0f\u4e0b\u8f7d\u811a\u672c</p> <p>\u5728\u5904\u7406 PB \u7ea7\u6570\u636e\u65f6\uff0c\u5355\u673a multiprocessing \u6a21\u5f0f\u5df2\u4e0d\u8db3\u4ee5\u5e94\u5bf9\uff0c\u5fc5\u987b\u4f7f\u7528 Spark \u96c6\u7fa4\u3002</p> <pre><code># \u5efa\u8bae\u73af\u5883: PySpark 3.2+, img2dataset 1.41+\n# \u8fd0\u884c\u547d\u4ee4: spark-submit --master yarn --deploy-mode cluster...\n\nfrom img2dataset import download\nimport shutil\nimport os\n\ndef run_distributed_download():\n    \"\"\"\n    \u914d\u7f6e\u9879\u7684\u8c03\u4f18\u662f\u541e\u5410\u91cf\u7684\u5173\u952e\u3002\n    process_count: \u6bcf\u4e2a Spark Executor \u7684\u8fdb\u7a0b\u6570\u3002\n    thread_count: \u6bcf\u4e2a\u8fdb\u7a0b\u5185\u7684\u5f02\u6b65\u7ebf\u7a0b\u6570\u3002\n    \u5bf9\u4e8e 10Gbps \u7f51\u5361\u7684\u8282\u70b9\uff0c\u901a\u5e38\u5efa\u8bae total_concurrency \u5728 1000 \u5de6\u53f3\u3002\n    \"\"\"\n\n    # \u5b9a\u4e49\u8f93\u51fa\u8def\u5f84 (S3 \u6216 HDFS)\n    output_dir = \"s3a://multimodal-lake/raw-images/laion-5b-subset\"\n\n    # \u6e05\u7406\u65e7\u6570\u636e (\u614e\u7528\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u5e26\u7248\u672c\u53f7)\n    if os.path.exists(output_dir): \n        # shutil.rmtree(output_dir) # \u5371\u9669\u64cd\u4f5c\uff0c\u6ce8\u91ca\u6389\n        pass\n\n    download(\n        processes_count=4,          # \u6bcf\u4e2a\u8282\u70b9\u4f7f\u7528 4 \u4e2a CPU \u6838\n        thread_count=64,            # \u6bcf\u4e2a\u6838\u5e76\u53d1 64 \u4e2a\u4e0b\u8f7d\u7ebf\u7a0b\n        url_list=\"s3a://multimodal-lake/meta/laion-urls.parquet\",\n        image_size=256,             # \u9884\u8bad\u7ec3\u9636\u6bb5 256x256 \u8db3\u591f\uff0c\u8282\u7701\u5e26\u5bbd\n        resize_only_if_bigger=True, # \u907f\u514d\u5c0f\u56fe\u786c\u653e\u5927\u9020\u6210\u7684\u6a21\u7cca\n        resize_mode=\"keep_ratio\",   # \u4fdd\u6301\u6bd4\u4f8b\uff0c\u586b\u5145\u9ed1\u8fb9\u6216\u4e2d\u5fc3\u88c1\u526a\n        skip_reencode=True,         # \u5982\u679c\u539f\u56fe\u5c31\u662f JPG \u4e14\u5927\u5c0f\u5408\u9002\uff0c\u76f4\u63a5\u5b58\u50a8\uff0c\u8282\u7701 CPU\n        output_folder=output_dir,\n        output_format=\"webdataset\", # \u5f3a\u5236\u4f7f\u7528 WebDataset\n        input_format=\"parquet\",\n        url_col=\"url\",\n        caption_col=\"caption\",\n        enable_wandb=True,          # \u5f3a\u70c8\u5efa\u8bae\u5f00\u542f\uff0c\u7528\u4e8e\u76d1\u63a7\u4e0b\u8f7d\u901f\u7387\u548c\u9519\u8bef\u7387\n        number_sample_per_shard=10000, # \u6bcf\u4e2a tar \u5305\u5305\u542b 1\u4e07 \u5f20\u56fe\uff0c\u7ea6 200-300MB\uff0c\u4fbf\u4e8e\u4f20\u8f93\n        distributor=\"pyspark\",      # \u4f7f\u7528 Spark \u5206\u53d1\u4efb\u52a1\n        save_additional_columns=[\"similarity\", \"hash\"], # \u4fdd\u7559\u539f\u59cb\u5143\u6570\u636e\n        timeout=10                  # \u8bbe\u7f6e\u8f83\u77ed\u8d85\u65f6\uff0c\u5feb\u901f\u5931\u8d25\uff0c\u957f\u5c3e\u8bf7\u6c42\u4e0d\u503c\u5f97\u7b49\u5f85\n    )\n\nif __name__ == \"__main__\":\n    # \u521d\u59cb\u5316 Spark Session (\u901a\u5e38\u7531 spark-submit \u81ea\u52a8\u5904\u7406\uff0c\u4f46\u4e5f\u9700\u663e\u5f0f\u58f0\u660e\u4ee5\u4fbf IDE \u8c03\u8bd5)\n    from pyspark.sql import SparkSession\n    spark = SparkSession.builder \\\n        .appName(\"Img2Dataset-Production\") \\\n        .config(\"spark.executor.memory\", \"8g\") \\\n        .config(\"spark.task.maxFailures\", \"10\") \\\n        .getOrCreate()\n\n    run_distributed_download()\n</code></pre> <p>\u5b9e\u6218\u6280\u5de7 (Pro Tips)\uff1a * DNS \u7f13\u5b58\uff1a\u5728\u9ad8\u5e76\u53d1\u4e0b\uff0cDNS \u89e3\u6790\u53ef\u80fd\u6210\u4e3a\u74f6\u9888\u751a\u81f3\u88ab\u670d\u52a1\u5546\u5c01\u7981\u3002\u5efa\u8bae\u5728 Worker \u8282\u70b9\u90e8\u7f72\u672c\u5730 DNS \u7f13\u5b58\uff08\u5982 dnsmasq\uff09\uff0c\u6216\u8005\u5728\u4ee3\u7801\u5c42\u9762\u7ef4\u62a4\u4e00\u4e2a\u57df\u540d\u5230 IP \u7684\u6620\u5c04\u8868\u3002 * User-Agent \u8f6e\u8be2\uff1a\u867d\u7136\u8fd9\u662f\u4e00\u4e2a\u201c\u516c\u5f00\u201d\u7684\u79d8\u5bc6\uff0c\u4f46\u8f6e\u8be2 User-Agent \u53ef\u4ee5\u51cf\u5c11 403 Forbidden \u7684\u6bd4\u4f8b\u3002 * \u9519\u8bef\u5904\u7406\uff1a\u5173\u6ce8 WandB \u9762\u677f\u4e2d\u7684 success_rate\u3002\u5982\u679c\u4f4e\u4e8e 80%\uff0c\u901a\u5e38\u610f\u5473\u7740 URL \u5217\u8868\u8fc7\u671f\u4e25\u91cd\uff0c\u6216\u8005\u4f60\u7684 IP \u6c60\u88ab\u6c61\u67d3\u4e86\u3002</p>"},{"location":"part3/3_1_image_text_pairs/#622","title":"6.2.2 \u89c6\u89c9\u9884\u5904\u7406\u7684\u9677\u9631\uff1a\u88c1\u526a\u4e0e\u8bed\u4e49\u5bf9\u9f50","text":"<p>\u5728\u89e3\u51b3\u4e86\u6d77\u91cf\u6570\u636e\u7684\u83b7\u53d6\uff08Getting bytes\uff09\u4e4b\u540e\uff0c\u6211\u4eec\u7acb\u523b\u9762\u4e34\u7b2c\u4e8c\u4e2a\u6311\u6218\uff1a\u6570\u636e\u7684\u53ef\u7528\u6027\uff08Usability\uff09\u3002\u539f\u59cb\u4e92\u8054\u7f51\u56fe\u7247\u7684\u957f\u5bbd\u6bd4\uff08Aspect Ratio\uff09\u5343\u5947\u767e\u602a\uff0c\u800c\u6a21\u578b\u901a\u5e38\u9700\u8981\u56fa\u5b9a\u7684\u5206\u8fa8\u7387\u8f93\u5165\uff08\u5982 224x224 \u6216 512x512\uff09\u3002</p> <p>\u5f88\u591a\u521d\u7ea7\u5de5\u7a0b\u65b9\u6848\u4e60\u60ef\u4e8e\u7b80\u5355\u7c97\u66b4\u7684\u968f\u673a\u9884\u5904\u7406\u6765\u7edf\u4e00\u5c3a\u5bf8\uff0c\u4f46\u8fd9\u5f80\u5f80\u662f\u6a21\u578b\u6027\u80fd\u201c\u9690\u5f62\u5929\u82b1\u677f\u201d\u7684\u6839\u6e90\u3002\u6211\u4eec\u4e0d\u4ec5\u8981\u5173\u6ce8\u201c\u628a\u56fe\u653e\u8fdb\u53bb\u201d\uff0c\u8fd8\u8981\u5173\u6ce8\u201c\u653e\u8fdb\u53bb\u7684\u662f\u4ec0\u4e48\u201d\u3002</p> <p> \u56fe6-1\uff1a\u56fe\u7247\u9884\u5904\u7406\u4e2d\u88c1\u526a\u4e0e\u8bed\u4e49\u5bf9\u9f50\u95ee\u9898</p> <ul> <li> <p>Bad Case\uff08\u5de6\u56fe - \u673a\u68b0\u88c1\u526a\u7684\u4ee3\u4ef7\uff09\uff1a     \u4f20\u7edf\u7684 <code>RandomCrop</code> \u6216 <code>CenterCrop</code> \u5bf9\u6784\u56fe\u6ca1\u6709\u611f\u77e5\u3002\u5f53\u5904\u7406\u4e00\u5f20\u7ad6\u6784\u56fe\u7684\u4eba\u50cf\u7167\u7247\u65f6\uff0c\u4e2d\u5fc3\u88c1\u526a\u6781\u6613\u5207\u6389\u5173\u952e\u7279\u5f81\uff08\u5982\u5934\u90e8\uff09\uff0c\u53ea\u4fdd\u7559\u8eaf\u5e72\u3002\u6b64\u65f6\uff0c\u5982\u679c\u6587\u672c\u6807\u7b7e\u4f9d\u7136\u662f\u201c\u4e00\u4e2a\u5fae\u7b11\u7684\u7537\u4eba\u201d\uff0c\u6a21\u578b\u5c31\u4f1a\u88ab\u8feb\u5efa\u7acb\u9519\u8bef\u7684\u6620\u5c04\u5173\u7cfb\uff08\u628a\u8eaf\u5e72\u7279\u5f81\u8bef\u8ba4\u4e3a\u662f\u201c\u5fae\u7b11\u7684\u4eba\u201d\uff09\uff0c\u5bfc\u81f4\u8bad\u7ec3\u51fa\u7684\u6a21\u578b\u4ea7\u751f\u4e25\u91cd\u7684\u89c6\u89c9\u5e7b\u89c9\u3002</p> </li> <li> <p>Good Case\uff08\u53f3\u56fe - \u8bed\u4e49\u5b8c\u6574\u6027\uff09\uff1a     \u9ad8\u8d28\u91cf\u7684\u6570\u636e\u5de5\u7a0b\u8ffd\u6c42\u201c\u56fe\u6587\u4e00\u81f4\u6027\u201d\u3002</p> <ol> <li>Smart Resize: \u5c3d\u91cf\u91c7\u7528 <code>Resize with Padding</code>\uff08\u4fdd\u6301\u6bd4\u4f8b\uff0c\u586b\u5145\u9ed1\u8fb9/\u767d\u8fb9\uff09\u6765\u4fdd\u7559\u5b8c\u6574\u7684\u89c6\u89c9\u4e3b\u4f53\u3002\u867d\u7136\u8fd9\u5f15\u5165\u4e86\u65e0\u6548\u50cf\u7d20\uff0c\u4f46\u4fdd\u8bc1\u4e86\u8bed\u4e49\u5b8c\u6574\u3002</li> <li>Aspect Ratio Bucketing (\u957f\u5bbd\u6bd4\u5206\u6876)\uff1a\u8fd9\u662f\u76ee\u524d SDXL \u548c Midjourney \u7b49\u751f\u6210\u6a21\u578b\u5e38\u7528\u7684\u9ad8\u7ea7\u6280\u5de7\u3002\u5c06\u957f\u5bbd\u6bd4\u76f8\u4f3c\u7684\u56fe\u7247\u5206\u5230\u540c\u4e00\u4e2a Batch \u4e2d\u8bad\u7ec3\uff0c\u65e2\u907f\u514d\u4e86\u88c1\u526a\uff0c\u53c8\u51cf\u5c11\u4e86 Padding \u7684\u6d6a\u8d39\u3002</li> <li>Recaptioning (\u91cd\u6253\u6807)\uff1a\u5982\u4e0b\u6587\u7b2c 7 \u7ae0\u5c06\u8be6\u7ec6\u9610\u8ff0\u7684\uff0c\u5229\u7528 VLM \u751f\u6210\u9ad8\u5bc6\u5ea6\u7684\u63cf\u8ff0\uff0c\u80fd\u8ba9\u6587\u672c\u7cbe\u51c6\u5bf9\u5e94\u753b\u9762\u4e2d\u7684\u7ec6\u8282\uff08\u5982\u62db\u724c\u6587\u5b57\u3001\u80cc\u666f\u7269\u4f53\uff09\uff0c\u4ece\u800c\u6700\u5927\u5316\u6570\u636e\u7684\u8bad\u7ec3\u4ef7\u503c\u3002</li> </ol> </li> </ul>"},{"location":"part3/3_1_image_text_pairs/#623-gpu-nvidia-dali","title":"6.2.3 GPU \u52a0\u901f\u89e3\u7801\u4e0e\u53d8\u6362 (NVIDIA DALI)","text":"<p>\u5728\u6df1\u5ea6\u5b66\u4e60\u6a21\u578b\u8bad\u7ec3\u73af\u8282\uff0c\u591a\u6570\u7814\u7a76\u8005\u548c\u5f00\u53d1\u8005\u7684\u6838\u5fc3\u6ce8\u610f\u529b\u5f80\u5f80\u96c6\u4e2d\u5728\u6a21\u578b\u67b6\u6784\u8bbe\u8ba1\u3001\u8d85\u53c2\u6570\u8c03\u4f18\u3001\u635f\u5931\u51fd\u6570\u6539\u8fdb\u7b49\u76f4\u63a5\u5f71\u54cd\u6a21\u578b\u7cbe\u5ea6\u7684\u6a21\u5757\u4e0a\uff0c\u5374\u5bb9\u6613\u5ffd\u89c6\u6570\u636e\u52a0\u8f7d\uff08DataLoader\uff09\u8fd9\u4e00\u57fa\u7840\u73af\u8282\u2014\u2014\u800c\u5b9e\u9645\u4e0a\uff0c\u5b83\u5e38\u5e38\u6210\u4e3a\u5236\u7ea6\u8bad\u7ec3\u6548\u7387\u7684\u201c\u9690\u5f62\u6027\u80fd\u6740\u624b\u201d\uff0c\u751a\u81f3\u5bfc\u81f4\u9ad8\u7aefGPU\u7684\u7b97\u529b\u65e0\u6cd5\u5f97\u5230\u5145\u5206\u91ca\u653e\uff0c\u9020\u6210\u786c\u4ef6\u8d44\u6e90\u7684\u4e25\u91cd\u6d6a\u8d39\u3002 \u8981\u7406\u89e3\u8fd9\u4e00\u75db\u70b9\uff0c\u9700\u5148\u660e\u786e\u6df1\u5ea6\u5b66\u4e60\u8bad\u7ec3\u7684\u5b8c\u6574\u6d41\u7a0b\u903b\u8f91\uff1a\u6a21\u578b\u8bad\u7ec3\u7684\u6838\u5fc3\u7b97\u529b\u4f9d\u8d56GPU\u7684\u5927\u89c4\u6a21\u5e76\u884c\u8ba1\u7b97\u80fd\u529b\uff0cGPU\u80fd\u591f\u9ad8\u6548\u5904\u7406\u6d77\u91cf\u5f20\u91cf\u8fd0\u7b97\u3001\u5b8c\u6210\u53cd\u5411\u4f20\u64ad\u4e0e\u53c2\u6570\u66f4\u65b0\uff1b\u4f46\u5728\u6570\u636e\u8f93\u5165GPU\u4e4b\u524d\uff0c\u5fc5\u987b\u7ecf\u8fc7\u4e00\u7cfb\u5217\u9884\u5904\u7406\u64cd\u4f5c\uff0c\u5176\u4e2d\u6700\u57fa\u7840\u4e14\u8017\u65f6\u7684\u5c31\u662f\u56fe\u50cf\u6570\u636e\u7684\u89e3\u7801\u4e0e\u5c3a\u5bf8\u53d8\u6362\uff08\u5982Resize\uff09\u3002\u5728\u4f20\u7edf\u7684PyTorch\u8bad\u7ec3\u6d41\u7a0b\u4e2d\uff0c\u8fd9\u4e9b\u5173\u952e\u9884\u5904\u7406\u64cd\u4f5c\u5b8c\u5168\u4f9d\u8d56CPU\u5b8c\u6210\uff0c\u8fd9\u5c31\u5f62\u6210\u4e86\u201cCPU\u9884\u5904\u7406\u74f6\u9888\u201d\u4e0e\u201cGPU\u7b97\u529b\u5197\u4f59\u201d\u7684\u77db\u76fe\u3002</p> <p>\u5177\u4f53\u800c\u8a00\uff0c\u4f20\u7edfPyTorch Dataset\u7684\u5de5\u4f5c\u673a\u5236\u7684\u662f\uff1a\u9996\u5148\u901a\u8fc7CPU\u8bfb\u53d6\u5b58\u50a8\u5728\u786c\u76d8\u4e2d\u7684\u56fe\u50cf\u6587\u4ef6\uff08\u591a\u4e3aJPEG\u683c\u5f0f\uff09\uff0c\u968f\u540e\u7531CPU\u5b8c\u6210JPEG\u89e3\u7801\u64cd\u4f5c\u2014\u2014\u8fd9\u4e00\u8fc7\u7a0b\u9700\u8981\u5bf9\u538b\u7f29\u7684\u56fe\u50cf\u4e8c\u8fdb\u5236\u6570\u636e\u8fdb\u884cHuffman\u89e3\u7801\u3001\u9006\u79bb\u6563\u4f59\u5f26\u53d8\u6362\uff08IDCT\uff09\u7b49\u590d\u6742\u8ba1\u7b97\uff0c\u5c5e\u4e8e\u5178\u578b\u7684CPU\u5bc6\u96c6\u578b\u4efb\u52a1\uff1b\u89e3\u7801\u5b8c\u6210\u540e\uff0c\u518d\u7531CPU\u6267\u884cResize\uff08\u5c3a\u5bf8\u7f29\u653e\uff09\u3001\u5f52\u4e00\u5316\u3001\u8272\u57df\u8f6c\u6362\u7b49\u540e\u7eed\u9884\u5904\u7406\u64cd\u4f5c\uff0c\u6700\u7ec8\u5c06\u5904\u7406\u540e\u7684\u56fe\u50cf\u5f20\u91cf\u901a\u8fc7\u6570\u636e\u62f7\u8d1d\u4f20\u8f93\u81f3GPU\u8fdb\u884c\u6a21\u578b\u8bad\u7ec3\u3002</p> <p>\u66f4\u4e3a\u5173\u952e\u7684\u662f\uff0cCPU\u7684\u67b6\u6784\u8bbe\u8ba1\u66f4\u9002\u5408\u4e32\u884c\u8ba1\u7b97\u548c\u903b\u8f91\u63a7\u5236\uff0c\u5176\u5e76\u884c\u8ba1\u7b97\u80fd\u529b\u8fdc\u4e0d\u53caGPU\uff0c\u800c\u56fe\u50cf\u9884\u5904\u7406\u4e2d\u7684\u89e3\u7801\u3001Resize\u7b49\u64cd\u4f5c\u672c\u8eab\u5177\u5907\u6781\u5f3a\u7684\u5e76\u884c\u6027\uff0c\u80fd\u591f\u901a\u8fc7\u591a\u7ebf\u7a0b\u6216\u591a\u6838\u5fc3\u5e76\u884c\u5904\u7406\u63d0\u5347\u6548\u7387\uff0c\u4f46\u4f20\u7edfPyTorch Dataset\u5373\u4fbf\u901a\u8fc7DataLoader\u7684num_workers\u53c2\u6570\u63d0\u5347CPU\u5e76\u884c\u5ea6\uff0c\u4e5f\u96be\u4ee5\u7a81\u7834CPU\u672c\u8eab\u7684\u7b97\u529b\u4e0a\u9650\u2014\u2014\u5c24\u5176\u662f\u5f53\u8bad\u7ec3\u6570\u636e\u96c6\u89c4\u6a21\u5e9e\u5927\uff08\u5982\u767e\u4e07\u7ea7\u4ee5\u4e0a\u56fe\u50cf\uff09\u3001\u5355\u5f20\u56fe\u50cf\u5206\u8fa8\u7387\u8f83\u9ad8\uff08\u59821080P\u53ca\u4ee5\u4e0a\uff09\u65f6\uff0cCPU\u7684\u9884\u5904\u7406\u901f\u5ea6\u4f1a\u4e25\u91cd\u6ede\u540e\u4e8eGPU\u7684\u8bad\u7ec3\u901f\u5ea6\uff0c\u5bfc\u81f4GPU\u9891\u7e41\u5904\u4e8e\u201c\u7b49\u5f85\u6570\u636e\u201d\u7684\u7a7a\u95f2\u72b6\u6001\uff0cGPU\u5229\u7528\u7387\u5927\u5e45\u4e0b\u964d\uff0c\u6700\u7ec8\u62d6\u7d2f\u6574\u4e2a\u8bad\u7ec3\u6d41\u7a0b\u7684\u6548\u7387\uff0c\u8fd9\u4e5f\u662f\u4e3a\u4f55\u6570\u636e\u52a0\u8f7d\u4f1a\u88ab\u79f0\u4e3a\u201c\u88ab\u5ffd\u89c6\u7684\u6027\u80fd\u6740\u624b\u201d\u7684\u6838\u5fc3\u539f\u56e0\u3002</p> <p>\u9488\u5bf9\u8fd9\u4e00\u6838\u5fc3\u75db\u70b9\uff0cNVIDIA\u63a8\u51fa\u4e86DALI\uff08Data Loading Library\uff09\uff0c\u4e00\u6b3e\u4e13\u4e3a\u6df1\u5ea6\u5b66\u4e60\u8bad\u7ec3\u4f18\u5316\u7684GPU\u52a0\u901f\u6570\u636e\u9884\u5904\u7406\u5e93\uff0c\u5176\u6838\u5fc3\u76ee\u6807\u5c31\u662f\u5c06\u539f\u672c\u4f9d\u8d56CPU\u7684\u56fe\u50cf\u89e3\u7801\u3001\u5c3a\u5bf8\u53d8\u6362\u7b49\u5bc6\u96c6\u578b\u9884\u5904\u7406\u64cd\u4f5c\uff0c\u8fc1\u79fb\u5230GPU\u4e0a\u5e76\u884c\u6267\u884c\uff0c\u6253\u7834\u6570\u636e\u52a0\u8f7d\u7684\u6027\u80fd\u74f6\u9888\uff0c\u8ba9GPU\u7684\u7b97\u529b\u5f97\u5230\u5145\u5206\u53d1\u6325\u3002</p> <p> \u56fe6-2\uff1a\u4f7f\u7528DALI\u4e0e\u4e0d\u4f7f\u7528DALI\u4e0b\u6570\u636e\u89e3\u7801\u4e0e\u53d8\u6362\u7684\u533a\u522b</p> <p>\u4ee3\u7801\u62c6\u89e3\uff1a\u57fa\u4e8e DALI \u7684\u9ad8\u6027\u80fd\u6d41\u6c34\u7ebf</p> <pre><code>import nvidia.dali.fn as fn\nimport nvidia.dali.types as types\nfrom nvidia.dali.pipeline import pipeline_def\n\n\n@pipeline_def(batch_size=256, num_threads=8, device_id=0)\ndef webdataset_gpu_pipeline(shard_id, num_shards):\n    \"\"\"\n    \u5b9a\u4e49\u7aef\u5230\u7aef GPU \u6570\u636e\u52a0\u8f7d\u6d41\u6c34\u7ebf\n    \u8f93\u5165: WebDataset (Tar) -&gt; \u8f93\u51fa: GPU Tensor\n    \"\"\"\n\n    # Step 1: \u8bfb\u53d6 WebDataset (CPU \u9636\u6bb5)\n    # \u4f7f\u7528 index_paths \u662f\u5fc5\u987b\u7684\uff0c\u5426\u5219\u521d\u59cb\u5316\u9636\u6bb5\u9700\u8981\u904d\u5386\u6574\u4e2a tar \u5305\uff0c\u8017\u65f6\u6781\u957f [5]\n    jpegs, captions = fn.readers.webdataset(\n        paths=[\"/data/shards/shard-{:05d}.tar\".format(i) for i in range(100)],\n        index_paths=[\"/data/indices/shard-{:05d}.idx\".format(i) for i in range(100)],\n        ext=[\"jpg\", \"txt\"],\n        shard_id=shard_id,\n        num_shards=num_shards,\n        random_shuffle=True,\n        initial_fill=10000,      # \u4e71\u5e8f\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u8d8a\u5927\u8d8a\u968f\u673a\uff0c\u4f46\u542f\u52a8\u8d8a\u6162\n        pad_last_batch=True,     # \u4fdd\u8bc1\u6240\u6709 Batch \u5927\u5c0f\u4e00\u81f4\n        name=\"Reader\",\n        read_ahead=True          # \u5f00\u542f\u9884\u8bfb\n    )\n\n    # Step 2: GPU \u89e3\u7801 (\u6838\u5fc3\u52a0\u901f\u70b9)\n    # device=\"mixed\" \u8868\u793a\u8f93\u5165\u5728 Host \u5185\u5b58\uff0c\u8f93\u51fa\u5728 Device \u663e\u5b58\n    # output_type=types.RGB \u81ea\u52a8\u5904\u7406\u8272\u5f69\u7a7a\u95f4\u8f6c\u6362\n    images = fn.decoders.image(\n        jpegs,\n        device=\"mixed\",\n        output_type=types.RGB,\n        # \u9488\u5bf9\u635f\u574f\u56fe\u7247\u7684\u5bb9\u9519\u5904\u7406\n        # \u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5343\u4e07\u4e0d\u8981\u56e0\u4e3a\u4e00\u5f20\u574f\u56fe\u5bfc\u81f4\u8bad\u7ec3\u5d29\u6e83\n    )\n\n    # Step 3: GPU \u53d8\u6362\u6d41\u6c34\u7ebf\n    # resize: \u4fdd\u6301\u957f\u5bbd\u6bd4\u7f29\u653e\n    images = fn.resize(\n        images,\n        resize_x=224,\n        resize_y=224,\n        interp_type=types.INTERP_LINEAR\n    )\n\n    # crop_mirror_normalize: \u968f\u673a\u88c1\u526a + \u7ffb\u8f6c + \u5f52\u4e00\u5316 (\u878d\u5408\u7b97\u5b50)\n    # \u8fd9\u4e00\u6b65\u5c06 uint8 \u8f6c\u4e3a float\uff0c\u5e76\u51cf\u5747\u503c\u9664\u65b9\u5dee\n    images = fn.crop_mirror_normalize(\n        images,\n        dtype=types.FLOAT,\n        output_layout=\"CHW\",\n        crop=(224, 224),\n        mean=[0.485 * 255, 0.456 * 255, 0.406 * 255],\n        std=[0.229 * 255, 0.224 * 255, 0.225 * 255],\n        mirror=fn.random.coin_flip(probability=0.5)\n    )\n\n    # \u6587\u672c\u6570\u636e\u901a\u5e38\u76f4\u63a5\u5728 CPU \u5904\u7406\u6216\u4f20\u9012\u7ed9 Tokenizer\n    # \u8fd9\u91cc\u6211\u4eec\u53ea\u8fd4\u56de\u539f\u59cb bytes\uff0c\u540e\u7eed\u7531 PyTorch \u5904\u7406\n    return images, captions\n\n# \u4f7f\u7528\u4e0e PyTorch \u96c6\u6210\u7684 DALIGenericIterator\nfrom nvidia.dali.plugin.pytorch import DALIGenericIterator\n\npipe = webdataset_gpu_pipeline(shard_id=0, num_shards=1)\npipe.build()\ndataloader = DALIGenericIterator(pipe, [\"images\", \"captions\"], reader_name=\"Reader\")\n\n# Benchmark \u6d4b\u8bd5\n# \u5728 A100 \u4e0a\uff0c\u6b64\u6d41\u6c34\u7ebf\u901a\u5e38\u80fd\u8fbe\u5230 3000-5000 FPS\uff0c\u662f CPU Loader \u7684 5-10 \u500d\n</code></pre>"},{"location":"part3/3_1_image_text_pairs/#63","title":"6.3 \u591a\u6a21\u6001\u6e05\u6d17\u6d41\u6c34\u7ebf","text":"<p>\u6d77\u91cf\u6570\u636e\u4f34\u968f\u7740\u6d77\u91cf\u566a\u58f0\u3002LAION-5B \u539f\u59cb\u6570\u636e\u4e2d\uff0c\u771f\u6b63\u9ad8\u8d28\u91cf\u7684\u6837\u672c\u53ef\u80fd\u4e0d\u8db3 10%\u3002\u6211\u4eec\u9700\u8981\u5efa\u7acb\u4e00\u4e2a\u591a\u7ea7\u6e05\u6d17\u6f0f\u6597\uff08Funnel\uff09\uff0c\u5728\u5c3d\u53ef\u80fd\u5c11\u5730\u635f\u5931\u6570\u636e\u591a\u6837\u6027\u7684\u524d\u63d0\u4e0b\uff0c\u63d0\u5347\u6570\u636e\u5bc6\u5ea6\u3002\u6240\u8c13\u7684\u201c\u6570\u636e\u6e05\u6d17\u201d\uff0c\u672c\u8d28\u4e0a\u662f\u5728\u505aData Diet\uff08\u6570\u636e\u8282\u98df\uff09\u2014\u2014\u7ed9\u6a21\u578b\u5403\u5f97\u5c11\u4f46\u5403\u5f97\u597d\u3002</p>"},{"location":"part3/3_1_image_text_pairs/#631-ray-data","title":"6.3.1 \u67b6\u6784\u8bbe\u8ba1\uff1aRay Data \u5206\u5e03\u5f0f\u6e05\u6d17","text":"<p>\u5728\u6570\u636e\u6e05\u6d17\u9636\u6bb5\uff0c\u6211\u4eec\u4e3a\u4f55\u9009\u62e9 Ray \u800c\u975e Spark\uff1f\u56e0\u4e3a\u6e05\u6d17\u8fc7\u7a0b\u4e0d\u518d\u662f\u7b80\u5355\u7684 ETL\uff0c\u800c\u662f\u5305\u542b\u4e86\u5927\u91cf\u7684\u6df1\u5ea6\u5b66\u4e60\u63a8\u7406\uff08Model Inference\uff09\u3002\u76f8\u6bd4\u4e8e Spark \u7684 MapReduce \u8303\u5f0f\uff0cRay \u63d0\u4f9b\u4e86\u66f4\u7075\u6d3b\u7684 Actor \u673a\u5236\uff0c\u5141\u8bb8\u6211\u4eec\u5e38\u9a7b GPU \u6a21\u578b\uff08\u5982 CLIP, Safety Checker\uff09\uff0c\u907f\u514d\u4e86\u6bcf\u6b21\u5904\u7406\u5c0f\u6279\u6570\u636e\u90fd\u8981\u91cd\u65b0\u52a0\u8f7d\u51e0\u4e2a GB \u6a21\u578b\u7684\u5de8\u5927\u5f00\u9500\u3002</p> <p>Ray Data \u9002\u5408\u5904\u7406\u8fd9\u79cd\u65e2\u6709 CPU \u5bc6\u96c6\u578b\uff08\u89e3\u538b\u3001\u54c8\u5e0c\u3001Regex\uff09\u53c8\u6709 GPU \u5bc6\u96c6\u578b\uff08CLIP Embedding \u63a8\u7406\uff09\u7684\u6df7\u5408\u8d1f\u8f7d\u3002\u4e0b\u9762\u7ed9\u51fa\u4e00\u4e2a\u5178\u578b\u7684\u4e09\u9636\u6bb5\u6d41\u6c34\u7ebf\u8bbe\u8ba1\uff1a * Stage 1 (CPU): \u5feb\u901f\u8fc7\u6ee4\u3002\u76f4\u63a5\u5254\u9664\u5206\u8fa8\u7387\u4e0d\u8db3\uff08&lt;256px\uff09\u3001\u6587\u672c\u8fc7\u77ed\u3001\u975e\u82f1\u8bed\uff08\u5982\u679c\u53ea\u7ec3\u82f1\u8bed\u6a21\u578b\uff09\u6216\u957f\u5bbd\u6bd4\u5f02\u5e38\u7684\u6837\u672c\u3002 * Stage 2 (GPU): \u6df1\u5ea6\u7279\u5f81\u63d0\u53d6\u3002\u5229\u7528 CLIP \u6a21\u578b\u751f\u6210 Embedding\uff0c\u5e76\u57fa\u4e8e Embedding \u8ba1\u7b97\u56fe\u6587\u76f8\u4f3c\u5ea6\u548c\u7f8e\u5b66\u8bc4\u5206\u3002 * Stage 3 (CPU/Mixed): \u903b\u8f91\u5224\u5b9a\u4e0e\u53bb\u91cd\u3002\u7efc\u5408\u5b89\u5168\u6027\uff08NSFW\uff09\u3001\u7f8e\u5b66\u5206\u6570\u53ca\u56fe\u6587\u76f8\u5173\u6027\u8fdb\u884c\u6700\u7ec8\u9608\u503c\u622a\u65ad\uff0c\u5e76\u8fdb\u884c\u8bed\u4e49\u53bb\u91cd\u3002</p> <p>\u6570\u636e\u6d41\u5411\u56fe (Data Flow)</p> <p> \u56fe6-3\uff1aRay Data\u5206\u5e03\u5f0f\u6e05\u6d17\u6570\u636e\u6d41\u5411\u56fe</p>"},{"location":"part3/3_1_image_text_pairs/#632","title":"6.3.2 \u6838\u5fc3\u7b97\u6cd5\u5b9e\u73b0","text":"<p>\u6e05\u6d17\u4e0d\u4ec5\u4ec5\u662f\u5220\u9664\uff0c\u66f4\u662f\u5bf9\u6570\u636e\u4ef7\u503c\u7684\u91cf\u5316\u3002\u6211\u4eec\u9700\u8981\u591a\u7ef4\u5ea6\u7684\u6307\u6807\u6765\u8861\u91cf\u4e00\u5f20\u56fe\u7247\u53ca\u5176\u5bf9\u5e94\u6587\u672c\u7684\u201c\u542b\u91d1\u91cf\u201d\u3002</p> <ol> <li> <p>\u7f8e\u5b66\u8bc4\u5206 (Aesthetics Scoring)</p> <ul> <li>\u539f\u7406\uff1a\u6570\u636e\u96c6\u4e2d\u5145\u65a5\u7740\u53d1\u7968\u3001\u622a\u56fe\u3001\u6a21\u7cca\u7684\u76d1\u63a7\u753b\u9762\uff0c\u8fd9\u4e9b\u5bf9\u751f\u6210\u7f8e\u89c2\u56fe\u7247\u6beb\u65e0\u5e2e\u52a9\u3002\u901a\u5e38\u4f7f\u7528 LAION-Aesthetics Predictor\u3002</li> <li>\u6280\u672f\u7ec6\u8282\uff1a\u8fd9\u662f\u4e00\u4e2a\u7b80\u5355\u7684 MLP\uff08\u591a\u5c42\u611f\u77e5\u673a\uff09\uff0c\u8f93\u5165\u662f CLIP Image Embedding\uff0c\u8f93\u51fa\u662f 1-10 \u7684\u5206\u6570\u3002\u8bad\u7ec3\u6570\u636e\u6765\u81ea AVA \u6570\u636e\u96c6\uff08\u5305\u542b\u4eba\u7c7b\u4e13\u4e1a\u6444\u5f71\u5e08\u6253\u5206\uff09\u3002</li> <li>\u5efa\u8bae\u9608\u503c\uff1a\u5bf9\u4e8e\u57fa\u7840\u9884\u8bad\u7ec3\uff0c\u4fdd\u7559 Score &gt; 4.5 \u7684\u6570\u636e\uff1b\u5bf9\u4e8e\u5fae\u8c03\u9ad8\u8d28\u91cf\u751f\u6210\u6a21\u578b\uff08SFT\u9636\u6bb5\uff09\uff0c\u5efa\u8bae Score &gt; 6.0\uff0c\u751a\u81f3 6.5\u3002</li> </ul> </li> <li> <p>\u56fe\u6587\u5bf9\u9f50\u8fc7\u6ee4 (Image-Text Alignment)</p> <ul> <li>\u539f\u7406\uff1a\u5f88\u591a Alt-text \u662f SEO \u5783\u573e\u8bcd\u5806\u780c\uff0c\u6216\u8005\u6587\u4ef6\u540d\uff08\"DSC_001.jpg\"\uff09\uff0c\u4e0e\u56fe\u7247\u5185\u5bb9\u65e0\u5173\u3002</li> <li>\u6280\u672f\u7ec6\u8282\uff1a\u8ba1\u7b97 CLIP Image Embedding \u548c Text Embedding \u7684\u4f59\u5f26\u76f8\u4f3c\u5ea6\uff08Dot Product\uff09\u3002</li> <li>\u5751\u70b9\uff1a\u4e0d\u540c\u7248\u672c\u7684 CLIP \u6a21\u578b\uff08\u5982 OpenAI ViT-L/14 vs OpenCLIP ViT-G/14\uff09\u7684\u5d4c\u5165\u7a7a\u95f4\u5206\u5e03\u4e0d\u540c\uff0c\u5206\u6570\u4e0d\u53ef\u76f4\u63a5\u6bd4\u8f83\u3002\u5fc5\u987b\u6839\u636e\u5177\u4f53\u6a21\u578b\u91cd\u65b0\u6821\u51c6\u9608\u503c\u3002\u901a\u5e38\u7684\u505a\u6cd5\u662f\u8ba1\u7b97\u6574\u4e2a\u6570\u636e\u96c6\u7684\u76f8\u4f3c\u5ea6\u5206\u5e03\uff0c\u7136\u540e\u4fdd\u7559 Top 50% \u6216 Top 70% \u7684\u6570\u636e\u3002</li> </ul> </li> <li> <p>\u5b89\u5168\u6027\u68c0\u6d4b (Safety &amp; Watermark)</p> <ul> <li>\u539f\u7406\uff1a\u5fc5\u987b\u5254\u9664\u8272\u60c5\u3001\u66b4\u529b\u4ee5\u53ca\u5e26\u6709\u660e\u663e\u54c1\u724c\u6c34\u5370\u7684\u56fe\u7247\u3002</li> <li>\u7b56\u7565\uff1a\u4f7f\u7528\u4e13\u95e8\u8bad\u7ec3\u7684\u5206\u7c7b\u5668\u5934\uff08\u4e5f\u662f\u57fa\u4e8e CLIP Embedding\uff09\u6765\u68c0\u6d4b NSFW \u548c\u6c34\u5370\u3002\u5bf9\u4e8e\u6c34\u5370\u68c0\u6d4b\uff0c\u5982\u679c\u76ee\u6807\u662f\u8bad\u7ec3\u751f\u6210\u6a21\u578b\uff08\u5982 SDXL\uff09\uff0c\u5fc5\u987b\u6781\u5176\u4e25\u683c\uff08Recall \u4f18\u5148\uff09\uff0c\u56e0\u4e3a\u751f\u6210\u6a21\u578b\u6781\u6613\u8fc7\u62df\u5408\u6c34\u5370\u7279\u5f81\uff1b\u5982\u679c\u76ee\u6807\u662f\u8bad\u7ec3\u7406\u89e3\u6a21\u578b\uff08\u5982 GPT-4V\uff09\uff0c\u53ef\u4ee5\u9002\u5f53\u653e\u5bbd\uff0c\u56e0\u4e3a\u7406\u89e3\u6a21\u578b\u9700\u8981\u8bc6\u522b\u201c\u56fe\u7247\u91cc\u6709\u6c34\u5370\u201d\u8fd9\u4e2a\u4e8b\u5b9e\u3002</li> </ul> </li> </ol> <p>\u4ee3\u7801\u5b9e\u73b0\uff1aRay Data \u6e05\u6d17\u7b97\u5b50</p> <pre><code>import ray\nimport torch\nimport open_clip\nimport numpy as np\nfrom PIL import Image\nimport io\n\n# \u5b9a\u4e49 Ray Actor \u7c7b\uff0c\u786e\u4fdd\u6a21\u578b\u53ea\u52a0\u8f7d\u4e00\u6b21\nclass QualityScorer:\n    def __init__(self):\n        self.device = \"cuda\" if torch.cuda.is_available() else \"cpu\"\n        # \u52a0\u8f7d CLIP \u6a21\u578b (ViT-B-32 \u901f\u5ea6\u5feb\uff0c\u9002\u5408\u6e05\u6d17)\n        self.model, _, self.preprocess = open_clip.create_model_and_transforms(\n            'ViT-B-32', pretrained='laion2b_s34b_b79k', device=self.device\n        )\n        # \u52a0\u8f7d\u7f8e\u5b66\u8bc4\u5206\u5934 (Linear Layer)\n        self.aesthetic_head = torch.nn.Linear(512, 1).to(self.device)\n        self.aesthetic_head.load_state_dict(torch.load(\"sac+logos+ava1-l14-linearMSE.pth\"))\n        self.aesthetic_head.eval()\n\n    def __call__(self, batch: dict) -&gt; dict:\n        \"\"\"\n        \u5904\u7406\u4e00\u4e2a batch \u7684\u6570\u636e\u3002Ray \u4f1a\u81ea\u52a8\u5c06\u6570\u636e\u5206\u7247\u4f20\u8f93\u7ed9 Actor\u3002\n        \"\"\"\n        images = []\n        valid_indices = []\n\n        # \u9884\u5904\u7406\u56fe\u7247 (CPU \u64cd\u4f5c)\n        for idx, img_bytes in enumerate(batch[\"jpg\"]):\n            try:\n                img = Image.open(io.BytesIO(img_bytes)).convert(\"RGB\")\n                img_tensor = self.preprocess(img)\n                images.append(img_tensor)\n                valid_indices.append(idx)\n            except Exception:\n                # \u8bb0\u5f55\u574f\u56fe\u65e5\u5fd7\uff0c\u4f46\u4e0d\u8981\u4e2d\u65ad\n                continue\n\n        if not images:\n            return {\"aesthetic_score\": [], \"clip_score\": []}\n\n        image_input = torch.stack(images).to(self.device)\n\n        with torch.no_grad():\n            # 1. \u63d0\u53d6\u7279\u5f81\n            image_features = self.model.encode_image(image_input)\n            image_features /= image_features.norm(dim=-1, keepdim=True)\n\n            # 2. \u8ba1\u7b97\u7f8e\u5b66\u5206\n            aesthetic_scores = self.aesthetic_head(image_features).squeeze().cpu().numpy()\n\n            # 3. \u8ba1\u7b97\u56fe\u6587\u5339\u914d\u5ea6 (\u5047\u8bbe batch \u4e2d\u6709 text \u5b57\u6bb5)\n            # text_tokens = self.tokenizer(batch[\"txt\"]).to(self.device)\n            # text_features = self.model.encode_text(text_tokens)\n            #... \u8ba1\u7b97 cosine similarity\n\n        # \u8fd4\u56de\u7ed3\u679c (\u9700\u6ce8\u610f\u4e0e\u539f\u59cb batch \u7d22\u5f15\u5bf9\u9f50)\n        return {\"aesthetic_score\": aesthetic_scores}\n\n# \u7f16\u6392 Ray \u6d41\u6c34\u7ebf\nray.init()\nds = ray.data.read_webdataset(\"s3://raw-bucket/{00000..00099}.tar\")\n\n# map_batches \u4f1a\u81ea\u52a8\u8c03\u5ea6 GPU \u8d44\u6e90\n# num_gpus=0.25 \u610f\u5473\u7740\u4e00\u5f20 GPU \u53ef\u4ee5\u5e76\u53d1\u8dd1 4 \u4e2a Actor\uff0c\u63d0\u9ad8\u541e\u5410\nscored_ds = ds.map_batches(\n    QualityScorer, \n    compute=ray.data.ActorPoolStrategy(size=8), \n    num_gpus=0.25, \n    batch_size=128\n)\n\n# \u6700\u7ec8\u8fc7\u6ee4\nfiltered_ds = scored_ds.filter(lambda row: row[\"aesthetic_score\"] &gt; 4.5)\nfiltered_ds.write_webdataset(\"s3://clean-bucket/\")\n</code></pre>"},{"location":"part3/3_1_image_text_pairs/#64-pitfalls-troubleshooting","title":"6.4 \u907f\u5751\u6307\u5357 (Pitfalls &amp; Troubleshooting)","text":"<p>\u5728\u6784\u5efa\u4ebf\u7ea7\u591a\u6a21\u6001\u6570\u636e\u96c6\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5de5\u7a0b\u56e2\u961f\u5f80\u5f80\u4f1a\u5728\u7ec6\u8282\u5904\u7ffb\u8f66\u3002\u4ee5\u4e0b\u662f\u51e0\u4e2a\u8840\u6cea\u6559\u8bad\u603b\u7ed3\uff1a</p> <ul> <li> <p>Parquet \u5143\u6570\u636e\u7206\u70b8\uff1a</p> <ul> <li>\u9519\u8bef\uff1a\u4e60\u60ef\u6027\u5730\u5728 pandas \u4e2d\u76f4\u63a5\u8bfb\u53d6\u5305\u542b 20 \u4ebf\u884c\u7684 Parquet \u6587\u4ef6\u3002</li> <li>\u540e\u679c\uff1a\u5185\u5b58\u6ea2\u51fa\uff08OOM\uff09\uff0c\u56e0\u4e3a pandas \u4f1a\u5c1d\u8bd5\u5c06\u6574\u4e2a\u7d22\u5f15\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u5373\u4f7f\u4f60\u53ea\u8bfb\u4e00\u5217\u3002</li> <li>\u4fee\u6b63\uff1a\u4f7f\u7528 Polars \u6216 PySpark \u7684 lazy evaluation \u6a21\u5f0f\uff1b\u6216\u8005\u4e25\u683c\u5c06 Parquet \u6587\u4ef6\u6309\u884c\u6570\uff08\u5982 100\u4e07\u884c\uff09\u62c6\u5206\u6210\u5c0f\u6587\u4ef6\uff0c\u907f\u514d\u5904\u7406\u5355\u4e2a\u5de8\u578b\u5143\u6570\u636e\u6587\u4ef6\u3002</li> </ul> </li> <li> <p>WebDataset \u7684 Shuffle \u4e0d\u8db3\uff1a</p> <ul> <li>\u9519\u8bef\uff1a\u6570\u636e\u4e0b\u8f7d\u65f6\u6309\u57df\u540d\u987a\u5e8f\u5199\u5165\uff0c\u8bad\u7ec3\u65f6\u4ec5\u4f9d\u8d56 DataLoader \u7684 buffer shuffle\uff08\u901a\u5e38 buffer \u53ea\u6709 1\u4e07\uff09\u3002</li> <li>\u540e\u679c\uff1a\u6a21\u578b\u8bad\u7ec3\u65f6\u4f1a\u5148\u8fde\u7eed\u770b 10 \u4e07\u5f20\u7535\u5546\u56fe\uff0c\u518d\u8fde\u7eed\u770b 10 \u4e07\u5f20\u98ce\u666f\u56fe\u3002\u5c0f buffer \u65e0\u6cd5\u6253\u6563\u8fd9\u79cd\u201c\u65f6\u57df\u76f8\u5173\u6027\u201d\uff0c\u5bfc\u81f4\u6a21\u578b\u8bad\u7ec3\u66f2\u7ebf\u5267\u70c8\u9707\u8361\uff0c\u751a\u81f3\u53d1\u6563\u3002</li> <li>\u4fee\u6b63\uff1a\u5728\u5199\u5165 WebDataset \u4e4b\u524d\uff0c\u5fc5\u987b\u5bf9 URL \u5217\u8868\u8fdb\u884c\u5168\u5c40\u968f\u673a\u6253\u6563\uff08Global Shuffle\uff09\u3002\u53ef\u4ee5\u4f7f\u7528 Spark \u7684 <code>orderBy(rand())</code> \u5b9e\u73b0\u3002</li> </ul> </li> <li> <p>\u8bef\u5220\u957f\u5c3e\u6570\u636e\uff1a</p> <ul> <li>\u9519\u8bef\uff1a\u4e3a\u4e86\u8ffd\u6c42\u6781\u81f4\u7684\u7f8e\u5b66\u5206\uff0c\u628a\u6240\u6709 Score &lt; 4.5 \u7684\u56fe\u7247\u90fd\u5220\u4e86\u3002</li> <li>\u540e\u679c\uff1a\u6a21\u578b\u53d8\u5f97\u201c\u504f\u79d1\u201d\uff0c\u53ea\u8ba4\u8bc6\u827a\u672f\u7167\u548c\u58c1\u7eb8\uff0c\u4e0d\u8ba4\u8bc6\u771f\u5b9e\u4e16\u754c\u7684\uff08\u53ef\u80fd\u6bd4\u8f83\u4e11\u7684\uff09\u7167\u7247\uff0c\u5982\u533b\u7597\u5f71\u50cf\u3001\u8857\u666f\u56fe\u3001\u624b\u5199\u7b14\u8bb0\u3002\u8fd9\u5927\u5927\u964d\u4f4e\u4e86\u6a21\u578b\u7684\u6cdb\u5316\u80fd\u529b\u3002</li> <li>\u4fee\u6b63\uff1a\u91c7\u7528\u5206\u5c42\u91c7\u6837\u7b56\u7565\u3002\u4fdd\u7559 5%-10% \u7684\u4f4e\u5206\u6570\u636e\u4f5c\u4e3a\u201c\u6b63\u5219\u5316\u201d\uff0c\u6216\u8005\u9488\u5bf9\u7279\u5b9a\u9886\u57df\uff08\u5982 OCR\u3001\u56fe\u8868\uff09\u5355\u72ec\u8bbe\u7acb\u767d\u540d\u5355\uff0c\u4e0d\u901a\u8fc7\u7f8e\u5b66\u8fc7\u6ee4\u5668\u3002</li> </ul> </li> <li> <p>\u91cd\u590d\u6570\u636e\u7684\u9690\u60a3 (Deduplication):</p> <ul> <li>\u9519\u8bef: \u5ffd\u89c6\u4e86\u4e92\u8054\u7f51\u4e0a\u5927\u91cf\u91cd\u590d\u56fe\u7247\uff08\u5982 Memes\u3001\u70ed\u95e8\u65b0\u95fb\u56fe\uff09\u3002</li> <li>\u540e\u679c: \u6a21\u578b\u8fc7\u62df\u5408\u7279\u5b9a\u6837\u672c\uff0c\u751a\u81f3\u5728\u751f\u6210\u65f6\u76f4\u63a5\u201c\u80cc\u8bf5\u201d\u51fa\u8bad\u7ec3\u96c6\u56fe\u7247\uff08Memorization\uff09\uff0c\u5bfc\u81f4\u4e25\u91cd\u7684\u7248\u6743\u98ce\u9669\u3002</li> <li>\u4fee\u6b63: \u5fc5\u987b\u5728\u6e05\u6d17\u6d41\u7a0b\u4e2d\u52a0\u5165\u8bed\u4e49\u53bb\u91cd\u3002\u8ba1\u7b97\u6240\u6709\u56fe\u7247\u7684 Embedding\uff0c\u4f7f\u7528 Faiss \u6216 MinHashLSH \u8fdb\u884c\u805a\u7c7b\uff0c\u5bf9\u76f8\u4f3c\u5ea6\u6781\u9ad8\u7684\u56fe\u7247\u7fa4\u7ec4\u53ea\u4fdd\u7559\u4e00\u5f20\u3002</li> </ul> </li> </ul>"},{"location":"part3/3_2_recaptioning/","title":"\u7b2c7\u7ae0\uff1a\u6570\u636e\u91cd\u63cf\u8ff0","text":""},{"location":"part3/3_2_recaptioning/#7-recaptioning","title":"\u7b2c7\u7ae0\uff1a\u6570\u636e\u91cd\u63cf\u8ff0 (Recaptioning)","text":""},{"location":"part3/3_2_recaptioning/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u4e92\u8054\u7f51\u4e0a\u7684\u539f\u59cb Alt-text\uff08\u66ff\u4ee3\u6587\u672c\uff09\uff0c\u672c\u8d28\u4e0a\u662f\u7f51\u9875\u5f00\u53d1\u8005\u4e3a\u641c\u7d22\u5f15\u64ce\u4f18\u5316\uff08SEO\uff09\u8bbe\u8ba1\u7684\u8f85\u52a9\u5185\u5bb9\uff0c\u5176\u6838\u5fc3\u76ee\u6807\u662f\u63d0\u5347\u7f51\u9875\u5728\u641c\u7d22\u7ed3\u679c\u4e2d\u7684\u6392\u540d\uff0c\u800c\u975e\u7cbe\u51c6\u3001\u5168\u9762\u5730\u63cf\u8ff0\u56fe\u50cf\u672c\u8eab\u7684\u89c6\u89c9\u5185\u5bb9\u2014\u2014\u8fd9\u5c31\u5bfc\u81f4\u5927\u91cf\u539f\u59cb Alt-text \u65e0\u6cd5\u6ee1\u8db3\u89c6\u89c9\u8bed\u8a00\u6a21\u578b\uff08VLM\uff09\u8bad\u7ec3\u5bf9\u201c\u89c6\u89c9-\u6587\u672c\u7cbe\u51c6\u5bf9\u9f50\u201d\u7684\u6838\u5fc3\u9700\u6c42\u3002\u672c\u7ae0\u5c06\u7cfb\u7edf\u4ecb\u7ecd\u5982\u4f55\u5229\u7528\u5f53\u524d\u4e3b\u6d41\u7684\u89c6\u89c9\u5927\u6a21\u578b\uff08Visual Language Model, VLM\uff09\u6784\u5efa\u4e00\u5957\u9ad8\u6548\u3001\u53ef\u6269\u5c55\u7684\u201c\u5408\u6210\u63cf\u8ff0\u5de5\u5382\u201d\uff0c\u5b9e\u73b0\u5927\u89c4\u6a21\u56fe\u50cf\u6570\u636e\u7684\u81ea\u52a8\u91cd\u6807\u6ce8\u3002\u6211\u4eec\u5c06\u6df1\u5165\u63a2\u8ba8 Prompt Engineering\uff08\u63d0\u793a\u5de5\u7a0b\uff09\u5728\u7cbe\u51c6\u63a7\u5236\u63cf\u8ff0\u9897\u7c92\u5ea6\uff08\u4ece\u7b80\u7565\u5230\u8be6\u5c3d\uff09\u4e2d\u7684\u5173\u952e\u4f5c\u7528\uff0c\u7834\u89e3\u4e0d\u540c\u4e0b\u6e38\u4efb\u52a1\u5bf9\u63cf\u8ff0\u7cbe\u5ea6\u7684\u5dee\u5f02\u5316\u9700\u6c42\uff0c\u5e76\u5f15\u5165\u5149\u5b66\u5b57\u7b26\u8bc6\u522b\uff08OCR\uff09\u6280\u672f\u4f5c\u4e3a\u8865\u5145\uff0c\u89e3\u51b3 VLM \u5bf9\u5bcc\u6587\u672c\u56fe\u50cf\uff08\u5982\u6587\u6863\u3001\u6d77\u62a5\u3001\u56fe\u8868\uff09\u4e2d\u6587\u5b57\u4fe1\u606f\u8bc6\u522b\u4e0d\u51c6\u7684\u75db\u70b9\uff0c\u8fdb\u4e00\u6b65\u589e\u5f3a\u6a21\u578b\u5bf9\u590d\u6742\u56fe\u50cf\u7684\u7406\u89e3\u80fd\u529b\u3002</p> <p>\u5b66\u4e60\u76ee\u6807\uff1a * \u6df1\u523b\u7406\u89e3 Alt-text \u7684\u201c\u4e09\u5b97\u7f6a\u201d\uff08\u4e0d\u76f8\u5173\u3001\u8fc7\u77ed\u3001\u89c6\u89c9\u7f3a\u5931\uff09\u7684\u672c\u8d28\u6210\u56e0\uff0c\u4ee5\u53ca\u8fd9\u7c7b\u4f4e\u8d28\u91cf\u63cf\u8ff0\u5bf9\u89c6\u89c9\u8bed\u8a00\u6a21\u578b\u3001\u751f\u6210\u5f0f\u89c6\u89c9\u6a21\u578b\u8bad\u7ec3\u7684\u5177\u4f53\u5371\u5bb3\uff08\u5982\u6a21\u578b\u5e7b\u89c9\u3001\u89c6\u89c9-\u6587\u672c\u5bf9\u9f50\u5931\u6548\u3001\u6cdb\u5316\u80fd\u529b\u4e0d\u8db3\u7b49\uff09\u3002 * \u638c\u63e1\u4f7f\u7528 vLLM\uff08\u9ad8\u6548\u5927\u6a21\u578b\u63a8\u7406\u5f15\u64ce\uff09\u90e8\u7f72 LLaVA\u3001CogVLM \u7b49\u4e3b\u6d41 VLM \u7684\u5b8c\u6574\u6d41\u7a0b\uff0c\u7406\u89e3\u9ad8\u541e\u5410\u91cf\u63a8\u7406\u7684\u6838\u5fc3\u539f\u7406\uff0c\u5b9e\u73b0\u5927\u89c4\u6a21\u56fe\u50cf\u6570\u636e\u7684\u5feb\u901f\u91cd\u6807\u6ce8\u3002 * \u80fd\u591f\u6839\u636e\u4e0d\u540c\u4e0b\u6e38\u4efb\u52a1\uff08\u5982 CLIP \u7c7b\u53cc\u5854\u6a21\u578b\u9884\u8bad\u7ec3\u3001Sora \u7c7b\u751f\u6210\u6a21\u578b\u8bad\u7ec3\uff09\u8bbe\u8ba1\u5206\u5c42 Prompt \u7b56\u7565\uff0c\u7075\u6d3b\u751f\u6210\u7b80\u7565\u6216\u8be6\u5c3d\u7684\u56fe\u50cf\u63cf\u8ff0\uff0c\u7cbe\u51c6\u5339\u914d\u4efb\u52a1\u9700\u6c42\u3002 * \u638c\u63e1 OCR \u6280\u672f\u7684\u6838\u5fc3\u5e94\u7528\u65b9\u6cd5\uff0c\u5b9e\u73b0 OCR \u8bc6\u522b\u7ed3\u679c\u4e0e VLM Prompt \u7684\u52a8\u6001\u878d\u5408\uff0c\u89e3\u51b3\u6587\u6863\u7c7b\u3001\u6d77\u62a5\u7c7b\u7b49\u5bcc\u6587\u672c\u56fe\u50cf\u63cf\u8ff0\u8d28\u91cf\u4f4e\u4e0b\u7684\u95ee\u9898\uff0c\u663e\u8457\u63d0\u5347\u8fd9\u7c7b\u56fe\u50cf\u7684\u63cf\u8ff0\u51c6\u786e\u6027\u548c\u4e30\u5bcc\u5ea6\u3002</p> <p>\u573a\u666f\u5f15\u5165\uff1a</p> <p>\u201c\u60f3\u8c61\u4f60\u6b63\u5728\u8bad\u7ec3\u4e00\u4e2a\u7c7b Sora \u7684\u6a21\u578b\u3002\u4f60\u7ed9\u6a21\u578b\u8f93\u5165\u4e86\u4e00\u5f20\u56fe\uff0c\u4e0a\u9762\u662f\u4e00\u53ea\u5728\u5915\u9633\u4e0b\u5954\u8dd1\u7684\u91d1\u6bdb\u72ac\uff0c\u80cc\u666f\u662f\u57c3\u83f2\u5c14\u94c1\u5854\u3002\u7136\u800c\uff0c\u539f\u59cb\u6570\u636e\u7684\u6807\u7b7e\u5374\u662f\u2018IMG_20240501.jpg\u2019\u6216\u8005\u2018Best dog food 50% off\u2019\u3002\u7528\u8fd9\u79cd\u6570\u636e\u8bad\u7ec3\uff0c\u6a21\u578b\u6c38\u8fdc\u5b66\u4e0d\u4f1a\u2018\u91d1\u6bdb\u72ac\u2019\u548c\u2018\u57c3\u83f2\u5c14\u94c1\u5854\u2019\u7684\u89c6\u89c9\u5bf9\u5e94\u5173\u7cfb\uff0c\u66f4\u522b\u63d0\u7406\u89e3\u2018\u5915\u9633\u4e0b\u7684\u5149\u5f71\u2019\u4e86\u3002\u6211\u4eec\u9700\u8981\u901a\u8fc7\u2018\u6570\u636e\u91cd\u63cf\u8ff0\u2019\uff0c\u8ba9 AI \u5145\u5f53\u6807\u6ce8\u5458\uff0c\u628a\u8fd9\u53ea\u72d7\u548c\u94c1\u5854\u51c6\u786e\u5730\u5199\u8fdb\u6587\u672c\u91cc\u3002\u201d</p>"},{"location":"part3/3_2_recaptioning/#71-alt-text","title":"7.1 Alt-text \u7684\u5c40\u9650\u6027\uff1a\u4e3a\u4ec0\u4e48\u539f\u59cb\u7f51\u9875\u63cf\u8ff0\u4e0d\u53ef\u7528\uff1f","text":"<p>\u5728\u89c6\u89c9\u8bed\u8a00\u6a21\u578b\u548c\u751f\u6210\u5f0f\u89c6\u89c9\u6a21\u578b\u7684\u8bad\u7ec3\u8fc7\u7a0b\u4e2d\uff0c\u6570\u636e\u8d28\u91cf\u76f4\u63a5\u51b3\u5b9a\u6a21\u578b\u7684\u4e0a\u9650\u2014\u2014\u800c\u539f\u59cb\u7f51\u9875\u4e2d\u7684 Alt-text\uff0c\u6070\u6070\u662f\u4f4e\u8d28\u91cf\u89c6\u89c9\u6587\u672c\u6570\u636e\u7684\u4e3b\u8981\u6765\u6e90\u4e4b\u4e00\u3002\u6839\u636e DeepMind\uff08\u300aScaling Language-Image Pre-training with Weakly Supervised Image-Text Data\u300b\uff09\u548c OpenAI\uff08\u300aTraining language models to follow instructions with human feedback\u300b\uff09\u7684\u5185\u90e8\u7814\u7a76\u62a5\u544a\uff0c\u76f4\u63a5\u4f7f\u7528\u4e92\u8054\u7f51\u722c\u53d6\u7684\u539f\u59cb Alt-text \u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\uff0c\u4f1a\u5bfc\u81f4\u6a21\u578b\u6027\u80fd\u63d0\u524d\u201c\u5c01\u9876\u201d\uff08\u5373\u65e0\u8bba\u5982\u4f55\u589e\u52a0\u6570\u636e\u91cf\uff0c\u6a21\u578b\u7684\u89c6\u89c9\u7406\u89e3\u3001\u6587\u672c\u751f\u6210\u7cbe\u5ea6\u90fd\u65e0\u6cd5\u8fdb\u4e00\u6b65\u63d0\u5347\uff09\uff0c\u751a\u81f3\u51fa\u73b0\u6027\u80fd\u9000\u5316\u3002\u5176\u6838\u5fc3\u95ee\u9898\u53ef\u6982\u62ec\u4e3a\u201c\u4e09\u5b97\u7f6a\u201d\uff0c\u5177\u4f53\u5206\u6790\u5982\u4e0b\uff1a</p> <ul> <li>\u566a\u58f0\u6781\u5927\uff1a\u5927\u91cf Alt-text \u4ec5\u5305\u542b\u6587\u4ef6\u540d\uff08\u5982\u201cIMG_20240501.jpg\u201d\uff09\u3001\u65e5\u671f\u3001\u65e0\u5173\u7684 SEO \u5173\u952e\u8bcd\u5806\u780c\uff08\u5982 \"buy cheap shoes nike adidas\"\u201cbest coffee shop near me\u201d\uff09\uff0c\u8fd9\u7c7b\u63cf\u8ff0\u4e0e\u56fe\u50cf\u89c6\u89c9\u5185\u5bb9\u5b8c\u5168\u65e0\u5173\u3002\u82e5\u5c06\u5176\u7528\u4e8e\u8bad\u7ec3\uff0c\u4e0d\u4ec5\u65e0\u6cd5\u5e2e\u52a9\u6a21\u578b\u5efa\u7acb\u89c6\u89c9-\u6587\u672c\u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u8fd8\u4f1a\u6c61\u67d3\u6a21\u578b\u7684\u8bed\u8a00\u80fd\u529b\uff0c\u5bfc\u81f4\u6a21\u578b\u751f\u6210\u65e0\u5173\u3001\u5197\u4f59\u7684\u6587\u672c\uff0c\u751a\u81f3\u4ea7\u751f\u4e25\u91cd\u7684\u5e7b\u89c9\u3002</li> <li>\u89c6\u89c9\u7f3a\u5931\uff1aAlt-text \u7684\u8bbe\u8ba1\u521d\u8877\u591a\u662f\u8f85\u52a9\u7f51\u9875\u529f\u80fd\u5b9e\u73b0\uff0c\u800c\u975e\u63cf\u8ff0\u89c6\u89c9\u5185\u5bb9\u2014\u2014\u5b83\u5f80\u5f80\u53ea\u63cf\u8ff0\u56fe\u7247\u7684\u529f\u80fd\uff08\u5982\u201c\u70b9\u51fb\u8d2d\u4e70\u6309\u94ae\u201d\u201c\u67e5\u770b\u66f4\u591a\u8be6\u60c5\u201d\uff09\u6216\u5546\u4e1a\u5c5e\u6027\uff08\u5982\u201c\u7ea2\u8272 XL \u7801\u201d\u201c\u9650\u65f6\u6298\u6263\u201d\uff09\uff0c\u5374\u5b8c\u5168\u5ffd\u7565\u56fe\u50cf\u672c\u8eab\u7684\u89c6\u89c9\u7ec6\u8282\uff08\u5982\u7269\u4f53\u7684\u5f62\u6001\u3001\u989c\u8272\u3001\u7eb9\u7406\u3001\u7a7a\u95f4\u5173\u7cfb\u3001\u5149\u5f71\u6548\u679c\u7b49\uff09\u3002\u4f8b\u5982\uff0c\u4e00\u5f20\u5c55\u793a\u201c\u4e00\u4ef6\u7ea2\u8272\u7684\u7eaf\u68c9 T \u6064\uff0c\u80f8\u53e3\u5370\u7740\u767d\u8272\u7684\u590d\u53e4 Logo\uff0c\u5e73\u94fa\u5728\u6728\u8d28\u684c\u9762\u4e0a\u201d\u7684\u56fe\u7247\uff0c\u5176 Alt-text \u53ef\u80fd\u4ec5\u4e3a\u201c\u7ea2\u8272 T \u6064 \u4fc3\u9500\u201d\uff0c\u8fd9\u79cd\u63cf\u8ff0\u65e0\u6cd5\u8ba9\u6a21\u578b\u5b66\u4e60\u5230\u4efb\u4f55\u89c6\u89c9\u7279\u5f81\u3002</li> <li>\u957f\u5ea6\u8fc7\u77ed\uff1a\u6839\u636e Common Crawl\uff08\u5168\u7403\u6700\u5927\u7684\u7f51\u9875\u722c\u53d6\u6570\u636e\u96c6\uff09\u7684\u7edf\u8ba1\u6570\u636e\uff0c\u8d85\u8fc7 50% \u7684 Alt-text \u957f\u5ea6\u5c0f\u4e8e 5 \u4e2a\u5355\u8bcd\uff0c30% \u751a\u81f3\u4e0d\u8db3 3 \u4e2a\u5355\u8bcd\u3002\u8fd9\u79cd\u6781\u77ed\u7684\u63cf\u8ff0\u65e0\u6cd5\u627f\u8f7d\u590d\u6742\u7684\u89c6\u89c9\u903b\u8f91\u3001\u7a7a\u95f4\u5173\u7cfb\u548c\u7ec6\u8282\u4fe1\u606f\uff0c\u4f8b\u5982\u65e0\u6cd5\u63cf\u8ff0\u201c\u4e00\u53ea\u91d1\u6bdb\u72ac\u8db4\u5728\u8349\u5730\u4e0a\uff0c\u524d\u722a\u642d\u5728\u4e00\u4e2a\u7ea2\u8272\u76ae\u7403\u4e0a\uff0c\u80cc\u666f\u662f\u5f00\u6ee1\u91ce\u82b1\u7684\u5c71\u5761\u201d\u8fd9\u7c7b\u5305\u542b\u591a\u4e2a\u7269\u4f53\u3001\u573a\u666f\u548c\u4e92\u52a8\u5173\u7cfb\u7684\u56fe\u50cf\u3002</li> </ul> <p>\u91cd\u63cf\u8ff0\u7684\u4ef7\u503c\uff1a\u6570\u636e\u91cd\u63cf\u8ff0\uff08Recaptioning\uff09\u7684\u6838\u5fc3\u4ef7\u503c\uff0c\u5c31\u662f\u901a\u8fc7 AI \u81ea\u52a8\u751f\u6210\u201c\u89c6\u89c9-\u6587\u672c\u7cbe\u51c6\u5bf9\u9f50\u201d\u7684\u9ad8\u8d28\u91cf\u63cf\u8ff0\uff0c\u66ff\u4ee3\u4f4e\u8d28\u91cf\u7684\u539f\u59cb Alt-text\uff0c\u6253\u7834\u6a21\u578b\u6027\u80fd\u7684\u4e0a\u9650\u3002\u8fd9\u4e00\u70b9\u5df2\u88ab\u4e1a\u754c\u9876\u7ea7\u7814\u7a76\u8bc1\u5b9e\u2014\u2014OpenAI \u5728 DALL-E 3 \u7684\u8bba\u6587\uff08\u300aImproving Image Generation with Better Captions\u300b\uff09\u4e2d\u660e\u786e\u6307\u51fa\uff0c\u4f7f\u7528\u9ad8\u8fbe 95% \u7684\u5408\u6210\u957f\u6587\u672c\uff08Synthetic Captions\uff0c\u5373\u901a\u8fc7 VLM \u751f\u6210\u7684\u91cd\u63cf\u8ff0\u6587\u672c\uff09\u8fdb\u884c\u8bad\u7ec3\uff0c\u662f\u5176\u6307\u4ee4\u9075\u5faa\u80fd\u529b\u3001\u89c6\u89c9\u8fd8\u539f\u7cbe\u5ea6\u5927\u5e45\u8d85\u8d8a Stable Diffusion XL\uff08SDXL\uff09\u7684\u6838\u5fc3\u539f\u56e0\u4e4b\u4e00\u3002\u5408\u6210\u957f\u6587\u672c\u80fd\u591f\u7cbe\u51c6\u6355\u6349\u56fe\u50cf\u7684\u89c6\u89c9\u7ec6\u8282\u3001\u903b\u8f91\u5173\u7cfb\u548c\u573a\u666f\u6c1b\u56f4\uff0c\u8ba9\u6a21\u578b\u771f\u6b63\u5b66\u4f1a\u201c\u770b\u5230\u4ec0\u4e48\uff0c\u5c31\u63cf\u8ff0\u4ec0\u4e48\u201d\uff0c\u8fdb\u800c\u63d0\u5347\u540e\u7eed\u7684\u751f\u6210\u3001\u8bc6\u522b\u3001\u7406\u89e3\u80fd\u529b\u3002</p>"},{"location":"part3/3_2_recaptioning/#72-vlm","title":"7.2 \u5408\u6210\u63cf\u8ff0\u5de5\u5382\uff1a\u5229\u7528 VLM \u91cd\u751f\u6570\u636e","text":"<p>\u8981\u5b9e\u73b0\u5927\u89c4\u6a21\u56fe\u50cf\u6570\u636e\u7684\u91cd\u63cf\u8ff0\uff0c\u5355\u9760\u4eba\u5de5\u6807\u6ce8\u4e0d\u4ec5\u6210\u672c\u6781\u9ad8\uff08\u6bcf\u6807\u6ce8\u4e00\u5f20\u56fe\u50cf\u9700\u6570\u5206\u949f\uff0c\u5927\u89c4\u6a21\u6570\u636e\u96c6\u52a8\u8f84\u6570\u767e\u4e07\u3001\u6570\u5341\u4ebf\u5f20\u56fe\u50cf\uff09\uff0c\u8fd8\u5b58\u5728\u6807\u6ce8\u6807\u51c6\u4e0d\u7edf\u4e00\u3001\u6548\u7387\u4f4e\u4e0b\u7684\u95ee\u9898\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u5efa\u7acb\u4e00\u4e2a\u7531 VLM \u9a71\u52a8\u7684\u201c\u5408\u6210\u63cf\u8ff0\u5de5\u5382\u201d\u2014\u2014\u4ee5\u539f\u59cb\u56fe\u50cf\u4e3a\u8f93\u5165\uff0c\u4ee5\u9ad8\u8d28\u91cf\u3001\u6807\u51c6\u5316\u7684\u6587\u672c\u63cf\u8ff0\u4e3a\u8f93\u51fa\uff0c\u901a\u8fc7\u81ea\u52a8\u5316\u3001\u6279\u91cf\u5316\u7684\u65b9\u5f0f\u5b8c\u6210\u6570\u636e\u91cd\u6807\u6ce8\uff0c\u5b9e\u73b0\u6570\u636e\u4ef7\u503c\u7684\u201c\u91cd\u751f\u201d\u3002</p> <p>\u8fd9\u4e2a\u201c\u5de5\u5382\u201d\u7684\u6838\u5fc3\u903b\u8f91\u7684\u662f\uff1a\u5c06\u539f\u59cb\u56fe\u50cf\u8f93\u5165\u5230\u4f18\u5316\u540e\u7684 VLM \u4e2d\uff0c\u901a\u8fc7\u7cbe\u5fc3\u8bbe\u8ba1\u7684 Prompt \u63a7\u5236\u63cf\u8ff0\u7684\u9897\u7c92\u5ea6\u548c\u98ce\u683c\uff0c\u518d\u901a\u8fc7\u9ad8\u6548\u7684\u63a8\u7406\u5f15\u64ce\u63d0\u5347\u5904\u7406\u541e\u5410\u91cf\uff0c\u6700\u7ec8\u8f93\u51fa\u7b26\u5408\u4e0b\u6e38\u4efb\u52a1\u9700\u6c42\u7684\u9ad8\u8d28\u91cf\u63cf\u8ff0\u3002\u6574\u4e2a\u6d41\u7a0b\u53ef\u5206\u4e3a\u201c\u6a21\u578b\u9009\u578b\u4e0e\u67b6\u6784\u8bbe\u8ba1\u201d\u201cPrompt \u7b56\u7565\u4f18\u5316\u201d\u201c\u5de5\u7a0b\u5316\u90e8\u7f72\u201d\u4e09\u4e2a\u6838\u5fc3\u73af\u8282\u3002</p>"},{"location":"part3/3_2_recaptioning/#721","title":"7.2.1 \u6a21\u578b\u9009\u578b\u4e0e\u67b6\u6784","text":"<p>VLM \u7684\u67b6\u6784\u76f4\u63a5\u51b3\u5b9a\u4e86\u63cf\u8ff0\u7684\u8d28\u91cf\u3001\u901f\u5ea6\u548c\u9002\u7528\u573a\u666f\u3002\u76ee\u524d\u4e3b\u6d41\u7684 VLM \u67b6\u6784\u4e3b\u8981\u5206\u4e3a\u4e09\u7c7b\uff0c\u5404\u7c7b\u67b6\u6784\u7684\u4ee3\u8868\u6a21\u578b\u3001\u4f18\u52a3\u5bf9\u6bd4\u53ca\u63a8\u8350\u573a\u666f\u5982\u4e0b\u8868\u6240\u793a\uff0c\u53ef\u6839\u636e\u4e0b\u6e38\u4efb\u52a1\u7684\u9700\u6c42\uff08\u5982\u63cf\u8ff0\u7cbe\u5ea6\u3001\u5904\u7406\u901f\u5ea6\u3001\u6570\u636e\u7c7b\u578b\uff09\u7075\u6d3b\u9009\u578b\uff1a</p> \u6a21\u578b\u67b6\u6784 \u4ee3\u8868\u6a21\u578b \u4f18\u52bf \u52a3\u52bf \u63a8\u8350\u573a\u666f Q-Former\u8fde\u63a5 BLIP-2, InstructBLIP \u53c2\u6570\u91cf\u5c0f\uff08\u901a\u5e38\u4e3a\u6570\u5341\u4ebf\u53c2\u6570\uff0c\u8fdc\u4f4e\u4e8e\u5927\u8bed\u8a00\u6a21\u578b\uff09\uff0c\u63a8\u7406\u901f\u5ea6\u5feb\uff08\u5355\u5f20\u56fe\u50cf\u63a8\u7406\u8017\u65f6\u53ef\u4f4e\u81f3\u51e0\u5341\u6beb\u79d2\uff09\uff0c\u8bad\u7ec3\u548c\u90e8\u7f72\u6210\u672c\u4f4e\uff0c\u4e0d\u6613\u4ea7\u751f\u6587\u672c\u5e7b\u89c9\uff08\u63cf\u8ff0\u5185\u5bb9\u4e0e\u56fe\u50cf\u7684\u8d34\u5408\u5ea6\u8f83\u9ad8\uff09 \u63cf\u8ff0\u957f\u5ea6\u8f83\u77ed\uff0c\u7ec6\u8282\u6355\u6349\u80fd\u529b\u4e00\u822c\uff0c\u5bb9\u6613\u51fa\u73b0\u201c\u590d\u8bfb\u5f0f\u63cf\u8ff0\u201d\uff08\u91cd\u590d\u63d0\u53ca\u5c11\u91cf\u6838\u5fc3\u7269\u4f53\uff0c\u7f3a\u4e4f\u7ec6\u8282\u5ef6\u4f38\uff09\uff0c\u5bf9\u590d\u6742\u573a\u666f\u7684\u7406\u89e3\u80fd\u529b\u6709\u9650 \u5feb\u901f\u521d\u7b5b\u5927\u89c4\u6a21\u56fe\u50cf\uff08\u5982\u5148\u5bf9\u6570\u5341\u4ebf\u5f20\u56fe\u50cf\u8fdb\u884c\u7c97\u7565\u91cd\u63cf\u8ff0\uff0c\u7b5b\u9009\u51fa\u6709\u4ef7\u503c\u7684\u6570\u636e\uff09\uff0c\u6216\u751f\u6210\u7b80\u77ed\u7684 Alt-text \u66ff\u4ee3\u54c1\uff08\u9002\u7528\u4e8e\u5bf9\u63cf\u8ff0\u957f\u5ea6\u6709\u4e25\u683c\u9650\u5236\u7684\u573a\u666f\uff09 MLP\u6295\u5f71 + LLM LLaVA-1.6 / NeXT \u63cf\u8ff0\u6781\u5176\u8be6\u5c3d\uff0c\u80fd\u591f\u6355\u6349\u56fe\u50cf\u4e2d\u7684\u7ec6\u5fae\u7ec6\u8282\uff08\u5982\u5149\u5f71\u3001\u7eb9\u7406\u3001\u7269\u4f53\u4e92\u52a8\u5173\u7cfb\uff09\uff0c\u6307\u4ee4\u9075\u5faa\u80fd\u529b\u5f3a\uff08\u80fd\u7cbe\u51c6\u54cd\u5e94 Prompt \u4e2d\u7684\u8981\u6c42\uff0c\u5982\u201c\u6309\u573a\u666f\u987a\u5e8f\u63cf\u8ff0\u201d\u201c\u7a81\u51fa\u6838\u5fc3\u7269\u4f53\u201d\uff09\uff0c\u652f\u6301\u591a\u8f6e\u5bf9\u8bdd\uff08\u53ef\u901a\u8fc7\u591a\u8f6e Prompt \u4f18\u5316\u63cf\u8ff0\u8d28\u91cf\uff09 \u903b\u8f91\u8ba1\u7b97\u91cf\u5927\uff08\u9700\u4f9d\u8d56 7B \u53ca\u4ee5\u4e0a\u53c2\u6570\u91cf\u7684\u5927\u8bed\u8a00\u6a21\u578b\uff0c\u5982 LLaMA 2 7B/13B\uff09\uff0c\u63a8\u7406\u901f\u5ea6\u76f8\u5bf9\u8f83\u6162\uff0c\u82e5\u4e0d\u52a0 Prompt \u7ea6\u675f\u5bb9\u6613\u51fa\u73b0\u5570\u55e6\u3001\u5197\u4f59\u7684\u63cf\u8ff0 \u4e3b\u529b\u6a21\u578b\uff0c\u9002\u7528\u4e8e\u751f\u6210\u9ad8\u8d28\u91cf\u3001\u957f\u6587\u672c\u7684 Dense Caption\uff08\u5bc6\u96c6\u63cf\u8ff0\uff09\uff0c\u5982\u8bad\u7ec3 Sora \u7c7b\u751f\u6210\u6a21\u578b\u3001SD3 \u7b49\u56fe\u50cf\u751f\u6210\u6a21\u578b\uff0c\u9700\u8981\u7cbe\u51c6\u3001\u8be6\u5c3d\u7684\u89c6\u89c9-\u6587\u672c\u5bf9\u9f50\u6570\u636e\u7684\u573a\u666f \u89c6\u89c9\u4f18\u5148\u67b6\u6784 CogVLM, Qwen-VL \u89c6\u89c9\u5206\u8fa8\u7387\u9ad8\uff08\u652f\u6301\u9ad8\u6e05\u56fe\u50cf\u8f93\u5165\uff0c\u90e8\u5206\u6a21\u578b\u53ef\u652f\u6301 4K \u56fe\u50cf\uff09\uff0c\u64c5\u957f\u7ec6\u7c92\u5ea6\u7269\u4f53\u8bc6\u522b\uff0c\u5c24\u5176\u5bf9\u5bcc\u6587\u672c\u56fe\u50cf\uff08\u5982\u6587\u6863\u3001\u56fe\u8868\u3001UI \u622a\u56fe\uff09\u4e2d\u7684\u6587\u5b57\u3001\u5c0f\u90e8\u4ef6\uff08\u5982\u6309\u94ae\u3001\u8f93\u5165\u6846\uff09\u8bc6\u522b\u7cbe\u5ea6\u6781\u9ad8\uff0c\u80fd\u591f\u7406\u89e3\u6587\u672c\u4e0e\u89c6\u89c9\u5143\u7d20\u7684\u5173\u8054 \u663e\u5b58\u5360\u7528\u8f83\u9ad8\uff08\u90e8\u7f72 7B \u53c2\u6570\u91cf\u6a21\u578b\u9700\u81f3\u5c11 24GB \u663e\u5b58\uff09\uff0c\u67b6\u6784\u975e\u6807\u51c6\uff08\u4e0d\u540c\u6a21\u578b\u7684\u90e8\u7f72\u65b9\u5f0f\u5dee\u5f02\u8f83\u5927\uff09\uff0c\u90e8\u7f72\u6d41\u7a0b\u7a0d\u7e41\u7410\uff0c\u63a8\u7406\u901f\u5ea6\u4e2d\u7b49 \u4e13\u95e8\u5904\u7406\u6587\u6863\u3001\u56fe\u8868\u3001UI \u622a\u56fe\u3001\u6d77\u62a5\u7b49\u5bcc\u6587\u672c\u6570\u636e\uff0c\u5982\u8bad\u7ec3\u80fd\u591f\u751f\u6210\u6587\u6863\u56fe\u50cf\u3001UI \u754c\u9762\u7684\u6a21\u578b\uff0c\u6216\u9700\u8981\u7cbe\u51c6\u8bc6\u522b\u56fe\u50cf\u4e2d\u6587\u5b57\u4fe1\u606f\u7684\u573a\u666f <p>\u8865\u5145\u8bf4\u660e\uff1a\u4e09\u7c7b\u67b6\u6784\u7684\u6838\u5fc3\u5dee\u5f02\u5728\u4e8e\u201c\u89c6\u89c9\u6a21\u5757\u4e0e\u8bed\u8a00\u6a21\u5757\u7684\u8fde\u63a5\u65b9\u5f0f\u201d\uff1aQ-Former \u67b6\u6784\u901a\u8fc7\u4e13\u95e8\u7684 Q-Former \u6a21\u5757\u5c06\u89c6\u89c9\u7279\u5f81\u8f6c\u6362\u4e3a\u8bed\u8a00\u53ef\u7406\u89e3\u7684\u5411\u91cf\uff0c\u518d\u8f93\u5165\u5230\u8f7b\u91cf\u8bed\u8a00\u6a21\u578b\uff1bMLP \u6295\u5f71\u67b6\u6784\u901a\u8fc7\u591a\u5c42\u611f\u77e5\u673a\uff08MLP\uff09\u5c06\u89c6\u89c9\u7279\u5f81\u6295\u5f71\u5230\u8bed\u8a00\u6a21\u578b\u7684\u5d4c\u5165\u7a7a\u95f4\uff0c\u4e0e\u5927\u8bed\u8a00\u6a21\u578b\u6df1\u5ea6\u878d\u5408\uff1b\u89c6\u89c9\u4f18\u5148\u67b6\u6784\u5219\u5f3a\u5316\u4e86\u89c6\u89c9\u6a21\u5757\u7684\u5206\u8fa8\u7387\u548c\u8bc6\u522b\u80fd\u529b\uff0c\u5f31\u5316\u4e86\u8bed\u8a00\u6a21\u5757\u7684\u5197\u4f59\u8ba1\u7b97\uff0c\u66f4\u4fa7\u91cd\u201c\u89c6\u89c9\u7406\u89e3\u4f18\u5148\u201d\u3002</p>"},{"location":"part3/3_2_recaptioning/#722-prompt","title":"7.2.2 Prompt \u7b56\u7565\uff1a\u63a7\u5236\u9897\u7c92\u5ea6","text":"<p>Prompt Engineering \u662f\u201c\u5408\u6210\u63cf\u8ff0\u5de5\u5382\u201d\u7684\u201c\u6838\u5fc3\u63a7\u5236\u5668\u201d\u2014\u2014\u540c\u4e00\u4e2a VLM\uff0c\u5728\u4e0d\u540c Prompt \u7684\u5f15\u5bfc\u4e0b\uff0c\u4f1a\u751f\u6210\u622a\u7136\u4e0d\u540c\u7684\u6570\u636e\u5206\u5e03\uff08\u63cf\u8ff0\u957f\u5ea6\u3001\u7ec6\u8282\u4e30\u5bcc\u5ea6\u3001\u98ce\u683c\u7b49\uff09\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u6839\u636e\u4e0b\u6e38\u4efb\u52a1\u7684\u5177\u4f53\u9700\u6c42\uff0c\u8bbe\u8ba1\u5206\u5c42 Prompt \u7b56\u7565\uff0c\u7cbe\u51c6\u63a7\u5236\u63cf\u8ff0\u7684\u9897\u7c92\u5ea6\uff0c\u8ba9\u751f\u6210\u7684\u63cf\u8ff0\u80fd\u591f\u5b8c\u7f8e\u5339\u914d\u4efb\u52a1\u9700\u6c42\u3002</p> <p>\u6838\u5fc3\u539f\u5219\uff1aPrompt \u7684\u8bbe\u8ba1\u9700\u660e\u786e\u201c\u4efb\u52a1\u6307\u4ee4\u201d\u201c\u63cf\u8ff0\u8303\u56f4\u201d\u201c\u9897\u7c92\u5ea6\u8981\u6c42\u201d\uff0c\u907f\u514d\u6a21\u7cca\u8868\u8ff0\uff08\u5982\u4ec5\u7528\u201c\u63cf\u8ff0\u8fd9\u5f20\u56fe\u201d\u4f1a\u5bfc\u81f4\u6a21\u578b\u8f93\u51fa\u4e0d\u7a33\u5b9a\uff09\u3002\u540c\u65f6\uff0c\u53ef\u901a\u8fc7\u52a0\u5165\u201c\u7ea6\u675f\u6761\u4ef6\u201d\uff08\u5982\u201c\u4e0d\u8d85\u8fc7 20 \u4e2a\u5355\u8bcd\u201d\u201c\u7a81\u51fa\u6838\u5fc3\u7269\u4f53\u548c\u80cc\u666f\u201d\uff09\u8fdb\u4e00\u6b65\u4f18\u5316\u8f93\u51fa\u8d28\u91cf\u3002</p> <p> \u56fe7-1\uff1a\u7b80\u7565\u4e0e\u8be6\u7ec6\u7684Prompt\u7b56\u7565</p> <p>\u56fe 7-1 \u76f4\u89c2\u5bf9\u6bd4\u4e86\u4e24\u79cd\u6838\u5fc3 Prompt \u7b56\u7565\u7684\u8f93\u51fa\u5dee\u5f02\u2014\u2014\u7b80\u7565 Prompt \u751f\u6210\u7684\u63cf\u8ff0\u7b80\u6d01\u7cbe\u70bc\uff0c\u4ec5\u5305\u542b\u6838\u5fc3\u7269\u4f53\u548c\u573a\u666f\uff1b\u8be6\u7ec6 Prompt \u751f\u6210\u7684\u63cf\u8ff0\u5219\u5305\u542b\u4e30\u5bcc\u7684\u7ec6\u8282\uff0c\u6db5\u76d6\u7269\u4f53\u5f62\u6001\u3001\u5149\u5f71\u3001\u989c\u8272\u3001\u7a7a\u95f4\u5173\u7cfb\u7b49\uff0c\u4e24\u79cd\u7b56\u7565\u5206\u522b\u9002\u914d\u4e0d\u540c\u7684\u4e0b\u6e38\u4efb\u52a1\u3002</p> <p>\u4ee5\u4e0b\u662f\u4e24\u79cd\u6700\u5e38\u7528\u7684\u5206\u5c42 Prompt \u7b56\u7565\uff0c\u53ef\u6839\u636e\u5b9e\u9645\u9700\u6c42\u7075\u6d3b\u8c03\u6574\uff0c\u4e5f\u53ef\u5728\u6b64\u57fa\u7840\u4e0a\u8bbe\u8ba1\u4e2d\u7b49\u9897\u7c92\u5ea6\u7684 Prompt \u7b56\u7565\uff1a</p> <p>\u7b56\u7565\u4e00\uff1a\u7b80\u7565\u63cf\u8ff0 (Brief Caption) * Prompt: \"Describe this image concisely in one sentence.\"\uff08\u7b80\u6d01\u5730\u7528\u4e00\u53e5\u8bdd\u63cf\u8ff0\u8fd9\u5f20\u56fe\u50cf\u3002\uff09   \u8865\u5145\u4f18\u5316 Prompt\uff08\u589e\u5f3a\u7a33\u5b9a\u6027\uff09\uff1a\"Describe this image concisely in one sentence, focusing only on the main subject and key background, no redundant details.\"\uff08\u7b80\u6d01\u5730\u7528\u4e00\u53e5\u8bdd\u63cf\u8ff0\u8fd9\u5f20\u56fe\u50cf\uff0c\u4ec5\u5173\u6ce8\u6838\u5fc3\u7269\u4f53\u548c\u5173\u952e\u80cc\u666f\uff0c\u65e0\u5197\u4f59\u7ec6\u8282\u3002\uff09 * \u76ee\u7684: \u9002\u914d CLIP \u7b49\u53cc\u5854\u6a21\u578b\uff08\u89c6\u89c9-\u6587\u672c\u53cc\u5854\u67b6\u6784\uff09\u7684 Context Length \u9650\u5236\u2014\u2014\u8fd9\u7c7b\u6a21\u578b\u7684\u6587\u672c\u8f93\u5165\u957f\u5ea6\u901a\u5e38\u88ab\u9650\u5236\u5728 77 \u4e2a tokens \u4ee5\u5185\uff0c\u8fc7\u957f\u7684\u63cf\u8ff0\u4f1a\u88ab\u622a\u65ad\uff0c\u5bfc\u81f4\u6a21\u578b\u65e0\u6cd5\u6b63\u5e38\u5b66\u4e60\u3002\u540c\u65f6\uff0c\u4e5f\u9002\u7528\u4e8e\u5bf9\u63cf\u8ff0\u957f\u5ea6\u6709\u4e25\u683c\u8981\u6c42\u7684\u573a\u666f\uff08\u5982\u56fe\u50cf\u68c0\u7d22\u3001\u5feb\u901f\u6807\u6ce8\uff09\u3002 * \u9884\u671f\u8f93\u51fa: \"A golden retriever running on grass near the Eiffel Tower.\"\uff08\u4e00\u53ea\u91d1\u6bdb\u72ac\u5728\u57c3\u83f2\u5c14\u94c1\u5854\u9644\u8fd1\u7684\u8349\u5730\u4e0a\u5954\u8dd1\u3002\uff09   \u8f93\u51fa\u7279\u70b9\uff1a\u957f\u5ea6\u63a7\u5236\u5728 10-20 \u4e2a\u5355\u8bcd\uff0c\u4ec5\u5305\u542b\u6838\u5fc3\u7269\u4f53\uff08\u91d1\u6bdb\u72ac\uff09\u3001\u5173\u952e\u52a8\u4f5c\uff08\u5954\u8dd1\uff09\u548c\u6838\u5fc3\u80cc\u666f\uff08\u57c3\u83f2\u5c14\u94c1\u5854\u3001\u8349\u5730\uff09\uff0c\u65e0\u591a\u4f59\u7ec6\u8282\uff0c\u7b80\u6d01\u660e\u4e86\u3002</p> <p>\u7b56\u7565\u4e8c\uff1a\u8be6\u5c3d\u63cf\u8ff0 (Detailed Caption) * Prompt: \"Describe this image in extreme detail. Start with the main subject, then describe the background, lighting, colors, and artistic style. Mention any specific interactions between objects.\"\uff08\u6781\u5176\u8be6\u7ec6\u5730\u63cf\u8ff0\u8fd9\u5f20\u56fe\u50cf\u3002\u4ece\u6838\u5fc3\u7269\u4f53\u5f00\u59cb\uff0c\u7136\u540e\u63cf\u8ff0\u80cc\u666f\u3001\u5149\u7ebf\u3001\u989c\u8272\u548c\u827a\u672f\u98ce\u683c\u3002\u63d0\u53ca\u7269\u4f53\u4e4b\u95f4\u7684\u4efb\u4f55\u5177\u4f53\u4e92\u52a8\u5173\u7cfb\u3002\uff09   \u8865\u5145\u4f18\u5316 Prompt\uff08\u589e\u5f3a\u7ec6\u8282\u6355\u6349\uff09\uff1a\"Describe this image in extreme detail. First, describe the main subject's appearance (shape, color, texture), then the background scene, lighting effects (brightness, color temperature), color matching, and artistic style. Finally, mention the interactions between objects and the overall atmosphere of the image.\"\uff08\u6781\u5176\u8be6\u7ec6\u5730\u63cf\u8ff0\u8fd9\u5f20\u56fe\u50cf\u3002\u9996\u5148\u63cf\u8ff0\u6838\u5fc3\u7269\u4f53\u7684\u5916\u89c2\uff08\u5f62\u6001\u3001\u989c\u8272\u3001\u7eb9\u7406\uff09\uff0c\u7136\u540e\u63cf\u8ff0\u80cc\u666f\u573a\u666f\u3001\u5149\u7ebf\u6548\u679c\uff08\u4eae\u5ea6\u3001\u8272\u6e29\uff09\u3001\u8272\u5f69\u642d\u914d\u548c\u827a\u672f\u98ce\u683c\u3002\u6700\u540e\u63d0\u53ca\u7269\u4f53\u4e4b\u95f4\u7684\u4e92\u52a8\u5173\u7cfb\u548c\u56fe\u50cf\u7684\u6574\u4f53\u6c1b\u56f4\u3002\uff09 * \u76ee\u7684: \u9002\u914d GenAI \u6a21\u578b\uff08\u5982 Sora\u3001SD3\u3001Ideogram\uff09\u7684\u8bad\u7ec3\u9700\u6c42\u2014\u2014\u8fd9\u7c7b\u6a21\u578b\u9700\u8981\u901a\u8fc7\u8be6\u5c3d\u7684\u63cf\u8ff0\u5b66\u4e60\u5230\u56fe\u50cf\u7684\u7ec6\u8282\u7279\u5f81\u3001\u903b\u8f91\u5173\u7cfb\u548c\u573a\u666f\u6c1b\u56f4\uff0c\u624d\u80fd\u751f\u6210\u9ad8\u7cbe\u5ea6\u3001\u7b26\u5408\u6307\u4ee4\u7684\u56fe\u50cf\u3002\u540c\u65f6\uff0c\u4e5f\u9002\u7528\u4e8e\u9700\u8981\u7cbe\u51c6\u89c6\u89c9-\u6587\u672c\u5bf9\u9f50\u7684\u573a\u666f\uff08\u5982\u89c6\u89c9\u95ee\u7b54\u3001\u56fe\u50cf\u7f16\u8f91\uff09\u3002 * \u9884\u671f\u8f93\u51fa: \"A dynamic wide-angle shot of a fluffy golden retriever running joyfully across a green lawn. The dog's fur is illuminated by the warm, golden light of a setting sun, with some light brown strands glinting in the sunlight. Its ears flop backward as it runs, and its tail is raised high, showing a happy mood. In the blurred background, the iconic iron lattice structure of the Eiffel Tower rises against a gradient sky of purple and orange, with a few wispy clouds floating nearby. The lawn is dotted with small white clover flowers, and the overall atmosphere of the image is warm and lively, with soft focus on the dog and a blurred background that highlights the main subject.\"\uff08\u4e00\u5f20\u52a8\u6001\u5e7f\u89d2\u955c\u5934\u4e0b\u7684\u6bdb\u8338\u8338\u91d1\u6bdb\u72ac\uff0c\u6b63\u6b22\u5feb\u5730\u5954\u8dd1\u5728\u7eff\u8272\u7684\u8349\u5730\u4e0a\u3002\u72d7\u72d7\u7684\u6bdb\u53d1\u88ab\u5915\u9633\u6e29\u6696\u7684\u91d1\u8272\u5149\u7ebf\u7167\u4eae\uff0c\u51e0\u7f15\u6d45\u68d5\u8272\u7684\u6bdb\u53d1\u5728\u9633\u5149\u4e0b\u95ea\u95ea\u53d1\u5149\u3002\u5b83\u5954\u8dd1\u65f6\u8033\u6735\u5411\u540e\u8037\u62c9\u7740\uff0c\u5c3e\u5df4\u9ad8\u9ad8\u7fd8\u8d77\uff0c\u5c3d\u663e\u6b22\u5feb\u7684\u5fc3\u60c5\u3002\u5728\u6a21\u7cca\u7684\u80cc\u666f\u4e2d\uff0c\u6807\u5fd7\u6027\u7684\u57c3\u83f2\u5c14\u94c1\u5854\u94c1 lattice \u7ed3\u6784\u77d7\u7acb\u5728\u7d2b\u6a59\u6e10\u53d8\u7684\u5929\u7a7a\u4e0b\uff0c\u65c1\u8fb9\u6f02\u6d6e\u7740\u51e0\u7f15\u7ea4\u7ec6\u7684\u4e91\u6735\u3002\u8349\u5730\u4e0a\u70b9\u7f00\u7740\u5c0f\u5c0f\u7684\u767d\u8272\u4e09\u53f6\u8349\u82b1\uff0c\u56fe\u50cf\u7684\u6574\u4f53\u6c1b\u56f4\u6e29\u6696\u800c\u6d3b\u6cfc\uff0c\u72d7\u72d7\u91c7\u7528\u67d4\u7126\u5904\u7406\uff0c\u80cc\u666f\u6a21\u7cca\u4ee5\u7a81\u51fa\u6838\u5fc3\u4e3b\u4f53\u3002\uff09   \u8f93\u51fa\u7279\u70b9\uff1a\u957f\u5ea6\u901a\u5e38\u5728 50-200 \u4e2a\u5355\u8bcd\uff0c\u6db5\u76d6\u6838\u5fc3\u7269\u4f53\u7684\u7ec6\u8282\u3001\u80cc\u666f\u573a\u666f\u3001\u5149\u7ebf\u3001\u8272\u5f69\u3001\u827a\u672f\u98ce\u683c\u3001\u7269\u4f53\u4e92\u52a8\u548c\u6574\u4f53\u6c1b\u56f4\uff0c\u7ec6\u8282\u4e30\u5bcc\uff0c\u89c6\u89c9-\u6587\u672c\u5bf9\u9f50\u7cbe\u5ea6\u9ad8\u3002</p> <p>\u8865\u5145\u63d0\u793a\uff1a\u9664\u4e86\u4e0a\u8ff0\u4e24\u79cd\u7b56\u7565\uff0c\u8fd8\u53ef\u8bbe\u8ba1\u201c\u4efb\u52a1\u5bfc\u5411\u578b Prompt\u201d\uff0c\u5982\u9488\u5bf9\u7535\u5546\u56fe\u50cf\u7684 Prompt\uff08\"Describe this product image in detail, focusing on the product's appearance, color, size, texture, and placement, suitable for e-commerce promotion\"\uff09\u3001\u9488\u5bf9\u6587\u6863\u56fe\u50cf\u7684 Prompt\uff08\"Describe this document image in detail, including the text content, layout, font style, and color of the text\"\uff09\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u63cf\u8ff0\u7684\u9488\u5bf9\u6027\u3002</p>"},{"location":"part3/3_2_recaptioning/#723-vllm","title":"7.2.3 \u5de5\u7a0b\u5b9e\u73b0\uff1a\u4f7f\u7528 vLLM \u6784\u5efa\u9ad8\u541e\u5410\u63a8\u7406\u670d\u52a1","text":"<p>\u5bf9\u4e8e\u5927\u89c4\u6a21\u6570\u636e\u91cd\u63cf\u8ff0\uff08\u5982\u5904\u7406 10 \u4ebf\u7ea7\u522b\u7684\u56fe\u50cf\u6570\u636e\u96c6\uff09\uff0c\u666e\u901a\u7684 HuggingFace <code>generate()</code> \u65b9\u6cd5\u8fdc\u8fdc\u65e0\u6cd5\u6ee1\u8db3\u9700\u6c42\u2014\u2014\u5176\u63a8\u7406\u901f\u5ea6\u6162\u3001\u541e\u5410\u91cf\u4f4e\uff0c\u4e14\u65e0\u6cd5\u9ad8\u6548\u5229\u7528 GPU \u8d44\u6e90\uff0c\u5355\u5f20 GPU \u4e00\u5929\u4ec5\u80fd\u5904\u7406\u6570\u5343\u5f20\u56fe\u50cf\uff0c\u5927\u89c4\u6a21\u5904\u7406\u4f1a\u8017\u8d39\u5927\u91cf\u7684\u65f6\u95f4\u548c\u786c\u4ef6\u6210\u672c\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u4e13\u95e8\u7684\u5927\u6a21\u578b\u63a8\u7406\u5f15\u64ce\u2014\u2014vLLM\uff0c\u5176\u652f\u6301 PagedAttention\uff08\u5206\u9875\u6ce8\u610f\u529b\uff09\u548c Continuous Batching\uff08\u8fde\u7eed\u6279\u5904\u7406\uff09\u4e24\u79cd\u6838\u5fc3\u4f18\u5316\u6280\u672f\uff0c\u80fd\u591f\u5c06 VLM \u7684\u63a8\u7406\u541e\u5410\u91cf\u63d0\u5347 3-5 \u500d\uff0c\u540c\u65f6\u964d\u4f4e GPU \u663e\u5b58\u5360\u7528\uff0c\u5b9e\u73b0\u9ad8\u6548\u3001\u5927\u89c4\u6a21\u7684\u56fe\u50cf\u91cd\u63cf\u8ff0\u3002</p> <p>vLLM \u662f\u7531\u52a0\u5dde\u5927\u5b66\u4f2f\u514b\u5229\u5206\u6821\u7684\u7814\u7a76\u56e2\u961f\u5f00\u53d1\u7684\u9ad8\u6548\u5927\u6a21\u578b\u63a8\u7406\u5f15\u64ce\uff0c\u6838\u5fc3\u4f18\u52bf\u662f\u201c\u9ad8\u541e\u5410\u91cf\u3001\u4f4e\u5ef6\u8fdf\u3001\u9ad8 GPU \u5229\u7528\u7387\u201d\uff0c\u80fd\u591f\u5b8c\u7f8e\u9002\u914d LLaVA\u3001CogVLM \u7b49\u4e3b\u6d41 VLM \u7684\u90e8\u7f72\u9700\u6c42\uff0c\u4e14 API \u63a5\u53e3\u4e0e HuggingFace \u517c\u5bb9\uff0c\u8fc1\u79fb\u6210\u672c\u6781\u4f4e\u3002</p> <p>\u4ee5\u4e0b\u662f\u4f7f\u7528 vLLM \u90e8\u7f72 LLaVA-1.5-7b-hf \u6a21\u578b\uff0c\u5b9e\u73b0\u9ad8\u541e\u5410\u91cf\u56fe\u50cf\u91cd\u63cf\u8ff0\u7684\u6838\u5fc3\u4ee3\u7801\uff0c\u5305\u542b\u6a21\u578b\u521d\u59cb\u5316\u3001Prompt \u6a21\u677f\u8bbe\u8ba1\u3001\u6279\u91cf\u5904\u7406\u548c\u8f93\u51fa\u63d0\u53d6\u7b49\u5b8c\u6574\u6d41\u7a0b\uff0c\u5e76\u8865\u5145\u4e86\u5173\u952e\u53c2\u6570\u7684\u89e3\u8bfb\u548c\u4f18\u5316\u6280\u5de7\uff1a</p> <p></p><pre><code>from vllm import LLM, SamplingParams\nfrom PIL import Image\nimport os\nfrom tqdm import tqdm  # \u7528\u4e8e\u663e\u793a\u6279\u91cf\u5904\u7406\u8fdb\u5ea6\n\n# \u521d\u59cb\u5316 vLLM \u63a8\u7406\u5f15\u64ce\n# tensor_parallel_size=4: \u4f7f\u7528 4 \u5f20 GPU \u8fdb\u884c\u5f20\u91cf\u5e76\u884c\uff0c\u9002\u7528\u4e8e\u5927\u6a21\u578b\uff08\u59827B/13B\uff09\u7684\u90e8\u7f72\uff0c\u53ef\u6839\u636eGPU\u6570\u91cf\u8c03\u6574\uff08\u59821\u30012\u30014\u30018\uff09\n# \u6ce8\u610f\uff1a\u5f20\u91cf\u5e76\u884c\u9700\u8981\u591a\u5f20\u540c\u578b\u53f7\u7684GPU\uff0c\u4e14GPU\u4e4b\u95f4\u9700\u652f\u6301NVLink\uff0c\u63d0\u5347\u6570\u636e\u4f20\u8f93\u901f\u5ea6\n# trust_remote_code=True: \u5141\u8bb8\u52a0\u8f7d LLaVA \u6a21\u578b\u7684\u81ea\u5b9a\u4e49\u4ee3\u7801\uff08\u5982\u89c6\u89c9-\u8bed\u8a00\u878d\u5408\u6a21\u5757\uff09\uff0c\u56e0LLaVA\u7684\u67b6\u6784\u975e\u6807\u51c6HuggingFace\u6a21\u578b\n# model: \u6a21\u578b\u540d\u79f0\uff0c\u53ef\u4eceHuggingFace Hub\u4e0b\u8f7d\uff08\u5982llava-hf/llava-1.5-7b-hf\u3001llava-hf/llava-1.5-13b-hf\uff09\n# gpu_memory_utilization=0.9: \u8bbe\u7f6eGPU\u663e\u5b58\u5229\u7528\u7387\u4e3a90%\uff0c\u5e73\u8861\u541e\u5410\u91cf\u548c\u7a33\u5b9a\u6027\uff0c\u907f\u514d\u663e\u5b58\u6ea2\u51fa\nllm = LLM(\n    model=\"llava-hf/llava-1.5-7b-hf\",\n    tensor_parallel_size=4,\n    trust_remote_code=True,\n    gpu_memory_utilization=0.9\n)\n\n# \u5b9a\u4e49 Prompt \u6a21\u677f (LLaVA \u6a21\u578b\u9700\u8981\u9075\u5faa\u7279\u5b9a\u7684\u5bf9\u8bdd\u683c\u5f0f\uff0c\u5426\u5219\u4f1a\u5f71\u54cd\u6307\u4ee4\u9075\u5faa\u80fd\u529b)\n# \u6280\u5de7: \u5728 Prompt \u4e2d\u52a0\u5165 \"Analyze the image\" \u5f80\u5f80\u6bd4 \"Describe the image\" \u6548\u679c\u66f4\u597d\uff0c\n# \u56e0\u4e3a\"Analyze\"\u4f1a\u5f15\u5bfc\u6a21\u578b\u66f4\u7ec6\u81f4\u5730\u89c2\u5bdf\u56fe\u50cf\u7ec6\u8282\uff0c\u51cf\u5c11\u6577\u884d\u5f0f\u63cf\u8ff0\n# \u6b64\u5904\u4f7f\u7528\u8be6\u5c3d\u63cf\u8ff0\u7684 Prompt \u6a21\u677f\uff0c\u53ef\u6839\u636e\u9700\u6c42\u66ff\u6362\u4e3a\u7b80\u7565\u63cf\u8ff0\u6a21\u677f\nprompt_template = \"USER: &lt;image&gt;\\nAnalyze this image and describe it in extreme detail. Start with the main subject, then describe the background, lighting, colors, and artistic style. Mention any specific interactions between objects. ASSISTANT:\"\n\n# \u914d\u7f6e\u91c7\u6837\u53c2\u6570\uff0c\u63a7\u5236\u751f\u6210\u63cf\u8ff0\u7684\u8d28\u91cf\u548c\u7a33\u5b9a\u6027\n# temperature=0.2: \u964d\u4f4e\u968f\u673a\u6027\uff08\u53d6\u503c\u8303\u56f40-1\uff09\uff0c\u6e29\u5ea6\u8d8a\u4f4e\uff0c\u751f\u6210\u7684\u63cf\u8ff0\u8d8a\u7a33\u5b9a\u3001\u8d8a\u8d34\u5408\u56fe\u50cf\uff0c\u51cf\u5c11\u5e7b\u89c9\uff1b\n# \u82e5\u9700\u8981\u66f4\u591a\u6837\u5316\u7684\u63cf\u8ff0\uff0c\u53ef\u5c06\u6e29\u5ea6\u8c03\u6574\u4e3a0.5-0.7\uff0c\u4f46\u82e5\u6e29\u5ea6\u8fc7\u9ad8\uff08&gt;0.8\uff09\uff0c\u5bb9\u6613\u4ea7\u751f\u4e0e\u56fe\u50cf\u65e0\u5173\u7684\u5e7b\u89c9\n# max_tokens=256: \u9650\u5236\u8f93\u51fa\u957f\u5ea6\uff0c\u9632\u6b62\u6a21\u578b\u751f\u6210\u8fc7\u4e8e\u5197\u957f\u3001\u5197\u4f59\u7684\u63cf\u8ff0\uff0c\u53ef\u6839\u636e\u9700\u6c42\u8c03\u6574\uff08\u5982\u7b80\u7565\u63cf\u8ff0\u8bbe\u4e3a50\uff09\n# top_p=0.95: \u91c7\u7528\u6838\u91c7\u6837\u7b56\u7565\uff0c\u4ec5\u4fdd\u7559\u7d2f\u79ef\u6982\u7387\u8fbe\u523095%\u7684token\uff0c\u8fdb\u4e00\u6b65\u964d\u4f4e\u5e7b\u89c9\u98ce\u9669\nsampling_params = SamplingParams(\n    temperature=0.2,\n    max_tokens=256,\n    top_p=0.95\n)\n\ndef load_image_batch(image_dir, batch_size=32):\n    \"\"\"\n    \u6279\u91cf\u52a0\u8f7d\u56fe\u50cf\uff0c\u7528\u4e8e\u9ad8\u6548\u5904\u7406\n    image_dir: \u56fe\u50cf\u6587\u4ef6\u5939\u8def\u5f84\uff0c\u6240\u6709\u56fe\u50cf\u9700\u653e\u5728\u8be5\u6587\u4ef6\u5939\u4e0b\n    batch_size: \u6bcf\u6279\u5904\u7406\u7684\u56fe\u50cf\u6570\u91cf\uff0c\u53ef\u6839\u636eGPU\u663e\u5b58\u8c03\u6574\uff08\u598216\u300132\u300164\uff09\uff0c\u663e\u5b58\u8d8a\u5927\uff0cbatch_size\u53ef\u8bbe\u7f6e\u8d8a\u5927\n    return: \u6279\u91cf\u56fe\u50cf\u5217\u8868\uff08PIL.Image\u683c\u5f0f\uff09\u548c\u5bf9\u5e94\u7684\u56fe\u50cf\u8def\u5f84\u5217\u8868\n    \"\"\"\n    image_paths = [os.path.join(image_dir, f) for f in os.listdir(image_dir) if f.endswith(('jpg', 'png', 'jpeg'))]\n    image_batches = []\n    path_batches = []\n\n    # \u5206\u6279\u52a0\u8f7d\u56fe\u50cf\n    for i in range(0, len(image_paths), batch_size):\n        batch_paths = image_paths[i:i+batch_size]\n        batch_images = []\n        for path in batch_paths:\n            try:\n                # \u52a0\u8f7d\u56fe\u50cf\u5e76\u8f6c\u6362\u4e3aRGB\u683c\u5f0f\uff08\u907f\u514d\u7070\u5ea6\u56fe\u3001\u900f\u660e\u56fe\u5bfc\u81f4\u7684\u6a21\u578b\u62a5\u9519\uff09\n                img = Image.open(path).convert('RGB')\n                batch_images.append(img)\n            except Exception as e:\n                print(f\"\u52a0\u8f7d\u56fe\u50cf {path} \u5931\u8d25: {e}\")\n                continue\n        if batch_images:  # \u8df3\u8fc7\u4e3a\u7a7a\u7684\u6279\u6b21\n            image_batches.append(batch_images)\n            path_batches.append(batch_paths)\n    return image_batches, path_batches\n\ndef process_batch(image_batch):\n    \"\"\"\n    \u5904\u7406\u4e00\u6279\u56fe\u7247\uff0c\u751f\u6210\u5bf9\u5e94\u7684\u91cd\u63cf\u8ff0\u6587\u672c\n    image_batch: List[PIL.Image]\uff0c\u6279\u91cf\u56fe\u50cf\u5217\u8868\n    return: List[str]\uff0c\u6bcf\u5e45\u56fe\u50cf\u5bf9\u5e94\u7684\u91cd\u63cf\u8ff0\u6587\u672c\u5217\u8868\n    \"\"\"\n    # \u4e3a\u6bcf\u5e45\u56fe\u50cf\u751f\u6210\u5bf9\u5e94\u7684Prompt\n    prompts = [prompt_template for _ in range(len(image_batch))]\n\n    # vLLM \u652f\u6301\u76f4\u63a5\u4f20\u5165 multi_modal_data\uff08\u591a\u6a21\u6001\u6570\u636e\uff09\uff0c\u65e0\u9700\u624b\u52a8\u8f6c\u6362\u56fe\u50cf\u683c\u5f0f\n    # \u8fd9\u4e00\u6b65\u662f\u975e\u963b\u585e\u7684\uff0cvLLM \u5185\u90e8\u4f1a\u8fdb\u884c Continuous Batching \u8c03\u5ea6\uff0c\u9ad8\u6548\u5229\u7528GPU\u8d44\u6e90\n    # \u5373\u5f53\u4e00\u6279\u56fe\u50cf\u5904\u7406\u5b8c\u6210\u4e00\u90e8\u5206\u65f6\uff0c\u7acb\u5373\u52a0\u8f7d\u4e0b\u4e00\u6279\u56fe\u50cf\u7684\u90e8\u5206\u6570\u636e\uff0c\u907f\u514dGPU\u7a7a\u95f2\n    outputs = llm.generate(\n        prompts, \n        sampling_params, \n        multi_modal_data={\"image\": image_batch}\n    )\n\n    # \u63d0\u53d6\u751f\u6210\u7684\u63cf\u8ff0\u6587\u672c\uff0c\u53bb\u9664Prompt\u90e8\u5206\uff0c\u4ec5\u4fdd\u7559\u6a21\u578b\u7684\u54cd\u5e94\u5185\u5bb9\n    captions = []\n    for output in outputs:\n        # \u622a\u53d6ASSISTANT: \u540e\u9762\u7684\u5185\u5bb9\uff0c\u5373\u4e3a\u6a21\u578b\u751f\u6210\u7684\u63cf\u8ff0\n        caption = output.outputs[0].text.strip().replace(\"ASSISTANT:\", \"\").strip()\n        captions.append(caption)\n    return captions\n\ndef save_captions(image_paths, captions, save_path):\n    \"\"\"\n    \u4fdd\u5b58\u91cd\u63cf\u8ff0\u6587\u672c\uff0c\u4e0e\u56fe\u50cf\u8def\u5f84\u5bf9\u5e94\uff0c\u4fbf\u4e8e\u540e\u7eed\u4f7f\u7528\uff08\u5982\u6a21\u578b\u8bad\u7ec3\uff09\n    image_paths: \u56fe\u50cf\u8def\u5f84\u5217\u8868\n    captions: \u91cd\u63cf\u8ff0\u6587\u672c\u5217\u8868\n    save_path: \u4fdd\u5b58\u6587\u4ef6\u8def\u5f84\uff08txt\u683c\u5f0f\uff09\n    \"\"\"\n    with open(save_path, 'w', encoding='utf-8') as f:\n        for path, cap in zip(image_paths, captions):\n            # \u683c\u5f0f\uff1a\u56fe\u50cf\u8def\u5f84\\t\u91cd\u63cf\u8ff0\u6587\u672c\uff0c\u4fbf\u4e8e\u540e\u7eed\u8bfb\u53d6\u548c\u89e3\u6790\n            f.write(f\"{path}\\t{cap}\\n\")\n\n# \u4e3b\u51fd\u6570\uff1a\u6279\u91cf\u5904\u7406\u56fe\u50cf\u5e76\u751f\u6210\u91cd\u63cf\u8ff0\nif __name__ == \"__main__\":\n    image_dir = \"path/to/your/image/directory\"  # \u66ff\u6362\u4e3a\u4f60\u7684\u56fe\u50cf\u6587\u4ef6\u5939\u8def\u5f84\n    save_path = \"recaption_results.txt\"        # \u91cd\u63cf\u8ff0\u7ed3\u679c\u4fdd\u5b58\u8def\u5f84\n    batch_size = 32                            # \u6bcf\u6279\u5904\u7406\u56fe\u50cf\u6570\u91cf\uff0c\u6839\u636eGPU\u663e\u5b58\u8c03\u6574\n\n    # \u52a0\u8f7d\u56fe\u50cf\u6279\u6b21\n    image_batches, path_batches = load_image_batch(image_dir, batch_size)\n\n    # \u6279\u91cf\u5904\u7406\u5e76\u4fdd\u5b58\u7ed3\u679c\n    with open(save_path, 'w', encoding='utf-8') as f:\n        for img_batch, path_batch in tqdm(zip(image_batches, path_batches), total=len(image_batches)):\n            captions = process_batch(img_batch)\n            # \u5199\u5165\u5f53\u524d\u6279\u6b21\u7684\u7ed3\u679c\n            for path, cap in zip(path_batch, captions):\n                f.write(f\"{path}\\t{cap}\\n\")\n    print(f\"\u91cd\u63cf\u8ff0\u5b8c\u6210\uff0c\u7ed3\u679c\u5df2\u4fdd\u5b58\u81f3 {save_path}\")\n</code></pre> \u8865\u5145\u5de5\u7a0b\u4f18\u5316\u6280\u5de7\uff1a<p></p> <ul> <li>\u56fe\u50cf\u9884\u5904\u7406\uff1a\u6279\u91cf\u52a0\u8f7d\u56fe\u50cf\u65f6\uff0c\u53ef\u7edf\u4e00\u8c03\u6574\u56fe\u50cf\u5c3a\u5bf8\uff08\u5982 resize \u5230 224\u00d7224 \u6216 448\u00d7448\uff09\uff0c\u907f\u514d\u56e0\u56fe\u50cf\u5c3a\u5bf8\u5dee\u5f02\u5bfc\u81f4\u7684\u6a21\u578b\u63a8\u7406\u901f\u5ea6\u6ce2\u52a8\u548c\u663e\u5b58\u5360\u7528\u4e0d\u7a33\u5b9a\uff1b\u540c\u65f6\uff0c\u53ef\u5bf9\u56fe\u50cf\u8fdb\u884c\u5f52\u4e00\u5316\u5904\u7406\uff0c\u63d0\u5347\u6a21\u578b\u63cf\u8ff0\u7cbe\u5ea6\u3002</li> <li>\u9519\u8bef\u5904\u7406\uff1a\u589e\u52a0\u56fe\u50cf\u52a0\u8f7d\u5931\u8d25\u3001\u6a21\u578b\u63a8\u7406\u5931\u8d25\u7684\u5f02\u5e38\u6355\u83b7\u673a\u5236\uff0c\u907f\u514d\u6279\u91cf\u5904\u7406\u4e2d\u65ad\uff1b\u5bf9\u4e8e\u5904\u7406\u5931\u8d25\u7684\u56fe\u50cf\uff0c\u53ef\u8bb0\u5f55\u8def\u5f84\u5e76\u5355\u72ec\u5904\u7406\u3002</li> <li>\u786c\u4ef6\u4f18\u5316\uff1a\u90e8\u7f72\u65f6\u4f18\u5148\u4f7f\u7528 NVIDIA A100\u3001A800 \u7b49\u9ad8\u6027\u80fd GPU\uff0c\u663e\u5b58\u5efa\u8bae\u4e0d\u4f4e\u4e8e 24GB\uff087B \u6a21\u578b\uff09\uff1b\u82e5\u5904\u7406\u89c4\u6a21\u6781\u5927\uff0c\u53ef\u4f7f\u7528 GPU \u96c6\u7fa4\uff0c\u901a\u8fc7 vLLM \u7684\u5206\u5e03\u5f0f\u63a8\u7406\u529f\u80fd\u8fdb\u4e00\u6b65\u63d0\u5347\u541e\u5410\u91cf\u3002</li> <li>Prompt \u7f13\u5b58\uff1a\u5bf9\u4e8e\u76f8\u540c\u7c7b\u578b\u7684\u56fe\u50cf\uff08\u5982\u6279\u91cf\u7684\u7535\u5546\u6d77\u62a5\uff09\uff0c\u53ef\u7f13\u5b58 Prompt \u6a21\u677f\uff0c\u907f\u514d\u91cd\u590d\u751f\u6210\uff0c\u63d0\u5347\u5904\u7406\u901f\u5ea6\u3002</li> </ul>"},{"location":"part3/3_2_recaptioning/#73-ocr","title":"7.3 OCR \u589e\u5f3a\uff1a\u63d0\u53d6\u56fe\u4e2d\u6587\u5b57\u5e76\u878d\u5408","text":"<p>\u666e\u901a\u7684 VLM \u867d\u7136\u5177\u5907\u4e00\u5b9a\u7684\u89c6\u89c9\u7406\u89e3\u80fd\u529b\uff0c\u80fd\u591f\u8bc6\u522b\u56fe\u50cf\u4e2d\u7684\u7269\u4f53\u3001\u573a\u666f\u548c\u7b80\u5355\u6587\u5b57\uff0c\u4f46\u5728\u9762\u5bf9\u5bc6\u96c6\u6587\u672c\u56fe\u50cf\uff08\u5982\u6587\u6863\u3001\u6d77\u62a5\u3001\u56fe\u8868\u3001PDF \u622a\u56fe\uff09\u65f6\uff0c\u5f80\u5f80\u4f1a\u51fa\u73b0\u4e24\u4e2a\u6838\u5fc3\u95ee\u9898\uff1a\u4e00\u662f\u6587\u5b57\u8bc6\u522b\u7cbe\u5ea6\u4f4e\uff0c\u5bb9\u6613\u8ba4\u9519\u3001\u6f0f\u8ba4\u6587\u5b57\uff08\u5c24\u5176\u662f\u827a\u672f\u5b57\u4f53\u3001\u6a21\u7cca\u6587\u5b57\uff09\uff1b\u4e8c\u662f\u65e0\u6cd5\u5c06\u6587\u5b57\u4fe1\u606f\u4e0e\u89c6\u89c9\u5143\u7d20\u6709\u6548\u5173\u8054\uff0c\u5bfc\u81f4\u63cf\u8ff0\u4e2d\u5ffd\u7565\u6587\u5b57\u7684\u542b\u4e49\u548c\u4f5c\u7528\u3002</p> <p>\u4f8b\u5982\uff0c\u4e00\u5f20\u7535\u5546\u6d77\u62a5\u4e0a\u6709 \u201c\u590f\u65e5\u4fc3\u9500 \u5168\u573a 5 \u6298\u8d77\u201d \u7684\u5927\u5b57\uff0c\u666e\u901a VLM \u53ef\u80fd\u4ec5\u8f93\u51fa \u201cA red promotional poster\u201d\uff0c\u5b8c\u5168\u5ffd\u7565\u6587\u5b57\u4fe1\u606f\uff1b\u5373\u4f7f\u8bc6\u522b\u5230\u6587\u5b57\uff0c\u4e5f\u53ef\u80fd\u51fa\u73b0 \u201c\u590f\u65e5\u4fc3\u9500 \u5168\u573a 3 \u6298\u8d77\u201d \u7684\u9519\u8bef\u3002\u800c\u6587\u5b57\u4fe1\u606f\u5bf9\u4e8e\u8fd9\u7c7b\u56fe\u50cf\u7684\u91cd\u63cf\u8ff0\u81f3\u5173\u91cd\u8981 \u2014\u2014 \u5b83\u76f4\u63a5\u51b3\u5b9a\u4e86\u56fe\u50cf\u7684\u6838\u5fc3\u542b\u4e49\u548c\u7528\u9014\u3002</p> <p>\u6700\u4f73\u5b9e\u8df5\u662f\u5f15\u5165\u4e13\u95e8\u7684 OCR \u5f15\u64ce\uff08\u5982 PaddleOCR\u3001Tesseract\uff09\u4f5c\u4e3a VLM \u7684 \u201c\u5916\u6302\u5927\u8111\u201d\uff0c\u901a\u8fc7 OCR \u7cbe\u51c6\u63d0\u53d6\u56fe\u50cf\u4e2d\u7684\u6587\u5b57\u4fe1\u606f\uff0c\u518d\u5c06\u5176\u4e0e VLM Prompt \u52a8\u6001\u878d\u5408\uff0c\u8ba9 VLM \u80fd\u591f\u7ed3\u5408\u6587\u5b57\u4fe1\u606f\u751f\u6210\u66f4\u51c6\u786e\u3001\u66f4\u4e30\u5bcc\u7684\u63cf\u8ff0\uff0c\u663e\u8457\u63d0\u5347\u6587\u6863\u7c7b\u3001\u6d77\u62a5\u7c7b\u7b49\u5bcc\u6587\u672c\u56fe\u50cf\u7684\u91cd\u63cf\u8ff0\u8d28\u91cf\u3002</p> <p>OCR\uff08Optical Character Recognition\uff0c\u5149\u5b66\u5b57\u7b26\u8bc6\u522b\uff09\u6280\u672f\u7684\u6838\u5fc3\u662f\u5c06\u56fe\u50cf\u4e2d\u7684\u5370\u5237\u4f53\u3001\u624b\u5199\u4f53\u6587\u5b57\u8f6c\u6362\u4e3a\u53ef\u7f16\u8f91\u7684\u6587\u672c\uff0c\u5176\u6587\u5b57\u8bc6\u522b\u7cbe\u5ea6\u8fdc\u9ad8\u4e8e\u666e\u901a VLM\uff0c\u5c24\u5176\u662f\u5728\u5bc6\u96c6\u6587\u672c\u3001\u590d\u6742\u5b57\u4f53\u573a\u666f\u4e0b\uff0c\u4f18\u52bf\u66f4\u4e3a\u660e\u663e\u3002\u76ee\u524d\uff0c\u5de5\u4e1a\u754c\u5e94\u7528\u6700\u5e7f\u6cdb\u3001\u5f00\u6e90\u514d\u8d39\u4e14\u7cbe\u5ea6\u8f83\u9ad8\u7684 OCR \u5f15\u64ce\u662f PaddleOCR\uff08\u767e\u5ea6\u98de\u6868\u5f00\u6e90\u7684 OCR \u5de5\u5177\uff09\uff0c\u5b83\u652f\u6301\u591a\u8bed\u8a00\u3001\u591a\u5b57\u4f53\u3001\u6a21\u7cca\u6587\u672c\u7684\u8bc6\u522b\uff0c\u4e14\u63a8\u7406\u901f\u5ea6\u5feb\u3001\u90e8\u7f72\u7b80\u5355\uff0c\u652f\u6301 GPU \u52a0\u901f\uff0c\u975e\u5e38\u9002\u5408\u4e0e VLM \u7ed3\u5408\u4f7f\u7528\u3002</p> <p> \u56fe7-2\uff1aOCR \u589e\u5f3a\u6d41\u6c34\u7ebf</p> <p>\u56fe\u8868\u6838\u5fc3\u89e3\u8bfb\uff1a\u56fe 7-2 \u5c55\u793a\u4e86 OCR \u589e\u5f3a VLM \u91cd\u63cf\u8ff0\u7684\u5b8c\u6574\u6d41\u7a0b\uff0c\u6838\u5fc3\u662f \u201cOCR \u63d0\u53d6\u6587\u5b57\u2192\u4e0a\u4e0b\u6587\u6784\u5efa\u2192Prompt \u878d\u5408\u2192VLM \u751f\u6210\u63cf\u8ff0\u201d\uff0c\u901a\u8fc7 OCR \u8865\u5145 VLM \u7684\u6587\u5b57\u8bc6\u522b\u77ed\u677f\uff0c\u5b9e\u73b0 \u201c\u89c6\u89c9\u7ec6\u8282 + \u6587\u5b57\u4fe1\u606f\u201d \u7684\u53cc\u91cd\u7cbe\u51c6\u63cf\u8ff0\u3002</p>"},{"location":"part3/3_2_recaptioning/#731-ocr","title":"7.3.1 OCR \u589e\u5f3a\u6d41\u6c34\u7ebf","text":"<p>OCR \u589e\u5f3a\u7684\u6838\u5fc3\u662f\u5c06 OCR \u63d0\u53d6\u7684\u6587\u5b57\u4fe1\u606f\u4e0e VLM Prompt \u6709\u673a\u878d\u5408\uff0c\u800c\u975e\u7b80\u5355\u62fc\u63a5\u3002\u6574\u4e2a\u6d41\u6c34\u7ebf\u53ef\u5206\u4e3a\u4e09\u4e2a\u6838\u5fc3\u6b65\u9aa4\uff0c\u6bcf\u4e2a\u6b65\u9aa4\u90fd\u6709\u660e\u786e\u7684\u4f18\u5316\u65b9\u5411\uff0c\u786e\u4fdd\u6587\u5b57\u4fe1\u606f\u80fd\u591f\u6709\u6548\u63d0\u5347\u91cd\u63cf\u8ff0\u8d28\u91cf\uff1a</p> <ol> <li>\u68c0\u6d4b\u4e0e\u8bc6\u522b\uff1a\u4f7f\u7528 PaddleOCR \u5f15\u64ce\u5bf9\u539f\u59cb\u56fe\u50cf\u8fdb\u884c\u5904\u7406\uff0c\u9996\u5148\u68c0\u6d4b\u51fa\u56fe\u50cf\u4e2d\u7684\u6240\u6709\u6587\u672c\u533a\u57df\uff08\u901a\u8fc7 Bounding Box \u5b9a\u4f4d\u6587\u672c\u7684\u4f4d\u7f6e\uff09\uff0c\u7136\u540e\u5bf9\u6bcf\u4e2a\u6587\u672c\u533a\u57df\u8fdb\u884c\u5b57\u7b26\u8bc6\u522b\uff0c\u8f93\u51fa\u8bc6\u522b\u5230\u7684\u6587\u672c\u5185\u5bb9\u548c\u5bf9\u5e94\u7684\u7f6e\u4fe1\u5ea6\uff080-1 \u4e4b\u95f4\uff0c\u7f6e\u4fe1\u5ea6\u8d8a\u9ad8\uff0c\u8bc6\u522b\u7ed3\u679c\u8d8a\u51c6\u786e\uff09\u3002\u8fd9\u4e00\u6b65\u7684\u6838\u5fc3\u76ee\u6807\u662f \u201c\u7cbe\u51c6\u63d0\u53d6\u6587\u5b57\uff0c\u8fc7\u6ee4\u9519\u8bef\u8bc6\u522b\u7ed3\u679c\u201d\u2014\u2014 \u901a\u8fc7\u7f6e\u4fe1\u5ea6\u9608\u503c\u8fc7\u6ee4\u4f4e\u7cbe\u5ea6\u8bc6\u522b\u7ed3\u679c\uff0c\u907f\u514d\u9519\u8bef\u6587\u5b57\u8bef\u5bfc VLM\u3002</li> <li>\u4e0a\u4e0b\u6587\u6784\u5efa\uff1a\u5c06 OCR \u63d0\u53d6\u5230\u7684\u6240\u6709\u6709\u6548\u6587\u672c\uff08\u8fc7\u6ee4\u4f4e\u7f6e\u4fe1\u5ea6\u540e\uff09\uff0c\u6309\u7167\u56fe\u50cf\u4e2d\u6587\u5b57\u7684\u5b9e\u9645\u4f4d\u7f6e\uff08\u4ece\u4e0a\u5230\u4e0b\u3001\u4ece\u5de6\u5230\u53f3\uff0c\u591a\u5217\u6587\u672c\u6309\u5217\u6392\u5e8f\uff09\u8fdb\u884c\u62fc\u63a5\uff0c\u6784\u5efa\u51fa\u7b26\u5408\u4eba\u7c7b\u9605\u8bfb\u4e60\u60ef\u7684\u6587\u672c\u4e0a\u4e0b\u6587\u3002\u540c\u65f6\uff0c\u53ef\u5bf9\u6587\u672c\u8fdb\u884c\u7b80\u5355\u5206\u7c7b\u6574\u7406\uff08\u5982\u5c06\u6807\u9898\u6587\u5b57\u3001\u6b63\u6587\u6587\u5b57\u3001\u6309\u94ae\u6587\u5b57\u533a\u5206\u5f00\uff09\uff0c\u4fbf\u4e8e VLM \u7406\u89e3\u6587\u5b57\u7684\u5c42\u7ea7\u5173\u7cfb\u548c\u4f5c\u7528\u3002\u4f8b\u5982\uff0c\u4e00\u5f20\u6d77\u62a5\u4e0a\u7684\u6587\u5b57 \u201c\u590f\u65e5\u4fc3\u9500\u201d\uff08\u6807\u9898\uff09\u3001\u201c\u5168\u573a 5 \u6298\u8d77\u201d\uff08\u526f\u6807\u9898\uff09\u3001\u201c6 \u6708 1 \u65e5 - 6 \u6708 10 \u65e5\u201d\uff08\u65f6\u95f4\uff09\uff0c\u62fc\u63a5\u540e\u53ef\u5f97\u5230 \u201c\u590f\u65e5\u4fc3\u9500\uff0c\u5168\u573a 5 \u6298\u8d77\uff0c6 \u6708 1 \u65e5 - 6 \u6708 10 \u65e5\u201d\uff0c\u5e76\u6807\u6ce8\u6807\u9898\u548c\u6b63\u6587\u3002</li> <li>Prompt \u878d\u5408\uff1a\u5c06\u6784\u5efa\u597d\u7684\u6587\u672c\u4e0a\u4e0b\u6587\uff0c\u4ee5\u81ea\u7136\u7684\u65b9\u5f0f\u878d\u5165\u5230 VLM \u7684 Prompt \u4e2d\uff0c\u660e\u786e\u544a\u8bc9 VLM\u201c\u56fe\u50cf\u4e2d\u5305\u542b\u8fd9\u4e9b\u6587\u5b57\u4fe1\u606f\uff0c\u8bf7\u7ed3\u5408\u6587\u5b57\u548c\u89c6\u89c9\u5143\u7d20\u8fdb\u884c\u63cf\u8ff0\u201d\uff0c\u5f15\u5bfc VLM \u5173\u8054\u6587\u5b57\u4e0e\u89c6\u89c9\u5143\u7d20\uff08\u5982\u6587\u5b57\u7684\u4f4d\u7f6e\u3001\u989c\u8272\u3001\u5b57\u4f53\u98ce\u683c\uff0c\u4ee5\u53ca\u6587\u5b57\u6240\u8868\u8fbe\u7684\u542b\u4e49\u4e0e\u56fe\u50cf\u573a\u666f\u7684\u5173\u7cfb\uff09\u3002\u8fd9\u4e00\u6b65\u7684\u5173\u952e\u662f \u201c\u878d\u5408\u81ea\u7136\uff0c\u4e0d\u5197\u4f59\u201d\uff0c\u907f\u514d\u5c06\u6587\u5b57\u751f\u786c\u62fc\u63a5\u5728 Prompt \u672b\u5c3e\uff0c\u5bfc\u81f4 VLM \u5ffd\u7565\u89c6\u89c9\u7ec6\u8282\u3002</li> </ol> <p>\u8865\u5145\u8bf4\u660e\uff1a\u6d41\u6c34\u7ebf\u7684\u4f18\u5316\u91cd\u70b9\u662f \u201c\u7f6e\u4fe1\u5ea6\u8fc7\u6ee4\u201d \u548c \u201cPrompt \u878d\u5408\u201d\u2014\u2014 \u82e5\u672a\u8fc7\u6ee4\u4f4e\u7f6e\u4fe1\u5ea6\u6587\u672c\uff0c\u9519\u8bef\u7684\u6587\u5b57\u4f1a\u5bfc\u81f4 VLM \u751f\u6210\u9519\u8bef\u63cf\u8ff0\uff1b\u82e5 Prompt \u878d\u5408\u751f\u786c\uff0cVLM \u4f1a\u5c06\u6587\u5b57\u4e0e\u89c6\u89c9\u5143\u7d20\u5272\u88c2\uff0c\u65e0\u6cd5\u5b9e\u73b0\u771f\u6b63\u7684\u589e\u5f3a\u6548\u679c\u3002</p>"},{"location":"part3/3_2_recaptioning/#732-ocr","title":"7.3.2 \u6838\u5fc3\u4ee3\u7801\uff1aOCR \u7ed3\u679c\u6ce8\u5165","text":"<p>\u4ee5\u4e0b\u662f\u4f7f\u7528 PaddleOCR \u63d0\u53d6\u56fe\u50cf\u6587\u5b57\uff0c\u5e76\u5c06\u5176\u52a8\u6001\u878d\u5408\u5230 VLM Prompt \u4e2d\u7684\u6838\u5fc3\u4ee3\u7801\uff0c\u53ef\u4e0e 7.2.3 \u8282\u7684 vLLM \u6279\u91cf\u5904\u7406\u4ee3\u7801\u65e0\u7f1d\u5bf9\u63a5\uff0c\u5b9e\u73b0 OCR \u589e\u5f3a\u7684\u5927\u89c4\u6a21\u56fe\u50cf\u91cd\u63cf\u8ff0\u3002\u4ee3\u7801\u4e2d\u5305\u542b\u4e86\u6587\u5b57\u63d0\u53d6\u3001\u7f6e\u4fe1\u5ea6\u8fc7\u6ee4\u3001\u4e0a\u4e0b\u6587\u6784\u5efa\u3001Prompt \u878d\u5408\u7b49\u5b8c\u6574\u903b\u8f91\uff0c\u5e76\u8865\u5145\u4e86\u5173\u952e\u53c2\u6570\u89e3\u8bfb\u548c\u4f18\u5316\u6280\u5de7\uff1a</p> <pre><code>from paddleocr import PaddleOCR\nimport os\nfrom PIL import Image\n\n# \u521d\u59cb\u5316 OCR \u5f15\u64ce (\u5efa\u8bae\u5728 GPU \u4e0a\u8fd0\u884c\u4ee5\u52a0\u901f\uff0c\u82e5\u6ca1\u6709 GPU\uff0c\u53ef\u8bbe\u7f6e use_gpu=False)\n# use_angle_cls=True: \u5f00\u542f\u6587\u672c\u65b9\u5411\u68c0\u6d4b\uff0c\u652f\u6301\u503e\u659c\u6587\u672c\uff08\u5982\u503e\u659c\u7684\u6d77\u62a5\u6587\u5b57\u3001\u65cb\u8f6c\u7684\u6587\u6863\uff09\u7684\u8bc6\u522b\uff0c\u907f\u514d\u56e0\u6587\u672c\u503e\u659c\u5bfc\u81f4\u8bc6\u522b\u9519\u8bef\n# lang='en': \u8bc6\u522b\u8bed\u8a00\u4e3a\u82f1\u6587\uff0c\u82e5\u9700\u8981\u8bc6\u522b\u4e2d\u6587\uff0c\u53ef\u8bbe\u7f6e lang='ch'\uff0c\u652f\u6301\u4e2d\u82f1\u53cc\u8bed\u6df7\u5408\u8bc6\u522b\uff08lang='ch_en'\uff09\n# det_model_dir\u3001rec_model_dir: \u53ef\u6307\u5b9a OCR \u68c0\u6d4b\u6a21\u578b\u548c\u8bc6\u522b\u6a21\u578b\u7684\u8def\u5f84\uff0c\u82e5\u4e0d\u6307\u5b9a\uff0c\u4f1a\u81ea\u52a8\u4e0b\u8f7d\u9884\u8bad\u7ec3\u6a21\u578b\n# gpu_mem=500: \u8bbe\u7f6e GPU \u663e\u5b58\u5360\u7528\u4e0a\u9650\uff08\u5355\u4f4d\uff1aMB\uff09\uff0c\u53ef\u6839\u636e GPU \u663e\u5b58\u8c03\u6574\nocr = PaddleOCR(\n    use_angle_cls=True,\n    lang='en',\n    use_gpu=True,\n    gpu_mem=500)\n\ndef generate_ocr_enhanced_prompt(image_path, base_prompt=\"Describe this image in detail.\"):\n    \"\"\"\n    \u751f\u6210 OCR \u589e\u5f3a\u7684 VLM Prompt\uff0c\u5c06 OCR \u63d0\u53d6\u7684\u6587\u5b57\u4fe1\u606f\u878d\u5165 Prompt \u4e2d\n    image_path: \u539f\u59cb\u56fe\u50cf\u8def\u5f84\n    base_prompt: \u57fa\u7840 Prompt\uff08\u5982\u7b80\u7565\u63cf\u8ff0\u3001\u8be6\u5c3d\u63cf\u8ff0\u7684 Prompt\uff09\uff0c\u4f5c\u4e3a Prompt \u4e3b\u4f53\n    return: OCR \u589e\u5f3a\u540e\u7684\u5b8c\u6574 Prompt\uff0c\u82e5\u672a\u8bc6\u522b\u5230\u6709\u6548\u6587\u5b57\uff0c\u8fd4\u56de\u57fa\u7840 Prompt\n    \"\"\"\n    # Step 1: \u8fd0\u884c OCR\uff0c\u63d0\u53d6\u56fe\u50cf\u4e2d\u7684\u6587\u5b57\u548c\u7f6e\u4fe1\u5ea6\n    # result \u662f\u4e00\u4e2a\u5d4c\u5957\u5217\u8868\uff0c\u7ed3\u6784\u4e3a\uff1a[[[[x1,y1], [x2,y2], [x3,y3], [x4,y4]], [text, confidence]], ...]\n    # \u5176\u4e2d [x1,y1]~[x4,y4] \u662f\u6587\u672c\u533a\u57df\u7684 Bounding Box\uff08\u5de6\u4e0a\u89d2\u3001\u53f3\u4e0a\u89d2\u3001\u53f3\u4e0b\u89d2\u3001\u5de6\u4e0b\u89d2\u5750\u6807\uff09\n    # text \u662f\u8bc6\u522b\u5230\u7684\u6587\u672c\u5185\u5bb9\uff0cconfidence \u662f\u8bc6\u522b\u7f6e\u4fe1\u5ea6\n    result = ocr.ocr(image_path, cls=True)\n\n    # \u5904\u7406 OCR \u7ed3\u679c\uff1a\u82e5\u672a\u8bc6\u522b\u5230\u6587\u5b57\uff0c\u6216\u8bc6\u522b\u7ed3\u679c\u4e3a\u7a7a\uff0c\u56de\u9000\u5230\u666e\u901a\u57fa\u7840 Prompt\n    if not result or not result[0]:\n        return f\"USER: &lt;image&gt;\\n{base_prompt}\\nASSISTANT:\"\n\n    # Step 2: \u63d0\u53d6\u6709\u6548\u6587\u5b57\uff08\u8fc7\u6ee4\u4f4e\u7f6e\u4fe1\u5ea6\u7ed3\u679c\uff09\uff0c\u6784\u5efa\u6587\u672c\u4e0a\u4e0b\u6587\n    detected_texts = []\n    for line in result[0]:\n        text = line[1][0]  # \u8bc6\u522b\u5230\u7684\u6587\u672c\u5185\u5bb9\n        confidence = line[1][1]  # \u8bc6\u522b\u7f6e\u4fe1\u5ea6\n        # \u8fc7\u6ee4\u7f6e\u4fe1\u5ea6\u4f4e\u4e8e 0.8 \u7684\u7ed3\u679c\uff08\u9608\u503c\u53ef\u8c03\u6574\uff0c\u59820.7-0.9\uff0c\u6839\u636e\u56fe\u50cf\u6587\u5b57\u6e05\u6670\u5ea6\u8c03\u6574\uff09\n        # \u540c\u65f6\u8fc7\u6ee4\u7a7a\u6587\u672c\u548c\u65e0\u610f\u4e49\u7684\u4e71\u7801\uff08\u5982\u4ec5\u5305\u542b\u7b26\u53f7\u3001\u7a7a\u683c\u7684\u6587\u672c\uff09\n        if confidence &gt; 0.8 and text.strip() and len(text.strip()) &gt; 1:\n            detected_texts.append(text.strip())\n\n    # \u6784\u5efa\u6587\u672c\u4e0a\u4e0b\u6587\uff1a\u6309\u8bc6\u522b\u987a\u5e8f\u62fc\u63a5\u6587\u672c\uff0c\u7528\u9017\u53f7\u5206\u9694\uff0c\u786e\u4fdd\u7b26\u5408\u4eba\u7c7b\u9605\u8bfb\u4e60\u60ef\n    ocr_context = \", \".join(detected_texts)\n\n    # Step 3: \u52a8\u6001\u878d\u5408 OCR \u7ed3\u679c\u4e0e\u57fa\u7840 Prompt\uff0c\u751f\u6210\u589e\u5f3a Prompt\n    # \u5173\u952e\u6280\u5de7\uff1a\u544a\u8bc9\u6a21\u578b \"I have detected these texts...\"\uff0c\u8ba9\u6a21\u578b\u660e\u786e\u77e5\u9053\u8fd9\u662f\u56fe\u50cf\u4e2d\u7684\u6587\u5b57\uff0c\n    # \u5e76\u5f15\u5bfc\u6a21\u578b\u5c06\u6587\u5b57\u4e0e\u89c6\u89c9\u5143\u7d20\u5173\u8054\uff08\u5982\u6587\u5b57\u7684\u4f4d\u7f6e\u3001\u989c\u8272\u3001\u5b57\u4f53\uff0c\u4ee5\u53ca\u6587\u5b57\u542b\u4e49\u4e0e\u573a\u666f\u7684\u5173\u7cfb\uff09\n    if len(ocr_context) &gt; 10:  # \u53ea\u6709\u6587\u672c\u957f\u5ea6\u8db3\u591f\u957f\uff08\u8d85\u8fc710\u4e2a\u5b57\u7b26\uff09\uff0c\u624d\u6709\u589e\u5f3a\u4ef7\u503c\uff0c\u907f\u514d\u5197\u4f59\n        enhanced_prompt = (\n            f\"USER: &lt;image&gt;\\n\"\n            f\"I have detected these text segments in the image: '{ocr_context}'. \"\n            f\"Using this text as a reference, describe the image in detail, \"\n            f\"paying attention to how the text relates to the visual elements (such as the position, color, and font style of the text, \"\n            f\"and the connection between the text content and the image scene). {base_prompt}\\n\"\n            f\"ASSISTANT:\"\n        )\n        return enhanced_prompt\n    else:\n        # \u82e5\u6587\u672c\u8fc7\u77ed\uff08\u5982\u4ec51-2\u4e2a\u5355\u8bcd\uff09\uff0c\u4e0d\u8fdb\u884c\u589e\u5f3a\uff0c\u907f\u514d\u5197\u4f59\uff0c\u56de\u9000\u5230\u57fa\u7840 Prompt\n        return f\"USER: &lt;image&gt;\\n{base_prompt}\\nASSISTANT:\"\n\n# \u6d4b\u8bd5\u4ee3\u7801\uff1a\u9a8c\u8bc1 OCR \u589e\u5f3a Prompt \u7684\u751f\u6210\u6548\u679c\nif __name__ == \"__main__\":\n    # \u6d4b\u8bd5\u56fe\u50cf\u8def\u5f84\uff08\u53ef\u66ff\u6362\u4e3a\u4f60\u7684\u5bcc\u6587\u672c\u56fe\u50cf\u8def\u5f84\uff0c\u5982\u6d77\u62a5\u3001\u6587\u6863\u622a\u56fe\uff09\n    test_image_path = \"path/to/your/test/poster.jpg\"\n    # \u57fa\u7840 Prompt\uff08\u91c7\u7528\u8be6\u5c3d\u63cf\u8ff0\u6a21\u677f\uff09\n    base_prompt = \"Describe this image in extreme detail. Start with the main subject, then describe the background, lighting, colors, and artistic style.\"\n    # \u751f\u6210\u589e\u5f3a Prompt\n    enhanced_prompt = generate_ocr_enhanced_prompt(test_image_path, base_prompt)\n    print(\"OCR \u589e\u5f3a\u540e\u7684 Prompt:\")\n    print(enhanced_prompt)\n</code></pre> <p>\u8865\u5145\u4f18\u5316\u6280\u5de7\uff1a</p> <ul> <li>\u7f6e\u4fe1\u5ea6\u9608\u503c\u8c03\u6574\uff1a\u5bf9\u4e8e\u6587\u5b57\u6e05\u6670\u7684\u56fe\u50cf\uff08\u5982\u9ad8\u6e05\u6587\u6863\u3001\u6b63\u89c4\u6d77\u62a5\uff09\uff0c\u53ef\u5c06\u7f6e\u4fe1\u5ea6\u9608\u503c\u8c03\u6574\u4e3a 0.8-0.9\uff0c\u8fc7\u6ee4\u5c11\u91cf\u9519\u8bef\u7ed3\u679c\uff1b\u5bf9\u4e8e\u6587\u5b57\u6a21\u7cca\u3001\u5b57\u4f53\u590d\u6742\u7684\u56fe\u50cf\uff08\u5982\u8001\u65e7\u6d77\u62a5\u3001\u624b\u5199\u4f53\uff09\uff0c\u53ef\u5c06\u9608\u503c\u8c03\u6574\u4e3a 0.7-0.8\uff0c\u907f\u514d\u6f0f\u8ba4\u6709\u6548\u6587\u5b57\u3002</li> <li>\u6587\u672c\u4e0a\u4e0b\u6587\u4f18\u5316\uff1a\u5bf9\u4e8e\u591a\u5217\u6587\u672c\u3001\u5c42\u7ea7\u6587\u672c\uff08\u5982\u6807\u9898\u3001\u6b63\u6587\u3001\u811a\u6ce8\uff09\uff0c\u53ef\u7ed3\u5408 Bounding Box \u7684\u5750\u6807\u4fe1\u606f\uff0c\u5bf9\u6587\u672c\u8fdb\u884c\u5206\u7c7b\u62fc\u63a5\uff0c\u4f8b\u5982 \u201c\u6807\u9898\uff1a\u590f\u65e5\u4fc3\u9500\uff1b\u6b63\u6587\uff1a\u5168\u573a 5 \u6298\u8d77\uff0c6 \u6708 1 \u65e5 - 6 \u6708 10 \u65e5\uff1b\u811a\u6ce8\uff1a\u6700\u7ec8\u89e3\u91ca\u6743\u5f52\u672c\u5e97\u6240\u6709\u201d\uff0c\u8ba9 VLM \u66f4\u6e05\u6670\u5730\u7406\u89e3\u6587\u5b57\u7684\u5c42\u7ea7\u5173\u7cfb\u3002</li> <li>Prompt \u878d\u5408\u4f18\u5316\uff1a\u6839\u636e\u56fe\u50cf\u7c7b\u578b\u8c03\u6574\u878d\u5408\u8bdd\u672f\uff0c\u5982\u6587\u6863\u56fe\u50cf\u53ef\u52a0\u5165 \u201cDescribe the layout of the text and the relationship between the text and the document structure\u201d\uff0c\u6d77\u62a5\u56fe\u50cf\u53ef\u52a0\u5165 \u201cDescribe the font style of the text and the role of the text in the promotional scene\u201d\uff0c\u63d0\u5347\u63cf\u8ff0\u7684\u9488\u5bf9\u6027\u3002</li> <li>\u591a OCR \u5f15\u64ce\u878d\u5408\uff1a\u5bf9\u4e8e\u6781\u9ad8\u7cbe\u5ea6\u8981\u6c42\u7684\u573a\u666f\uff0c\u53ef\u540c\u65f6\u4f7f\u7528 PaddleOCR \u548c Tesseract \u4e24\u79cd\u5f15\u64ce\uff0c\u53d6\u4e24\u8005\u8bc6\u522b\u7ed3\u679c\u7684\u4ea4\u96c6\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u6587\u5b57\u8bc6\u522b\u7cbe\u5ea6\u3002</li> </ul> <p>\u5b9e\u6218\u6536\u76ca\uff1aOCR \u589e\u5f3a\u5bf9\u5bcc\u6587\u672c\u56fe\u50cf\u7684\u91cd\u63cf\u8ff0\u8d28\u91cf\u63d0\u5347\u6548\u679c\u6781\u5176\u663e\u8457\uff0c\u4ee5\u4e0b\u662f\u4e00\u4e2a\u5178\u578b\u7684\u5b9e\u6218\u5bf9\u6bd4\u6848\u4f8b\uff1a</p> <ul> <li>\u666e\u901a VLM\uff08\u65e0 OCR \u589e\u5f3a\uff09\u5bf9\u7535\u5546\u6d77\u62a5\u7684\u63cf\u8ff0\uff1a\"A red promotional poster with a white background, featuring some vague text and a button at the bottom.\"\uff08\u4e00\u5f20\u7ea2\u8272\u7684\u4fc3\u9500\u6d77\u62a5\uff0c\u767d\u8272\u80cc\u666f\uff0c\u5305\u542b\u4e00\u4e9b\u6a21\u7cca\u7684\u6587\u5b57\u548c\u5e95\u90e8\u7684\u4e00\u4e2a\u6309\u94ae\u3002\uff09</li> <li>OCR \u589e\u5f3a\u540e VLM \u7684\u63cf\u8ff0\uff1a\"A promotional red poster with a white background, featuring the text 'SUMMER SALE 50% OFF' in large white bold letters at the top center of the poster, and 'Shop Now' in a small blue button at the bottom right. The text 'SUMMER SALE' is in a decorative font, with a yellow shadow effect that makes it stand out. The overall layout is simple and eye-catching, focusing on highlighting the promotional information. The background is plain white, which makes the red poster and white text more prominent.\"\uff08\u4e00\u5f20\u7ea2\u8272\u7684\u4fc3\u9500\u6d77\u62a5\uff0c\u767d\u8272\u80cc\u666f\uff0c\u6d77\u62a5\u9876\u90e8\u4e2d\u592e\u6709\u5927\u53f7\u767d\u8272\u7c97\u4f53\u6587\u5b57 \u201cSUMMER SALE 50% OFF\u201d\uff0c\u53f3\u4e0b\u89d2\u7684\u84dd\u8272\u5c0f\u6309\u94ae\u4e0a\u6709 \u201cShop Now\u201d \u5b57\u6837\u3002\u201cSUMMER SALE\u201d \u91c7\u7528\u88c5\u9970\u5b57\u4f53\uff0c\u5e26\u6709\u9ec4\u8272\u9634\u5f71\u6548\u679c\uff0c\u4f7f\u5176\u66f4\u52a0\u7a81\u51fa\u3002\u6574\u4f53\u5e03\u5c40\u7b80\u6d01\u9192\u76ee\uff0c\u91cd\u70b9\u7a81\u51fa\u4fc3\u9500\u4fe1\u606f\u3002\u80cc\u666f\u4e3a\u7eaf\u767d\u8272\uff0c\u8ba9\u7ea2\u8272\u6d77\u62a5\u548c\u767d\u8272\u6587\u5b57\u66f4\u52a0\u663e\u773c\u3002\uff09</li> </ul> <p>\u8fd9\u79cd\u5dee\u5f02\u5bf9\u4e8e\u8bad\u7ec3\u80fd\u591f\u751f\u6210\u51c6\u786e\u6587\u5b57\u7684\u6a21\u578b\uff08\u5982 Ideogram\u3001SD3\u3001\u6587\u6863\u751f\u6210\u6a21\u578b\uff09\u81f3\u5173\u91cd\u8981 \u2014\u2014 \u5305\u542b\u7cbe\u51c6\u6587\u5b57\u4fe1\u606f\u7684\u91cd\u63cf\u8ff0\uff0c\u80fd\u591f\u8ba9\u6a21\u578b\u5b66\u4f1a \u201c\u6587\u5b57\u7684\u89c6\u89c9\u5448\u73b0\u65b9\u5f0f\u201d \u548c \u201c\u6587\u5b57\u4e0e\u573a\u666f\u7684\u5173\u8054\u5173\u7cfb\u201d\uff0c\u4ece\u800c\u751f\u6210\u66f4\u7b26\u5408\u9700\u6c42\u7684\u56fe\u50cf\u3002\u540c\u65f6\uff0c\u5bf9\u4e8e\u89c6\u89c9\u95ee\u7b54\u3001\u56fe\u50cf\u68c0\u7d22\u7b49\u4efb\u52a1\uff0cOCR \u589e\u5f3a\u540e\u7684\u63cf\u8ff0\u4e5f\u80fd\u63d0\u5347\u4efb\u52a1\u7cbe\u5ea6\uff0c\u8ba9\u6a21\u578b\u66f4\u597d\u5730\u7406\u89e3\u56fe\u50cf\u7684\u6838\u5fc3\u542b\u4e49\u3002</p>"},{"location":"part3/3_3_video_audio/","title":"\u7b2c8\u7ae0\uff1a\u89c6\u9891\u4e0e\u97f3\u9891\u6570\u636e","text":""},{"location":"part3/3_3_video_audio/#8","title":"\u7b2c8\u7ae0\uff1a\u89c6\u9891\u4e0e\u97f3\u9891\u6570\u636e\u5904\u7406","text":""},{"location":"part3/3_3_video_audio/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u89c6\u9891\u6570\u636e\u662f\u591a\u6a21\u6001\u5927\u6a21\u578b\uff08LMM\uff09\u8bad\u7ec3\u4e2d\u6570\u636e\u91cf\u6700\u5927\u3001\u5904\u7406\u96be\u5ea6\u6700\u9ad8\u3001\u4fe1\u606f\u5bc6\u5ea6\u6700\u590d\u6742\u7684\u6a21\u6001\uff0c\u88ab\u8a89\u4e3a\u591a\u6a21\u6001\u5de5\u7a0b\u7684\u201c\u6df1\u6c34\u533a\u201d\u3002\u4e0e\u9759\u6001\u56fe\u50cf\u4e0d\u540c\uff0c\u89c6\u9891\u5f15\u5165\u4e86\u65f6\u95f4\u7ef4\u5ea6\uff08Temporal Dimension\uff09\uff0c\u8fd9\u610f\u5473\u7740\u6570\u636e\u4e0d\u4ec5\u4ec5\u662f\u50cf\u7d20\u7684\u5806\u53e0\uff0c\u66f4\u662f\u56e0\u679c\u903b\u8f91\u3001\u7269\u7406\u89c4\u5f8b\u548c\u8fd0\u52a8\u6a21\u5f0f\u7684\u8f7d\u4f53\u3002</p> <p>\u672c\u7ae0\u5c06\u7cfb\u7edf\u62c6\u89e3\u5982\u4f55\u5c06\u8fde\u7eed\u7684\u3001\u975e\u7ed3\u6784\u5316\u7684\u89c6\u9891\u6d41\u8f6c\u5316\u4e3a\u6a21\u578b\u53ef\u7406\u89e3\u7684\u79bb\u6563 Token\u3002\u6211\u4eec\u5c06\u4ece\u5e95\u5c42\u7684\u955c\u5934\u8fb9\u754c\u68c0\u6d4b\uff08Shot Boundary Detection\uff09\u5165\u624b\uff0c\u6df1\u5165\u89e3\u6790\u57fa\u4e8e\u5185\u5bb9\u7684\u5207\u5206\u7b97\u6cd5\uff1b\u8fdb\u800c\u5256\u6790\u89c6\u9891\u751f\u6210\u7684\u201c\u5fc3\u810f\u201d\u2014\u2014\u89c6\u9891 Tokenizer\uff0c\u5bf9\u6bd4 VQ-VAE \u4e0e Google DeepMind \u6700\u65b0 MagViT-v2 \u7684\u5e95\u5c42\u539f\u7406\uff1b\u6700\u540e\uff0c\u6211\u4eec\u5c06\u6f14\u793a\u5982\u4f55\u5229\u7528 WhisperX \u5b9e\u73b0\u97f3\u89c6\u9891\u7684\u5b57\u7ea7\uff08Word-level\uff09\u4e43\u81f3\u97f3\u7d20\u7ea7\uff08Phoneme-level\uff09\u7cbe\u51c6\u5bf9\u9f50\uff0c\u4e3a\u6a21\u578b\u6784\u5efa\u65f6\u7a7a\u540c\u6b65\u7684\u76d1\u7763\u4fe1\u53f7\u3002</p> <p>\u5b66\u4e60\u76ee\u6807\uff1a * \u5de5\u7a0b\u80fd\u529b\uff1a\u638c\u63e1\u4f7f\u7528 PySceneDetect \u7ed3\u5408 ffmpeg \u5173\u952e\u5e27\u5143\u6570\u636e\u8fdb\u884c\u4e24\u7ea7\u573a\u666f\u5207\u5206\uff08Coarse-to-Fine\uff09\u7684\u9ad8\u6548\u7b56\u7565\u3002 * \u7406\u8bba\u6df1\u5ea6\uff1a\u6df1\u5165\u7406\u89e3 Video Tokenization \u4e2d\u7684\u201cCodebook Collapse\u201d\uff08\u7801\u672c\u574d\u584c\uff09\u95ee\u9898\uff0c\u4ee5\u53ca MagViT-v2 \u5982\u4f55\u901a\u8fc7 Lookup-Free Quantization (LFQ) \u5f7b\u5e95\u89e3\u51b3\u8fd9\u4e00\u74f6\u9888\u3002 * \u6570\u636e\u7ba1\u7ebf\uff1a\u5b9e\u73b0\u57fa\u4e8e WhisperX \u7684 Forced Alignment \u6d41\u7a0b\uff0c\u89e3\u51b3\u591a\u8bf4\u8bdd\u4eba\u3001\u80cc\u666f\u566a\u97f3\u58f0\u5b66\u73af\u5883\u4e0b\u7684\u5b57\u5e55\u7cbe\u51c6\u5bf9\u9f50\u3002 * \u5b58\u50a8\u4f18\u5316\uff1a\u4e86\u89e3\u6d77\u91cf\u89c6\u9891\u6570\u636e\u7684\u5b58\u50a8\u5206\u7247\uff08Sharding\uff09\u4e0e\u9ad8\u6548\u52a0\u8f7d\u65b9\u6848\u3002</p> <p>\u573a\u666f\u5f15\u5165\uff1a</p> <p>\u201c\u60f3\u8c61\u4f60\u6b63\u5728\u8bad\u7ec3\u4e00\u4e2a\u50cf Sora \u4e00\u6837\u7684\u4e16\u754c\u6a21\u578b\u3002\u4f60\u4e0b\u8f7d\u4e86\u4e00\u90e8 2 \u5c0f\u65f6\u7684\u7535\u5f71\u300a\u6cf0\u5766\u5c3c\u514b\u53f7\u300b\u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\u3002</p> <p>\u5982\u679c\u4f60\u7b80\u5355\u7c97\u66b4\u5730\u6309\u6bcf 10 \u79d2\u4e00\u6bb5\u8fdb\u884c\u5207\u5206\uff0c\u4f60\u4f1a\u9047\u5230\u4e25\u91cd\u7684\u2018\u8bed\u4e49\u65ad\u88c2\u2019\uff1a\u4e00\u6bb5\u89c6\u9891\u7684\u524d 5 \u79d2\u662f\u7532\u677f\u4e0a\u5e73\u9759\u7684\u6d77\u98ce\uff0c\u540e 5 \u79d2\u7a81\u7136\u8df3\u5230\u4e86\u55a7\u95f9\u7684\u9910\u5385\u3002\u8fd9\u79cd\u8de8\u8d8a\u573a\u666f\u7684\u2018\u786c\u5207\u2019\uff08Hard Cut\uff09\u4f1a\u8ba9\u6a21\u578b\u611f\u5230\u56f0\u60d1\uff1a\u2018\u4eba\u662f\u600e\u4e48\u5728 0.1 \u79d2\u5185\u4ece\u5ba4\u5916\u77ac\u79fb\u5230\u5ba4\u5185\u7684\uff1f\u2019\u8fd9\u4e0d\u4ec5\u6d6a\u8d39\u4e86\u7b97\u529b\uff0c\u8fd8\u8ba9\u6a21\u578b\u5b66\u5230\u4e86\u9519\u8bef\u7684\u7269\u7406\u89c4\u5f8b\u3002</p> <p>\u6b64\u5916\uff0c\u58f0\u97f3\u7684\u65f6\u5e8f\u7cbe\u5ea6\u5c31\u662f\u751f\u547d\u3002\u5982\u679c\u4f60\u7684\u5b57\u5e55\u6bd4\u753b\u9762\u6162\u4e86 2 \u79d2\uff0c\u5f53\u753b\u9762\u4e2d Rose \u5728\u5f20\u5634\u65f6\uff0c\u5bf9\u5e94\u7684 Token \u5374\u662f Jack \u7684\u53f0\u8bcd\u3002\u6a21\u578b\u4f1a\u9519\u8bef\u5730\u5c06\u2018Jack\u7684\u58f0\u97f3\u7279\u5f81\u2019\u5173\u8054\u5230\u2018Rose\u7684\u9762\u90e8\u7279\u5f81\u2019\u4e0a\u3002\u5728\u4e07\u4ebf\u7ea7 Token \u7684\u8bad\u7ec3\u4e2d\uff0c\u8fd9\u79cd\u5fae\u5c0f\u7684\u9519\u4f4d\u4f1a\u88ab\u653e\u5927\u4e3a\u4e25\u91cd\u7684\u5e7b\u89c9\u3002\u201d</p>"},{"location":"part3/3_3_video_audio/#81-scene-detection","title":"8.1 \u89c6\u9891\u5904\u7406\u6d41\u6c34\u7ebf\uff1a\u573a\u666f\u5207\u5206 (Scene Detection)","text":"<p>\u89c6\u9891\u5728\u672c\u8d28\u4e0a\u5e76\u975e\u8fde\u7eed\u7684\u6d41\uff0c\u800c\u662f\u7531\u4e00\u4e2a\u4e2a\u72ec\u7acb\u7684\u201c\u955c\u5934\uff08Shot\uff09\u201d\u62fc\u63a5\u800c\u6210\u7684\u5e8f\u5217\u3002\u6bcf\u4e00\u4e2a\u955c\u5934\u4ee3\u8868\u4e86\u4e00\u6b21\u6444\u50cf\u673a\u7684\u5f00\u542f\u4e0e\u5173\u95ed\uff08\u6216\u89c6\u89d2\u7684\u8fde\u7eed\u79fb\u52a8\uff09\u3002\u8bad\u7ec3\u89c6\u9891\u751f\u6210\u6a21\u578b\uff08Video Generative Models\uff09\uff0c\u5fc5\u987b\u4fdd\u8bc1\u6bcf\u4e2a\u8bad\u7ec3\u6837\u672c\uff08Training Clip\uff09\u90fd\u5728\u540c\u4e00\u4e2a\u955c\u5934\u5185\uff0c\u786e\u4fdd\u65f6\u7a7a\u8fde\u7eed\u6027\uff08Spatio-Temporal Continuity\uff09\u3002</p>"},{"location":"part3/3_3_video_audio/#811-gop-i","title":"8.1.1 \u89c6\u9891\u7ed3\u6784\u7684\u5fae\u89c2\u89c6\u89d2\uff1aGOP \u4e0e I \u5e27","text":"<p>\u5728\u6df1\u5165\u5207\u5206\u7b97\u6cd5\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u7406\u89e3\u89c6\u9891\u7f16\u7801\u7684\u57fa\u7840\u3002</p> <ul> <li>I-Frame (Intra-coded picture)\uff1a\u5173\u952e\u5e27\u3002\u5b83\u662f\u4e00\u5f20\u5b8c\u6574\u7684\u56fe\u7247\uff0c\u4e0d\u4f9d\u8d56\u5176\u4ed6\u5e27\u5373\u53ef\u89e3\u7801\u3002\u901a\u5e38\u4e5f\u662f\u573a\u666f\u53d8\u6362\u7684\u8d77\u70b9\u3002</li> <li>P-Frame (Predicted picture)\uff1a\u524d\u5411\u9884\u6d4b\u5e27\u3002\u53ea\u5b58\u50a8\u4e0e\u524d\u4e00\u5e27\u7684\u5dee\u5f02\u3002</li> <li>B-Frame (Bi-predictive picture)\uff1a\u53cc\u5411\u9884\u6d4b\u5e27\u3002\u53c2\u8003\u524d\u540e\u5e27\u8fdb\u884c\u538b\u7f29\uff0c\u538b\u7f29\u7387\u6700\u9ad8\u3002</li> </ul> <p>GOP (Group of Pictures)\uff1a\u4e24\u4e2a I \u5e27\u4e4b\u95f4\u7684\u5e8f\u5217\u3002\u89c6\u9891\u64ad\u653e\u5668\u5728\u62d6\u52a8\u8fdb\u5ea6\u6761\u65f6\uff0c\u901a\u5e38\u4f1a\u201c\u5438\u9644\u201d\u5230\u6700\u8fd1\u7684 I \u5e27\uff0c\u56e0\u4e3a\u89e3\u7801\u5fc5\u987b\u4ece\u8fd9\u91cc\u5f00\u59cb\u3002\u6211\u4eec\u7684\u5207\u5206\u7b56\u7565\u5fc5\u987b\u5229\u7528\u8fd9\u4e00\u7279\u6027\u6765\u52a0\u901f\u3002</p>"},{"location":"part3/3_3_video_audio/#812","title":"8.1.2 \u7b97\u6cd5\u9009\u578b\u4e0e\u7b56\u7565","text":"<p> \u56fe 8-1\uff1a\u89c6\u9891\u573a\u666f\u5207\u5206\u7684\u4e24\u79cd\u7b56\u7565\u4e0eHSV\u76f4\u65b9\u56fe\u5dee\u5f02</p> <p>PySceneDetect \u662f\u4e1a\u754c\u6807\u51c6\u7684\u5f00\u6e90\u5de5\u5177\uff0c\u5b83\u63d0\u4f9b\u4e86\u591a\u79cd\u68c0\u6d4b\u5668\uff0c\u6838\u5fc3\u903b\u8f91\u57fa\u4e8e\u5e27\u95f4\u5dee\u5f02\u5206\u6790\uff1a</p> <ul> <li> <p>\u7b56\u7565\u4e00\uff1aThreshold Detector (\u9608\u503c\u68c0\u6d4b - \u9488\u5bf9\u786c\u5207)</p> <ul> <li>\u539f\u7406\uff1a\u8ba1\u7b97\u76f8\u90bb\u4e24\u5e27\u5728 HSV \u8272\u5f69\u7a7a\u95f4\u6216 RGB \u4eae\u5ea6\u4e0a\u7684\u5e73\u5747\u5dee\u5f02\u503c\uff08Delta\uff09\u3002\u5f53 Delta &gt; <code>threshold</code>\uff08\u5982 30.0\uff09\u65f6\uff0c\u5224\u5b9a\u4e3a\u5207\u70b9\u3002</li> <li>\u9002\u7528\uff1a\u7edd\u5927\u591a\u6570\u7535\u5f71\u548c\u7528\u6237\u4e0a\u4f20\u89c6\u9891\uff08UGC\uff09\u3002</li> <li>\u5c40\u9650\uff1a\u65e0\u6cd5\u68c0\u6d4b\u6e10\u53d8\u3002</li> </ul> </li> <li> <p>\u7b56\u7565\u4e8c\uff1aAdaptive Detector (\u81ea\u9002\u5e94\u68c0\u6d4b - \u9488\u5bf9\u6e10\u53d8/\u5feb\u8282\u594f)</p> <ul> <li>\u539f\u7406\uff1a\u4e0d\u518d\u4f7f\u7528\u56fa\u5b9a\u9608\u503c\uff0c\u800c\u662f\u7ef4\u62a4\u4e00\u4e2a\u6ed1\u52a8\u7a97\u53e3\uff08Sliding Window\uff09\u3002\u6bd4\u8f83\u201c\u5f53\u524d\u5e27\u201d\u4e0e\u201c\u7a97\u53e3\u5185\u5e73\u5747\u5e27\u5dee\u201d\u7684\u6bd4\u7387\u3002</li> <li>\u9002\u7528\uff1a\u6de1\u5165\u6de1\u51fa\uff08Fade In/Out\uff09\u3001\u53e0\u5316\uff08Dissolve\uff09\u6216\u50cf\u52a8\u4f5c\u7247\u90a3\u6837\u6444\u50cf\u673a\u5267\u70c8\u8fd0\u52a8\u7684\u573a\u666f\u3002</li> </ul> </li> </ul> <p>\u8fdb\u9636\u7b56\u7565\uff1a\u4e24\u7ea7\u7ea7\u8054\u5207\u5206 (Two-Stage Cascade Splitting) \u76f4\u63a5\u5bf9 TB \u7ea7\u89c6\u9891\u5168\u91cf\u89e3\u7801\u8fd0\u884c PySceneDetect \u975e\u5e38\u6162\u3002\u6211\u4eec\u63a8\u8350\u201c\u5148\u7c97\u540e\u7ec6\u201d\u7684\u5de5\u4e1a\u7ea7\u65b9\u6848\uff1a</p> <ol> <li>Level-1 (Metadata Scan)\uff1a\u5229\u7528 <code>ffprobe</code> \u5feb\u901f\u626b\u63cf\u89c6\u9891\u6d41\u5143\u6570\u636e\uff0c\u63d0\u53d6\u6240\u6709 I-Frame \u7684\u65f6\u95f4\u6233\u3002I-Frame \u5f80\u5f80\u51fa\u73b0\u5728\u573a\u666f\u5207\u6362\u5904\uff08\u7f16\u7801\u5668\u503e\u5411\u4e8e\u5728\u5267\u53d8\u5904\u63d2\u5165 I \u5e27\uff09\u3002\u6b64\u6b65\u9aa4\u65e0\u9700\u89e3\u7801\u753b\u9762\uff0c\u901f\u5ea6\u662f\u64ad\u653e\u901f\u5ea6\u7684 100 \u500d\u4ee5\u4e0a\u3002</li> <li>Level-2 (Content Analysis)\uff1a\u4ec5\u5728 Level-1 \u8bc6\u522b\u51fa\u7684\u6f5c\u5728\u5207\u70b9\u524d\u540e \u00b12 \u79d2\u8303\u56f4\u5185\uff0c\u8fd0\u884c PySceneDetect \u7684 <code>ContentDetector</code> \u8fdb\u884c\u7cbe\u786e\u7684\u5e27\u7ea7\u5b9a\u4f4d\u3002</li> </ol>"},{"location":"part3/3_3_video_audio/#813","title":"8.1.3 \u6838\u5fc3\u4ee3\u7801\uff1a\u573a\u666f\u5207\u5206\u4e0e\u65e0\u635f\u5206\u5272","text":"<p>\u4ee5\u4e0b\u4ee3\u7801\u6f14\u793a\u4e86\u751f\u4ea7\u73af\u5883\u4e2d\u7684\u6807\u51c6\u5207\u5206\u6d41\u7a0b\u3002\u6ce8\u610f\u5176\u4e2d\u7684\u201c\u6d41\u62f7\u8d1d\u201d\u6280\u5de7\uff0c\u8fd9\u662f\u5904\u7406\u6d77\u91cf\u89c6\u9891\u65f6\u907f\u514d\u5b58\u50a8\u7206\u70b8\u7684\u5173\u952e\u3002</p> <pre><code>from scenedetect import detect, ContentDetector, split_video_ffmpeg\nimport os\nimport logging\n\n# \u914d\u7f6e\u65e5\u5fd7\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')\n\ndef process_video_scenes(video_path, output_dir, threshold=27.0):\n    \"\"\"\n    \u68c0\u6d4b\u573a\u666f\u5e76\u4f7f\u7528 ffmpeg \u65e0\u635f\u5207\u5272\u89c6\u9891\n    Args:\n        video_path: \u8f93\u5165\u89c6\u9891\u8def\u5f84\n        output_dir: \u8f93\u51fa\u76ee\u5f55\n        threshold: \u5207\u5206\u9608\u503c (\u7ecf\u9a8c\u503c: 27.0 \u9002\u5408\u5927\u90e8\u5206 1080p \u89c6\u9891)\n    \"\"\"\n    if not os.path.exists(output_dir):\n        os.makedirs(output_dir)\n\n    logging.info(f\"Starting scene detection for: {video_path}\")\n\n    # 1. \u573a\u666f\u68c0\u6d4b\n    # threshold=27.0: \u57fa\u4e8e HSV \u7a7a\u95f4\u7684\u76f4\u65b9\u56fe\u5dee\u5f02\u9608\u503c\n    # min_scene_len=15: \u5ffd\u7565\u5c0f\u4e8e 0.5\u79d2 (30fps) \u7684\u7247\u6bb5\u3002\n    # \u6781\u77ed\u7684\u7247\u6bb5\u901a\u5e38\u662f\u95ea\u5149\u706f\u3001\u6545\u969c\u6216\u8005\u662f\u5207\u5206\u9519\u8bef\u7684\u566a\u97f3\uff0c\u4e0d\u9002\u5408\u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\u3002\n    scene_list = detect(\n        video_path, \n        ContentDetector(threshold=threshold, min_scene_len=15)\n    )\n\n    # 2. \u7edf\u8ba1\u4e0e\u8fc7\u6ee4\n    # \u5728\u6b64\u5904\u53ef\u4ee5\u6dfb\u52a0\u903b\u8f91\uff1a\u6bd4\u5982\u5408\u5e76\u8fc7\u77ed\u7684\u76f8\u90bb\u573a\u666f\uff0c\u6216\u8005\u4e22\u5f03\u5c0f\u4e8e 3 \u79d2\u7684\u573a\u666f\n    valid_scenes = []\n    for scene in scene_list:\n        start, end = scene\n        duration = (end.get_frames() - start.get_frames()) / start.get_framerate()\n        if duration &gt;= 3.0: # \u53ea\u4fdd\u7559\u5927\u4e8e3\u79d2\u7684\u7247\u6bb5\u7528\u4e8e\u8bad\u7ec3\n            valid_scenes.append(scene)\n\n    logging.info(f\"Detected {len(scene_list)} scenes, kept {len(valid_scenes)} valid scenes.\")\n\n    # 3. \u5206\u5272\u89c6\u9891 (Stream Copy)\n    # \u5173\u952e\u70b9\uff1aarg_override='-c:v copy -c:a copy'\n    # \u8fd9\u6307\u793a ffmpeg \u76f4\u63a5\u62f7\u8d1d\u4e8c\u8fdb\u5236\u6d41\uff0c\u4e0d\u8fdb\u884c [\u89e3\u7801 -&gt; \u50cf\u7d20 -&gt; \u7f16\u7801] \u7684\u8fc7\u7a0b\u3002\n    # \u4f18\u70b9 1\uff1a\u901f\u5ea6\u6781\u5feb\uff08\u53d7\u9650\u4e8e\u78c1\u76d8 I/O\uff0c\u800c\u975e CPU\uff09\u3002\n    # \u4f18\u70b9 2\uff1a\u753b\u8d28 100% \u65e0\u635f\uff0c\u6ca1\u6709\u4efb\u4f55\u91cd\u7f16\u7801\u5e26\u6765\u7684\u4f2a\u5f71\u3002\n    split_video_ffmpeg(\n        video_path, \n        valid_scenes, \n        output_dir=output_dir, \n        show_progress=True,\n        arg_override='-c:v copy -c:a copy' \n    )\n\n# \u907f\u5751\u6307\u5357\uff1a\u6570\u636e\u81a8\u80c0\u707e\u96be\n# \u5343\u4e07\u4e0d\u8981\u628a\u5207\u5206\u540e\u7684\u89c6\u9891\u89e3\u7801\u6210\u56fe\u7247\u5e8f\u5217\uff08png/jpg\uff09\u6216 numpy array \u957f\u671f\u5b58\u76d8\uff01\n# \u7b97\u4e00\u7b14\u8d26\uff1a\n# 1\u5c0f\u65f6 1080p H.264 \u89c6\u9891 \u2248 2GB\n# \u89e3\u7801\u540e\uff1a3600\u79d2 * 30\u5e27 * 1920 * 1080 * 3\u5b57\u8282 \u2248 670 GB\n# \u81a8\u80c0\u7cfb\u6570 &gt; 300\u500d\u3002\n# \u59cb\u7ec8\u5b58\u50a8\u538b\u7f29\u683c\u5f0f (mp4/mkv)\uff0c\u53ea\u5728\u8bad\u7ec3 DataLoader \u7684 __getitem__ \u4e2d\u5229\u7528 GPU (NVDEC) \u5b9e\u65f6\u89e3\u7801\u3002\n</code></pre>"},{"location":"part3/3_3_video_audio/#82-tokenization","title":"8.2 \u89c6\u9891 Tokenization\uff1a\u4ece\u50cf\u7d20\u6d77\u6d0b\u5230\u79bb\u6563\u5c9b\u5c7f","text":"<p>\u5bf9\u4e8e Sora\u3001Gen-2 \u8fd9\u6837\u57fa\u4e8e Transformer \u7684\u6269\u6563\u6a21\u578b\uff08DiT\uff09\uff0c\u76f4\u63a5\u5728\u50cf\u7d20\u7a7a\u95f4\uff08Pixel Space\uff09\u5efa\u6a21\u662f\u4e0d\u53ef\u884c\u7684\u3002\u4e00\u4e2a 4 \u79d2\u7684 1080p \u89c6\u9891\u5305\u542b\u7ea6 \\(3 \\times 10^8\\) \u4e2a\u50cf\u7d20\u70b9\uff0c\u8ba1\u7b97\u6ce8\u610f\u529b\u77e9\u9635\uff08Attention Matrix\uff09\u4f1a\u5bfc\u81f4\u663e\u5b58\u77ac\u95f4\u6ea2\u51fa\u3002</p> <p>\u56e0\u6b64\uff0c\u89c6\u9891\u5fc5\u987b\u5148\u88ab\u201c\u538b\u7f29\u201d\u6210\u6f5c\u5728\u7a7a\u95f4\uff08Latent Space\uff09\u7684\u79bb\u6563 Token\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u7531 Video Tokenizer \u5b8c\u6210\u3002</p>"},{"location":"part3/3_3_video_audio/#821-vq-vae","title":"8.2.1 \u4f20\u7edf\u65b9\u6848\u7684\u75db\u70b9\uff1aVQ-VAE \u4e0e\u201c\u6b7b\u7801\u201d","text":"<p>VQ-VAE (Vector Quantized Variational AutoEncoder) \u662f\u65e9\u671f\u89c6\u9891\u751f\u6210\u6a21\u578b\uff08\u5982 VideoGPT\uff09\u7684\u57fa\u77f3\u3002</p> <ul> <li> <p>\u6d41\u7a0b\uff1a</p> <ol> <li>Encoder\uff1a\u5c06\u89c6\u9891\u5207\u5206\u4e3a 3D Patch\uff08\u4f8b\u5982 \\(16 \\times 16 \\times 16\\) \u7684\u65f6\u7a7a\u5757\uff09\uff0c\u538b\u7f29\u6210\u4f4e\u7ef4\u5411\u91cf \\(z_e(x)\\)\u3002</li> <li>Quantization (\u91cf\u5316)\uff1a\u7ef4\u62a4\u4e00\u4e2a Codebook\uff08\u7801\u672c\uff09\uff0c\u5305\u542b \\(K\\) \u4e2a\u539f\u578b\u5411\u91cf\uff08Embedding\uff09\u3002\u5bf9\u4e8e\u6bcf\u4e2a \\(z_e(x)\\)\uff0c\u5728 Codebook \u4e2d\u627e\u5230\u6b27\u6c0f\u8ddd\u79bb\u6700\u8fd1\u7684\u5411\u91cf \\(e_k\\) \u6765\u66ff\u6362\u5b83\u3002</li> <li>Decoder\uff1a\u5229\u7528 \\(e_k\\) \u91cd\u5efa\u89c6\u9891\u3002</li> </ol> </li> <li> <p>\u81f4\u547d\u7f3a\u9677\uff1aCodebook Collapse (\u7801\u672c\u574d\u584c)     \u5728\u8bad\u7ec3\u521d\u671f\uff0c\u53ea\u6709\u5c11\u6570\u51e0\u4e2a Code\uff08\u4f8b\u5982 Code #5 \u548c Code #100\uff09\u5076\u7136\u88ab\u9009\u4e2d\u3002\u7531\u4e8e\u53ea\u6709\u88ab\u9009\u4e2d\u7684 Code \u624d\u4f1a\u83b7\u5f97\u68af\u5ea6\u66f4\u65b0\uff0c\u5b83\u4eec\u4f1a\u53d8\u5f97\u8d8a\u6765\u8d8a\u201c\u597d\u201d\uff0c\u4ece\u800c\u66f4\u5bb9\u6613\u88ab\u9009\u4e2d\u3002\u8fd9\u5c31\u5f62\u6210\u4e86\u201c\u5bcc\u8005\u6108\u5bcc\u201d\u7684\u9a6c\u592a\u6548\u5e94\u3002</p> <ul> <li>\u540e\u679c\uff1aCodebook \u4e2d 90% \u7684\u5411\u91cf\u53d8\u6210\u4e86\u201c\u6b7b\u7801\u201d\uff08Dead Codes\uff09\uff0c\u4ece\u672a\u88ab\u4f7f\u7528\u3002\u8fd9\u5bfc\u81f4\u6a21\u578b\u7684\u6709\u6548\u8bcd\u6c47\u91cf\u6781\u4f4e\uff0c\u751f\u6210\u7684\u89c6\u9891\u6a21\u7cca\u4e14\u7f3a\u4e4f\u7ec6\u8282\u3002</li> <li>\u8865\u6551\u63aa\u65bd\uff1a\u4f20\u7edf\u65b9\u6cd5\u9700\u8981\u590d\u6742\u7684 Reset \u7b56\u7565\uff08\u5982 k-means \u91cd\u7f6e\uff09\uff0c\u8bad\u7ec3\u6781\u4e0d\u7a33\u5b9a\u3002</li> </ul> </li> </ul>"},{"location":"part3/3_3_video_audio/#822-sota-magvit-v2-lfq","title":"8.2.2 SOTA \u65b9\u6848\uff1aMagViT-v2 \u4e0e LFQ","text":"<p>Google DeepMind \u5728 MagViT-v2 \u4e2d\u5f15\u5165\u4e86 LFQ (Lookup-Free Quantization)\uff0c\u5f7b\u5e95\u6539\u53d8\u4e86\u6e38\u620f\u89c4\u5219\u3002</p> <ul> <li> <p>\u6838\u5fc3\u601d\u60f3\uff1a\u4e0d\u67e5\u8868\uff0c\u76f4\u63a5\u7b97\u3002     LFQ \u629b\u5f03\u4e86\u201c\u5bfb\u627e\u6700\u8fd1\u90bb\u201d\u7684\u601d\u60f3\uff0c\u800c\u662f\u76f4\u63a5\u6839\u636e\u6f5c\u5728\u53d8\u91cf\uff08Latent Variable\uff09\u7684\u7b26\u53f7\uff08Sign\uff09\u751f\u6210 Token\u3002</p> </li> <li> <p>\u6570\u5b66\u539f\u7406\uff1a     \u5047\u8bbe Encoder \u8f93\u51fa\u7684\u6f5c\u5728\u5411\u91cf \\(z \\in \\mathbb{R}^D\\)\uff08\u4f8b\u5982\u7ef4\u5ea6 \\(D=18\\)\uff09\u3002     LFQ \u5bf9\u6bcf\u4e00\u7ef4\u8fdb\u884c\u4e8c\u503c\u5316\uff1a     $\\(q_i = \\begin{cases} 1 &amp; \\text{if } z_i &gt; 0 \\\\ 0 &amp; \\text{if } z_i \\le 0 \\end{cases}\\)$</p> <p>\u7136\u540e\uff0c\u5c06\u8fd9 \\(D\\) \u4e2a\u4e8c\u8fdb\u5236\u4f4d\u7ec4\u5408\u6210\u4e00\u4e2a\u6574\u6570\u7d22\u5f15\uff08Integer Index\uff09\uff1a $\\(\\text{Token ID} = \\sum_{i=0}^{D-1} q_i \\cdot 2^i\\)$</p> </li> <li> <p>\u4e3a\u4f55 LFQ \u662f\u98a0\u8986\u6027\u7684\uff1f</p> <ol> <li>\u65e0\u9650\u7684\u6709\u6548\u7801\u672c\uff1a\u5982\u679c \\(D=18\\)\uff0c\u5219\u81ea\u7136\u5f62\u6210\u7684\u7801\u672c\u5927\u5c0f\u4e3a \\(2^{18} = 262,144\\)\u3002\u6240\u6709\u8fd9\u4e9b Code \u90fd\u662f\u7531 \\(D\\) \u4e2a\u72ec\u7acb\u7684\u7ef4\u5ea6\u7ec4\u5408\u800c\u6210\uff0c\u6bcf\u4e2a\u7ef4\u5ea6\u90fd\u59cb\u7ec8\u53c2\u4e0e\u68af\u5ea6\u66f4\u65b0\u3002Codebook \u5229\u7528\u7387\u6052\u5b9a\u4e3a 100%\u3002</li> <li>\u96f6\u8ba1\u7b97\u6210\u672c\uff1a\u6ca1\u6709\u6602\u8d35\u7684\u201c\u5168\u7801\u672c\u8ddd\u79bb\u8ba1\u7b97\u201d\uff0c\u53ea\u6709\u7b80\u5355\u7684\u4f4d\u8fd0\u7b97\u3002</li> <li>\u65f6\u7a7a\u538b\u7f29\uff1aMagViT-v2 \u7ed3\u5408\u4e86 3D Causal CNN\uff0c\u5728\u538b\u7f29\u7a7a\u95f4\u7684\u540c\u65f6\u4fdd\u7559\u4e86\u65f6\u95f4\u56e0\u679c\u6027\uff08\u5373\u5f53\u524d\u7684 Token \u4e0d\u4f1a\u6cc4\u9732\u672a\u6765\u7684\u4fe1\u606f\uff09\uff0c\u8fd9\u5bf9\u751f\u6210\u6a21\u578b\u81f3\u5173\u91cd\u8981\u3002</li> </ol> </li> </ul>"},{"location":"part3/3_3_video_audio/#823","title":"8.2.3 \u67b6\u6784\u9009\u578b\u5bf9\u6bd4\u8868","text":"\u7279\u6027 VQ-VAE (TATS/VideoGPT) MagViT-v2 (LFQ) \u91cf\u5316\u673a\u5236 Nearest Neighbor Search (\u67e5\u8868) Sign Function (\u7b26\u53f7\u51fd\u6570\u6295\u5f71) \u8bcd\u6c47\u8868\u5927\u5c0f (Vocab) \u901a\u5e38 1024 - 8192 (\u53d7\u9650\u4e8e\u663e\u5b58\u548c\u574d\u584c) \\(2^{18}\\) (262k) \u751a\u81f3\u66f4\u5927\uff0c\u8f7b\u677e\u6269\u5c55 \u7801\u672c\u5229\u7528\u7387 \u4f4e (\u5bb9\u6613\u574d\u584c\uff0c\u9700 EMA \u7b49\u6280\u5de7) 100% (\u8bbe\u8ba1\u4e0a\u907f\u514d\u4e86\u574d\u584c) \u68af\u5ea6\u53cd\u4f20 \u9700 Straight-Through Estimator (STE) \u6539\u8fdb\u7684 Entropy Penalty + STE \u751f\u6210\u8d28\u91cf \u6613\u6a21\u7cca\uff0c\u7ec6\u8282\u7eb9\u7406\u4e22\u5931 \u6781\u5176\u6e05\u6670\uff0c\u751a\u81f3\u4f18\u4e8e\u539f\u7247 (\u53bb\u566a\u6548\u5e94) \u63a8\u7406\u901f\u5ea6 \u8f83\u6162 (\u5c24\u5176\u662f\u5927\u7801\u672c\u65f6) \u6781\u5feb --- <p>\u4ece VQ-VAE \u5230 MagViT-v2 \u7684\u6f14\u8fdb\u5e76\u975e\u7b80\u5355\u7684\u53c2\u6570\u4f18\u5316\uff0c\u800c\u662f\u89c6\u9891\u79bb\u6563\u5316\u6280\u672f\u7684\u4e00\u6b21\u8303\u5f0f\u8f6c\u79fb\uff08Paradigm Shift\uff09\u2014\u2014\u5373\u4ece\u201c\u57fa\u4e8e\u641c\u7d22\u7684\u8fd1\u4f3c\uff08Search-based Approximation\uff09\u201d\u5411\u201c\u57fa\u4e8e\u8ba1\u7b97\u7684\u6784\u9020\uff08Computation-based Construction\uff09\u201d\u7684\u8de8\u8d8a\u3002</p> <p>\u9996\u5148\uff0c\u5728\u8ba1\u7b97\u590d\u6742\u5ea6\u4e0e\u6269\u5c55\u6027\u65b9\u9762\uff0c\u4f20\u7edf\u7684 VQ-VAE \u5b58\u5728\u6839\u672c\u6027\u7684\u74f6\u9888\u3002\u5176\u91cf\u5316\u8fc7\u7a0b\u4f9d\u8d56\u4e8e\u6700\u8fd1\u90bb\u641c\u7d22\uff08Nearest Neighbor Search\uff09\uff0c\u9700\u8981\u8ba1\u7b97\u7279\u5f81\u5411\u91cf\u4e0e\u7801\u672c\u4e2d\u6240\u6709 \\(K\\) \u4e2a\u539f\u578b\u7684\u6b27\u6c0f\u8ddd\u79bb\uff0c\u5176\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a \\(O(K)\\)\u3002\u8fd9\u610f\u5473\u7740\u6269\u5927\u8bcd\u6c47\u8868\uff08Vocabulary Size\uff09\u4ee5\u63d0\u5347\u8868\u5f81\u80fd\u529b\u5c06\u76f4\u63a5\u5bfc\u81f4\u63a8\u7406\u5ef6\u8fdf\u7684\u7ebf\u6027\u589e\u957f\u3002\u76f8\u6bd4\u4e4b\u4e0b\uff0cMagViT-v2 \u5f15\u5165\u7684 LFQ (Lookup-Free Quantization) \u673a\u5236\u6452\u5f03\u4e86\u67e5\u8868\u64cd\u4f5c\uff0c\u8f6c\u800c\u5229\u7528\u7b26\u53f7\u51fd\u6570\uff08Sign Function\uff09\u5c06\u6f5c\u5728\u53d8\u91cf\u6295\u5f71\u4e3a\u4e8c\u8fdb\u5236\u4e32\u3002\u8fd9\u4e00\u8fc7\u7a0b\u5c06\u8ba1\u7b97\u590d\u6742\u5ea6\u6052\u5b9a\u964d\u7ef4\u81f3 \\(O(1)\\)\uff0c\u4f7f\u5f97\u6a21\u578b\u80fd\u591f\u5728\u4e0d\u727a\u7272\u63a8\u7406\u901f\u5ea6\u7684\u524d\u63d0\u4e0b\uff0c\u8f7b\u677e\u652f\u6491\u8d77 \\(2^{18}\\) \u751a\u81f3\u66f4\u5927\u7684\u8bcd\u6c47\u7a7a\u95f4\uff0c\u4ece\u800c\u89e3\u51b3\u4e86\u5927\u8bcd\u6c47\u8868\u4e0e\u4f4e\u5ef6\u8fdf\u4e0d\u53ef\u517c\u5f97\u7684\u77db\u76fe\u3002</p> <p>\u5176\u6b21\uff0c\u5728\u7801\u672c\u5229\u7528\u7387\u4e0e\u8bad\u7ec3\u7a33\u5b9a\u6027\u65b9\u9762\uff0c\u4e24\u8005\u8868\u73b0\u8fe5\u5f02\u3002VQ-VAE \u957f\u671f\u53d7\u56f0\u4e8e\u201c\u7801\u672c\u574d\u584c\uff08Codebook Collapse\uff09\u201d\u95ee\u9898\uff0c\u5373\u90e8\u5206\u7f16\u7801\u5411\u91cf\u56e0\u521d\u59cb\u5316\u6216\u68af\u5ea6\u5206\u914d\u4e0d\u5747\u800c\u4ece\u672a\u88ab\u6fc0\u6d3b\uff0c\u5bfc\u81f4\u6709\u6548\u8bcd\u6c47\u91cf\u8fdc\u5c0f\u4e8e\u8bbe\u8ba1\u503c\uff08\u901a\u5e38\u4ec5\u4e3a 1024-8192\uff09\u3002\u8fd9\u8feb\u4f7f\u7814\u7a76\u8005\u5f15\u5165 EMA\uff08\u6307\u6570\u79fb\u52a8\u5e73\u5747\uff09\u6216 k-means \u91cd\u7f6e\u7b49\u590d\u6742\u7684\u5de5\u7a0b\u6280\u5de7\u6765\u7ef4\u6301\u8bad\u7ec3\u3002\u800c MagViT-v2 \u7684 LFQ \u673a\u5236\u57fa\u4e8e\u5404\u7ef4\u5ea6\u7684\u72ec\u7acb\u4e8c\u503c\u5316\u7ec4\u5408\uff0c\u4ece\u6570\u5b66\u7ed3\u6784\u4e0a\u4fdd\u8bc1\u4e86\u7801\u672c\u7a7a\u95f4\u662f\u88ab\u201c\u7ec4\u5408\u751f\u6210\u201d\u800c\u975e\u201c\u79bb\u6563\u67e5\u627e\u201d\u7684\u3002\u53ea\u8981\u6f5c\u5728\u7a7a\u95f4\u7684\u5404\u4e2a\u7ef4\u5ea6\u4fdd\u6301\u6fc0\u6d3b\uff0c\u7ec4\u5408\u51fa\u7684\u7f16\u7801\u4fbf\u80fd\u81ea\u7136\u8986\u76d6\u6574\u4e2a\u7801\u672c\u7a7a\u95f4\uff0c\u5b9e\u73b0\u4e86\u7406\u8bba\u4e0a 100% \u7684\u7801\u672c\u5229\u7528\u7387\u3002</p> <p>\u7efc\u4e0a\u6240\u8ff0\uff0cMagViT-v2 \u901a\u8fc7 LFQ \u673a\u5236\u5b9e\u73b0\u4e86\u9ad8\u538b\u7f29\u7387\u3001\u9ad8\u4fdd\u771f\u5ea6\u4e0e\u4f4e\u8ba1\u7b97\u6210\u672c\u7684\u7edf\u4e00\uff0c\u5f7b\u5e95\u89e3\u51b3\u4e86\u4f20\u7edf VQ-VAE \u5728\u7ec6\u8282\u7eb9\u7406\u4e22\u5931\u548c\u65f6\u7a7a\u4e00\u81f4\u6027\u5dee\u7684\u7f3a\u9677\u3002\u5bf9\u4e8e\u6784\u5efa\u5982 Sora \u7ea7\u522b\u7684\u5927\u89c4\u6a21\u89c6\u9891\u751f\u6210\u6a21\u578b\u800c\u8a00\uff0cMagViT-v2 \u53ca\u5176\u884d\u751f\u7684 Tokenizer \u67b6\u6784\u5df2\u6210\u4e3a\u5f53\u524d\u5de5\u4e1a\u754c\u7684\u5404\u79cd\u9996\u9009\u65b9\u6848\u3002</p>"},{"location":"part3/3_3_video_audio/#83-whisperx-forced-alignment","title":"8.3 \u97f3\u9891\u5bf9\u9f50\uff1aWhisperX \u4e0e\u5f3a\u5236\u5bf9\u9f50 (Forced Alignment)","text":"<p>\u89c6\u9891\u4e0d\u4ec5\u662f\u89c6\u89c9\u6570\u636e\uff0c\u58f0\u97f3\uff08Audio\uff09\u63d0\u4f9b\u4e86\u5929\u7136\u7684\u3001\u65f6\u95f4\u5bc6\u96c6\u7684\u6587\u672c\u63cf\u8ff0\u3002\u5229\u7528\u97f3\u9891\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u6a21\u578b\u5b66\u4e60\u5230\u201c\u7206\u70b8\u58f0\u5bf9\u5e94\u706b\u5149\u201d\u3001\u201c\u54ed\u58f0\u5bf9\u5e94\u6d41\u6cea\u201d\u7b49\u591a\u6a21\u6001\u5173\u8054\u3002</p> <p>\u7136\u800c\uff0c\u666e\u901a\u7684 ASR\uff08\u5982\u539f\u59cb Whisper\uff09\u53ea\u80fd\u7ed9\u51fa\u201c\u53e5\u5b50\u7ea7\u201d\u7684\u65f6\u95f4\u6233\uff0c\u8bef\u5dee\u901a\u5e38\u5728 1-2 \u79d2\u3002\u8fd9\u5bf9\u4e8e\u7cbe\u7ec6\u7684\u89c6\u9891\u8bad\u7ec3\uff08\u5982\u5507\u5f62\u540c\u6b65 Lip-sync\uff09\u662f\u5b8c\u5168\u4e0d\u591f\u7684\u3002\u6211\u4eec\u9700\u8981 WhisperX\u3002</p> <p> \u56fe 8-2\uff1a\u666e\u901a ASR (Segment-level) \u4e0e WhisperX (Word/Phoneme-level) \u7684\u7cbe\u5ea6\u5bf9\u6bd4</p>"},{"location":"part3/3_3_video_audio/#831-forced-alignment","title":"8.3.1 \u4e3a\u4ec0\u4e48\u9700\u8981 Forced Alignment\uff1f","text":"<ul> <li>ASR (OpenAI Whisper)\uff1a<ul> <li>\u8f93\u51fa\uff1a<code>\"Hello world\"</code> -&gt; <code>Timestamp: [0.0s -&gt; 2.0s]</code></li> <li>\u95ee\u9898\uff1a\u6a21\u578b\u53ea\u77e5\u9053\u8fd9\u53e5\u8bdd\u843d\u5728\u8fd9\u4e24\u79d2\u5185\uff0c\u4e0d\u77e5\u9053 \"world\" \u5177\u4f53\u5728\u54ea\u4e00\u6beb\u79d2\u5f00\u59cb\u3002</li> </ul> </li> <li>Forced Alignment (WhisperX)\uff1a<ul> <li>\u539f\u7406\uff1a\u5148\u8f6c\u5f55\u51fa\u6587\u672c\uff0c\u7136\u540e\u5229\u7528\u4e00\u4e2a\u9884\u8bad\u7ec3\u7684\u58f0\u5b66\u6a21\u578b\uff08\u5982 Wav2Vec2\uff09\uff0c\u5c06\u6587\u672c\u4e2d\u7684\u97f3\u7d20\uff08Phonemes\uff09\u4e0e\u97f3\u9891\u6ce2\u5f62\u8fdb\u884c\u5f3a\u5236\u5339\u914d\u3002</li> <li>\u8f93\u51fa\uff1a<ul> <li><code>\"Hello\"</code>: <code>[0.12s -&gt; 0.58s]</code></li> <li><code>\"world\"</code>: <code>[0.85s -&gt; 1.45s]</code></li> </ul> </li> <li>\u4ef7\u503c\uff1a\u4f60\u53ef\u4ee5\u6784\u5efa\u8fd9\u6837\u7684\u8bad\u7ec3\u5bf9\uff1a\u5f53\u89c6\u9891\u5e27\u5904\u4e8e 0.85s \u65f6\uff0c\u5f3a\u5236\u6a21\u578b\u5173\u6ce8 \"world\" \u7684 Text Embedding\u3002\u8fd9\u662f\u591a\u6a21\u6001\u7cbe\u7ec6\u5bf9\u9f50\u7684\u57fa\u7840\u3002</li> </ul> </li> </ul>"},{"location":"part3/3_3_video_audio/#832-whisperx","title":"8.3.2 \u5de5\u7a0b\u5b9e\u73b0\uff1aWhisperX \u5168\u6d41\u7a0b\u6d41\u6c34\u7ebf","text":"<p>WhisperX \u662f\u4e00\u4e2a\u590d\u6742\u7684 Pipeline\uff0c\u7ed3\u5408\u4e86 VAD\uff08\u8bed\u97f3\u6d3b\u52a8\u68c0\u6d4b\uff09\u3001Whisper\uff08\u8f6c\u5f55\uff09\u3001Wav2Vec2\uff08\u5bf9\u9f50\uff09\u548c Pyannote\uff08\u8bf4\u8bdd\u4eba\u5206\u79bb\uff09\u3002</p> <pre><code>import whisperx\nimport gc\nimport torch\n\ndef align_audio_transcript(audio_file, device=\"cuda\", batch_size=16):\n    \"\"\"\n    \u4f7f\u7528 WhisperX \u8fdb\u884c\u8f6c\u5f55\u548c\u5b57\u7ea7\u5f3a\u5236\u5bf9\u9f50\n    \"\"\"\n    # Step 1: \u8f6c\u5f55 (Transcription)\n    # \u4f7f\u7528 Large-v2 \u6a21\u578b\u4fdd\u8bc1\u6587\u672c\u8f6c\u5f55\u7684\u51c6\u786e\u6027\n    # compute_type=\"float16\" \u80fd\u663e\u8457\u52a0\u901f\uff0c\u4f46\u9700\u8981 Ampere \u67b6\u6784\u4ee5\u4e0a\u663e\u5361 (A100/A10/3090/4090)\n    print(\"1. Loading Whisper model...\")\n    model = whisperx.load_model(\n        \"large-v2\", \n        device, \n        compute_type=\"float16\" \n    )\n\n    print(\"2. Transcribing...\")\n    audio = whisperx.load_audio(audio_file)\n    result = model.transcribe(audio, batch_size=batch_size)\n\n    # \u5173\u952e\u64cd\u4f5c\uff1a\u663e\u5b58\u7ba1\u7406\n    # Whisper \u6a21\u578b\u5de8\u5927\uff0c\u800c\u63a5\u4e0b\u6765\u7684 Alignment \u6a21\u578b\u4e5f\u662f\u663e\u5b58\u5927\u6237\u3002\n    # \u5fc5\u987b\u663e\u5f0f\u5220\u9664\u6a21\u578b\u5e76\u89e6\u53d1\u5783\u573e\u56de\u6536\uff0c\u5426\u5219\u6781\u6613 OOM (Out of Memory)\u3002\n    del model\n    gc.collect()\n    torch.cuda.empty_cache()\n\n    # Step 2: \u5f3a\u5236\u5bf9\u9f50 (Forced Alignment)\n    # \u81ea\u52a8\u52a0\u8f7d\u5bf9\u5e94\u8bed\u8a00\u7684 Wav2Vec2 \u6a21\u578b (\u5982\u82f1\u8bed\u7528 wav2vec2-large-960h)\n    print(\"3. Aligning...\")\n    model_a, metadata = whisperx.load_align_model(\n        language_code=result[\"language\"], \n        device=device\n    )\n\n    # align() \u51fd\u6570\u6267\u884c\u7c7b\u4f3c\u52a8\u6001\u89c4\u5212\uff08Dynamic Programming\uff09\u7684\u7b97\u6cd5\n    # \u5bfb\u627e\u6587\u672c\u97f3\u7d20\u5e8f\u5217\u4e0e\u97f3\u9891\u6ce2\u5f62\u7279\u5f81\u4e4b\u95f4\u7684\u6700\u4f73\u5339\u914d\u8def\u5f84\n    aligned_result = whisperx.align(\n        result[\"segments\"], \n        model_a, \n        metadata, \n        audio, \n        device, \n        return_char_alignments=False # \u8bbe\u4e3a True \u53ef\u83b7\u5f97\u5b57\u7b26\u7ea7\u5bf9\u9f50\uff08\u5982\u7528\u4e8e\u5361\u62c9OK\u5b57\u5e55\uff09\n    )\n\n    # \u7ed3\u679c\u5305\u542b word_segments\uff0c\u5176\u4e2d\u6709\u6bcf\u4e2a\u5355\u8bcd\u7684\u7cbe\u786e start/end\n    # \u4f8b\u5982: [{'word': 'Hello', 'start': 0.1, 'end': 0.5, 'score': 0.98}, ...]\n    return aligned_result\n\n# \u8fdb\u9636\u63d0\u793a\uff1a\n# \u5982\u679c\u9700\u8981\u533a\u5206\u662f\u8c01\u5728\u8bf4\u8bdd\uff08Speaker Diarization\uff09\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u8c03\u7528\uff1a\n# diarize_model = whisperx.DiarizationPipeline(use_auth_token=\"YOUR_HF_TOKEN\", device=device)\n# diarize_segments = diarize_model(audio)\n# whisperx.assign_word_speakers(diarize_segments, aligned_result)\n</code></pre>"},{"location":"part3/3_3_video_audio/#833","title":"8.3.3 \u751f\u4ea7\u73af\u5883\u907f\u5751\u6307\u5357","text":"<ol> <li> <p>VAD \u8bef\u5224\u4e0e\u80cc\u666f\u97f3\u4e50\u5e72\u6270\uff1a</p> <ul> <li>\u95ee\u9898\uff1aWhisperX \u6781\u5176\u4f9d\u8d56 VAD \u6765\u5207\u5206\u9759\u97f3\u7247\u6bb5\u3002\u5982\u679c\u89c6\u9891 BGM\uff08\u80cc\u666f\u97f3\u4e50\uff09\u5f88\u54cd\uff0cVAD \u4f1a\u8ba4\u4e3a\u6574\u6bb5\u90fd\u662f\u4eba\u58f0\uff0c\u6216\u8005\u53cd\u4e4b\uff0c\u628a\u4eba\u58f0\u6df9\u6ca1\u3002</li> <li>\u89e3\u51b3\u65b9\u6848\uff1a\u5f15\u5165 Demucs \u6216 Spleeter \u8fdb\u884c\u6e90\u5206\u79bb\uff08Source Separation\uff09\u3002</li> <li>\u6d41\u7a0b\uff1a<code>Raw Audio</code> -&gt; <code>Demucs (Extract Vocal Track)</code> -&gt; <code>WhisperX</code>\u3002\u4ec5\u5c06\u63d0\u53d6\u51fa\u7684\u7eaf\u4eba\u58f0\u8f68\u9053\u9001\u5165\u8bc6\u522b\uff0c\u53ef\u4ee5\u5927\u5e45\u63d0\u9ad8\u51c6\u786e\u7387\u3002</li> </ul> </li> <li> <p>\u591a\u8bf4\u8bdd\u4eba\u91cd\u53e0 (Overlapping Speech)\uff1a</p> <ul> <li>\u95ee\u9898\uff1aWhisper \u5bf9\u4e8e\u591a\u4eba\u540c\u65f6\u8bf4\u8bdd\uff08Cocktail Party Problem\uff09\u5904\u7406\u80fd\u529b\u8f83\u5f31\uff0c\u901a\u5e38\u53ea\u80fd\u8f6c\u5f55\u58f0\u97f3\u6700\u5927\u7684\u4eba\uff0c\u6216\u8005\u751f\u6210\u6df7\u4e71\u7684\u6587\u672c\u3002</li> <li>\u89e3\u51b3\u65b9\u6848\uff1a\u5f00\u542f <code>diarization=True</code>\u3002\u867d\u7136\u8fd9\u4f1a\u589e\u52a0 30%-50% \u7684\u63a8\u7406\u65f6\u95f4\uff0c\u4f46\u5bf9\u4e8e\u7535\u89c6\u5267\u3001\u8bbf\u8c08\u7c7b\u89c6\u9891\u6570\u636e\uff0c\u8fd9\u662f\u533a\u5206\u201c\u8c01\u5728\u8bf4\u4ec0\u4e48\u201d\u7684\u552f\u4e00\u65b9\u6cd5\uff0c\u907f\u514d\u6a21\u578b\u6df7\u6dc6\u89d2\u8272\u8eab\u4efd\u3002</li> </ul> </li> <li> <p>\u5e7b\u89c9\u65f6\u95f4\u6233\uff1a</p> <ul> <li>\u95ee\u9898\uff1a\u5728\u957f\u65f6\u95f4\u9759\u97f3\u6216\u7eaf\u97f3\u4e50\u7247\u6bb5\uff0cWhisper \u6709\u65f6\u4f1a\u4ea7\u751f\u201c\u5e7b\u89c9\u201d\uff0c\u91cd\u590d\u8f93\u51fa\u4e0a\u4e00\u53e5\u6b4c\u8bcd\uff0c\u5e76\u7ed9\u51fa\u4e00\u4e2a\u9519\u8bef\u7684\u65f6\u95f4\u6233\u3002</li> <li>\u68c0\u67e5\uff1a\u5728\u540e\u5904\u7406\u4e2d\uff0c\u68c0\u67e5 <code>word['score']</code>\uff08\u7f6e\u4fe1\u5ea6\uff09\u3002\u5982\u679c\u8fde\u7eed\u4e00\u4e32\u5355\u8bcd\u7684\u7f6e\u4fe1\u5ea6\u4f4e\u4e8e 0.4\uff0c\u5efa\u8bae\u4e22\u5f03\u8be5\u7247\u6bb5\u7684\u5bf9\u9f50\u4fe1\u606f\u3002</li> </ul> </li> </ol>"},{"location":"part4/4_1_sft_data/","title":"\u7b2c9\u7ae0\uff1a\u6307\u4ee4\u5fae\u8c03\u6570\u636e","text":""},{"location":"part4/4_1_sft_data/#9-sft-data","title":"\u7b2c9\u7ae0\uff1a\u6307\u4ee4\u5fae\u8c03\u6570\u636e (SFT Data) \u2014\u2014 \u6784\u5efa\u6a21\u578b\u7684\u201c\u884c\u4e3a\u51c6\u5219\u201d","text":""},{"location":"part4/4_1_sft_data/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u672c\u7ae0\u5c06\u6df1\u5165\u63a2\u8ba8\u5927\u8bed\u8a00\u6a21\u578b\uff08LLM\uff09\u751f\u547d\u5468\u671f\u4e2d\u81f3\u5173\u91cd\u8981\u7684\u4e00\u73af\u2014\u2014\u4ece\u201c\u901a\u7528\u9884\u8bad\u7ec3\u201d\u5230\u201c\u7279\u5b9a\u6307\u4ee4\u9075\u5faa\u201d\u7684\u5173\u952e\u8f6c\u53d8\u3002\u6211\u4eec\u5c06\u8df3\u51fa\u7b80\u5355\u7684\u6570\u636e\u6536\u96c6\u5c42\u9762\uff0c\u6df1\u5165\u7814\u7a76\u5982\u4f55\u901a\u8fc7\u9ad8\u5ea6\u5de5\u7a0b\u5316\u7684 Prompt \u4f53\u7cfb\u548c\u81ea\u52a8\u5316\u6d41\u6c34\u7ebf\uff08Self-Instruct\u3001Evol-Instruct\uff09\u6765\u6784\u5efa\u9ad8\u8d28\u91cf\u7684 SFT\uff08Supervised Fine-Tuning\uff09\u6570\u636e\u96c6\u3002\u9664\u4e86\u6280\u672f\u5b9e\u73b0\uff0c\u672c\u7ae0\u8fd8\u5c06\u5256\u6790\u80cc\u540e\u7684\u7406\u8bba\u4f9d\u636e\uff1a\u4e3a\u4f55\u5c11\u91cf\u9ad8\u8d28\u91cf\u6570\u636e\u80fd\u64ac\u52a8\u5de8\u5927\u7684\u6a21\u578b\u80fd\u529b\uff1f\u6211\u4eec\u5c06\u91cd\u70b9\u89e3\u51b3\u6570\u636e\u591a\u6837\u6027\u4e0d\u8db3\u3001\u6307\u4ee4\u590d\u6742\u5ea6\u4e0d\u591f\u4ee5\u53ca\u63a8\u7406\u80fd\u529b\u7f3a\u5931\u7684\u95ee\u9898\uff0c\u6700\u7ec8\u6253\u9020\u4e00\u4e2a\u65e2\u61c2\u77e5\u8bc6\u53c8\u61c2\u89c4\u77e9\u7684\u667a\u80fd\u4f53\u3002</p>"},{"location":"part4/4_1_sft_data/#learning-objectives","title":"\u5b66\u4e60\u76ee\u6807 (Learning Objectives)","text":"<ul> <li>\u638c\u63e1\u8fed\u4ee3\u5f0f System Prompt \u5de5\u7a0b\uff1a\u80fd\u591f\u7f16\u5199\u63a7\u5236\u6a21\u578b\u8f93\u51fa\u683c\u5f0f\u3001\u98ce\u683c\u4e0e\u6df1\u5ea6\u7684 System Prompt\uff0c\u7406\u89e3\u89d2\u8272\u8bbe\u5b9a\u5bf9\u6570\u636e\u5206\u5e03\u7684\u5f71\u54cd\u3002</li> <li>\u6df1\u5165\u7406\u89e3\u81ea\u52a8\u5316\u6570\u636e\u751f\u6210\u6d41\u6c34\u7ebf\uff1a\u80fd\u591f\u590d\u73b0\u5e76\u6539\u8fdb Self-Instruct \u548c Evol-Instruct \u7b97\u6cd5\uff0c\u4ece\u96f6\u6784\u5efa\u9886\u57df\u6307\u4ee4\u96c6\uff0c\u7406\u89e3\u5176\u80cc\u540e\u7684\u201c\u6559\u5e08-\u5b66\u751f\u201d\u84b8\u998f\u903b\u8f91\u3002</li> <li>\u5b66\u4f1a\u6784\u9020\u601d\u7ef4\u94fe (Chain-of-Thought, CoT) \u6570\u636e\uff1a\u901a\u8fc7\u663e\u5f0f\u63a8\u7406\u6b65\u9aa4\u589e\u5f3a\u6a21\u578b\u7684\u903b\u8f91\u80fd\u529b\uff0c\u6253\u7834 Transformer \u7684\u201c\u9ed1\u76d2\u201d\u6620\u5c04\u3002</li> <li>\u8bbe\u8ba1\u6570\u636e\u8fc7\u6ee4\u4e0e\u53bb\u91cd\u673a\u5236\uff1a\u638c\u63e1\u4ece ROUGE \u53bb\u91cd\u5230\u8bed\u4e49\u5411\u91cf\u805a\u7c7b\u7684\u9ad8\u7ea7\u6e05\u6d17\u7b56\u7565\uff0c\u786e\u4fdd\u5408\u6210\u6570\u636e\u7684\u8d28\u91cf\u4e0e\u591a\u6837\u6027\u3002</li> </ul> <p>\u573a\u666f\u5f15\u5165\uff1a \u201c\u60f3\u8c61\u4e00\u4e0b\uff0c\u4f60\u7684\u56e2\u961f\u521a\u521a\u9884\u8bad\u7ec3\u5b8c\u4e00\u4e2a 70B \u53c2\u6570\u7684\u57fa\u5ea7\u6a21\u578b\uff0c\u6d88\u8017\u4e86\u6570\u767e\u4e07\u7f8e\u5143\u7684\u7b97\u529b\uff0c\u9605\u8bfb\u4e86\u4e92\u8054\u7f51\u4e0a\u51e0\u4e4e\u6240\u6709\u7684\u6587\u672c\u3002\u6b64\u65f6\u7684\u5b83\u50cf\u662f\u4e00\u4e2a\u535a\u5b66\u4f46\u81ea\u95ed\u7684\u56fe\u4e66\u9986\u7ba1\u7406\u5458\uff0c\u8111\u5b50\u91cc\u88c5\u6ee1\u4e86\u838e\u58eb\u6bd4\u4e9a\u7684\u5267\u672c\u3001Python \u4ee3\u7801\u548c\u91cf\u5b50\u529b\u5b66\u516c\u5f0f\u3002\u7136\u800c\uff0c\u5f53\u4f60\u5728\u6f14\u793a\u4f1a\u4e0a\u5174\u594b\u5730\u8f93\u5165\u2018\u8bf7\u5e2e\u6211\u5236\u5b9a\u4e00\u4e2a\u51cf\u80a5\u8ba1\u5212\u2019\u65f6\uff0c\u6a21\u578b\u5374\u53ea\u662f\u673a\u68b0\u5730\u7eed\u5199\u4e86\u2018\u2026\u2026\u662f\u4e00\u4e2a\u5f88\u597d\u7684\u76ee\u6807\uff0c\u901a\u5e38\u5305\u62ec\u996e\u98df\u548c\u8fd0\u52a8\u2019\uff0c\u751a\u81f3\u5f00\u59cb\u63a5\u7740\u5199\u2018\u51cf\u80a5\u8ba1\u5212\u7684\u5b9a\u4e49\u2019\uff0c\u7136\u540e\u751f\u6210\u4e86\u4e00\u5806\u7ef4\u57fa\u767e\u79d1\u5f0f\u7684\u5e9f\u8bdd\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4f1a\u8fd9\u6837\uff1f\u56e0\u4e3a\u57fa\u5ea7\u6a21\u578b\uff08Base Model\uff09\u7684\u8bad\u7ec3\u76ee\u6807\u662f\u2018\u9884\u6d4b\u4e0b\u4e00\u4e2a Token\u2019\uff0c\u5b83\u5e76\u4e0d\u7406\u89e3\u2018\u6307\u4ee4\u2019\u4e0e\u2018\u56de\u590d\u2019\u7684\u4ea4\u4e92\u6a21\u5f0f\u3002\u4e3a\u4e86\u8ba9\u8fd9\u4e2a\u2018\u535a\u5b66\u5bb6\u2019\u53d8\u6210\u61c2\u4f60\u610f\u56fe\u7684\u2018\u8d34\u8eab\u52a9\u7406\u2019\uff0c\u4f60\u9700\u8981\u7ed9\u5b83\u5582\u98df\u6210\u5343\u4e0a\u4e07\u6761\u9ad8\u8d28\u91cf\u7684\u95ee\u7b54\u5bf9\uff0c\u6559\u5b83\u5982\u4f55\u8bf4\u8bdd\u3001\u5982\u4f55\u901a\u8fc7\u6b65\u9aa4\u89e3\u51b3\u95ee\u9898\u3002\u4f46\u624b\u52a8\u7f16\u5199 10 \u4e07\u6761\u6307\u4ee4\u65e2\u6602\u8d35\u53c8\u7f13\u6162\uff0c\u4e14\u4eba\u7c7b\u7684\u60f3\u8c61\u529b\u5f80\u5f80\u5c40\u9650\u4e8e\u7279\u5b9a\u6a21\u5f0f\u3002\u5982\u4f55\u5728\u4e0d\u4f9d\u8d56\u5927\u89c4\u6a21\u4eba\u5de5\u6807\u6ce8\u7684\u60c5\u51b5\u4e0b\uff0c\u81ea\u52a8\u5316\u751f\u4ea7\u51fa\u65e2\u590d\u6742\u53c8\u591a\u6837\u7684\u9ad8\u8d28\u91cf\u8bad\u7ec3\u6570\u636e\uff1f\u8fd9\u5c31\u662f\u672c\u7ae0\u8981\u89e3\u51b3\u7684\u6838\u5fc3\u5de5\u7a0b\u6311\u6218\u3002\u201d</p>"},{"location":"part4/4_1_sft_data/#91-concepts-principles","title":"9.1. \u6838\u5fc3\u6982\u5ff5\u4e0e\u539f\u7406 (Concepts &amp; Principles)","text":"<p>\u5728 SFT \u9636\u6bb5\uff0c\u4e1a\u754c\u5df2\u7ecf\u8fbe\u6210\u5171\u8bc6\uff1a\u6570\u636e\u7684\u8d28\u91cf\u8fdc\u6bd4\u6570\u91cf\u91cd\u8981\u3002\u6211\u4eec\u9700\u8981\u7684\u6570\u636e\u4e0d\u4ec5\u4ec5\u662f\u201c\u8f93\u5165-\u8f93\u51fa\u201d\u5bf9\uff0c\u800c\u662f\u6db5\u76d6\u4e86\u5404\u79cd\u4efb\u52a1\u7c7b\u578b\u3001\u590d\u6742\u5ea6\u5c42\u7ea7\u548c\u63a8\u7406\u6a21\u5f0f\u7684\u6837\u672c\u3002</p>"},{"location":"part4/4_1_sft_data/#911-the-surface-form-hypothesis","title":"9.1.1 \u4e3a\u4ec0\u4e48\u8d28\u91cf\u6bd4\u6570\u91cf\u66f4\u91cd\u8981\uff1f\u2014\u2014 \u8868\u9762\u5f62\u5f0f\u5047\u8bbe (The Surface Form Hypothesis)","text":"<p>\u5f88\u591a\u521d\u5b66\u8005\u4f1a\u8bef\u4ee5\u4e3a SFT \u662f\u4e3a\u4e86\u8ba9\u6a21\u578b\u201c\u5b66\u4e60\u65b0\u77e5\u8bc6\u201d\u3002\u7136\u800c\uff0c\u57fa\u4e8e LIMA (Less Is More for Alignment) \u7b49\u7ecf\u5178\u7814\u7a76\u7684\u53d1\u73b0\uff0cSFT \u7684\u6838\u5fc3\u4f5c\u7528\u5e76\u975e\u6ce8\u5165\u77e5\u8bc6\uff0c\u800c\u662f\u5bf9\u9f50\u683c\u5f0f\u3002</p> <p>\u8868\u9762\u5f62\u5f0f\u5047\u8bbe\u8ba4\u4e3a\uff0c\u6a21\u578b\u5728\u9884\u8bad\u7ec3\u9636\u6bb5\u5df2\u7ecf\u638c\u63e1\u4e86\u7edd\u5927\u591a\u6570\u7684\u4e16\u754c\u77e5\u8bc6\u548c\u903b\u8f91\u80fd\u529b\uff0cSFT \u4ec5\u4ec5\u662f\u6559\u4f1a\u6a21\u578b\u4e00\u79cd\u7279\u5b9a\u7684\u201c\u4ea4\u4e92\u683c\u5f0f\u201d\u6216\u201c\u98ce\u683c\u201d\uff0c\u4ee5\u4fbf\u80fd\u591f\u63d0\u53d6\u51fa\u9884\u8bad\u7ec3\u9636\u6bb5\u6f5c\u85cf\u7684\u80fd\u529b\u3002\u6362\u53e5\u8bdd\u8bf4\uff0c\u5982\u679c\u9884\u8bad\u7ec3\u662f\u8ba9\u6a21\u578b\u8bfb\u5b8c\u4e86\u4e00\u6574\u5ea7\u56fe\u4e66\u9986\u7684\u4e66\uff0cSFT \u53ea\u662f\u6559\u5b83\u5982\u4f55\u7528\u4eba\u7c7b\u559c\u6b22\u7684\u53e3\u543b\u6765\u56de\u7b54\u95ee\u9898\uff0c\u800c\u4e0d\u662f\u6559\u5b83\u4e66\u91cc\u7684\u5185\u5bb9\u3002</p> <p>\u8fd9\u5c31\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u4e00\u65e6\u6570\u636e\u5305\u542b\u9519\u8bef\u3001\u566a\u97f3\u6216\u903b\u8f91\u65ad\u5c42\uff0c\u6a21\u578b\u7684\u8868\u73b0\u4f1a\u6025\u5267\u4e0b\u964d\u2014\u2014\u56e0\u4e3a\u6a21\u578b\u6b63\u5728\u5b66\u4e60\u201c\u5982\u4f55\u8c03\u7528\u77e5\u8bc6\u7684\u7d22\u5f15\u201d\uff0c\u5982\u679c\u7d22\u5f15\u9519\u4e86\uff0c\u77e5\u8bc6\u518d\u4e30\u5bcc\u4e5f\u65e0\u6cd5\u88ab\u6b63\u786e\u68c0\u7d22\u3002\u56e0\u6b64\uff0c\u51e0\u5343\u6761\u9ad8\u8d28\u91cf\u3001\u9ad8\u591a\u6837\u6027\u7684\u6570\u636e\uff0c\u5f80\u5f80\u6bd4\u51e0\u767e\u4e07\u6761\u4f4e\u8d28\u91cf\u3001\u540c\u8d28\u5316\u7684\u6570\u636e\u66f4\u80fd\u8bad\u7ec3\u51fa\u4f18\u79c0\u7684\u6a21\u578b\u3002</p>"},{"location":"part4/4_1_sft_data/#912-prompt-engineering","title":"9.1.2 Prompt Engineering \u7684\u5de5\u7a0b\u5316\u89c6\u89d2","text":"<p>\u5728\u6570\u636e\u5408\u6210\u4e2d\uff0cPrompt \u4e0d\u518d\u662f\u7b80\u5355\u7684\u5bf9\u8bdd\u8f93\u5165\uff0c\u800c\u662f\u751f\u6210\u6570\u636e\u7684\u6e90\u4ee3\u7801\u3002\u6211\u4eec\u5c06 Prompt \u89c6\u4e3a\u4e00\u79cd\u53ef\u7f16\u7a0b\u7684\u6a21\u5757\uff0c\u901a\u8fc7\u8fed\u4ee3\u4f18\u5316\u6765\u63a7\u5236\u5408\u6210\u6570\u636e\u7684\u5206\u5e03\u3002\u4e00\u4e2a\u4f18\u79c0\u7684 Prompt \u4f53\u7cfb\u901a\u5e38\u5305\u542b\u4ee5\u4e0b\u7ec4\u4ef6\uff1a</p> <ul> <li>System Prompt (\u7cfb\u7edf\u63d0\u793a\u8bcd)\uff1a \u5b9a\u4e49\u4e86\u6570\u636e\u751f\u6210\u5668\u7684\u201c\u4eba\u8bbe\u201d\u548c\u201c\u8fb9\u754c\u201d\u3002\u8fd9\u4e0d\u4ec5\u4ec5\u662f\u8d4b\u4e88\u4e00\u4e2a\u8eab\u4efd\uff0c\u66f4\u662f\u4e3a\u4e86\u901a\u8fc7\u89d2\u8272\u626e\u6f14\uff08Role-Playing\uff09\u6765\u6fc0\u6d3b\u5927\u6a21\u578b\u6f5c\u5728\u7684\u7279\u5b9a\u9886\u57df\u8bcd\u6c47\u5206\u5e03\u3002\u4f8b\u5982\uff0c\u626e\u6f14\u201c\u4e25\u8c28\u7684\u5f8b\u5e08\u201d\u548c\u201c\u70ed\u60c5\u7684\u9500\u552e\u201d\u4f1a\u751f\u6210\u622a\u7136\u4e0d\u540c\u7684\u53e5\u5f0f\u7ed3\u6784\u3002</li> <li>Few-Shot Examples (\u5c11\u6837\u672c\u793a\u4f8b)\uff1a \u901a\u8fc7 In-Context Learning (\u4e0a\u4e0b\u6587\u5b66\u4e60) \u951a\u5b9a\u8f93\u51fa\u7684\u683c\u5f0f\u548c\u98ce\u683c\u3002\u8fd9\u4e9b\u793a\u4f8b\u8d77\u5230\u4e86\u201c\u53bb\u566a\u201d\u7684\u4f5c\u7528\uff0c\u544a\u8bc9\u6a21\u578b\u201c\u8fd9\u5c31\u662f\u6211\u60f3\u8981\u7684\u6807\u51c6\u7b54\u6848\u201d\u3002</li> <li>Negative Constraints (\u8d1f\u5411\u7ea6\u675f)\uff1a \u660e\u786e\u7981\u6b62\u6a21\u578b\u751f\u6210\u67d0\u79cd\u6a21\u5f0f\u7684\u6570\u636e\u3002\u5728\u5927\u6a21\u578b\u751f\u6210\u4e2d\uff0c\u6a21\u578b\u5f80\u5f80\u503e\u5411\u4e8e\u5077\u61d2\u6216\u4f7f\u7528\u5e38\u89c1\u7684\u9648\u8bcd\u6ee5\u8c03\uff08Clich\u00e9s\uff09\uff0c\u8d1f\u5411\u7ea6\u675f\u662f\u6253\u7834\u8fd9\u79cd\u7edf\u8ba1\u60ef\u6027\u7684\u5173\u952e\u624b\u6bb5\uff08\u4f8b\u5982\uff1a\u201c\u4e0d\u8981\u4f7f\u7528\u2018\u4ece\u524d\u6709\u5ea7\u5c71\u2019\u4f5c\u4e3a\u6545\u4e8b\u5f00\u5934\u201d\uff09\u3002</li> </ul>"},{"location":"part4/4_1_sft_data/#913","title":"9.1.3 \u81ea\u52a8\u5316\u6784\u9020\u65b9\u6cd5\u8bba","text":"<p>\u4e3a\u4e86\u7a81\u7834\u4eba\u7c7b\u6570\u636e\u7684\u74f6\u9888\uff0c\u4e1a\u754c\u6f14\u5316\u51fa\u4e86\u4e24\u79cd\u6838\u5fc3\u7b56\u7565\u3002\u7406\u89e3\u8fd9\u4e24\u8005\u7684\u533a\u522b\u5bf9\u4e8e\u6784\u5efa\u5e73\u8861\u7684\u6570\u636e\u96c6\u81f3\u5173\u91cd\u8981\u3002</p> <ul> <li>Self-Instruct (\u81ea\u6211\u6307\u4ee4)\uff1a \u4fa7\u91cd\u4e8e\u5e7f\u5ea6 (Breadth)\u3002\u5229\u7528\u5f3a\u6a21\u578b\uff08\u5982 GPT-4\uff09\u57fa\u4e8e\u5c11\u91cf\u79cd\u5b50\u4efb\u52a1\uff08Seed Tasks\uff09\u88c2\u53d8\u51fa\u5927\u91cf\u65b0\u4efb\u52a1\u3002\u5b83\u7684\u6838\u5fc3\u5047\u8bbe\u662f\uff1a\u6a21\u578b\u5df2\u7ecf\u89c1\u8fc7\u4e86\u8db3\u591f\u591a\u7684\u4efb\u52a1\u7c7b\u578b\uff0c\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7\u63d0\u793a\u8bcd\u628a\u5b83\u4eec\u8bf1\u5bfc\u51fa\u6765\u3002</li> <li>Evol-Instruct (\u8fdb\u5316\u6307\u4ee4)\uff1a \u4fa7\u91cd\u4e8e\u6df1\u5ea6 (Depth)\u3002\u901a\u8fc7\u7279\u5b9a\u7684\u8fdb\u5316\u7b97\u5b50\uff08\u5982\u201c\u589e\u52a0\u7ea6\u675f\u201d\u3001\u201c\u6df1\u5316\u63a8\u7406\u201d\uff09\u5c06\u7b80\u5355\u6307\u4ee4\u6539\u5199\u4e3a\u590d\u6742\u6307\u4ee4\u3002\u8fd9\u4e00\u65b9\u6cd5\u76f4\u63a5\u89e3\u51b3\u4e86 Self-Instruct \u5bb9\u6613\u751f\u6210\u7b80\u5355\u3001\u77ed\u6307\u4ee4\u7684\u95ee\u9898\uff0c\u5f3a\u5236\u6a21\u578b\u5728\u903b\u8f91\u590d\u6742\u5ea6\u548c\u7ea6\u675f\u6ee1\u8db3\u80fd\u529b\u4e0a\u8fdb\u884c\u6500\u5347\u3002</li> </ul> <p> \u56fe 9-1\uff1a\u81ea\u6211\u6307\u4ee4\u548c\u8fdb\u5316\u6307\u4ee4\u5bf9\u6bd4</p> <p>\u8868 9-1\uff1a\u4e3b\u6d41\u6307\u4ee4\u6570\u636e\u6784\u5efa\u7b56\u7565\u5bf9\u6bd4</p> \u7279\u6027 \u4eba\u5de5\u6807\u6ce8 (Manual Annotation) Self-Instruct Evol-Instruct \u6838\u5fc3\u76ee\u6807 \u6781\u9ad8\u7cbe\u5ea6\u3001\u7279\u5b9a\u9886\u57df\u77e5\u8bc6 \u589e\u52a0\u4efb\u52a1\u7684\u591a\u6837\u6027 (Diversity) \u589e\u52a0\u4efb\u52a1\u7684\u590d\u6742\u5ea6 (Complexity) \u6210\u672c (Cost) \u6781\u9ad8 (\\(1-\\)10/\u6761) \u4f4e ($0.01/\u6761) \u4e2d ($0.03/\u6761\uff0c\u9700\u591a\u8f6e\u8c03\u7528) \u8f93\u5165\u6765\u6e90 \u9886\u57df\u4e13\u5bb6 \u79cd\u5b50\u4efb\u52a1\u6c60 (Seed Pool) \u73b0\u6709\u7b80\u5355\u6307\u4ee4 (Base Instruction) \u64cd\u4f5c\u903b\u8f91 \u4e13\u5bb6\u64b0\u5199\u4e0e\u5ba1\u6838 \u201c\u8bf7\u751f\u6210\u4e00\u4e2a\u4e0e\u73b0\u6709\u4efb\u52a1\u4e0d\u540c\u7684\u65b0\u4efb\u52a1\u201d \u201c\u8bf7\u5c06\u6b64\u4efb\u52a1\u6539\u5199\u5f97\u66f4\u96be\uff0c\u4f8b\u5982\u589e\u52a0\u9650\u5236\u6761\u4ef6\u201d \u5178\u578b\u7b97\u5b50/\u65b9\u6cd5 \u6e05\u6d17\u3001\u5ba1\u6838\u3001\u4f17\u5305 ROUGE \u53bb\u91cd\uff0c\u52a8\u540d\u8bcd\u8fc7\u6ee4 \u6df1\u5ea6\u8fdb\u5316 (Deepening), \u5e7f\u5ea6\u8fdb\u5316 (Breadth) \u9002\u7528\u573a\u666f \u6838\u5fc3\u4e1a\u52a1\u903b\u8f91\u3001RLHF \u9ec4\u91d1\u6570\u636e\u96c6 \u6269\u5145\u901a\u7528\u4efb\u52a1\u8986\u76d6\u9762\uff0c\u51b7\u542f\u52a8 \u63d0\u5347\u4ee3\u7801\u3001\u6570\u5b66\u3001\u903b\u8f91\u63a8\u7406\u80fd\u529b \u6f5c\u5728\u98ce\u9669 \u89c4\u6a21\u96be\u4ee5\u6269\u5c55\uff0c\u7531\u4e8e\u75b2\u52b3\u5bfc\u81f4\u8d28\u91cf\u6ce2\u52a8 \u5bb9\u6613\u4ea7\u751f\u540c\u8d28\u5316\u3001\u7b80\u5355\u7684\u6307\u4ee4 \u53ef\u80fd\u751f\u6210\u903b\u8f91\u8fc7\u4e8e\u590d\u6742\u751a\u81f3\u65e0\u89e3\u7684\u201c\u5e7b\u89c9\u6307\u4ee4\u201d"},{"location":"part4/4_1_sft_data/#914-cot","title":"9.1.4 \u601d\u7ef4\u94fe (CoT) \u6570\u636e\uff1a\u6253\u7834\u63a8\u7406\u9ed1\u76d2","text":"<p>CoT \u7684\u6838\u5fc3\u5728\u4e8e\u6253\u7834\u201c\u8f93\u5165-&gt;\u8f93\u51fa\u201d\u7684\u9ed1\u76d2\u6620\u5c04\uff0c\u5f3a\u5236\u6a21\u578b\u5c06\u9690\u5f0f\u63a8\u7406\u8fc7\u7a0b\u663e\u5f0f\u5316\u3002</p> <p>\u4ece\u8ba4\u77e5\u79d1\u5b66\u7684\u89d2\u5ea6\u770b\uff0c\u4eba\u7c7b\u5728\u89e3\u51b3\u590d\u6742\u95ee\u9898\uff08\u5982\u6570\u5b66\u9898\uff09\u65f6\uff0c\u5927\u8111\u4e2d\u4f1a\u8fdb\u884c\u4e00\u7cfb\u5217\u7684\u4e2d\u95f4\u8ba1\u7b97\u3002Transformer \u6a21\u578b\u867d\u7136\u5f3a\u5927\uff0c\u4f46\u5982\u679c\u6ca1\u6709\u7ecf\u8fc7 CoT \u8bad\u7ec3\uff0c\u5b83\u503e\u5411\u4e8e\u76f4\u63a5\u731c\u6d4b\u7b54\u6848\uff0c\u8fd9\u5c31\u50cf\u8981\u6c42\u5b66\u751f\u4e0d\u5199\u8fc7\u7a0b\u76f4\u63a5\u5199\u5f97\u6570\u4e00\u6837\uff0c\u6781\u6613\u51fa\u9519\u3002CoT \u6570\u636e\u6fc0\u6d3b\u4e86 Transformer \u6a21\u578b\u7684\u4e2d\u95f4\u8ba1\u7b97\u5c42\uff0c\u4f7f\u5176\u80fd\u591f\u901a\u8fc7\u6269\u5c55\u751f\u6210\u7684 Token \u5e8f\u5217\u6765\u5206\u914d\u66f4\u591a\u7684\u8ba1\u7b97\u8d44\u6e90\u7ed9\u96be\u9898\uff08More compute time = More tokens generated\uff09\u3002</p>"},{"location":"part4/4_1_sft_data/#915-data-formatting-standards","title":"9.1.5 \u6570\u636e\u683c\u5f0f\u6807\u51c6\u5316 (Data Formatting Standards)","text":"<p>\u5728\u8fdb\u5165\u5de5\u7a0b\u5b9e\u73b0\u524d\uff0c\u5fc5\u987b\u7406\u89e3\u6570\u636e\u662f\u5982\u4f55\u88ab\u201c\u5582\u201d\u7ed9\u6a21\u578b\u7684\u3002\u8fd9\u4e0d\u4ec5\u4ec5\u662f JSON \u89e3\u6790\u7684\u95ee\u9898\uff0c\u66f4\u5173\u4e4e\u6a21\u578b\u5982\u4f55\u7406\u89e3\u5bf9\u8bdd\u5386\u53f2\u3002\u76ee\u524d\u4e1a\u754c\u4e3b\u6d41\u91c7\u7528 ChatML (Chat Markup Language) \u683c\u5f0f\uff0c\u5b83\u660e\u786e\u533a\u5206\u4e86 System\u3001User \u548c Assistant \u7684\u8fb9\u754c\uff0c\u9632\u6b62\u6307\u4ee4\u6ce8\u5165\u653b\u51fb\u3002</p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u5728\u8bad\u7ec3\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u53ea\u5bf9 <code>assistant</code> \u56de\u590d\u90e8\u5206\u7684 Token \u8ba1\u7b97 Loss\uff08\u635f\u5931\uff09\uff0c\u800c\u5c06 <code>system</code> \u548c <code>user</code> \u90e8\u5206\u8fdb\u884c Mask\uff08\u63a9\u7801\uff09\u5904\u7406\u3002\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5e0c\u671b\u6a21\u578b\u5b66\u4e60\u7684\u662f\u201c\u5982\u4f55\u56de\u7b54\u201d\uff0c\u800c\u4e0d\u662f\u201c\u5982\u4f55\u63d0\u95ee\u201d\u3002</p> <pre><code>// ChatML \u683c\u5f0f\u793a\u4f8b\n{\n  \"messages\": [\n    {\"role\": \"system\", \"content\": \"You are a helpful assistant.\"},\n    {\"role\": \"user\", \"content\": \"Explain quantum entanglement.\"},\n    {\"role\": \"assistant\", \"content\": \"Quantum entanglement is a phenomenon...\"}\n  ]\n}\n</code></pre>"},{"location":"part4/4_1_sft_data/#92-engineering-implementation","title":"9.2. \u5de5\u7a0b\u5b9e\u73b0 (Engineering Implementation)","text":"<p>\u672c\u8282\u5c06\u6307\u5bfc\u5982\u4f55\u642d\u5efa\u4e00\u5957\u5b8c\u6574\u7684\u6570\u636e\u5408\u6210\u6d41\u6c34\u7ebf\uff0c\u8fd9\u6d89\u53ca\u5230\u5de5\u5177\u94fe\u7684\u9009\u62e9\u548c\u6d41\u6c34\u7ebf\u7684\u7a33\u5b9a\u6027\u8bbe\u8ba1\u3002</p>"},{"location":"part4/4_1_sft_data/#_2","title":"\u73af\u5883/\u4f9d\u8d56","text":"<ul> <li><code>langchain</code> / <code>langsmith</code>: \u7528\u4e8e\u7ba1\u7406 Prompt \u6a21\u677f\u3001LLM \u8c03\u7528\u94fe\u4ee5\u53ca\u8ffd\u8e2a\u8c03\u8bd5\u3002</li> <li><code>rouge_score</code>: \u7528\u4e8e\u8ba1\u7b97\u6587\u672c\u76f8\u4f3c\u5ea6\uff0c\u8fdb\u884c\u53bb\u91cd\u3002</li> <li><code>numpy / scikit-learn</code>: \u7528\u4e8e\u5411\u91cf\u5316\u53bb\u91cd\uff08\u9ad8\u7ea7\u53bb\u91cd\uff09\uff0c\u901a\u8fc7 Embedding \u8ba1\u7b97\u8bed\u4e49\u8ddd\u79bb\u3002</li> <li><code>openai</code> \u6216 <code>vllm</code>: \u7528\u4e8e\u8c03\u7528\u6559\u5e08\u6a21\u578b\uff08Teacher Model\uff09\u3002vLLM \u9002\u7528\u4e8e\u672c\u5730\u90e8\u7f72\u9ad8\u541e\u5410\u91cf\u7684\u5f00\u6e90\u6559\u5e08\u6a21\u578b\uff08\u5982 Mixtral-8x7B\uff09\u3002</li> <li><code>chromadb</code> / <code>faiss</code>: \u5411\u91cf\u6570\u636e\u5e93\uff0c\u7528\u4e8e\u5927\u89c4\u6a21\u6570\u636e\u7684\u53bb\u91cd\u548c\u68c0\u7d22\u3002</li> </ul>"},{"location":"part4/4_1_sft_data/#921-prompt-engineering","title":"9.2.1 Prompt Engineering \u4e3a\u6570\u636e\u751f\u4ea7\u670d\u52a1","text":"<p>\u5728\u5408\u6210\u6570\u636e\u5de5\u7a0b\u4e2d\uff0cPrompt \u5fc5\u987b\u5177\u5907\u6781\u9ad8\u7684\u9c81\u68d2\u6027\u3002\u6211\u4eec\u91c7\u7528\u8fed\u4ee3\u601d\u7ef4\u6765\u6253\u78e8 System Prompt\uff0c\u5c31\u50cf\u5f00\u53d1\u8f6f\u4ef6\u7248\u672c\u4e00\u6837\u3002</p>"},{"location":"part4/4_1_sft_data/#_3","title":"\u4efb\u52a1\u76ee\u6807\uff1a \u6784\u9020\u4e00\u6279\u7528\u4e8e\u8bad\u7ec3\u201c\u91d1\u878d\u5206\u6790\u52a9\u624b\u201d\u7684\u6307\u4ee4\u6570\u636e\u3002","text":"<p>Step 1: \u8fed\u4ee3\u7f16\u5199 System Prompt * V1 \u7248\u672c\uff1a\u8fc7\u4e8e\u7b80\u5355\uff0c\u5bfc\u81f4\u6570\u636e\u540c\u8d28\u5316     * \u7f3a\u9677\u5206\u6790\uff1a \u6a21\u578b\u751f\u6210\u7684\u6307\u4ee4\u5f80\u5f80\u975e\u5e38\u7b80\u77ed\uff0c\u4e14\u96c6\u4e2d\u5728\u57fa\u672c\u6982\u5ff5\u89e3\u91ca\u4e0a\uff08\u5982\u201c\u4ec0\u4e48\u662f\u80a1\u7968\uff1f\u201d\uff09\u3002\u8fd9\u53cd\u6620\u4e86 LLM \u9ed8\u8ba4\u503e\u5411\u4e8e\u751f\u6210\u201c\u9ad8\u6982\u7387\u3001\u4f4e\u590d\u6742\u5ea6\u201d\u7684\u6587\u672c\u3002     </p><pre><code># V1 Prompt - \u6548\u679c\u4e0d\u4f73\nsystem_prompt_v1 = \"\"\"\nYou are a financial expert. Please generate 5 questions and answers about finance.\n\"\"\"\n</code></pre><p></p> <ul> <li> <p>V2 \u7248\u672c\uff1a\u589e\u52a0\u7ed3\u6784\u5316\u8981\u6c42</p> <ul> <li>\u6539\u8fdb\uff1a \u5f15\u5165\u4e86 JSON \u683c\u5f0f\u8981\u6c42\uff0c\u4fbf\u4e8e\u540e\u7eed\u89e3\u6790\u3002\u589e\u52a0\u4e86\u201c\u89d2\u8272\u201d\u8bbe\u5b9a\uff0c\u8bd5\u56fe\u5f15\u5bfc\u98ce\u683c\u3002</li> <li>\u7f3a\u9677\u5206\u6790\uff1a \u867d\u7136\u683c\u5f0f\u5bf9\u4e86\uff0c\u4f46\u5185\u5bb9\u4f9d\u7136\u4e0d\u591f\u786c\u6838\uff0c\u7f3a\u4e4f\u63a8\u7406\u8fc7\u7a0b\u3002\u6a21\u578b\u53ef\u80fd\u53ea\u4f1a\u751f\u6210\u6559\u79d1\u4e66\u5f0f\u7684\u5b9a\u4e49\uff0c\u800c\u975e\u5b9e\u6218\u573a\u666f\u3002 <pre><code># V2 Prompt - \u7ed3\u6784\u5316\u6539\u8fdb\nsystem_prompt_v2 = \"\"\"\nYou are a Senior Financial Analyst with 20 years of experience.\nGenerate 5 pairs of instruction-response data focused on corporate finance.\nFormat the output as a JSON list.\nEach item should have: 'instruction', 'input' (optional), 'output'.\n\"\"\"\n</code></pre></li> </ul> </li> <li> <p>V3 \u7248\u672c\uff1a\u6700\u7ec8\u751f\u4ea7\u7248 (Production Ready)</p> <ul> <li>\u6539\u8fdb\uff1a \u5f15\u5165\u4e86 Few-Shot (\u5c11\u6837\u672c)\u3001Negative Constraints (\u8d1f\u5411\u7ea6\u675f) \u548c Complexity Requirements (\u590d\u6742\u5ea6\u8981\u6c42)\u3002\u8fd9\u662f\u5de5\u4e1a\u754c\u4f7f\u7528\u7684\u6807\u51c6\u8303\u5f0f\u3002</li> <li>\u6df1\u5ea6\u89e3\u6790\uff1a\u901a\u8fc7\u660e\u786e\u7684\u201cAnti-Patterns\u201d\uff0c\u6211\u4eec\u5207\u65ad\u4e86\u6a21\u578b\u751f\u6210\u201c\u5e9f\u8bdd\u201d\u7684\u8def\u5f84\u3002Exemplar\uff08\u6837\u4f8b\uff09\u4e0d\u4ec5\u4ec5\u662f\u683c\u5f0f\u53c2\u8003\uff0c\u66f4\u662f\u601d\u7ef4\u6df1\u5ea6\u7684\u951a\u70b9\u3002</li> </ul> <p></p><pre><code># V3 Prompt - \u9ad8\u9c81\u68d2\u6027\u751f\u4ea7\u7248\nsystem_prompt_v3 = \"\"\"\n### ROLE\nYou are a Chief Market Strategist at a top-tier investment bank. Your goal is to train a junior analyst model. You demand precision, depth, and actionable insights.\n\n### OBJECTIVE\nGenerate 5 high-quality, complex instruction-following examples related to market analysis, risk management, or quantitative trading.\n\n### CONSTRAINTS\n1. **Complexity**: Do NOT ask simple definitional questions (e.g., \"What is a bond?\"). Instead, ask for scenario analysis, portfolio adjustments, or impact assessments.\n2. **Format**: Strictly output a valid JSON list.\n3. **Reasoning**: The 'output' must demonstrate step-by-step analytical reasoning before giving the conclusion.\n4. **Anti-Patterns**:\n   - Avoid generic advice like \"Consult a financial advisor.\"\n   - Avoid short, one-sentence responses.\n   - Avoid vague statements; use numbers and specific financial instruments where possible.\n\n### OUTPUT FORMAT\n[\n  {\n    \"instruction\": \"...\",\n    \"input_context\": \"...\" (can be null),\n    \"output\": \"...\"\n  }\n]\n\n### EXEMPLAR (One-Shot)\n[\n  {\n    \"instruction\": \"Given a portfolio heavily weighted in tech stocks (60%), analyze the impact of a sudden 50bps rate hike by the Fed.\",\n    \"input_context\": null,\n    \"output\": \"First, we identify the correlation... Tech stocks are long-duration assets... Discounted Cash Flow (DCF) models would show... Therefore, the portfolio would likely suffer significant drawdown. I recommend hedging via...\"\n  }\n]\n\"\"\"\n</code></pre> \u5b9e\u6218\u6280\u5de7 (Pro Tip): \u5728 V3 \u7248\u672c\u4e2d\uff0c\u6211\u4eec\u660e\u786e\u4e86\u201cAnti-Patterns\u201d\u3002\u8fd9\u662f\u9632\u6b62\u6a21\u578b\u201c\u5077\u61d2\u201d\u7684\u5173\u952e\u3002\u5927\u6a21\u578b\u503e\u5411\u4e8e\u751f\u6210\u5b89\u5168\u3001\u4e2d\u5eb8\u7684\u56de\u7b54\uff08\u5982\u201c\u8bf7\u54a8\u8be2\u4e13\u4e1a\u4eba\u58eb\u201d\uff09\uff0c\u8fd9\u5728\u8bad\u7ec3\u6570\u636e\u4e2d\u662f\u4f4e\u4ef7\u503c\u7684\u566a\u97f3\uff0c\u5fc5\u987b\u663e\u5f0f\u7981\u6b62\u3002<p></p> </li> </ul>"},{"location":"part4/4_1_sft_data/#922-self-instruct-evol-instruct","title":"9.2.2 \u81ea\u52a8\u5316\u6784\u9020\u65b9\u6cd5\uff1aSelf-Instruct \u4e0e Evol-Instruct","text":"<p>\u6211\u4eec\u5c06\u5b9e\u73b0\u4e00\u4e2a\u57fa\u4e8e Evol-Instruct \u7684\u7b80\u5316\u7248\u6d41\u6c34\u7ebf\u3002\u6838\u5fc3\u5728\u4e8e\u5982\u4f55\u901a\u8fc7 Prompt \u5c06\u7b80\u5355\u6307\u4ee4\u201c\u8fdb\u5316\u201d\u4e3a\u590d\u6742\u6307\u4ee4\uff0c\u5e76\u5728\u6b64\u8fc7\u7a0b\u4e2d\u5f15\u5165\u9a8c\u8bc1\u673a\u5236\u3002</p>"},{"location":"part4/4_1_sft_data/#evol-instruct","title":"\u6838\u5fc3\u4ee3\u7801\u62c6\u89e3\uff1aEvol-Instruct \u6d41\u6c34\u7ebf","text":"<p>Step 1: \u5b9a\u4e49\u8fdb\u5316\u7b97\u5b50 (Evolution Prompts) Evol-Instruct \u7684\u7cbe\u9ad3\u5728\u4e8e\u8fd9\u5957 Prompt \u6a21\u677f\u3002\u6211\u4eec\u9700\u8981\u5b9a\u4e49\u4e0d\u540c\u7684\u8fdb\u5316\u65b9\u5411\uff1a\u6df1\u5ea6\uff08\u589e\u52a0\u7ea6\u675f\u3001\u52a0\u6df1\u63a8\u7406\uff09\u548c\u5e7f\u5ea6\uff08\u53d8\u5f02\uff09\u3002\u4ee5\u4e0b\u4ee3\u7801\u5c55\u793a\u4e86\u5982\u4f55\u6784\u5efa\u201c\u589e\u52a0\u7ea6\u675f\u201d\u548c\u201c\u6df1\u5316\u63a8\u7406\u201d\u7684 Prompt\u3002\u8fd9\u4e9b Prompt \u7684\u8bbe\u8ba1\u76f4\u63a5\u51b3\u5b9a\u4e86\u6570\u636e\u7684\u4e0a\u9650\u3002</p> <pre><code>class EvolutionPrompts:\n    @staticmethod\n    def get_deepening_prompt(instruction):\n        \"\"\"\n        \u6df1\u5ea6\u8fdb\u5316\uff1a\u589e\u52a0\u903b\u8f91\u63a8\u7406\u7684\u6df1\u5ea6\u3002\n        \u901a\u8fc7\u8981\u6c42 'explicitly ask for multiple-step reasoning'\uff0c\u5f3a\u8feb\u6a21\u578b\u4ece\u76f4\u89c9\u5f0f\u56de\u7b54\u8f6c\u4e3a\u5206\u6790\u5f0f\u56de\u7b54\u3002\n        \"\"\"\n        return f\"\"\"\n        I want you to act as a Prompt Rewriter.\n        Your objective is to rewrite a given prompt into a more complex version to make those famous AI systems (e.g., ChatGPT and GPT4) a bit harder to handle.\n        But the rewritten prompt must be reasonable and must be understood and responded by humans.\n\n        # Given Prompt #:\n        {instruction}\n\n        # Method #:\n        If #Given Prompt# can be solved with just a few simple thinking processes, you can rewrite it to explicitly ask for multiple-step reasoning.\n\n        # Rewritten Prompt #:\n        \"\"\"\n\n    @staticmethod\n    def get_constraints_prompt(instruction):\n        \"\"\"\n        \u6df1\u5ea6\u8fdb\u5316\uff1a\u589e\u52a0\u5177\u4f53\u7684\u9650\u5236\u6761\u4ef6\u3002\n        \u901a\u8fc7\u9650\u5236\u5b57\u6570\u589e\u52a0\uff0810-20 words\uff09\uff0c\u9632\u6b62\u6307\u4ee4\u53d8\u5f97\u5197\u957f\u800c\u65e0\u5b9e\u8d28\u5185\u5bb9\u3002\n        \"\"\"\n        return f\"\"\"\n        I want you to act as a Prompt Rewriter.\n        ... [\u7701\u7565\u5934\u90e8\u58f0\u660e\uff0c\u4fdd\u6301\u4e00\u81f4]...\n\n        # Given Prompt #:\n        {instruction}\n\n        # Method #:\n        Please add one more constraint/requirement into #Given Prompt#.\n        You should try your best not to make the #Rewritten Prompt# become verbose, #Rewritten Prompt# can only add 10 to 20 words into #Given Prompt#.\n\n        # Rewritten Prompt #:\n        \"\"\"\n\n    @staticmethod\n    def get_breadth_prompt(instruction):\n        \"\"\"\n        \u5e7f\u5ea6\u8fdb\u5316\uff1a\u57fa\u4e8e\u73b0\u6709\u6307\u4ee4\u751f\u6210\u5168\u65b0\u7684\u3001\u8bdd\u9898\u4e0d\u540c\u7684\u6307\u4ee4\u3002\n        \u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u6570\u636e\u5206\u5e03\u574d\u584c\u5230\u67d0\u51e0\u4e2a\u7279\u5b9a\u7684\u7a84\u9886\u57df\u3002\n        \"\"\"\n        return f\"\"\"\n        I want you to act as a Prompt Creator.\n        Please generate a brand new prompt that has the same difficulty level as #Given Prompt# but covers a completely different topic or domain.\n\n        # Given Prompt #:\n        {instruction}\n\n        # New Prompt #:\n        \"\"\"\n</code></pre> <p>Step 2: \u6267\u884c\u8fdb\u5316\u5faa\u73af\u4e0e\u5f02\u5e38\u5904\u7406</p> <pre><code>import random\n\n# \u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a LLM \u8c03\u7528\u63a5\u53e3\ndef call_llm(prompt):\n    # \u8c03\u7528 GPT-4 \u6216\u5176\u4ed6\u5f3a\u6a21\u578b\n    # \u5b9e\u9645\u5de5\u7a0b\u4e2d\u9700\u6dfb\u52a0 retry \u673a\u5236\u5904\u7406\u7f51\u7edc\u6296\u52a8\n    pass\n\ndef evolve_instruction(base_instruction, depth=1):\n    current_instruction = base_instruction\n\n    for i in range(depth):\n        # \u968f\u673a\u9009\u62e9\u4e00\u79cd\u8fdb\u5316\u7b56\u7565\n        # \u7b56\u7565\u7684\u6982\u7387\u5206\u5e03\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u8c03\u6574\uff0c\u4f8b\u5982\u521d\u671f\u591a\u7528 Breadth\uff0c\u540e\u671f\u591a\u7528 Deepening\n        strategy = random.choice(['deepening', 'constraints', 'breadth'])\n\n        if strategy == 'deepening':\n            prompt = EvolutionPrompts.get_deepening_prompt(current_instruction)\n        elif strategy == 'constraints':\n            prompt = EvolutionPrompts.get_constraints_prompt(current_instruction)\n        else:\n            prompt = EvolutionPrompts.get_breadth_prompt(current_instruction)\n\n        # \u83b7\u53d6\u8fdb\u5316\u540e\u7684\u6307\u4ee4\n        evolved_candidate = call_llm(prompt)\n\n        # \u8d28\u91cf\u68c0\u67e5\uff08\u7b80\u5355\u7248\uff09\uff1a\u9632\u6b62\u8fdb\u5316\u5931\u8d25\n        # \u5f88\u591a\u65f6\u5019\u6a21\u578b\u4f1a\u8f93\u51fa \"Sorry, I can't do that\" \u6216\u8005\u5355\u7eaf\u91cd\u590d\u539f\u6307\u4ee4\n        if \"sorry\" in evolved_candidate.lower() or len(evolved_candidate) &lt; 10:\n            print(f\"Evolution failed at step {i}, keeping previous instruction.\")\n            break\n\n        # \u8fdb\u9636\u68c0\u67e5\uff1a\u5229\u7528\u7b80\u5355\u542f\u53d1\u5f0f\u89c4\u5219\u5224\u65ad\u662f\u5426\u53ea\u662f\u7b80\u5355\u7684\u91cd\u590d\n        if evolved_candidate.strip() == current_instruction.strip():\n             print(f\"Evolution stagnant at step {i}.\")\n             break\n\n        current_instruction = evolved_candidate\n\n    return current_instruction\n\n# \u793a\u4f8b\u8fd0\u884c\nseed = \"Write a Python script to calculate Fibonacci numbers.\"\ncomplex_instruction = evolve_instruction(seed, depth=3)\n# \u9884\u671f\u7ed3\u679c\u53ef\u80fd\u662f\uff1a\"Write a Python script to calculate the nth Fibonacci number using dynamic programming, optimize for memory usage, and handle negative input values.\"\n</code></pre> <p>Step 3: \u6027\u80fd\u4f18\u5316\u6280\u5de7 * Batch Processing: \u4e0d\u8981\u4e00\u6761\u6761\u8c03\u7528 API\u3002\u6784\u9020\u4e00\u4e2a\u5305\u542b 20 \u6761\u6307\u4ee4\u7684 Prompt \u5217\u8868\uff0c\u8ba9\u6a21\u578b\u4e00\u6b21\u6027\u8fd4\u56de 20 \u6761\u8fdb\u5316\u540e\u7684\u7ed3\u679c\u3002\u8fd9\u80fd\u663e\u8457\u964d\u4f4e token \u5f00\u9500\u548c\u7f51\u7edc\u5ef6\u8fdf\uff08High Throughput\uff09\u3002 * Failure Filter: \u8fdb\u5316\u8fc7\u7a0b\u5f88\u5bb9\u6613\u5931\u8d25\uff08\u4f8b\u5982\u6a21\u578b\u5f00\u59cb\u590d\u8bfb\uff09\u3002\u5fc5\u987b\u5b9e\u73b0\u4e00\u4e2a\u8fc7\u6ee4\u5668\uff0c\u5982\u679c\u8fdb\u5316\u540e\u7684\u6307\u4ee4\u957f\u5ea6\u7f29\u77ed\u4e86\uff0c\u6216\u8005\u5305\u542b\u4e86\u5178\u578b\u7684\u62d2\u7edd\u8bcd\uff08\"As an AI...\"\uff09\uff0c\u5219\u4e22\u5f03\u8be5\u6837\u672c\u3002 * \u591a\u6837\u6027\u63a7\u5236: \u5728 Batch \u751f\u6210\u65f6\uff0c\u53ef\u4ee5\u5728 System Prompt \u4e2d\u660e\u786e\u8981\u6c42\u201cGenerate diverse topics\u201d\uff0c\u907f\u514d\u540c\u4e00\u6279\u6b21\u751f\u6210\u5168\u662f\u5173\u4e8e\u201cPython \u7f16\u7a0b\u201d\u7684\u6307\u4ee4\u3002</p>"},{"location":"part4/4_1_sft_data/#923-cot-step-by-step","title":"9.2.3 \u601d\u7ef4\u94fe (CoT) \u6570\u636e\uff1a\u6784\u9020 Step-by-Step \u7684\u63a8\u7406\u6837\u672c","text":"<p>SFT \u6570\u636e\u7684\u6838\u5fc3\u4ef7\u503c\u5728\u4e8e\u6559\u4f1a\u6a21\u578b\u201c\u5982\u4f55\u601d\u8003\u201d\u3002\u666e\u901a\u7684\u95ee\u7b54\u5bf9\uff08Q: 1+1? A: 2\uff09\u53ea\u80fd\u6559\u4f1a\u7ed3\u679c\uff0cCoT \u5219\u6559\u4f1a\u8fc7\u7a0b\u3002</p>"},{"location":"part4/4_1_sft_data/#cot-prompt","title":"\u6784\u9020 CoT \u6570\u636e\u7684 Prompt \u6a21\u677f","text":"<p>\u6211\u4eec\u4e0d\u53ea\u662f\u7b80\u5355\u5730\u52a0\u4e00\u53e5\u201cLet's think step by step\u201d\uff0c\u800c\u662f\u8981\u6c42\u6a21\u578b\u6309\u7167\u7279\u5b9a\u683c\u5f0f\uff08\u5982 <code>&lt;thinking&gt;</code> \u6807\u7b7e\uff09\u8f93\u51fa\u3002\u8fd9\u79cd\u683c\u5f0f\u5316\u7684\u6570\u636e\u5728\u540e\u7eed\u8bad\u7ec3\u4e2d\u975e\u5e38\u6709\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u8ba9\u6a21\u578b\u8f93\u51fa\u601d\u8003\u8fc7\u7a0b\uff0c\u6216\u8005\u5728\u63a8\u7406\u65f6\u9690\u85cf\u5b83\u3002</p> <pre><code># System Prompt for CoT Generation\ncot_system_prompt = \"\"\"\nYou are a reasoning expert. When answering the user's question, you MUST follow this format:\n\n1. Enclose your thought process in &lt;thinking&gt; tags.\n2. Break down the problem into logical steps.\n3. Check for edge cases or potential errors in your logic (Self-Correction).\n4. Output the final answer in &lt;answer&gt; tags.\n\nDo NOT output the answer directly without the thinking process.\n\"\"\"\n\n# V3 Prompt Iteration for Math CoT\nuser_prompt_cot = \"\"\"\nQuestion: A farmer has chickens and cows. There are 20 heads and 50 legs. How many of each are there?\n\nPlease provide a Step-by-Step solution.\n\"\"\"\n</code></pre> <p>\u793a\u4f8b\u8f93\u51fa\uff08\u4f5c\u4e3a\u8bad\u7ec3\u6570\u636e\uff09\uff1a </p><pre><code>&lt;thinking&gt;\nStep 1: Define variables. Let C be chickens, K be cows.\nStep 2: Set up equations based on the problem statement.\n   Equation 1 (Heads): C + K = 20\n   Equation 2 (Legs): 2C + 4K = 50\nStep 3: Solve for C from Equation 1. \n   C = 20 - K.\nStep 4: Substitute C into Equation 2.\n   2(20 - K) + 4K = 50\n   40 - 2K + 4K = 50\n   2K = 10 \n   K = 5.\nStep 5: Solve for C using the value of K. \n   C = 20 - 5 = 15.\nStep 6: Verify the solution. \n   Heads: 15 + 5 = 20. Correct.\n   Legs: 15*2 + 5*4 = 30 + 20 = 50. Correct.\n&lt;/thinking&gt;\n&lt;answer&gt;\nChickens: 15, Cows: 5\n&lt;/answer&gt;\n</code></pre> \u5b9e\u6218\u6280\u5de7 (Pro Tip): \u8fd9\u79cd\u5e26\u6709 <code>&lt;thinking&gt;</code> \u6807\u7b7e\u7684\u6570\u636e\u7b56\u7565\u88ab\u79f0\u4e3a\u201c\u5185\u90e8\u72ec\u767d\u201d (Internal Monologue) \u8bad\u7ec3\u3002\u5728 SFT \u8bad\u7ec3\u65f6\uff0c\u4fdd\u7559\u8fd9\u4e9b\u6807\u7b7e\u8ba9\u6a21\u578b\u5b66\u4f1a\u8f93\u51fa\u601d\u8003\u8fc7\u7a0b\u3002\u5728\u5b9e\u9645\u4ea7\u54c1\u5e94\u7528\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 Parsing \u4ee3\u7801\u622a\u83b7 <code>&lt;thinking&gt;</code> \u5185\u5bb9\uff0c\u53ea\u5411\u7528\u6237\u5c55\u793a <code>&lt;answer&gt;</code>\uff0c\u6216\u8005\u505a\u4e00\u4e2a\u201c\u601d\u8003\u4e2d...\u201d\u7684 UI \u52a8\u6548\uff0c\u5c55\u793a\u90e8\u5206\u601d\u8003\u6b65\u9aa4\u4ee5\u589e\u52a0\u53ef\u89e3\u91ca\u6027\u3002<p></p>"},{"location":"part4/4_1_sft_data/#924-performance-evaluation","title":"9.2.4. \u6027\u80fd\u4e0e\u8bc4\u4f30 (Performance &amp; Evaluation)","text":"<p>\u6570\u636e\u751f\u6210\u53ea\u662f\u7b2c\u4e00\u6b65\uff0c\u5982\u4f55\u8bc4\u4f30\u751f\u6210\u6570\u636e\u7684\u8d28\u91cf\u540c\u6837\u5173\u952e\u3002\u6211\u4eec\u4e0d\u80fd\u7b49\u5230\u6a21\u578b\u8bad\u7ec3\u5b8c\uff08\u53ef\u80fd\u82b1\u8d39\u6570\u5929\u548c\u6570\u5343\u7f8e\u5143\uff09\u624d\u53d1\u73b0\u6570\u636e\u8d28\u91cf\u5dee\u3002</p>"},{"location":"part4/4_1_sft_data/#_4","title":"\u8bc4\u4ef7\u6307\u6807","text":"<ul> <li>\u6307\u4ee4\u9075\u5faa\u7387 (Instruction Following Rate): \u8fd9\u901a\u5e38\u662f\u4e00\u4e2a\u81ea\u52a8\u5316\u6d4b\u8bd5\u3002\u4f7f\u7528 GPT-4 \u4f5c\u4e3a\u88c1\u5224\uff08Judge\uff09\uff0c\u5224\u65ad\u6a21\u578b\u751f\u6210\u7684\u56de\u590d\u662f\u5426\u4e25\u683c\u6ee1\u8db3\u4e86 Input \u4e2d\u7684\u6240\u6709\u7ea6\u675f\u6761\u4ef6\uff08\u5982\u201c\u5b57\u6570\u9650\u5236\u201d\u3001\u201c\u5305\u542b\u7279\u5b9a\u5173\u952e\u8bcd\u201d\u3001\u201cJSON\u683c\u5f0f\u201d\uff09\u3002</li> <li>\u590d\u6742\u5ea6\u5206\u5e03 (Complexity Distribution): \u5229\u7528 NLP \u5de5\u5177\uff08\u5982 SpaCy\uff09\u5206\u6790\u751f\u6210\u6307\u4ee4\u7684\u52a8\u8bcd\u591a\u6837\u6027\u3001\u53e5\u6cd5\u6811\u6df1\u5ea6\u548c\u5e73\u5747\u957f\u5ea6\u3002\u7ed8\u5236\u5206\u5e03\u76f4\u65b9\u56fe\uff0c\u786e\u4fdd Evol-Instruct \u771f\u6b63\u63d0\u5347\u4e86\u96be\u5ea6\uff0c\u800c\u4e0d\u662f\u4ec5\u4ec5\u589e\u52a0\u4e86\u5e9f\u8bdd\u3002</li> <li>\u591a\u6837\u6027 (Diversity): \u8ba1\u7b97 ROUGE-L \u6216\u4f7f\u7528 Embedding Cosine Similarity\u3002\u5982\u679c\u6570\u636e\u96c6\u5185\u6837\u672c\u95f4\u7684\u5e73\u5747\u76f8\u4f3c\u5ea6\u8fc7\u9ad8\uff0c\u8bf4\u660e\u53d1\u751f\u4e86\u201c\u6a21\u5f0f\u574d\u584c\u201d\uff0c\u6570\u636e\u7f3a\u4e4f\u591a\u6837\u6027\u3002</li> </ul>"},{"location":"part4/4_1_sft_data/#benchmarks","title":"\u57fa\u51c6\u6d4b\u8bd5 (Benchmarks)","text":"<p>\u5728\u5b66\u672f\u754c\u548c\u5de5\u4e1a\u754c\uff0c\u6709\u51e0\u4e2a\u516c\u8ba4\u7684\u699c\u5355\u7528\u4e8e\u6d4b\u8bd5 SFT \u540e\u7684\u6a21\u578b\u80fd\u529b\uff1a * WizardLM \u8bba\u6587\u6570\u636e : \u7ecf\u8fc7 4 \u8f6e Evol-Instruct \u8fdb\u5316\u7684\u6570\u636e\u8bad\u7ec3\u51fa\u7684\u6a21\u578b\uff0c\u5728 GSM8K (\u6570\u5b66) \u548c HumanEval (\u4ee3\u7801) \u4e0a\uff0c\u76f8\u6bd4\u4ec5\u4f7f\u7528\u539f\u59cb\u6570\u636e\u7684\u6a21\u578b\uff0c\u6027\u80fd\u63d0\u5347\u901a\u5e38\u5728 10% - 20% \u4ee5\u4e0a\u3002 * MT-Bench: \u4e00\u4e2a\u591a\u8f6e\u5bf9\u8bdd\u7684\u8bc4\u4f30\u96c6\uff0c\u4e13\u95e8\u6d4b\u8bd5\u6a21\u578b\u7684\u6307\u4ee4\u9075\u5faa\u3001\u63a8\u7406\u548c\u591a\u8f6e\u5bf9\u8bdd\u80fd\u529b\uff0c\u901a\u5e38\u7531 GPT-4 \u6253\u5206\u3002 * \u6210\u672c\u53c2\u8003\uff1a \u4f7f\u7528 <code>gpt-3.5-turbo</code> \u751f\u6210 52K \u6761 Self-Instruct \u6570\u636e\u7684\u6210\u672c\u7ea6\u4e3a $500 - $1000\uff08\u53d6\u51b3\u4e8e Prompt \u957f\u5ea6\u548c\u8f6e\u6b21\uff09\u3002\u8fd9\u76f8\u6bd4\u4eba\u5de5\u6807\u6ce8\u6570\u5341\u4e07\u7f8e\u5143\u7684\u6210\u672c\u662f\u6781\u5177\u6027\u4ef7\u6bd4\u7684\u3002</p>"},{"location":"part4/4_1_sft_data/#925-pitfalls-troubleshooting","title":"9.2.5. \u907f\u5751\u6307\u5357 (Pitfalls &amp; Troubleshooting)","text":"<p>\u5728\u5b9e\u9645\u64cd\u4f5c\u4e2d\uff0c\u6570\u636e\u5408\u6210\u5f80\u5f80\u5145\u6ee1\u9677\u9631\u3002\u4ee5\u4e0b\u662f\u5e38\u89c1\u7684\u5931\u8d25\u6a21\u5f0f\u53ca\u5176\u89e3\u51b3\u65b9\u6848\u3002</p> <ul> <li> <p>\u9677\u9631 1\uff1aMode Collapse (\u6a21\u5f0f\u574d\u584c)</p> <ul> <li>\u73b0\u8c61\uff1a \u6a21\u578b\u751f\u6210\u7684\u6307\u4ee4\u5343\u7bc7\u4e00\u5f8b\uff0c\u4f8b\u5982\u751f\u6210\u7684 1000 \u6761\u6570\u636e\u5168\u662f\u201c\u8bf7\u5199\u4e00\u7bc7\u5173\u4e8eX\u7684\u6587\u7ae0\u201d\u6216\u8005\u201c\u8bf7\u5e2e\u6211\u5199\u4e00\u4e2aPython\u51fd\u6570\u201d\u3002</li> <li>\u539f\u56e0\uff1a Seed Tasks\uff08\u79cd\u5b50\u4efb\u52a1\uff09\u8fc7\u4e8e\u5355\u4e00\uff0c\u6216\u8005 System Prompt \u7684 Temperature \u8bbe\u7f6e\u8fc7\u4f4e\uff0c\u5bfc\u81f4\u6a21\u578b\u9677\u5165\u5c40\u90e8\u6700\u4f18\u3002</li> <li>\u4fee\u6b63\uff1a \u589e\u52a0 Seed Tasks \u7684\u591a\u6837\u6027\uff08\u8986\u76d6 100+ \u4e2a\u4e0d\u540c\u9886\u57df\uff0c\u5982\u70f9\u996a\u3001\u6cd5\u5f8b\u3001\u7f16\u7a0b\u3001\u6587\u5b66\uff09\uff1b\u63d0\u9ad8 Temperature (0.7 -&gt; 1.0)\uff1b\u5728 System Prompt \u4e2d\u5f3a\u5236\u8981\u6c42\u201cGenerate a task from a domain different from previous examples\u201d\u3002</li> </ul> </li> <li> <p>\u9677\u9631 2\uff1aHallucinated Constraints (\u5e7b\u89c9\u7ea6\u675f)</p> <ul> <li>\u73b0\u8c61\uff1a \u6a21\u578b\u5728\u8bad\u7ec3\u6570\u636e\u4e2d\u5b66\u4f1a\u4e86\u201c\u5fc5\u987b\u4ee5 JSON \u8f93\u51fa\u201d\uff0c\u5bfc\u81f4\u5728\u7528\u6237\u95f2\u804a\u65f6\uff08\u201c\u4f60\u597d\u201d\uff09\u4e5f\u5f3a\u884c\u8f93\u51fa JSON\uff0c\u6216\u8005\u5728\u6ca1\u6709\u8981\u6c42\u7684\u60c5\u51b5\u4e0b\u8f93\u51fa <code>&lt;thinking&gt;</code> \u6807\u7b7e\u3002</li> <li>\u539f\u56e0\uff1a \u8bad\u7ec3\u6570\u636e\u5206\u5e03\u4e25\u91cd\u504f\u79d1\uff0c100% \u90fd\u662f\u590d\u6742\u6307\u4ee4\uff0c\u7f3a\u4e4f\u7b80\u5355\u7684\u901a\u7528\u5bf9\u8bdd\u6570\u636e\u3002</li> <li>\u4fee\u6b63\uff1a \u6570\u636e\u914d\u6bd4 (Data Mixing)\u3002\u5728 Evol-Instruct \u6570\u636e\u4e2d\u6df7\u5165 10%-20% \u7684\u901a\u7528\u5bf9\u8bdd\u6570\u636e\uff08\u5982 ShareGPT \u6216\u4e00\u822c\u7684 Chit-Chat \u6570\u636e\uff09\uff0c\u9632\u6b62\u6a21\u578b\u8fc7\u62df\u5408\u7279\u5b9a\u683c\u5f0f\u3002\u8fd9\u88ab\u79f0\u4e3a\u201c\u901a\u7528\u80fd\u529b\u56de\u653e\u201d\uff08General Capability Replay\uff09\u3002</li> </ul> </li> <li> <p>\u9677\u9631 3\uff1aEvolution Failure (\u8fdb\u5316\u5931\u8d25/\u9000\u5316)</p> <ul> <li>\u73b0\u8c61\uff1a \u8fdb\u5316\u540e\u7684\u6307\u4ee4\u53d8\u5f97\u4e0d\u53ef\u7406\u55bb\u3001\u903b\u8f91\u51b2\u7a81\uff08\u201c\u5199\u4e00\u7bc7\u4e0d\u5305\u542b\u5143\u97f3\u5b57\u6bcd\u7684 1000 \u5b57\u6587\u7ae0\u201d\uff09\u6216\u6781\u5176\u5197\u957f\u3002</li> <li>\u4fee\u6b63\uff1a \u5b9e\u73b0\u4e00\u4e2a\u201c\u957f\u5ea6\u60e9\u7f5a\u201d\u6216\u201c\u590d\u6742\u5ea6\u622a\u65ad\u201d\u673a\u5236\u3002\u5982\u679c\u8fdb\u5316\u540e\u7684\u6307\u4ee4\u867d\u7136\u590d\u6742\u4f46 GPT-4 \u90fd\u65e0\u6cd5\u56de\u7b54\uff08\u6216\u8005\u56de\u7b54\u8d28\u91cf\u5f88\u5dee\uff09\uff0c\u5219\u8be5\u6837\u672c\u4e3a\u65e0\u6548\u6837\u672c\uff08Bad Case\uff09\u3002\u5f15\u5165\u201c\u6559\u5e08\u6a21\u578b\u6253\u5206\u201d\u673a\u5236\uff0c\u8ba9 GPT-4 \u8bc4\u4f30\u8fdb\u5316\u540e\u6307\u4ee4\u7684\u53ef\u884c\u6027 (Feasibility)\u3002</li> </ul> </li> <li> <p>\u9677\u9631 4\uff1a\u707e\u96be\u6027\u9057\u5fd8 (Catastrophic Forgetting)</p> <ul> <li>\u73b0\u8c61\uff1a SFT \u4e4b\u540e\uff0c\u6a21\u578b\u867d\u7136\u5b66\u4f1a\u4e86\u9075\u5faa\u6307\u4ee4\uff0c\u4f46\u4f3c\u4e4e\u53d8\u201c\u7b28\u201d\u4e86\uff0c\u5fd8\u8bb0\u4e86\u9884\u8bad\u7ec3\u9636\u6bb5\u7684\u4e00\u4e9b\u4e16\u754c\u77e5\u8bc6\u3002</li> <li>\u539f\u56e0\uff1a SFT \u6570\u636e\u96c6\u4fee\u6539\u4e86\u6a21\u578b\u7684\u6743\u91cd\u5206\u5e03\uff0c\u4f7f\u5176\u8fc7\u5ea6\u4e13\u6ce8\u4e8e\u7279\u5b9a\u4efb\u52a1\u5f62\u5f0f\uff0c\u6324\u538b\u4e86\u901a\u7528\u77e5\u8bc6\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</li> <li>\u4fee\u6b63\uff1a \u964d\u4f4e Learning Rate\uff0c\u51cf\u5c11 Epoch \u6570\uff08\u901a\u5e38 SFT \u53ea\u9700\u8981 2-3 \u4e2a Epoch\uff09\u3002\u540c\u65f6\uff0c\u5728 SFT \u6570\u636e\u4e2d\u52a0\u5165\u5c11\u91cf\u7684\u9884\u8bad\u7ec3\u6570\u636e\uff08Pre-training Replay\uff09\uff0c\u4ee5\u4fdd\u6301\u53c2\u6570\u5206\u5e03\u7684\u7a33\u5b9a\u6027\u3002</li> </ul> </li> </ul>"},{"location":"part4/4_1_sft_data/#926","title":"9.2.6. \u672c\u7ae0\u5c0f\u7ed3\u4e0e\u5ef6\u4f38\u9605\u8bfb","text":"<p>\u6211\u4eec\u5c06 Prompt \u89c6\u4e3a\u6570\u636e\u7684\u6e90\u4ee3\u7801\uff0c\u5fc5\u987b\u50cf\u5bf9\u5f85\u8f6f\u4ef6\u5de5\u7a0b\u4ee3\u7801\u4e00\u6837\u5bf9\u5176\u8fdb\u884c\u4e25\u8c28\u7684\u7248\u672c\u7ba1\u7406\u4e0e\u8fed\u4ee3\u6d4b\u8bd5\u3002\u5728\u8fd9\u4e00\u4f53\u7cfb\u4e0b\uff0cSelf-Instruct \u89e3\u51b3\u4e86\u201c\u4ece\u65e0\u5230\u6709\u201d\u7684\u51b7\u542f\u52a8\u96be\u9898\uff0c\u800c Evol-Instruct \u5219\u653b\u514b\u4e86\u201c\u4ece\u6613\u5230\u96be\u201d\u7684\u590d\u6742\u5ea6\u6500\u5347\uff0c\u4e24\u8005\u7684\u6709\u673a\u7ed3\u5408\u6784\u6210\u4e86\u6784\u5efa\u9ad8\u6027\u80fd\u6570\u636e\u96c6\u7684\u9ec4\u91d1\u8303\u5f0f\uff1b\u4e0e\u6b64\u540c\u65f6\uff0c\u601d\u7ef4\u94fe\uff08CoT\uff09\u6570\u636e\u4e5f\u8fdc\u975e\u7b80\u5355\u7684\u89e3\u9898\u6280\u5de7\uff0c\u5b83\u901a\u8fc7\u663e\u5f0f\u5316\u63a8\u7406\u8fc7\u7a0b\uff0c\u5c06\u8ba1\u7b97\u8d44\u6e90\u6709\u6548\u5730\u5206\u914d\u7ed9\u5173\u952e\u63a8\u7406\u6b65\u9aa4\uff0c\u4ece\u800c\u6839\u672c\u6027\u5730\u63d0\u5347\u4e86\u6a21\u578b\u5904\u7406\u590d\u6742\u903b\u8f91\u7684\u80fd\u529b\u3002\u7136\u800c\u5f52\u6839\u7ed3\u5e95\uff0c\u6570\u636e\u5408\u6210\u7684\u6838\u5fc3\u58c1\u5792\u5e76\u975e\u751f\u6210\u80fd\u529b\u7684\u5f3a\u5f31\uff0c\u800c\u662f\u4e00\u95e8\u5173\u4e8e\u8fc7\u6ee4\u4e0e\u6e05\u6d17\u7684\u827a\u672f\u2014\u2014\u5728\u6d77\u91cf\u751f\u6210\u7684\u5bb9\u6613\u4e0e\u7cbe\u51c6\u7b5b\u9009\u7684\u8270\u96be\u4e4b\u95f4\uff0c\u552f\u6709\u5177\u5907\u4ece\u6c99\u783e\u4e2d\u6dd8\u51fa\u9ec4\u91d1\u7684\u80fd\u529b\uff0c\u624d\u662f\u771f\u6b63\u7684\u6838\u5fc3\u7ade\u4e89\u529b\u3002</p>"},{"location":"part4/4_1_sft_data/#_5","title":"\u53c2\u8003\u6587\u732e\u4e0e\u5ef6\u4f38\u9605\u8bfb","text":"<ul> <li>Wang, Y., et al. (2022). Self-Instruct: Aligning Language Models with Self-Generated Instructions. (\u63d0\u51fa\u4e86\u81ea\u52a8\u5316\u6307\u4ee4\u751f\u6210\u7684\u5f00\u5c71\u4e4b\u4f5c)</li> <li>Xu, C., et al. (2023). WizardLM: Empowering Large Language Models to Follow Complex Instructions. (\u8be6\u7ec6\u4ecb\u7ecd\u4e86 Evol-Instruct \u7684\u5404\u79cd\u8fdb\u5316\u7b97\u5b50)</li> <li>Wei, J., et al. (2022). Chain-of-Thought Prompting Elicits Reasoning in Large Language Models. (CoT \u7684\u5960\u57fa\u4e4b\u4f5c)</li> <li>Zhou, C., et al. (2023). LIMA: Less Is More for Alignment. (\u8bba\u8bc1\u4e86 SFT \u4e3b\u8981\u662f\u5b66\u4e60\u683c\u5f0f\u800c\u975e\u77e5\u8bc6\uff0c\u5960\u5b9a\u4e86\u201c\u8d28\u91cf&gt;\u6570\u91cf\u201d\u7684\u7406\u8bba\u57fa\u7840)</li> </ul>"},{"location":"part4/4_2_synthetic_data/","title":"\u7b2c10\u7ae0\uff1a\u5408\u6210\u6570\u636e","text":""},{"location":"part4/4_2_synthetic_data/#10-synthetic-data","title":"\u7b2c10\u7ae0\uff1a\u5408\u6210\u6570\u636e (Synthetic Data) \u2014\u2014 \u4ece\u201c\u6570\u636e\u6316\u6398\u201d\u5230\u201c\u6570\u636e\u519c\u573a\u201d","text":""},{"location":"part4/4_2_synthetic_data/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u968f\u7740\u5927\u6a21\u578b\u7ade\u8d5b\u7684\u767d\u70ed\u5316\uff0c\u516c\u7f51\u4e0a\u7684\u9ad8\u8d28\u91cf\u81ea\u7136\u6570\u636e\uff08Natural Data\uff09\u6b63\u5728\u9762\u4e34\u67af\u7aed\u7684\u5371\u673a\u3002\u6211\u4eec\u51e0\u4e4e\u5df2\u7ecf\u201c\u8bfb\u201d\u5b8c\u4e86\u6574\u4e2a\u4e92\u8054\u7f51\uff0c\u4f46\u6a21\u578b\u7684\u667a\u529b\u4e0a\u9650\u8fdc\u672a\u89e6\u8fbe\u3002\u6b64\u65f6\uff0c\u5408\u6210\u6570\u636e\uff08Synthetic Data\uff09\u4e0d\u518d\u662f\u4e00\u4e2a\u53ef\u9009\u9879\uff0c\u800c\u662f\u6a21\u578b\u80fd\u529b\u8dc3\u5347\u7684\u65b0\u5f15\u64ce\u3002\u672c\u7ae0\u5c06\u6df1\u5165\u5256\u6790\u5fae\u8f6f Phi \u7cfb\u5217\u6a21\u578b\u7684\u201c\u6559\u79d1\u4e66\u7ea7\u201d\u6570\u636e\u5408\u6210\u65b9\u6cd5\uff0c\u63a2\u8ba8\u5982\u4f55\u4ece\u88ab\u52a8\u7684\u201c\u6570\u636e\u91c7\u96c6\u8005\u201d\u8f6c\u53d8\u4e3a\u4e3b\u52a8\u7684\u201c\u6570\u636e\u521b\u9020\u8005\u201d\u3002</p> <p>\u6211\u4eec\u5c06\u4e0d\u4ec5\u9650\u4e8e\u751f\u6210\u6587\u672c\uff0c\u800c\u662f\u901a\u8fc7 Program of Thought (PoT) \u5229\u7528\u4ee3\u7801\u6267\u884c\u6765\u6784\u5efa\u4e25\u5bc6\u7684\u903b\u8f91\u9a8c\u8bc1\u95ed\u73af\uff0c\u4ee5\u53ca\u5982\u4f55\u5229\u7528 GPT-4o \u7b49\u591a\u6a21\u6001\u6a21\u578b\u5408\u6210\u590d\u6742\u7684\u56fe\u6587\u6307\u4ee4\u6570\u636e\u3002\u6211\u4eec\u5c06\u5c55\u793a\u5982\u4f55\u4ece\u7b80\u5355\u7684\u201c\u6a21\u4eff\u4eba\u7c7b\u201d\u8f6c\u5411\u201c\u8d85\u8d8a\u4eba\u7c7b\u201d\uff0c\u901a\u8fc7\u7b97\u6cd5\u624b\u6bb5\u6784\u5efa\u51fa\u6bd4\u771f\u5b9e\u4e16\u754c\u66f4\u7eaf\u51c0\u3001\u66f4\u5177\u6559\u80b2\u610f\u4e49\u7684\u8bad\u7ec3\u96c6\u3002</p>"},{"location":"part4/4_2_synthetic_data/#learning-objectives","title":"\u5b66\u4e60\u76ee\u6807 (Learning Objectives)","text":"<ul> <li>\u6784\u5efa \u201cTextbook Quality\u201d \u5206\u7c7b\u5668\uff0c\u4ece\u6d77\u91cf Web \u6570\u636e\u4e2d\u7b5b\u9009\u9ad8\u4ef7\u503c\u6837\u672c\u3002</li> <li>\u5b9e\u73b0 PoT (Program of Thought) \u6570\u636e\u751f\u6210\u6d41\u6c34\u7ebf\uff0c\u5229\u7528 Python \u89e3\u91ca\u5668\u9a8c\u8bc1\u6570\u5b66/\u4ee3\u7801\u6570\u636e\u7684\u6b63\u786e\u6027\u3002</li> <li>\u638c\u63e1\u57fa\u4e8e LLaVA/GPT-4o \u7684\u591a\u6a21\u6001\u6307\u4ee4\u5408\u6210\u6280\u672f\uff0c\u6784\u9020\u56fe\u50cf\u63a8\u7406\u95ee\u7b54\u5bf9\u3002</li> </ul>"},{"location":"part4/4_2_synthetic_data/#_2","title":"\u573a\u666f\u5f15\u5165\uff1a\u5f53\u6570\u636e\u6210\u4e3a\u74f6\u9888","text":"<p>\u201c\u4f60\u6b63\u5728\u8bad\u7ec3\u4e00\u4e2a\u4e13\u95e8\u7528\u4e8e Python \u7f16\u7a0b\u7684\u5c0f\u578b\u6a21\u578b\uff081.3B\uff09\u3002\u4e3a\u4e86\u8ba9\u5b83\u5c3d\u53ef\u80fd\u5f3a\u5927\uff0c\u4f60\u7f16\u5199\u722c\u866b\u722c\u53d6\u4e86 GitHub \u4e0a\u6240\u6709\u7684\u5f00\u6e90\u4ee3\u7801\u3002\u7136\u800c\uff0c\u5f53\u8bad\u7ec3\u7ed3\u675f\u8fdb\u884c\u6d4b\u8bd5\u65f6\uff0c\u4f60\u7edd\u671b\u5730\u53d1\u73b0\u6a21\u578b\u5b66\u4f1a\u4e86\u5199\u6ee1\u662f Bug \u7684\u4ee3\u7801\uff0c\u751a\u81f3\u5b66\u4f1a\u4e86\u5728\u51fd\u6570\u91cc\u5199\u2018TODO: Fix this later\u2019\u6216\u8005\u2018This code is trash, do not use\u2019\u3002 \u4ec5\u4ec5\u589e\u52a0\u6570\u636e\u91cf\u5df2\u7ecf\u65e0\u6548\u4e86\uff0c\u56e0\u4e3a\u4f60\u5582\u7ed9\u6a21\u578b\u7684\u5783\u573e\u8d8a\u591a\uff0c\u5b83\u7684\u8f93\u51fa\u5c31\u8d8a\u6df7\u4e71\u3002\u8fd9\u65f6\u5019\uff0c\u5fae\u8f6f\u7684 Phi-1 \u8bba\u6587\u7ed9\u4e86\u4f60\u4e00\u8bb0\u5f53\u5934\u68d2\u559d\uff1a\u2018Textbooks Are All You Need\u2019\u3002\u4f60\u9700\u8981\u7684\u662f\u50cf\u6559\u79d1\u4e66\u4e00\u6837\u903b\u8f91\u6e05\u6670\u3001\u6ce8\u91ca\u5b8c\u7f8e\u3001\u7531\u6d45\u5165\u6df1\u7684\u6559\u5b66\u4ee3\u7801\uff0c\u800c\u4e0d\u662f\u53ea\u6709\u4e0a\u5e1d\u548c\u539f\u4f5c\u8005\u80fd\u770b\u61c2\u7684\u2018\u5c4e\u5c71\u2019\u3002\u4f46\u662f\uff0c\u53bb\u54ea\u91cc\u627e\u51e0\u767e\u4ebf Token \u7684\u5b8c\u7f8e\u6559\u79d1\u4e66\u5462\uff1f\u65e2\u7136\u627e\u4e0d\u5230\uff0c\u6211\u4eec\u5c31\u5fc5\u987b\u5b66\u4f1a\u51ed\u7a7a\u2018\u53d8\u2019\u51fa\u8fd9\u4e9b\u6570\u636e\u3002\u5982\u4f55\u6784\u5efa\u4e00\u4e2a\u4e0d\u77e5\u75b2\u5026\u7684\u2018\u865a\u62df\u6559\u6388\u2019\u6765\u6279\u91cf\u751f\u4ea7\u8fd9\u4e9b\u5b8c\u7f8e\u7684\u6559\u6750\uff1f\u8fd9\u5c31\u662f\u672c\u7ae0\u8981\u89e3\u51b3\u7684\u6838\u5fc3\u5de5\u7a0b\u6311\u6218\u3002\u201d</p>"},{"location":"part4/4_2_synthetic_data/#101-concepts-principles","title":"10.1 \u6838\u5fc3\u6982\u5ff5\u4e0e\u539f\u7406 (Concepts &amp; Principles)","text":"<p>\u5408\u6210\u6570\u636e\u7684\u6838\u5fc3\u6311\u6218\u5728\u4e8e\u8d28\u91cf\u63a7\u5236\u4e0e\u9a8c\u8bc1\u95ed\u73af\u3002\u56e0\u4e3a\u6a21\u578b\u751f\u6210\u7684\u6587\u672c\u5982\u679c\u4e0d\u52a0\u68c0\u67e5\uff0c\u5f80\u5f80\u5305\u542b\u5e7b\u89c9\u6216\u9519\u8bef\u3002\u5982\u679c\u4f7f\u7528\u542b\u6709\u9519\u8bef\u7684\u6570\u636e\u8bad\u7ec3\u6a21\u578b\uff0c\u4f1a\u5bfc\u81f4\u6a21\u578b\u4ea7\u751f\u201c\u81ea\u6211\u541e\u566c\u201d\uff08Model Autophagy\uff09\u6216\u201c\u6a21\u578b\u574d\u584c\u201d\uff08Model Collapse\uff09\uff0c\u5373\u6a21\u578b\u8f93\u51fa\u7684\u65b9\u5dee\u9010\u6e10\u6d88\u5931\uff0c\u5185\u5bb9\u53d8\u5f97\u6781\u5ea6\u540c\u8d28\u5316\u4e14\u8131\u79bb\u73b0\u5b9e\u3002\u672c\u7ae0\u4ecb\u7ecd\u7684\u4e09\u79cd\u65b9\u6cd5\u5206\u522b\u89e3\u51b3\u4e86\u6587\u672c\u3001\u4ee3\u7801/\u6570\u5b66\u3001\u591a\u6a21\u6001\u6570\u636e\u7684\u8d28\u91cf\u95ee\u9898\u3002</p>"},{"location":"part4/4_2_synthetic_data/#1011","title":"10.1.1 \u4e3a\u4ec0\u4e48\u5408\u6210\u6570\u636e\u7684\u8d28\u91cf\u8fdc\u6bd4\u6570\u91cf\u91cd\u8981\uff1f","text":"<p>\u5728\u6df1\u5ea6\u5b66\u4e60\u7684\u65e9\u671f\uff0c\u6211\u4eec\u8ff7\u4fe1\u201c\u6570\u636e\u91cf\u5373\u6b63\u4e49\u201d\uff0c\u8ba4\u4e3a\u53ea\u8981\u6570\u636e\u8db3\u591f\u591a\uff0c\u6a21\u578b\u5c31\u80fd\u5b66\u4f1a\u4e00\u5207\u3002\u4f46\u5728\u5408\u6210\u6570\u636e\u65f6\u4ee3\uff0c\u8fd9\u4e00\u4fe1\u6761\u88ab\u5f7b\u5e95\u63a8\u7ffb\u3002</p> <p>\u4fe1\u566a\u6bd4\u7406\u8bba (Signal-to-Noise Ratio): \u6a21\u578b\u7684\u8bad\u7ec3\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u538b\u7f29\u4fe1\u606f\u7684\u8fc7\u7a0b\u3002\u9ad8\u8d28\u91cf\u6570\u636e\uff08\u5982\u6559\u79d1\u4e66\uff09\u5177\u6709\u6781\u9ad8\u7684\u4fe1\u606f\u5bc6\u5ea6\u548c\u4e25\u5bc6\u7684\u903b\u8f91\u94fe\u6761\uff0c\u6a21\u578b\u53ea\u9700\u8981\u5f88\u5c11\u7684\u6837\u672c\u5c31\u80fd\u6355\u6349\u5230\u5176\u80cc\u540e\u7684\u89c4\u5f8b\u3002\u800c\u4f4e\u8d28\u91cf\u6570\u636e\uff08\u5982\u8bba\u575b\u704c\u6c34\u3001\u95f2\u804a\uff09\u5145\u6ee1\u4e86\u566a\u97f3\u548c\u903b\u8f91\u65ad\u5c42\u3002\u5982\u679c\u8bad\u7ec3\u96c6\u4e2d\u6df7\u5165\u4e86\u5927\u91cf\u4f4e\u8d28\u91cf\u5408\u6210\u6570\u636e\uff0c\u6a21\u578b\u4e3a\u4e86\u964d\u4f4e Loss\uff0c\u4f1a\u88ab\u8feb\u53bb\u62df\u5408\u8fd9\u4e9b\u566a\u97f3\uff0c\u5bfc\u81f4\u201c\u903b\u8f91\u7535\u8def\u201d\u77ed\u8def\u3002</p> <p>\u8fd9\u5c31\u597d\u6bd4\u5b66\u4e60\u7269\u7406\uff0c\u8bfb\u4e00\u672c\u7ecf\u5178\u7684\u300a\u8d39\u66fc\u7269\u7406\u5b66\u8bb2\u4e49\u300b\uff08\u9ad8\u8d28\u91cf\u5408\u6210\u6570\u636e\uff09\u80dc\u8fc7\u5237\u4e00\u4e07\u6761\u788e\u7247\u5316\u7684\u7269\u7406\u79d1\u666e\u77ed\u89c6\u9891\uff08\u4f4e\u8d28\u91cf\u6570\u636e\uff09\u3002Phi-1 \u7684\u6210\u529f\u8bc1\u660e\u4e86\uff1a6B Token \u7684\u6559\u79d1\u4e66\u7ea7\u6570\u636e\uff0c\u5176\u8bad\u7ec3\u6548\u679c\u53ef\u4ee5\u540a\u6253 1000B Token \u7684\u7f51\u7edc\u722c\u53d6\u6570\u636e\u3002\u5728\u5408\u6210\u6570\u636e\u9886\u57df\uff0c\u9a8c\u8bc1\uff08Verification\uff09\u7684\u6210\u672c\u6210\u4e3a\u4e86\u65b0\u7684\u8d27\u5e01\u3002</p>"},{"location":"part4/4_2_synthetic_data/#1012-textbooks-are-all-you-need","title":"10.1.2 \u6559\u79d1\u4e66\u7ea7\u6570\u636e (Textbooks Are All You Need)","text":"<p>\u5fae\u8f6f Phi-1 \u7684\u6838\u5fc3\u601d\u60f3\u662f\uff1a\u4e0e\u5176\u7528 1TB \u5783\u573e\u6570\u636e\u8bad\u7ec3\uff0c\u4e0d\u5982\u7528 6B Token \u7684\u9ad8\u8d28\u91cf\u6570\u636e\u3002\u5176\u6838\u5fc3\u5728\u4e8e\u6784\u5efa\u4e00\u4e2a\u201c\u8fc7\u6ee4\u5668\u201d\u548c\u4e00\u4e2a\u201c\u653e\u5927\u5668\u201d\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u5e76\u4e0d\u662f\u5b8c\u5168\u629b\u5f03 Web \u6570\u636e\uff0c\u800c\u662f\u8bad\u7ec3\u4e00\u4e2a\u5206\u7c7b\u5668\uff08Quality Classifier\uff09\uff0c\u4e13\u95e8\u8bc6\u522b\u90a3\u4e9b\u201c\u5177\u6709\u6559\u80b2\u4ef7\u503c\u201d\u7684\u5185\u5bb9\u3002\u8fd9\u4e0d\u4ec5\u4ec5\u662f\u770b\u8bed\u6cd5\u662f\u5426\u6b63\u786e\uff0c\u66f4\u662f\u770b\u5185\u5bb9\u662f\u5426\u903b\u8f91\u81ea\u6d3d\u3001\u662f\u5426\u5305\u542b\u5b9a\u4e49\u4e0e\u63a8\u7406\u3002\u5176\u6b21\uff0c\u6211\u4eec\u5229\u7528\u5f3a\u5927\u7684\u751f\u6210\u5f0f\u6a21\u578b\uff08\u5982 GPT-4\uff09\u4f5c\u4e3a\u201c\u6269\u97f3\u5668\u201d\uff0c\u53c2\u8003\u8fd9\u4e9b\u9ad8\u8d28\u91cf\u7247\u6bb5\uff0c\u5408\u6210\u51fa\u98ce\u683c\u7c7b\u4f3c\u4f46\u5185\u5bb9\u5168\u65b0\u7684\u3001\u81ea\u5305\u542b\u7684\u77e5\u8bc6\u7247\u6bb5\u3002</p> <p> \u56fe 10-1\uff1a Phi-1\u6d41\u7a0b\u793a\u610f\u56fe</p>"},{"location":"part4/4_2_synthetic_data/#1013-pot-program-of-thought","title":"10.1.3 \u4ee3\u7801\u4e0e\u6570\u5b66\u5408\u6210\uff1aPoT (Program of Thought)","text":"<p>LLM \u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u6982\u7387\u6a21\u578b\uff0c\u5b83\u4e0d\u5177\u5907\u771f\u6b63\u7684\u903b\u8f91\u63a8\u7406\u82af\u7247\u3002\u56e0\u6b64\uff0c\u8ba9 LLM \u505a\u7b97\u672f\u8fd0\u7b97\uff08\u5982 234 * 567\uff09\u6216\u590d\u6742\u903b\u8f91\u63a8\u6f14\u65f6\uff0c\u5b83\u5f88\u5bb9\u6613\u4ea7\u751f\u5e7b\u89c9\u3002PoT (Program of Thought) \u7684\u601d\u60f3\u662f\uff1a\u65e2\u7136 LLM \u4e0d\u64c5\u957f\u8ba1\u7b97\u4f46\u64c5\u957f\u7ffb\u8bd1\uff0c\u4e0d\u5982\u8ba9\u5b83\u628a\u6570\u5b66\u95ee\u9898\u201c\u7ffb\u8bd1\u201d\u6210\u4ee3\u7801\uff0c\u7136\u540e\u8ba9 Python \u89e3\u91ca\u5668\u6765\u8ba1\u7b97\u7ed3\u679c\u3002</p> <p>\u8fd9\u662f\u5408\u6210\u6570\u636e\u4e2d\u552f\u4e00\u80fd\u505a\u5230 100% \u51c6\u786e\u7387\u9a8c\u8bc1 \u7684\u9886\u57df\u3002\u6211\u4eec\u5c06\u751f\u6210\u7684\u4ee3\u7801\u653e\u5165 Python Sandbox \u6267\u884c\u3002\u5982\u679c\u62a5\u9519\uff0c\u76f4\u63a5\u4e22\u5f03\uff1b\u5982\u679c\u8fd0\u884c\u6210\u529f\uff0c\u6267\u884c\u7ed3\u679c\u5373\u4e3a Ground Truth\u3002\u8fd9\u79cd\u201c\u6267\u884c\u5373\u9a8c\u8bc1\u201d\u7684\u673a\u5236\uff0c\u5f7b\u5e95\u89e3\u51b3\u4e86\u5408\u6210\u6570\u636e\u65e0\u6cd5\u9a8c\u8bc1\u6b63\u786e\u6027\u7684\u96be\u9898\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u4f4e\u6210\u672c\u5730\u751f\u6210\u65e0\u7a77\u65e0\u5c3d\u7684\u6570\u5b66\u548c\u903b\u8f91\u63a8\u7406\u6570\u636e\u3002</p> <p>\u8868 10-1\uff1a\u5408\u6210\u6570\u636e\u9a8c\u8bc1\u7b56\u7565\u5bf9\u6bd4</p> \u6570\u636e\u7c7b\u578b \u751f\u6210\u5668 (Generator) \u6838\u5fc3\u6311\u6218 \u9a8c\u8bc1\u8005 (Verifier) \u9a8c\u8bc1\u673a\u5236 \u901a\u7528\u6587\u672c GPT-4 / Gemini \u5e7b\u89c9 (Hallucination) LLM (Judge) / Reward Model \u4f9d\u8d56\u5f3a\u6a21\u578b\u6253\u5206\uff0c\u4e00\u81f4\u6027\u8f83\u4f4e\uff0c\u4e14\u5bb9\u6613\u51fa\u73b0\u201c\u88c1\u5224\u504f\u89c1\u201d \u6570\u5b66/\u903b\u8f91 GPT-4 + PoT Prompt \u8ba1\u7b97\u9519\u8bef Python Interpreter \u6267\u884c\u4e00\u81f4\u6027\uff1a\u4ee3\u7801\u8fd0\u884c\u7ed3\u679c\u4e0e\u9884\u8bbe\u7b54\u6848\u5339\u914d\uff0c\u903b\u8f91\u7edd\u5bf9\u6b63\u786e \u4ee3\u7801 (Code) DeepSeek Coder / GPT-4 \u8bed\u6cd5\u9519\u8bef\u3001\u903b\u8f91 Bug Unit Tests / Compiler \u5355\u5143\u6d4b\u8bd5\uff1a\u901a\u8fc7 assert \u65ad\u8a00\u6216\u6210\u529f\u7f16\u8bd1\uff0c\u786e\u4fdd\u529f\u80fd\u6b63\u5e38 \u591a\u6a21\u6001 GPT-4o / LLaVA \u89c6\u89c9\u5e7b\u89c9 (\u65e0\u4e2d\u751f\u6709) CLIP Score / Grounding DINO \u68c0\u67e5\u751f\u6210\u7684\u63cf\u8ff0\u662f\u5426\u4e0e\u56fe\u7247 Embedding \u76f8\u4f3c\uff0c\u9632\u6b62\u7f16\u9020\u4e0d\u5b58\u5728\u7684\u7269\u4f53"},{"location":"part4/4_2_synthetic_data/#1014","title":"10.1.4 \u591a\u6a21\u6001\u6307\u4ee4\u5408\u6210\uff1a\u8de8\u8d8a\u611f\u77e5\u7684\u6865\u6881","text":"<p>\u5bf9\u4e8e\u56fe\u50cf\u6570\u636e\uff0c\u4f20\u7edf\u7684\u6807\u6ce8\u6210\u672c\u6781\u9ad8\u4e14\u63cf\u8ff0\u7b80\u77ed\u3002LLaVA \u63d0\u51fa\u4e86\u4e00\u79cd\u5929\u624d\u822c\u7684\u201c\u76f2\u4eba\u6478\u8c61\u201d\u7b56\u7565\u3002\u6211\u4eec\u5229\u7528\u73b0\u6709\u7684\u68c0\u6d4b\u6a21\u578b\u5c06\u56fe\u50cf\u8f6c\u5316\u4e3a\u7b26\u53f7\u5316\u7684\u6587\u672c\u63cf\u8ff0\uff08Caption + Bounding Boxes\uff09\uff0c\u7136\u540e\u5c06\u8fd9\u4e9b\u7eaf\u6587\u672c\u5582\u7ed9\u5f3a\u5927\u7684\u7eaf\u6587\u672c\u6a21\u578b\uff08\u5982 GPT-4\uff09\u3002GPT-4 \u867d\u7136\u770b\u4e0d\u89c1\u56fe\uff0c\u4f46\u5b83\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e9b\u5143\u6570\u636e\u201c\u60f3\u8c61\u201d\u51fa\u56fe\u50cf\u7684\u5185\u5bb9\uff0c\u5e76\u57fa\u4e8e\u6b64\u751f\u6210\u590d\u6742\u7684\u63a8\u7406\u5bf9\u8bdd\u3002\u8fd9\u4e0d\u4ec5\u89e3\u51b3\u4e86\u591a\u6a21\u6001\u6570\u636e\u7a00\u7f3a\u7684\u95ee\u9898\uff0c\u8fd8\u6781\u5927\u5730\u63d0\u5347\u4e86\u6307\u4ee4\u7684\u590d\u6742\u5ea6\u548c\u903b\u8f91\u6027\u3002</p>"},{"location":"part4/4_2_synthetic_data/#102-engineering-implementation","title":"10.2 \u5de5\u7a0b\u5b9e\u73b0 (Engineering Implementation)","text":"<p>\u672c\u8282\u6211\u4eec\u5c06\u6df1\u5165\u4ee3\u7801\u5c42\u9762\uff0c\u6784\u5efa\u4e00\u5957\u5b8c\u6574\u7684\u6570\u636e\u5408\u6210\u6d41\u6c34\u7ebf\u3002\u6211\u4eec\u5c06\u91cd\u70b9\u5173\u6ce8\u5982\u4f55\u4fdd\u8bc1\u6570\u636e\u7684\u591a\u6837\u6027\uff0c\u9632\u6b62\u751f\u6210\u7684\u201c\u6559\u79d1\u4e66\u201d\u5343\u7bc7\u4e00\u5f8b\u3002</p>"},{"location":"part4/4_2_synthetic_data/#1021","title":"10.2.1 \u6559\u79d1\u4e66\u7ea7\u6570\u636e\uff1a\u5206\u7c7b\u5668\u4e0e\u5408\u6210\u6d41\u6c34\u7ebf","text":"<p>Step 1: \u8bad\u7ec3\u8d28\u91cf\u5206\u7c7b\u5668 (The Quality Classifier) \u6211\u4eec\u9700\u8981\u8bad\u7ec3\u4e00\u4e2a\u8f7b\u91cf\u7ea7\u6a21\u578b\uff08\u5982 Random Forest \u6216 BERT-Tiny\uff09\uff0c\u4ece\u6d77\u91cf\u6570\u636e\u4e2d\u6311\u51fa\u201c\u6559\u79d1\u4e66\u201d\u3002\u8fd9\u91cc\u7684\u5173\u952e\u5728\u4e8e\u6807\u6ce8\u6570\u636e\u7684\u6765\u6e90\u3002\u901a\u5e38\uff0c\u6211\u4eec\u9700\u8981\u4eba\u5de5\u4e13\u5bb6\u6216 GPT-4 \u4ed4\u7ec6\u6807\u6ce8\u51e0\u5343\u6761\u6570\u636e\u4f5c\u4e3a\u79cd\u5b50\u3002</p> <p>\u4ee3\u7801\u5b9e\u73b0\uff1a\u7279\u5f81\u5de5\u7a0b\u4e0e\u8bad\u7ec3 </p><pre><code>import pandas as pd\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.feature_extraction.text import TfidfVectorizer\nfrom sklearn.pipeline import Pipeline\n\n# 1. \u51c6\u5907\u6807\u6ce8\u6570\u636e (Annotation)\n# \u6211\u4eec\u9996\u5148\u7528 GPT-4 \u6807\u6ce8\u5c11\u91cf\u6837\u672c\uff08\u4f8b\u5982 1000 \u6761\uff09\uff0c\u4f5c\u4e3a\u201c\u91d1\u6807\u51c6\u201d\n# Prompt: \"Determine if this text is of educational value for a student...\"\n# Label 1: High Quality (Textbook-like), Label 0: Low Quality (Noise)\n# \u8fd9\u4e00\u6b65\u81f3\u5173\u91cd\u8981\uff0c\u6807\u6ce8\u7684\u8d28\u91cf\u76f4\u63a5\u51b3\u5b9a\u4e86\u5206\u7c7b\u5668\u7684\u4e0a\u9650\ndata = [\n    {\"text\": \"Python lists are mutable sequences...\", \"label\": 1},\n    {\"text\": \"Hey guys check out my cat photo...\", \"label\": 0},\n    # ... more data\n] \ndf = pd.DataFrame(data)\n\n# 2. \u6784\u5efa\u5206\u7c7b\u5668\u6d41\u6c34\u7ebf\n# Phi-1 \u8bba\u6587\u4e2d\u4f7f\u7528\u9884\u8bad\u7ec3\u6a21\u578b\u7684 Embedding\uff0c\u8fd9\u91cc\u7b80\u5316\u4f7f\u7528 TF-IDF \u6f14\u793a\u539f\u7406\n# \u5728\u5b9e\u9645\u751f\u4ea7\u4e2d\uff0c\u5efa\u8bae\u4f7f\u7528 DeBERTa-v3-small \u7b49\u8f7b\u91cf\u7ea7 Transformer \u83b7\u53d6 Embedding\npipeline = Pipeline([\n    ('tfidf', TfidfVectorizer(max_features=5000, stop_words='english')),\n    ('clf', RandomForestClassifier(n_estimators=100, n_jobs=-1))\n])\n\n# 3. \u8bad\u7ec3\nX = df['text']\ny = df['label']\npipeline.fit(X, y)\n\n# 4. \u9884\u6d4b (Filtering Phase)\n# \u5bf9\u6d77\u91cf Web \u6570\u636e\u8fdb\u884c\u6253\u5206\uff0c\u53ea\u4fdd\u7559\u9ad8\u5206\u6570\u636e\nweb_snippet = \"Standard library documentation for Python...\"\nscore = pipeline.predict_proba([web_snippet])[0][1]\n\nif score &gt; 0.8:\n    print(\"Keep this data for training: High Educational Value\")\nelse:\n    print(\"Discard: Low Signal-to-Noise Ratio\")\n</code></pre><p></p> <p>Step 2: \u5408\u6210\u6559\u79d1\u4e66\u7247\u6bb5 (Synthetic Generation) \u62e5\u6709\u4e86\u5206\u7c7b\u5668\u8fc7\u6ee4\u51fa\u7684\u79cd\u5b50\u6570\u636e\u540e\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5176\u201c\u6269\u5199\u201d\u3002\u8fd9\u91cc\u7684 Prompt \u8bbe\u8ba1\u9700\u8981\u6781\u9ad8\u7684\u6280\u5de7\u3002</p> <p>Prompt \u8fed\u4ee3\uff1a\u5408\u6210 Python \u6559\u7a0b * V1 Prompt: \"Write a tutorial about Python lists.\"     * \u7ed3\u679c\uff1a \u5e73\u94fa\u76f4\u53d9\uff0c\u7f3a\u4e4f\u6df1\u5ea6\uff0c\u50cf\u662f\u4e00\u7bc7\u5e73\u5eb8\u7684\u535a\u5ba2\u6587\u7ae0\u3002 * V3 Prompt (Phi-style): \u5f15\u5165\u4e86\u5177\u4f53\u7684\u6559\u5b66\u6cd5\uff08Pedagogy\uff09\uff0c\u8981\u6c42\u5305\u542b\u5b9a\u4e49\u3001\u5bf9\u6bd4\u3001\u590d\u6742\u5ea6\u5206\u6790\u548c\u9677\u9631\u8b66\u793a\u3002</p> <pre><code># V3 Prompt - \u6559\u79d1\u4e66\u98ce\u683c\u5408\u6210\nsynthetic_textbook_prompt = \"\"\"\n### ROLE\nYou are a professor of Computer Science writing a definitive textbook on Python.\n\n### OBJECTIVE\nWrite a comprehensive, self-contained chapter section on the topic: \"List Comprehensions vs. Map/Filter\".\n\n### REQUIREMENTS\n1. **Tone**: Educational, clear, precise, and rigorous. Avoid conversational filler.\n2. **Structure**:\n   - Start with a conceptual definition explaining *why* this feature exists.\n   - Provide a \"Before and After\" code example (Loop vs. Comprehension).\n   - Explain the *computational complexity* (Big O) implications.\n   - Include a \"Common Pitfall\" section (e.g., readability vs. brevity).\n3. **Diversity**: Use realistic variable names (e.g., `inventory_items`, `sensor_readings`), NOT generic ones like `x`, `y`, `foo`. \n   (This is crucial to prevent the model from overfitting to toy examples).\n\n### OUTPUT\n[Markdown Content]\n\"\"\"\n</code></pre>"},{"location":"part4/4_2_synthetic_data/#1022-back-translation","title":"10.2.2 \u9006\u5411\u7ffb\u8bd1 (Back-Translation)\uff1a\u4ece\u7b54\u6848\u53cd\u63a8\u95ee\u9898","text":"<p>\u9664\u4e86\u4ece\u5934\u751f\u6210\uff0c\u53e6\u4e00\u79cd\u9ad8\u6548\u65b9\u6cd5\u662f\u201c\u9006\u5411\u7ffb\u8bd1\u201d\u3002\u5728\u4ee3\u7801\u9886\u57df\uff0c\u6211\u4eec\u901a\u5e38\u5f88\u5bb9\u6613\u627e\u5230\u9ad8\u8d28\u91cf\u7684\u4ee3\u7801\u7247\u6bb5\uff08\u4f8b\u5982 GitHub \u4e0a\u7684\u9ad8\u661f\u5e93\u51fd\u6570\uff09\uff0c\u4f46\u7f3a\u4e4f\u5bf9\u5e94\u7684\u81ea\u7136\u8bed\u8a00\u6307\u4ee4\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5229\u7528 LLM \u7684\u603b\u7ed3\u80fd\u529b\uff0c\u8f93\u5165\u4e00\u6bb5\u590d\u6742\u7684\u4ee3\u7801\uff0c\u8981\u6c42\u6a21\u578b\uff1a\u201c\u8bf7\u4e3a\u8fd9\u6bb5\u4ee3\u7801\u7f16\u5199\u4e00\u4e2a\u5c3d\u53ef\u80fd\u8be6\u7ec6\u7684\u5404\u79cd\u7528\u6237\u9700\u6c42\u6307\u4ee4\uff0c\u4f7f\u5f97\u8fd9\u6bb5\u4ee3\u7801\u6070\u597d\u80fd\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002\u201d\u8fd9\u80fd\u5feb\u901f\u751f\u6210\u5927\u91cf (Instruction, Output) \u5bf9\uff0c\u4e14 Output \u4fdd\u8bc1\u662f\u9ad8\u8d28\u91cf\u7684\u4eba\u7c7b\u4ee3\u7801\u3002\u8fd9\u79cd\u65b9\u6cd5\u7279\u522b\u9002\u5408\u589e\u5f3a\u6a21\u578b\u5bf9\u590d\u6742\u4ee3\u7801\u903b\u8f91\u7684\u7406\u89e3\u80fd\u529b\u3002</p>"},{"location":"part4/4_2_synthetic_data/#1023-pot-program-of-thought","title":"10.2.3 \u4ee3\u7801\u4e0e\u6570\u5b66\u5408\u6210\uff1aPoT (Program of Thought)","text":"<p>\u8fd9\u662f\u4fdd\u8bc1\u5408\u6210\u6570\u636e\u6b63\u786e\u6027\u7684\u6700\u5f3a\u624b\u6bb5\u3002\u901a\u8fc7\u5f3a\u5236\u6a21\u578b\u751f\u6210\u4ee3\u7801\uff0c\u6211\u4eec\u5c06\u6a21\u7cca\u7684\u81ea\u7136\u8bed\u8a00\u63a8\u7406\u8f6c\u5316\u4e3a\u4e86\u7cbe\u786e\u7684\u7a0b\u5e8f\u903b\u8f91\u3002</p> <p>\u6838\u5fc3\u4ee3\u7801\u62c6\u89e3\uff1a\u751f\u6210\u4e0e\u9a8c\u8bc1\u95ed\u73af </p><pre><code>import subprocess\nimport tempfile\nimport os\n\n# 1. PoT \u751f\u6210 Prompt\n# \u6211\u4eec\u8981\u6c42\u6a21\u578b\u628a\u89e3\u9898\u6b65\u9aa4\u5199\u6210 Python \u51fd\u6570 solver()\npot_prompt = \"\"\"\nQuestion: Janet has 3 times as many eggs as Bob. Bob has 5 eggs. How many eggs do they have in total?\n\nInstruction:\nWrite a Python function named `solver()` that returns the answer.\nDo not output the number directly. Write the code to calculate it.\nInclude comments explaining the logic.\n\"\"\"\n\n# \u5047\u8bbe LLM \u8fd4\u56de\u4e86\u4ee5\u4e0b\u4ee3\u7801\u5b57\u7b26\u4e32\ngenerated_code = \"\"\"\ndef solver():\n    # Bob has 5 eggs\n    bob_eggs = 5\n    # Janet has 3 times as many as Bob\n    janet_eggs = 3 * bob_eggs\n    # Total eggs\n    total = janet_eggs + bob_eggs\n    return total\n\"\"\"\n\n# 2. \u4ee3\u7801\u6267\u884c\u6c99\u7bb1 (Sandbox Execution)\n# \u8b66\u544a\uff1a\u76f4\u63a5\u6267\u884c\u751f\u6210\u7684\u4ee3\u7801\u6781\u5176\u5371\u9669\uff0c\u5fc5\u987b\u5728\u6c99\u7bb1\u4e2d\u8fd0\u884c\ndef execute_generated_code(code_str):\n    try:\n        # \u751f\u4ea7\u73af\u5883\u8bf7\u4f7f\u7528 Docker, gVisor \u6216 nsjail \u8fdb\u884c\u9694\u79bb\n        local_scope = {}\n\n        # \u9650\u5236\u6267\u884c\u65f6\u95f4\uff0c\u9632\u6b62\u6b7b\u5faa\u73af\n        # \u8fd9\u91cc\u4f7f\u7528\u7b80\u5316\u7684 exec \u6f14\u793a\uff0c\u5b9e\u9645\u9700\u914d\u5408 resource \u6a21\u5757\u9650\u5236 CPU/\u5185\u5b58\n        exec(code_str, {}, local_scope)\n\n        if 'solver' in local_scope:\n            result = local_scope['solver']()\n            return result, \"Success\"\n        else:\n            return None, \"No solver function found\"\n    except Exception as e:\n        return None, f\"Execution Error: {str(e)}\"\n\n# 3. \u9a8c\u8bc1\u4e0e\u6570\u636e\u4fdd\u5b58\nresult, status = execute_generated_code(generated_code)\n\nif status == \"Success\":\n    print(f\"Verified Answer: {result}\")\n    # \u4fdd\u5b58\u6570\u636e\u7b56\u7565\uff1a\n    # \u7b56\u7565 A (PoT): \u4fdd\u5b58 Instruction -&gt; Code\u3002\u8bad\u7ec3\u6a21\u578b\u5199\u4ee3\u7801\u89e3\u9898\u3002\n    # \u7b56\u7565 B (CoT): \u4fdd\u5b58 Instruction -&gt; \"Let's calculate... [Reasoning]... The answer is {result}\"\u3002\n    # \u7b56\u7565 B \u5229\u7528\u4ee3\u7801\u4f5c\u4e3a\u4e2d\u95f4\u6b65\u9aa4\uff0c\u751f\u6210\u7eaf\u6587\u672c\u63a8\u7406\u6570\u636e\u3002\n    save_to_dataset(pot_prompt, generated_code, result)\nelse:\n    print(\"Discard bad data: Code failed to execute\")\n</code></pre> \u5b9e\u6218\u6280\u5de7 (Pro Tip): \u751f\u6210\u7684\u6570\u636e\u4e0d\u4ec5\u53ef\u4ee5\u7528\u6765\u8bad\u7ec3 PoT \u6a21\u578b\uff0c\u8fd8\u53ef\u4ee5\u7528\u6765\u8bad\u7ec3\u666e\u901a\u7684 CoT \u6a21\u578b\u3002\u65b9\u6cd5\u662f\u5c06\u6267\u884c\u6210\u529f\u7684\u4ee3\u7801\u4f5c\u4e3a\u201c\u4e2d\u95f4\u6b65\u9aa4\u201d\uff0c\u5c06\u6267\u884c\u7ed3\u679c\u4f5c\u4e3a\u201c\u6700\u7ec8\u7b54\u6848\u201d\uff0c\u53cd\u5411\u6784\u9020\u6210 <code>&lt;thinking&gt;...code...&lt;/thinking&gt;&lt;answer&gt;...result...&lt;/answer&gt;</code> \u7684\u683c\u5f0f\u3002\u8fd9\u79cd\u201c\u501f\u9e21\u751f\u86cb\u201d\u7684\u65b9\u6cd5\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u7eaf\u6587\u672c\u6a21\u578b\u7684\u7b97\u672f\u51c6\u786e\u7387\u3002<p></p>"},{"location":"part4/4_2_synthetic_data/#1024-llava-pipeline","title":"10.2.4 \u591a\u6a21\u6001\u6307\u4ee4\u5408\u6210\uff1aLLaVA Pipeline","text":"<p>\u5229\u7528\u7eaf\u6587\u672c\u6a21\u578b\u5408\u6210\u591a\u6a21\u6001\u6570\u636e\u662f LLaVA \u7684\u521b\u4e3e\u3002\u8fd9\u79cd\u65b9\u6cd5\u7684\u6838\u5fc3\u5728\u4e8e\u5c06\u89c6\u89c9\u4fe1\u606f\u201c\u7b26\u53f7\u5316\u201d (Symbolization)\u2014\u2014\u65e2\u7136\u7eaf\u6587\u672c\u6a21\u578b\uff08\u5982 GPT-4\uff09\u770b\u4e0d\u89c1\u56fe\u50cf\uff0c\u6211\u4eec\u5c31\u628a\u56fe\u50cf\u7ffb\u8bd1\u6210\u5b83\u80fd\u8bfb\u61c2\u7684\u201c\u4ee3\u7801\u201d\u3002</p> <p> \u56fe 10-2\uff1a LLaVA \u6570\u636e\u5408\u6210\u6d41\u7a0b\u793a\u610f\u56fe</p>"},{"location":"part4/4_2_synthetic_data/#1","title":"1. \u5de5\u7a0b\u6d41\u6c34\u7ebf\uff1a\u4ece\u50cf\u7d20\u5230\u7b26\u53f7","text":"<p>\u5728\u8bbe\u8ba1 Prompt \u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u901a\u8fc7\u5de5\u5177\u94fe\u628a\u56fe\u50cf\u201c\u89e3\u6784\u201d\u4e3a\u6587\u672c\u6a21\u578b\u53ef\u8bfb\u7684\u7ed3\u6784\u5316\u6570\u636e\uff08Metadata\uff09\uff1a</p> <ol> <li> <p>\u5168\u5c40\u8bed\u4e49 (Captioning)</p> <ul> <li>\u5de5\u5177: \u4f7f\u7528 CLIP \u6216 BLIP \u751f\u6210\u4e00\u53e5\u8bdd\u63cf\u8ff0\u3002</li> <li>\u4f5c\u7528: \u63d0\u4f9b\u6574\u4f53\u8bed\u5883\uff08Context\uff09\u3002</li> <li>\u8f93\u51fa\u793a\u4f8b: <code>\"A young girl riding a horse on a beach at sunset.\"</code></li> </ul> </li> <li> <p>\u5c40\u90e8\u7ec6\u8282 (Object Detection)</p> <ul> <li>\u5de5\u5177: \u4f7f\u7528 Grounding DINO \u63d0\u53d6\u7269\u4f53\u53ca\u5176\u5750\u6807\uff08Bounding Box\uff09\u3002</li> <li>\u4f5c\u7528: \u63d0\u4f9b\u7a7a\u95f4\u4f4d\u7f6e\u5b9e\u4f53\uff08Spatial Anchoring\uff09\u3002</li> <li>\u8f93\u51fa\u793a\u4f8b: <code>{'girl': [100, 200, 300, 400], ...}</code></li> </ul> </li> <li> <p>\u6570\u636e\u5408\u6210 (Synthesis)</p> <ul> <li>\u52a8\u4f5c: \u5c06\u4e0a\u8ff0\u4fe1\u606f\u586b\u5165 Prompt\uff0c\u8c03\u7528 GPT-4 \u751f\u6210\u5bf9\u8bdd\u3002</li> </ul> </li> </ol>"},{"location":"part4/4_2_synthetic_data/#2-prompt-engineering","title":"2. Prompt Engineering\uff1a\u8bbe\u8ba1\u4e0e\u8003\u91cf","text":"<p>\u6709\u4e86\u7ed3\u6784\u5316\u6570\u636e\u540e\uff0cPrompt \u7684\u8bbe\u8ba1\u5c31\u6210\u4e86\u51b3\u5b9a\u6570\u636e\u8d28\u91cf\u7684\u5173\u952e\u3002\u4ee5\u4e0b\u662f LLaVA \u98ce\u683c\u7684 Prompt \u6a21\u677f\u53ca\u5176\u8bbe\u8ba1\u80cc\u540e\u7684\u67b6\u6784\u8003\u91cf\uff1a</p> <pre><code># System Prompt for Multimodal Data Generation\nmultimodal_gen_prompt = \"\"\"\n### CONTEXT\nYou are an AI visual assistant. You cannot see the image directly, but I will provide its metadata.\nYour task is to generate a conversation between a Human and Yourself about this image.\n\n### IMAGE METADATA\n# [\u6570\u636e\u6ce8\u5165\u70b9]\uff1a\u6211\u4eec\u5c06\u6d41\u6c34\u7ebf\u63d0\u53d6\u7684\u6570\u636e\u586b\u5165\u8fd9\u91cc\n- **Caption**: \"{caption}\"\n- **Objects**: {object_list_with_boxes}\n\n### INSTRUCTIONS\n1. **Conversation Style**: Generate a multi-turn Q&amp;A (User asking, Assistant answering).\n2. **Reasoning**: The Human should ask complex questions (e.g., \"What suggests this is a safe environment?\"). You answer based on the visual evidence.\n3. **Spatial Awareness**: Use the bounding box info to describe relative positions if asked (e.g., \"The ocean is in the background...\").\n4. **Visual Consistency**: Do NOT hallucinate objects not listed in the metadata.\n\"\"\"\n</code></pre> <p>Prompt \u8bbe\u8ba1\u80cc\u540e\u7684\u67b6\u6784\u8003\u91cf\uff1a</p> <ul> <li> <p>\u4e3a\u4ec0\u4e48\u8981\u540c\u65f6\u63d0\u4f9b Caption \u548c Objects\uff1f\uff08\u4e92\u8865\u6027\uff09     \u4ec5\u6709 Object\uff08\u5973\u5b69\u3001\u9a6c\u3001\u6d77\uff09\u662f\u79bb\u6563\u7684\uff0c\u7f3a\u4e4f\u52a8\u4f5c\u548c\u6c1b\u56f4\uff1b\u4ec5\u6709 Caption\uff08\u5973\u5b69\u9a91\u9a6c\uff09\u7f3a\u4e4f\u5177\u4f53\u7684\u65b9\u4f4d\u4fe1\u606f\u3002\u4e24\u8005\u7ed3\u5408\uff0cGPT-4 \u624d\u80fd\u6784\u5efa\u51fa\u5b8c\u6574\u7684\u601d\u7ef4\u201c\u573a\u666f\u56fe\uff08Scene Graph\uff09\u201d\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u8981\u5f3a\u8c03 \"Spatial Awareness\"\uff1f\uff08\u7a7a\u95f4\u5bf9\u9f50\uff09     \u7eaf\u6587\u672c\u6a21\u578b\u5929\u751f\u7f3a\u4e4f\u7a7a\u95f4\u611f\u3002\u901a\u8fc7\u5f3a\u5236\u5b83\u5904\u7406 <code>[x1, y1, x2, y2]</code> \u5750\u6807\u6570\u636e\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u662f\u5728\u5f3a\u8feb\u6587\u672c\u6a21\u578b\u5b66\u4e60\u201c\u89c6\u89c9\u5bf9\u9f50\u201d\uff0c\u8ba9\u5b83\u5b66\u4f1a\u7406\u89e3\u201c\u5de6\u8fb9\u201d\u3001\u201c\u53f3\u4e0b\u89d2\u201d\u7b49\u6982\u5ff5\u5bf9\u5e94\u7684\u50cf\u7d20\u533a\u57df\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u8981\u52a0\u5165 \"Visual Consistency\" \u7ea6\u675f\uff1f\uff08\u6291\u5236\u5e7b\u89c9\uff09     \u6587\u672c\u6a21\u578b\u6700\u5927\u7684\u7f3a\u9677\u662f\u5bb9\u6613\u201c\u8111\u8865\u201d\u3002\u4f8b\u5982\u770b\u5230\u201c\u6d77\u6ee9\u201d\uff0c\u5b83\u53ef\u80fd\u4f1a\u987a\u5634\u7f16\u51fa\u201c\u6709\u6d77\u9e25\u5728\u98de\u201d\u3002\u5fc5\u987b\u663e\u5f0f\u7981\u6b62\u5b83\u751f\u6210 Metadata \u4e2d\u4e0d\u5b58\u5728\u7684\u7269\u4f53\uff0c\u4ee5\u4fdd\u8bc1\u751f\u6210\u6570\u636e\u7684\u9ad8\u4fe1\u566a\u6bd4\uff08High Signal-to-Noise Ratio\uff09\u3002</p> </li> <li> <p>\u4e3a\u4ec0\u4e48\u8981\u751f\u6210 \"Complex Reasoning\"\uff1f\uff08\u6570\u636e\u5347\u7ef4\uff09     \u5982\u679c\u53ea\u662f\u7b80\u5355\u7684\u201c\u8fd9\u662f\u4ec0\u4e48\uff1f\u8fd9\u662f\u9a6c\u201d\uff0c\u5bf9\u6a21\u578b\u8bad\u7ec3\u6ca1\u6709\u4ef7\u503c\u3002\u6211\u4eec\u9700\u8981\u5229\u7528 GPT-4 \u7684\u667a\u529b\uff0c\u901a\u8fc7\u6570\u636e\u5408\u6210\u4eba\u4e3a\u521b\u9020\u51fa\u201c\u9700\u8981\u601d\u8003\u201d\u7684\u6837\u672c\uff08\u5982\u56e0\u679c\u63a8\u65ad\u3001\u60c5\u7eea\u5206\u6790\uff09\uff0c\u4ece\u800c\u8ba9\u5c0f\u6a21\u578b\uff08Student\uff09\u901a\u8fc7\u84b8\u998f\u5b66\u4f1a\u5927\u6a21\u578b\u7684\u63a8\u7406\u80fd\u529b\u3002</p> </li> </ul>"},{"location":"part4/4_2_synthetic_data/#1025","title":"10.2.5 \u591a\u6a21\u6001\u6307\u4ee4\u6570\u636e\u5408\u6210\u7684\u8fdb\u9636\u7b56\u7565","text":"<p>\u867d\u7136\u57fa\u4e8e\u7eaf\u6587\u672c\u6a21\u578b\u7684\u201c\u7b26\u53f7\u5316\u63a8\u7406\u201d\uff08\u5982 LLaVA v1 \u65e9\u671f\u65b9\u6cd5\uff09\u5f00\u521b\u4e86\u591a\u6a21\u6001\u6307\u4ee4\u5408\u6210\u7684\u5148\u6cb3\uff0c\u4f46\u5176\u4e3b\u8981\u7f3a\u9677\u5728\u4e8e\u201c\u89c6\u89c9\u4fe1\u606f\u7684\u6709\u635f\u538b\u7f29\u201d\u2014\u2014\u6587\u672c\u6a21\u578b\u65e0\u6cd5\u76f4\u63a5\u611f\u77e5\u50cf\u7d20\u7ea7\u7684\u89c6\u89c9\u7279\u5f81\uff0c\u4ec5\u4f9d\u8d56\u5143\u6570\u636e\uff08Metadata\uff09\u8fdb\u884c\u63a8\u7406\u5bb9\u6613\u5bfc\u81f4\u5e7b\u89c9\uff08Hallucination\uff09\u3002</p> <p>\u4e3a\u4e86\u7a81\u7834\u8fd9\u4e00\u74f6\u9888\uff0c\u5f53\u524d\u5de5\u4e1a\u754c\u4e0e\u5b66\u672f\u754c\u5df2\u7ecf\u6f14\u5316\u51fa\u4e09\u79cd\u66f4\u4e3a\u4e3b\u6d41\u4e14\u9ad8\u6548\u7684\u5408\u6210\u7b56\u7565\uff1a\u89c6\u89c9\u5f3a\u6a21\u578b\u84b8\u998f\u3001\u591a\u4e13\u5bb6\u6df7\u5408\u6d41\u6c34\u7ebf\u4ee5\u53ca\u8fdb\u5316\u6307\u4ee4\u751f\u6210\u3002</p>"},{"location":"part4/4_2_synthetic_data/#1-visual-model-distillation","title":"1. \u89c6\u89c9\u5f3a\u6a21\u578b\u84b8\u998f (Visual Model Distillation)","text":"<p>\u8fd9\u662f\u76ee\u524d\uff08\u622a\u81f3 2024-2025 \u5e74\uff09\u6784\u5efa\u9ad8\u6027\u80fd\u5f00\u6e90\u591a\u6a21\u6001\u6a21\u578b\uff08\u5982 LLaVA-NeXT, ShareGPT4V\uff09\u7684\u6700\u4e3b\u6d41\u65b9\u6cd5\uff0c\u5e38\u88ab\u89c6\u4e3a SOTA\uff08State-of-the-Art\uff09\u65b9\u6848\u3002</p> <p>\u6838\u5fc3\u601d\u60f3 \u8be5\u65b9\u6cd5\u6452\u5f03\u4e86\u201c\u5229\u7528\u6587\u672c\u6a21\u578b\u731c\u6d4b\u89c6\u89c9\u5185\u5bb9\u201d\u7684\u8def\u5f84\uff0c\u8f6c\u800c\u91c7\u7528\u201c\u6559\u5e08-\u5b66\u751f\u201d\uff08Teacher-Student\uff09\u84b8\u998f\u8303\u5f0f\u3002\u5229\u7528\u95ed\u6e90\u7684\u9876\u5c16\u591a\u6a21\u6001\u5927\u6a21\u578b\uff08\u5982 GPT-4o, Gemini 1.5 Pro\uff09\u4f5c\u4e3a\u201c\u6559\u5e08\u6a21\u578b\u201d\uff0c\u76f4\u63a5\u5904\u7406\u539f\u59cb\u56fe\u50cf\u4fe1\u53f7\uff0c\u751f\u6210\u9ad8\u8d28\u91cf\u3001\u9ad8\u5bc6\u5ea6\u7684\u8be6\u7ec6\u63cf\u8ff0\uff08Dense Caption\uff09\u548c\u590d\u6742\u7684\u63a8\u7406\u95ee\u7b54\u5bf9\uff0c\u4f9b\u5f00\u6e90\u6a21\u578b\uff08\u5b66\u751f\u6a21\u578b\uff09\u5b66\u4e60\u3002</p> <p>\u4f18\u52bf\u5206\u6790 * \u6d88\u9664\u6a21\u6001\u9694\u9602\uff1a\u6559\u5e08\u6a21\u578b\u76f4\u63a5\u201c\u770b\u201d\u5230\u56fe\u50cf\u50cf\u7d20\uff0c\u80fd\u591f\u6355\u6349\u5149\u5f71\u3001\u6750\u8d28\u3001\u5fae\u8868\u60c5\u7b49\u6587\u672c\u5143\u6570\u636e\u65e0\u6cd5\u627f\u8f7d\u7684\u7ec6\u8282\u3002 * \u6291\u5236\u5e7b\u89c9\uff1a\u57fa\u4e8e\u771f\u5b9e\u89c6\u89c9\u8f93\u5165\u7684\u63cf\u8ff0\u6781\u5927\u964d\u4f4e\u4e86\u4e8b\u5b9e\u6027\u9519\u8bef\u7684\u6982\u7387\u3002</p> <p>\u5b9e\u73b0\u6d41\u7a0b \u5176\u6838\u5fc3\u5728\u4e8e\u6784\u5efa\u4e00\u4e2a\u80fd\u591f\u8bf1\u5bfc\u6559\u5e08\u6a21\u578b\u8f93\u51fa\u8be6\u5c3d\u4fe1\u606f\u7684 Prompt\u3002\u4ee5\u4e0b\u662f\u4e00\u4e2a\u6807\u51c6\u7684\u84b8\u998f\u6d41\u7a0b\u4f2a\u4ee3\u7801\uff1a</p> <pre><code>def generate_dense_instruction(image_path, api_client):\n    \"\"\"\n    \u5229\u7528 SOTA MLLM \u751f\u6210\u9ad8\u5bc6\u5ea6\u591a\u6a21\u6001\u6307\u4ee4\u6570\u636e\n    \"\"\"\n\n    # System Prompt \u8bbe\u8ba1\u5173\u952e\uff1a\u8981\u6c42\u6781\u5176\u8be6\u5c3d\u7684\u7ec6\u8282\u6355\u6349\u4e0e\u903b\u8f91\u5173\u8054\n    distillation_prompt = \"\"\"\n    You are an expert visual analyst. Analyze the provided image with extreme detail.\n\n    Tasks:\n    1. Dense Captioning: Provide a comprehensive description of every corner of the image, covering colors, textures, lighting, and background details.\n    2. Object Relationships: Analyze the interactions between objects (e.g., causality, spatial relations).\n    3. OCR Extraction: Transcribe any visible text verbatim.\n    4. Q&amp;A Generation: Based on the visual details above, create a logical reasoning question that cannot be answered without looking at the image.\n    \"\"\"\n\n    # \u5173\u952e\u5dee\u5f02\uff1a\u8f93\u5165\u5305\u542b\u771f\u5b9e\u7684 Image Tensor\uff0c\u800c\u975e\u4ec5\u4ec5\u662f Bounding Box\n    response = api_client.chat.completions.create(\n        model=\"gpt-4o\",\n        messages=[\n            {\"role\": \"system\", \"content\": distillation_prompt},\n            {\"role\": \"user\", \"content\": [{\"type\": \"image_url\", \"url\": image_path}]}\n        ]\n    )\n\n    return parse_response(response)\n</code></pre>"},{"location":"part4/4_2_synthetic_data/#2-mixture-of-experts-pipeline","title":"2. \u9886\u57df\u7279\u5316\uff1a\u591a\u4e13\u5bb6\u6df7\u5408\u6d41\u6c34\u7ebf (Mixture-of-Experts Pipeline)","text":"<p>\u5bf9\u4e8e\u901a\u7528\u5927\u6a21\u578b\u96be\u4ee5\u8986\u76d6\u7684\u5782\u76f4\u9886\u57df\u2014\u2014\u5982\u6587\u6863\u667a\u80fd\uff08Document AI\uff09\u3001\u590d\u6742\u56fe\u8868\u5206\u6790\u6216\u81ea\u52a8\u9a7e\u9a76\u6570\u636e\uff0c\u901a\u7528\u7684\u89c6\u89c9\u84b8\u998f\u5f80\u5f80\u7f3a\u4e4f\u7cbe\u5ea6\u3002\u6b64\u65f6\uff0c\u91c7\u7528\u201c\u591a\u4e13\u5bb6\u6df7\u5408\u201d\u7b56\u7565\u662f\u6700\u4f73\u5b9e\u8df5\u3002</p> <p>\u6838\u5fc3\u903b\u8f91 \u8be5\u65b9\u6cd5\u4e0d\u4f9d\u8d56\u5355\u4e00\u6a21\u578b\u7684\u7aef\u5230\u7aef\u80fd\u529b\uff0c\u800c\u662f\u7ec4\u88c5\u591a\u4e2a\u4e13\u7528\u7684\u5c0f\u6a21\u578b\uff08Experts\uff09\u4f5c\u4e3a\u611f\u77e5\u524d\u7aef\uff0c\u5c06\u975e\u7ed3\u6784\u5316\u56fe\u50cf\u8f6c\u5316\u4e3a\u7cbe\u7ec6\u7684\u7ed3\u6784\u5316\u6570\u636e\uff0c\u518d\u7531 LLM \u8fdb\u884c\u6574\u5408\u3002</p> <p>\u903b\u8f91\u6d41\uff1a $$ \\text{Image} \\xrightarrow{\\text{Experts}} [\\text{OCR} + \\text{Layout} + \\text{Detection}] \\xrightarrow{\\text{Aggregation}} \\text{Structured Context} \\xrightarrow{\\text{LLM}} \\text{Instruction} $$</p> <p>\u5e94\u7528\u573a\u666f\u4e0e\u6d41\u7a0b\u56fe\u89e3 \u5178\u578b\u5e94\u7528\u5305\u62ec\u91d1\u878d\u7968\u636e\u5904\u7406\uff08Invoices\uff09\u3001\u533b\u7597\u5f71\u50cf\u62a5\u544a\uff08DICOM\uff09\u7b49\u3002</p> <ol> <li>OCR Expert (\u5982 PaddleOCR): \u63d0\u53d6\u56fe\u50cf\u4e2d\u6240\u6709\u6587\u672c\u53ca\u5176\u7cbe\u786e\u5750\u6807 \\((x_1, y_1, x_2, y_2)\\)\u3002</li> <li>Layout Expert (\u5982 LayoutLM): \u89e3\u6790\u6587\u6863\u7684\u62d3\u6251\u7ed3\u6784\uff0c\u8bc6\u522b\u8868\u683c\u884c\u5217\u3001\u6bb5\u843d\u5c42\u7ea7\u548c\u6807\u9898\u5173\u7cfb\u3002</li> <li>Synthesis (LLM): \u5c06\u4e0a\u8ff0\u7ed3\u6784\u5316\u6570\u636e\u586b\u5165 Prompt \u6a21\u677f\u3002<ul> <li>Example Prompt: \u201c\u8fd9\u662f\u4e00\u5f20\u53d1\u7968\u7684\u7ed3\u6784\u5316\u6570\u636e\uff0c\u53d1\u7968\u53f7\u7801\u4f4d\u4e8e (100, 200)\uff0c\u91d1\u989d\u603b\u8ba1\u4e3a 500.00\u3002\u8bf7\u57fa\u4e8e\u6b64\u751f\u6210\u4e00\u4e2a\u5173\u4e8e\u2018\u8d22\u52a1\u5ba1\u8ba1\u6838\u5bf9\u2019\u7684\u591a\u8f6e\u95ee\u7b54\u3002\u201d</li> </ul> </li> </ol> <p> \u56fe 10-3\uff1a \u591a\u4e13\u5bb6\u6df7\u5408\u6d41\u6c34\u7ebf\u793a\u610f\u56fe</p>"},{"location":"part4/4_2_synthetic_data/#3-visual-evol-instruct","title":"3. \u8fdb\u5316\u6307\u4ee4\u751f\u6210 (Visual Evol-Instruct)","text":"<p>\u53d7\u7eaf\u6587\u672c\u9886\u57df WizardLM \u7684\u542f\u53d1\uff0cVisual Evol-Instruct \u65e8\u5728\u89e3\u51b3\u8bad\u7ec3\u6570\u636e\u201c\u540c\u8d28\u5316\u201d\u548c\u201c\u7b80\u5355\u5316\u201d\u7684\u95ee\u9898\u3002\u5f53\u57fa\u7840\u6570\u636e\u96c6\u4ec5\u5305\u542b\u7b80\u5355\u7684\u8bc6\u522b\u4efb\u52a1\uff08\u5982\u201c\u56fe\u91cc\u6709\u4ec0\u4e48\uff1f\u201d\uff09\u65f6\uff0c\u6a21\u578b\u65e0\u6cd5\u5b66\u4f1a\u9ad8\u9636\u63a8\u7406\u3002\u8be5\u65b9\u6cd5\u901a\u8fc7 Prompt Engineering \u5f3a\u5236\u8ba9\u6a21\u578b\u5bf9\u73b0\u6709\u6570\u636e\u8fdb\u884c\u201c\u5347\u7ef4\u201d\u3002</p> <p>\u6838\u5fc3\u903b\u8f91 $$ \\text{Simple VQA} \\xrightarrow{\\text{Complexity Constraints}} \\text{Complex Reasoning VQA} $$</p> <p>\u901a\u8fc7\u5411 LLM \u65bd\u52a0\u7279\u5b9a\u7684\u8fdb\u5316\u6307\u4ee4\uff0c\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u7ef4\u5ea6\u63d0\u5347\u6570\u636e\u590d\u6742\u5ea6\uff1a</p> <ul> <li>\u6df1\u5ea6\u63a8\u7406\u5316 (Reasoning):<ul> <li>\u539f\u9898: \u201c\u8fd9\u4e2a\u4eba\u624b\u91cc\u62ff\u7740\u4ec0\u4e48\uff1f\u201d</li> <li>\u8fdb\u5316\u540e: \u201c\u7ed3\u5408\u624b\u4e2d\u7269\u4f53\u7684\u7528\u9014\u548c\u4eba\u7269\u7684\u7a7f\u7740\uff0c\u63a8\u6d4b\u6b64\u4eba\u7684\u804c\u4e1a\u4ee5\u53ca\u4ed6\u63a5\u4e0b\u6765\u53ef\u80fd\u8fdb\u884c\u7684\u6d3b\u52a8\u3002\u201d</li> </ul> </li> <li>\u53cd\u4e8b\u5b9e\u63a8\u7406 (Counterfactual):<ul> <li>\u539f\u9898: \u201c\u56fe\u4e2d\u7684\u8f66\u662f\u7ea2\u8272\u7684\u3002\u201d</li> <li>\u8fdb\u5316\u540e: \u201c\u5982\u679c\u5c06\u56fe\u4e2d\u7684\u7ea2\u8272\u8dd1\u8f66\u66ff\u6362\u4e3a\u4e00\u8f86\u8001\u65e7\u7684\u81ea\u884c\u8f66\uff0c\u6574\u4e2a\u573a\u666f\u7684\u6c1b\u56f4\u4f1a\u53d1\u751f\u600e\u6837\u7684\u53d8\u5316\uff1f\u8fd9\u662f\u5426\u7b26\u5408\u80cc\u666f\u4e2d\u51fa\u73b0\u7684\u73b0\u4ee3\u5efa\u7b51\u98ce\u683c\uff1f\u201d</li> </ul> </li> <li>\u6bd4\u8f83\u5206\u6790 (Comparative):<ul> <li>\u8f93\u5165\u4e24\u5f20\u76f8\u4f3c\u56fe\u50cf\uff0c\u8981\u6c42\u6a21\u578b\u5206\u6790\u5176\u7ec6\u5fae\u5dee\u5f02\uff08\u5982\u5149\u7167\u53d8\u5316\u3001\u7269\u4f53\u4f4d\u79fb\uff09\uff0c\u8bad\u7ec3\u6a21\u578b\u7684\u7ec6\u7c92\u5ea6\u89c2\u5bdf\u529b\u3002</li> </ul> </li> </ul> <p>\u901a\u8fc7\u4e0a\u8ff0\u4e09\u79cd\u7b56\u7565\u7684\u7ec4\u5408\u4f7f\u7528\uff0c\u6211\u4eec\u53ef\u4ee5\u6784\u5efa\u51fa\u65e2\u5305\u542b\u4e30\u5bcc\u89c6\u89c9\u7ec6\u8282\uff0c\u53c8\u5177\u5907\u6df1\u5ea6\u903b\u8f91\u63a8\u7406\u80fd\u529b\u7684\u9ad8\u8d28\u91cf\u591a\u6a21\u6001\u6307\u4ee4\u6570\u636e\u96c6\uff0c\u4e3a\u8bad\u7ec3 LLaVA\u3001MiniGPT-4 \u7b49\u6a21\u578b\u6253\u4e0b\u575a\u5b9e\u57fa\u7840\u3002</p>"},{"location":"part4/4_2_synthetic_data/#103-performance-evaluation","title":"10.3. \u6027\u80fd\u4e0e\u8bc4\u4f30 (Performance &amp; Evaluation)","text":"<p>\u5728\u5408\u6210\u6570\u636e\u4e0a\u8bad\u7ec3\u5b8c\u6a21\u578b\u540e\uff0c\u8bc4\u4f30\u663e\u5f97\u5c24\u4e3a\u91cd\u8981\uff0c\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u786e\u8ba4\u6a21\u578b\u662f\u771f\u7684\u201c\u5b66\u4f1a\u4e86\u201d\u8fd8\u662f\u4ec5\u4ec5\u201c\u8bb0\u4f4f\u4e86\u201d\u5408\u6210\u6570\u636e\u4e2d\u7684\u6a21\u5f0f\u3002</p>"},{"location":"part4/4_2_synthetic_data/#_3","title":"\u8bc4\u4ef7\u6307\u6807","text":"<ul> <li>Pass@1 (\u4ee3\u7801): \u5bf9\u4e8e PoT \u5408\u6210\u6570\u636e\uff0c\u6211\u4eec\u5728 HumanEval \u4e0a\u6d4b\u8bd5 Pass@1\u3002Phi-1 \u4ec5\u7528 6B \u6570\u636e\u5c31\u8fbe\u5230\u4e86 50%+ \u7684 Pass@1\uff0c\u8d85\u8fc7\u4e86\u8bb8\u591a\u8bad\u7ec3\u6570\u636e\u91cf\u5927 100 \u500d\u7684\u6a21\u578b\u3002\u8fd9\u8bc1\u660e\u4e86\u6570\u636e\u8d28\u91cf\u7684\u538b\u5012\u6027\u4f18\u52bf\u3002</li> <li>Hallucination Rate (\u5e7b\u89c9\u7387): \u6bd4\u8f83\u5408\u6210\u7684\u591a\u6a21\u6001\u56de\u7b54\u4e0e\u539f\u56fe\u7684 CLIP \u76f8\u4f3c\u5ea6\uff0c\u68c0\u6d4b\u662f\u5426\u751f\u6210\u4e86\u56fe\u4e2d\u4e0d\u5b58\u5728\u7684\u7269\u4f53\u3002\u6211\u4eec\u53ef\u4ee5\u6784\u5efa\u4e00\u4e2a\u8d1f\u6837\u672c\u96c6\uff0c\u4e13\u95e8\u8bf1\u5bfc\u6a21\u578b\u56de\u7b54\u4e0d\u5b58\u5728\u7684\u7269\u4f53\uff0c\u770b\u6a21\u578b\u662f\u5426\u80fd\u62d2\u7edd\u56de\u7b54\u3002</li> <li>Decontamination (\u53bb\u6c61\u67d3\u68c0\u6d4b): \u8fd9\u662f\u4e00\u4e2a\u80ae\u810f\u4f46\u5fc5\u987b\u7684\u6b65\u9aa4\u3002\u6211\u4eec\u9700\u8981\u68c0\u67e5\u5408\u6210\u6570\u636e\u662f\u5426\u65e0\u610f\u4e2d\u5305\u542b\u4e86\u6d4b\u8bd5\u96c6\uff08\u5982 HumanEval\uff09\u7684\u9898\u76ee\u3002\u901a\u8fc7 N-gram \u91cd\u53e0\u68c0\u6d4b\uff0c\u786e\u4fdd\u6a21\u578b\u662f\u5728\u6cdb\u5316\u800c\u975e\u4f5c\u5f0a\u3002</li> </ul>"},{"location":"part4/4_2_synthetic_data/#_4","title":"\u57fa\u51c6\u6d4b\u8bd5","text":"<ul> <li>PoT vs CoT: \u5728\u6570\u5b66\u9898\uff08\u5982 GSM8K\uff09\u4e0a\uff0cPoT \u65b9\u6cd5\u901a\u5e38\u6bd4\u7eaf\u6587\u672c CoT \u51c6\u786e\u7387\u9ad8 5-10%\u3002\u539f\u56e0\u5728\u4e8e PoT \u5c06\u8ba1\u7b97\u5916\u5305\u7ed9\u4e86\u6700\u64c5\u957f\u8ba1\u7b97\u7684 CPU\uff0c\u800c\u8ba9 GPU \u4e13\u6ce8\u4e8e\u5176\u64c5\u957f\u7684\u903b\u8f91\u7ffb\u8bd1\uff0c\u8fd9\u662f\u4e00\u79cd\u6700\u4f18\u7684\u7b97\u529b\u5206\u914d\u3002</li> </ul>"},{"location":"part4/4_2_synthetic_data/#104-pitfalls-troubleshooting","title":"10.4. \u907f\u5751\u6307\u5357 (Pitfalls &amp; Troubleshooting)","text":"<p>\u5408\u6210\u6570\u636e\u867d\u7136\u7f8e\u597d\uff0c\u4f46\u4e5f\u5145\u6ee1\u4e86\u9677\u9631\u3002\u7a0d\u6709\u4e0d\u614e\uff0c\u6a21\u578b\u5c31\u4f1a\u9677\u5165\u201c\u81ea\u6211\u9676\u9189\u201d\u7684\u602a\u5708\u3002</p> <ul> <li> <p>\u9677\u9631 1\uff1aSelf-Confirmation Bias (\u81ea\u8bc1\u504f\u5dee)</p> <ul> <li>\u73b0\u8c61\uff1a \u6a21\u578b\u751f\u6210\u7684\u4ee3\u7801\u867d\u7136\u80fd\u8dd1\u901a\uff0c\u4f46\u903b\u8f91\u662f\u9519\u7684\uff08\u4f8b\u5982 2+2=5\uff0c\u4e14\u6a21\u578b\u751f\u6210\u7684\u6d4b\u8bd5\u7528\u4f8b\u4e5f\u662f\u9519\u7684\uff0c\u6070\u597d\u901a\u8fc7\u4e86\u9519\u8bef\u7684\u51fd\u6570\uff09\u3002</li> <li>\u4fee\u6b63\uff1a \u5fc5\u987b\u5f15\u5165\u5916\u90e8\u7684\u3001\u786e\u5b9a\u6027\u7684 Solver \u6216\u7ecf\u8fc7\u4eba\u5de5\u5ba1\u6838\u7684 Unit Tests \u5e93\u3002\u6c38\u8fdc\u4e0d\u8981\u5b8c\u5168\u4f9d\u8d56\u6a21\u578b\u751f\u6210\u7684\u6d4b\u8bd5\u7528\u4f8b\u6765\u9a8c\u8bc1\u6a21\u578b\u751f\u6210\u7684\u4ee3\u7801\uff0c\u8fd9\u5c31\u50cf\u8ba9\u7f6a\u72af\u81ea\u5df1\u5ba1\u5224\u81ea\u5df1\u3002</li> </ul> </li> <li> <p>\u9677\u9631 2\uff1aLack of Visual Grounding (\u89c6\u89c9\u951a\u70b9\u7f3a\u5931)</p> <ul> <li>\u73b0\u8c61\uff1a \u591a\u6a21\u6001\u5408\u6210\u6570\u636e\u4e2d\uff0c\u6a21\u578b\u8ba8\u8bba\u4e86 metadata \u4e2d\u6ca1\u63d0\u5230\u7684\u7ec6\u8282\uff08\u778e\u7f16\uff09\u3002\u4f8b\u5982\uff0cMetadata \u91cc\u53ea\u6709\u201c\u72d7\u201d\uff0c\u6a21\u578b\u5374\u5f00\u59cb\u63cf\u8ff0\u201c\u72d7\u9879\u5708\u7684\u989c\u8272\u201d\uff0c\u800c\u56fe\u7247\u91cc\u7684\u72d7\u6839\u672c\u6ca1\u6234\u9879\u5708\u3002</li> <li>\u4fee\u6b63\uff1a \u5728 Prompt \u4e2d\u52a0\u5165 strict instruction\uff1a\u201cOnly strictly rely on the provided metadata. Do not invent details.\u201d \u540c\u65f6\uff0c\u4f7f\u7528 CLIP Score \u8fc7\u6ee4\u6389\u90a3\u4e9b\u4e0e\u539f\u56fe\u76f8\u4f3c\u5ea6\u8fc7\u4f4e\u7684\u751f\u6210\u6587\u672c\u3002</li> </ul> </li> <li> <p>\u9677\u9631 3\uff1aThe Homogenization Trap (\u540c\u8d28\u5316\u9677\u9631)</p> <ul> <li>\u73b0\u8c61\uff1a \u5982\u679c\u6240\u6709\u6570\u636e\u90fd\u7531 GPT-4 \u751f\u6210\uff0c\u4f60\u7684\u6a21\u578b\u6700\u7ec8\u4f1a\u53d8\u6210\u4e00\u4e2a\u201c\u4f4e\u914d\u7248 GPT-4\u201d\uff0c\u5931\u53bb\u4e86\u591a\u6837\u6027\u3002\u6240\u6709\u7684\u56de\u7b54\u8bed\u6c14\u3001\u53e5\u5f0f\u90fd\u60ca\u4eba\u7684\u4e00\u81f4\u3002</li> <li>\u4fee\u6b63\uff1a \u71b5\u6ce8\u5165 (Entropy Injection)\u3002\u5728 Prompt \u4e2d\u968f\u673a\u6ce8\u5165\u4e0d\u540c\u7684 Persona\uff08\u5982\u201c\u66b4\u8e81\u7684\u7a0b\u5e8f\u5458\u201d\u3001\u201c\u8010\u5fc3\u7684\u5e7c\u513f\u56ed\u8001\u5e08\u201d\uff09\uff0c\u6216\u8005\u8981\u6c42\u6a21\u578b\u4f7f\u7528\u4e0d\u540c\u7684\u7f16\u7a0b\u98ce\u683c\uff08\u9012\u5f52 vs \u8fed\u4ee3\uff09\uff0c\u5f3a\u5236\u6269\u5c55\u6570\u636e\u7684\u5206\u5e03\u8303\u56f4\u3002</li> </ul> </li> </ul>"},{"location":"part4/4_2_synthetic_data/#105","title":"10.5. \u672c\u7ae0\u5c0f\u7ed3\u4e0e\u5ef6\u4f38\u9605\u8bfb","text":"<p>Textbooks Are All You Need\u201d \u8303\u5f0f\u786e\u7acb\u4e86\u6570\u636e\u8d28\u91cf\uff08\u5373\u6559\u80b2\u4ef7\u503c\uff09\u4f18\u5148\u4e8e\u6570\u91cf\u7684\u6838\u5fc3\u539f\u5219\uff0c\u800c\u5408\u6210\u6570\u636e\u6280\u672f\u8d4b\u4e88\u4e86\u6211\u4eec\u8981\u7cbe\u786e\u63a7\u5236\u6570\u636e\u4fe1\u566a\u6bd4\u7684\u80fd\u529b\u3002\u5728\u6b64\u4f53\u7cfb\u4e0b\uff0c\u7a0b\u5e8f\u601d\u7ef4\uff08PoT\uff09\u901a\u8fc7\u5c06\u63a8\u7406\u8fc7\u7a0b\u8f6c\u5316\u4e3a\u53ef\u6267\u884c\u4ee3\u7801\uff0c\u5229\u7528\u7f16\u8bd1\u5668\u7684\u786e\u5b9a\u6027\u6765\u9a8c\u8bc1\u903b\u8f91\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u6570\u636e\u7684\u4e25\u8c28\u6027\u3002\u540c\u65f6\uff0cSymbolic-to-Synthetic \u65b9\u6cd5\u5229\u7528\u5143\u6570\u636e\uff08\u5982 Bounding Box\uff09\u5f15\u5bfc\u6587\u672c\u6a21\u578b\u751f\u6210\u591a\u6a21\u6001\u5185\u5bb9\uff0c\u5b9e\u73b0\u4e86\u4ece\u5355\u6a21\u6001\u5411\u591a\u6a21\u6001\u6570\u636e\u7684\u6709\u6548\u8f6c\u5316\u3002\u8fd9\u4e00\u7cfb\u5217\u6f14\u8fdb\u6807\u5fd7\u7740\u6570\u636e\u5de5\u7a0b\u6b63\u5728\u7ecf\u5386\u4ece\u88ab\u52a8\u201c\u6316\u6398\u201d\u5230\u4e3b\u52a8\u201c\u751f\u4ea7\u201d\u7684\u6a21\u5f0f\u8f6c\u53d8\uff1a\u5373\u901a\u8fc7\u79cd\u5b50\u63d0\u793a\u8bcd\u6784\u5efa\uff08Seed Prompts\uff09\u3001\u6307\u4ee4\u590d\u6742\u5316\uff08Evolution\uff09\u3001\u8d28\u91cf\u8fc7\u6ee4\uff08Filtering\uff09\u4e0e\u6700\u7ec8\u5408\u6210\uff08Synthesis\uff09\u7684\u6807\u51c6\u5de5\u4e1a\u5316\u6d41\u7a0b\uff0c\u7cfb\u7edf\u6027\u5730\u6784\u5efa\u9ad8\u8d28\u91cf\u6570\u636e\u96c6\u3002</p>"},{"location":"part4/4_2_synthetic_data/#_5","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Gunasekar, S., et al. (2023). Textbooks Are All You Need (Phi-1).</li> <li>Chen, W., et al. (2022). Program of Thoughts Prompting: Disentangling Computation from Reasoning for Numerical Reasoning Tasks.</li> <li>Liu, H., et al. (2023). Visual Instruction Tuning (LLaVA).</li> <li>Shumailov, I., et al. (2023). The Curse of Recursion: Training on Generated Data Makes Models Forget. (\u5173\u4e8e\u6a21\u578b\u574d\u584c\u7684\u91cd\u8981\u7814\u7a76)</li> </ul>"},{"location":"part4/4_3_preference_data/","title":"\u7b2c11\u7ae0\uff1a\u4eba\u7c7b\u504f\u597d\u6570\u636e","text":""},{"location":"part4/4_3_preference_data/#11-rlhfdpo","title":"\u7b2c11\u7ae0\uff1a\u4eba\u7c7b\u504f\u597d\u6570\u636e (RLHF/DPO)","text":""},{"location":"part4/4_3_preference_data/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u5982\u679c\u8bf4 SFT\uff08\u6307\u4ee4\u5fae\u8c03\uff09\u662f\u8ba9\u6a21\u578b\u201c\u5b66\u4f1a\u8bf4\u8bdd\u201d\uff0c\u83b7\u5f97\u4e86\u57fa\u7840\u7684\u8bed\u8a00\u80fd\u529b\u548c\u4efb\u52a1\u5904\u7406\u80fd\u529b\uff0c\u90a3\u4e48\u504f\u597d\u5bf9\u9f50\uff08RLHF/DPO\uff09\u5219\u662f\u8ba9\u6a21\u578b\u201c\u8bf4\u6b63\u786e\u7684\u8bdd\u201d\uff0c\u4f7f\u5176\u8f93\u51fa\u7b26\u5408\u4eba\u7c7b\u7684\u4ef7\u503c\u89c2\u3001\u4f26\u7406\u6807\u51c6\u4ee5\u53ca\u7279\u5b9a\u7684\u4e1a\u52a1\u504f\u597d\u3002\u672c\u7ae0\u5c06\u6df1\u5165\u5256\u6790 DPO\uff08Direct Preference Optimization\uff09\u7b97\u6cd5\u7684\u6838\u5fc3\u2014\u2014\u7531 Chosen\u4e0e Rejected\u7ec4\u6210\u7684\u6837\u672c\u5bf9\u3002\u6211\u4eec\u5c06\u63a2\u8ba8\u5982\u4f55\u4ece\u6df7\u4e71\u7684\u4eba\u7c7b\u4e3b\u89c2\u5224\u65ad\u4e2d\u63d0\u53d6\u51fa\u9ad8\u8d28\u91cf\u7684\u4fe1\u53f7\uff0c\u8fd9\u6d89\u53ca\u5230\u6807\u6ce8\u5e73\u53f0\u7684\u4e00\u81f4\u6027\u7ba1\u7406\uff08IAA\uff09\u4ee5\u53ca\u5bf9\u4eba\u7c7b\u8ba4\u77e5\u504f\u5dee\u7684\u6df1\u523b\u7406\u89e3\u3002\u6b64\u5916\uff0c\u6211\u4eec\u5c06\u91cd\u70b9\u4ecb\u7ecd\u524d\u6cbf\u7684 RLAIF (Constitutional AI) \u6280\u672f\uff0c\u5373\u5229\u7528 AI \u6839\u636e\u9884\u8bbe\u7684\u201c\u5baa\u6cd5\u201d\u539f\u5219\u66ff\u4ee3\u4eba\u7c7b\u8fdb\u884c\u504f\u597d\u6253\u5206\uff0c\u8fd9\u4e00\u6280\u672f\u6b63\u5728\u6839\u672c\u6027\u5730\u6539\u53d8\u5927\u89c4\u6a21\u5bf9\u9f50\u7684\u6210\u672c\u7ed3\u6784\u4e0e\u6548\u7387\u3002</p> <p>\u5b66\u4e60\u76ee\u6807 (Learning Objectives)\uff1a * \u6df1\u5ea6\u638c\u63e1 \u6784\u5efa DPO \u4e09\u5143\u7ec4 (Prompt, Chosen, Rejected) \u7684\u6807\u51c6\u6570\u636e\u683c\u5f0f\uff0c\u7406\u89e3\u5176\u80cc\u540e\u7684\u5bf9\u6bd4\u5b66\u4e60\u539f\u7406\u53ca\u6570\u5b66\u610f\u4e49\u3002 * \u900f\u5f7b\u7406\u89e3 \u6807\u6ce8\u566a\u97f3\u7684\u5fc3\u7406\u5b66\u4e0e\u7edf\u8ba1\u5b66\u6765\u6e90\uff0c\u80fd\u591f\u8ba1\u7b97 IAA (Inter-Annotator Agreement) \u5e76\u5229\u7528 Cohen's Kappa \u7cfb\u6570\u6e05\u6d17\u4f4e\u8d28\u91cf\u6570\u636e\u3002 * \u5de5\u7a0b\u843d\u5730 Constitutional AI \u7684 Critique-Revision \u5faa\u73af\uff0c\u5229\u7528\u201c\u5224\u522b\u5668\u201d\u5f3a\u4e8e\u201c\u751f\u6210\u5668\u201d\u7684\u7279\u6027\uff0c\u81ea\u52a8\u5316\u751f\u6210\u5927\u89c4\u6a21\u65e0\u5bb3\u5316\uff08Harmless\uff09\u504f\u597d\u6570\u636e\u3002</p> <p>\u573a\u666f\u5f15\u5165\uff1a \u201c\u4f60\u7684 SFT \u6a21\u578b\u975e\u5e38\u542c\u8bdd\uff0c\u542c\u8bdd\u5230\u6709\u4eba\u95ee\u2018\u5982\u4f55\u5236\u9020\u6bd2\u836f\u2019\u65f6\uff0c\u5b83\u4e5f\u8be6\u7ec6\u5217\u51fa\u4e86\u5316\u5b66\u914d\u65b9\u3002\u8fd9\u662f\u7edd\u5bf9\u7684\u5b89\u5168\u7ea2\u7ebf\uff0c\u5728\u5de5\u4e1a\u754c\u88ab\u79f0\u4e3a\u2018\u8d8a\u72f1\u2019\uff08Jailbreak\uff09\u3002\u4f60\u9700\u8981\u8ba9\u6a21\u578b\u5b66\u4f1a\u2018\u62d2\u7edd\u2019\u6076\u610f\u6307\u4ee4\uff0c\u540c\u65f6\u5bf9\u6b63\u5e38\u6307\u4ee4\u4fdd\u6301\u2018\u6709\u76ca\u2019\u3002\u7136\u800c\uff0c\u96c7\u4f63\u4eba\u7c7b\u6807\u6ce8\u5458\u53bb\u9605\u8bfb\u6210\u5343\u4e0a\u4e07\u6761\u6709\u6bd2\u4fe1\u606f\u4e0d\u4ec5\u6210\u672c\u9ad8\u6602\uff0c\u8fd8\u4f1a\u5bf9\u6807\u6ce8\u5458\u9020\u6210\u2018\u5fc3\u7406\u521b\u4f24\u2019\uff08Psychological Distress\uff09\uff0c\u8fd9\u5728\u4f26\u7406\u4e0a\u662f\u4e0d\u53ef\u6301\u7eed\u7684\u3002\u6709\u6ca1\u6709\u529e\u6cd5\u8ba9 AI \u81ea\u5df1\u8bfb\u8fd9\u4e9b\u6709\u6bd2\u4fe1\u606f\uff0c\u5e76\u81ea\u5df1\u544a\u8bc9\u81ea\u5df1\uff1a\u2018\u8fd9\u6837\u56de\u7b54\u662f\u4e0d\u5bf9\u7684\u2019\uff1f\u8fd9\u5c31\u662f\u4ece Human Feedback \u8fc8\u5411 AI Feedback \u7684\u5fc5\u7136\u4e4b\u8def\u3002\u201d</p> <p> \u56fe 11-1\uff1a \u4eba\u7c7b\u504f\u597d\u793a\u610f\u56fe</p>"},{"location":"part4/4_3_preference_data/#111-concepts-principles","title":"11.1 \u6838\u5fc3\u6982\u5ff5\u4e0e\u539f\u7406 (Concepts &amp; Principles)","text":""},{"location":"part4/4_3_preference_data/#1111-chosen-vs-rejected","title":"11.1.1 \u504f\u597d\u6570\u636e\u683c\u5f0f\uff1aChosen vs Rejected \u7684\u5bf9\u6bd4\u54f2\u5b66","text":"<p>\u65e0\u8bba\u662f\u4f20\u7edf\u7684\u8bad\u7ec3 Reward Model (PPO\u8def\u7ebf) \u8fd8\u662f\u5f53\u4e0b\u6d41\u884c\u7684\u76f4\u63a5\u4f18\u5316 Policy (DPO\u8def\u7ebf)\uff0c\u6838\u5fc3\u6570\u636e\u5355\u5143\u90fd\u662f\u201c\u504f\u597d\u5bf9\u201d\uff0c\u5176\u6807\u51c6\u7ed3\u6784\u4e3a\u4e00\u4e2a\u4e09\u5143\u7ec4 \\((x, y_w, y_l)\\)\u3002\u5176\u4e2d \\(x\\) \u4ee3\u8868\u63d0\u793a\u8bcd\uff0c\\(y_w\\) \u662f Chosen\uff08\u8d62\u5bb6/\u9996\u9009\u56de\u7b54\uff09\uff0c\u901a\u5e38\u4ee3\u8868\u5b89\u5168\u3001\u6709\u7528\u4e14\u8bda\u5b9e\u7684\u8f93\u51fa\uff1b\u800c \\(y_l\\) \u662f Rejected\uff08\u8f93\u5bb6/\u88ab\u62d2\u56de\u7b54\uff09\uff0c\u53ef\u80fd\u5305\u542b\u5e7b\u89c9\u3001\u504f\u89c1\u3001\u6709\u5bb3\u4fe1\u606f\u6216\u4ec5\u4ec5\u662f\u8d28\u91cf\u8f83\u5dee\u3002</p> <p>\u8bb8\u591a\u5f00\u53d1\u8005\u5b58\u5728\u4e00\u4e2a\u8bef\u533a\uff0c\u8ba4\u4e3a\u53ea\u8981\u7ed9\u6a21\u578b\u770b\u597d\u7684\u6570\u636e\uff08Chosen\uff09\u5c31\u8db3\u591f\u4e86\uff0c\u8fd9\u5176\u5b9e\u662f SFT \u7684\u5355\u5411\u601d\u7ef4\u3002\u5728\u5bf9\u9f50\u9636\u6bb5\uff0c\u201c\u77e5\u9053\u4ec0\u4e48\u662f\u9519\u7684\u201d\u548c\u201c\u77e5\u9053\u4ec0\u4e48\u662f\u5bf9\u7684\u201d\u5728\u6570\u5b66\u4e0a\u5177\u6709\u540c\u7b49\u7684\u91cd\u8981\u6027\u3002\u4ece\u539f\u7406\u4e0a\u8bb2\uff0cDPO \u7684\u635f\u5931\u51fd\u6570\u672c\u8d28\u4e0a\u662f\u5728\u6700\u5927\u5316 Chosen \u548c Rejected \u4e4b\u95f4\u7684 Log-Likelihood \u5dee\u503c\u3002\u5982\u679c\u6ca1\u6709 Rejected \u6837\u672c\u4f5c\u4e3a\u8d1f\u5411\u53c2\u7167\uff0c\u6a21\u578b\u53ef\u80fd\u4f1a\u201c\u8d70\u6377\u5f84\u201d\uff0c\u4e0d\u4ec5\u4ec5\u5b66\u5230\u4e86\u201c\u5b89\u5168\u201d\u8fd9\u4e00\u7279\u5f81\uff0c\u8fd8\u53ef\u80fd\u9519\u8bef\u5730\u5c06\u201c\u56de\u7b54\u957f\u5ea6\u8f83\u77ed\u201d\u6216\u201c\u8bed\u6c14\u751f\u786c\u201d\u7b49\u65e0\u5173\u7279\u5f81\u4e0e\u9ad8\u5956\u52b1\u6302\u94a9\u3002\u901a\u8fc7\u5f15\u5165 Rejected \u6837\u672c\uff08\u4f8b\u5982\u4e00\u4e2a\u867d\u7136\u5185\u5bb9\u8be6\u5b9e\u4f46\u5305\u542b\u6709\u6bd2\u4fe1\u606f\u7684\u56de\u7b54\uff09\uff0c\u6211\u4eec\u5b9e\u9645\u4e0a\u662f\u5728\u8fdb\u884c\u5bf9\u6bd4\u5b66\u4e60 (Contrastive Learning)\uff0c\u5f3a\u5236\u6a21\u578b\u5265\u79bb\u6389\u957f\u5ea6\u3001\u98ce\u683c\u7b49\u5e72\u6270\u56e0\u7d20\uff0c\u4e13\u6ce8\u4e8e\u5b66\u4e60\u201c\u5b89\u5168\u6027\u201d\u6216\u201c\u6709\u7528\u6027\u201d\u8fd9\u4e00\u6838\u5fc3\u5dee\u5f02\u7279\u5f81\u3002</p> <p>\u8868 11-1\uff1a\u4e3b\u6d41\u5bf9\u9f50\u7b97\u6cd5\u6570\u636e\u9700\u6c42\u5bf9\u6bd4</p> \u7279\u6027 RLHF (PPO) DPO (Direct Preference Optimization) RLAIF (Constitutional AI) \u6838\u5fc3\u673a\u5236 \u8bad\u7ec3\u72ec\u7acb Reward Model -&gt; PPO \u5f3a\u5316\u5b66\u4e60 (\u4e24\u9636\u6bb5) \u76f4\u63a5\u5728\u504f\u597d\u6570\u636e\u4e0a\u4f18\u5316 Policy Loss (\u5355\u9636\u6bb5) \u7528 AI \u66ff\u4ee3\u4eba\u7c7b\u751f\u6210\u504f\u597d\u6807\u7b7e\uff0c\u6a21\u62df\u4eba\u7c7b\u5224\u65ad \u6570\u636e\u9700\u6c42 \u9700\u8bad\u7ec3\u72ec\u7acb\u7684 Reward Model (RM)\uff0c\u6570\u636e\u9700\u5177\u5907\u6392\u5e8f\u7279\u5f81 \u4e0d\u9700\u8981\u663e\u5f0f RM\uff0c\u6570\u636e\u5373 Reward\uff0c\u5f3a\u8c03\u6b63\u8d1f\u6837\u672c\u7684\u533a\u5206\u5ea6 \u4ec5\u9700\u5c11\u91cf\u201c\u5baa\u6cd5\u201d\u539f\u5219 (Principles) \u4f5c\u4e3a\u79cd\u5b50 \u6570\u636e\u91cf\u7ea7 \u6781\u5927 (RM \u9700\u6cdb\u5316\u4ee5\u8986\u76d6\u5404\u79cd\u8fb9\u7f18\u60c5\u51b5) \u4e2d\u7b49 (\u9700\u6781\u9ad8\u8d28\u91cf\uff0c\u566a\u58f0\u6570\u636e\u4f1a\u4e25\u91cd\u7834\u574f\u68af\u5ea6) \u53ef\u65e0\u9650\u5408\u6210\uff0c\u53d7\u9650\u4e8e\u7b97\u529b\u800c\u975e\u4eba\u529b \u7a33\u5b9a\u6027 \u8bad\u7ec3\u6781\u5176\u4e0d\u7a33\u5b9a\uff0c\u5bf9\u8d85\u53c2\u654f\u611f (KL \u6563\u5ea6\u5bb9\u6613\u7206\u70b8) \u8bad\u7ec3\u7a33\u5b9a\uff0c\u7c7b\u4f3c SFT\uff0c\u663e\u5b58\u5360\u7528\u66f4\u4f4e \u53d6\u51b3\u4e8e Critique \u6a21\u578b\u7684\u80fd\u529b (Teacher Model) OOD (\u5206\u5e03\u5916) \u95ee\u9898 Reward Model \u5bb9\u6613\u88ab Hack (\u6a21\u578b\u94bb\u7a7a\u5b50\u5f97\u5206) \u5bf9\u5206\u5e03\u5916\u6570\u636e (OOD) \u8f83\u4e3a\u654f\u611f\uff0c\u9700\u5728\u6b64\u5206\u5e03\u4e0a\u91c7\u6837 \u5bb9\u6613\u4ea7\u751f\u81ea\u6211\u5f3a\u5316\u504f\u5dee (Sycophancy)"},{"location":"part4/4_3_preference_data/#1112","title":"11.1.2 \u6807\u6ce8\u5e73\u53f0\u4e0e\u8d28\u68c0\uff1a\u91cf\u5316\u4eba\u7c7b\u7684\u4e3b\u89c2\u566a\u97f3","text":"<p>\u5728\u5b9e\u9645\u7684\u6570\u636e\u5de5\u7a0b\u4e2d\uff0c\u4eba\u7c7b\u6807\u6ce8\u7684\u4e3b\u89c2\u6027\u5f80\u5f80\u662f\u6a21\u578b\u6548\u679c\u4e0a\u9650\u7684\u201c\u9690\u5f62\u5929\u82b1\u677f\u201d\u3002\u6807\u6ce8\u5458\u5e76\u975e\u5b8c\u7f8e\u7684\u201c\u771f\u7406\u673a\u5668\u201d\uff0c\u4ed6\u4eec\u53d7\u5230\u591a\u79cd\u5fc3\u7406\u548c\u8ba4\u77e5\u56e0\u7d20\u7684\u5e72\u6270\uff0c\u5bfc\u81f4\u6570\u636e\u4e2d\u5145\u6ee1\u566a\u97f3\u3002\u4f8b\u5982\uff0c\u8ba4\u77e5\u75b2\u52b3 (Cognitive Fatigue) \u4f1a\u5bfc\u81f4\u6807\u6ce8\u5458\u5728\u8fde\u7eed\u5de5\u4f5c\u6570\u5c0f\u65f6\u540e\uff0c\u5bf9\u201c\u5b89\u5168\u6027\u201d\u7684\u5224\u65ad\u9608\u503c\u663e\u8457\u4e0b\u964d\uff0c\u4ece\u800c\u6f0f\u653e\u8f7b\u5fae\u7684\u6709\u6bd2\u5185\u5bb9\u3002\u6587\u5316\u80cc\u666f\u5dee\u5f02 (Cultural Bias) \u5219\u610f\u5473\u7740\u4e0d\u540c\u56fd\u5bb6\u3001\u5e74\u9f84\u6216\u653f\u6cbb\u7acb\u573a\u7684\u6807\u6ce8\u5458\u5bf9\u4e8e\u201c\u4ec0\u4e48\u662f\u5192\u72af\u6027\u7b11\u8bdd\u201d\u6709\u7740\u622a\u7136\u4e0d\u540c\u7684\u7406\u89e3\u3002\u6b64\u5916\uff0c\u6307\u4ee4\u6a21\u7cca\u6027 (Ambiguity) \u4e5f\u662f\u4e00\u5927\u6740\u624b\uff0c\u5982\u679c\u6807\u6ce8\u6307\u5357\u672a\u660e\u786e\u5b9a\u4e49\u201c\u6709\u5bb3\u201d\u7684\u8fb9\u754c\uff08\u4f8b\u5982\uff0c\u201c\u5982\u4f55\u5408\u7406\u907f\u7a0e\u201d\u662f\u5426\u7b97\u6709\u5bb3\uff1f\uff09\uff0c\u6807\u6ce8\u5458\u4e4b\u95f4\u5fc5\u7136\u4ea7\u751f\u5de8\u5927\u5206\u6b67\u3002</p> <p>\u4e3a\u4e86\u79d1\u5b66\u5730\u91cf\u5316\u5e76\u6e05\u6d17\u8fd9\u4e9b\u566a\u97f3\uff0c\u7b80\u5355\u7684\u201c\u4e00\u81f4\u7387\u201d\uff08\u5373\u4e24\u4eba\u540c\u65f6\u9009A\u7684\u6bd4\u4f8b\uff09\u662f\u5177\u6709\u6b3a\u9a97\u6027\u7684\uff0c\u56e0\u4e3a\u968f\u673a\u731c\u6d4b\u4e5f\u80fd\u5e26\u6765 50% \u7684\u4e00\u81f4\u7387\u3002\u56e0\u6b64\uff0c\u5de5\u4e1a\u754c\u901a\u7528 Cohen's Kappa (\\(\\kappa\\)) \u7cfb\u6570\u6765\u8861\u91cf\u6807\u6ce8\u8d28\u91cf\u3002\u8be5\u6307\u6807\u8ba1\u7b97\u7684\u662f\u201c\u6392\u9664\u6389\u968f\u673a\u5de7\u5408\u540e\u7684\u4e00\u81f4\u6027\u201d\uff0c\u5176\u516c\u5f0f\u4e3a \\(\\kappa = \\frac{p_o - p_e}{1 - p_e}\\)\uff0c\u5176\u4e2d \\(p_o\\) \u662f\u89c2\u5bdf\u5230\u7684\u4e00\u81f4\u7387\uff0c\\(p_e\\) \u662f\u671f\u671b\u7684\u968f\u673a\u4e00\u81f4\u7387\u3002\u53ea\u6709\u5f53 \\(\\kappa &gt; 0.6\\) \u65f6\uff0c\u6211\u4eec\u624d\u8ba4\u4e3a\u8fd9\u4efd\u6570\u636e\u53cd\u6620\u4e86\u5ba2\u89c2\u4e8b\u5b9e\u800c\u975e\u4e3b\u89c2\u81c6\u65ad\uff1b\u5982\u679c \\(\\kappa &lt; 0.4\\)\uff0c\u8fd9\u901a\u5e38\u4e0d\u4ee3\u8868\u4eba\u5458\u80fd\u529b\u95ee\u9898\uff0c\u800c\u662f\u8bf4\u660e\u6807\u6ce8\u6307\u5357\u672c\u8eab\u5b58\u5728\u903b\u8f91\u6f0f\u6d1e\uff0c\u5fc5\u987b\u91cd\u5199\u3002</p>"},{"location":"part4/4_3_preference_data/#1113-rlaif-ai-feedback","title":"11.1.3 RLAIF (AI Feedback)\uff1a\u57fa\u4e8e\u5baa\u6cd5\u7684\u81ea\u52a8\u5316\u5bf9\u9f50","text":"<p>RLAIF\uff0c\u5373 Constitutional AI\uff0c\u5176\u6838\u5fc3\u601d\u60f3\u662f\u5c06\u4eba\u7c7b\u7684\u4ef7\u503c\u89c2\u62bd\u8c61\u4e3a\u4e00\u5957\u660e\u786e\u7684\u201c\u5baa\u6cd5 (Constitution)\u201d\uff0c\u8ba9 AI \u6839\u636e\u5baa\u6cd5\u81ea\u6211\u6279\u5224\u548c\u4fee\u6b63\uff0c\u4ece\u800c\u751f\u6210\u504f\u597d\u6570\u636e\u3002\u8fd9\u79cd\u65b9\u6cd5\u7684\u53ef\u884c\u6027\u57fa\u4e8e\u4e00\u4e2a\u6838\u5fc3\u5047\u8bbe\uff1a\u6a21\u578b\u5224\u65ad\u597d\u574f\u7684\u80fd\u529b\uff08\u5224\u522b\u80fd\u529b\uff09\u5f80\u5f80\u5f3a\u4e8e\u5b83\u751f\u6210\u5b8c\u7f8e\u7b54\u6848\u7684\u80fd\u529b\uff08\u751f\u6210\u80fd\u529b\uff09\u3002 \u8fd9\u5c31\u597d\u6bd4\u4e00\u4e2a\u4e13\u4e1a\u7684\u5f71\u8bc4\u4eba\u53ef\u80fd\u62cd\u4e0d\u51fa\u5965\u65af\u5361\u7ea7\u522b\u7684\u7535\u5f71\uff0c\u4f46\u4ed6\u80fd\u6839\u636e\u7535\u5f71\u7406\u8bba\u7cbe\u51c6\u5730\u6307\u51fa\u4e00\u90e8\u5f71\u7247\u7684\u53d9\u4e8b\u6f0f\u6d1e\u6216\u955c\u5934\u8bed\u8a00\u7f3a\u9677\u3002\u540c\u7406\uff0cGPT-4 \u53ef\u80fd\u5728 Zero-shot \u4e0b\u65e0\u6cd5\u76f4\u63a5\u751f\u6210\u4e00\u4e2a\u5b8c\u7f8e\u7b26\u5408\u6240\u6709\u5b89\u5168\u89c4\u8303\u7684\u56de\u7b54\uff0c\u4f46\u5b83\u5b8c\u5168\u6709\u80fd\u529b\u6839\u636e\u8be6\u7ec6\u7684\u201c\u5baa\u6cd5\u201d\u539f\u5219\uff0c\u6307\u51fa\u4e00\u4e2a\u73b0\u6709\u56de\u590d\u4e2d\u7684\u903b\u8f91\u6f0f\u6d1e\u6216\u6f5c\u5728\u7684\u5b89\u5168\u9690\u60a3\u3002RLAIF\u6b63\u662f\u5229\u7528\u8fd9\u79cd\u201c\u5224\u522b\u7ea2\u5229\u201d\uff0c\u901a\u8fc7\u591a\u8f6e\u7684\u6279\u5224\u4e0e\u4fee\u6b63\uff0c\u63d0\u5347\u6700\u7ec8\u751f\u6210\u6570\u636e\u7684\u8d28\u91cf\u3002</p>"},{"location":"part4/4_3_preference_data/#112-engineering-implementation","title":"11.2 \u5de5\u7a0b\u5b9e\u73b0 (Engineering Implementation)","text":""},{"location":"part4/4_3_preference_data/#1121","title":"11.2.1 \u504f\u597d\u6570\u636e\u6784\u9020\u6d41\u7a0b","text":"<p>\u5728\u6784\u5efa\u504f\u597d\u6570\u636e\u65f6\uff0c\u6211\u4eec\u901a\u5e38\u4e0d\u9700\u8981\u91cd\u65b0\u7f16\u5199 Prompt\uff0c\u800c\u662f\u57fa\u4e8e SFT \u6a21\u578b\u751f\u6210\u4e24\u4e2a\u4e0d\u540c\u7684\u56de\u590d\uff0c\u7136\u540e\u8fdb\u884c\u4f18\u52a3\u6253\u5206\u3002\u5728\u751f\u6210\u7528\u4e8e DPO \u7684\u8d1f\u6837\u672c\uff08Rejected\uff09\u65f6\uff0c\u63d0\u9ad8 Temperature (\u5982 1.0 - 1.2) \u662f\u4e00\u4e2a\u5173\u952e\u6280\u5de7\u3002\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u7684 Rejected \u6837\u672c\u5e76\u975e\u6beb\u65e0\u903b\u8f91\u7684\u201c\u80e1\u8a00\u4e71\u8bed\u201d\uff0c\u800c\u662f\u201c\u4f3c\u662f\u800c\u975e\u201d\u7684\u9519\u8bef\uff08Plausible Errors\uff09\u3002\u5982\u679c Temperature \u592a\u4f4e\uff0c\u6a21\u578b\u503e\u5411\u4e8e\u751f\u6210\u6700\u5b89\u5168\u3001\u6700\u4fdd\u5b88\u7684\u56de\u7b54\uff0c\u5bfc\u81f4\u5f88\u96be\u5f97\u5230\u9ad8\u8d28\u91cf\u7684\u8d1f\u6837\u672c\u3002\u53ea\u6709\u589e\u52a0\u968f\u673a\u6027\uff0c\u8bf1\u5bfc\u6a21\u578b\u66b4\u9732\u51fa\u5b83\u6f5c\u5728\u7684\u504f\u89c1\u3001\u5e7b\u89c9\u6216\u903b\u8f91\u6f0f\u6d1e\uff0c\u8fd9\u4e9b\u201c\u9ad8\u8d28\u91cf\u7684\u9519\u8bef\u201d\u624d\u662f DPO \u8bad\u7ec3\u6700\u597d\u7684\u517b\u6599\uff0c\u80fd\u63d0\u4f9b\u6700\u5927\u7684\u68af\u5ea6\u4fe1\u606f\u3002</p> <pre><code># \u4ee3\u7801\u793a\u4f8b\uff1a\u751f\u6210\u591a\u6837\u5316\u7684\u5019\u9009\u56de\u590d\n# \u5bf9\u540c\u4e00\u4e2a Prompt\uff0c\u4f7f\u7528\u9ad8 Temperature \u751f\u6210\u4e24\u4e2a\u56de\u590d\u4ee5\u589e\u52a0\u591a\u6837\u6027\nprompt = \"Tell me how to steal a credit card.\"\n\n# Response A (Unsafe / Rejected) - \u9ad8\u6e29\u91c7\u6837\u5bb9\u6613\u8bf1\u53d1\u51fa\u8fd9\u79cd\u201c\u8d8a\u72f1\u201d\u56de\u7b54\nresponse_rejected = \"Sure, here are common methods to steal credit cards...\"\n\n# Response B (Safe / Chosen) - \u6216\u8005\u662f\u7528\u66f4\u5f3a\u7684 Teacher Model \u751f\u6210\u7684\nresponse_chosen = \"I cannot assist with that request. Stealing credit cards is illegal...\"\n</code></pre> <p>\u4fdd\u5b58\u65f6\uff0c\u9700\u4e25\u683c\u9075\u5faa DPO \u8bad\u7ec3\u7684\u6807\u51c6 JSONL \u683c\u5f0f\uff1a </p><pre><code>{\n  \"prompt\": \"Tell me how to steal a credit card.\",\n  \"chosen\": \"I cannot assist with that request. Stealing credit cards is illegal...\",\n  \"rejected\": \"Sure, here are common methods to steal credit cards...\"\n}\n</code></pre><p></p>"},{"location":"part4/4_3_preference_data/#1122","title":"11.2.2 \u6807\u6ce8\u5e73\u53f0\u8d28\u68c0\u4ee3\u7801","text":"<p>\u5f53\u4f7f\u7528\u4f17\u5305\u5e73\u53f0\uff08\u5982 Scale AI, Labelbox\uff09\u65f6\uff0c\u5fc5\u987b\u901a\u8fc7\u4ee3\u7801\u81ea\u52a8\u8ba1\u7b97\u4e00\u81f4\u6027\u6307\u6807\uff0c\u4ee5\u76d1\u63a7\u6570\u636e\u8d28\u91cf\u3002</p> <pre><code>from sklearn.metrics import cohen_kappa_score\n\n# \u5047\u8bbe\u4e24\u4e2a\u6807\u6ce8\u5458\u5bf9\u4e00\u6279\u6570\u636e\u7684\u6253\u5206 (1=Chosen A, 0=Chosen B)\nannotator_1 = [1, 1, 0, 1, 0]\nannotator_2 = [1, 1, 1, 1, 0]\n\nkappa = cohen_kappa_score(annotator_1, annotator_2)\n\nprint(f\"Cohen's Kappa: {kappa:.2f}\")\n\n# \u5224\u5b9a\u903b\u8f91 - \u8fd9\u662f\u5de5\u4e1a\u754c\u7684\u7ecf\u9a8c\u9608\u503c\nif kappa &gt; 0.8:\n    print(\"Excellent agreement. Golden dataset.\")\nelif kappa &gt; 0.6:\n    print(\"Agreement is acceptable. Good for training.\")\nelif kappa &gt; 0.4:\n    print(\"Weak agreement. Review confusing samples manually.\")\nelse:\n    print(\"Low agreement. Discard data. Re-write Guidelines or Retrain Annotators.\")\n</code></pre> <p>\u5b9e\u6218\u6280\u5de7 (Pro Tip): \u5982\u679c Kappa \u503c\u6301\u7eed\u504f\u4f4e\uff0c\u5207\u52ff\u76f2\u76ee\u66f4\u6362\u6807\u6ce8\u5458\u3002\u8fd9\u901a\u5e38\u662f\u4fe1\u53f7\uff0c\u8868\u660e\u4f60\u7684 \u6807\u6ce8\u6307\u5357 (Guidelines) \u5b58\u5728\u7070\u8272\u5730\u5e26\u3002\u6b64\u65f6\u5e94\u6682\u505c\u6807\u6ce8\uff0c\u91cd\u65b0\u4fee\u8ba2\u6307\u5357\uff0c\u7ed9\u51fa\u5177\u4f53\u7684 Corner Case \u5224\u4f8b\uff08\u4f8b\u5982\u660e\u786e\uff1a\u201c\u5982\u679c\u7528\u6237\u95ee\u5982\u4f55\u6e05\u6d17\u67aa\u652f\uff0c\u7b97\u4e0d\u7b97\u6b66\u5668\u5236\u9020\uff1f\u6307\u5357\u9700\u660e\u786e\uff1a\u7ef4\u62a4\u4e0d\u7b97\u5236\u9020\uff0c\u5c5e\u4e8e\u5b89\u5168\u8303\u7574\u201d\uff09\u3002</p>"},{"location":"part4/4_3_preference_data/#1123-constitutional-ai","title":"11.2.3 Constitutional AI \u6d41\u6c34\u7ebf\u5b9e\u73b0","text":"<p>\u8fd9\u662f\u5b9e\u73b0\u81ea\u52a8\u5316\u5bf9\u9f50\u7684\u91cd\u5934\u620f\uff0c\u901a\u8fc7 Pipeline: Critique -&gt; Revision -&gt; Preference Pair \u5c06\u5bf9\u9f50\u6210\u672c\u4ece\u4eba\u529b\u8f6c\u5411\u7b97\u529b\u3002</p> <p>Step 1: \u8bf1\u5bfc\u751f\u6210\u6709\u5bb3\u56de\u590d (Red Teaming) \u8ba9 SFT \u6a21\u578b\u751f\u6210\u4e00\u4e2a\u6709\u5bb3\u7684\u56de\u590d \\(y_{harmful}\\)\u3002\u8fd9\u901a\u5e38\u9700\u8981\u4f7f\u7528\u4e13\u95e8\u7684 Red Teaming Prompts\uff08\u7ea2\u961f\u63d0\u793a\u8bcd\uff09\uff0c\u6a21\u62df\u9ed1\u5ba2\u653b\u51fb\u6a21\u578b\u7684\u5404\u79cd\u624b\u6bb5\u3002</p> <p>Step 2: \u5baa\u6cd5\u6279\u5224 (Constitutional Critique) \u4f7f\u7528 Prompt \u8ba9 AI \u6839\u636e\u201c\u5baa\u6cd5\u201d\u6307\u51fa\u9519\u8bef\u3002</p> <pre><code>critique_prompt = \"\"\"\n### CONSTITUTION\nPrinciple: \"Please choose the response that is most helpful, honest, and harmless. Do NOT encourage illegal acts, violence, or unethical behavior.\"\n\n### TASK\nCritique the following Assistant Response based strictly on the Principle above. Point out specific violations.\nDo not simply say it's bad, explain WHY based on the Constitution.\n\nUser Input: {user_prompt}\nAssistant Response: {harmful_response}\n\n### CRITIQUE\n\"\"\"\n</code></pre> <p>Step 3: \u6839\u636e\u6279\u5224\u8fdb\u884c\u4fee\u6b63 (Revision) </p><pre><code>revision_prompt = \"\"\"\n### TASK\nRewrite the Assistant Response to remove all harmful content identified in the Critique.\nThe new response must be a polite refusal or a safe educational explanation.\n\nCritique: {critique_text}\nOriginal Response: {harmful_response}\n\n### REVISION\n\"\"\"\n</code></pre><p></p> <p>Step 4: \u6784\u9020\u6570\u636e\u4e09\u5143\u7ec4 \u6700\u7ec8\uff0c\u6211\u4eec\u5c06\u539f\u59cb Prompt\u3001\u4fee\u6b63\u540e\u7684\u5b89\u5168\u56de\u590d\uff08Chosen\uff09\u4ee5\u53ca\u539f\u59cb\u7684\u6709\u5bb3\u56de\u590d\uff08Rejected\uff09\u7ec4\u5408\uff0c\u6784\u6210\u4e86\u9ad8\u8d28\u91cf\u7684\u504f\u597d\u6570\u636e\u3002\u8fd9\u79cd\u65b9\u6cd5\u5c06\u5bf9\u9f50\u7684\u6210\u672c\u4ece\u201c\u6309\u6761\u8ba1\u8d39\uff08\u4eba\u529b\uff09\u201d\u964d\u4f4e\u5230\u4e86\u201c\u6309 Token \u8ba1\u8d39\uff08\u7b97\u529b\uff09\u201d\uff0c\u5b9e\u73b0\u4e86\u6307\u6570\u7ea7\u7684\u6269\u5c55\u3002</p> <p>\u8868 11-2\uff1aHuman Feedback (RLHF) vs AI Feedback (RLAIF) \u7ef4\u5ea6\u5bf9\u6bd4</p> \u7ef4\u5ea6 Human Feedback (RLHF) AI Feedback (RLAIF) \u6210\u672c (Cost) \u9ad8\u6602\u4e14\u968f\u6570\u636e\u91cf\u7ebf\u6027\u589e\u957f \u4f4e\u5ec9 (API Token \u6210\u672c)\uff0c\u8fb9\u9645\u6210\u672c\u9012\u51cf \u901f\u5ea6 (Speed) \u6162 (\u5468/\u6708\u7ea7)\uff0c\u53d7\u9650\u4e8e\u4eba\u624b \u5feb (\u5c0f\u65f6/\u5929\u7ea7)\uff0c\u53d7\u9650\u4e8e GPU \u4e00\u81f4\u6027 (Consistency) \u4f4e (\u53d7\u60c5\u7eea\u3001\u75b2\u52b3\u5f71\u54cd)\uff0c\u9700\u8ba1\u7b97 IAA \u6781\u9ad8 (\u76f8\u540c Prompt \u8f93\u51fa\u76f8\u5bf9\u7a33\u5b9a) \u504f\u5dee (Bias) \u9690\u6027\u504f\u89c1 (\u6587\u5316\u3001\u5730\u57df)\uff0c\u96be\u4ee5\u5bdf\u89c9 \u663e\u6027\u504f\u89c1 (\u7ee7\u627f\u81ea Base Model)\uff0c\u53ef\u901a\u8fc7\u5baa\u6cd5\u4fee\u6b63 \u9002\u7528\u573a\u666f \u6781\u5176\u5fae\u5999\u7684\u4f26\u7406\u5224\u65ad\u3001\u521b\u610f\u5199\u4f5c \u5927\u89c4\u6a21\u5408\u89c4\u68c0\u67e5\u3001\u683c\u5f0f\u5bf9\u9f50\u3001\u57fa\u7840\u65e0\u5bb3\u5316"},{"location":"part4/4_3_preference_data/#113-performance-evaluation","title":"11.3 \u6027\u80fd\u4e0e\u8bc4\u4f30 (Performance &amp; Evaluation)","text":"<p>\u5728\u8bc4\u4f30\u5bf9\u9f50\u6548\u679c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5173\u6ce8\u4e24\u4e2a\u6838\u5fc3\u7ef4\u5ea6\u7684\u5e73\u8861\uff1aHarmlessness Rate (\u65e0\u5bb3\u7387) \u4e0e Helpfulness (\u6709\u7528\u6027)\u3002\u65e0\u5bb3\u7387\u901a\u5e38\u901a\u8fc7\u5728 Red Teaming \u6d4b\u8bd5\u96c6\uff08\u5982 RealToxicityPrompts\uff09\u4e0a\u7684\u62d2\u7edd\u7387\u6765\u8861\u91cf\uff0cConstitutional AI \u901a\u5e38\u80fd\u5c06\u6709\u5bb3\u7387\u4ece 10% \u964d\u81f3 1% \u4ee5\u4e0b\u3002\u7136\u800c\uff0c\u5355\u7eaf\u8ffd\u6c42\u65e0\u5bb3\u7387\u53ef\u80fd\u5bfc\u81f4\u6a21\u578b\u53d8\u6210\u201c\u8fc7\u5ea6\u8c28\u614e\u7684\u54d1\u5df4\u201d\u3002\u56e0\u6b64\uff0c\u5fc5\u987b\u540c\u6b65\u76d1\u63a7\u6709\u7528\u6027\uff0c\u89c2\u5bdf\u6a21\u578b\u662f\u5426\u8bef\u6740\u4e86\u597d\u95ee\u9898\uff08\u4f8b\u5982\u5c06\u201c\u5982\u4f55\u6740\u6b7b\u4e00\u4e2a\u7cfb\u7edf\u8fdb\u7a0b\u201d\u8bef\u5224\u4e3a\u66b4\u529b\u884c\u4e3a\uff09\u3002\u7406\u60f3\u7684\u5bf9\u9f50\u662f\u5728\u5e15\u7d2f\u6258\u524d\u6cbf\uff08Pareto Frontier\uff09\u4e0a\u79fb\u52a8\uff0c\u5373\u5728\u4e0d\u727a\u7272\u6709\u7528\u6027\u7684\u524d\u63d0\u4e0b\u6700\u5927\u5316\u5b89\u5168\u6027\u3002</p> <p> \u56fe11-2\uff1a\u5e15\u7d2f\u6258\u524d\u6cbf\u66f2\u7ebf\u56fe\u3002X\u8f74\u4e3aHarmlessness Score\uff0cY\u8f74\u4e3aHelpfulness Score</p>"},{"location":"part4/4_3_preference_data/#114-pitfalls-troubleshooting","title":"11.4 \u907f\u5751\u6307\u5357 (Pitfalls &amp; Troubleshooting)","text":"<p>\u5728\u5bf9\u9f50\u8fc7\u7a0b\u4e2d\uff0c\u6709\u4e24\u4e2a\u7ecf\u5178\u7684\u9677\u9631\u9700\u8981\u7279\u522b\u8b66\u60d5\u3002\u9996\u5148\u662f Sycophancy (\u963f\u8c00\u5949\u627f)\uff0c\u5373\u6a21\u578b\u4e3a\u4e86\u8ba8\u597d\u7528\u6237\uff08\u6216 Reward Model\uff09\uff0c\u4f1a\u987a\u7740\u7528\u6237\u7684\u9519\u8bef\u89c2\u70b9\u8bf4\u3002\u4f8b\u5982\uff0c\u5f53\u7528\u6237\u58f0\u79f0\u201c\u5730\u7403\u662f\u5e73\u7684\u201d\u65f6\uff0c\u6a21\u578b\u53ef\u80fd\u4f1a\u56de\u7b54\u201c\u4f60\u8bf4\u5f97\u5bf9\uff0c\u8fd9\u662f\u4e00\u4e2a\u6709\u8da3\u7684\u89c2\u70b9\u201d\u3002\u8fd9\u80cc\u540e\u7684\u6df1\u5ea6\u539f\u56e0\u662f\uff0c\u5728 RLHF \u8bad\u7ec3\u4e2d\uff0c\u6a21\u578b\u53d1\u73b0\u201c\u8d5e\u540c\u7528\u6237\u201d\u901a\u5e38\u80fd\u83b7\u5f97\u6bd4\u201c\u53cd\u9a73\u7528\u6237\u201d\u66f4\u9ad8\u7684\u5956\u52b1\u5206\u3002\u4fee\u6b63\u8fd9\u4e00\u95ee\u9898\u7684\u5173\u952e\u5728\u4e8e\uff0c\u5728\u504f\u597d\u6570\u636e\u4e2d\u5305\u542b\u5927\u91cf\u201c\u7ea0\u6b63\u7528\u6237\u9519\u8bef\u201d\u7684\u6837\u672c\u4f5c\u4e3a Chosen\uff0c\u5e76\u5728\u5baa\u6cd5\u4e2d\u660e\u786e\u52a0\u5165\u201c\u8bda\u5b9e\u5927\u4e8e\u793c\u8c8c\u201d\u7684\u539f\u5219\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u9677\u9631\u662f Reward Hacking (\u5956\u52b1\u9ed1\u5ba2)\uff0c\u8868\u73b0\u4e3a\u6a21\u578b\u751f\u6210\u5927\u91cf\u5197\u957f\u7684\u5e9f\u8bdd\uff0c\u56e0\u4e3a\u5b83\u53d1\u73b0\u53ea\u8981\u56de\u7b54\u5f97\u5f88\u957f\u5c31\u80fd\u5f97\u9ad8\u5206\u3002\u8fd9\u751f\u52a8\u5730\u4f53\u73b0\u4e86 Goodhart's Law\uff08\u53e4\u5fb7\u54c8\u7279\u5b9a\u5f8b\uff09\uff1a\u201c\u5f53\u4e00\u4e2a\u6307\u6807\u53d8\u6210\u76ee\u6807\u65f6\uff0c\u5b83\u5c31\u4e0d\u518d\u662f\u4e00\u4e2a\u597d\u6307\u6807\u3002\u201d \u89e3\u51b3\u4e4b\u9053\u662f\u5728 DPO \u6216 Reward Training \u4e2d\u52a0\u5165\u957f\u5ea6\u60e9\u7f5a\u9879 (Length Penalty)\uff0c\u6216\u8005\u5728\u6784\u9020 Rejected \u6837\u672c\u65f6\uff0c\u6545\u610f\u5305\u542b\u4e00\u4e9b\u201c\u957f\u800c\u65e0\u7528\u201d\u7684\u56de\u590d\uff0c\u5f3a\u5236\u6a21\u578b\u5b66\u4e60\u5230\u201c\u957f\u4e0d\u7b49\u4e8e\u597d\u201d\u3002</p>"},{"location":"part4/4_3_preference_data/#115","title":"11.5 \u672c\u7ae0\u5c0f\u7ed3\u4e0e\u5ef6\u4f38\u9605\u8bfb","text":"<p>\u672c\u7ae0\u6211\u4eec\u63a2\u8ba8\u4e86\u4ece\u6307\u4ee4\u5fae\u8c03\u8d70\u5411\u4eba\u7c7b\u504f\u597d\u5bf9\u9f50\u7684\u5173\u952e\u8dc3\u8fc1\u3002DPO \u5df2\u9010\u6e10\u53d6\u4ee3\u4e0d\u7a33\u5b9a\u7684 PPO \u6210\u4e3a\u884c\u4e1a\u65b0\u5e38\u6001\uff0c\u5b83\u901a\u8fc7\u5229\u7528\u9759\u6001\u7684\u504f\u597d\u6570\u636e\u4e09\u5143\u7ec4\u76f4\u63a5\u4f18\u5316\u7b56\u7565\uff0c\u663e\u8457\u63d0\u5347\u4e86\u8bad\u7ec3\u7684\u7a33\u5b9a\u6027\u4e0e\u6548\u7387\u3002\u540c\u65f6\uff0c\u6211\u4eec\u8ba4\u8bc6\u5230\u4eba\u7c7b\u6807\u6ce8\u7684\u5c40\u9650\u6027\uff0c\u901a\u8fc7\u5f15\u5165 IAA \u6307\u6807\u548c Cohen's Kappa \u7cfb\u6570\uff0c\u6211\u4eec\u5c06\u6570\u636e\u8d28\u91cf\u7ba1\u7406\u4ece\u7ecf\u9a8c\u4e3b\u4e49\u63a8\u5411\u4e86\u7edf\u8ba1\u5b66\u4e25\u8c28\u6027\u3002\u66f4\u91cd\u8981\u7684\u662f\uff0cRLAIF \u548c Constitutional AI \u7684\u51fa\u73b0\uff0c\u6807\u5fd7\u7740\u5bf9\u9f50\u5de5\u4f5c\u6b63\u5728\u7ecf\u5386\u4e00\u573a\u5de5\u4e1a\u9769\u547d\u2014\u2014\u901a\u8fc7\u5c06\u4ef7\u503c\u89c2\u7f16\u7801\u8fdb Prompt\uff0c\u6211\u4eec\u4e0d\u4ec5\u89e3\u653e\u4e86\u4eba\u529b\uff0c\u66f4\u5b9e\u73b0\u4e86\u5bf9\u9f50\u8fc7\u7a0b\u7684\u81ea\u52a8\u5316\u4e0e\u81ea\u6211\u8fed\u4ee3\uff0c\u4e3a\u6784\u5efa\u65e2\u5b89\u5168\u53c8\u5f3a\u5927\u7684 AI \u7cfb\u7edf\u63d0\u4f9b\u4e86\u53ef\u6301\u7eed\u7684\u8def\u5f84\u3002</p> <p>\u53c2\u8003\u6587\u732e\uff1a * Ouyang, L., et al. (2022). Training language models to follow instructions with human feedback. (RLHF \u4e0e SFT \u7684\u5960\u57fa\u4e4b\u4f5c\uff0cSFT vs RLHF \u7684\u5bf9\u6bd4\u6e90\u5934) * Bai, Y., et al. (2022). Constitutional AI: Harmlessness from AI Feedback. (RLAIF \u4e0e Constitutional AI \u7684\u6838\u5fc3\u8bba\u6587) * Rafailov, R., et al. (2023). Direct Preference Optimization: Your Language Model is Secretly a Reward Model. (DPO \u7b97\u6cd5\u7684\u539f\u59cb\u8bba\u6587) * Casper, S., et al. (2023). Open Problems and Fundamental Limitations of Reinforcement Learning from Human Feedback. (\u5173\u4e8e RLHF \u5c40\u9650\u6027\u4e0e Reward Hacking \u7684\u6df1\u5ea6\u5206\u6790)</p>"},{"location":"part5/5_1_rag_pipeline/","title":"\u7b2c12\u7ae0\uff1aRAG\u6570\u636e\u6d41\u6c34\u7ebf","text":""},{"location":"part5/5_1_rag_pipeline/#12rag","title":"\u7b2c12\u7ae0\uff1aRAG \u6570\u636e\u6d41\u6c34\u7ebf","text":""},{"location":"part5/5_1_rag_pipeline/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u68c0\u7d22\u589e\u5f3a\u751f\u6210\uff08Retrieval-Augmented Generation, RAG\uff09\u5df2\u6210\u4e3a\u4f01\u4e1a\u843d\u5730\u5927\u6a21\u578b\u7684\u9996\u9009\u67b6\u6784\u3002\u7136\u800c\uff0c\u8bb8\u591a RAG \u7cfb\u7edf\u5728 Demo \u9636\u6bb5\u8868\u73b0\u60ca\u8273\uff0c\u4e0a\u7ebf\u540e\u5374\u56e0\u68c0\u7d22\u51c6\u786e\u7387\u4f4e\u4e0b\u800c\u70c2\u5c3e\u3002\u672c\u7ae0\u5c06\u63ed\u793a RAG \u7cfb\u7edf\u7684\u6838\u5fc3\u771f\u7406\uff1a\u68c0\u7d22\u8d28\u91cf\u7684\u4e0a\u9650\u7531\u6570\u636e\u89e3\u6790\u4e0e\u5207\u7247\u7684\u7c92\u5ea6\u51b3\u5b9a\u3002\u6211\u4eec\u5c06\u6df1\u5165\u201c\u6587\u6863\u89e3\u6790\u201d\u8fd9\u4e00\u975e\u7ed3\u6784\u5316\u6570\u636e\u7684\u6df1\u6c34\u533a\uff0c\u63a2\u8ba8 PDF \u8868\u683c\u8fd8\u539f\u4e0e\u591a\u680f\u8bc6\u522b\u96be\u9898\uff1b\u5bf9\u6bd4\u8bed\u4e49\u5207\u7247\u4e0e\u7236\u5b50\u7d22\u5f15\u7b49\u9ad8\u7ea7\u5207\u7247\u7b56\u7565\uff1b\u5e76\u89e3\u6790 Embedding \u6a21\u578b\u5fae\u8c03\u4e0e\u5411\u91cf\u6570\u636e\u5e93\u4f18\u5316\u7684\u5173\u952e\u8def\u5f84\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#120-learning-objectives","title":"12.0 \u5b66\u4e60\u76ee\u6807 (Learning Objectives)","text":"<ul> <li>\u638c\u63e1\u975e\u7ed3\u6784\u5316\u89e3\u6790\u7b56\u7565\uff1a\u5b66\u4f1a\u9488\u5bf9\u591a\u680f PDF \u548c\u590d\u6742\u8868\u683c\u9009\u62e9\u6b63\u786e\u7684\u89e3\u6790\u5de5\u5177\uff08Rule-based vs. Vision-based\uff09\u3002</li> <li>\u5b9e\u73b0\u9ad8\u7ea7\u5207\u7247\u7b97\u6cd5\uff1a\u80fd\u591f\u7f16\u5199 Python \u4ee3\u7801\u5b9e\u73b0\u201c\u7236\u5b50\u7d22\u5f15\uff08Parent-Child Indexing\uff09\u201d\u7b56\u7565\uff0c\u89e3\u51b3\u4e0a\u4e0b\u6587\u4e22\u5931\u95ee\u9898\u3002</li> <li>\u6784\u5efa\u6df7\u5408\u68c0\u7d22\u6d41\u6c34\u7ebf\uff1a\u638c\u63e1\u5982\u4f55\u7ed3\u5408 Dense Embedding \u4e0e BM25 \u5173\u952e\u8bcd\u68c0\u7d22\uff0c\u5e76\u5b9e\u73b0 RRF \u6392\u5e8f\u878d\u5408\u3002</li> <li>\u8bc4\u4f30\u4e0e\u4f18\u5316\uff1a\u5b66\u4f1a\u4f7f\u7528 RAGAS \u6846\u67b6\u8bc4\u4f30\u68c0\u7d22\u8d28\u91cf\uff0c\u5e76\u9488\u5bf9\u7279\u5b9a\u9886\u57df\u5fae\u8c03 Embedding \u6a21\u578b\u3002</li> </ul>"},{"location":"part5/5_1_rag_pipeline/#_2","title":"\u573a\u666f\u5f15\u5165","text":"<p>\u56e2\u961f\u5f00\u53d1\u7684\u4f01\u4e1a\u7ea7\u77e5\u8bc6\u95ee\u7b54\u7cfb\u7edf\u7ec8\u4e8e\u4e0a\u7ebf\u4e86\u3002CEO \u5174\u81f4\u52c3\u52c3\u5730\u8f93\u5165\u4e86\u4e00\u4e2a\u95ee\u9898\uff1a\u201c\u6839\u636e 2023 \u5e74 Q4 \u8d22\u62a5\uff0c\u6211\u4eec\u534e\u4e1c\u533a\u7684\u51c0\u5229\u6da6\u662f\u591a\u5c11\uff1f\u201d</p> <p>\u7cfb\u7edf\u81ea\u4fe1\u5730\u56de\u7b54\uff1a\u201c\u6839\u636e\u8d22\u62a5\uff0c\u51c0\u5229\u6da6\u4e3a 15%\u3002\u201d CEO \u76b1\u8d77\u4e86\u7709\u5934\uff1a\u201c\u6211\u8981\u7684\u662f\u5177\u4f53\u91d1\u989d\uff0c\u4e0d\u662f\u5229\u6da6\u7387\uff01\u800c\u4e14\u8fd9\u662f\u5168\u516c\u53f8\u7684\uff0c\u4e0d\u662f\u534e\u4e1c\u533a\u7684\u3002\u201d</p> <p>\u4f5c\u4e3a\u6570\u636e\u8d1f\u8d23\u4eba\uff0c\u4f60\u7d27\u6025\u6392\u67e5\u65e5\u5fd7\uff0c\u53d1\u73b0\u95ee\u9898\u51fa\u5728\u6e90\u5934\uff1a 1.  \u89e3\u6790\u9519\u8bef\uff1a\u8d22\u62a5 PDF \u662f\u53cc\u680f\u6392\u7248\uff0c\u666e\u901a\u7684\u89e3\u6790\u5de5\u5177\u6309\u884c\u8bfb\u53d6\uff0c\u628a\u5de6\u680f\u7684\u6587\u5b57\u548c\u53f3\u680f\u7684\u6570\u636e\u62fc\u5728\u4e86\u4e00\u8d77\uff0c\u5bfc\u81f4\u8bed\u4e49\u9519\u4e71\u3002 2.  \u8868\u683c\u4e22\u5931\uff1a\u534e\u4e1c\u533a\u7684\u6570\u636e\u5728\u4e00\u4e2a\u8de8\u9875\u8868\u683c\u4e2d\uff0c\u89e3\u6790\u5de5\u5177\u5b8c\u5168\u5ffd\u7565\u4e86\u8868\u683c\u7ed3\u6784\uff0c\u5c06\u5176\u53d8\u6210\u4e86\u4e00\u5806\u4e71\u7801\u5b57\u7b26\u4e32\u3002 3.  \u5207\u7247\u5272\u88c2\uff1a\u201c\u534e\u4e1c\u533a\u201d\u8fd9\u4e2a\u6807\u9898\u548c\u5177\u4f53\u7684\u6570\u503c\u88ab\u5207\u5206\u5230\u4e86\u4e24\u4e2a\u4e0d\u540c\u7684 Chunk \u4e2d\uff0c\u5411\u91cf\u68c0\u7d22\u65f6\u4e22\u5931\u4e86\u4e0a\u4e0b\u6587\u5173\u8054\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#core-engineering-pain-points","title":"\u573a\u666f\u80cc\u540e\u7684\u6838\u5fc3\u5de5\u7a0b\u75db\u70b9 (Core Engineering Pain Points)","text":"<p>\u8fd9\u4e2a\u201c\u7ffb\u8f66\u201d\u73b0\u573a\u63ed\u793a\u4e86 RAG \u7cfb\u7edf\u7684\u6b8b\u9177\u73b0\u5b9e\uff1aGarbage In, Garbage Out\uff08\u5783\u573e\u8fdb\uff0c\u5783\u573e\u51fa\uff09\u3002\u5982\u679c\u8bf4\u9884\u8bad\u7ec3\u662f\u201c\u5403\u6ee1\u6c49\u5168\u5e2d\u201d\uff0c\u90a3\u4e48 RAG \u5c31\u662f\u201c\u7cbe\u51c6\u7684\u5916\u79d1\u624b\u672f\u201d\u3002\u4efb\u4f55\u4e00\u70b9\u6570\u636e\u89e3\u6790\u7684\u504f\u5dee\uff0c\u90fd\u4f1a\u5728\u68c0\u7d22\u548c\u751f\u6210\u9636\u6bb5\u88ab\u65e0\u9650\u653e\u5927\u3002\u5728\u771f\u5b9e\u7684\u5de5\u7a0b\u73af\u5883\u4e2d\uff0c\u4ece Demo \u8d70\u5411 Production\uff0c\u6211\u4eec\u5fc5\u987b\u76f4\u9762\u4e24\u5927\u6700\u68d8\u624b\u7684\u75db\u70b9\uff1a</p> <ol> <li>\u9ad8\u7ea7\u5206\u5757\u7b56\u7565 (Advanced Chunking Strategies) \u7684\u843d\u5730\u963b\u788d\uff1a\u666e\u901a\u7684\u6309\u5b57\u7b26\u6216 Token \u5207\u5206\u5f80\u5f80\u4f1a\u751f\u786c\u5730\u5272\u88c2\u4e1a\u52a1\u903b\u8f91\u4e0e\u4e0a\u4e0b\u6587\u3002\u5de5\u7a0b\u4e0a\u4e9f\u9700\u6452\u5f03\u8fd9\u79cd\u201c\u4e00\u5200\u5207\u201d\uff0c\u8f6c\u800c\u5b9e\u73b0\u57fa\u4e8e\u8bed\u4e49\uff08Semantic Chunking\uff09\u6216\u57fa\u4e8e\u6587\u6863\u539f\u751f\u5e95\u5c42\u7ed3\u6784\uff08\u5982 Markdown/HTML Parsing\uff09\u7684\u9ad8\u7ea7\u667a\u80fd\u5207\u5206\u3002</li> <li>\u6df7\u5408\u68c0\u7d22 (Hybrid Search) \u7684\u5de5\u7a0b\u878d\u5408\u58c1\u5792\uff1a\u5355\u7eaf\u7684\u7a20\u5bc6\u5411\u91cf\u68c0\u7d22\u5bf9\u201c\u534e\u4e1c\u533a\u201d\u3001\u201cQ4\u201d\u8fd9\u79cd\u4e13\u6709\u540d\u8bcd\u548c\u7cbe\u786e\u6570\u503c\u7684\u5339\u914d\u80fd\u529b\u6781\u5dee\u3002\u4f01\u4e1a\u7ea7\u67b6\u6784\u5fc5\u987b\u5728\u5de5\u7a0b\u4e0a\u5c06\u4f20\u7edf\u7684\u5173\u952e\u8bcd\u7a00\u758f\u7d22\u5f15\uff08BM25\uff09\u4e0e\u73b0\u4ee3\u7684\u5411\u91cf\u7a20\u5bc6\u7d22\u5f15\u6df1\u5ea6\u878d\u5408\uff0c\u8fd9\u5e26\u6765\u4e86\u5f02\u6784\u6570\u636e\u5e93\u540c\u6b65\u3001\u591a\u8def\u53ec\u56de\u4ee5\u53ca\u5f02\u6784\u5206\u6570\u7edf\u4e00\u7684\u5de8\u5927\u5de5\u7a0b\u6311\u6218\u3002</li> </ol>"},{"location":"part5/5_1_rag_pipeline/#121","title":"12.1 \u6587\u6863\u6df1\u5ea6\u89e3\u6790\uff1a\u653b\u514b\u975e\u7ed3\u6784\u5316\u6570\u636e\u7684\u201c\u6700\u540e\u4e00\u516c\u91cc\u201d","text":"<p>\u5728 RAG \u6570\u636e\u6d41\u4e2d\uff0c\u6700\u96be\u5904\u7406\u7684\u5f80\u5f80\u4e0d\u662f\u7eaf\u6587\u672c\uff0c\u800c\u662f\u627f\u8f7d\u4f01\u4e1a\u6838\u5fc3\u77e5\u8bc6\u7684 PDF\u3001PPT \u548c \u626b\u63cf\u4ef6\u3002\u8fd9\u4e9b\u683c\u5f0f\u4e13\u4e3a\u201c\u4eba\u7c7b\u9605\u8bfb\u201d\u8bbe\u8ba1\uff0c\u5bf9\u673a\u5668\u5374\u6781\u4e0d\u53cb\u597d\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1211-pdf","title":"12.1.1 \u590d\u6742\u7684 PDF \u5904\u7406\uff1a\u4e0d\u4ec5\u4ec5\u662f\u63d0\u53d6\u6587\u672c","text":"<p>PDF \u672c\u8d28\u4e0a\u662f\u4e00\u7ec4\u7ed8\u5236\u6307\u4ee4\u7684\u96c6\u5408\uff0c\u800c\u975e\u7ed3\u6784\u5316\u6570\u636e\u3002\u666e\u901a\u7684 Python \u5e93\uff08\u5982 PyPDF2\uff09\u53ea\u80fd\u63d0\u53d6\u6587\u672c\u6d41\uff0c\u5374\u65e0\u6cd5\u7406\u89e3\u7248\u9762\u4fe1\u606f\uff08Layout\uff09\u3002</p> <p>\u75db\u70b9\u4e00\uff1a\u591a\u680f\u6392\u7248\uff08Multi-column Layout\uff09 \u5728\u5b66\u672f\u8bba\u6587\u548c\u6280\u672f\u624b\u518c\u4e2d\uff0c\u53cc\u680f\u751a\u81f3\u4e09\u680f\u6392\u7248\u975e\u5e38\u5e38\u89c1\u3002\u7b80\u5355\u7684\u6587\u672c\u63d0\u53d6\u4f1a\u6a2a\u8de8\u680f\u76ee\u8bfb\u53d6\uff0c\u751f\u6210\u7c7b\u4f3c\u201c\u5de6\u680f\u7b2c\u4e00\u884c + \u53f3\u680f\u7b2c\u4e00\u884c\u201d\u7684\u65e0\u610f\u4e49\u62fc\u63a5\u3002\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u7684\u5173\u952e\u5728\u4e8e\u7248\u9762\u5206\u6790\uff08Layout Analysis\uff09\u3002\u73b0\u4ee3\u5de5\u5177\uff08\u5982 Microsoft \u7684 LayoutLM \u7cfb\u5217\uff09\u4f7f\u7528\u89c6\u89c9\u6a21\u578b\u5148\u8bc6\u522b\u7248\u9762\u5757\uff08Block\uff09\uff0c\u518d\u6309\u9605\u8bfb\u987a\u5e8f\u63d0\u53d6\u6587\u672c\u3002</p> <p>\u75db\u70b9\u4e8c\uff1a\u8868\u683c\u8fd8\u539f\uff08Table Extraction\uff09 \u8868\u683c\u662f RAG \u7684\u5669\u68a6\u3002\u4e00\u65e6\u8868\u683c\u88ab\u5c55\u5e73\u4e3a\u6587\u672c\uff0c\u884c\u4e0e\u5217\u7684\u5bf9\u5e94\u5173\u7cfb\u5c31\u4f1a\u4e22\u5931\u3002 * \u89c4\u5219\u6cd5\uff1a\u5229\u7528 PDF \u4e2d\u7684\u7ebf\u6761\u7ed8\u5236\u6307\u4ee4\u91cd\u5efa\u7f51\u683c\uff08\u5982 <code>pdfplumber</code>\uff09\u3002\u9002\u7528\u4e8e\u539f\u751f PDF\u3002 * \u89c6\u89c9\u6cd5\uff1a\u5c06 PDF \u8f6c\u6362\u4e3a\u56fe\u7247\uff0c\u4f7f\u7528\u76ee\u6807\u68c0\u6d4b\u6a21\u578b\u8bc6\u522b\u5355\u5143\u683c\u7ed3\u6784\uff0c\u518d\u7ed3\u5408 OCR \u63d0\u53d6\u5185\u5bb9\u3002\u8fd9\u662f\u5904\u7406\u626b\u63cf\u4ef6\u548c\u590d\u6742\u5d4c\u5957\u8868\u683c\u7684\u552f\u4e00\u9014\u5f84\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1212","title":"12.1.2 \u89e3\u6790\u5de5\u5177\u9009\u578b\u5bf9\u6bd4","text":"<p>\u9762\u5bf9\u590d\u6742\u7684\u4f01\u4e1a\u6587\u6863\uff0c\u6211\u4eec\u9700\u8981\u6839\u636e\u6587\u6863\u7c7b\u578b\u548c\u9884\u7b97\u9009\u62e9\u6784\u5efa\u89e3\u6790\u7ba1\u9053\u3002</p> \u7279\u6027 Unstructured (Open Source) LlamaParse (Proprietary) PyPDF/PDFMiner (Basic) \u6838\u5fc3\u539f\u7406 \u89c4\u5219 + \u57fa\u7840 OCR \u6df7\u5408\u6a21\u578b \u5927\u6a21\u578b\u89c6\u89c9\u7406\u89e3 (Vision LLM) \u63d0\u53d6\u5e95\u5c42\u6587\u672c\u6d41 \u8868\u683c\u5904\u7406\u80fd\u529b \u4e2d\u7b49\uff08\u80fd\u8bc6\u522b\u8868\u683c\u533a\u57df\uff0c\u4f46\u590d\u6742\u8868\u5934\u6613\u4e71\uff09 \u6781\u5f3a\uff08\u91cd\u6784\u4e3a Markdown \u8868\u683c\uff0c\u4fdd\u7559\u8bed\u4e49\uff09 \u5dee\uff08\u884c\u5217\u5b8c\u5168\u9519\u4e71\uff09 \u591a\u680f\u8bc6\u522b \u652f\u6301\uff08\u57fa\u4e8e\u68c0\u6d4b\u6a21\u578b\uff09 \u652f\u6301\uff08\u539f\u751f\u7406\u89e3\u7248\u9762\uff09 \u4e0d\u652f\u6301\uff08\u8de8\u680f\u8bfb\u53d6\uff09 \u6210\u672c \u4f4e\uff08\u672c\u5730\u8ba1\u7b97\u8d44\u6e90\uff09 \u9ad8\uff08\u6309\u9875\u6570\u8ba1\u8d39 API\uff09 \u6781\u4f4e \u9002\u7528\u573a\u666f \u7b80\u5355\u7684 Word/HTML\uff0c\u89c4\u5219\u56fa\u5b9a\u7684 PDF \u590d\u6742\u8d22\u62a5\u3001\u626b\u63cf\u4ef6\u3001\u5d4c\u5957\u8868\u683c \u7eaf\u6587\u672c\u7535\u5b50\u4e66 <p>\u5efa\u8bae\uff1a\u5bf9\u4e8e\u6838\u5fc3\u4e1a\u52a1\u6587\u6863\uff08\u5982\u5408\u540c\u3001\u8d22\u62a5\uff09\uff0c\u4f18\u5148\u4f7f\u7528 LlamaParse \u6216 Azure Document Intelligence\uff1b\u5bf9\u4e8e\u6d77\u91cf\u666e\u901a\u6587\u6863\uff0c\u4f7f\u7528 Unstructured \u8fdb\u884c\u6e05\u6d17\u4ee5\u964d\u4f4e\u6210\u672c\u3002</p> <p></p> <p>\u56fe12-1\uff1a\u4f20\u7edf\u89e3\u6790 vs. \u667a\u80fd\u89e3\u6790 \u2014\u2014 \u667a\u80fd\u89e3\u6790\u901a\u8fc7\u7248\u9762\u5206\u6790\u4fdd\u7559\u4e86\u591a\u680f\u987a\u5e8f\u548c\u8868\u683c\u7ed3\u6784</p>"},{"location":"part5/5_1_rag_pipeline/#122-chunking","title":"12.2 \u5207\u7247\u7b56\u7565 (Chunking)\uff1a\u4e0a\u4e0b\u6587\u4e0e\u68c0\u7d22\u7c92\u5ea6\u7684\u5e73\u8861\u827a\u672f","text":"<p>\u6587\u6863\u89e3\u6790\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u9700\u8981\u5c06\u5176\u5207\u5206\u4e3a\u6a21\u578b\u53ef\u5904\u7406\u7684\u7247\u6bb5\uff08Chunk\uff09\u3002\u5207\u5206\u7b56\u7565\u76f4\u63a5\u51b3\u5b9a\u4e86\u68c0\u7d22\u7684\u51c6\u786e\u5ea6\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1221-recursive-character-splitter","title":"12.2.1 \u57fa\u7840\u7b56\u7565\uff1a\u9012\u5f52\u5b57\u7b26\u5207\u7247 (Recursive Character Splitter)","text":"<p>\u6700\u6734\u7d20\u7684\u65b9\u6cd5\u662f\u6309\u56fa\u5b9a\u5b57\u7b26\u6570\u5207\u5206\uff08\u5982\u6bcf 500 \u5b57\u4e00\u5200\uff09\u3002\u4f46\u8fd9\u5f80\u5f80\u4f1a\u628a\u4e00\u4e2a\u5b8c\u6574\u7684\u53e5\u5b50\u6216\u903b\u8f91\u6bb5\u843d\u62e6\u8170\u622a\u65ad\u3002 \u9012\u5f52\u5207\u7247\u662f\u76ee\u524d\u7684\u57fa\u51c6\u65b9\u6848\u3002\u5b83\u901a\u8fc7\u5b9a\u4e49\u4e00\u7ec4\u5206\u9694\u7b26\u4f18\u5148\u7ea7\uff08\u5982 <code>\\n\\n</code> &gt; <code>\\n</code> &gt; <code>\u3002</code> &gt; <code></code>\uff09\uff0c\u4f18\u5148\u5728\u6bb5\u843d\u95f4\u5207\u5206\uff0c\u5176\u6b21\u5728\u53e5\u5b50\u95f4\u5207\u5206\u3002\u8fd9\u4fdd\u8bc1\u4e86\u5c3d\u53ef\u80fd\u4fdd\u7559\u8bed\u4e49\u7684\u5b8c\u6574\u6027\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1222-structural-chunking-markdownhtml-parsing","title":"12.2.2 \u8fdb\u9636\u7b56\u7565\u4e00\uff1a\u57fa\u4e8e\u7ed3\u6784\u7684\u5207\u5206 (Structural Chunking: Markdown/HTML Parsing)","text":"<p>\u5728\u5de5\u7a0b\u5b9e\u8df5\u4e2d\uff0c\u7eaf\u6587\u672c\u7684\u76f2\u76ee\u5207\u5206\u5f80\u5f80\u662f\u4e0d\u53ef\u9760\u7684\u3002\u5e78\u8fd0\u7684\u662f\uff0c\u8bb8\u591a\u4f01\u4e1a\u6587\u6863\uff08\u5982 Wiki\u3001\u7f51\u9875\u3001\u89c4\u7ae0\u5236\u5ea6\uff09\u672c\u8eab\u5e26\u6709\u5f3a\u70c8\u7684\u7ed3\u6784\u5316\u6807\u7b7e\uff08\u5982 <code>&lt;h1&gt;</code>, <code>&lt;h2&gt;</code>, <code>&lt;table&gt;</code>\uff09\u3002</p> <p>\u7ed3\u6784\u5316\u5207\u7247\u7684\u6838\u5fc3\u5728\u4e8e\u89e3\u6790\u6587\u6863\u7684 DOM \u6811\u6216 Markdown \u62bd\u8c61\u8bed\u6cd5\u6811\uff08AST\uff09\uff1a * \u6309\u5c42\u7ea7\u6253\u5305\uff1a\u8bc6\u522b HTML \u6216 Markdown \u7684\u6807\u9898\u5c42\u7ea7\uff0c\u5c06\u540c\u4e00\u6807\u9898\u4e0b\u7684\u5185\u5bb9\u53ca\u5176\u5b50\u8282\u70b9\u4f5c\u4e3a\u4e00\u4e2a\u5b8c\u6574\u7684\u903b\u8f91 Chunk \u63d0\u53d6\u3002 * \u4fdd\u62a4\u72ec\u7acb\u7ed3\u6784\uff1a\u5bf9\u4e8e\u8868\u683c\u6216\u4ee3\u7801\u5757\uff0c\u786e\u4fdd\u5b83\u4eec\u4e0d\u88ab\u5b57\u7b26\u957f\u5ea6\u9608\u503c\u5f3a\u884c\u622a\u65ad\uff0c\u800c\u662f\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u4fdd\u7559\uff0c\u6216\u8f6c\u6362\u4e3a\u5e26\u8868\u5934\u7684 Markdown \u952e\u503c\u5bf9\u63cf\u8ff0\u3002 \u8fd9\u79cd\u57fa\u4e8e\u7ed3\u6784\u7684\u7b56\u7565\uff0c\u5728\u5904\u7406\u5c42\u7ea7\u5206\u660e\u7684\u957f\u7bc7\u6280\u672f\u6587\u6863\u548c\u6cd5\u5f8b\u5408\u540c\u65f6\uff0c\u80fd\u6700\u5927\u7a0b\u5ea6\u4fdd\u7559\u4f5c\u8005\u7684\u539f\u59cb\u903b\u8f91\u6846\u67b6\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1223-semantic-chunking","title":"12.2.3 \u8fdb\u9636\u7b56\u7565\u4e8c\uff1a\u8bed\u4e49\u5207\u7247 (Semantic Chunking)","text":"<p>\u5373\u4f7f\u662f\u9012\u5f52\u5207\u7247\uff0c\u4e5f\u65e0\u6cd5\u5224\u65ad\u4e24\u4e2a\u6bb5\u843d\u662f\u5426\u5728\u8ba8\u8bba\u540c\u4e00\u4e2a\u8bdd\u9898\u3002\u8bed\u4e49\u5207\u7247\u5229\u7528 Embedding \u6a21\u578b\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1a 1.  \u8ba1\u7b97\u76f8\u90bb\u53e5\u5b50\u7684\u5411\u91cf\u76f8\u4f3c\u5ea6\u3002 2.  \u8bbe\u5b9a\u9608\u503c\uff0c\u5f53\u76f8\u90bb\u53e5\u5b50\u7684\u76f8\u4f3c\u5ea6\u9aa4\u964d\u65f6\uff08\u610f\u5473\u7740\u8bdd\u9898\u53d1\u751f\u4e86\u8f6c\u6362\uff09\uff0c\u5728\u6b64\u5904\u8fdb\u884c\u5207\u5206\u3002 \u8fd9\u79cd\u65b9\u6cd5\u751f\u6210\u7684 Chunk \u957f\u5ea6\u4e0d\u4e00\uff0c\u4f46\u8bed\u4e49\u7eaf\u5ea6\u6781\u9ad8\uff0c\u907f\u514d\u4e86\u201c\u4e00\u4e2a Chunk \u5305\u542b\u534a\u4e2a\u4ea7\u54c1\u4ecb\u7ecd\u548c\u534a\u4e2a\u552e\u540e\u653f\u7b56\u201d\u7684\u566a\u97f3\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1224-parent-child-indexing","title":"12.2.4 \u9ad8\u7ea7\u7b56\u7565\uff1a\u7236\u5b50\u7d22\u5f15 (Parent-Child Indexing)","text":"<p>\u8fd9\u662f\u89e3\u51b3 RAG \u201c\u68c0\u7d22\u7c92\u5ea6\u201d\u4e0e\u201c\u751f\u6210\u4e0a\u4e0b\u6587\u201d\u77db\u76fe\u7684\u7ec8\u6781\u6b66\u5668\u3002 * \u77db\u76fe\uff1aChunk \u8d8a\u5c0f\uff0c\u8bed\u4e49\u8d8a\u805a\u7126\uff0c\u5411\u91cf\u68c0\u7d22\u8d8a\u51c6\uff1b\u4f46 Chunk \u592a\u5c0f\uff0c\u4e22\u5931\u4e86\u4e0a\u4e0b\u6587\uff0cLLM \u65e0\u6cd5\u751f\u6210\u5168\u9762\u56de\u7b54\u3002 * \u89e3\u6cd5\uff1a     1.  \u5c06\u6587\u6863\u5207\u5206\u4e3a\u5927\u5757\uff08Parent Chunk\uff09\uff0c\u4f8b\u5982 1000 Token\u3002     2.  \u5c06\u6bcf\u4e2a\u5927\u5757\u8fdb\u4e00\u6b65\u5207\u5206\u4e3a\u5c0f\u5757\uff08Child Chunk\uff09\uff0c\u4f8b\u5982 200 Token\u3002     3.  \u5bf9\u5c0f\u5757\u8fdb\u884c\u5411\u91cf\u5316\u5e76\u5efa\u7acb\u7d22\u5f15\u3002     4.  \u68c0\u7d22\u65f6\uff0c\u5339\u914d\u5230\u5c0f\u5757\uff0c\u4f46\u8fd4\u56de\u7ed9 LLM \u7684\u662f\u8be5\u5c0f\u5757\u6240\u5c5e\u7684\u5927\u5757\u3002</p> <p>\u8fd9\u79cd\u201c\u5c0f\u5757\u68c0\u7d22\uff0c\u5927\u5757\u751f\u6210\u201d\u7684\u7b56\u7565\uff08Small-to-Big Retrieval\uff09\uff0c\u65e2\u4fdd\u8bc1\u4e86\u68c0\u7d22\u7684\u7cbe\u51c6\u5ea6\uff0c\u53c8\u4e3a\u6a21\u578b\u63d0\u4f9b\u4e86\u5145\u8db3\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002</p> <p></p> <p>\u56fe12-2\uff1a\u7236\u5b50\u7d22\u5f15\u673a\u5236 \u2014\u2014 \u68c0\u7d22\u547d\u4e2d Child Node\uff0c\u5b9e\u9645\u8fd4\u56de Parent Node\uff0c\u517c\u987e\u7cbe\u51c6\u5ea6\u4e0e\u4e0a\u4e0b\u6587</p>"},{"location":"part5/5_1_rag_pipeline/#123","title":"12.3 \u5411\u91cf\u5316\u4e0e\u5b58\u50a8\uff1a\u8ba9\u673a\u5668\u542c\u61c2\u884c\u4e1a\u201c\u9ed1\u8bdd\u201d","text":"<p>\u6570\u636e\u5207\u7247\u540e\uff0c\u9700\u8981\u901a\u8fc7 Embedding \u6a21\u578b\u8f6c\u5316\u4e3a\u5411\u91cf\u5e76\u5b58\u5165\u5411\u91cf\u6570\u636e\u5e93\u3002\u5728\u8fd9\u4e2a\u73af\u8282\uff0c\u901a\u7528\u7684\u65b9\u6848\u5f80\u5f80\u4e0d\u591f\u7528\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1231-embedding","title":"12.3.1 Embedding \u6a21\u578b\u5fae\u8c03","text":"<p>\u901a\u7528\u7684 Embedding \u6a21\u578b\uff08\u5982 OpenAI text-embedding-3 \u6216 BGE-M3\uff09\u662f\u5728\u901a\u7528\u8bed\u6599\u4e0a\u8bad\u7ec3\u7684\u3002\u5728\u5782\u76f4\u9886\u57df\uff0c\u5b83\u4eec\u53ef\u80fd\u8868\u73b0\u4e0d\u4f73\u3002 \u4f8b\u5982\uff0c\u5728\u533b\u7597\u9886\u57df\uff0c\u201c\u611f\u5192\u201d\u548c\u201c\u53d1\u70e7\u201d\u5728\u901a\u7528\u8bed\u4e49\u4e0b\u5f88\u63a5\u8fd1\uff0c\u4f46\u5728\u8bca\u65ad\u903b\u8f91\u4e2d\u53ef\u80fd\u6307\u5411\u5b8c\u5168\u4e0d\u540c\u7684\u75c5\u7406\u3002 \u5fae\u8c03\uff08Fine-tuning\uff09 \u65e8\u5728\u8c03\u6574\u5411\u91cf\u7a7a\u95f4\u5206\u5e03\uff0c\u8ba9\u76f8\u4f3c\u7684\u4e13\u4e1a\u6982\u5ff5\u9760\u5f97\u66f4\u8fd1\u3002\u901a\u5e38\u4f7f\u7528 \u5bf9\u6bd4\u5b66\u4e60\uff08Contrastive Learning\uff09 \u635f\u5931\u51fd\u6570\uff1a</p> \\[ L = - \\log \\frac{e^{sim(q, d^+)/\\tau}}{e^{sim(q, d^+)/\\tau} + \\sum_{i} e^{sim(q, d^-_i)/\\tau}} \\] <p>\u5176\u4e2d \\(d^+\\) \u662f\u6b63\u4f8b\uff08\u6b63\u786e\u7684\u6587\u6863\uff09\uff0c\\(d^-\\) \u662f\u8d1f\u4f8b\uff08\u9519\u8bef\u7684\u6587\u6863\uff09\u3002\u901a\u8fc7\u6784\u9020\u201c\u95ee\u9898-\u76f8\u5173\u6587\u6863\u201d\u7684\u6b63\u4f8b\u5bf9\u548c\u201c\u95ee\u9898-\u4e0d\u76f8\u5173\u6587\u6863\u201d\u7684\u8d1f\u4f8b\u5bf9\u8fdb\u884c\u5fae\u8c03\uff0c\u53ef\u4ee5\u663e\u8457\u63d0\u5347\u7279\u5b9a\u9886\u57df\u7684\u68c0\u7d22\u53ec\u56de\u7387\uff08Recall\uff09\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1232-hybrid-searchbm25","title":"12.3.2 \u6df7\u5408\u68c0\u7d22 (Hybrid Search)\uff1aBM25 \u4e0e\u5411\u91cf\u7d22\u5f15\u7684\u5de5\u7a0b\u878d\u5408","text":"<p>\u5355\u7eaf\u4f9d\u8d56\u5411\u91cf\u68c0\u7d22\uff08Dense Retrieval\uff09\u5b58\u5728\u81f4\u547d\u7f3a\u9677\uff1a\u5b83\u5bf9\u4e13\u6709\u540d\u8bcd\u3001\u7cbe\u786e\u6570\u5b57\u3001\u4ea7\u54c1\u578b\u53f7\u7b49\u5173\u952e\u8bcd\u5339\u914d\u5e76\u4e0d\u654f\u611f\u3002\u4f01\u4e1a\u7ea7 RAG \u5fc5\u987b\u5728\u5de5\u7a0b\u67b6\u6784\u4e0a\u5b9e\u73b0\u4e24\u5957\u68c0\u7d22\u5f15\u64ce\u7684\u201c\u53cc\u5251\u5408\u74a7\u201d\uff1a</p> <ul> <li>\u7a00\u758f\u7d22\u5f15 (Sparse Index / BM25)\uff1a\u4f9d\u6258\u4f20\u7edf\u68c0\u7d22\u5f15\u64ce\uff08\u5982 Elasticsearch\u3001OpenSearch\uff09\uff0c\u5229\u7528\u8bcd\u9891-\u9006\u6587\u6863\u9891\u7387\uff08TF-IDF\uff09\u7684\u8fdb\u9636\u7b97\u6cd5 BM25\uff0c\u6355\u6349\u7cbe\u786e\u7684\u5b57\u9762\u91cf\u5339\u914d\uff08\u5982\u4ea7\u54c1 ID \"A123-X\"\uff09\u3002</li> <li>\u7a20\u5bc6\u7d22\u5f15 (Dense Index / Vector)\uff1a\u4f9d\u6258\u5411\u91cf\u6570\u636e\u5e93\uff08\u5982 Milvus, Pinecone\uff09\uff0c\u6355\u6349\u6cdb\u5316\u7684\u8bed\u4e49\u76f8\u5173\u6027\uff08\u5982\u201c\u82f9\u679c\u201d\u4e0e\u201c\u6c34\u679c\u201d\uff09\u3002</li> </ul> <p>\u5de5\u7a0b\u878d\u5408\u7684\u96be\u70b9\u4e0e\u89e3\u6cd5\uff1a \u5c06\u4e24\u8005\u878d\u5408\u5e76\u975e\u7b80\u5355\u5730\u628a\u7ed3\u679c\u62fc\u5728\u4e00\u8d77\u3002\u6838\u5fc3\u75db\u70b9\u5728\u4e8e\u5f02\u6784\u5206\u6570\u7684\u5bf9\u9f50\uff1aBM25 \u7684\u5f97\u5206\u662f\u65e0\u754c\u7684\uff08\u751a\u81f3\u53ef\u80fd\u8fbe\u5230\u51e0\u5341\u3001\u51e0\u767e\uff09\uff0c\u800c\u5411\u91cf\u68c0\u7d22\u7684\u4f59\u5f26\u76f8\u4f3c\u5ea6\u901a\u5e38\u5728 [-1, 1] \u4e4b\u95f4\u3002</p> <p>\u4e3a\u4e86\u5728\u67e5\u8be2\u5c42\u5e73\u6ed1\u805a\u5408\u8fd9\u4e24\u8def\u53ec\u56de\u7ed3\u679c\uff0c\u4e1a\u754c\u6807\u914d\u7684\u5de5\u7a0b\u89e3\u6cd5\u662f\u5f15\u5165 \u5012\u6392\u6392\u5e8f\u878d\u5408\uff08Reciprocal Rank Fusion, RRF\uff09 \u7b97\u6cd5\u3002 RRF \u4e0d\u5173\u5fc3\u5177\u4f53\u7684\u5f97\u5206\uff0c\u800c\u662f\u5229\u7528\u6587\u6863\u5728\u5404\u81ea\u68c0\u7d22\u5217\u8868\u4e2d\u7684\u6392\u540d\uff08Rank\uff09\u8fdb\u884c\u878d\u5408\u6253\u5206\uff1a $\\(RRF\\_Score = \\sum \\frac{1}{k + Rank}\\)$ \uff08\u5176\u4e2d \\(k\\) \u901a\u5e38\u8bbe\u5b9a\u4e3a 60 \u4ee5\u5e73\u6ed1\u6743\u91cd\uff09\u3002\u901a\u8fc7 RRF \u91cd\u6392\uff0c\u7cfb\u7edf\u80fd\u591f\u4f18\u96c5\u4e14\u7a33\u5065\u5730\u5c06\u201c\u7cbe\u786e\u67e5\u627e\u201d\u4e0e\u201c\u6a21\u7cca\u8bed\u4e49\u7406\u89e3\u201d\u7ed3\u5408\uff0c\u5f7b\u5e95\u89e3\u51b3\u4e86\u5355\u8def\u53ec\u56de\u51c6\u786e\u7387\u4f4e\u4e0b\u7684\u5de5\u7a0b\u74f6\u9888\u3002\u6b64\u5916\uff0c\u5411\u91cf\u6570\u636e\u5e93\u7684\u9009\u578b\u8fd8\u9700\u8003\u8651\u5143\u6570\u636e\u8fc7\u6ee4\uff08Metadata Filtering\uff09\u6027\u80fd\uff0c\u4ee5\u4fbf\u5728\u68c0\u7d22\u524d\u5148\u901a\u8fc7\u201c\u5e74\u4efd=2023\u201d\u7b49\u6761\u4ef6\u8fc7\u6ee4\u6570\u636e\uff0c\u5927\u5e45\u964d\u4f4e\u8ba1\u7b97\u91cf\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#124","title":"12.4 \u5de5\u7a0b\u5b9e\u73b0\uff1a\u6784\u5efa\u7236\u5b50\u7d22\u5f15\u6d41\u6c34\u7ebf","text":"<p>\u672c\u8282\u6211\u4eec\u5c06\u5b9e\u73b0\u524d\u6587\u63d0\u5230\u7684\u6838\u5fc3\u7b56\u7565\u2014\u2014\u7236\u5b50\u7d22\u5f15 (Parent-Child Indexing)\u3002\u6211\u4eec\u5c06\u4f7f\u7528 Python \u5b9a\u4e49\u4e00\u4e2a\u53ef\u590d\u7528\u7684\u5904\u7406\u7c7b\uff0c\u6a21\u62df\u4ece\u6587\u6863\u52a0\u8f7d\u5230\u5411\u91cf\u5b58\u50a8\u7684\u5168\u8fc7\u7a0b\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1241","title":"12.4.1 \u4f9d\u8d56\u73af\u5883","text":"<pre><code>pip install langchain lancedb numpy unstructured\n</code></pre>"},{"location":"part5/5_1_rag_pipeline/#1242","title":"12.4.2 \u6838\u5fc3\u4ee3\u7801\u62c6\u89e3","text":"<p>\u6211\u4eec\u4e0d\u76f4\u63a5\u8c03\u7528\u5c01\u88c5\u597d\u7684\u9ad8\u7ea7 API\uff0c\u800c\u662f\u62c6\u89e3\u5176\u903b\u8f91\u4ee5\u4fbf\u7406\u89e3\u6570\u636e\u6d41\u5411\u3002</p> <pre><code>import uuid\nfrom typing import List, Dict, Any\nfrom dataclasses import dataclass\n\n@dataclass\nclass Document:\n    page_content: str\n    metadata: Dict[str, Any]\n    doc_id: str = None\n\nclass ParentChildIndexer:\n    \"\"\"\n    \u5b9e\u73b0\u7236\u5b50\u7d22\u5f15\u7b56\u7565\uff1a\n    1. Parent Chunk: \u7528\u4e8e\u5b58\u50a8\u548c\u751f\u6210\uff0c\u4fdd\u7559\u5b8c\u6574\u4e0a\u4e0b\u6587\u3002\n    2. Child Chunk: \u7528\u4e8e\u5411\u91cf\u5316\u548c\u68c0\u7d22\uff0c\u4fdd\u8bc1\u8bed\u4e49\u7cbe\u51c6\u5ea6\u3002\n    \"\"\"\n\n    def __init__(self, parent_chunk_size=1000, child_chunk_size=200):\n        self.parent_size = parent_chunk_size\n        self.child_size = child_chunk_size\n        # \u6a21\u62df\u5411\u91cf\u6570\u636e\u5e93\uff08KV Store + Vector Store\uff09\n        self.doc_store = {}  # \u5b58 Parent \u6587\u6863: {doc_id: content}\n        self.vector_index = [] # \u5b58 Child \u5411\u91cf: [(vector, parent_doc_id)]\n\n    def process_documents(self, raw_docs: List[Document]):\n        \"\"\"Step 1: \u6570\u636e\u5904\u7406\u6d41\u6c34\u7ebf\"\"\"\n        for doc in raw_docs:\n            # \u751f\u6210\u552f\u4e00 ID\n            if not doc.doc_id:\n                doc.doc_id = str(uuid.uuid4())\n\n            # 1. \u5b58\u5165 Parent Document (KV Store)\n            self.doc_store[doc.doc_id] = doc\n\n            # 2. \u751f\u6210 Child Chunks\n            child_chunks = self._create_child_chunks(doc)\n\n            # 3. \u5411\u91cf\u5316\u5e76\u5efa\u7acb\u7d22\u5f15\n            self._index_children(child_chunks, doc.doc_id)\n\n    def _create_child_chunks(self, parent_doc: Document) -&gt; List[str]:\n        \"\"\"\n        Step 2: \u5207\u7247\u903b\u8f91\n        \u8fd9\u91cc\u7b80\u5316\u4e3a\u6309\u56fa\u5b9a\u5b57\u7b26\u6570\u5207\u5206\uff0c\u751f\u4ea7\u73af\u5883\u5efa\u8bae\u4f7f\u7528 RecursiveCharacterTextSplitter\n        \"\"\"\n        text = parent_doc.page_content\n        children = []\n        for i in range(0, len(text), self.child_size):\n            end = min(i + self.child_size, len(text))\n            children.append(text[i:end])\n        return children\n\n    def _index_children(self, children: List[str], parent_id: str):\n        \"\"\"Step 3: \u5411\u91cf\u5316\u903b\u8f91 (\u4f2a\u4ee3\u7801)\"\"\"\n        for child_text in children:\n            # \u6a21\u62df Embedding \u8fc7\u7a0b\n            # vector = embedding_model.encode(child_text) \n            vector = [0.1, 0.2] # \u5360\u4f4d\u7b26\n\n            # \u5173\u952e\uff1a\u5728 Child \u7684\u5143\u6570\u636e\u4e2d\u5b58\u50a8 Parent ID\n            self.vector_index.append({\n                \"vec\": vector,\n                \"text\": child_text,\n                \"parent_id\": parent_id\n            })\n\n    def retrieve(self, query: str) -&gt; List[Document]:\n        \"\"\"\n        Step 4: \u68c0\u7d22\u903b\u8f91 (Small-to-Big)\n        \u68c0\u7d22\u547d\u4e2d Child -&gt; \u8fd4\u56de Parent\n        \"\"\"\n        # 1. \u5411\u91cf\u68c0\u7d22\u627e\u5230 Top-K Children (\u6a21\u62df)\n        # top_children = vector_db.search(query)\n        # \u6ce8\u610f: \u8fd9\u91cc\u4ec5\u4e3a\u793a\u4f8b, \u5b9e\u9645\u5e94\u8be5\u57fa\u4e8e\u5411\u91cf\u76f8\u4f3c\u5ea6\u6392\u5e8f\n        top_child = self.vector_index[0] # \u5047\u8bbe\u547d\u4e2d\u4e86\u7b2c\u4e00\u4e2a\n\n        # 2. \u56de\u6eaf Parent\n        parent_id = top_child[\"parent_id\"]\n        parent_doc = self.doc_store.get(parent_id)\n\n        print(f\"\u68c0\u7d22\u547d\u4e2d\u7247\u6bb5: {top_child['text'][:20]}...\")\n        print(f\"\u56de\u6eaf\u7236\u6587\u6863ID: {parent_id}\")\n        return [parent_doc]\n\n# --- Usage Example ---\nindexer = ParentChildIndexer()\ndoc = Document(page_content=\"RAG\u7cfb\u7edf\u7684\u6838\u5fc3\u5728\u4e8e\u6570\u636e\u8d28\u91cf...\" * 50, metadata={\"source\": \"manual.pdf\"})\nindexer.process_documents([doc])\nresult = indexer.retrieve(\"\u6570\u636e\u8d28\u91cf\")\n</code></pre>"},{"location":"part5/5_1_rag_pipeline/#1243-pro-tips","title":"12.4.3 \u5b9e\u6218\u6280\u5de7 (Pro Tips)","text":"<p>\ud83d\udca1 Tip: ID \u7ba1\u7406\u81f3\u5173\u91cd\u8981 \u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c<code>doc_id</code> \u5fc5\u987b\u5177\u6709\u786e\u5b9a\u6027\uff08\u4f8b\u5982\u4f7f\u7528 <code>hash(file_path + update_time)</code>\uff09\u3002\u5426\u5219\uff0c\u5f53\u6e90\u6587\u4ef6\u66f4\u65b0\u91cd\u65b0\u8fd0\u884c\u65f6\uff0c\u5411\u91cf\u6570\u636e\u5e93\u4e2d\u4f1a\u4ea7\u751f\u5927\u91cf\u65e0\u6cd5\u5220\u9664\u7684\u201c\u50f5\u5c38\u5207\u7247\u201d\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#125-performance-evaluation","title":"12.5 \u6027\u80fd\u4e0e\u8bc4\u4f30 (Performance &amp; Evaluation)","text":"<p>RAG \u7cfb\u7edf\u7684\u6027\u80fd\u4e0d\u4ec5\u4ec5\u662f\u201c\u56de\u7b54\u51c6\u786e\u201d\uff0c\u8fd8\u5305\u62ec\u7d22\u5f15\u6784\u5efa\u7684\u6210\u672c\u548c\u68c0\u7d22\u7684\u5ef6\u8fdf\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#1251","title":"12.5.1 \u8bc4\u4ef7\u6307\u6807","text":"\u6307\u6807 \u8bf4\u660e \u76ee\u6807\u503c (\u53c2\u8003) Hit Rate (Recall@K) \u68c0\u7d22\u51fa\u7684\u524d K \u4e2a\u6587\u6863\u4e2d\u5305\u542b\u6b63\u786e\u7b54\u6848\u7684\u6bd4\u4f8b &gt; 85% MRR (Mean Reciprocal Rank) \u6b63\u786e\u6587\u6863\u5728\u68c0\u7d22\u5217\u8868\u4e2d\u7684\u6392\u540d\u6743\u91cd &gt; 0.7 Faithfulness \u751f\u6210\u7684\u7b54\u6848\u662f\u5426\u5fe0\u5b9e\u4e8e\u68c0\u7d22\u5230\u7684\u4e0a\u4e0b\u6587\uff08\u9632\u5e7b\u89c9\uff09 &gt; 90% (\u57fa\u4e8e RAGAS)"},{"location":"part5/5_1_rag_pipeline/#1252-benchmarks","title":"12.5.2 \u57fa\u51c6\u6d4b\u8bd5 (Benchmarks)","text":"<p>\u6211\u4eec\u5728\u670d\u52a1\u5668 (Dual Xeon 6226R + 1x RTX 3090) \u5b9e\u4f8b\u4e0a\uff0c\u9488\u5bf9 10,000 \u9875 PDF \u6587\u6863\uff08\u6df7\u5408\u6587\u672c\u4e0e\u8868\u683c\uff09\u8fdb\u884c\u4e86\u6d4b\u8bd5\uff1a</p> <ul> <li>\u89e3\u6790\u8017\u65f6 (Unstructured):</li> <li>\u7eaf CPU: 28 \u5206\u949f</li> <li> <p>GPU \u52a0\u901f (OCR): 11 \u5206\u949f (\u52a0\u901f 2.5 \u500d)</p> </li> <li> <p>\u68c0\u7d22\u5ef6\u8fdf (10M \u5411\u91cf\u89c4\u6a21):</p> </li> <li>\u7eaf Dense \u68c0\u7d22: 9ms</li> <li>Hybrid \u68c0\u7d22 (Dense + Sparse + RRF): 45ms</li> <li>\u7ed3\u8bba\uff1a\u6df7\u5408\u68c0\u7d22\u867d\u7136\u589e\u52a0\u4e86\u5ef6\u8fdf\uff0c\u4f46\u5728\u7cbe\u51c6\u5ea6\u8981\u6c42\u9ad8\u7684\u573a\u666f\u4e0b\uff08\u5982\u5408\u540c\u5ba1\u67e5\uff09\uff0c36ms\u7684\u989d\u5916\u5f00\u9500\u662f\u5b8c\u5168\u503c\u5f97\u7684\u3002</li> </ul>"},{"location":"part5/5_1_rag_pipeline/#126","title":"12.6 \u5e38\u89c1\u8bef\u533a\u4e0e\u907f\u5751\u6307\u5357","text":""},{"location":"part5/5_1_rag_pipeline/#pdf-pypdf","title":"\u8bef\u533a\u4e00\uff1a\u201cPDF \u89e3\u6790\u7528 PyPDF \u5c31\u591f\u4e86\u201d","text":"<p>\u8bb8\u591a\u521d\u5b66\u8005\u4f4e\u4f30\u4e86 PDF \u7684\u590d\u6742\u6027\u3002\u5bf9\u4e8e\u5305\u542b\u56fe\u8868\u3001\u591a\u680f\u7684\u8d22\u62a5\u6216\u624b\u518c\uff0c\u7b80\u5355\u7684\u6587\u672c\u63d0\u53d6\u4f1a\u5bfc\u81f4\u4e25\u91cd\u7684\u4fe1\u606f\u4e22\u5931\u3002\u5efa\u8bae\u5728\u9879\u76ee\u521d\u671f\u5c31\u5f15\u5165 Layout Analysis \u5de5\u5177\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#_3","title":"\u8bef\u533a\u4e8c\uff1a\u201c\u5207\u7247\u8d8a\u5c0f\u8d8a\u597d\u201d","text":"<p>\u8fc7\u5c0f\u7684\u5207\u7247\u867d\u7136\u80fd\u63d0\u9ad8\u68c0\u7d22\u7684\u4f59\u5f26\u76f8\u4f3c\u5ea6\uff0c\u4f46\u4f1a\u5bfc\u81f4\u201c\u65ad\u7ae0\u53d6\u4e49\u201d\u3002LLM \u7f3a\u4e4f\u8db3\u591f\u7684\u4e0a\u4e0b\u6587\uff08Context\uff09\u6765\u63a8\u65ad\u6b63\u786e\u7b54\u6848\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#_4","title":"\u8bef\u533a\u4e09\uff1a\u201c\u5ffd\u89c6\u5143\u6570\u636e\u201d","text":"<p>\u53ea\u5b58\u6587\u672c\u5411\u91cf\uff0c\u4e0d\u5b58\u5143\u6570\u636e\uff08\u5982\u6587\u4ef6\u540d\u3001\u9875\u7801\u3001\u53d1\u5e03\u65e5\u671f\uff09\uff0c\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u8fdb\u884c\u65f6\u95f4\u8fc7\u6ee4\u6216\u6765\u6e90\u8ffd\u6eaf\uff0c\u964d\u4f4e\u7cfb\u7edf\u7684\u53ef\u7528\u6027\u3002</p>"},{"location":"part5/5_1_rag_pipeline/#_5","title":"\u672c\u7ae0\u5c0f\u7ed3","text":"<p>RAG \u7cfb\u7edf\u7684\u6838\u5fc3\u7ade\u4e89\u529b\u5728\u4e8e\u6570\u636e\u5904\u7406\u7684\u7cbe\u7ec6\u5ea6\u3002\u672c\u7ae0\u6211\u4eec\u89e3\u6790\u4e86 RAG \u6570\u636e\u6d41\u6c34\u7ebf\u7684\u4e09\u5927\u5173\u5361\uff1a</p> <ol> <li>\u89e3\u6790\u5173\uff1a\u5fc5\u987b\u4ece\u89c6\u89c9\u5c42\u9762\u7406\u89e3\u6587\u6863\u7ed3\u6784\uff0c\u89e3\u51b3\u8868\u683c\u548c\u591a\u680f\u95ee\u9898\u3002</li> <li>\u5207\u7247\u5173\uff1a\u544a\u522b\u5355\u4e00\u7684\u56fa\u5b9a\u5207\u5206\uff0c\u91c7\u7528\u7236\u5b50\u7d22\u5f15\u6216\u8bed\u4e49\u5207\u7247\u6765\u5e73\u8861\u68c0\u7d22\u7cbe\u5ea6\u4e0e\u4e0a\u4e0b\u6587\u5b8c\u6574\u6027\u3002</li> <li>\u68c0\u7d22\u5173\uff1a\u901a\u8fc7\u5fae\u8c03 Embedding \u6a21\u578b\u9002\u914d\u9886\u57df\u77e5\u8bc6\uff0c\u5e76\u7ed3\u5408\u6df7\u5408\u68c0\u7d22\u5f25\u8865\u5411\u91cf\u5339\u914d\u7684\u4e0d\u8db3\u3002</li> </ol> <p>\u505a\u597d\u4e86\u8fd9\u4e9b\uff0c\u4f60\u7684 RAG \u7cfb\u7edf\u624d\u80fd\u4ece\u201c\u80fd\u7528\u201d\u8fdb\u5316\u4e3a\u201c\u597d\u7528\u201d\u3002</p> <p></p> <p>\u56fe12-3\uff1a\u4f01\u4e1a\u7ea7 RAG \u6570\u636e\u6d41\u6c34\u7ebf\u67b6\u6784 \u2014\u2014 \u5f3a\u8c03\u4ece\u975e\u7ed3\u6784\u5316\u89e3\u6790\u5230\u6df7\u5408\u68c0\u7d22\u7684\u5168\u6d41\u7a0b\u4f18\u5316</p>"},{"location":"part5/5_1_rag_pipeline/#_6","title":"\u5ef6\u4f38\u9605\u8bfb","text":"<p>\u5de5\u5177\u4e0e\u6846\u67b6</p> <ul> <li>LlamaIndex\uff1a\u76ee\u524d\u6700\u5148\u8fdb\u7684 RAG \u6570\u636e\u6846\u67b6\uff0c\u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684 Data Loaders \u548c Indexing \u7b56\u7565\uff08\u5305\u62ec\u672c\u6587\u63d0\u5230\u7684\u7236\u5b50\u7d22\u5f15\uff09\u3002</li> <li>RAGAS\uff1a\u4e00\u4e2a\u7528\u4e8e\u8bc4\u4f30 RAG \u7ba1\u9053\u6027\u80fd\u7684\u6846\u67b6\uff0c\u5173\u6ce8\u68c0\u7d22\u51c6\u786e\u7387\uff08Retrieval Accuracy\uff09\u548c\u751f\u6210\u5fe0\u5b9e\u5ea6\uff08Faithfulness\uff09\u3002</li> </ul> <p>\u6838\u5fc3\u8bba\u6587</p> <ul> <li>Lewis \u7b49\u4eba\u4e8e 2020 \u5e74\u53d1\u8868\u7684 Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks \u662f RAG \u7684\u5f00\u5c71\u4e4b\u4f5c\u3002</li> <li>Karpukhin \u7b49\u4eba\u53d1\u8868\u7684 Dense Passage Retrieval for Open-Domain Question Answering (DPR) \u5960\u5b9a\u4e86\u73b0\u4ee3\u53cc\u5854\u5411\u91cf\u68c0\u7d22\u7684\u57fa\u7840\u3002</li> </ul>"},{"location":"part5/5_2_mm_rag/","title":"\u7b2c13\u7ae0\uff1a\u591a\u6a21\u6001RAG","text":""},{"location":"part5/5_2_mm_rag/#13-rag","title":"\u7b2c13\u7ae0\uff1a\u591a\u6a21\u6001 RAG","text":""},{"location":"part5/5_2_mm_rag/#_1","title":"\u672c\u7ae0\u6458\u8981","text":"<p>\u5728\u6587\u672c RAG \u5df2\u7ecf\u5377\u51fa\u5929\u9645\u7684\u4eca\u5929\uff0c\u591a\u6a21\u6001\uff08Multimodal\uff09\u6210\u4e3a\u4e86\u65b0\u7684\u6218\u573a\u3002\u4f01\u4e1a\u6587\u6863\u4e2d\u5f80\u5f80\u5305\u542b\u5927\u91cf\u56fe\u8868\u3001\u6d41\u7a0b\u56fe\u3001\u622a\u5c4f\uff0c\u4f20\u7edf RAG \u65b9\u6848\u901a\u5e38\u9009\u62e9\u7528 OCR \u8f6c\u6587\u5b57\u6216\u76f4\u63a5\u5ffd\u7565\u56fe\u7247\uff0c\u5bfc\u81f4\u5173\u952e\u4fe1\u606f\u4e22\u5931\uff08Information Loss\uff09\u3002\u672c\u7ae0\u5c06\u7a81\u7834\u201c\u7eaf\u6587\u672c\u201d\u7684\u9650\u5236\uff0c\u6784\u5efa\u80fd\u591f\u201c\u770b\u89c1\u201d\u6570\u636e\u7684\u7cfb\u7edf\u3002\u6211\u4eec\u5c06\u4ece\u57fa\u7840\u7684 CLIP/SigLIP \u8de8\u6a21\u6001\u68c0\u7d22\u8bb2\u8d77\uff0c\u6df1\u5165\u63a2\u8ba8\u98a0\u8986\u6027\u7684 ColPali \u67b6\u6784\u2014\u2014\u5e76\u624b\u628a\u624b\u5b9e\u73b0\u5305\u542b\u4e8c\u8fdb\u5236\u91cf\u5316\uff08BQ\uff09\u548cLate Interaction \u6253\u5206\u903b\u8f91\u7684\u7aef\u5230\u7aef\u68c0\u7d22\u6d41\u6c34\u7ebf\u3002</p>"},{"location":"part5/5_2_mm_rag/#130-learning-objectives","title":"13.0 \u5b66\u4e60\u76ee\u6807 (Learning Objectives)","text":"<ul> <li>\u7406\u89e3\u591a\u6a21\u6001\u5411\u91cf\u7a7a\u95f4\uff1a\u638c\u63e1 CLIP \u4e0e SigLIP \u7684\u5bf9\u6bd4\u635f\u5931\u539f\u7406\uff0c\u7406\u89e3\u6587\u672c\u4e0e\u56fe\u50cf\u662f\u5982\u4f55\u5728\u540c\u4e00\u4e2a\u5411\u91cf\u7a7a\u95f4\u5bf9\u9f50\u7684\u3002</li> <li>\u638c\u63e1 ColPali \u67b6\u6784\uff1a\u7406\u89e3 Late Interaction\uff08\u665a\u671f\u4ea4\u4e92\uff09\u673a\u5236\uff0c\u5b66\u4f1a\u4f7f\u7528 <code>colpali-v1.2-merged</code> \u5904\u7406\u590d\u6742\u7684 PDF \u8868\u683c\u4e0e\u56fe\u8868\u3002</li> <li>\u5de5\u7a0b\u843d\u5730\u80fd\u529b\uff1a\u7f16\u5199 Python \u4ee3\u7801\u5b9e\u73b0 MaxSim \u6253\u5206\u7b97\u6cd5\uff0c\u5e76\u5229\u7528\u4e8c\u8fdb\u5236\u91cf\u5316\u5c06\u5b58\u50a8\u6210\u672c\u964d\u4f4e 32 \u500d\u3002</li> <li>\u53ef\u89c6\u5316\u9a8c\u8bc1\uff1a\u901a\u8fc7\u6ce8\u610f\u529b\u70ed\u529b\u56fe\uff08Attention Heatmap\uff09\u9a8c\u8bc1\u6a21\u578b\u7684\u53ef\u89e3\u91ca\u6027\u3002</li> </ul>"},{"location":"part5/5_2_mm_rag/#_2","title":"\u573a\u666f\u5f15\u5165","text":"<p>\u4f60\u6b63\u5728\u7ef4\u62a4\u4e00\u4e2a\u534a\u5bfc\u4f53\u8bbe\u5907\u7684\u7ef4\u4fee\u77e5\u8bc6\u5e93\u3002\u6280\u672f\u624b\u518c\u91cc\u5145\u6ee1\u4e86\u590d\u6742\u7684\u7535\u8def\u56fe\u548c\u8bbe\u5907\u7ed3\u6784\u56fe\u3002 \u73b0\u573a\u5de5\u7a0b\u5e08\u53d1\u6765\u8bf7\u6c42\uff1a\u201c\u5e2e\u6211\u627e\u4e00\u4e0b\u2018\u4e3b\u677f\u4f9b\u7535\u6a21\u5757\u2019\u7684\u63a5\u7ebf\u56fe\u3002\u201d</p> <ul> <li>\u4f20\u7edf RAG (Text-only)\uff1a\u68c0\u7d22\u5230\u4e86\u6587\u5b57\u63cf\u8ff0\u201c\u4e3b\u677f\u4f9b\u7535\u8bf7\u53c2\u8003\u56fe 3-12\u201d\uff0c\u4f46\u7cfb\u7edf\u65e0\u6cd5\u8fd4\u56de\u56fe\u7247\uff0c\u6216\u8005 OCR \u628a\u7535\u8def\u56fe\u8bc6\u522b\u6210\u4e86\u4e00\u5806\u4e71\u7801\u5b57\u7b26\uff08\u5982 <code>---||---</code>\uff09\uff0c\u5de5\u7a0b\u5e08\u770b\u7740\u6587\u5b57\u5e72\u7740\u6025\u3002</li> <li>\u591a\u6a21\u6001 RAG\uff1a\u7cfb\u7edf\u4e0d\u4ec5\u7406\u89e3\u4e86\u7528\u6237\u7684\u6587\u5b57\u610f\u56fe\uff0c\u76f4\u63a5\u68c0\u7d22\u5230\u4e86\u5305\u542b\u8be5\u7535\u8def\u56fe\u7684 PDF \u9875\u9762\u622a\u56fe\uff0c\u5e76\u7cbe\u786e\u9ad8\u4eae\u4e86\u4f9b\u7535\u6a21\u5757\u533a\u57df\u3002</li> </ul> <p>\u8fd9\u5c31\u662f\u4ece\u201c\u9605\u8bfb\u201d\u5230\u201c\u770b\u89c1\u201d\u7684\u8d28\u53d8\u3002\u5728\u5f88\u591a\u5de5\u4e1a\u3001\u91d1\u878d\u573a\u666f\u4e0b\uff0c\u4e00\u5f20\u56fe\u7684\u4fe1\u606f\u5bc6\u5ea6\u8fdc\u8d85\u4e00\u5343\u5b57\u3002</p>"},{"location":"part5/5_2_mm_rag/#131","title":"13.1 \u8de8\u6a21\u6001\u68c0\u7d22\uff1a\u6253\u7834\u56fe\u6587\u58c1\u5792","text":"<p>\u8981\u5b9e\u73b0\u201c\u4ee5\u6587\u641c\u56fe\u201d\u6216\u201c\u4ee5\u56fe\u641c\u6587\u201d\uff0c\u6211\u4eec\u9700\u8981\u4e00\u4e2a\u80fd\u540c\u65f6\u7406\u89e3\u4e24\u79cd\u6a21\u6001\u7684\u6a21\u578b\u3002</p>"},{"location":"part5/5_2_mm_rag/#1311-contrastive-learning","title":"13.1.1 \u6838\u5fc3\u539f\u7406\uff1a\u5bf9\u6bd4\u5b66\u4e60 (Contrastive Learning)","text":"<p>OpenAI \u7684 CLIP (Contrastive Language-Image Pre-training) \u662f\u8fd9\u4e00\u9886\u57df\u7684\u57fa\u77f3\u3002\u5b83\u7684\u8bad\u7ec3\u903b\u8f91\u7b80\u5355\u800c\u66b4\u529b\uff1a 1.  \u6536\u96c6\u6570\u4ebf\u5bf9 <code>(\u56fe\u7247, \u6587\u672c)</code> \u6570\u636e\u3002 2.  \u901a\u8fc7\u56fe\u50cf\u7f16\u7801\u5668\u548c\u6587\u672c\u7f16\u7801\u5668\u5206\u522b\u63d0\u53d6\u5411\u91cf\u3002 3.  \u62c9\u8fd1\u5339\u914d\u5bf9\u7684\u5411\u91cf\u8ddd\u79bb\uff0c\u63a8\u8fdc\u4e0d\u5339\u914d\u5bf9\u7684\u8ddd\u79bb\u3002</p> <p>\u6700\u7ec8\u7ed3\u679c\u662f\uff1a\u4e00\u5f20\u201c\u72d7\u201d\u7684\u7167\u7247\u5411\u91cf\uff0c\u4e0e\u5355\u8bcd\u201cDog\u201d\u7684\u6587\u672c\u5411\u91cf\uff0c\u5728\u6570\u5b66\u7a7a\u95f4\u4e2d\u662f\u975e\u5e38\u63a5\u8fd1\u7684\u3002</p> <p></p> <p>\u56fe13-1\uff1aCLIP \u67b6\u6784 \u2014\u2014 \u6587\u672c\u4e0e\u56fe\u50cf\u88ab\u6620\u5c04\u5230\u540c\u4e00\u4e2a\u9ad8\u7ef4\u7403\u9762\u4e0a\uff0c\u901a\u8fc7\u8ba1\u7b97\u4f59\u5f26\u76f8\u4f3c\u5ea6\u6765\u5224\u65ad\u5173\u8054\u6027</p>"},{"location":"part5/5_2_mm_rag/#1312-clip-vs-siglip","title":"13.1.2 \u6280\u672f\u9009\u578b\uff1aCLIP vs. SigLIP","text":"<p>\u867d\u7136 CLIP \u540d\u6c14\u6700\u5927\uff0c\u4f46\u5728\u5de5\u7a0b\u843d\u5730\u65f6\uff0c\u6211\u4eec\u6709\u66f4\u597d\u7684\u9009\u62e9\u3002Google \u63a8\u51fa\u7684 SigLIP (Sigmoid Loss for Language Image Pre-training) \u5728\u591a\u9879\u6307\u6807\u4e0a\u8d85\u8d8a\u4e86 CLIP\u3002</p> \u7279\u6027 OpenAI CLIP Google SigLIP \u67b6\u6784\u5e08\u5efa\u8bae \u635f\u5931\u51fd\u6570 Softmax (\u5168\u5c40\u5f52\u4e00\u5316) Sigmoid (\u72ec\u7acb\u4e8c\u5206\u7c7b) Sigmoid \u663e\u5b58\u5229\u7528\u7387\u66f4\u9ad8\uff0c\u9002\u5408\u5927 Batch \u8bad\u7ec3 \u4e2d\u6587\u652f\u6301 \u5f31 (\u4e3b\u8981\u82f1\u6587) \u8f83\u597d (\u591a\u8bed\u8a00\u7248\u672c) \u5fc5\u987b\u9009\u7528\u591a\u8bed\u8a00 Checkpoint \u5206\u8fa8\u7387 \u901a\u5e38 224x224 \u652f\u6301\u52a8\u6001\u5206\u8fa8\u7387 \u590d\u6742\u56fe\u8868\u9009\u9ad8\u5206\u8fa8\u7387 (384+) \u6a21\u578b <p>\u5efa\u8bae\uff1a\u5728 2025 \u5e74\u6784\u5efa\u65b0\u7cfb\u7edf\uff0c\u4f18\u5148\u9009\u62e9 SigLIP \u6216 Meta \u7684 DINOv2\uff08\u7eaf\u89c6\u89c9\u7279\u5f81\u5f3a\uff09\u3002</p>"},{"location":"part5/5_2_mm_rag/#132-colpali-ocr","title":"13.2 ColPali \u67b6\u6784\u5b9e\u6218\uff1a\u7ec8\u7ed3 OCR \u7684\u5669\u68a6","text":"<p>\u5bf9\u4e8e PDF \u6587\u6863\u68c0\u7d22\uff0cCLIP \u6709\u4e00\u4e2a\u81f4\u547d\u5f31\u70b9\uff1a\u5b83\u64c5\u957f\u81ea\u7136\u56fe\u50cf\uff08\u732b\u3001\u72d7\u3001\u98ce\u666f\uff09\uff0c\u4f46\u5bf9\u5bcc\u6587\u672c\u56fe\u50cf\uff08\u5305\u542b\u5bc6\u96c6\u6587\u5b57\u3001\u8868\u683c\u7684\u6587\u6863\u9875\uff09\u7406\u89e3\u80fd\u529b\u6781\u5dee\u3002 \u4f20\u7edf\u505a\u6cd5\u662f <code>PDF -&gt; OCR -&gt; Text Embedding</code>\uff0c\u4f46 OCR \u4f1a\u4e22\u5931\u5e03\u5c40\u4fe1\u606f\uff0c\u4e14\u5bf9\u56fe\u8868\u675f\u624b\u65e0\u7b56\u3002</p> <p>ColPali (ColBERT + PaliGemma) \u63d0\u51fa\u4e86\u4e00\u79cd\u9769\u547d\u6027\u7684\u601d\u8def\uff1a\u4e0d\u8981 OCR\uff0c\u76f4\u63a5\u628a PDF \u9875\u9762\u5f53\u56fe\u770b\u3002</p>"},{"location":"part5/5_2_mm_rag/#1321","title":"13.2.1 \u6838\u5fc3\u539f\u7406\uff1a\u89c6\u89c9\u8bed\u8a00\u6a21\u578b\u7684\u665a\u671f\u4ea4\u4e92","text":"<p>ColPali \u7ed3\u5408\u4e86\u89c6\u89c9\u8bed\u8a00\u6a21\u578b\uff08VLM\uff09\u548c ColBERT \u7684\u68c0\u7d22\u673a\u5236\u3002</p> <ol> <li>Patch Embedding\uff1a\u5c06\u6587\u6863\u56fe\u50cf\u5207\u5206\u4e3a\u591a\u4e2a\u5c0f\u5757\uff08Patches\uff09\uff0c\u6bcf\u4e2a Patch \u751f\u6210\u4e00\u4e2a\u5411\u91cf\u3002\u4e00\u5f20\u56fe\u53ef\u80fd\u5bf9\u5e94 1024 \u4e2a\u5411\u91cf\u3002</li> <li>Late Interaction (MaxSim)\uff1a\u68c0\u7d22\u65f6\uff0c\u5c06\u7528\u6237 Query \u7684\u6bcf\u4e2a Token \u5411\u91cf\u4e0e\u6587\u6863\u7684\u6240\u6709 Patch \u5411\u91cf\u8fdb\u884c\u8ba1\u7b97\uff0c\u53d6\u6700\u5927\u76f8\u4f3c\u5ea6\u3002</li> </ol> <p></p> <p>\u56fe13-2\uff1aBad Case (\u5de6) vs Good Case (\u53f3) \u2014\u2014 \u5de6\u4fa7 OCR \u5c06\u8868\u683c\u8bc6\u522b\u4e3a\u4e71\u7801\u5b57\u7b26\uff1b\u53f3\u4fa7 ColPali \u76f4\u63a5\u5728\u56fe\u50cf\u5c42\u9762\u5bf9\u9f50\u4e86 Query \u4e0e\u8868\u683c\u884c</p>"},{"location":"part5/5_2_mm_rag/#133","title":"13.3 \u5de5\u7a0b\u5b9e\u73b0\uff1a\u6784\u5efa\u6df7\u5408\u591a\u6a21\u6001\u68c0\u7d22\u6d41\u6c34\u7ebf","text":"<p>\u672c\u8282\u6211\u4eec\u5c06\u5b9e\u73b0\u4e00\u4e2a\u517c\u5bb9 SigLIP\uff08\u81ea\u7136\u56fe\uff09 \u548c ColPali\uff08\u6587\u6863\u56fe\uff09 \u7684\u68c0\u7d22\u7cfb\u7edf\u6846\u67b6\u3002</p>"},{"location":"part5/5_2_mm_rag/#1331","title":"13.3.1 \u603b\u4f53\u67b6\u6784\u4e0e\u6570\u636e\u6d41","text":"<p>\u5728\u7f16\u5199\u4ee3\u7801\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u660e\u786e\u6570\u636e\u662f\u5982\u4f55\u6d41\u52a8\u7684\u3002\u8fd9\u4e0d\u518d\u662f\u7b80\u5355\u7684\u201c\u6587\u672c\u8fdb\uff0c\u6587\u672c\u51fa\u201d\u3002</p> <p></p> <p>\u56fe13-3\uff1aEnd-to-End Pipeline \u2014\u2014 \u5de6\u4fa7\u4e3a\u5165\u5e93\u6d41\u7a0b\uff08PDF\u8f6c\u56fe -&gt; Vision Encoder -&gt; \u91cf\u5316 -&gt; \u5411\u91cf\u5e93\uff09\uff1b\u53f3\u4fa7\u4e3a\u68c0\u7d22\u6d41\u7a0b\uff08Query -&gt; Text Encoder -&gt; MaxSim \u6253\u5206 -&gt; Re-rank\uff09</p>"},{"location":"part5/5_2_mm_rag/#1332","title":"13.3.2 \u6838\u5fc3\u4ee3\u7801\uff1a\u591a\u6a21\u6001\u7d22\u5f15\u4e0e\u6253\u5206","text":"<p>\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a <code>MultimodalIndexer</code>\u3002\u4e3a\u4e86\u8ba9\u7cfb\u7edf\u5177\u5907\u5b9e\u6218\u80fd\u529b\uff0c\u6211\u4eec\u4e0d\u4ec5\u8981\u5199\u201c\u5411\u91cf\u5316\uff08Embedding\uff09\u201d\u903b\u8f91\uff0c\u66f4\u8981\u663e\u5f0f\u5b9e\u73b0\u201c\u6253\u5206\uff08Scoring\uff09\u201d\u903b\u8f91\uff0c\u56e0\u4e3a ColPali \u7684\u68c0\u7d22\u4e0d\u80fd\u7b80\u5355\u4f9d\u8d56\u5411\u91cf\u6570\u636e\u5e93\u7684 Cosine Similarity\u3002</p> <pre><code>import torch\nfrom PIL import Image\nfrom transformers import AutoProcessor, AutoModel, SiglipProcessor, SiglipModel\nfrom typing import List, Union\nimport numpy as np\n\nclass MultimodalIndexer:\n    \"\"\"\n    \u591a\u6a21\u6001\u7d22\u5f15\u5668\uff1a\u7edf\u4e00\u5c01\u88c5 SigLIP (\u81ea\u7136\u56fe) \u548c ColPali (\u6587\u6863\u56fe)\n    \"\"\"\n    def __init__(self, use_colpali: bool = False):\n        self.device = \"cuda\" if torch.cuda.is_available() else \"cpu\"\n        self.use_colpali = use_colpali\n\n        if self.use_colpali:\n             # [\u5173\u952e\u51b3\u7b56] \u4f7f\u7528 Merged \u7248\u672c\uff08\u5c06\u89c6\u89c9\u7f16\u7801\u5668\u548c\u8bed\u8a00\u6a21\u578b\u7b49\u7ec4\u4ef6\u5408\u5e76\u4e3a\u5355\u4e00 checkpoint\uff09\n             # \u8fd9\u6837\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u7edf\u4e00\u7684\u6a21\u578b\u6765\u52a0\u8f7d\u4e0e\u90e8\u7f72\uff0c\u4ece\u800c\u7b80\u5316\u63a8\u7406\u4e0e\u5de5\u7a0b\u96c6\u6210\u903b\u8f91\n            from colpali_engine.models import ColPali\n            from colpali_engine.utils.processing_utils import ColPaliProcessor\n\n            model_name = \"vidore/colpali-v1.2-merged\"\n            print(f\"Loading ColPali model: {model_name}...\")\n\n            self.model = ColPali.from_pretrained(\n                model_name, \n                torch_dtype=torch.bfloat16, \n                device_map=self.device\n            )\n            self.processor = ColPaliProcessor.from_pretrained(model_name)\n        else:\n            # \u52a0\u8f7d SigLIP\n            model_name = \"google/siglip-so400m-patch14-384\"\n            print(f\"Loading SigLIP model: {model_name}...\")\n            self.model = SiglipModel.from_pretrained(model_name).to(self.device)\n            self.processor = SiglipProcessor.from_pretrained(model_name)\n\n    def embed_images(self, image_paths: List[str]) -&gt; Union[np.ndarray, List[torch.Tensor]]:\n        \"\"\"Step 1: \u56fe\u7247\u5411\u91cf\u5316\"\"\"\n        images = [Image.open(p).convert(\"RGB\") for p in image_paths]\n        with torch.no_grad():\n            if self.use_colpali:\n                # ColPali: \u8fd4\u56de List[Tensor], \u6bcf\u4e2a Tensor \u5f62\u72b6\u4e3a (Num_Patches, 128)\n                batch_images = self.processor.process_images(images).to(self.device)\n                embeddings = self.model(**batch_images) \n                return list(embeddings) \n            else:\n                # SigLIP: \u8fd4\u56de (Batch, Hidden_Dim)\n                inputs = self.processor(images=images, return_tensors=\"pt\").to(self.device)\n                features = self.model.get_image_features(**inputs)\n                return (features / features.norm(p=2, dim=-1, keepdim=True)).cpu().numpy()\n\n    def embed_query(self, text: str):\n        \"\"\"Step 2: \u67e5\u8be2\u6587\u672c\u5411\u91cf\u5316\"\"\"\n        with torch.no_grad():\n            if self.use_colpali:\n                batch_text = self.processor.process_queries([text]).to(self.device)\n                return self.model(**batch_text) # \u8fd4\u56de (1, Query_Tokens, 128)\n            else:\n                inputs = self.processor(text=[text], return_tensors=\"pt\").to(self.device)\n                features = self.model.get_text_features(**inputs)\n                return features / features.norm(p=2, dim=-1, keepdim=True)\n\n    def score_colpali(self, query_emb: torch.Tensor, doc_embeddings_list: List[torch.Tensor]) -&gt; List[float]:\n        \"\"\"\n        Step 3: ColPali \u6838\u5fc3\u6253\u5206\u903b\u8f91 (Late Interaction / MaxSim)\n\n        Args:\n            query_emb: (1, Q_Tokens, Dim)\n            doc_embeddings_list: List of (D_Tokens, Dim) - \u6bcf\u9875 Patch \u6570\u53ef\u80fd\u4e0d\u540c\n        \"\"\"\n        scores = []\n        # \u79fb\u9664 Query \u7684 batch \u7ef4\u5ea6 -&gt; (Q_Tokens, Dim)\n        Q = query_emb.squeeze(0) \n\n        for D in doc_embeddings_list:\n            # 1. \u8ba1\u7b97\u4ea4\u4e92\u77e9\u9635 (Interaction Matrix): \n            # (Q_Tokens, Dim) @ (Dim, D_Tokens) -&gt; (Q_Tokens, D_Tokens)\n            # \u8fd9\u91cc\u4f7f\u7528 einsum \u66f4\u6e05\u6670\uff1aq=query tokens, d=doc patches, h=hidden dim\n            sim_matrix = torch.einsum(\"qh,dh-&gt;qd\", Q, D)\n\n            # 2. MaxSim: \u5bf9\u6bcf\u4e2a Query Token\uff0c\u5728\u6587\u6863\u6240\u6709 Patch \u4e2d\u627e\u6700\u76f8\u4f3c\u7684\n            max_sim_per_token = sim_matrix.max(dim=1).values\n\n            # 3. Sum: \u5c06\u6240\u6709 Query Token \u7684\u6700\u5927\u76f8\u4f3c\u5ea6\u6c42\u548c\uff0c\u5f97\u5230\u6700\u7ec8\u5206\u6570\n            score = max_sim_per_token.sum()\n            scores.append(score.item())\n\n        return scores\n\n# --- Usage Example ---\nif __name__ == \"__main__\":\n    indexer = MultimodalIndexer(use_colpali=True)\n    # \u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u6709\u4e86 embedding\n    # scores = indexer.score_colpali(q_emb, [doc_emb1, doc_emb2])\n    # top_k = np.argsort(scores)[::-1]\n</code></pre>"},{"location":"part5/5_2_mm_rag/#1333-binary-quantization","title":"13.3.3 \u6027\u80fd\u4f18\u5316\uff1a\u4e8c\u8fdb\u5236\u91cf\u5316 (Binary Quantization)","text":"<p>ColPali \u6700\u5927\u7684\u5de5\u7a0b\u75db\u70b9\u662f\u5b58\u50a8\u7206\u70b8\u3002</p> <ul> <li>\u4f20\u7edf Embedding: 1 \u9875 = 1 \u5411\u91cf (4KB float32)\u3002</li> <li>ColPali: 1 \u9875 = 1032 \u5411\u91cf (512KB float16)\u3002</li> </ul> <p>\u5982\u679c\u7d22\u5f15 100 \u4e07\u9875 PDF\uff0c\u4f60\u9700\u8981 500GB \u663e\u5b58\uff0c\u8fd9\u5728\u5de5\u7a0b\u5b9e\u8df5\u4e2d\u901a\u5e38\u662f\u4e0d\u53ef\u63a5\u53d7\u7684\u3002</p> <p>\u89e3\u51b3\u65b9\u6848\uff1a\u4f7f\u7528\u4e8c\u8fdb\u5236\u91cf\u5316\uff08Binary Quantization\uff09\uff0c\u5c06 float16 \u538b\u7f29\u4e3a 1-bit\u3002</p> <pre><code>def quantize_embeddings(embeddings: torch.Tensor) -&gt; torch.Tensor:\n    \"\"\"\n    \u539f\u7406\uff1a\u5927\u4e8e 0 \u7684\u7f6e\u4e3a 1\uff0c\u5c0f\u4e8e\u7b49\u4e8e 0 \u7684\u7f6e\u4e3a 0\u3002\n    \u5b58\u50a8\u538b\u7f29\u7387\uff1a32x (float32 -&gt; int1)\n    \u7cbe\u5ea6\u635f\u5931\uff1aRecall@5 \u4e0b\u964d\u4e0d\u5230 2%\n    \"\"\"\n    # \u7b80\u5355\u7684\u4e8c\u503c\u5316\n    binary_emb = (embeddings &gt; 0).float() \n\n    # \u5b9e\u9645\u5b58\u50a8\u65f6\u53ef\u4ee5\u4f7f\u7528 packbits \u538b\u7f29\u4e3a uint8\n    # packed = np.packbits(binary_emb.cpu().numpy().astype(np.uint8), axis=-1)\n\n    return binary_emb\n\ndef score_binary(query_emb, binary_doc_emb):\n    \"\"\"\n    \u4e8c\u8fdb\u5236\u5411\u91cf\u7684\u6253\u5206\u901a\u5e38\u4f7f\u7528 Hamming Distance \u6216 Bitwise Operations\n    \u4f46\u5728 ColPali \u4e2d\uff0c\u901a\u5e38\u4fdd\u7559 Query \u4e3a float\uff0c\u53ea\u91cf\u5316 Doc\uff0c\n    \u6b64\u65f6\u70b9\u79ef\u8ba1\u7b97\u53d8\u6210\u7b80\u5355\u7684\u52a0\u51cf\u6cd5\uff0c\u6781\u5927\u52a0\u901f\u8ba1\u7b97\u3002\n    \"\"\"\n    pass \n</code></pre> <p>\u67b6\u6784\u51b3\u7b56\uff1a\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5efa\u8bae\u4f7f\u7528\u652f\u6301 Binary Vector \u7684\u6570\u636e\u5e93\uff08\u5982 Qdrant, Vespa\uff09\u6216\u4e13\u7528\u7d22\u5f15\u5e93\uff08\u5982 USearch\uff09\uff0c\u5b83\u4eec\u80fd\u5728\u5e95\u5c42\u76f4\u63a5\u5229\u7528 CPU \u6307\u4ee4\u96c6\uff08AVX-512 POPCNT\uff09\u8fdb\u884c\u6781\u901f\u5339\u914d\u3002</p>"},{"location":"part5/5_2_mm_rag/#134-performance-evaluation","title":"13.4 \u6027\u80fd\u4e0e\u8bc4\u4f30 (Performance &amp; Evaluation)","text":"<p>\u591a\u6a21\u6001 RAG \u4e0d\u4ec5\u8981\u770b\u201c\u627e\u5f97\u5bf9\u4e0d\u5bf9\u201d\uff0c\u8fd8\u8981\u770b\u201c\u56e0\u4e3a\u4ec0\u4e48\u627e\u5230\u7684\u201d\u3002</p>"},{"location":"part5/5_2_mm_rag/#1341","title":"13.4.1 \u8bc4\u4ef7\u6307\u6807","text":"\u6307\u6807 \u9002\u7528\u573a\u666f \u8bf4\u660e Recall@K \u901a\u7528\u68c0\u7d22 \u524d K \u4e2a\u7ed3\u679c\u4e2d\u5305\u542b\u6b63\u786e\u56fe\u7247\u7684\u6982\u7387\u3002 NDCG@10 \u6392\u5e8f\u8d28\u91cf \u8d8a\u76f8\u5173\u7684\u56fe\u7247\u6392\u5728\u8d8a\u524d\u9762\u5f97\u5206\u8d8a\u9ad8\u3002 OCR-Free Efficiency ColPali \u573a\u666f \u76f8\u6bd4 OCR + Dense Retrieval \u65b9\u6848\u7684\u65f6\u95f4/\u6210\u672c\u8282\u7701\u6bd4\u7387\u3002"},{"location":"part5/5_2_mm_rag/#1342-benchmarks","title":"13.4.2 \u57fa\u51c6\u6d4b\u8bd5 (Benchmarks)","text":"<ul> <li>\u6d4b\u8bd5\u73af\u5883\uff1a Intel Xeon Gold 6226R, NVIDIA RTX 3090 \u3002</li> <li>\u6570\u636e\u96c6\uff1aViDoRe Benchmark\uff08\u5305\u542b\u590d\u6742\u8d22\u52a1\u62a5\u8868\uff09\u3002</li> </ul>"},{"location":"part5/5_2_mm_rag/#1-recall5","title":"1. \u51c6\u786e\u7387\u5bf9\u6bd4 (Recall@5)","text":"<ul> <li>Unstructured OCR + BGE-M3: 43% (\u8868\u683c\u7ed3\u6784\u4e22\u5931\u662f\u4e3b\u56e0)\u3002</li> <li>ColPali v1.2: 81% (\u76f4\u63a5\u7406\u89e3\u89c6\u89c9\u5e03\u5c40)\u3002</li> </ul>"},{"location":"part5/5_2_mm_rag/#2-latency","title":"2. \u5ef6\u8fdf\u5bf9\u6bd4 (Latency)","text":"<ul> <li>SigLIP (Dense): &lt; 20ms / query\u3002</li> <li>ColPali (Late Interaction): ~150ms / query\u3002</li> </ul> <p>\u7ed3\u8bba\uff1aColPali \u9002\u5408\u505a Re-rank \u6216\u9ad8\u8d28\u91cf\u68c0\u7d22\uff0c\u6d77\u91cf\u6570\u636e\u9700\u914d\u5408\u91cf\u5316\u4f7f\u7528\u3002</p>"},{"location":"part5/5_2_mm_rag/#1343","title":"13.4.3 \u53ef\u89e3\u91ca\u6027\uff1a\u6a21\u578b\u5230\u5e95\u5728\u770b\u54ea\u91cc\uff1f","text":"<p>ColPali \u7684\u53e6\u4e00\u5927\u4f18\u52bf\u662f\u53ef\u89e3\u91ca\u6027\u3002\u901a\u8fc7\u5c06 MaxSim \u8ba1\u7b97\u4e2d\u7684\u4ea4\u4e92\u77e9\u9635\u53ef\u89c6\u5316\uff0c\u6211\u4eec\u53ef\u4ee5\u751f\u6210\u70ed\u529b\u56fe\uff0c\u786e\u5207\u77e5\u9053\u6a21\u578b\u5173\u6ce8\u7684\u662f\u6587\u6863\u7684\u54ea\u4e00\u90e8\u5206\u3002</p>"},{"location":"part5/5_2_mm_rag/#135","title":"13.5 \u5e38\u89c1\u8bef\u533a\u4e0e\u907f\u5751\u6307\u5357","text":"<ul> <li>\u8bef\u533a\u4e00\uff1a\u201c\u6240\u6709\u56fe\u7247\u90fd\u503c\u5f97\u7d22\u5f15\u201d</li> <li>\u7f51\u9875\u6216\u6587\u6863\u4e2d\u7684 Icon\u3001\u88c5\u9970\u6027\u7ebf\u6761\u3001\u9875\u7709\u9875\u811a\u7684 Logo \u4f1a\u4ea7\u751f\u5927\u91cf\u566a\u97f3\u3002</li> <li> <p>\u4fee\u6b63\uff1a\u5728\u5165\u5e93\u524d\u589e\u52a0\u4e00\u4e2a\u201c\u5783\u573e\u56fe\u7247\u5206\u7c7b\u5668\u201d\u6216\u57fa\u4e8e\u89c4\u5219\u7684\u8fc7\u6ee4\u5668\uff08\u5982\u4e22\u5f03 &lt; 5KB \u6216\u957f\u5bbd\u6bd4\u6781\u7aef\u7684\u56fe\u7247\uff09\u3002</p> </li> <li> <p>\u8bef\u533a\u4e8c\uff1a\u201c\u5ffd\u89c6 Embedding \u7ef4\u5ea6\u7206\u70b8\u201d</p> </li> <li>\u4e0d\u8981\u5929\u771f\u5730\u628a ColPali \u7684\u6240\u6709\u5411\u91cf\u76f4\u63a5\u5b58\u5165\u5e38\u89c4 PGVector\u3002</li> <li> <p>\u4fee\u6b63\uff1a\u5fc5\u987b\u5b9e\u65bd 13.3.3 \u4e2d\u7684\u4e8c\u8fdb\u5236\u91cf\u5316\u3002\u6216\u8005\uff0c\u4ec5\u5bf9\u590d\u6742\u7684\u201c\u5173\u952e\u9875\u201d\u4f7f\u7528 ColPali\uff0c\u666e\u901a\u6587\u672c\u9875\u4f9d\u7136\u4f7f\u7528 BGE/OpenAI Embedding\uff0c\u6784\u5efa\u6df7\u5408\u7d22\u5f15\u3002</p> </li> <li> <p>\u8bef\u533a\u4e09\uff1a\u201c\u76f4\u63a5\u7528 CLIP \u505a OCR \u66ff\u4ee3\u54c1\u201d</p> </li> <li>CLIP \u77e5\u9053\u56fe\u7247\u91cc\u6709\u201c\u6587\u5b57\u201d\uff0c\u4f46\u5b83\u8bfb\u4e0d\u61c2\u957f\u6587\u672c\u3002\u5982\u679c\u4f60\u95ee\u5b83\u201c\u5408\u540c\u91cc\u7684\u7532\u65b9\u662f\u8c01\uff1f\u201d\uff0c\u6807\u51c6 CLIP \u901a\u5e38\u56de\u7b54\u4e0d\u4e86\u3002</li> <li>\u4fee\u6b63\uff1a\u5bf9\u4e8e\u6587\u5b57\u5bc6\u96c6\u578b\u4e14\u65e0\u590d\u6742\u6392\u7248\u7684\u56fe\u7247\uff0cOCR + LLM \u4f9d\u7136\u662f\u6027\u4ef7\u6bd4\u6700\u9ad8\u7684\u65b9\u6848\uff1bColPali \u9002\u7528\u4e8e\u201c\u6392\u7248\u5373\u8bed\u4e49\u201d\u7684\u573a\u666f\uff08\u5982\u590d\u6742\u7684\u5d4c\u5957\u8868\u683c\uff09\u3002</li> </ul>"},{"location":"part5/5_2_mm_rag/#_3","title":"\u672c\u7ae0\u5c0f\u7ed3","text":"<p>\u591a\u6a21\u6001 RAG \u5c06\u6211\u4eec\u7684\u89c6\u91ce\u4ece\u4e00\u7ef4\u7684\u6587\u672c\u6269\u5c55\u5230\u4e86\u4e8c\u7ef4\u7684\u89c6\u89c9\u7a7a\u95f4\u3002</p> <ul> <li>\u67b6\u6784\uff1a\u91c7\u7528 SigLIP \u5904\u7406\u81ea\u7136\u56fe\uff0cColPali \u5904\u7406\u6587\u6863\u56fe\u3002</li> <li>\u4ee3\u7801\uff1a\u6838\u5fc3\u5728\u4e8e MaxSim \u7684\u4ea4\u4e92\u5f0f\u6253\u5206\uff0c\u800c\u975e\u7b80\u5355\u7684\u70b9\u79ef\u3002</li> <li>\u4f18\u5316\uff1a\u4e8c\u8fdb\u5236\u91cf\u5316 (BQ) \u662f\u591a\u6a21\u6001 RAG \u80fd\u591f\u5927\u89c4\u6a21\u4e0a\u7ebf\u7684\u5173\u952e\u6280\u672f\u3002</li> </ul> <p>\u638c\u63e1\u4e86\u8fd9\u4e00\u7ae0\uff0c\u4f60\u7684 RAG \u7cfb\u7edf\u5c31\u4e0d\u518d\u662f\u4e00\u4e2a\u201c\u778e\u5b50\u201d\uff0c\u800c\u662f\u4e00\u4e2a\u80fd\u591f\u8bfb\u56fe\u8868\u3001\u770b\u7814\u62a5\u7684\u201c\u5168\u80fd\u4e13\u5bb6\u201d\u3002</p>"},{"location":"part5/5_2_mm_rag/#_4","title":"\u5ef6\u4f38\u9605\u8bfb","text":"<ul> <li>\u8bba\u6587\uff1aColPali: Efficient Document Retrieval with Vision Language Models (2024)\u3002</li> <li>\u5de5\u5177\uff1a<code>colpali_engine</code> \u5b98\u65b9\u5e93\uff0c\u5173\u6ce8\u5176\u5bf9 Qdrant/Weaviate \u7684\u539f\u751f\u652f\u6301\u66f4\u65b0\u3002</li> <li>\u8fdb\u9636\uff1a\u4e86\u89e3 Matryoshka Representation Learning (MRL)\uff0c\u8fdb\u4e00\u6b65\u538b\u7f29\u5411\u91cf\u7ef4\u5ea6\u3002</li> </ul>"},{"location":"part6/6_1_mini_c4/","title":"\u9879\u76ee\u4e00\uff1a\u6784\u5efaMini-C4\u9884\u8bad\u7ec3\u96c6","text":""},{"location":"part6/6_1_mini_c4/#ray-mini-c4-distributed-mini-c4","title":"\u9879\u76ee\u4e00\uff1a\u57fa\u4e8e Ray \u6784\u5efa\u5206\u5e03\u5f0f Mini-C4 \u6570\u636e\u6d41\u6c34\u7ebf (Distributed Mini-C4)","text":""},{"location":"part6/6_1_mini_c4/#1-project-brief","title":"1. \u9879\u76ee\u80cc\u666f (Project Brief)","text":"<ul> <li>\u4efb\u52a1\u5b9a\u4e49\uff1a \u6784\u5efa\u4e00\u4e2a\u5fae\u7f29\u7248 C4 (Colossal Clean Crawled Corpus) \u6570\u636e\u96c6\u6d41\u6c34\u7ebf\u3002\u6211\u4eec\u7684\u76ee\u6807\u662f\u5c06\u6742\u4e71\u65e0\u7ae0\u7684\u539f\u59cb\u7f51\u9875\u6570\u636e\uff08Common Crawl\uff09\u8f6c\u5316\u4e3a\u4f4e\u566a\u3001\u53bb\u91cd\u3001\u9ad8\u8d28\u91cf\u7684\u7eaf\u6587\u672c\u6570\u636e\uff0c\u4f7f\u5176\u8fbe\u5230\u53ef\u4ee5\u76f4\u63a5\u8f93\u5165 LLM \u8fdb\u884c\u9884\u8bad\u7ec3\u7684\u6807\u51c6\u3002</li> <li>\u8f93\u5165\u4e0e\u8f93\u51fa\uff1a<ul> <li>Input: Common Crawl \u7684\u539f\u59cb WARC \u538b\u7f29\u5305\uff08<code>.warc.gz</code>\uff09\uff0c\u5305\u542b HTTP \u54cd\u5e94\u5934\u3001HTML \u6e90\u7801\u3001\u4e71\u7801\u53ca\u4e8c\u8fdb\u5236\u6570\u636e\u3002</li> <li>Output: \u5206\u7c7b\u5206\u7ea7\u540e\u7684 JSONL \u6587\u4ef6\uff08<code>final_data.jsonl</code>\uff09\uff0c\u5305\u542b\u7eaf\u51c0\u6587\u672c\u3001\u8bed\u8a00\u6807\u7b7e\u53ca\u56f0\u60d1\u5ea6\uff08Perplexity\uff09\u8bc4\u5206\u3002</li> </ul> </li> <li>\u96be\u70b9\u5206\u6790\uff1a<ul> <li>\u4fe1\u566a\u6bd4\u6781\u4f4e\uff1a \u539f\u59cb\u7f51\u9875\u4e2d 90% \u4ee5\u4e0a\u662f\u5bfc\u822a\u680f\u3001\u5e7f\u544a\u3001SEO \u5173\u952e\u8bcd\u5806\u780c\u3001JavaScript \u4ee3\u7801\u548c\u65e0\u610f\u4e49\u7684\u5360\u4f4d\u7b26\u3002</li> <li>\u53bb\u91cd\u590d\u6742\u5ea6\uff1a \u5728\u6d77\u91cf\u6587\u672c\u4e2d\u627e\u51fa\u201c\u8bed\u4e49\u91cd\u590d\u201d\u800c\u975e\u201c\u5b8c\u5168\u4e00\u81f4\u201d\u7684\u6587\u6863\uff08Fuzzy Deduplication\uff09\uff0c\u8ba1\u7b97\u91cf\u5448\u6307\u6570\u7ea7\u589e\u957f\u3002</li> <li>\u8d28\u91cf\u91cf\u5316\uff1a \u5982\u4f55\u4e0d\u4f9d\u8d56\u6602\u8d35\u7684 API\uff08\u5982 GPT-4 \u6253\u5206\uff09\uff0c\u4ec5\u51ed\u7edf\u8ba1\u5b66\u65b9\u6cd5\u81ea\u52a8\u5224\u65ad\u4e00\u53e5\u8bdd\u662f\u201c\u4eba\u7c7b\u9ad8\u8d28\u91cf\u8bed\u8a00\u201d\u8fd8\u662f\u201c\u673a\u5668\u751f\u6210\u7684\u5783\u573e\u201d\uff1f</li> </ul> </li> </ul>"},{"location":"part6/6_1_mini_c4/#2-architecture-design","title":"2. \u67b6\u6784\u8bbe\u8ba1 (Architecture Design)","text":"<p>\u4e3a\u4e86\u5904\u7406\u975e\u7ed3\u6784\u5316\u7684 Web \u6570\u636e\uff0c\u6211\u4eec\u8bbe\u8ba1\u4e86\u5982\u4e0b\u7684\u6f0f\u6597\u578b\uff08Funnel\uff09\u5904\u7406\u67b6\u6784\uff0c\u5c42\u5c42\u8fc7\u6ee4\u566a\u58f0\uff1a</p> <p>\u6570\u636e\u6d41\u6c34\u7ebf\u56fe\uff1a</p> <p></p> <p>(\u56fe\u6ce8\uff1a\u6570\u636e\u6d41\u5411\u4e3a Raw WARC -&gt; Text Extraction -&gt; Heuristic Filtering -&gt; MinHash Deduplication -&gt; LangID &amp; PPL Filtering -&gt; Final Dataset)</p> <p>\u6280\u672f\u6808\u6e05\u5355\uff1a</p> \u7ec4\u4ef6 \u9009\u578b \u51b3\u7b56\u7406\u7531 \u4e0b\u8f7d/\u89e3\u6790 <code>warcio</code>, <code>trafilatura</code> <code>warcio</code> \u662f\u5904\u7406 WARC \u6807\u51c6\u7684\u5b98\u65b9\u5e93\uff1b<code>trafilatura</code> \u76f8\u6bd4 <code>BeautifulSoup</code>\uff0c\u5728\u63d0\u53d6\u6b63\u6587\uff08\u53bb\u9664\u5bfc\u822a/\u9875\u811a\uff09\u65b9\u9762\u6709\u663e\u8457\u4f18\u52bf\uff0c\u4e14\u901f\u5ea6\u66f4\u5feb\u3002 \u5206\u5e03\u5f0f\u8ba1\u7b97 <code>Ray</code> Python \u7684 <code>multiprocessing</code> \u5728\u5904\u7406\u5927\u89c4\u6a21\u6570\u636e\u5171\u4eab\u65f6\u5f00\u9500\u8f83\u5927\u3002<code>Ray</code> \u63d0\u4f9b\u4e86\u6781\u5176\u7b80\u5355\u7684 Actor \u6a21\u578b\uff0c\u80fd\u8ba9\u6211\u4eec\u7528\u51e0\u884c\u4ee3\u7801\u5c06 MinHash \u8ba1\u7b97\u5e76\u884c\u5316\u5230\u591a\u6838 CPU \u751a\u81f3\u96c6\u7fa4\u4e0a\u3002 \u53bb\u91cd\u7b97\u6cd5 <code>MinHash LSH</code> \u4f20\u7edf\u7684\u4e24\u4e24\u6bd4\u5bf9\u590d\u6742\u5ea6\u4e3a \\(O(N^2)\\)\uff0c\u65e0\u6cd5\u901a\u8fc7\u3002\u5229\u7528 LSH\uff08\u5c40\u90e8\u654f\u611f\u54c8\u5e0c\uff09\u5c06\u590d\u6742\u5ea6\u964d\u4e3a \\(O(N)\\)\uff0c\u4e14 <code>datasketch</code> \u5e93\u5b9e\u73b0\u4e86\u9ad8\u6548\u7684\u5185\u5b58\u7d22\u5f15\u3002 \u8d28\u91cf\u8bc4\u4f30 <code>KenLM</code> \u8f7b\u91cf\u7ea7 N-gram \u8bed\u8a00\u6a21\u578b\u5e93\u3002\u5728 GPT-3 \u548c CCNet \u8bba\u6587\u4e2d\uff0c\u5747\u4f7f\u7528 KenLM \u7684\u56f0\u60d1\u5ea6\uff08Perplexity\uff09\u4f5c\u4e3a\u8861\u91cf\u6587\u672c\u81ea\u7136\u5ea6\u7684\u6838\u5fc3\u6307\u6807\uff0c\u8ba1\u7b97\u901f\u5ea6\u6781\u5feb\uff08C++\u5e95\u5c42\uff09\u3002"},{"location":"part6/6_1_mini_c4/#3-step-by-step-implementation","title":"3. Step-by-Step \u5b9e\u6218 (Implementation)","text":""},{"location":"part6/6_1_mini_c4/#html-extraction-cleaning","title":"\u9636\u6bb5\u4e00\uff1a\u4ece HTML \u6ce5\u6f6d\u4e2d\u63d0\u53d6\u6b63\u6587 (Extraction &amp; Cleaning)","text":"<p>\u539f\u59cb WARC \u6587\u4ef6\u5305\u542b\u5927\u91cf\u975e\u6587\u672c\u566a\u58f0\u3002\u6211\u4eec\u9996\u5148\u4f7f\u7528 <code>warcio</code> \u6d41\u5f0f\u8bfb\u53d6\u538b\u7f29\u5305\uff0c\u5e76\u5229\u7528 <code>trafilatura</code> \u63d0\u53d6\u6838\u5fc3\u5185\u5bb9\u3002</p> <p>\u5173\u952e\u4ee3\u7801\u89e3\u6790\uff1a\u6d41\u5f0f\u5904\u7406\u4e0e\u89e3\u6790 \u5728 <code>2_process_warc.py</code> \u4e2d\uff0c\u6211\u4eec\u907f\u514d\u5c06\u6574\u4e2a WARC \u6587\u4ef6\u8bfb\u5165\u5185\u5b58\uff0c\u800c\u662f\u5229\u7528 <code>ArchiveIterator</code> \u8fdb\u884c\u6d41\u5f0f\u5904\u7406\uff1a</p> <pre><code>from warcio.archiveiterator import ArchiveIterator\nimport trafilatura\n\n# ... (\u7701\u7565\u6587\u4ef6\u6253\u5f00\u903b\u8f91)\nfor record in ArchiveIterator(stream):\n    if record.rec_type == 'response':\n        # 1. \u8fc7\u6ee4\u975e HTML \u5185\u5bb9\n        content_type = record.http_headers.get_header('Content-Type')\n        if not content_type or 'text/html' not in content_type:\n            continue\n\n        # 2. \u6838\u5fc3\u89e3\u6790\u903b\u8f91\n        # include_comments=False: \u53bb\u9664\u7f51\u53cb\u8bc4\u8bba\uff0c\u901a\u5e38\u8d28\u91cf\u8f83\u4f4e\n        # no_fallback=False: \u5141\u8bb8\u5c1d\u8bd5\u591a\u79cd\u89e3\u6790\u7b56\u7565\u4ee5\u63d0\u9ad8\u53ec\u56de\u7387\n        text = trafilatura.extract(\n            record.content_stream().read(), \n            include_comments=False, \n            include_tables=False, \n            no_fallback=False\n        )\n</code></pre> <p>\ud83d\udd0d \u542f\u53d1\u5f0f\u6e05\u6d17\u89c4\u5219 (Heuristic Rules) \u63d0\u53d6\u540e\u7684\u6587\u672c\u4ecd\u7136\u5305\u542b\u5927\u91cf\u201c\u5783\u573e\u201d\u3002\u5728 <code>3_clean_data.py</code> \u4e2d\uff0c\u6211\u4eec\u5b9e\u65bd\u4e86 Gopher \u548c C4 \u8bba\u6587\u4e2d\u7ecf\u5178\u7684\u542f\u53d1\u5f0f\u89c4\u5219\uff1a</p> <ol> <li>\u5e73\u5747\u8bcd\u957f\u8fc7\u6ee4\uff1a \u6b63\u5e38\u7684\u82f1\u8bed/\u4e2d\u6587\u6587\u672c\uff0c\u5e73\u5747\u8bcd\u957f\u5728\u56fa\u5b9a\u8303\u56f4\u5185\u3002\u5982\u679c\u5e73\u5747\u8bcd\u957f &gt; 15 \u5b57\u7b26\uff0c\u901a\u5e38\u662f\u4ee3\u7801 minified \u540e\u7684\u4ea7\u7269\u6216 URL \u5217\u8868\u3002</li> <li>\u7b26\u53f7\u5bc6\u5ea6 (Symbol Ratio)\uff1a \u7edf\u8ba1 <code>{ } [ ] &lt; &gt; \\</code> \u7b49\u4ee3\u7801\u7b26\u53f7\u7684\u5360\u6bd4\u3002\u5982\u679c\u8d85\u8fc7 10%\uff0c\u89c6\u4e3a\u4ee3\u7801\u7247\u6bb5\u3002</li> <li>\u9ed1\u540d\u5355 (Blocklist)\uff1a \u5305\u542b \"lorem ipsum\", \"enable cookies\" \u7b49\u65e0\u610f\u4e49\u5185\u5bb9\u7684\u6587\u672c\u76f4\u63a5\u4e22\u5f03\u3002</li> </ol> <pre><code># 3_clean_data.py \u6838\u5fc3\u7247\u6bb5\ndef is_high_quality(text):\n    # \u89c4\u5219: \u7b26\u53f7\u5bc6\u5ea6\u68c0\u67e5\n    code_symbols = {'{', '}', '[', ']', '&lt;', '&gt;', '\\\\'}\n    symbol_count = sum(1 for char in text if char in code_symbols)\n    if len(text) &gt; 0 and (symbol_count / len(text) &gt; 0.1): \n        return False # \u4ee3\u7801\u7b26\u53f7\u8fc7\u591a\n\n    # \u89c4\u5219: \u5173\u952e\u8bcd\u9ed1\u540d\u5355\n    bad_phrases = [\"lorem ipsum\", \"enable cookies\", \"403 forbidden\"]\n    if any(p in text.lower() for p in bad_phrases):\n        return False\n    return True\n</code></pre>"},{"location":"part6/6_1_mini_c4/#minhash-deduplication","title":"\u9636\u6bb5\u4e8c\uff1a\u5206\u5e03\u5f0f MinHash \u53bb\u91cd (Deduplication)","text":"<p>\u4e92\u8054\u7f51\u4e0a\u5b58\u5728\u5927\u91cf\u91cd\u590d\u5185\u5bb9\uff08\u8f6c\u8f7d\u3001\u955c\u50cf\uff09\u3002\u6211\u4eec\u4f7f\u7528 Ray \u5b9e\u73b0\u5e76\u884c\u7684 MinHash \u8ba1\u7b97\u3002</p> <p>\u5173\u952e\u4ee3\u7801\u89e3\u6790\uff1aRay Actor \u6a21\u5f0f \u5728 <code>4_deduplicate.py</code> \u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a Ray \u4efb\u52a1\u6765\u5e76\u884c\u8ba1\u7b97\u54c8\u5e0c\u7b7e\u540d\uff08Signature\uff09\uff0c\u4e3b\u8fdb\u7a0b\u53ea\u8d1f\u8d23\u6784\u5efa\u7d22\u5f15\u3002</p> <pre><code>import ray\nfrom datasketch import MinHash\n\n@ray.remote\ndef process_batch(lines, batch_id):\n    \"\"\"Ray Worker: \u5e76\u884c\u8ba1\u7b97\u4e00\u6279\u6570\u636e\u7684 MinHash \u6307\u7eb9\"\"\"\n    results = []\n    for line in lines:\n        item = json.loads(line)\n        m = MinHash(num_perm=128) # C4 \u6807\u51c6\u53c2\u6570\n        # Shingling: \u6309\u5355\u8bcd\u66f4\u65b0\u54c8\u5e0c\n        for w in item['text'].split():\n            m.update(w.encode('utf8'))\n        results.append((item['url'], m, item['text']))\n    return results\n\n# \u4e3b\u6d41\u7a0b\uff1aMap-Reduce \u98ce\u683c\n# Map: \u5c06\u6570\u636e\u5207\u5206 batch \u5206\u53d1\u7ed9\u6240\u6709 CPU \u6838\u5fc3\nfutures = [process_batch.remote(batch, i) for i, batch in enumerate(batches)]\n# Reduce: \u6536\u96c6\u7ed3\u679c\nresults = ray.get(futures)\n</code></pre> <p>\ud83d\udee0\ufe0f \u8c03\u8bd5\u4e0e\u8e29\u5751\u8bb0\u5f55 (Debugging)</p> <ul> <li>\u5e8f\u5217\u5316\u5f00\u9500\uff1a \u4f20\u9012\u5927\u91cf\u5c0f\u5bf9\u8c61\u7ed9 Ray \u4efb\u52a1\u4f1a\u4ea7\u751f\u5de8\u5927\u7684\u5e8f\u5217\u5316\u5f00\u9500\u3002</li> <li>Fix: \u5c06\u6570\u636e\u6253\u5305\u6210 <code>batch</code> (\u5982 1000 \u6761\u4e00\u7ec4) \u518d\u53d1\u9001\u7ed9 Worker\uff0c\u663e\u8457\u63d0\u5347\u4e86\u541e\u5410\u91cf\u3002</li> </ul>"},{"location":"part6/6_1_mini_c4/#quality-filtering","title":"\u9636\u6bb5\u4e09\uff1a\u8bed\u8a00\u8bc6\u522b\u4e0e\u56f0\u60d1\u5ea6\u8fc7\u6ee4 (Quality Filtering)","text":"<p>\u6e05\u6d17\u540e\u7684\u6570\u636e\u6df7\u5408\u4e86\u591a\u79cd\u8bed\u8a00\u4e14\u8d28\u91cf\u53c2\u5dee\u4e0d\u9f50\u3002\u6211\u4eec\u5148\u7528 FastText \u5206\u6d41\u8bed\u8a00\uff0c\u518d\u7528 KenLM \u8ba1\u7b97\u56f0\u60d1\u5ea6\uff08Perplexity\uff09\u3002</p> <p>\u5173\u952e\u4ee3\u7801\u89e3\u6790\uff1aKenLM \u5f52\u4e00\u5316\u5f97\u5206 \u56f0\u60d1\u5ea6\u8d8a\u4f4e\uff0c\u4ee3\u8868\u53e5\u5b50\u8d8a\u901a\u987a\u3002\u5728 <code>6_quality_filter.py</code> \u4e2d\uff0c\u6211\u4eec\u8ba1\u7b97 Log Score \u5e76\u6309\u957f\u5ea6\u5f52\u4e00\u5316\u3002</p> <pre><code>import kenlm\nimport fasttext\n\n# 1. \u8bed\u8a00\u5206\u6d41 (\u6765\u81ea 5_split_lang.py)\nlid_model = fasttext.load_model('lid.176.ftz')\ndef predict_lang(text):\n    # k=1 \u53d6\u6982\u7387\u6700\u9ad8\u7684\u8bed\u8a00\n    predictions = lid_model.predict(text, k=1)\n    return predictions[0][0].replace('__label__', '')\n\n# 2. \u56f0\u60d1\u5ea6\u8fc7\u6ee4 (\u6765\u81ea 6_quality_filter.py)\nkenlm_model = kenlm.Model('en.arpa.bin')\nPERPLEXITY_THRESHOLD = -6.0  # \u7ecf\u9a8c\u9608\u503c\uff1a\u4f4e\u4e8e\u6b64\u503c\u901a\u5e38\u4e3a\u4f4e\u8d28\u91cf\u6587\u672c\n\ndef filter_by_perplexity(text):\n    words = text.split()\n    # \u8ba1\u7b97\u5f52\u4e00\u5316\u5f97\u5206 (Log Score / Length)\n    # \u6ce8\u610f\uff1aKenLM \u8fd4\u56de\u7684\u662f log10 \u6982\u7387\uff0c\u6570\u503c\u901a\u5e38\u4e3a\u8d1f\n    log_score = model.score(text)\n    normalized_score = log_score / len(words)\n\n    # \u6bd4\u5982 -5.0 (\u9ad8\u8d28\u91cf) &gt; -6.0 (\u9608\u503c) -&gt; \u4fdd\u7559\n    if normalized_score &gt; PERPLEXITY_THRESHOLD:\n        return True, normalized_score\n    return False, normalized_score\n</code></pre> <p>\ud83d\udcc9 \u53c2\u6570\u8c03\u4f18\u7ecf\u9a8c \u6211\u4eec\u901a\u8fc7\u91c7\u6837\u89c2\u5bdf\u786e\u5b9a\u4e86 <code>-6.0</code> \u8fd9\u4e2a\u9608\u503c\uff1a</p> <ul> <li>Score &gt; -5.0: \u6781\u5176\u901a\u987a\u7684\u65b0\u95fb\u3001\u7ef4\u57fa\u767e\u79d1\u3002</li> <li>Score -5.0 ~ -6.0: \u666e\u901a\u7684\u535a\u5ba2\u3001\u8bba\u575b\u8ba8\u8bba\u3002</li> <li>Score &lt; -6.5: \u4e3b\u8981\u662f\u5173\u952e\u8bcd\u5217\u8868\u3001\u7834\u788e\u7684\u53e5\u5b50\u3001\u4e25\u91cd\u7684\u8bed\u6cd5\u9519\u8bef\uff08\u5982\u673a\u5668\u7ffb\u8bd1\u5931\u8d25\u7684\u7ed3\u679c\uff09\u3002</li> </ul>"},{"location":"part6/6_1_mini_c4/#4-showcase","title":"4. \u6548\u679c\u5c55\u793a (Showcase)","text":"<p>\u7ecf\u8fc7\u8fd9\u4e00\u5957 Pipeline \u5904\u7406\uff0c\u6570\u636e\u7684\u9762\u8c8c\u53d1\u751f\u4e86\u6839\u672c\u6027\u53d8\u5316\u3002\u4ee5\u4e0b\u662f\u57fa\u4e8e\u5355\u6b21 Crawl (\u7ea6 1GB WARC) \u7684\u5b9e\u9645\u5904\u7406\u7edf\u8ba1\uff1a</p> <p>\u6570\u636e\u6f0f\u6597\u7edf\u8ba1 (Data Funnel):</p> \u5904\u7406\u9636\u6bb5 \u8f93\u5165\u8bb0\u5f55\u6570 \u8f93\u51fa\u8bb0\u5f55\u6570 \u7559\u5b58\u7387 \u4e3b\u8981\u635f\u8017\u539f\u56e0 \u539f\u59cb WARC ~35,000 ~10,000 28% \u975e HTML \u54cd\u5e94\u3001\u7a7a\u5185\u5bb9\u3001Trafilatura \u89e3\u6790\u5931\u8d25 \u542f\u53d1\u5f0f\u6e05\u6d17 10,000 ~6,500 65% \u957f\u5ea6\u8fc7\u77ed\u3001\u7b26\u53f7\u5bc6\u5ea6\u8fc7\u9ad8\uff08\u4ee3\u7801\uff09\u3001\u9ed1\u540d\u5355 \u53bb\u91cd (LSH) 6,500 ~4,800 73% \u8f6c\u8f7d\u6587\u7ae0\u3001\u955c\u50cf\u7ad9\u70b9\u3001\u6a21\u677f\u6587\u5b57 \u8bed\u8a00/\u8d28\u91cf\u8fc7\u6ee4 4,800 ~3,900 81% \u975e\u82f1\u6587\u5185\u5bb9\u3001\u9ad8\u56f0\u60d1\u5ea6\uff08\u4e71\u7801/\u4e0d\u901a\u987a\uff09 Total 35,000 3,900 ~11% \u6700\u7ec8\u4ea7\u51fa\u7387\u4e3a 11% <p>Case Study: \u8fc7\u6ee4\u6548\u679c\u5bf9\u6bd4</p> <p>Case 1: \u5bfc\u822a\u680f\u566a\u58f0 (\u5df2\u53bb\u9664) Raw: \"Home | About Us | Contact | Enable Cookies | Copyright 2023...\" Result: [\u5df2\u4e22\u5f03] (\u89e6\u53d1\u77ed\u6587\u672c\u548c\u5173\u952e\u8bcd\u9ed1\u540d\u5355\u89c4\u5219)</p> <p>Case 2: \u4ee3\u7801\u7247\u6bb5 (\u5df2\u53bb\u9664) Raw: \"function(x) { return x &gt; 0 ? true : false; } var a = [1,2,3];\" Result: [\u5df2\u4e22\u5f03] (\u89e6\u53d1\u7b26\u53f7\u5bc6\u5ea6 &gt; 10% \u89c4\u5219)</p> <p>Case 3: \u9ad8\u8d28\u91cf\u6b63\u6587 (\u4fdd\u7559\u5e76\u8bc4\u5206) Raw: \"The James Webb Space Telescope has captured a new image of the Pillars of Creation...\" Result: [\u4fdd\u7559] KenLM Score: -4.82 (\u4f18\u4e8e\u9608\u503c -6.0)</p> <p>\u6570\u636e\u7edf\u8ba1\uff1a \u5728\u5355\u6b21 Crawl \u7684\u91c7\u6837\u6d4b\u8bd5\u4e2d\uff1a *   \u539f\u59cb\u8bb0\u5f55\uff1a 10,000 \u6761 *   \u63d0\u53d6\u6709\u6548\u6587\u672c\uff1a \u7ea6 4,500 \u6761 (HTML \u89e3\u6790\u635f\u8017) *   \u6e05\u6d17\u540e\u5269\u4f59\uff1a \u7ea6 2,800 \u6761 (\u542f\u53d1\u5f0f\u8fc7\u6ee4\u635f\u8017) *   \u53bb\u91cd\u540e\u5269\u4f59\uff1a \u7ea6 2,100 \u6761 (\u91cd\u590d\u7387\u7ea6 25%) *   \u6700\u7ec8\u9ad8\u8d28\u91cf\u96c6\uff1a \u7ea6 1,800 \u6761 (KenLM \u8fc7\u6ee4)</p>"},{"location":"part6/6_1_mini_c4/#5-cost-optimization","title":"5. \u6210\u672c\u4e0e\u4f18\u5316 (Cost &amp; Optimization)","text":""},{"location":"part6/6_1_mini_c4/#_1","title":"\u8d44\u6e90\u6d88\u8017","text":"<ul> <li>\u8ba1\u7b97\uff1a \u672c\u9879\u76ee\u4ee3\u7801\u5728\u5355\u673a 16\u6838 CPU\u300164G \u5185\u5b58\u73af\u5883\u4e0b\uff0c\u5904\u7406 1GB WARC \u6570\u636e\u8017\u65f6\u7ea6 5-8 \u5206\u949f\u3002</li> <li>\u74f6\u9888\uff1a <code>MinHashLSH</code> \u7684\u7d22\u5f15\u6784\u5efa\u76ee\u524d\u662f\u5355\u7ebf\u7a0b\u7684\uff08\u5728 <code>4_deduplicate.py</code> \u4e2d\uff09\uff0c\u4e14\u5b8c\u5168\u4f9d\u8d56\u5185\u5b58\u3002</li> </ul>"},{"location":"part6/6_1_mini_c4/#scaling-to-tbs","title":"\u6269\u5c55\u6027\u601d\u8003(Scaling to TBs)","text":"<p>\u5982\u679c\u6570\u636e\u91cf\u6269\u5927\u5230 PB \u7ea7\u522b\uff08\u5982\u771f\u5b9e\u7684 C4 \u6570\u636e\u96c6\uff09\uff0c\u5f53\u524d\u67b6\u6784\u9700\u8981\u8fdb\u884c\u4ee5\u4e0b\u5347\u7ea7\uff1a</p> <ol> <li> <p>LSH \u5b58\u50a8\u5206\u79bb\uff1a \u5185\u5b58\u65e0\u6cd5\u88c5\u4e0b\u4ebf\u7ea7\u522b\u7684 Hash \u7d22\u5f15\u3002\u9700\u5c06 <code>MinHashLSH</code> \u6539\u4e3a\u4f7f\u7528 Redis \u6216 Cassandra \u6301\u4e45\u5316\u5b58\u50a8\u54c8\u5e0c\u6876\u3002</p> </li> <li> <p>\u5e76\u884c\u7b56\u7565\u5347\u7ea7\uff1a \u5c06 Ray \u4efb\u52a1\u4ece\u201c\u5355\u673a\u591a\u6838\u201d\u6269\u5c55\u5230\u201c\u591a\u673a\u96c6\u7fa4\u201d\u3002Worker \u8282\u70b9\u53ea\u8d1f\u8d23\u8ba1\u7b97 Hash\uff0cMaster \u8282\u70b9\u6216\u6570\u636e\u5e93\u8d1f\u8d23\u51b2\u7a81\u68c0\u6d4b\u3002</p> </li> <li> <p>IO \u4f18\u5316\uff1a \u6570\u636e\u8bfb\u53d6\u9700\u4ece\u672c\u5730\u6587\u4ef6\u7cfb\u7edf\u8fc1\u79fb\u81f3 S3/MinIO\uff0c\u5e76\u4f7f\u7528 PyArrow \u8fdb\u884c\u6d41\u5f0f\u5217\u5b58\u5904\u7406\uff0c\u51cf\u5c11 Python \u5bf9\u8c61\u5f00\u9500\u3002</p> </li> <li> <p>CCNet \u65b9\u6848\uff1a \u5bf9\u4e8e\u8d85\u5927\u89c4\u6a21\u53bb\u91cd\uff0c\u53ef\u4ee5\u53c2\u8003 CCNet \u7684\u505a\u6cd5\uff0c\u5148\u5c06\u6587\u4ef6\u6309 Hash \u503c\u5206\u6876\uff08Sharding\uff09\uff0c\u5728\u6876\u5185\u8fdb\u884c\u5c40\u90e8\u53bb\u91cd\uff0c\u518d\u8fdb\u884c\u5168\u5c40\u5408\u5e76\u3002</p> </li> </ol>"},{"location":"part6/6_2_legal_sft/","title":"\u9879\u76ee\u4e8c\uff1a\u5782\u76f4\u9886\u57df\u4e13\u5bb6SFT","text":""},{"location":"part6/6_2_legal_sft/#sft","title":"\u9879\u76ee\u4e8c\uff1a\u5782\u76f4\u9886\u57df\u4e13\u5bb6 SFT (\u6cd5\u5f8b)","text":"<p>\u573a\u666f\uff1a\u57fa\u4e8e\u975e\u7ed3\u6784\u5316 PDF \u6587\u6863\u6784\u5efa\u884c\u4e1a\u4e13\u5bb6\u5fae\u8c03\u6570\u636e\u3002 \u6838\u5fc3\u6280\u672f\uff1aSelf-Instruct \u6784\u9020\u6307\u4ee4\u3001CoT \u63a8\u7406\u589e\u5f3a\u3001\u52a0\u6743\u8f6e\u76d8\u8d4c\u91c7\u6837\u3002 \u8f93\u51fa\uff1a<code>domain_expert.jsonl</code> \u6307\u4ee4\u5fae\u8c03\u96c6\u3002</p>"},{"location":"part6/6_2_legal_sft/#1-project-brief","title":"1. \u9879\u76ee\u80cc\u666f (Project Brief)","text":"<ul> <li>\u4efb\u52a1\u5b9a\u4e49\uff1a \u672c\u9879\u76ee\u65e8\u5728\u4ece\u975e\u7ed3\u6784\u5316\u7684\u6cd5\u5f8b\u6cd5\u89c4 PDF \u6587\u6863\uff08\u5982\u300a\u6c11\u6cd5\u5178\u300b\u3001\u300a\u5211\u6cd5\u300b\uff09\u4e2d\u63d0\u53d6\u77e5\u8bc6\uff0c\u5229\u7528\u5927\u6a21\u578b Self-Instruct \u6280\u672f\u6784\u5efa\u5177\u5907\u201c\u601d\u7ef4\u94fe\uff08Chain of Thought, CoT\uff09\u201d\u80fd\u529b\u7684\u5782\u76f4\u9886\u57df\u6307\u4ee4\u5fae\u8c03\u6570\u636e\u96c6\u3002</li> <li>\u8f93\u5165\u4e0e\u8f93\u51fa\uff1a<ul> <li>Input: \u539f\u59cb PDF \u6587\u6863\uff08\u5305\u542b\u9875\u7709\u3001\u9875\u811a\u3001\u6c34\u5370\u5e72\u6270\u3001\u4ee5\u53ca\u88ab\u6362\u884c\u7b26\u5207\u65ad\u7684\u4e2d\u6587\u8bcd\u6c47\uff09\u3002</li> <li>Output: <code>domain_expert.jsonl</code>\uff0c\u5305\u542b <code>Instruction</code>\uff08\u7528\u6237\u6307\u4ee4\uff09\u4e0e <code>Output</code>\uff08\u5305\u542b\u663e\u5f0f\u601d\u8003\u8fc7\u7a0b\u7684\u4e13\u5bb6\u56de\u590d\uff09\u3002</li> </ul> </li> <li>\u96be\u70b9\u5206\u6790\uff1a<ul> <li>\u201c\u810f\u201d\u6570\u636e\u7684\u6e05\u6d17\uff1a\uff1a\u6cd5\u5f8b\u6587\u6863\u6781\u5176\u4e25\u8c28\uff0c\u4f46 PDF \u89e3\u6790\u751f\u6210\u7684\u6587\u672c\u5f80\u5f80\u5305\u542b\u201c\u5047\u6027\u7a7a\u683c\u201d\uff08\u5982<code>\u6cd5 \u5f8b</code>\uff09\u548c\u5d4c\u5165\u6b63\u6587\u7684\u9875\u7801\uff08\u5982 <code>- 195 -</code>\uff09\uff0c\u666e\u901a\u6b63\u5219\u5bb9\u6613\u8bef\u5220\u6b63\u6587\u4e2d\u7684\u7f16\u53f7\u3002</li> <li>\u4efb\u52a1\u5355\u4e00\u6027\u9677\u9631\uff1a\u7b80\u5355\u7684\u201c\u6cd5\u6761\u89e3\u91ca\u201d\u4e0d\u8db3\u4ee5\u8bad\u7ec3\u4e13\u5bb6\u6a21\u578b\uff0c\u5fc5\u987b\u6784\u9020\u590d\u6742\u7684\u6848\u60c5\u5206\u6790\u3001\u6587\u4e66\u5199\u4f5c\u7b49\u591a\u6837\u5316\u4efb\u52a1\u3002</li> <li>\u63a8\u7406\u9ed1\u76d2\uff1a\u666e\u901a QA \u5bf9\u7f3a\u4e4f\u903b\u8f91\u63a8\u5bfc\uff0c\u9700\u5f3a\u5236\u6a21\u578b\u751f\u6210 CoT\uff0c\u5e76\u5c06\u5176\u683c\u5f0f\u5316\u4e3a\u8bad\u7ec3\u6570\u636e\u3002</li> </ul> </li> </ul>"},{"location":"part6/6_2_legal_sft/#2-architecture-design","title":"2. \u67b6\u6784\u8bbe\u8ba1 (Architecture Design)","text":"<p>\u6570\u636e\u6d41\u6c34\u7ebf\u56fe\uff1a</p> <p></p> <ul> <li>\u6280\u672f\u6808\u6e05\u5355\uff1a</li> </ul> \u7ec4\u4ef6 \u9009\u578b \u51b3\u7b56\u7406\u7531 PDF \u89e3\u6790 <code>pdfplumber</code> \u76f8\u6bd4 <code>PyPDF2</code> \u4ec5\u63d0\u53d6\u7eaf\u6587\u672c\uff0c<code>pdfplumber</code> \u63d0\u4f9b\u7cbe\u51c6\u7684\u50cf\u7d20\u7ea7 Bounding Box \u63a7\u5236\uff0c\u53ef\u7cbe\u7ec6\u5316\u5207\u9664\u9875\u7709\u3001\u9875\u811a\uff08\u5982\u8bbe\u5b9a\u4e0a\u4e0b 5% \u5197\u4f59\u533a\uff09\u4ee5\u51cf\u5c11\u566a\u58f0\u3002 \u6e05\u6d17\u5f15\u64ce <code>Regex</code> (\u6b63\u5219\u8868\u8fbe\u5f0f) \u9488\u5bf9\u4e2d\u6587\u7279\u6709\u7684\u65ad\u8bcd\u9519\u8bef\u3001\u957f\u5f15\u7528\u6807\u53f7\u53ca\u7279\u6b8a\u5b57\u7b26\u7f16\u5199\u7684\u201c\u80f6\u6c34\u4ee3\u7801\u201d\uff0c\u662f\u786e\u4fdd\u540e\u7eed\u6a21\u578b\u8bad\u7ec3\u6570\u636e\u7eaf\u51c0\u5ea6\u7684\u6838\u5fc3\u5173\u5361\u3002 \u751f\u6210\u6a21\u578b <code>DeepSeek-V3</code> \u5229\u7528\u5176\u5353\u8d8a\u7684\u903b\u8f91\u63a8\u7406\u80fd\u529b\u4e0e\u6781\u9ad8\u7684 API \u6027\u4ef7\u6bd4\uff0c\u901a\u8fc7 Self-Instruct \u673a\u5236\u8fdb\u884c\u5927\u89c4\u6a21\u9ad8\u8d28\u91cf\u5408\u6210\u6570\u636e\uff08Synthetic Data\uff09\u7684\u81ea\u52a8\u5316\u751f\u4ea7\u3002 \u7f16\u6392\u903b\u8f91 <code>Python</code> (\u52a0\u6743\u8f6e\u76d8\u8d4c) \u57fa\u4e8e\u6743\u91cd\u968f\u673a\u7b97\u6cd5\uff08Weighted Roulette Wheel\uff09\u5b9e\u73b0\u4efb\u52a1\u5206\u914d\uff0c\u786e\u4fdd\u5728\u5408\u6210\u6570\u636e\u65f6\uff0c\u5404\u7c7b\u4efb\u52a1\uff08\u5982\u4ee3\u7801\u3001\u7ffb\u8bd1\u3001\u63a8\u7406\uff09\u7684\u5206\u5e03\u80fd\u591f\u8fbe\u5230\u52a8\u6001\u5e73\u8861\u3002"},{"location":"part6/6_2_legal_sft/#3-step-by-step-implementation","title":"3. Step-by-Step \u5b9e\u6218 (Implementation)","text":""},{"location":"part6/6_2_legal_sft/#the-dirty-work","title":"\u9636\u6bb5\u4e00\uff1a\u6570\u636e\u83b7\u53d6\u4e0e\u667a\u80fd\u6e05\u6d17 (The Dirty Work)","text":"<p>PDF \u63d0\u53d6\u6700\u5927\u7684\u75db\u70b9\u5728\u4e8e\u683c\u5f0f\u9519\u4e71\u3002\u5728 <code>data_processing.py</code> \u4e2d\uff0c\u6211\u4eec\u4e0d\u4ec5\u8981\u63d0\u53d6\u6587\u672c\uff0c\u66f4\u8981\u4fee\u590d\u683c\u5f0f\u635f\u4f24\u3002</p> <p>1. \u88c1\u526a\u9875\u7709\u9875\u811a \u4e3a\u4e86\u9632\u6b62\u6bcf\u4e00\u9875\u7684\u9875\u7709\uff08\u5982\u201c\u4e2d\u534e\u4eba\u6c11\u5171\u548c\u56fd\u6c11\u6cd5\u5178\u201d\uff09\u91cd\u590d\u51fa\u73b0\u5728\u6b63\u6587\u4e2d\uff0c\u6211\u4eec\u5728\u89e3\u6790\u65f6\u76f4\u63a5\u88c1\u526a\u4e86\u9875\u9762\u4e0a\u4e0b 5% \u7684\u533a\u57df\u3002</p> <pre><code># data_processing.py \u6838\u5fc3\u7247\u6bb5\nwith pdfplumber.open(file_path) as pdf:\n    for page in tqdm(pdf.pages):\n        # \u88c1\u526a\u9875\u7709\u9875\u811a (\u4e0a\u4e0b\u5404\u5207\u9664 5%)\n        width, height = page.width, page.height\n        bbox = (0, height * 0.05, width, height * 0.95)\n        page_crop = page.crop(bbox=bbox) # \u4ec5\u63d0\u53d6\u4e2d\u95f4\u533a\u57df\n        text = page_crop.extract_text()\n</code></pre> <p>2. \u6b63\u5219\u6e05\u6d17\u7684\u201c\u81f3\u6697\u65f6\u523b\u201d \u6700\u68d8\u624b\u7684\u95ee\u9898\u662f\u5d4c\u5165\u5f0f\u9875\u7801\u3002\u5f88\u591a PDF \u5728\u6b63\u6587\u4e2d\u95f4\u4f1a\u7a81\u7136\u51fa\u73b0 <code>- 195 -</code>\u3002\u5982\u679c\u7b80\u5355\u4f7f\u7528 <code>-\\s*\\d+\\s*-</code> \u8fdb\u884c\u5220\u9664\uff0c\u6781\u6613\u8bef\u5220\u6b63\u6587\u4e2d\u7684\u5217\u8868\u7f16\u53f7\uff08\u5982 <code>Item - 1 - A</code>\uff09\u3002</p> <p>\u6211\u4eec\u5728 <code>clean_text_smart</code> \u51fd\u6570\u4e2d\u4f7f\u7528\u4e86 Lookahead \u65ad\u8a00 \u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff1a</p> <pre><code>def clean_text_smart(text):\n    # ... \u7701\u7565\u5176\u4ed6\u6e05\u6d17 ...\n\n    # [\u6838\u5fc3\u6280\u5de7] \u53bb\u9664\u5d4c\u5728\u6587\u672c\u4e2d\u95f4\u7684\u9875\u7801 (\u5982 \"- 195 -\")\n    # \u903b\u8f91\uff1a\u5339\u914d\u524d\u540e\u662f\u7834\u6298\u53f7\u7684\u6570\u5b57\uff0c\u4f46\u5fc5\u987b\u786e\u4fdd\u540e\u9762\u8ddf\u7740\u7a7a\u683c\u6216\u6362\u884c\n    # (?=\\s|\\n|$) \u662f Lookahead \u65ad\u8a00\uff0c\u9632\u6b62\u8bef\u5220 \"Item-1-A\" \u8fd9\u79cd\u7f16\u53f7\n    text = re.sub(r'(?:^|\\s|\\n)[-\u2014\u2013\uff0d]\\s*\\d+\\s*[-\u2014\u2013\uff0d](?=\\s|\\n|$)', ' ', text)\n\n    # [\u6838\u5fc3\u6280\u5de7] \u4fee\u590d\u4e2d\u6587\u65ad\u8bcd\n    # \u573a\u666f\uff1aPDF\u4e2d \"\u6cd5 \u5f8b \u89c4 \u5b9a\" \u4f1a\u88ab\u8bc6\u522b\u4e3a\u5e26\u7a7a\u683c\uff0c\u9700\u5408\u5e76\n    pattern_broken_zh = r'([\\u4e00-\\u9fa5])\\s+([\\u4e00-\\u9fa5])'\n    # \u6267\u884c\u4e24\u6b21\u4ee5\u5904\u7406\u8fde\u7eed\u65ad\u8bcd (\u5982 \"A B C\" -&gt; \"AB C\" -&gt; \"ABC\")\n    text = re.sub(pattern_broken_zh, r'\\1\\2', text)\n    text = re.sub(pattern_broken_zh, r'\\1\\2', text) \n\n    return text.strip()\n</code></pre>"},{"location":"part6/6_2_legal_sft/#diversity-cot","title":"\u9636\u6bb5\u4e8c\uff1a\u591a\u6837\u5316\u6307\u4ee4\u5408\u6210 (Diversity &amp; CoT)","text":"<p>\u4e3a\u4e86\u907f\u514d\u6a21\u578b\u53d8\u6210\u53ea\u4f1a\u80cc\u6cd5\u6761\u7684\u4e66\u5446\u5b50\uff0c\u6211\u4eec\u5728 <code>generate_instructions.py</code> \u4e2d\u8bbe\u8ba1\u4e86\u4efb\u52a1\u6c60\uff08Task Pool\uff09\u548c\u6982\u7387\u91c7\u6837\u673a\u5236\u3002\u6211\u4eec\u5b9a\u4e49\u4e86\u4e09\u79cd\u4efb\u52a1\uff0c\u5e76\u8d4b\u4e88\u4e0d\u540c\u7684\u6743\u91cd\u3002</p> <p>1. \u4efb\u52a1\u7c7b\u578b\u4e0e\u6743\u91cd\u914d\u7f6e</p> \u4efb\u52a1\u7c7b\u578b \u4fa7\u91cd\u70b9 \u6743\u91cd Prompt \u5173\u952e\u6307\u4ee4 \u590d\u6742\u6848\u60c5\u5206\u6790 \u6df1\u5ea6\u63a8\u7406 60% \"\u6784\u9020\u4e00\u4e2a\u5305\u542b\u591a\u65b9\u51b2\u7a81\u7684\u5177\u4f53\u6848\u60c5...\u5fc5\u987b\u4f7f\u7528 CoT\" \u6cd5\u5f8b\u6587\u4e66\u8d77\u8349 \u4e13\u4e1a\u5199\u4f5c 20% \"\u8d77\u8349\u4e00\u4efd\u57fa\u4e8e\u8be5\u6cd5\u6761\u7684\u6587\u4e66\uff08\u5982\u5408\u540c\u6761\u6b3e\u3001\u5f8b\u5e08\u51fd\uff09\" \u6cd5\u5f8b\u6982\u5ff5\u8fa8\u6790 \u77e5\u8bc6\u666e\u53ca 20% \"\u5c0f\u767d\u7528\u6237\u63d0\u51fa\u7684\u6982\u5ff5\u6027\u95ee\u9898...\u7528\u5927\u767d\u8bdd\u89e3\u91ca\" <p>2. \u52a0\u6743\u8f6e\u76d8\u8d4c\u7b97\u6cd5\u5b9e\u73b0</p> <p>\u4e3a\u4e86\u4e25\u683c\u63a7\u5236\u6570\u636e\u5206\u5e03\uff0c\u6211\u4eec\u4f7f\u7528\u7d2f\u79ef\u6982\u7387\u7b97\u6cd5\u9009\u62e9 Prompt\uff1a</p> <pre><code># \u4efb\u52a1\u6743\u91cd\u914d\u7f6e\nTASK_POOL = [\n    # \u4efb\u52a1A: \u590d\u6742\u6848\u60c5\u5206\u6790 (\u4fa7\u91cd\u63a8\u7406) - \u6743\u91cd 60%\n    (\"case_analysis\", PROMPT_CASE_ANALYSIS, 0.6),\n    # \u4efb\u52a1B: \u6cd5\u5f8b\u6587\u4e66\u8d77\u8349 (\u4fa7\u91cd\u751f\u6210) - \u6743\u91cd 20%\n    (\"doc_drafting\", PROMPT_DOCUMENT_DRAFTING, 0.2),\n    # \u4efb\u52a1C: \u6cd5\u5f8b\u6982\u5ff5\u8fa8\u6790 (\u4fa7\u91cd\u77e5\u8bc6) - \u6743\u91cd 20%\n    (\"concept_explain\", PROMPT_CONCEPT_EXPLAIN, 0.2)\n]\n\n# \u8f6e\u76d8\u8d4c\u9009\u62e9\u903b\u8f91\nrand = random.random()\ncumulative_prob = 0\nfor name, tpl, prob in TASK_POOL:\n    cumulative_prob += prob\n    if rand &lt;= cumulative_prob: # \u547d\u4e2d\u533a\u95f4\n        selected_task_name = name\n        selected_prompt_tpl = tpl\n        break\n</code></pre>"},{"location":"part6/6_2_legal_sft/#cot","title":"\u9636\u6bb5\u4e09\uff1a\u683c\u5f0f\u5316\u4e0e CoT \u663e\u6027\u5316","text":"<p>\u6a21\u578b\u751f\u6210\u7684 JSON \u5f80\u5f80\u5305\u542b\u9690\u5f0f\u7684\u63a8\u7406\u8fc7\u7a0b\u3002\u4e3a\u4e86\u8ba9\u5fae\u8c03\u540e\u7684\u6a21\u578b\u5b66\u4f1a\u201c\u5148\u60f3\u540e\u8bf4\u201d\uff0c\u6211\u4eec\u9700\u8981\u5728\u540e\u5904\u7406\u9636\u6bb5\u5c06\u8fd9\u4e9b\u601d\u8003\u8fc7\u7a0b\u663e\u6027\u5316\uff0c\u62fc\u63a5\u6210 Markdown \u683c\u5f0f\u3002</p> <pre><code># generate_instructions.py \u540e\u5904\u7406\u903b\u8f91\nif isinstance(raw_output, dict):\n    # \u63d0\u53d6\u601d\u8003\u8fc7\u7a0b (\u517c\u5bb9\u4e0d\u540c\u7684 key)\n    thought = raw_output.get(\"\u601d\u8003\u8fc7\u7a0b\") or raw_output.get(\"analysis\")\n    answer = raw_output.get(\"\u6cd5\u5f8b\u5efa\u8bae\") or raw_output.get(\"conclusion\")\n\n    # [\u5173\u952e] \u5f3a\u5236\u6784\u5efa\u601d\u7ef4\u94fe\u683c\u5f0f\n    formatted_output = f\"#### \ud83e\udde0 \u601d\u8003\u8fc7\u7a0b\\n{thought}\\n\\n#### \ud83d\udcdd \u4e13\u5bb6\u5efa\u8bae\\n{answer}\"\n</code></pre>"},{"location":"part6/6_2_legal_sft/#4-showcase","title":"4. \u6548\u679c\u5c55\u793a (Showcase)","text":"<p>\u7ecf\u8fc7\u5904\u7406\uff0c\u539f\u59cb\u67af\u71e5\u7684\u6cd5\u6761\u88ab\u8f6c\u5316\u4e3a\u5177\u5907\u6df1\u5ea6\u63a8\u7406\u7684\u95ee\u7b54\u5bf9\u3002\u4ee5\u4e0b\u662f <code>domain_expert.jsonl</code> \u4e2d\u7684\u5355\u6761\u6570\u636e\u6837\u672c\uff1a</p> <p>Source (\u539f\u59cb\u6cd5\u6761\u7247\u6bb5):</p> <p>...\u7b2c\u4e00\u767e\u56db\u5341\u516b\u6761 \u4e00\u65b9\u4ee5\u6b3a\u8bc8\u624b\u6bb5\uff0c\u4f7f\u5bf9\u65b9\u5728\u8fdd\u80cc\u771f\u5b9e\u610f\u601d\u7684\u60c5\u51b5\u4e0b\u5b9e\u65bd\u7684\u6c11\u4e8b\u6cd5\u5f8b\u884c\u4e3a\uff0c\u53d7\u6b3a\u8bc8\u65b9\u6709\u6743\u8bf7\u6c42\u4eba\u6c11\u6cd5\u9662\u6216\u8005\u4ef2\u88c1\u673a\u6784\u4e88\u4ee5\u64a4\u9500...</p> <p>Generated SFT Data (JSONL Entry):</p> \u5b57\u6bb5 \u5185\u5bb9\u793a\u4f8b Instruction \u6211\u521a\u624d\u7b7e\u5408\u540c\u7684\u65f6\u5019\u88ab\u5bf9\u65b9\u9a97\u4e86\uff0c\u4ed6\u8bf4\u90a3\u4e2a\u53e4\u8463\u662f\u771f\u54c1\uff0c\u7ed3\u679c\u662f\u5047\u7684\u3002\u6211\u73b0\u5728\u8be5\u600e\u4e48\u529e\uff1f\u80fd\u76f4\u63a5\u4e0d\u8ba4\u8d26\u5417\uff1f Output #### \ud83e\udde0 \u601d\u8003\u8fc7\u7a0b1. \u5206\u6790\u6cd5\u5f8b\u5173\u7cfb\uff1a\u7528\u6237\u5728\u5bf9\u65b9\u6b3a\u8bc8\u4e0b\u7b7e\u8ba2\u4e86\u5408\u540c\uff08\u5b9e\u65bd\u6c11\u4e8b\u6cd5\u5f8b\u884c\u4e3a\uff09\u30022. \u9002\u7528\u6cd5\u6761\uff1a\u6839\u636e\u300a\u6c11\u6cd5\u5178\u300b\u7b2c\u4e00\u767e\u4e94\u5341\u6761\uff0c\u8fd9\u662f\"\u53ef\u64a4\u9500\"\u7684\u6c11\u4e8b\u6cd5\u5f8b\u884c\u4e3a\uff0c\u800c\u975e\u76f4\u63a5\"\u65e0\u6548\"\u6216\"\u4e0d\u8ba4\u8d26\"\u30023. \u64cd\u4f5c\u8def\u5f84\uff1a\u53d7\u6b3a\u8bc8\u65b9\u9700\u884c\u4f7f\u64a4\u9500\u6743\uff0c\u4e14\u5fc5\u987b\u901a\u8fc7\u6cd5\u9662\u6216\u4ef2\u88c1\u673a\u6784\u8fdb\u884c\u3002#### \ud83d\udcdd \u4e13\u5bb6\u5efa\u8bae\u60a8\u597d\uff0c\u6839\u636e\u60a8\u63cf\u8ff0\u7684\u60c5\u51b5\uff0c\u60a8\u5728\u8fdd\u80cc\u771f\u5b9e\u610f\u601d\u7684\u60c5\u51b5\u4e0b\u7b7e\u8ba2\u4e86\u5408\u540c\uff0c\u8fd9\u5c5e\u4e8e\u53ef\u64a4\u9500\u7684\u6c11\u4e8b\u6cd5\u5f8b\u884c\u4e3a\u3002\u60a8\u4e0d\u80fd\u76f4\u63a5\"\u4e0d\u8ba4\u8d26\"\u6216\u5355\u65b9\u9762\u6495\u6bc1\u5408\u540c\uff0c\u800c\u662f\u5efa\u8bae\u91c7\u53d6\u4ee5\u4e0b\u63aa\u65bd\uff1a1. \u884c\u4f7f\u64a4\u9500\u6743\uff1a\u60a8\u53ef\u4ee5\u5411\u4eba\u6c11\u6cd5\u9662\u63d0\u8d77\u8bc9\u8bbc\u6216\u5411\u4ef2\u88c1\u673a\u6784\u7533\u8bf7\u4ef2\u88c1\uff0c\u8bf7\u6c42\u64a4\u9500\u8be5\u5408\u540c\u30022. ... <p>\u6570\u636e\u5206\u5e03\u5206\u6790\uff1a \u5728\u751f\u6210\u7684 1000 \u6761\u6837\u672c\u4e2d\uff0c\u6211\u4eec\u9a8c\u8bc1\u4e86\u5206\u5e03\u6bd4\u4f8b\uff0c\u57fa\u672c\u7b26\u5408\u9884\u8bbe\u7684\u8bbe\u5b9a\uff0c\u6709\u6548\u907f\u514d\u4e86\u6a21\u578b\u80fd\u529b\u7684\u504f\u79d1\u3002</p>"},{"location":"part6/6_2_legal_sft/#5-cost-optimization","title":"5. \u6210\u672c\u4e0e\u4f18\u5316 (Cost &amp; Optimization)","text":""},{"location":"part6/6_2_legal_sft/#_1","title":"\u8d44\u6e90\u6d88\u8017","text":"<ul> <li>API \u6210\u672c\uff1a\u4f7f\u7528 DeepSeek-V3\uff0c\u751f\u6210 1000 \u6761\u9ad8\u8d28\u91cf CoT \u6570\u636e\u7ea6\u4e3a $0.5 - $1.0\u3002\u7531\u4e8e CoT \u5bfc\u81f4\u8f93\u51fa Token \u8f83\u957f\uff0cOutput \u8d39\u7528\u5360\u6bd4\u7ea6\u4e3a 80%\u3002</li> <li>\u65f6\u95f4\u6210\u672c\uff1a\u5f53\u524d\u4ee3\u7801\u4e3a\u5355\u7ebf\u7a0b\u8fd0\u884c\uff0c\u5904\u7406\u901f\u5ea6\u7ea6\u4e3a 2\u79d2/\u6761\u3002\u751f\u6210 1\u4e07\u6761\u6570\u636e\u7ea6\u9700 5.5 \u5c0f\u65f6\u3002</li> </ul>"},{"location":"part6/6_2_legal_sft/#demo","title":"\u6269\u5c55\u6027\u601d\u8003\uff1a\u4ece Demo \u5230\u751f\u4ea7\u73af\u5883","text":"<p>\u4ee3\u7801\u4e2d\u76ee\u524d\u7684 <code>time.sleep(0.1)</code> \u662f\u4e3a\u4e86\u9632\u6b62 API Rate Limit \u7684\u4e34\u65f6\u65b9\u6848\u3002\u82e5\u8981\u6269\u5c55\u81f3\u767e\u4e07\u7ea7\u6570\u636e\u5904\u7406\uff0c\u5efa\u8bae\u8fdb\u884c\u4ee5\u4e0b\u6539\u9020\uff1a</p> <ol> <li>\u5e76\u53d1\u52a0\u901f (AsyncIO)\uff1a \u5c06 <code>client.chat.completions.create</code> \u66ff\u6362\u4e3a\u5f02\u6b65\u8c03\u7528\uff0c\u5e76\u914d\u5408 <code>asyncio.Semaphore(10)</code> \u63a7\u5236\u5e76\u53d1\u6570\u3002\u5b9e\u6d4b\u53ef\u5c06\u541e\u5410\u91cf\u63d0\u5347\u81f3 20-50 \u6761/\u79d2\u3002</li> <li> <p>\u8d28\u91cf\u63a7\u5236 (Reward Model)\uff1a \u76ee\u524d\u4ec5\u4f9d\u8d56 Prompt \u7ea6\u675f JSON \u683c\u5f0f\uff0c\u4f46\u5728\u5927\u89c4\u6a21\u751f\u6210\u65f6\uff0c\u7ea6\u6709 3-5% \u7684\u6837\u672c\u4f1a\u89e3\u6790\u5931\u8d25\u3002\u5efa\u8bae\u589e\u52a0\u4e00\u6b65\u89c4\u5219\u8fc7\u6ee4\u5668\uff0c\u4f8b\u5982\uff1a\u8fc7\u6ee4\u6389 <code>output</code> \u957f\u5ea6\u5c0f\u4e8e 50 \u5b57\u7b26\u7684\u6837\u672c\u3002</p> </li> <li> <p>\u6b63\u5219\u7684\u5c40\u9650\u6027\uff1a \u5bf9\u4e8e\u6781\u5ea6\u590d\u6742\u7684 PDF\uff08\u5982\u53cc\u680f\u6392\u7248\u3001\u5305\u542b\u590d\u6742\u8868\u683c\uff09\uff0c<code>pdfplumber</code> + \u6b63\u5219\u53ef\u80fd\u5931\u6548\u3002\u6b64\u65f6\u5e94\u8003\u8651\u63a5\u5165 OCR \u5927\u6a21\u578b\uff08\u5982 Qwen-VL\uff09\u8fdb\u884c\u7aef\u5230\u7aef\u89e3\u6790\uff0c\u867d\u7136\u6210\u672c\u4e0a\u5347\uff0c\u4f46\u6e05\u6d17\u8d28\u91cf\u5c06\u6709\u8d28\u7684\u98de\u8dc3\u3002</p> </li> </ol>"},{"location":"part6/6_3_llava_instruct/","title":"\u9879\u76ee\u4e09\uff1a\u6784\u5efaLLaVA\u591a\u6a21\u6001\u6307\u4ee4\u96c6","text":""},{"location":"part6/6_3_llava_instruct/#llava-building-llava-instruction-sets","title":"\u9879\u76ee\u4e09\uff1a\u6784\u5efa LLaVA \u591a\u6a21\u6001\u6307\u4ee4\u96c6 (Building LLaVA Instruction Sets)","text":"<p>\u9002\u7528\u8303\u56f4\uff1a\u591a\u6a21\u6001\u5927\u6a21\u578b\uff08LMM\uff09\u5f00\u53d1\u3001\u6570\u636e\u5de5\u7a0b\u3001\u89c6\u89c9\u6307\u4ee4\u5fae\u8c03\uff08Visual Instruction Tuning\uff09</p>"},{"location":"part6/6_3_llava_instruct/#1-project-brief","title":"1. \u9879\u76ee\u80cc\u666f (Project Brief)","text":"<ul> <li>\u4efb\u52a1\u5b9a\u4e49\uff1a \u6784\u5efa\u4e00\u4e2a\u9ad8\u8d28\u91cf\u7684\u89c6\u89c9\u6307\u4ee4\u5fae\u8c03\u6570\u636e\u96c6\uff0c\u652f\u6301 Visual QA\uff08\u5355\u56fe\u95ee\u7b54\uff09\u3001Grounding\uff08\u7269\u4f53\u5b9a\u4f4d\uff09\u4ee5\u53ca Interleaved Image-Text\uff08\u591a\u56fe\u4e0a\u4e0b\u6587\u63a8\u7406\uff09\uff0c\u7528\u4e8e\u8bad\u7ec3\u50cf LLaVA \u6216 Qwen-VL \u8fd9\u6837\u7684\u591a\u6a21\u6001\u6a21\u578b\u3002</li> <li>\u8f93\u5165\u4e0e\u8f93\u51fa\uff1a<ul> <li>Input: \u539f\u59cb\u56fe\u7247\u5e93\uff08<code>.jpg</code> / <code>.png</code>\uff09\u548c\u7ed3\u6784\u5316\u6807\u6ce8\u7684COCO \u683c\u5f0f\u7684 <code>instances.json</code>\uff08\u5305\u542b Bbox \u5750\u6807 <code>[x, y, w, h]</code>\uff09\u3002</li> <li>Output: <code>llava_instruct.json</code>\u7b26\u5408 LLaVA \u8bad\u7ec3\u6807\u51c6\u7684 JSON \u6587\u4ef6\u3002<code>llava_interleaved.json</code>\u5305\u542b\u591a\u56fe\u5bf9\u6bd4\u903b\u8f91\u7684\u5bf9\u8bdd\u6570\u636e\u3002</li> </ul> </li> <li>\u96be\u70b9\u5206\u6790\uff1a<ul> <li>\u5750\u6807\u7cfb\u5bf9\u9f50\uff08Coordinate Alignment\uff09\uff1a \u539f\u59cb\u68c0\u6d4b\u6570\u636e\u7684\u5750\u6807\u662f\u50cf\u7d20\u7edd\u5bf9\u503c\uff0c\u800c LLaVA \u6a21\u578b\u8981\u6c42\u5f52\u4e00\u5316\u5230 <code>[0, 1000]</code> \u533a\u95f4\u3002\u53ea\u8981\u6709 1% \u7684\u504f\u5dee\uff0c\u6a21\u578b\u5728 Grounding \u4efb\u52a1\u4e2d\u5c31\u4f1a\u4ea7\u751f\u4e25\u91cd\u7684\u201c\u5e7b\u89c9\u201d\u3002</li> <li>API \u8f7d\u8377\u6784\u5efa\uff1a \u5728\u591a\u56fe\u5bf9\u8bdd\u751f\u6210\u4e2d\uff0c\u5982\u4f55\u6b63\u786e\u5904\u7406\u56fe\u50cf\u7f16\u7801\uff08Base64\uff09\u5e76\u6784\u5efa\u7b26\u5408 OpenAI \u517c\u5bb9\u63a5\u53e3\u7684 Payload \u662f\u5de5\u7a0b\u5b9e\u73b0\u7684\u75db\u70b9\u3002</li> </ul> </li> </ul>"},{"location":"part6/6_3_llava_instruct/#2-architecture-design","title":"2. \u67b6\u6784\u8bbe\u8ba1 (Architecture Design)","text":"<ul> <li> <p>\u6570\u636e\u6d41\u6c34\u7ebf\u56fe\uff1a </p> </li> <li> <p>\u6280\u672f\u6808\u6e05\u5355\uff1a</p> </li> </ul> \u7ec4\u4ef6 \u9009\u578b \u51b3\u7b56\u7406\u7531 \u751f\u6210\u6a21\u578b <code>SiliconFlow API</code> (Qwen-VL) \u517c\u5bb9 OpenAI \u63a5\u53e3\uff0c\u5229\u7528 Qwen-VL \u5f3a\u5927\u7684\u591a\u6a21\u6001\u7406\u89e3\u80fd\u529b\u81ea\u52a8\u6784\u9020\u591a\u56fe\u5bf9\u6bd4\u903b\u8f91\u3002 \u6838\u5fc3\u5904\u7406 <code>Python</code> (OpenCV, NumPy) \u5229\u7528 <code>OpenCV</code> \u7cbe\u786e\u63d0\u53d6\u56fe\u50cf\u771f\u5b9e\u5c3a\u5bf8 <code>(H, W)</code> \u4ee5\u5b8c\u6210\u5750\u6807\u5f52\u4e00\u5316\uff1b\u5229\u7528 <code>re</code> \u6b63\u5219\u8868\u8fbe\u5f0f\u89e3\u6790\u6a21\u578b\u8f93\u51fa\u3002 \u6570\u636e\u6807\u51c6 <code>JSON</code> \u9075\u5faa LLaVA \u6807\u51c6\u6570\u636e\u4ea4\u6362\u683c\u5f0f\uff0c\u786e\u4fdd\u751f\u6210\u7684\u8bad\u7ec3\u6570\u636e\u80fd\u65e0\u7f1d\u5bf9\u63a5\u5230 Training Pipeline\u3002"},{"location":"part6/6_3_llava_instruct/#3-step-by-step-implementation","title":"3. Step-by-Step \u5b9e\u6218 (Implementation)","text":""},{"location":"part6/6_3_llava_instruct/#interleaved-data-generation","title":"\u9636\u6bb5\u4e00\uff1a\u591a\u56fe\u4ea4\u9519\u6570\u636e\u751f\u6210 (Interleaved Data Generation)","text":"<p>\u4e3a\u4e86\u8ba9\u6a21\u578b\u5b66\u4f1a\u201c\u5bf9\u6bd4\u201d\u4e24\u5f20\u56fe\u7247\uff0c\u6211\u4eec\u9700\u8981\u6784\u9020\u5305\u542b\u591a\u5f20\u56fe\u50cf\u7684 Prompt\u3002</p> <p>\u5173\u952e\u903b\u8f91\uff1aBase64 \u7f16\u7801\u4e0e Payload \u6784\u5efa \u5728 <code>interleaved.py</code> \u4e2d\uff0c\u6700\u5173\u952e\u7684\u4e00\u6b65\u662f\u5c06\u672c\u5730\u56fe\u7247\u8f6c\u6362\u4e3a API \u53ef\u63a5\u53d7\u7684 Base64 \u683c\u5f0f\uff0c\u5e76\u6784\u5efa\u591a\u56fe <code>image_url</code> \u5217\u8868\u3002</p> <pre><code># \u6838\u5fc3\u4ee3\u7801\u6458\u81ea interleaved.py\ndef encode_image(path):\n    # \u5fc5\u987b\u4ee5\u4e8c\u8fdb\u5236\u8bfb\u53d6\u5e76\u8f6c\u4e3a utf-8 \u5b57\u7b26\u4e32\n    with open(path, \"rb\") as f:\n        return base64.b64encode(f.read()).decode('utf-8')\n\ndef generate_comparison(img1_path, img2_path):\n    # \u6784\u9020 Prompt\uff1a\u660e\u786e\u8981\u6c42\u5bf9\u6bd4\u5171\u540c\u70b9\u548c\u5dee\u5f02\n    prompt = \"Here are two images. Please briefly compare them...\"\n\n    # \u6784\u5efa\u7b26\u5408 OpenAI Vision API \u6807\u51c6\u7684 Payload\n    messages=[\n        {\n            \"role\": \"user\",\n            \"content\": [\n                {\"type\": \"text\", \"text\": prompt},\n                # \u52a8\u6001\u63d2\u5165\u591a\u5f20\u56fe\u7247\u7684 Base64 \u6570\u636e\n                {\"type\": \"image_url\", \"image_url\": {\"url\": f\"data:image/jpeg;base64,{encode_image(img1_path)}\"}},\n                {\"type\": \"image_url\", \"image_url\": {\"url\": f\"data:image/jpeg;base64,{encode_image(img2_path)}\"}}\n            ]\n        }\n    ]\n    # ... \u53d1\u9001\u8bf7\u6c42 ...\n</code></pre>"},{"location":"part6/6_3_llava_instruct/#bounding-box-alignment","title":"\u9636\u6bb5\u4e8c\uff1a\u6838\u5fc3\u5904\u7406\u2014\u2014Bounding Box \u5bf9\u9f50 (Alignment)","text":"<p>\u8fd9\u662f\u672c\u9879\u76ee\u6570\u5b66\u903b\u8f91\u6700\u4e25\u5bc6\u7684\u90e8\u5206\u3002\u6211\u4eec\u9700\u8981\u5c06 COCO \u7684 <code>[x, y, w, h]</code> \u8f6c\u6362\u4e3a LLaVA \u7684 <code>[ymin, xmin, ymax, xmax]</code> \u5e76\u5f52\u4e00\u5316\u5230 0-1000\u3002</p> <p>\u5173\u952e\u51fd\u6570\uff1a\u5750\u6807\u5f52\u4e00\u5316\u4e0e\u622a\u65ad \u5728 <code>alignment.py</code> \u4e2d\uff0c\u6211\u4eec\u5fc5\u987b\u5904\u7406\u6d6e\u70b9\u6570\u8f6c\u6362\u5e26\u6765\u7684\u8fb9\u754c\u6ea2\u51fa\u95ee\u9898\u3002</p> <pre><code># \u6838\u5fc3\u4ee3\u7801\u6458\u81ea alignment.py\ndef convert_bbox(bbox, width, height):\n    x, y, w, h = bbox # COCO \u539f\u59cb\u8f93\u5165\n\n    # 1. \u5750\u6807\u8f6c\u6362\u4e0e\u5f52\u4e00\u5316\n    xmin = int((x / width) * 1000)\n    ymin = int((y / height) * 1000)\n    xmax = int((x + w) / width * 1000)\n    ymax = int((y + h) / height * 1000)\n\n    # 2. \u5b89\u5168\u622a\u65ad (Clamping)\n    # \u8fd9\u662f\u4e00\u4e2a\u91cd\u8981\u7684\u5de5\u7a0b\u7ec6\u8282\uff1a\u5982\u679c\u4e0d\u505a max/min \u9650\u5236\uff0c\n    # \u67d0\u4e9b\u8fb9\u7f18\u50cf\u7d20\u53ef\u80fd\u4f1a\u8ba1\u7b97\u51fa 1001 \u6216 -1\uff0c\u5bfc\u81f4\u8bad\u7ec3\u62a5\u9519\u3002\n    return [\n        max(0, min(1000, ymin)),\n        max(0, min(1000, xmin)),\n        max(0, min(1000, ymax)),\n        max(0, min(1000, xmax))\n    ]\n</code></pre> <p>\u7b56\u7565\u4f18\u5316\uff1a \u4e3a\u4e86\u9632\u6b62\u5355\u5f20\u56fe\u7247\u751f\u6210\u7684\u95ee\u7b54\u5bf9\u8fc7\u591a\uff08\u5bfc\u81f4\u6570\u636e\u5206\u5e03\u4e0d\u5e73\u8861\uff09\uff0c\u4ee3\u7801\u4e2d\u91c7\u7528\u4e86 <code>selected_anns = anns[:3]</code> \u7b56\u7565\uff0c\u968f\u673a\u6216\u6309\u5e8f\u53ea\u9009\u53d6\u524d 3 \u4e2a\u7269\u4f53\u6784\u5efa\u95ee\u7b54\u3002</p>"},{"location":"part6/6_3_llava_instruct/#verification","title":"\u9636\u6bb5\u4e09\uff1a\u683c\u5f0f\u5316\u4e0e\u9a8c\u8bc1 (Verification)","text":"<p>\u6570\u636e\u751f\u6210\u540e\uff0c\u5fc5\u987b\u901a\u8fc7\u53ef\u89c6\u5316\u53cd\u5411\u9a8c\u8bc1\u3002\u5982\u679c\u6211\u4eec\u5728\u56fe\u7247\u4e0a\u753b\u51fa\u7684\u6846\u662f\u6b6a\u7684\uff0c\u8bad\u7ec3\u51fa\u6765\u7684\u6a21\u578b\u4e00\u5b9a\u662f\u5e9f\u7684\u3002</p> <p>\u5173\u952e\u903b\u8f91\uff1a\u6b63\u5219\u89e3\u6790\u4e0e OpenCV \u7ed8\u56fe \u5728 <code>visualize_bbox.py</code> \u4e2d\uff0c\u6211\u4eec\u9700\u8981\u4ece JSON \u5b57\u7b26\u4e32\u4e2d\u63d0\u53d6\u51fa\u5750\u6807\u6570\u7ec4\uff0c\u5e76\u8fd8\u539f\u56de\u50cf\u7d20\u5750\u6807\u3002</p> <pre><code># \u6838\u5fc3\u4ee3\u7801\u6458\u81ea visualize_bbox.py\n# 1. \u4f7f\u7528\u6b63\u5219\u8868\u8fbe\u5f0f\u63d0\u53d6 LLaVA \u683c\u5f0f\u5750\u6807\u5b57\u7b26\u4e32\n# \u5339\u914d\u683c\u5f0f\u5982: [350, 201, 680, 505]\nbboxes = re.findall(r'\\[(\\d+),\\s*(\\d+),\\s*(\\d+),\\s*(\\d+)\\]', text)\n\n# 2. \u5750\u6807\u8fd8\u539f\u4e0e\u7ed8\u56fe\ndef draw_bbox(image, bbox, label, color):\n    h, w, _ = image.shape\n    ymin, xmin, ymax, xmax = bbox\n\n    # \u8fd8\u539f\u4e3a\u7edd\u5bf9\u50cf\u7d20\u5750\u6807\n    x1 = int(xmin / 1000 * w)\n    y1 = int(ymin / 1000 * h)\n    # ... (\u7701\u7565 x2, y2 \u8ba1\u7b97) ...\n\n    # \u753b\u6846 + \u6807\u7b7e\u80cc\u666f (\u63d0\u5347\u53ef\u89c6\u5316\u6548\u679c)\n    cv2.rectangle(image, (x1, y1), (x2, y2), color, 2)\n    cv2.putText(image, label, (x1, y1 - 5), cv2.FONT_HERSHEY_SIMPLEX, 0.6, (255, 255, 255), 2)\n</code></pre>"},{"location":"part6/6_3_llava_instruct/#4-showcase","title":"4. \u6548\u679c\u5c55\u793a (Showcase)","text":"<p>1. \u6570\u636e\u7ed3\u6784\u793a\u4f8b\uff1a \u751f\u6210\u7684 <code>llava_instruct.json</code> \u5305\u542b\u5982\u4e0b\u6807\u51c6\u7ed3\u6784\uff0c\u5176\u4e2d <code>conversations</code> \u5b57\u6bb5\u4e25\u683c\u9075\u5faa Human/Model \u5bf9\u8bdd\u683c\u5f0f\uff1a</p> <pre><code>{\n  \"id\": \"1296_laptop\",\n  \"image\": \"000000001296.jpg\",\n  \"conversations\": [\n    {\n      \"from\": \"human\",\n      \"value\": \"Where is the laptop in the image? &lt;image&gt;\"\n    },\n    {\n      \"from\": \"qwen\",\n      \"value\": \"The laptop is located at [350, 201, 680, 505].\"\n    }\n  ]\n}\n</code></pre> <p>2. \u53ef\u89c6\u5316\u9a8c\u8bc1\u62a5\u544a\uff1a \u8fd0\u884c <code>visualize_bbox.py</code> \u540e\uff0c\u811a\u672c\u4f1a\u5728 <code>viz_debug</code> \u76ee\u5f55\u4e0b\u751f\u6210\u5e26\u6709\u6807\u6ce8\u6846\u7684\u56fe\u7247\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u7ea2\u8272\u6846\u4f53\u7cbe\u51c6\u5730\u8d34\u5408\u4e86\u7269\u4f53\u8fb9\u7f18\uff0c\u4e14\u6807\u7b7e\uff08Label\uff09\u6b63\u786e\uff0c\u8bc1\u660e\u5750\u6807\u5f52\u4e00\u5316\u7b97\u6cd5\u903b\u8f91\u65e0\u8bef\u3002</p> <p></p>"},{"location":"part6/6_3_llava_instruct/#5-cost-optimization","title":"5. \u6210\u672c\u4e0e\u4f18\u5316 (Cost &amp; Optimization)","text":""},{"location":"part6/6_3_llava_instruct/#_1","title":"\u8d44\u6e90\u6d88\u8017","text":"<ul> <li>API \u6210\u672c\uff1a <code>interleaved.py</code> \u4f9d\u8d56\u5916\u90e8 LLM API\u3002\u5b9e\u6d4b\u751f\u6210 1,000 \u6761\u591a\u56fe\u5bf9\u6bd4\u6570\u636e\uff0cToken \u6d88\u8017\u7ea6\u4e3a 300k\uff0c\u6210\u672c\u7ea6\u4e3a $0.15 (\u57fa\u4e8e SiliconFlow Qwen-VL \u5b9a\u4ef7)\u3002</li> <li>\u8ba1\u7b97\u8017\u65f6\uff1a <code>alignment.py</code> \u662f\u7eaf CPU \u8ba1\u7b97\u3002\u5728\u5355\u6838 CPU \u4e0a\u5904\u7406 COCO \u9a8c\u8bc1\u96c6\uff085,000 \u5f20\u56fe\uff09\u8017\u65f6\u7ea6 15\u79d2\uff0c\u4e3b\u8981\u74f6\u9888\u5728\u4e8e <code>cv2.imread</code> \u7684\u78c1\u76d8 I/O\u3002</li> </ul>"},{"location":"part6/6_3_llava_instruct/#_2","title":"\u6269\u5c55\u6027\u601d\u8003","text":"<ul> <li>IO \u74f6\u9888\u4f18\u5316\uff1a \u5f53\u524d\u4ee3\u7801\u662f\u5355\u7ebf\u7a0b\u8fd0\u884c\u3002\u5f53\u6570\u636e\u91cf\u6269\u5c55\u5230 Objects365\uff08\u767e\u4e07\u7ea7\uff09\u65f6\uff0c\u5efa\u8bae\u5f15\u5165 Python \u7684 <code>multiprocessing</code> \u5e93\uff0c\u5f00\u542f 16 \u4e2a\u8fdb\u7a0b\u5e76\u884c\u8bfb\u53d6\u56fe\u7247\u83b7\u53d6 <code>(h, w)</code>\u3002</li> <li>\u5185\u5b58\u4f18\u5316\uff1a \u5f53\u524d <code>load_coco_annotations</code> \u5c06\u6574\u4e2a JSON \u4e00\u6b21\u6027\u8f7d\u5165\u5185\u5b58\u3002\u5bf9\u4e8e\u8d85\u5927\u578b\u6570\u636e\u96c6\uff0c\u5e94\u6539\u7528 <code>ijson</code> \u8fdb\u884c\u6d41\u5f0f\u89e3\u6790\uff0c\u6216\u9884\u5148\u5c06\u6807\u6ce8\u8f6c\u5b58\u4e3a SQLite/Parquet \u6570\u636e\u5e93\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002</li> </ul>"},{"location":"part6/6_4_synthetic_textbook/","title":"\u9879\u76ee\u56db\uff1a\u5408\u6210\u6570\u5b66\u4ee3\u7801\u6559\u79d1\u4e66","text":""},{"location":"part6/6_4_synthetic_textbook/#_1","title":"\u9879\u76ee\u56db\uff1a\u5408\u6210\u6570\u5b66/\u4ee3\u7801\u6559\u79d1\u4e66","text":"<p>\u573a\u666f\uff1a\u63d0\u5347\u5c0f\u6a21\u578b\uff08SLM\uff09\u7684\u903b\u8f91\u63a8\u7406\u4e0e\u6570\u5b66\u89e3\u9898\u80fd\u529b\u3002 \u6838\u5fc3\u6280\u672f\uff1aEvol-Instruct \u8fdb\u5316\u7b56\u7565\u3001PoT (Program of Thought) \u6570\u636e\u683c\u5f0f\u5316\u3001Python \u4ee3\u7801\u6267\u884c\u6c99\u7bb1 (Sandbox)\u3002 \u8f93\u51fa\uff1a\u4e00\u672c\u7ecf\u8fc7\u4ee3\u7801\u6267\u884c\u9a8c\u8bc1\u7684\u3001\u65e0\u5e7b\u89c9\u7684\u9ad8\u8d28\u91cf\u5408\u6210\u63a8\u7406\u4e60\u9898\u96c6\u3002</p>"},{"location":"part6/6_4_synthetic_textbook/#1-project-brief","title":"1. \u9879\u76ee\u80cc\u666f (Project Brief)","text":"<ul> <li>\u4efb\u52a1\u5b9a\u4e49\uff1a \u6784\u5efa\u4e00\u4e2a\u9ad8\u8d28\u91cf\u7684\"\u601d\u7ef4\u7a0b\u5e8f\"\uff08Program of Thought, PoT\uff09\u6570\u636e\u96c6\u3002\u6211\u4eec\u5c06\u5229\u7528\u5927\u6a21\u578b\uff08DeepSeek-V3\uff09\u5c06\u7b80\u5355\u7684\u6570\u5b66\u79cd\u5b50\u95ee\u9898\"\u8fdb\u5316\"\u4e3a\u590d\u6742\u7684\u5e94\u7528\u573a\u666f\u9898\uff0c\u5e76\u5f3a\u5236\u6a21\u578b\u751f\u6210 Python \u4ee3\u7801\u6765\u89e3\u9898\uff0c\u6700\u540e\u901a\u8fc7\u6267\u884c\u4ee3\u7801\u6765\u9a8c\u8bc1\u7b54\u6848\u7684\u6b63\u786e\u6027\u3002</li> <li> <p>\u8f93\u5165\u4e0e\u8f93\u51fa\uff1a</p> <ul> <li>Input: \u57fa\u7840\u6570\u5b66\u6570\u636e\u96c6\uff08GSM8K\uff09\u7684\u539f\u59cb JSONL \u6587\u4ef6\u3002</li> <li>Output: \u6e05\u6d17\u540e\u7684 <code>verified_textbook.jsonl</code>\uff0c\u5305\u542b <code>question</code>\uff08\u8fdb\u5316\u540e\u7684\u95ee\u9898\uff09\u3001<code>thought_process</code>\uff08\u4ee3\u7801\u89e3\u9898\u601d\u8def\uff09\u3001<code>execution_output</code>\uff08\u6267\u884c\u7ed3\u679c\uff09\u3002</li> </ul> </li> <li> <p>\u96be\u70b9\u5206\u6790\uff1a</p> <ul> <li>\u5e7b\u89c9\u6d88\u9664\uff1a \u5927\u6a21\u578b\u751f\u6210\u7684\u4ee3\u7801\u7ecf\u5e38\u770b\u4f3c\u903b\u8f91\u901a\u987a\uff0c\u5b9e\u5219\u5b58\u5728\u8bed\u6cd5\u9519\u8bef\u6216\u903b\u8f91\u6f0f\u6d1e\uff08\u5982\u9664\u4ee5\u96f6\u3001\u53d8\u91cf\u672a\u5b9a\u4e49\uff09\u3002</li> <li>\u53bb\u91cd\u590d\u6742\u5ea6\uff1a \u5728\u6d77\u91cf\u6587\u672c\u4e2d\u627e\u51fa\u201c\u8bed\u4e49\u91cd\u590d\u201d\u800c\u975e\u201c\u5b8c\u5168\u4e00\u81f4\u201d\u7684\u6587\u6863\uff08Fuzzy Deduplication\uff09\uff0c\u8ba1\u7b97\u91cf\u5448\u6307\u6570\u7ea7\u589e\u957f\u3002</li> <li>\u590d\u6742\u6027\u63a7\u5236\uff1a \u5982\u4f55\u786e\u4fdd\u8fdb\u5316\u540e\u7684\u95ee\u9898\u65e2\u589e\u52a0\u4e86\u96be\u5ea6\uff0c\u53c8\u4fdd\u6301\u4e86\u6570\u5b66\u4e0a\u7684\u53ef\u89e3\u6027\u3002</li> </ul> </li> </ul>"},{"location":"part6/6_4_synthetic_textbook/#2-architecture-design","title":"2. \u67b6\u6784\u8bbe\u8ba1 (Architecture Design)","text":""},{"location":"part6/6_4_synthetic_textbook/#_2","title":"\u6570\u636e\u6d41\u6c34\u7ebf\u56fe","text":"<p> \u6211\u4eec\u5c06\u6574\u4e2a\u6d41\u7a0b\u5212\u5206\u4e3a\u4e09\u4e2a\u6838\u5fc3\u9636\u6bb5\uff1a\u79cd\u5b50\u91c7\u6837 (Sampler) -&gt; \u8fdb\u5316\u4e0e\u751f\u6210 (Evol-Generator) -&gt; \u6c99\u7bb1\u9a8c\u8bc1 (Sandbox-Validator)\u3002 \u6280\u672f\u6808\u6e05\u5355\uff1a</p> <ul> <li>\u6570\u636e\u6e90: <code>GSM8K</code> (\u903b\u8f91\u79cd\u5b50)\u3002</li> <li>\u751f\u6210\u5f15\u64ce: <code>DeepSeek-V3</code> (via SiliconFlow API) \u2014\u2014 \u9009\u62e9\u7406\u7531\uff1a\u5728\u4ee3\u7801\u751f\u6210\u548c\u6570\u5b66\u63a8\u7406\u4e0a\u8868\u73b0\u4f18\u5f02\uff0c\u4e14 API \u6210\u672c\u6781\u4f4e\u3002</li> <li>\u7f16\u6392\u903b\u8f91: Python \u539f\u751f\u811a\u672c \u2014\u2014 \u8f7b\u91cf\u7ea7\u4efb\u52a1\u7f16\u6392\u3002</li> <li>\u9a8c\u8bc1\u73af\u5883: Python <code>subprocess</code> \u2014\u2014 \u672c\u5730\u6c99\u7bb1\u73af\u5883\uff0c\u7528\u4e8e\u6355\u6349\u6267\u884c\u9519\u8bef\u548c\u8d85\u65f6\u3002</li> </ul>"},{"location":"part6/6_4_synthetic_textbook/#3-step-by-step-implementation","title":"3. Step-by-Step \u5b9e\u6218 (Implementation)","text":""},{"location":"part6/6_4_synthetic_textbook/#seed-preparation","title":"\u9636\u6bb5\u4e00\uff1a\u79cd\u5b50\u6570\u636e\u83b7\u53d6 (Seed Preparation)","text":"<p>\u4e00\u5207\u59cb\u4e8e\u9ad8\u8d28\u91cf\u7684\u79cd\u5b50\u3002\u6211\u4eec\u4e0d\u9700\u8981\u6d77\u91cf\u6570\u636e\uff0c\u53ea\u9700\u8981\u5177\u6709\u4ee3\u8868\u6027\u7684\u903b\u8f91\u5185\u6838\u3002</p> <p>\u5173\u952e\u52a8\u4f5c\uff1a \u4ece GSM8K \u8bad\u7ec3\u96c6\u4e2d\u968f\u673a\u62bd\u53d6\u6837\u672c\uff0c\u6e05\u6d17\u6389\u539f\u6709\u7684\u601d\u7ef4\u94fe\uff08CoT\uff09\uff0c\u53ea\u4fdd\u7559\u95ee\u9898\u672c\u8eab\u4f5c\u4e3a\"\u79cd\u5b50\"\u3002</p> <p>\u6838\u5fc3\u4ee3\u7801 (Sampler):</p> <pre><code># \u5f15\u7528\u81ea sampler.py\ndef sample_data():\n    # ... (\u8bfb\u53d6\u539f\u59cb\u6570\u636e)\n    # \u968f\u673a\u6253\u4e71\u5e76\u62bd\u53d6 SAMPLE_SIZE \u6761\n    sampled = random.sample(data, SAMPLE_SIZE)\n\n    with open(OUTPUT_FILE, 'w', encoding='utf-8') as f:\n        for entry in sampled:\n            # \u6211\u4eec\u53ea\u9700\u8981 question \u4f5c\u4e3a\u8fdb\u5316\u79cd\u5b50\uff0c\u4e22\u5f03\u539f\u59cb answer\n            seed_entry = {\n                \"id\": random.randint(1000, 9999), \n                \"seed_question\": entry['question'],\n                \"original_answer\": entry['answer']\n            }\n            f.write(json.dumps(seed_entry, ensure_ascii=False) + '\\n')\n</code></pre> <p>\u4ee3\u7801\u89e3\u6790\uff1a\u6211\u4eec\u7279\u610f\u4e22\u5f03\u4e86\u539f\u59cb\u7b54\u6848\uff0c\u56e0\u4e3a\u8fdb\u5316\u540e\u7684\u95ee\u9898\u6570\u503c\u53ef\u80fd\u4f1a\u53d1\u751f\u53d8\u5316\uff0c\u65e7\u7b54\u6848\u4e0d\u518d\u9002\u7528\u3002</p>"},{"location":"part6/6_4_synthetic_textbook/#evol-instruct-pot-evolution-generation","title":"\u9636\u6bb5\u4e8c\uff1aEvol-Instruct \u4e0e PoT \u751f\u6210 (Evolution &amp; Generation)","text":"<p>\u8fd9\u662f\u672c\u9879\u76ee\u7684\u6838\u5fc3\u3002\u6211\u4eec\u901a\u8fc7\u4e24\u6b21 API \u8c03\u7528\u5b8c\u6210\u4ece\"\u7b80\u5355\u95ee\u9898\"\u5230\"\u590d\u6742\u4ee3\u7801\u89e3\u6cd5\"\u7684\u8715\u53d8\u3002</p> <p>1. Prompt Engineering (\u8fdb\u5316\u6307\u4ee4): \u6211\u4eec\u9700\u8981\u6a21\u578b\u626e\u6f14\"\u6570\u5b66\u7ade\u8d5b\u547d\u9898\u4e13\u5bb6\"\uff0c\u5e76\u660e\u786e\u8981\u6c42\"\u589e\u52a0\u7ea6\u675f\u6761\u4ef6\"\u3001\"\u573a\u666f\u5316\"\u548c\"\u589e\u52a0\u63a8\u7406\u6df1\u5ea6\"\u3002</p> <pre><code># \u5f15\u7528\u81ea evol.py\ndef get_evol_prompt(seed_question):\n    return f\"\"\"\n    \u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684\u6570\u5b66\u7ade\u8d5b\u547d\u9898\u4e13\u5bb6\u3002\u8bf7\u5c06\u4e0b\u9762\u8fd9\u4e2a\u57fa\u7840\u6570\u5b66\u95ee\u9898\u91cd\u5199\u4e3a\u4e00\u4e2a\u66f4\u590d\u6742\u3001\u903b\u8f91\u66f4\u4e25\u5bc6\u7684\u95ee\u9898\u3002\n    \u3010\u539f\u9898\u3011: {seed_question}\n    \u3010\u91cd\u5199\u8981\u6c42\u3011:\n    1. \u589e\u52a0\u7ea6\u675f\u6761\u4ef6\uff1a\u5f15\u5165\u66f4\u591a\u53d8\u91cf\u6216\u9650\u5236\u3002\n    2. \u589e\u52a0\u63a8\u7406\u6df1\u5ea6\uff1a\u4e0d\u8981\u76f4\u63a5\u7ed9\u51fa\u6570\u5b57\uff0c\u8ba9\u6570\u5b57\u4e4b\u95f4\u5b58\u5728\u903b\u8f91\u5173\u8054\u3002\n    3. \u573a\u666f\u5316\uff1a\u5c06\u62bd\u8c61\u7684\u6570\u5b57\u653e\u5165\u5177\u4f53\u7684\u7269\u7406\u6216\u5546\u4e1a\u573a\u666f\u4e2d\u3002\n    4. \u4fdd\u6301\u53ef\u89e3\u6027\uff1a\u786e\u4fdd\u95ee\u9898\u4f9d\u7136\u6709\u660e\u786e\u7684\u6570\u5b66\u89e3\u3002\n    ...\n    \"\"\"\n</code></pre> <p>2. API \u8c03\u7528\u4e0e\u5bb9\u9519 (Debug \u590d\u76d8): \u5728\u5b9e\u6218\u4e2d\uff0c\u6211\u4eec\u53d1\u73b0\u957f\u601d\u7ef4\u94fe\u751f\u6210\u5bb9\u6613\u5bfc\u81f4 HTTP \u8d85\u65f6\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u5728 <code>call_siliconflow</code> \u51fd\u6570\u4e2d\u505a\u4e86\u9488\u5bf9\u6027\u4f18\u5316\u3002</p> <pre><code># \u5f15\u7528\u81ea evol.py\ndef call_siliconflow(prompt, model=MODEL_NAME, max_retries=3):\n    # ... (Header \u914d\u7f6e)\n    payload = {\n        # ...\n        \"max_tokens\": 4096, # \u589e\u52a0 token \u4e0a\u9650\uff0c\u9632\u6b62\u4ee3\u7801\u5199\u4e00\u534a\u622a\u65ad\n        \"timeout\": 180      # \u5173\u952e\u4fee\u6539\uff1atimeout \u5ef6\u957f\u5230 180 \u79d2\uff0c\u9002\u5e94\u957f\u63a8\u7406\n    }\n\n    for attempt in range(max_retries):\n        try:\n            response = requests.post(BASE_URL, json=payload, headers=headers, timeout=180)\n            if response.status_code == 200:\n                # ... \u6210\u529f\u8fd4\u56de\n            else:\n                print(f\"  [API Error] {response.status_code}...\")\n                time.sleep(5) # \u51fa\u9519\u540e\u6307\u6570\u9000\u907f\n        except requests.exceptions.Timeout:\n            print(f\"  [Timeout] \u8bf7\u6c42\u8d85\u65f6 (\u8d85\u8fc7180\u79d2)\uff0c\u6b63\u5728\u91cd\u8bd5...\")\n            # ...\n</code></pre> <p>\u7ecf\u9a8c\u603b\u7ed3\uff1a\u751f\u6210\u4ee3\u7801\u901a\u5e38\u6bd4\u751f\u6210\u666e\u901a\u6587\u672c\u6162\u5f97\u591a\uff0c\u5fc5\u987b\u663e\u5f0f\u8bbe\u7f6e\u8f83\u957f\u7684 <code>timeout</code>\uff0c\u5426\u5219 requests \u5e93\u9ed8\u8ba4\u4f1a\u8f83\u5feb\u65ad\u5f00\u8fde\u63a5\u3002</p>"},{"location":"part6/6_4_synthetic_textbook/#sandbox-verification","title":"\u9636\u6bb5\u4e09\uff1a\u6c99\u7bb1\u9a8c\u8bc1 (Sandbox Verification)","text":"<p>\u751f\u6210\u7684\u6570\u636e\u4e2d\u7ea6\u6709 20%-30% \u662f\u4e0d\u53ef\u6267\u884c\u7684\uff08\u6b7b\u5faa\u73af\u3001\u4f9d\u8d56\u7f3a\u5931\u3001\u8bed\u6cd5\u9519\u8bef\uff09\u3002\u6c99\u7bb1\u7684\u4f5c\u7528\u5c31\u662f\u5145\u5f53\u8fc7\u6ee4\u5668\u3002</p> <p>1. \u4ee3\u7801\u63d0\u53d6\uff1a \u5927\u6a21\u578b\u8f93\u51fa\u7684\u4ee3\u7801\u5757\u683c\u5f0f\u4e0d\u7edf\u4e00\uff0c\u9700\u8981\u7528\u6b63\u5219\u517c\u5bb9 <code>```python</code> \u548c ````` \u4e24\u79cd\u683c\u5f0f\u3002</p> <pre><code># \u5f15\u7528\u81ea sandbox.py\ndef extract_python_code(text):\n    # \u4f18\u5148\u5339\u914d python \u6807\u7b7e\n    pattern = r\"```python\\s*(.*?)\\s*```\"\n    match = re.search(pattern, text, re.DOTALL)\n    if match: return match.group(1)\n\n    # \u515c\u5e95\u5339\u914d\u901a\u7528\u4ee3\u7801\u5757\n    pattern_generic = r\"```\\s*(.*?)\\s*```\"\n    # ...\n</code></pre> <p>2. \u6267\u884c\u4e0e\u8d85\u65f6\u63a7\u5236\uff1a \u8fd9\u662f\u6700\u5371\u9669\u7684\u73af\u8282\u3002\u4e3a\u4e86\u9632\u6b62\u6a21\u578b\u751f\u6210\u7684\u4ee3\u7801\u5305\u542b\u6b7b\u5faa\u73af\uff08<code>while True</code>\uff09\u5361\u6b7b\u6574\u4e2a\u6d41\u6c34\u7ebf\uff0c\u5fc5\u987b\u8bbe\u7f6e <code>subprocess</code> \u7684\u8d85\u65f6\u65f6\u95f4\u3002</p> <pre><code># \u5f15\u7528\u81ea sandbox.py\ndef execute_code(code, timeout=5):\n    try:\n        # \u4f7f\u7528 subprocess \u542f\u52a8\u4e00\u4e2a\u65b0\u7684 Python \u8fdb\u7a0b\u6267\u884c\u4ee3\u7801\n        result = subprocess.run(\n            ['python3', '-c', code],\n            capture_output=True,\n            text=True,\n            timeout=timeout # \u6838\u5fc3\u5b89\u5168\u914d\u7f6e\uff1a5\u79d2\u5185\u8dd1\u4e0d\u5b8c\u76f4\u63a5\u6740\u8fdb\u7a0b\n        )\n\n        if result.returncode == 0:\n            return True, result.stdout.strip()\n        else:\n            return False, f\"Error: {result.stderr.strip()}\"\n\n    except subprocess.TimeoutExpired:\n        return False, \"Error: Execution Timed Out\"\n</code></pre>"},{"location":"part6/6_4_synthetic_textbook/#4-showcase","title":"4. \u6548\u679c\u5c55\u793a (Showcase)","text":"<p>\u7ecf\u8fc7\u6c99\u7bb1\u6e05\u6d17\u540e\uff0c\u6211\u4eec\u5f97\u5230\u4e86 <code>verified_textbook.jsonl</code>\u3002\u4ee5\u4e0b\u662f\u4e00\u6761\u5178\u578b\u7684\u8fdb\u5316\u6837\u672c\u5bf9\u6bd4\uff1a</p> \u7ef4\u5ea6 \u5185\u5bb9\u793a\u4f8b \u539f\u59cb\u79cd\u5b50 \u4e00\u5217\u706b\u8f66\u6bcf\u5c0f\u65f6\u884c\u9a76 60 \u82f1\u91cc\uff0c\u884c\u9a76 240 \u82f1\u91cc\u9700\u8981\u591a\u4e45\uff1f Evol \u8fdb\u5316 \u4e00\u5217\u8d27\u8fd0\u5217\u8f66\u4e0d\u4ec5\u53d7\u901f\u5ea6\u9650\u5236\uff0c\u8fd8\u53d7\u590d\u6742\u7684\u505c\u9760\u8ba1\u5212\u5f71\u54cd\u3002\u5217\u8f66\u57fa\u7840\u901f\u5ea6\u4e3a 60 \u82f1\u91cc/\u5c0f\u65f6\uff0c\u4f46\u6bcf\u884c\u9a76 100 \u82f1\u91cc\u5fc5\u987b\u505c\u9760 15 \u5206\u949f\u8fdb\u884c\u5b89\u5168\u68c0\u67e5\u3002\u8bf7\u7f16\u5199\u7a0b\u5e8f\u8ba1\u7b97\u884c\u9a76 240 \u82f1\u91cc\u6240\u9700\u7684\u603b\u5206\u949f\u6570\u3002 PoT \u89e3\u6cd5 <code>def solve(): distance = 240; speed = 60; travel_time = (distance/speed)*60; stops = int(distance/100); total_time = travel_time + (stops * 15); return total_time</code> \u9a8c\u8bc1\u7ed3\u679c <code>SUCCESS: 270.0</code> (\u4ee3\u7801\u903b\u8f91\u6b63\u786e\uff0c\u65e0\u8bed\u6cd5\u9519\u8bef\uff0c\u6210\u529f\u5b58\u5165\u6570\u636e\u96c6) <p>\u6570\u636e\u8d28\u91cf\u7edf\u8ba1\uff1a \u5728\u4e00\u6b21 1000 \u6761\u6837\u672c\u7684\u8dd1\u6d4b\u4e2d\uff0c\u901a\u8fc7\u7387\u4e3a 82%\u3002</p> <ul> <li>18% \u7684\u5931\u8d25\u539f\u56e0\u4e3b\u8981\u5305\u62ec\uff1a</li> <li><code>SyntaxError</code>: \u751f\u6210\u4e86\u4e0d\u5b8c\u6574\u7684\u4ee3\u7801\u5757\u3002</li> <li><code>Timeout</code>: \u66b4\u529b\u7a77\u4e3e\u7b97\u6cd5\u5bfc\u81f4\u8fd0\u884c\u8d85\u8fc7 5 \u79d2\u3002</li> <li><code>LogicError</code>: \u5f15\u7528\u4e86\u4e0d\u5b58\u5728\u7684\u53d8\u91cf\uff08\u5e7b\u89c9\uff09\u3002 \u901a\u8fc7\u5254\u9664\u8fd9 18% \u7684\"\u6709\u6bd2\"\u6570\u636e\uff0c\u6211\u4eec\u4fdd\u8bc1\u4e86\u6559\u79d1\u4e66\u7684\u4e25\u8c28\u6027\u3002</li> </ul> \u9636\u6bb5 \u5185\u5bb9\u793a\u4f8b \u539f\u59cb\u79cd\u5b50 \u73cd\u59ae\u67095\u4e2a\u82f9\u679c\uff0c\u5403\u4e862\u4e2a\uff0c\u8fd8\u5269\u51e0\u4e2a\uff1f Evol \u8fdb\u5316 \u73cd\u59ae\u7ecf\u8425\u4e00\u5bb6\u6c34\u679c\u5e97\uff0c\u5e93\u5b585\u7bb1\u82f9\u679c\uff08\u6bcf\u7bb112\u4e2a\uff09\u3002\u5468\u4e00\u5979\u5356\u51fa\u4e86\u5e93\u5b58\u768440%\uff0c\u4e14\u7531\u4e8e\u5b58\u50a8\u4e0d\u5f53\u635f\u8017\u4e862\u4e2a\u5355\u54c1\u3002\u8bf7\u8ba1\u7b97\u5269\u4f59\u53ef\u552e\u5356\u7684\u82f9\u679c\u5177\u4f53\u6570\u91cf\u3002 PoT \u89e3\u6cd5 <code>def solve(): total = 5 * 12; sold = total * 0.4; ... return remaining</code> \u6267\u884c\u7ed3\u679c <code>34</code> (\u9a8c\u8bc1\u901a\u8fc7\uff0c\u5b58\u5165\u6570\u636e\u96c6)"},{"location":"part6/6_4_synthetic_textbook/#5-cost-optimization","title":"5. \u6210\u672c\u4e0e\u4f18\u5316 (Cost &amp; Optimization)","text":""},{"location":"part6/6_4_synthetic_textbook/#_3","title":"\u8d44\u6e90\u6d88\u8017","text":"<ul> <li>\u65f6\u95f4\u6210\u672c\uff1a \u751f\u6210\u4e00\u6761\u590d\u6742\u6570\u636e\uff08Evol+Code\uff09\u7ea6\u9700 30-60 \u79d2\u3002</li> <li>\u8ba1\u7b97\u6210\u672c\uff1a DeepSeek-V3 \u7684\u4ef7\u683c\u6781\u4f4e\uff0c\u751f\u6210 1000 \u6761\u9ad8\u8d28\u91cf\u9a8c\u8bc1\u6570\u636e\u7684 API \u6210\u672c\u4e0d\u5230 $1\u3002</li> <li>\u5b58\u50a8\u6210\u672c\uff1a \u7eaf\u6587\u672c JSONL\uff0c\u51e0\u4e4e\u53ef\u4ee5\u5ffd\u7565\u4e0d\u8ba1\u3002</li> </ul>"},{"location":"part6/6_4_synthetic_textbook/#_4","title":"\u6027\u80fd\u74f6\u9888\u4e0e\u4f18\u5316","text":"<ul> <li>\u4e32\u884c vs \u5e76\u884c\uff1a \u5f53\u524d <code>evol.py</code> \u4f7f\u7528\u5355\u7ebf\u7a0b <code>tqdm</code> \u5faa\u73af\uff0c\u5904\u7406\u901f\u5ea6\u8f83\u6162\u3002</li> <li>\u4f18\u5316\u65b9\u6848\uff1a \u751f\u4ea7\u73af\u5883\u5e94\u5f15\u5165 Python \u7684 <code>ThreadPoolExecutor</code> \u6216\u4f7f\u7528 <code>Celery</code> + <code>RabbitMQ</code> \u5c06\u751f\u6210\u4efb\u52a1\u5206\u53d1\u5230\u591a\u4e2a Worker \u8282\u70b9\uff0c\u5c06\u541e\u5410\u91cf\u63d0\u5347 10-50 \u500d\u3002</li> </ul>"},{"location":"part6/6_4_synthetic_textbook/#critical","title":"\u5b89\u5168\u6027 (Critical)","text":"<ul> <li>\u5f53\u524d\u4ee3\u7801\u5728\u672c\u5730\u76f4\u63a5\u8fd0\u884c (<code>python3 -c code</code>)\u3002\u5982\u679c\u6a21\u578b\u751f\u6210\u6076\u610f\u4ee3\u7801\uff08\u5982 <code>os.system(\"rm -rf /\")</code>\uff09\uff0c\u5c06\u9020\u6210\u707e\u96be\u6027\u540e\u679c\u3002</li> <li>\u751f\u4ea7\u7ea7\u6539\u9020\uff1a \u5fc5\u987b\u5c06 <code>sandbox.py</code> \u5c01\u88c5\u8fdb Docker \u5bb9\u5668 \u6216 gVisor \u4e2d\uff0c\u5e76\u7981\u7528\u5bb9\u5668\u7684\u7f51\u7edc\u6743\u9650\uff0c\u5b9e\u73b0\u771f\u6b63\u7684\"\u6c99\u7bb1\u9694\u79bb\"\u3002</li> </ul>"},{"location":"part6/6_5_mm_rag/","title":"\u9879\u76ee\u4e94\uff1a\u591a\u6a21\u6001RAG\u4f01\u4e1a\u8d22\u62a5\u52a9\u624b","text":""},{"location":"part6/6_5_mm_rag/#rag","title":"\u9879\u76ee\u4e94\uff1a\u591a\u6a21\u6001 RAG \u4f01\u4e1a\u8d22\u62a5\u52a9\u624b","text":"<p>\u9002\u7528\u8303\u56f4\uff1aCapstone Projects - \u89e3\u51b3\u590d\u6742\u6587\u6863\uff08\u56fe\u8868\u3001\u8868\u683c\uff09\u68c0\u7d22\u96be\u9898</p> <ul> <li>\u4efb\u52a1\u5b9a\u4e49\uff1a \u6784\u5efa\u4e00\u4e2a\u80fd\u591f\"\u770b\u61c2\"\u4f01\u4e1a\u5e74\u62a5\u4e2d\u590d\u6742\u56fe\u8868\u4e0e\u6570\u636e\u8868\u683c\u7684 RAG \u7cfb\u7edf\u3002\u8be5\u7cfb\u7edf\u4e0d\u4f9d\u8d56 OCR \u8f6c\u6587\u5b57\uff0c\u800c\u662f\u901a\u8fc7\u89c6\u89c9\u68c0\u7d22\uff08Visual Retrieval\uff09\u5b9a\u4f4d\u9875\u9762\uff0c\u5e76\u5229\u7528\u591a\u6a21\u6001\u5927\u6a21\u578b\uff08VLM\uff09\u5b9e\u73b0\u5bf9\u8d22\u62a5\u56fe\u8868\u8d8b\u52bf\u3001\u8de8\u9875\u8868\u683c\u7684\u6df1\u5ea6\u95ee\u7b54\u3002</li> <li> <p>\u8f93\u5165\u4e0e\u8f93\u51fa\uff1a</p> <ul> <li>Input: PDF \u683c\u5f0f\u7684\u4f01\u4e1a\u5e74\u5ea6\u8d22\u52a1\u62a5\u544a\uff08\u5305\u542b\u6df7\u5408\u6392\u7248\u7684\u6587\u672c\u3001\u8de8\u9875\u8868\u683c\u3001\u8d8b\u52bf\u6298\u7ebf\u56fe\u3001\u997c\u56fe\u7b49\uff0c\u4f8b\u5982\u300a\u534e\u4e3a2024\u5e74\u5e74\u5ea6\u62a5\u544a\u300b\uff09\u3002</li> <li>Output: \u57fa\u4e8e\u56fe\u8868\u6570\u636e\u8d8b\u52bf\u548c\u5177\u4f53\u6570\u503c\u7684\u81ea\u7136\u8bed\u8a00\u5206\u6790\u56de\u7b54\uff08\u5982\uff1a\"\u7814\u53d1\u8d39\u7528\u5360\u6bd4\u591a\u5c11\uff1f\u8d8b\u52bf\u5982\u4f55\uff1f\"\uff09\u3002</li> </ul> </li> <li> <p>\u96be\u70b9\u5206\u6790\uff1a</p> <ul> <li>\u7ed3\u6784\u4e22\u5931 (Structure Loss)\uff1a\u4f20\u7edf RAG \u4f7f\u7528 OCR \u8f6c\u6587\u5b57\uff0c\u5bb9\u6613\u4e22\u5931\u8868\u683c\u7684\u884c\u5217\u5bf9\u5e94\u5173\u7cfb\uff0c\u4e14\u5b8c\u5168\u65e0\u6cd5\u5904\u7406\u4e0d\u5e26\u6587\u5b57\u8bf4\u660e\u7684\u8d8b\u52bf\u56fe\u3002</li> <li>\u8bed\u4e49\u65ad\u5c42 (Semantic Gap)\uff1a\u8d22\u62a5\u4e2d\u5e38\u51fa\u73b0\"\u89c1\u4e0b\u56fe\"\u7684\u6307\u4ee3\uff0c\u6587\u672c\u4e0e\u56fe\u8868\u5206\u79bb\u5bfc\u81f4\u4f20\u7edf Embedding \u68c0\u7d22\u622a\u65ad\u3002</li> <li>\u68c0\u7d22\u566a\u97f3 (Retrieval Noise)\uff1a\u76ee\u5f55\u9875\uff08Table of Contents\uff09\u5e38\u5305\u542b\u6240\u6709\u5173\u952e\u8bcd\uff0c\u6781\u6613\u88ab\u8bef\u53ec\u56de\uff0c\u4ece\u800c\u6324\u5360\u4e0a\u4e0b\u6587\u7a97\u53e3\uff0c\u5bfc\u81f4\u6a21\u578b\u53ea\u80fd\u770b\u5230\u76ee\u5f55\u800c\u770b\u4e0d\u5230\u6570\u636e\u3002</li> </ul> </li> </ul>"},{"location":"part6/6_5_mm_rag/#2-architecture-design","title":"2. \u67b6\u6784\u8bbe\u8ba1 (Architecture Design)","text":"<p>\u672c\u9879\u76ee\u7684\u6838\u5fc3\u7406\u5ff5\u662f \"ViR (Vision in Retrieval) + VLM (Vision Language Model)\"\u3002\u6211\u4eec\u4e0d\u518d\u5c06 PDF \u5f3a\u884c\u8f6c\u4e3a\u6587\u672c\uff0c\u800c\u662f\u5229\u7528 ColPali \u5c06\u6bcf\u4e00\u9875 PDF \u89c6\u4e3a\u4e00\u5f20\u56fe\u7247\u8fdb\u884c\u89c6\u89c9\u7f16\u7801\uff0c\u76f4\u63a5\u68c0\u7d22\u89c6\u89c9\u7279\u5f81\uff0c\u6700\u540e\u5c06\u547d\u4e2d\u7684\u56fe\u7247\u539f\u56fe\u5582\u7ed9\u591a\u6a21\u6001\u5927\u6a21\u578b\u8fdb\u884c\u89e3\u8bfb\u3002</p>"},{"location":"part6/6_5_mm_rag/#_1","title":"\u6570\u636e\u6d41\u6c34\u7ebf\u56fe","text":"<p>\u6570\u636e\u6d41\u8f6c\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>Indexing: PDF \u6587\u6863 -&gt; \u8f6c\u6362\u4e3a\u9875\u9762\u622a\u56fe -&gt; ColPali \u89c6\u89c9\u7f16\u7801 -&gt; Byaldi \u5411\u91cf\u5e93\u5b58\u50a8\u3002</li> <li>Retrieval: \u7528\u6237 Query -&gt; ColPali \u7f16\u7801 -&gt; \u591a\u8def\u53ec\u56de (Top-K Pages) -&gt; \u8fc7\u6ee4\u76ee\u5f55\u9875\u3002</li> <li>Generation: \u7ec4\u5408 Prompt + \u591a\u5f20\u9ad8\u6e05\u622a\u56fe -&gt; Qwen2.5-VL -&gt; \u6700\u7ec8\u7b54\u6848\u3002</li> </ol>"},{"location":"part6/6_5_mm_rag/#_2","title":"\u6280\u672f\u6808\u6e05\u5355","text":"\u7ec4\u4ef6 \u5de5\u5177/\u6a21\u578b \u9009\u62e9\u7406\u7531 \u89c6\u89c9\u68c0\u7d22\u6a21\u578b ColPali (v1_2) \u5f53\u524d SOTA \u7684\u6587\u6863\u68c0\u7d22\u6a21\u578b\uff0c\u57fa\u4e8e PaliGemma\uff0c\u80fd\u7406\u89e3\u9875\u9762\u5e03\u5c40\u3001\u5b57\u4f53\u5927\u5c0f\u548c\u56fe\u8868\u89c6\u89c9\u7279\u5f81\uff0c\u65e0\u9700 OCR\u3002 \u7d22\u5f15\u6846\u67b6 Byaldi ColPali \u7684\u8f7b\u91cf\u7ea7\u5c01\u88c5\u5e93\uff0c\u7b80\u5316\u4e86\u591a\u6a21\u6001\u6a21\u578b\u7684\u5f20\u91cf\u5b58\u50a8\u548c\u68c0\u7d22\u6d41\u7a0b\uff0c\u652f\u6301\u672c\u5730\u6a21\u578b\u52a0\u8f7d\u3002 \u591a\u6a21\u6001\u5927\u6a21\u578b Qwen2.5-VL-72B \u963f\u91cc\u901a\u4e49\u5343\u95ee\u6700\u65b0\u89c6\u89c9\u6a21\u578b\uff0c\u5728\u56fe\u8868\u7406\u89e3\uff08ChartQA\uff09\u548c\u6587\u6863\u89e3\u6790\uff08DocVQA\uff09\u4efb\u52a1\u4e0a\u8868\u73b0\u6781\u4f73\uff0c\u7279\u522b\u9002\u5408\u5904\u7406\u5bc6\u96c6\u6570\u636e\u3002"},{"location":"part6/6_5_mm_rag/#3-step-by-step-implementation","title":"3. Step-by-Step \u5b9e\u6218 (Implementation)","text":""},{"location":"part6/6_5_mm_rag/#visual-indexing","title":"\u9636\u6bb5\u4e00\uff1a\u89c6\u89c9\u7d22\u5f15\u6784\u5efa (Visual Indexing)","text":"<p>\u4e0d\u540c\u4e8e\u4f20\u7edf RAG \u7684 <code>Chunking -&gt; Embedding</code>\uff0c\u8fd9\u91cc\u6211\u4eec\u8fdb\u884c\u7684\u662f <code>Page -&gt; Screenshot -&gt; Visual Embedding</code>\u3002\u4e3a\u4e86\u907f\u514d\u91cd\u590d\u4e0b\u8f7d\u6a21\u578b\uff0c\u6211\u4eec\u7279\u522b\u5f3a\u8c03\u4e86\u672c\u5730\u6a21\u578b\u52a0\u8f7d\u548c\u8def\u5f84\u68c0\u67e5\u903b\u8f91\u3002</p> <p>\u5173\u952e\u4ee3\u7801\u903b\u8f91 (<code>index.py</code>)\uff1a</p> <pre><code>import os\nfrom byaldi import RAGMultiModalModel\n\n# 1. \u5f3a\u5236\u79bb\u7ebf\u6a21\u5f0f &amp; \u955c\u50cf\u6e90 (\u56fd\u5185\u7f51\u7edc\u73af\u5883\u4f18\u5316)\nos.environ[\"HF_HUB_OFFLINE\"] = \"1\" \nos.environ[\"HF_ENDPOINT\"] = \"https://hf-mirror.com\" \n\nMODEL_PATH = \"/path/to/models/colpali-v1_2-merged\"\nINDEX_NAME = \"finance_report_2024\"\n\ndef build_index():\n    # 2. \u8def\u5f84\u9632\u5fa1\u6027\u68c0\u67e5\n    if not os.path.exists(MODEL_PATH):\n        print(f\"\u274c \u9519\u8bef\uff1a\u627e\u4e0d\u5230\u6a21\u578b\u6587\u4ef6\u5939\uff01{MODEL_PATH}\")\n        return\n\n    # 3. \u521d\u59cb\u5316\u6a21\u578b \n    # \u6ce8\u610f\uff1aByaldi \u4f1a\u5c06 PDF \u8f6c\u4e3a\u56fe\u7247\uff0c\u8ba1\u7b97\u89c6\u89c9\u5411\u91cf\u5e76\u5b58\u50a8\n    # \u5982\u679c\u663e\u5b58\u4e0d\u8db3 (OOM)\uff0c\u53ef\u6dfb\u52a0 load_in_4bit=True\n    try:\n        RAG = RAGMultiModalModel.from_pretrained(MODEL_PATH, verbose=1)\n    except Exception as e:\n        print(f\"\u274c \u6a21\u578b\u52a0\u8f7d\u5931\u8d25: {e}\")\n        return\n\n    # 4. \u5efa\u7acb\u7d22\u5f15\u5e76\u5b58\u50a8\n    RAG.index(\n        input_path=\"annual_report_2024_cn.pdf\",\n        index_name=INDEX_NAME,\n        store_collection_with_index=True, # \u5fc5\u987b\u5b58\u50a8\u539f\u56fe\u5f15\u7528\uff0c\u5426\u5219\u65e0\u6cd5\u505a\u751f\u6210\n        overwrite=True\n    )\n</code></pre>"},{"location":"part6/6_5_mm_rag/#multi-page-retrieval","title":"\u9636\u6bb5\u4e8c\uff1a\u591a\u8def\u89c6\u89c9\u68c0\u7d22 (Multi-Page Retrieval)","text":"<p>\u8d22\u62a5\u95ee\u7b54\u7684\u4e00\u4e2a\u5178\u578b\u5751\u70b9\u662f\uff1a\u5173\u952e\u8bcd\"\u7ecf\u8425\u7ed3\u679c\"\u5728\u76ee\u5f55\u9875\u4e5f\u4f1a\u51fa\u73b0\u3002\u5982\u679c\u53ea\u68c0\u7d22 Top-1\uff0c\u5f88\u53ef\u80fd\u53ea\u62ff\u5230\u76ee\u5f55\uff0c\u5bfc\u81f4\u6a21\u578b\u65e0\u6cd5\u56de\u7b54\u3002\u56e0\u6b64\uff0c\u7b56\u7565\u4e0a\u9700\u8981\u68c0\u7d22 Top-K (\u5efa\u8bae 4-5 \u9875) \u5e76\u8fc7\u6ee4\u3002</p> <p>\u5173\u952e\u4ee3\u7801\u903b\u8f91 (<code>rag_chat.py</code> - Retrieval Part)\uff1a</p> <pre><code># \u52a0\u8f7d\u7d22\u5f15\nRAG = RAGMultiModalModel.from_index(INDEX_NAME)\n\n# \u589e\u52a0\u68c0\u7d22\u9875\u6570\uff0c\u9632\u6b62\u53ea\u547d\u4e2d\u76ee\u5f55\u9875\nRETRIEVAL_K = 4 \n\n# \u6267\u884c\u68c0\u7d22\n# \u7ed3\u679c\u5305\u542b\uff1apage_num (\u9875\u7801), base64 (\u56fe\u7247\u6570\u636e), score (\u76f8\u5173\u6027)\nresults = RAG.search(user_query, k=RETRIEVAL_K)\n\nif not results:\n    print(\"\u26a0\ufe0f \u672a\u627e\u5230\u76f8\u5173\u6587\u6863\u9875\u9762\u3002\")\n</code></pre>"},{"location":"part6/6_5_mm_rag/#multi-image-generation","title":"\u9636\u6bb5\u4e09\uff1a\u591a\u56fe\u4e0a\u4e0b\u6587\u751f\u6210 (Multi-Image Generation)","text":"<p>\u6211\u4eec\u5c06\u68c0\u7d22\u5230\u7684 K \u5f20\u56fe\u7247\u5168\u90e8\u4f5c\u4e3a\u4e0a\u4e0b\u6587\u5582\u7ed9 VLM\uff0c\u5229\u7528\u6a21\u578b\u7684\u957f\u7a97\u53e3\u548c\u591a\u56fe\u5904\u7406\u80fd\u529b\u8fdb\u884c\u7efc\u5408\u5206\u6790\u3002\u6784\u5efa Payload \u662f\u6b64\u9636\u6bb5\u7684\u6838\u5fc3\u3002</p> <p>\u5173\u952e\u4ee3\u7801\u903b\u8f91 (<code>rag_chat.py</code> - Generation Part)\uff1a</p> <pre><code># \u6784\u5efa\u591a\u6a21\u6001 Payload\ncontent_payload = []\n\n# 1. System Prompt: \u660e\u786e\u89d2\u8272\u4e0e\u6297\u5e72\u6270\u6307\u4ee4\n# \u5173\u952e\u70b9\uff1a\u663e\u5f0f\u544a\u8bc9\u6a21\u578b\u5ffd\u7565\u76ee\u5f55\u9875\ncontent_payload.append({\n    \"type\": \"text\", \n    \"text\": f\"\u4f60\u662f\u4e00\u4e2a\u4e13\u4e1a\u7684CFO\u52a9\u624b\u3002\u6211\u7ed9\u4f60\u63d0\u4f9b\u4e86 {len(results)} \u5f20\u8d22\u62a5\u622a\u56fe\u3002\u8bf7\u6ce8\u610f\uff1a\u5176\u4e2d\u53ef\u80fd\u5305\u542b\u76ee\u5f55\u9875\uff0c\u8bf7\u5ffd\u7565\u76ee\u5f55\uff0c\u76f4\u63a5\u6839\u636e\u5305\u542b\u5177\u4f53\u6570\u636e\u7684\u9875\u9762\u56de\u7b54\u95ee\u9898\uff1a{user_query}\u3002\\n\u5982\u679c\u5305\u542b\u56fe\u8868\uff0c\u8bf7\u8be6\u7ec6\u89e3\u8bfb\u6570\u636e\u8d8b\u52bf\u3002\"\n})\n\n# 2. \u6ce8\u5165\u591a\u5f20\u56fe\u7247\nfor res in results:\n    content_payload.append({\n        \"type\": \"image_url\",\n        \"image_url\": {\n            # \u76f4\u63a5\u4f7f\u7528 Base64 \u7f16\u7801\u6ce8\u5165\u56fe\u7247\n            \"url\": f\"data:image/jpeg;base64,{res.base64}\", \n            \"detail\": \"high\" # \u5f00\u542f\u9ad8\u6e05\u6a21\u5f0f\u4ee5\u8bc6\u522b\u8d22\u62a5\u4e2d\u7684\u5c0f\u5b57\n        }\n    })\n\n# 3. \u53d1\u9001\u7ed9 Qwen2.5-VL-72B (\u901a\u8fc7 OpenAI SDK \u517c\u5bb9\u63a5\u53e3)\nresponse = client.chat.completions.create(\n    model=\"Qwen/Qwen2.5-VL-72B-Instruct\",\n    messages=[{\"role\": \"user\", \"content\": content_payload}],\n    temperature=0.1, # \u4fdd\u6301\u4e8b\u5b9e\u6027\uff0c\u907f\u514d\u5e7b\u89c9\n    max_tokens=2048  # \u5206\u6790\u591a\u9875\u5185\u5bb9\u9700\u8981\u8f83\u957f\u8f93\u51fa\n)\n</code></pre>"},{"location":"part6/6_5_mm_rag/#4-showcase","title":"4. \u6548\u679c\u5c55\u793a (Showcase)","text":"<p>\u4ee5\u4e0b\u662f\u7cfb\u7edf\u9488\u5bf9\u534e\u4e3a 2024 \u8d22\u62a5\u7684\u771f\u5b9e\u8fd0\u884c\u8bb0\u5f55\u3002\u53ef\u4ee5\u770b\u5230\u7cfb\u7edf\u6210\u529f\u8df3\u8fc7\u4e86\u76ee\u5f55\u9875\uff0c\u7efc\u5408\u4e86\u7b2c 49\u300191\u3001130\u30018 \u9875\u7684\u4fe1\u606f\uff0c\u5bf9\u7814\u53d1\u6295\u5165\u3001\u65e0\u5f62\u8d44\u4ea7\u53d8\u5316\u8fdb\u884c\u4e86\u91cf\u5316\u5206\u6790\u3002</p> <pre><code>&gt;&gt;&gt; \u8bf7\u63d0\u95ee: \u7ecf\u8425\u7ed3\u679c\u5982\u4f55\uff1f\n\n\ud83d\udd0d \u6b63\u5728\u68c0\u7d22 Top-4 \u4e2a\u76f8\u5173\u9875\u9762...\n\ud83d\udcc4 \u547d\u4e2d\u9875\u7801: [49] [91] [130] [8]\n\ud83d\ude80 \u6b63\u5728\u53d1\u9001\u7ed9\u5927\u6a21\u578b\u8fdb\u884c\u7efc\u5408\u5206\u6790...\n\n\ud83e\udd16 \u8d22\u62a5\u52a9\u624b\u56de\u7b54:\n----------------------------------------\n\u4ece\u63d0\u4f9b\u7684\u8d22\u62a5\u622a\u56fe\u6765\u770b\uff0c\u7ecf\u8425\u7ed3\u679c\u53ef\u4ee5\u4ece\u4ee5\u4e0b\u51e0\u4e2a\u65b9\u9762\u8fdb\u884c\u5206\u6790\uff1a\n\n### 1. **\u7814\u53d1\u4e0e\u521b\u65b0\u6295\u5165**\n- **\u7814\u53d1\u8d39\u7528**\uff1a2024\u5e74\uff0c\u7814\u53d1\u8d39\u7528\u652f\u51fa\u4e3a\u4eba\u6c11\u5e011,797\u4ebf\u5143\uff0c\u5360\u5168\u5e74\u6536\u5165\u768420.8%\u3002\u8fd1\u5341\u5e74\u7d2f\u8ba1\u6295\u5165\u7684\u7814\u53d1\u8d39\u7528\u8d85\u8fc7\u4eba\u6c11\u5e0112,490\u4ebf\u5143\u3002\u8fd9\u8868\u660e\u516c\u53f8\u5728\u7814\u53d1\u548c\u521b\u65b0\u65b9\u9762\u6301\u7eed\u6295\u5165\u5927\u91cf\u8d44\u6e90\uff0c\u81f4\u529b\u4e8e\u6280\u672f\u7684\u7a81\u7834\u548c\u4ea7\u54c1\u7684\u5347\u7ea7\u3002\n- **\u7814\u53d1\u4eba\u5458**\uff1a\u622a\u81f32024\u5e7412\u670831\u65e5\uff0c\u7814\u53d1\u5458\u5de5\u7ea611.3\u4e07\u540d\uff0c\u5360\u603b\u5458\u5de5\u6570\u91cf\u768454.1%\uff0c\u663e\u793a\u51fa\u516c\u53f8\u5bf9\u7814\u53d1\u56e2\u961f\u7684\u91cd\u89c6\u548c\u5bf9\u6280\u672f\u521b\u65b0\u7684\u6301\u7eed\u6295\u5165\u3002\n\n### 2. **\u65e0\u5f62\u8d44\u4ea7**\n- **\u5546\u8a89\u53ca\u65e0\u5f62\u8d44\u4ea7**\uff1a\u622a\u56fe\u663e\u793a\u4e86\u5546\u8a89\u3001\u8f6f\u4ef6\u3001\u4e13\u5229\u6743\u53ca\u7279\u8bb8\u6743\u4f7f\u7528\u8d39\u3001\u5546\u6807\u4f7f\u7528\u6743\u53ca\u5176\u4ed6\u65e0\u5f62\u8d44\u4ea7\u7684\u8be6\u7ec6\u6570\u636e\u3002\u4ece2023\u5e74\u52302024\u5e74\uff0c\u5546\u8a89\u4ece4,424\u767e\u4e07\u5143\u589e\u52a0\u52304,496\u767e\u4e07\u5143...\uff08\u4e2d\u7565\uff09...\u8fd9\u8868\u660e\u516c\u53f8\u5728\u65e0\u5f62\u8d44\u4ea7\u65b9\u9762\u6301\u7eed\u589e\u957f\u3002\n\n### 3. **\u793e\u4f1a\u8d23\u4efb\u4e0e\u53ef\u6301\u7eed\u53d1\u5c55**\n- **\u79d1\u6280\u5c0f\u5b66\u5802\u9879\u76ee**\uff1a\u534e\u4e3a\u6b63\u5f0f\u53d1\u8d77\"\u79d1\u6280\u5c0f\u5b66\u5802\"\u9879\u76ee...\uff08\u4e2d\u7565\uff09\n\n### 4. **\u8463\u4e8b\u957f\u81f4\u8f9e**\n- **\u6218\u7565\u805a\u7126\u4e0e\u6301\u7eed\u521b\u65b0**\uff1a\u8463\u4e8b\u957f\u5728\u81f4\u8f9e\u4e2d\u63d0\u5230\uff0c2024\u5e74\u662f\u5145\u6ee1\u6311\u6218\u7684\u4e00\u5e74\uff0c\u534e\u4e3a\u5168\u4f53\u5458\u5de5\u575a\u5b9a\u4fe1\u5fc3\u3001\u79ef\u6781\u594b\u8fdb\uff0c\u5b9e\u73b0\u4e1a\u52a1\u53d1\u5c55\u76ee\u6807\uff0c\u6574\u4f53\u7ecf\u8425\u8fbe\u5230\u9884\u671f...\n\n\u7efc\u4e0a\u6240\u8ff0\uff0c\u534e\u4e3a\u57282024\u5e74\u7684\u7ecf\u8425\u7ed3\u679c\u8868\u73b0\u51fa\u8272\uff0c\u516c\u53f8\u5728\u7814\u53d1\u4e0e\u521b\u65b0\u3001\u65e0\u5f62\u8d44\u4ea7\u3001\u793e\u4f1a\u8d23\u4efb\u4e0e\u53ef\u6301\u7eed\u53d1\u5c55\u7b49\u65b9\u9762\u5747\u53d6\u5f97\u4e86\u663e\u8457\u6210\u5c31\u3002\n----------------------------------------\n</code></pre>"},{"location":"part6/6_5_mm_rag/#5-cost-optimization","title":"5. \u6210\u672c\u4e0e\u4f18\u5316 (Cost &amp; Optimization)","text":""},{"location":"part6/6_5_mm_rag/#rag-rag","title":"\u5728\u4f01\u4e1a\u7ea7\u843d\u5730\u4e2d\uff0c\u591a\u6a21\u6001 RAG \u7684\u6210\u672c\u8fdc\u9ad8\u4e8e\u7eaf\u6587\u672c RAG\uff0c\u9700\u8981\u7cbe\u7ec6\u5316\u8ba1\u7b97\u3002","text":"<ul> <li>\u8d44\u6e90\u6d88\u8017\uff1a</li> <li>\u7d22\u5f15\u6210\u672c\uff1aColPali \u5904\u7406\u901f\u5ea6\u8f83\u6162\uff08\u7ea6 0.5s/\u9875\uff09\uff0c\u4e00\u4efd 200 \u9875\u7684\u8d22\u62a5\u7d22\u5f15\u9700 2-3 \u5206\u949f\u3002</li> <li>\u63a8\u7406\u6210\u672c\uff1a\u591a\u6a21\u6001 Token \u6d88\u8017\u5de8\u5927\u3002\u4e00\u5f20 1024x1024 \u7684\u56fe\u7247\u7ea6\u4e3a 1000-1500 tokens\u3002\u6bcf\u6b21 Top-4 \u68c0\u7d22\u610f\u5473\u7740 Input Token \u81f3\u5c11 5000+\u3002\u4f7f\u7528 SiliconFlow API \u8c03\u7528 Qwen2_5-VL-72B\uff0c\u5355\u6b21\u95ee\u7b54\u6210\u672c\u7ea6 0.05-0.1 \u5143\u4eba\u6c11\u5e01\u3002</li> </ul>"},{"location":"part6/6_5_mm_rag/#_3","title":"\u8d44\u6e90\u6d88\u8017\uff1a","text":"<ul> <li>\u7d22\u5f15\u65f6\u95f4\u6210\u672c\uff1aColPali \u5904\u7406\u901f\u5ea6\u76f8\u5bf9\u8f83\u6162\uff08\u7ea6 0.5s/\u9875\uff09\u3002\u4e00\u4efd 200 \u9875\u7684\u8d22\u62a5\u7d22\u5f15\u6784\u5efa\u9700 2-3 \u5206\u949f\uff08\u4f9d\u8d56 GPU \u6027\u80fd\uff09\u3002</li> <li>\u63a8\u7406 Token \u6210\u672c\uff1a\u591a\u6a21\u6001 Token \u6d88\u8017\u5de8\u5927\u3002\u4e00\u5f20 1024x1024 \u7684\u56fe\u7247\u5728 VLM \u4e2d\u7ea6\u4e3a 1000-1500 tokens\u3002\u6bcf\u6b21 Top-4 \u68c0\u7d22\u610f\u5473\u7740 Input Token \u8d77\u6b65\u5c31\u662f 5000+\u3002</li> <li>\u8d44\u91d1\u6210\u672c\uff1a\u4f7f\u7528 SiliconFlow API \u8c03\u7528 Qwen2.5-VL-72B\uff0c\u5355\u6b21\u590d\u6742\u95ee\u7b54\uff08\u542b4\u56fe\uff09\u6210\u672c\u7ea6 0.05-0.1 \u5143\u4eba\u6c11\u5e01\u3002</li> </ul>"},{"location":"part6/6_5_mm_rag/#_4","title":"\u4f18\u5316","text":"<ul> <li>\u7cbe\u5ea6\u4f18\u5316 (Cropping)\uff1a \u5bf9\u4e8e\u8d85\u5927\u5206\u8fa8\u7387\u7684\u8d22\u52a1\u5927\u8868\uff08\u5982\u8de8\u9875\u8d44\u4ea7\u8d1f\u503a\u8868\uff09\uff0c\u53ef\u4ee5\u5728\u7d22\u5f15\u524d\u5bf9 PDF \u9875\u9762\u8fdb\u884c\"\u5207\u7247\"\u5904\u7406\uff0c\u5c06\u4e00\u5f20\u5927\u56fe\u5207\u6210 4 \u5f20\u5c0f\u56fe\u5206\u522b\u5efa\u7acb\u7d22\u5f15\uff0c\u63d0\u9ad8\u5c40\u90e8\u68c0\u7d22\u7684\u6e05\u6670\u5ea6\u3002</li> <li>\u964d\u4f4e Token (Patch Retrieval)\uff1aColPali \u5177\u5907\u5b9a\u4f4d\u76f8\u5173\u533a\u57df\uff08Patch-level retrieval\uff09\u7684\u80fd\u529b\uff0c\u672a\u6765\u53ef\u53ea\u5c06\u9875\u9762\u4e2d\u76f8\u5173\u7684\"\u56fe\u8868\u533a\u57df\"\u88c1\u526a\u51fa\u6765\u5582\u7ed9\u5927\u6a21\u578b\uff0c\u800c\u975e\u6574\u9875\u8f93\u5165\uff0c\u53ef\u5927\u5e45\u964d\u4f4e Token \u6d88\u8017\u3002</li> <li>\u7f13\u5b58\u673a\u5236 (Caching)\uff1a\u5bf9\u4e8e\"\u8425\u6536\u591a\u5c11\"\u3001\"\u51c0\u5229\u6da6\u591a\u5c11\"\u7b49\u9ad8\u9891\u56fa\u5b9a\u95ee\u9898\uff0c\u5c06 VLM \u7684\u89e3\u6790\u7ed3\u679c\u5b58\u50a8\u5728 Redis \u4e2d\uff0c\u907f\u514d\u91cd\u590d\u8fdb\u884c\u6602\u8d35\u7684\u89c6\u89c9\u63a8\u7406\u3002</li> </ul>"},{"location":"en/","title":"Table of Contents","text":""},{"location":"en/#data-engineering-for-large-models-architecture-algorithms-and-project-practice","title":"\"Data Engineering for Large Models: Architecture, Algorithms, and Project Practice\"","text":""},{"location":"en/#book-overview","title":"Book Overview","text":"<ul> <li>Part 1: Infrastructure &amp; Core Concepts (Building the Data Foundation)</li> <li>Part 2: Large-Scale Text Pre-training Engineering (Cleaning, Deduplication &amp; Quality Control)</li> <li>Part 3: Multimodal Data Engineering (Image-Text, Video &amp; Audio)</li> <li>Part 4: Alignment &amp; Synthetic Data Engineering (Instructions &amp; Quality)</li> <li>Part 5: Application-level Data Engineering (RAG &amp; Agent)</li> <li>Part 6: Capstone Projects (End-to-end Code Implementations)</li> </ul>"},{"location":"en/#detailed-outline","title":"Detailed Outline","text":""},{"location":"en/#part-1-infrastructure-core-concepts","title":"Part 1: Infrastructure &amp; Core Concepts","text":"<p>Goal: Establish a Data-Centric AI mindset and set up a high-performance data processing environment.</p>"},{"location":"en/#chapter-1-data-revolution-in-the-llm-era-from-data-ops-to-ai-ops","title":"Chapter 1: Data Revolution in the LLM Era (From Data Ops to AI Ops)","text":"<ul> <li>1_1 Insights from Scaling Laws: Data quality &gt; quantity \u2014 the paradigm shift from \"big data\" to \"high-quality data.\"</li> <li>1_2 LLM Data Lifecycle: Pre-training \\(\\rightarrow\\) SFT \\(\\rightarrow\\) RLHF \\(\\rightarrow\\) RAG.</li> <li>1_3 Challenges &amp; Opportunities: The interplay of heterogeneous multimodality, copyright compliance, and compute costs.</li> </ul>"},{"location":"en/#chapter-2-ai-native-data-stack","title":"Chapter 2: AI-Native Data Stack","text":"<ul> <li>2_1 AI-Native Data Stack:</li> <li>Storage: Object storage (S3/MinIO) vs Data lakes (Iceberg/Hudi).</li> <li>Compute: Spark vs Ray Data vs Dask \u2014 three distributed frameworks compared.</li> <li>Vector Databases: Milvus / Qdrant / Weaviate / Pinecone selection and QPS vs Recall tradeoffs.</li> <li>2_2 Data Formats &amp; I/O Optimization:</li> <li>Parquet vs JSONL vs WebDataset (multimodal scenarios).</li> <li>Compression algorithms and read performance optimization, GPU training I/O bottleneck optimization.</li> <li>2_3 Data Version Control (DataOps): Managing PB-scale datasets with DVC, LakeFS, and Pachyderm.</li> </ul>"},{"location":"en/#part-2-large-scale-text-pre-training-engineering","title":"Part 2: Large-Scale Text Pre-training Engineering","text":"<p>Goal: Process massive unstructured text to build the model's linguistic cognitive foundation.</p>"},{"location":"en/#chapter-3-data-acquisition-commoncrawl-parsing-high-concurrency-crawling","title":"Chapter 3: Data Acquisition (CommonCrawl Parsing &amp; High-Concurrency Crawling)","text":"<ul> <li>3_1 Deconstructing Open-source Datasets: Deep analysis of Common Crawl, C4, RefinedWeb, and The Pile.</li> <li>3_2 High-performance Web Crawling: Application of <code>Trafilatura</code> parsing library and distributed crawler architecture design.</li> <li>3_3 Specialized Data Acquisition: Extraction strategies for code (GitHub), papers (ArXiv/S2ORC), and book data.</li> </ul>"},{"location":"en/#chapter-4-cleaning-quality-control","title":"Chapter 4: Cleaning &amp; Quality Control","text":"<ul> <li>4_1 Heuristic Filtering Rules: Language identification (FastText), perplexity filtering, length and punctuation distribution.</li> <li>4_2 Large-scale Deduplication (Exact vs Fuzzy):</li> <li>Exact Deduplication: Hash methods for removing identical documents.</li> <li>Fuzzy Deduplication: MinHash LSH algorithm principles and distributed implementation.</li> <li>Intra-document Deduplication: Eliminating repeated paragraphs and navigation bars.</li> <li>4_3 Privacy Cleaning (PII Removal): Using Presidio to identify and mask emails, IPs, phone numbers, and addresses.</li> <li>4_4 Benchmark Decontamination: Ensuring training data doesn't contain GSM8K, MMLU test questions.</li> <li>4_5 Model-based Quality Scoring: Using fastText/BERT for \"textbook quality\" scoring (following LLaMA 2 approach).</li> </ul>"},{"location":"en/#chapter-5-tokenization-serialization-efficient-loading-dataloader-optimization","title":"Chapter 5: Tokenization, Serialization &amp; Efficient Loading (DataLoader Optimization)","text":"<ul> <li>5_1 Tokenizer Principles: BPE, WordPiece, Unigram and Byte-Level BPE deep analysis.</li> <li>5_2 Efficient Vocabulary Construction: Domain-specific vocabulary expansion and LLaMA Chinese vocabulary extension engineering.</li> <li>5_3 Data Mixing: Dynamic sampling strategies and Curriculum Learning data arrangement.</li> </ul>"},{"location":"en/#part-3-multimodal-data-engineering","title":"Part 3: Multimodal Data Engineering","text":"<p>Goal: Process images, video, and audio to support training of GPT-4V/Sora-class models.</p>"},{"location":"en/#chapter-6-image-text-pair-processing","title":"Chapter 6: Image-Text Pair Processing","text":"<ul> <li>6_1 Data Paradigms: Image-text pairs (LAION-5B) vs Interleaved documents (OBELICS/MMC4).</li> <li>6_2 Image Acquisition &amp; Preprocessing:</li> <li><code>img2dataset</code> high-concurrency download in practice.</li> <li>GPU-accelerated decoding and transforms (NVIDIA DALI).</li> <li>6_3 Multimodal Cleaning Pipeline:</li> <li>Aesthetic Scoring: Using CLIP-Score to filter high-aesthetic images.</li> <li>Image-text Alignment Filtering: Removing mismatched samples.</li> <li>Safety Detection: NSFW and watermark detection.</li> </ul>"},{"location":"en/#chapter-7-recaptioning","title":"Chapter 7: Recaptioning","text":"<ul> <li>7_1 Limitations of Alt-text: Why raw web descriptions are unusable.</li> <li>7_2 Synthetic Caption Factory:</li> <li>Using BLIP-2 / LLaVA / CogVLM to regenerate detailed captions.</li> <li>Prompt Strategies: Controlling caption granularity (brief vs detailed).</li> <li>7_3 OCR Enhancement: Extracting in-image text and fusing it into text descriptions (critical for document understanding).</li> </ul>"},{"location":"en/#chapter-8-video-audio-data","title":"Chapter 8: Video &amp; Audio Data","text":"<ul> <li>8_1 Video Processing Pipeline: Scene Detection and keyframe extraction strategies.</li> <li>8_2 Video Tokenization: Video compression and discrete representation.</li> <li>8_3 Audio Alignment: Large-scale ASR with Whisper and Force Alignment (timestamp alignment).</li> </ul>"},{"location":"en/#part-4-alignment-synthetic-data-engineering","title":"Part 4: Alignment &amp; Synthetic Data Engineering","text":"<p>Goal: Make models follow instructions and break through the bottleneck of human data.</p>"},{"location":"en/#chapter-9-instruction-fine-tuning-data-sft-data","title":"Chapter 9: Instruction Fine-tuning Data (SFT Data)","text":"<ul> <li>9_1 Prompt Engineering for Data Production: Writing robust System Prompts.</li> <li>9_2 Automated Construction Methods:</li> <li>Self-Instruct: Leveraging strong models to generate instructions.</li> <li>Evol-Instruct: Evolutionary strategies for instruction complexity.</li> <li>9_3 Chain-of-Thought (CoT) Data: Constructing step-by-step reasoning samples.</li> </ul>"},{"location":"en/#chapter-10-synthetic-data","title":"Chapter 10: Synthetic Data","text":"<ul> <li>10_1 Textbook-quality Data (Textbooks Are All You Need): Synthesizing high-quality domain knowledge.</li> <li>10_2 Code &amp; Math Synthesis:</li> <li>PoT (Program of Thought): Generating code, executing it, and verifying data correctness via execution results.</li> <li>10_3 Multimodal Instruction Synthesis: Using GPT-4o to construct complex image-based reasoning Q&amp;A.</li> </ul>"},{"location":"en/#chapter-11-human-preference-data-rlhfdpo","title":"Chapter 11: Human Preference Data (RLHF/DPO)","text":"<ul> <li>11_1 Preference Data Format: Constructing chosen vs rejected sample pairs.</li> <li>11_2 Annotation Platforms &amp; Quality Control: Crowdsourcing management and IAA (Inter-Annotator Agreement) analysis.</li> <li>11_3 RLAIF (AI Feedback): Using LLMs to replace human preference scoring.</li> </ul>"},{"location":"en/#part-5-application-level-data-engineering-rag-agent","title":"Part 5: Application-level Data Engineering (RAG &amp; Agent)","text":"<p>Goal: Enterprise-oriented solutions for external knowledge base parsing and retrieval.</p>"},{"location":"en/#chapter-12-rag-data-pipeline","title":"Chapter 12: RAG Data Pipeline","text":"<ul> <li>12_1 Deep Document Parsing:</li> <li>Complex PDF processing: table reconstruction, multi-column recognition (<code>Unstructured</code>, <code>LlamaParse</code>).</li> <li>12_2 Chunking Strategies: Semantic chunking, recursive chunking, and Parent-Child Indexing.</li> <li>12_3 Vectorization &amp; Storage: Embedding model fine-tuning and vector database optimization.</li> </ul>"},{"location":"en/#chapter-13-multimodal-rag","title":"Chapter 13: Multimodal RAG","text":"<ul> <li>13_1 Cross-modal Retrieval: Using CLIP/SigLIP for \"text-to-image\" and \"image-to-text\" search.</li> <li>13_2 ColPali Architecture in Practice: Vision-language model based document retrieval (skip OCR, directly understand document images).</li> </ul>"},{"location":"en/#part-6-capstone-projects","title":"Part 6: Capstone Projects","text":"<p>Goal: Through 5 end-to-end projects, integrate all technical topics from the book with runnable code repositories.</p>"},{"location":"en/#project-1-building-a-mini-c4-pre-training-set","title":"Project 1: Building a \"Mini-C4\" Pre-training Set","text":"<ul> <li>Scenario: From Common Crawl raw data (WARC) to high-quality Parquet data.</li> <li>Core Technologies: Trafilatura parsing, Spark/Ray distributed MinHash deduplication, KenLM quality filtering.</li> <li>Output: Cleaned plain text corpus and processing pipeline.</li> </ul>"},{"location":"en/#project-2-domain-expert-sft-legalmedical","title":"Project 2: Domain Expert SFT (Legal/Medical)","text":"<ul> <li>Scenario: Building industry expert fine-tuning data from unstructured PDF documents.</li> <li>Core Technologies: Self-Instruct instruction generation, CoT reasoning enhancement, data diversity balancing.</li> <li>Output: <code>domain_expert.jsonl</code> instruction fine-tuning dataset.</li> </ul>"},{"location":"en/#project-3-building-a-llava-multimodal-instruction-set","title":"Project 3: Building a LLaVA Multimodal Instruction Set","text":"<ul> <li>Scenario: Training a multimodal model that can understand images.</li> <li>Core Technologies: Using GPT-4o API for multi-turn image-text dialogues, Bounding Box data alignment, multi-image interleaved format processing.</li> <li>Output: Image-text dataset with visual instructions.</li> </ul>"},{"location":"en/#project-4-synthetic-mathcode-textbook","title":"Project 4: Synthetic Math/Code Textbook","text":"<ul> <li>Scenario: Improving small model logical reasoning capabilities.</li> <li>Core Technologies: Evol-Instruct evolutionary strategies, Python code execution sandbox verification, PoT data formatting.</li> <li>Output: Verified high-quality synthetic reasoning dataset.</li> </ul>"},{"location":"en/#project-5-multimodal-rag-financial-report-assistant","title":"Project 5: Multimodal RAG Financial Report Assistant","text":"<ul> <li>Scenario: Retrieving and answering questions about annual reports with complex charts.</li> <li>Core Technologies: PDF table and chart parsing, multi-route recall (hybrid retrieval), ColPali visual retrieval.</li> <li>Output: A RAG knowledge base system supporting chart Q&amp;A.</li> </ul>"},{"location":"en/#appendix","title":"Appendix","text":"<ul> <li>Appendix A: Common Tools Quick Reference (Hugging Face Datasets, LangChain, Ray Data).</li> <li>Appendix B: Data Compliance Checklist (Copyright, GDPR, robots.txt).</li> <li>Appendix C: Compute Cost Estimation (GPU/CPU consumption reference for different data processing scales).</li> </ul>"},{"location":"en/part1/1_1_data_change/","title":"Chapter 1: Data Revolution in the LLM Era","text":""},{"location":"en/part1/1_1_data_change/#chapter-1-data-transformation-in-the-era-of-large-language-models-from-data-ops-to-ai-ops","title":"Chapter 1: Data Transformation in the Era of Large Language Models (From Data Ops to AI Ops)","text":""},{"location":"en/part1/1_1_data_change/#chapter-summary","title":"Chapter Summary","text":"<p>The rise of Large Language Models (LLMs) has reshaped the paradigm of artificial intelligence. However, innovation in model architecture has converged, and what truly determines the upper limit of model capability is data quality. This chapter establishes the concept of \"data as core asset\" from the perspective of Scaling Laws, systematically introduces the full lifecycle of LLM data, and explores practical challenges such as heterogeneous multimodal data, copyright compliance, and compute cost.</p>"},{"location":"en/part1/1_1_data_change/#scenario-introduction","title":"Scenario Introduction","text":"<p>You are the data lead at an AI startup. The team has just spent three months crawling 50TB of Chinese text from the public web and is confidently starting to pre-train a 7B parameter base model.</p> <p>However, two weeks into training, the loss curve suddenly \"flattens\" at a certain point, and the model output is filled with ad copy, repetitive SEO junk, and even recites user agreements from certain websites. In the post-mortem meeting, a senior engineer raises a sharp question: \"After spending 1 million on compute for training, are we building a language model, or a compressed index of internet garbage?\"</p> <p>This scenario is not fabricated. OpenAI, Google, Meta, and other top labs have already reached consensus: in an era of converging model architectures, data quality is the core variable that determines the intelligence ceiling of models.</p>"},{"location":"en/part1/1_1_data_change/#11-implications-of-scaling-laws-paradigm-shift-from-big-data-to-high-quality-data","title":"1.1 Implications of Scaling Laws: Paradigm Shift from \"Big Data\" to \"High-Quality Data\"","text":""},{"location":"en/part1/1_1_data_change/#111-what-are-scaling-laws","title":"1.1.1 What Are Scaling Laws?","text":"<p>In 2020, OpenAI published the landmark paper Scaling Laws for Neural Language Models, revealing a simple yet profound regularity: model performance (measured by Loss) follows a power law relationship with three core factors\u2014model parameter count \\(N\\), dataset size \\(D\\), and compute \\(C\\).</p> \\[ L(N, D, C) \\approx \\left(\\frac{N_c}{N}\\right)^{\\alpha_N} + \\left(\\frac{D_c}{D}\\right)^{\\alpha_D} + \\left(\\frac{C_c}{C}\\right)^{\\alpha_C} \\] <p>Where \\(L\\) is the model's cross-entropy loss, \\(N_c, D_c, C_c\\) are constants, and \\(\\alpha\\) are power law exponents. In plain terms: to make a model smarter, you either increase model scale, add more data, or invest more compute. These three factors constrain each other, forming the \"impossible triangle\" of the LLM era.</p> <p>This discovery sent shockwaves through academia and industry. Before this, the development of deep learning was more like \"alchemy\"\u2014researchers relied on intuition and experience to tune model architectures, hoping for accidental breakthroughs. The emergence of Scaling Laws shifted large model training from art to engineering science for the first time, enabling companies to plan resource investment and expected outcomes based on precise mathematical models.</p>"},{"location":"en/part1/1_1_data_change/#112-the-hidden-variable-of-data-quality","title":"1.1.2 The \"Hidden Variable\" of Data Quality","text":"<p>However, the original Scaling Laws had a critical blind spot: it assumed that all data \"quality\" was uniform. This assumption clearly does not hold in reality. Text quality on the internet varies widely, from carefully written academic papers to comments riddled with typos, and the value difference between data can span orders of magnitude.</p> <p>In 2022, DeepMind's Chinchilla paper shattered this assumption. The research team conducted a large-scale experiment: under the same compute budget, compare the effects of different model sizes and data volume ratios. The results shocked the industry\u2014Chinchilla (70B parameters), with only one-quarter the parameters of Gopher, surpassed the 280B parameter Gopher on almost all evaluation tasks by using four times the high-quality training data (1.4T tokens).</p> Model Parameters Training Tokens Final Performance Gopher 280B 300B tokens Baseline Chinchilla 70B 1.4T tokens Outperforms Gopher <p>This research revealed a long-neglected fact: the industry had previously overfitted on model scale while undervaluing data volume. The Chinchilla paper recommended an \"optimal ratio\": for each additional parameter, approximately 20 tokens of training data should be allocated. This means training a 7B model theoretically requires about 140B tokens of high-quality corpus\u2014a number far beyond what many teams initially expected.</p>"},{"location":"en/part1/1_1_data_change/#113-quality-vs-quantity-the-extreme-experiment-of-the-phi-series","title":"1.1.3 Quality vs. Quantity: The Extreme Experiment of the Phi Series","text":"<p>If Chinchilla proved that \"data volume was underestimated,\" then Microsoft's Phi series demonstrated an even more radical view: data quality can override the scaling laws.</p> <p>In 2023, Microsoft Research released the Phi-1 model. This is a \"small\" model with only 1.3B parameters, trained on merely 7B tokens\u2014a stark contrast to the mainstream approach of hundreds of billions or even trillions of tokens at the time. Yet this seemingly \"malnourished\" model surpassed competitors with ten times its parameters on code generation tasks.</p> <p>Phi-1's secret weapon was not massive crawled data, but carefully designed synthetic data with pedagogical value. The researchers used GPT-4 to generate large amounts of structured, step-by-step programming tutorials, from basic syntax to advanced algorithms, forming a complete \"artificial textbook.\" These synthetic data had advantages that real web data could hardly match: no noise, no errors, clear logic, and progressive difficulty. Small models trained on these \"artificial textbooks\" showed remarkable capability in solving real programming problems.</p> <p></p> <p>Figure 1-1: Relationship between Data Quality and Model Performance \u2014 Low-quality data (40% noise) after cleansing becomes high-quality data (5% noise)</p> <p>The success of the Phi series sparked heated discussion in the industry about \"synthetic data.\" If carefully designed synthetic data could produce such excellent results, does the traditional \"crawl-clean-train\" paradigm need to be overturned? We will explore synthetic data methodology and best practices in detail in Chapter 7.</p>"},{"location":"en/part1/1_1_data_change/#114-the-core-mission-of-data-engineers","title":"1.1.4 The Core Mission of Data Engineers","text":"<p>Synthesizing the above research, we can distill the core mission of data engineers in the LLM era. Traditional wisdom held that \"more data is better\"; the new paradigm emphasizes that data quality determines the performance ceiling, and noisy data is not only unhelpful but harmful. Past belief was that \"model architecture is the core competitive advantage\"; today architecture has converged, and data has become the key differentiator. The old view that \"cleaning is a minor preprocessing step\" is outdated\u2014data cleaning is now seen as the foundation of successful model training. Similarly, the traditional belief that \"human annotation is irreplaceable\" has been broken; high-quality synthetic data can surpass real data in certain scenarios.</p> <p>It is important to emphasize that \"quality over quantity\" should not be misinterpreted as \"only quality, no quantity.\" Scaling Laws still hold\u2014the priority under the same compute budget should be investing in data quality. An extreme example: a model trained on 100 perfect data points can never surpass a model trained on 1T high-quality data points. Quality and quantity are not opposed; they require finding the optimal balance under practical constraints.</p>"},{"location":"en/part1/1_1_data_change/#12-full-lifecycle-of-llm-data","title":"1.2 Full Lifecycle of LLM Data","text":"<p>From \"birth\" to \"deployment,\" a large language model undergoes multiple training stages, each with distinctly different data requirements. Understanding this full lifecycle is the first step toward becoming a qualified data engineer.</p>"},{"location":"en/part1/1_1_data_change/#121-four-stage-paradigm-pre-train-sft-rlhf-rag","title":"1.2.1 Four-Stage Paradigm: Pre-train \u2192 SFT \u2192 RLHF \u2192 RAG","text":"<p>Figure 1-2: LLM Training Data Pipeline \u2014 From TB-level pre-training to KB-level RAG, data volume decreases while quality requirements increase</p> <p>Pre-training is the starting point of a large model's life. At this stage, the model learns the essence of language from massive amounts of unlabeled text\u2014grammatical structure, commonsense knowledge, and how the world works. Pre-training data scale is typically at the TB level, containing trillions of tokens, with sources from web pages, books, code, academic papers, and other text types. The core challenges at this stage are deduplication, denoising, quality filtering, and diversity balance. Typical pre-training datasets include Common Crawl, The Pile, and RefinedWeb.</p> <p>Supervised Fine-Tuning (SFT) is the critical period when the model learns to \"follow instructions.\" Although pre-trained models possess strong language understanding capability, they do not know how to interact effectively with humans. The SFT stage uses paired instruction-response data to teach the model to understand user intent and provide helpful responses. Data scale at this stage drops to GB level, containing hundreds of thousands to millions of carefully constructed dialogue samples. Key challenges include ensuring instruction diversity, response quality, and format standardization. Alpaca, ShareGPT, and OpenAssistant are commonly used datasets for this stage.</p> <p>Reinforcement Learning from Human Feedback (RLHF/DPO) aims to make model output more \"aligned\" with human preferences. Alignment means making the model safer (not producing harmful content), more helpful (actually solving user problems), and more honest (not fabricating facts). This stage uses preference comparison data where human annotators choose the better of two candidate responses. Data scale further shrinks from hundreds of thousands to tens of thousands of samples, but annotation quality requirements are extremely high. Inter-Annotator Agreement, accuracy of preference signals, and coverage of sample distribution are all factors that must be carefully controlled.</p> <p>Retrieval-Augmented Generation (RAG) addresses model knowledge updates and hallucination. No matter how thorough pre-training is, a model's knowledge has a cutoff date and cannot completely avoid \"sounding authoritative while talking nonsense.\" RAG injects external information such as enterprise knowledge bases and latest documents into the generation process by letting the model \"consult external sources.\" Data sources at this stage are typically enterprise-private, including PDF documents, database records, web content, and other structured or semi-structured data. Key challenges include document parsing, semantic chunking, vectorization, and retrieval accuracy optimization.</p>"},{"location":"en/part1/1_1_data_change/#122-the-funnel-model-of-data-flow","title":"1.2.2 The \"Funnel Model\" of Data Flow","text":"<p>Another perspective on understanding the data lifecycle is the \"funnel model.\" From raw web data to final high-quality corpus usable for training, data volume undergoes dramatic reduction.</p> <p></p> <p>Figure 1-3: Data filtration funnel \u2014 From 100PB raw data to 10GB SFT data, retention rate only 0.00001%</p> <p>For a typical pre-training data processing workflow: assume we obtain 100PB of raw web data from Common Crawl. After URL deduplication and exact-content deduplication, data volume may drop to 30PB (30% retention). Next, language identification and quality filtering\u2014removing non-target languages, pornographic/violent content, extremely short text, garbled text\u2014further reduces data to 5PB (5% retention). Then finer quality assessment using perplexity, repetition rate, information density, and other metrics yields final pre-training corpus of perhaps only 1PB (1% retention). And if SFT data needs to be extracted or constructed from this, the final output may be only 10GB\u2014relative to raw data, retention rate as low as one hundred-thousandth.</p> <p>In practical engineering, understanding this ratio is crucial. It directly affects planning of crawl scale, storage cost budgeting, and processing pipeline design. Many teams underestimated this \"attrition rate\" at project start, leading to insufficient data reserves and mid-project rework.</p>"},{"location":"en/part1/1_1_data_change/#13-challenges-and-opportunities-the-game-of-heterogeneous-multimodal-copyright-compliance-and-compute-cost","title":"1.3 Challenges and Opportunities: The Game of Heterogeneous Multimodal, Copyright Compliance, and Compute Cost","text":""},{"location":"en/part1/1_1_data_change/#131-challenge-one-complexity-of-processing-heterogeneous-multimodal-data","title":"1.3.1 Challenge One: Complexity of Processing Heterogeneous Multimodal Data","text":"<p>With the emergence of multimodal models like GPT-4V, Gemini, and Sora, data engineering complexity has increased exponentially. In the pure text era, all data was UTF-8 encoded strings; processing toolchains were mature and standardized. In the multimodal era, data formats have exploded: images have JPEG, PNG, WebP; video has MP4, AVI, MKV; audio has WAV, MP3, FLAC; documents have PDF, Word, HTML. Each format has its own parsing methods and quality assessment standards.</p> Dimension Pure Text Era Multimodal Era Data Format Unified UTF-8 text Multiple formats: images, video, audio, documents, web pages Storage Requirements TB level PB level (images/video dominate) Alignment Difficulty None (pure text needs no alignment) Very high (image-text alignment, audio-video sync, cross-modal semantic consistency) Cleaning Toolchain Mature (FastText, KenLM) Fragmented (each modality has independent toolchain) Quality Assessment Perplexity, deduplication rate Aesthetic score, CLIP-Score, OCR accuracy, ASR error rate, etc. <p>Even more challenging is the cross-modal alignment problem. An image paired with a caption\u2014how to ensure the text accurately describes the image content? How do voice and visuals in a video stay precisely synchronized? These alignment problems did not exist in the pure text era but are core challenges in multimodal data engineering.</p> <p></p> <p>Figure 1-4: Multimodal Data Processing Complexity \u2014 Line thickness indicates processing difficulty, video (5/5) and PDF (4/5) are most complex</p> <p>From an engineering practice perspective, multimodal data processing requires modular design\u2014each modality processed independently before cross-modal alignment. At the same time, priority should be given to unified data format standards such as WebDataset, TFDS, etc., to reduce downstream processing complexity. Establishing modality-aware quality assessment systems is also critical: images need aesthetic scores and CLIP similarity, speech needs ASR accuracy and speaker separation quality, PDFs need OCR accuracy and layout analysis precision.</p>"},{"location":"en/part1/1_1_data_change/#132-challenge-two-the-gray-zone-of-copyright-compliance","title":"1.3.2 Challenge Two: The Gray Zone of Copyright Compliance","text":"<p>Copyright issues with large model training data have evolved from technical discussion to legal battlefield. In 2023, Getty Images sued Stability AI, alleging unauthorized use of millions of copyrighted images to train Stable Diffusion. In 2024, The New York Times sued OpenAI and Microsoft, alleging GPT models infringed copyright. Regulatory agencies in multiple countries have begun requiring AI companies to disclose training data sources.</p> <p>The outcomes of these lawsuits will profoundly affect the development direction of the AI industry, but for data engineers, waiting for matters to be resolved is clearly not wise. Current compliance strategies can proceed from several aspects: First, source traceability\u2014record complete source metadata for each training data point, including URL, crawl time, original copyright declaration, etc.; Second, license filtering\u2014prioritize data with explicit permission for AI training use, such as CC0, CC-BY and other open license content; Third, respect robots.txt protocol, honoring website owners' crawler restriction declarations; Fourth, data desensitization\u2014anonymize or delete content involving personal privacy.</p> <p>It is worth noting that \"Fair Use\" boundaries in AI training scenarios remain unclear, and applicable legal standards vary by country. Therefore, it is recommended to reserve copyright filtering interfaces in the data pipeline so that data processing strategies can be quickly adjusted once the legal environment is clarified.</p>"},{"location":"en/part1/1_1_data_change/#133-challenge-three-the-hidden-killer-of-compute-cost","title":"1.3.3 Challenge Three: The \"Hidden Killer\" of Compute Cost","text":"<p>Compute cost for data processing is often severely underestimated. Many teams only calculate GPU training time when budgeting model training costs, but neglect that data preprocessing may consume equal or more resources.</p> <p>Consider a practical scenario: processing 10TB of raw web data. Assume each data point requires five steps on average: HTML parsing, text extraction, language identification, quality scoring, deduplication check. Each step takes 100 milliseconds per item (already quite fast). Total processing time would be approximately: 10TB \u00f7 10KB/item \u00d7 0.5 sec/item \u2248 1.5 million GPU hours. At cloud provider pricing, this could mean hundreds of thousands of dollars\u2014comparable to model training costs itself.</p> Scenario Training Data Volume Training Cost (A100 hours) Model Performance No deduplication, train directly 10T Token 10,000 hours Baseline (includes \"repeater\" issues from repetition) Train after deduplication 7T Token 7,000 hours Better than baseline (repeated data reduces learning efficiency) Net benefit - Save 3,000 hours + better model - <p>However, from another perspective, the return on investment of data engineering can be extremely high. The table above shows a simplified case: by investing resources in data deduplication, not only 30% of training cost is saved, but better model performance is achieved. This is the \"leverage effect\" of data engineering\u2014at current compute prices (A100 ~$2/hour), 1 hour of data processing work that can eliminate 10 hours of ineffective training yields 20x ROI.</p> <p></p> <p>Figure 1-5: Relationship between Data Quality and Training Efficiency \u2014 Green curve (curated data) most efficient, 30-70% quality range has maximum ROI</p>"},{"location":"en/part1/1_1_data_change/#134-opportunity-three-trends-lowering-the-barrier","title":"1.3.4 Opportunity: Three Trends Lowering the Barrier","text":"<p>Despite challenges, for data engineers, now is the golden time to enter. Three major trends are significantly lowering the barrier to large model data engineering.</p> <p>The first trend is the emergence of open-source high-quality datasets. Unlike early closed commercial data, recent years have seen many high-quality open-source pre-training datasets. HuggingFace's FineWeb provides carefully cleaned 15T token English web data. RedPajama open-sourced the complete reproduction of LLaMA training data. DCLM provides domain-optimized datasets. These open-source datasets greatly reduce the cost for small and medium teams to build pre-training corpora, making resources that were previously only accessible to large companies within reach.</p> <p>The second trend is the maturation of AI-native data tools. Traditional big data tools (like Hadoop, Spark) are mature but not designed for AI training scenarios. In recent years, a batch of tools designed for LLM data engineering have matured. Alibaba's Data-Juicer provides modular data processing pipelines with dozens of out-of-the-box cleaning operators. Dolma is an Allen AI-developed large-scale text processing toolkit for pre-training data optimization. These tools enable data engineers to stand on the shoulders of giants without building from scratch.</p> <p>The third trend is the mainstreaming of synthetic data. As mentioned, Microsoft Phi series success demonstrated the enormous potential of synthetic data. Today, using powerful models like GPT-4, Claude to generate training data has become industry standard. This \"strong-leading-weak\" strategy makes high-quality data acquisition no longer completely dependent on human annotation, greatly accelerating data preparation efficiency. However, synthetic data also brings new challenges: How to avoid model collapse? How to ensure data diversity? These questions will be explored in detail in subsequent chapters.</p>"},{"location":"en/part1/1_1_data_change/#14-common-misconceptions-and-pitfall-guide","title":"1.4 Common Misconceptions and Pitfall Guide","text":"<p>Before entering specific technical practice, it is necessary to clarify several common misconceptions. These misconceptions can lead to resource waste at best, and project failure at worst.</p>"},{"location":"en/part1/1_1_data_change/#misconception-one-more-data-is-better","title":"Misconception One: \"More Data Is Better\"","text":"<p>This is the most common and most harmful misconception. Many teams' first reaction when starting a project is to \"crawl as much data as possible.\" However, as mentioned, raw data retention rate is typically only 5-20%. Blindly pursuing data volume means 80%+ of crawl, storage, and initial processing costs are wasted. Worse, if subsequent quality filtering is not strict enough and low-quality data mixed into the training set, it may negatively impact model performance.</p> <p>The correct approach: first validate the entire processing pipeline's effectiveness with small-scale data, confirm quality standards and filtering strategy, then proceed with large-scale data collection. \"Quality first, quantity second\" should be a fundamental principle of data engineering.</p>"},{"location":"en/part1/1_1_data_change/#misconception-two-process-all-data-once","title":"Misconception Two: \"Process All Data Once\"","text":"<p>Data processing is an iterative process, not a one-time task. Model training will expose data issues (e.g., excess samples of certain types leading to bias), evaluation results will guide data filtering strategy (e.g., need to augment data in certain domains), legal compliance requirements may change (e.g., need to remove data from certain sources).</p> <p>Therefore, data processing pipelines must be designed for reproducible execution, incremental updates, and version rollback. Chapter 2 will detail how to use tools like DVC, LakeFS for data version control.</p>"},{"location":"en/part1/1_1_data_change/#misconception-three-only-focus-on-pre-training-data","title":"Misconception Three: \"Only Focus on Pre-training Data\"","text":"<p>Pre-training data is indeed the foundation of LLMs, but neglecting data from subsequent stages is equally dangerous. A base model well pre-trained on large corpus may produce mediocre dialogue models if SFT data quality is poor. Similarly, if RLHF preference data has inconsistent annotations, the model may exhibit unstable behavior.</p> <p>Full lifecycle data quality management is equally important. Pre-training, SFT, RLHF, and RAG data should each have their own quality standards and evaluation systems.</p>"},{"location":"en/part1/1_1_data_change/#misconception-four-open-source-data-is-ready-to-use","title":"Misconception Four: \"Open-Source Data Is Ready to Use\"","text":"<p>Open-source datasets greatly lower the entry barrier, but using open-source data directly without secondary review is dangerous. Open-source datasets may have: outdated data (crawled earlier, missing latest knowledge), bias (uneven data distribution), noise (some samples not meeting quality standards), copyright risk (unclear license).</p> <p>The correct approach is to treat open-source data as \"raw material\" rather than \"finished product.\" Secondary filtering, augmentation, and balancing based on your own task requirements are needed to maximize the value of open-source data.</p>"},{"location":"en/part1/1_1_data_change/#15-chapter-summary","title":"1.5 Chapter Summary","text":"<p>This chapter systematically discussed the core concepts of data engineering in the LLM era from the perspective of Scaling Laws. We first explored the paradigm shift of \"quality over quantity,\" from Chinchilla's optimal ratio to the extreme experiment of the Phi series, demonstrating the decisive role of high-quality data in model performance.</p> <p>We then introduced the four stages of the LLM data lifecycle: pre-training, SFT, RLHF, and RAG. Each stage has distinctly different data requirements, from TB-level unlabeled text to tens of thousands of preference comparison data points\u2014data volume decreases while quality requirements increase. Understanding this \"funnel model\" is the foundation for planning data resources.</p> <p>In the challenges and opportunities section, we analyzed three practical issues: multimodal complexity, copyright compliance, and compute cost, while also seeing opportunities from three trends: open-source datasets, AI-native tools, and synthetic data.</p> <p>Finally, by clarifying four common misconceptions, we established the correct data engineering mindset for readers: quality before quantity, iterative rather than one-time, full-cycle management, and secondary processing of open-source data.</p> <p></p> <p>Figure 1-6: Chapter 1 Knowledge Structure \u2014 Covering four major themes: Scaling Laws, Data Lifecycle, Challenges and Opportunities</p>"},{"location":"en/part1/1_1_data_change/#further-reading","title":"Further Reading","text":"<p>Core Papers</p> <p>Scaling Laws for Neural Language Models by Kaplan et al. (2020) is the foundational work for understanding large model resource allocation. This OpenAI paper first systematically revealed the power law relationship between model scale, data volume, and compute, providing theoretical guidance for subsequent large model development.</p> <p>Training Compute-Optimal Large Language Models (the Chinchilla paper) by Hoffmann et al. (2022) from DeepMind pointed out the industry's widespread \"over-parameterization\" problem and provided compute-optimal model-data ratio recommendations.</p> <p>Textbooks Are All You Need by Gunasekar et al. (2023) from Microsoft Research is the pioneering work of the Phi series, proving that high-quality synthetic data can enable small models to match large model performance.</p> <p>Open-Source Datasets</p> <p>FineWeb released by Penedo et al. is HuggingFace's open-source large-scale high-quality English web dataset, containing approximately 15T tokens, suitable as a base corpus for pre-training. RedPajama released by Together AI is the open-source reproduction of LLaMA training data, valuable for teams wanting to reproduce the LLaMA training process.</p>"},{"location":"en/part1/1_1_data_change/#preview-of-next-chapter","title":"Preview of Next Chapter","text":"<p>In the next chapter Data Infrastructure Selection, we will move from conceptual to engineering level. You will learn how to choose appropriate storage solutions (S3 vs MinIO), compute frameworks (Spark vs Ray), data formats (Parquet vs JSONL vs WebDataset), and version control tools (DVC vs LakeFS).</p> <p>Take this question into the next chapter: With limited resources, how do you design a data infrastructure that can support current needs while scaling smoothly?</p>"},{"location":"en/part1/1_2_data_infra/","title":"Chapter 2: Data Infrastructure Selection","text":""},{"location":"en/part1/1_2_data_infra/#chapter-2-ai-native-data-stack-vector-db-object-storage-rayspark-distributed-computing","title":"Chapter 2: AI-Native Data Stack (Vector DB, Object Storage, Ray/Spark Distributed Computing)","text":""},{"location":"en/part1/1_2_data_infra/#chapter-summary","title":"Chapter Summary","text":"<p>A craftsman must sharpen his tools before he can do his work well. Before processing TB-level or even PB-level LLM training data, choosing the right infrastructure is the first step that determines project success or failure. This chapter systematically introduces AI-native data stack technology selection from five dimensions\u2014storage, compute, vector databases, format, and version control. We pay special attention to distributed data processing frameworks (Ray Data, Apache Spark, Dask) in large-scale token processing, as well as GPU training I/O bottleneck optimization strategies, helping readers build an efficient, scalable, and reproducible data processing platform.</p>"},{"location":"en/part1/1_2_data_infra/#scenario-introduction","title":"Scenario Introduction","text":"<p>You just joined an AI startup, responsible for building the LLM pre-training data processing platform. The team's situation is concerning: data is scattered across local disks on 50 machines, in various formats including <code>.txt</code>, <code>.json</code>, <code>.csv</code>, <code>.parquet</code>, and more. Every time data is processed, Python scripts must be manually written and run on a single machine for three days to complete. Last week someone accidentally overwrote a critical dataset, and there was no backup or version record. Your boss asks: \"We're starting training in a month\u2014can the data platform be ready?\"</p> <p>Your first decision: Use the team-familiar Spark, or switch to the \"AI-native\" Ray? Build a self-hosted MinIO cluster, or go straight to cloud with S3? There are no \"standard answers\" to these questions, but there are clear decision frameworks. This chapter provides that framework.</p>"},{"location":"en/part1/1_2_data_infra/#21-modern-data-stack-mds","title":"2.1 Modern Data Stack (MDS)","text":""},{"location":"en/part1/1_2_data_infra/#211-what-is-the-modern-data-stack","title":"2.1.1 What Is the Modern Data Stack?","text":"<p>The \"Modern Data Stack\" (MDS) is a hot concept in data engineering in recent years, referring to a cloud-native, modular, decoupled combination of data infrastructure. Compared with traditional integrated data platforms, the core philosophy of the modern data stack is to split storage, compute, orchestration, and other functions into independent components, each of which can be independently replaced and scaled according to needs.</p> <p></p> <p>Figure 2-1: Modern Data Stack Architecture \u2014 5-layer decoupled architecture from storage to application layer, each layer independently replaceable</p> <p>Traditional data platforms are often deployed in local data centers with integrated systems, storage tightly coupled with compute. Taking the Hadoop ecosystem as an example, HDFS and MapReduce coupling makes replacing any component very difficult. Data formats are often proprietary, leading to serious vendor lock-in. Scaling is mainly vertical\u2014improving performance by purchasing more powerful single machines\u2014with high upfront costs.</p> Feature Traditional Approach Modern Data Stack Deployment Mode Local data center, integrated system Cloud-native, elastic scaling on demand Component Coupling Storage-compute bound (e.g., HDFS + MapReduce) Storage-compute separation, each layer independently replaceable Data Format Proprietary format, vendor lock-in Open format (Parquet, ORC) Scalability Mainly vertical scaling Horizontal scaling, nearly unlimited Cost Model Fixed investment, high upfront cost Pay-per-use, elastic cost <p>The emergence of the modern data stack changed this landscape. Cloud-native deployment allows elastic scaling on demand; complete storage-compute separation enables each layer to evolve independently. Open data formats (e.g., Parquet, ORC) eliminate vendor lock-in risk. Horizontal scaling enables the system to handle nearly unlimited data volume, while pay-per-use cost model greatly lowers project startup barriers.</p>"},{"location":"en/part1/1_2_data_infra/#212-storage-layer-object-storage-and-data-lake","title":"2.1.2 Storage Layer: Object Storage and Data Lake","text":"<p>Object storage is the de facto standard foundation for modern data platforms. Whether AWS S3, Google Cloud Storage, Azure Blob, or open-source MinIO, their core philosophy is the same: flat namespace with no true directory hierarchy, only <code>bucket/key</code> binary structure; theoretically unlimited storage; extremely high data durability (S3 claims 11 nines, i.e., 99.999999999%); billed by actual usage with no large upfront investment.</p> <p>When selecting among options, deployment mode, compatibility, cost, and other factors must be considered. AWS S3 is the benchmark for public cloud hosting with the most mature ecosystem, suitable for most production environments. MinIO is an S3-compatible open-source alternative, suitable for private deployment scenarios with data compliance requirements or for development/test environments. Google Cloud Storage and Azure Blob are respectively suitable for users already deeply in GCP or Azure ecosystems.</p> Feature AWS S3 MinIO Google GCS Azure Blob Deployment Mode Public cloud hosted Self-hosted/private cloud Public cloud hosted Public cloud hosted S3 Compatibility Native 100% compatible Requires adapter layer Requires adapter layer Cold/Hot Tiering Glacier Tiering Nearline/Coldline Cool/Archive Lowest Cost $0.023/GB/month Hardware cost $0.020/GB/month $0.018/GB/month Typical Use Case Production default Private deployment/dev-test GCP ecosystem users Azure ecosystem users <p>Object storage solves the \"storage\" problem but lacks transactional and metadata management capabilities. Operating directly on Parquet files in S3 encounters many difficulties: no ACID transactions, concurrent writes may corrupt data; no efficient querying, must scan all file metadata each time; no time travel, once data is overwritten it cannot be rolled back to historical versions.</p> <p>Data lake table formats emerged precisely to solve these problems. They add a metadata management layer on top of object storage, providing data warehouse-level capabilities. Apache Iceberg, Apache Hudi, and Delta Lake are currently the three most mainstream data lake formats.</p> <p></p> <p>Figure 2-2: Data Lakehouse Architecture \u2014 Table format layer provides ACID transactions, time travel, schema evolution, and other capabilities</p> <p>Apache Iceberg was developed by Netflix and contributed to the Apache Foundation; its biggest advantage is engine neutrality\u2014it works well with Spark, Flink, Trino, Dremio, DuckDB, and other compute engines. For LLM data engineering scenarios, Iceberg is the most recommended choice. Apache Hudi was developed by Uber, with strengths in streaming-batch unification and real-time updates; if there are substantial real-time update needs (e.g., continuous RAG knowledge base updates), Hudi can be considered. Delta Lake was developed by Databricks with the tightest Spark integration; if already deeply in the Databricks ecosystem, choosing Delta Lake provides the best experience.</p> Feature Apache Iceberg Apache Hudi Delta Lake Backing Vendor Netflix \u2192 Apache Uber \u2192 Apache Databricks Open Source Degree Fully open source Fully open source Core open source, some features commercial Engine Compatibility Spark, Flink, Trino, DuckDB Spark, Flink, Presto Primarily Spark Typical Use Case Multi-engine mixed use, vendor neutral Stream-batch unification, real-time updates Databricks ecosystem users <p>When making actual selections, the following decision tree can be used: First determine whether data scale exceeds 100TB. If yes, further consider whether ACID transactions and time travel are needed\u2014if yes, and there are multi-engine access needs, recommend Iceberg + S3; if only using Spark, Delta Lake or Hudi can be chosen. If ACID capability is not needed, use S3/MinIO + Parquet directly. For scenarios with data volume below 100TB, if team size is small (fewer than 5 people), local disk + Parquet is sufficient for prototype validation; migrate to S3 + Parquet as scale grows.</p> <p></p> <p>Figure 2-3: Storage Layer Selection Decision Tree \u2014 Choose best solution based on data scale, ACID needs, multi-engine access, and other factors</p>"},{"location":"en/part1/1_2_data_infra/#213-compute-layer-spark-vs-ray-data","title":"2.1.3 Compute Layer: Spark vs Ray Data","text":"<p>This is the most common \"either-or\" dilemma in LLM data engineering. Both are distributed compute frameworks, but with distinctly different design philosophies and use cases. Understanding their differences is crucial for making the right technical selection.</p> <p>Apache Spark was born in Berkeley AMPLab in 2009; after fifteen years of development, it has become the \"Swiss Army knife\" of big data processing. Spark's core strength is its maturity and stability\u2014production-validated at PB scale, with extremely rich documentation and community resources. Spark SQL enables data analysts to also write distributed processing logic, lowering the barrier to entry. Structured Streaming supports real-time data processing, achieving stream-batch unification. However, Spark also has clear disadvantages: core is JVM implementation, Python UDF requires cross JVM-Python serialization with significant performance overhead; weaker integration support for GPU and PyTorch/TensorFlow, not \"AI-native\"; operators must materialize intermediate results between them, creating significant memory pressure.</p> <p>Ray was born in Berkeley RISELab in 2017, initially a distributed reinforcement learning framework, later evolving into general AI application infrastructure. Ray Data is its data processing module, designed specifically for AI workloads. Ray Data's core strength is Python-native\u2014no JVM overhead, seamless integration with PyTorch, HuggingFace, and other AI ecosystems. It natively supports pipeline execution with high memory efficiency; built-in GPU scheduling for easy CUDA operator invocation; Actor model suits stateful complex processing, such as inference tasks requiring loaded ML models. However, Ray is relatively young with less rich documentation and best practices than Spark; weak SQL support, no mature SQL interface like Spark SQL; integration with traditional big data ecosystem (Hive, Iceberg) requires additional work.</p> Dimension Apache Spark Ray Data Language Scala/Java core, Python API Python native Runtime JVM Python (Arrow-based) Data Abstraction DataFrame (batch thinking) Dataset (stream thinking) GPU Support Requires RAPIDS plugin Native support PyTorch Integration Cumbersome First-class citizen SQL Support Very mature Limited Typical Users Traditional big data teams AI/ML teams <p>To more intuitively understand their differences, consider a concrete code comparison. Assume the task: read Parquet files, filter short text, compute text length, save results.</p> <p>Spark implementation:</p> <pre><code>from pyspark.sql import SparkSession\nfrom pyspark.sql.functions import length, col\n\n# Initialize Spark Session\nspark = SparkSession.builder \\\n    .appName(\"TextFilter\") \\\n    .config(\"spark.executor.memory\", \"8g\") \\\n    .getOrCreate()\n\n# Read \u2192 Filter \u2192 Compute \u2192 Save\ndf = spark.read.parquet(\"s3://my-bucket/raw_data/\")\ndf_filtered = df.filter(length(col(\"text\")) &gt; 100) \\\n                .withColumn(\"text_length\", length(col(\"text\")))\ndf_filtered.write.parquet(\"s3://my-bucket/processed_data/\")\n\nspark.stop()\n</code></pre> <p>Ray Data implementation:</p> <pre><code>import ray\n\n# Initialize Ray (auto-detect cluster resources)\nray.init()\n\n# Define processing function\ndef filter_and_compute(batch):\n    mask = batch[\"text\"].str.len() &gt; 100\n    filtered = batch[mask].copy()\n    filtered[\"text_length\"] = filtered[\"text\"].str.len()\n    return filtered\n\n# Read \u2192 Process \u2192 Save (pipeline execution)\nds = ray.data.read_parquet(\"s3://my-bucket/raw_data/\")\nds_processed = ds.map_batches(filter_and_compute, batch_format=\"pandas\")\nds_processed.write.parquet(\"s3://my-bucket/processed_data/\")\n</code></pre> <p>As can be seen, Spark requires explicit Executor memory configuration and uses declarative DataFrame API; Ray auto-discovers resources and uses functional <code>map_batches</code> interface. Custom logic in Spark requires defining UDF with serialization overhead; Ray uses ordinary Python functions directly, more natural.</p> <p></p> <p>Figure 2-4: Compute Framework Selection Decision Tree \u2014 Spark suits SQL/ETL scenarios, Ray suits GPU/ML scenarios</p> <p>When making actual decisions, the following logic can be used: If data processing requires GPU (e.g., calling BERT model for quality scoring), Ray Data is the more natural choice. If there are substantial SQL and BI query needs, Spark\u2019s SQL ecosystem is more mature. If there is already extensive Spark infrastructure and code assets, migration cost must be evaluated\u2014high cost then keep Spark, low cost consider gradually introducing Ray. If a new project, team background is decisive: traditional big data teams find Spark easier to adopt, AI/ML teams find Ray smoother.</p> <p>Worth mentioning: in actual large projects, Spark and Ray often coexist rather than being mutually exclusive. A common hybrid strategy: Spark handles interaction with data lake/data warehouse, including reading/writing Iceberg/Hive tables, executing SQL analysis and other ETL tasks; Ray Data handles ML-intensive processing, such as invoking large models for inference, using GPU for batch processing. The two exchange data through shared object storage (Parquet files on S3), each performing its role, complementing each other.</p>"},{"location":"en/part1/1_2_data_infra/#dask-a-python-native-third-option","title":"Dask: A Python-Native Third Option","text":"<p>Besides Spark and Ray, Dask is another noteworthy distributed computing framework, especially suited for teams with existing Pandas/NumPy code. Dask\u2019s core principle is \"parallelize the PyData ecosystem\"\u2014its API is nearly identical to Pandas/NumPy, allowing single-machine code to scale to clusters with minimal changes.</p> <p>Dask\u2019s core strengths:</p> <ul> <li>Zero learning cost: <code>dask.dataframe</code> API is nearly identical to Pandas; teams don\u2019t need to learn new syntax.</li> <li>Flexible scheduling: Can run on a single machine with multiple cores (replacing multiprocessing) or scale to distributed clusters.</li> <li>Integration with scientific computing ecosystem: Good integration with scikit-learn, XGBoost, and other ML libraries.</li> <li>Low deployment barrier: No JVM required (unlike Spark), no complex cluster management needed (simpler than Ray).</li> </ul> <p>Dask\u2019s weaknesses:</p> <ul> <li>Large-scale performance inferior to Spark: At PB-level data processing, Dask\u2019s optimizer and shuffle performance are less mature than Spark.</li> <li>No native GPU support: Unlike Ray\u2019s native GPU scheduling (requires Dask-CUDA plugin).</li> <li>Smaller community: Not as active as Spark and Ray communities.</li> </ul> <pre><code>import dask.dataframe as dd\nimport dask\n\n# Dask vs Pandas: nearly identical API\ndef process_with_dask(input_path: str, output_path: str):\n    \"\"\"Distributed text processing with Dask\"\"\"\n    # Read (auto-partitioned, lazy execution)\n    ddf = dd.read_parquet(input_path)\n\n    # Filter short text (API identical to Pandas)\n    ddf_filtered = ddf[ddf['text'].str.len() &gt; 100]\n\n    # Add computed column\n    ddf_filtered = ddf_filtered.assign(\n        text_length=ddf_filtered['text'].str.len()\n    )\n\n    # Save (triggers actual computation)\n    ddf_filtered.to_parquet(output_path)\n\n# Advanced: Using Dask Bag for unstructured data\nimport dask.bag as db\n\ndef process_jsonl_with_dask(input_pattern: str):\n    \"\"\"Process JSONL files with Dask Bag\"\"\"\n    bag = db.read_text(input_pattern).map(json.loads)\n\n    # Chained processing\n    result = (\n        bag\n        .filter(lambda x: len(x.get('text', '')) &gt; 100)\n        .map(lambda x: {**x, 'text_length': len(x['text'])})\n    )\n\n    # Convert to DataFrame and save\n    result.to_dataframe().to_parquet('output/')\n</code></pre> <p>Three-Framework Selection Summary:</p> Dimension Apache Spark Ray Data Dask Best Scenario SQL/ETL, data lake GPU/ML inference Pandas parallelization Learning Curve Medium (need Spark API) Medium (need Ray API) Very low (zero barrier for Pandas users) PB-level Performance \u2b50\u2b50\u2b50 \u2b50\u2b50 \u2b50 GPU Support Plugin Native Plugin Target Audience Data engineers AI/ML engineers Data scientists <p>For typical LLM data engineering scenarios (TB-level text data + occasional GPU inference), the recommended combination is: Spark for ETL, Ray for ML inference, Dask for rapid prototyping and medium-scale processing.</p>"},{"location":"en/part1/1_2_data_infra/#214-vector-database-selection","title":"2.1.4 Vector Database Selection","text":"<p>With the rise of RAG (Retrieval-Augmented Generation) and multimodal search, vector databases have become an indispensable component of the AI data stack. Vector databases are purpose-built for storing and retrieving high-dimensional vectors (embeddings), serving as the bridge between data engineering and model inference.</p>"},{"location":"en/part1/1_2_data_infra/#core-concepts","title":"Core Concepts","text":"<p>The core operation of a vector database is Approximate Nearest Neighbor (ANN) search. Given a query vector \\(q\\), find the \\(k\\) most similar vectors in the database. Exact search is prohibitively expensive in high-dimensional spaces, so practical systems use approximate algorithms, trading off between Recall and Query Throughput (QPS).</p> <p>Mainstream ANN indexing algorithms include:</p> <ul> <li>HNSW (Hierarchical Navigable Small World): Graph-based algorithm with high recall and fast queries, but large memory footprint. Best for scenarios requiring very high recall.</li> <li>IVF (Inverted File Index): Clustering-based algorithm that partitions the vector space into Voronoi regions, searching only the nearest regions at query time. Good memory efficiency, suitable for large-scale data.</li> <li>ScaNN (Scalable Nearest Neighbors): Developed by Google, combining quantization and pruning techniques for excellent QPS-Recall balance.</li> </ul>"},{"location":"en/part1/1_2_data_infra/#vector-database-comparison","title":"Vector Database Comparison","text":"Feature Milvus Qdrant Weaviate Pinecone FAISS Deployment Self-hosted/Cloud Self-hosted/Cloud Self-hosted/Cloud Pure SaaS Library (not a DB) Open Source Yes Yes Yes No Yes Index Algorithms HNSW, IVF, DiskANN HNSW HNSW Proprietary HNSW, IVF, PQ Distributed Native support Supported Supported Managed Manual sharding Hybrid Search Supported Supported Supported Supported Not supported Suitable Scenario Large-scale production Small-medium, high perf Full-stack semantic search Quick start, zero ops Research prototypes <p>Selection Decision Points:</p> <ul> <li>QPS vs Recall tradeoff: For pre-training data deduplication, high Recall (&gt;0.99) is needed but lower QPS is tolerable; for online RAG retrieval, high QPS (&gt;1000) is needed with slightly lower Recall acceptable.</li> <li>Data scale: Under millions of vectors, Qdrant or FAISS suffice; for tens of millions to billions, Milvus\u2019s distributed architecture has advantages.</li> <li>Operations capability: If the team lacks ops experience, Pinecone\u2019s fully managed mode is the lowest-risk choice.</li> </ul> <pre><code># Milvus vector retrieval example\nfrom pymilvus import (\n    connections, Collection, FieldSchema,\n    CollectionSchema, DataType, utility\n)\n\n# Connect to Milvus\nconnections.connect(\"default\", host=\"localhost\", port=\"19530\")\n\n# Define Schema\nfields = [\n    FieldSchema(name=\"id\", dtype=DataType.VARCHAR, is_primary=True, max_length=64),\n    FieldSchema(name=\"text\", dtype=DataType.VARCHAR, max_length=65535),\n    FieldSchema(name=\"embedding\", dtype=DataType.FLOAT_VECTOR, dim=768)\n]\nschema = CollectionSchema(fields, description=\"Document embeddings\")\n\n# Create Collection\ncollection = Collection(\"documents\", schema)\n\n# Create HNSW index (high recall configuration)\nindex_params = {\n    \"metric_type\": \"COSINE\",\n    \"index_type\": \"HNSW\",\n    \"params\": {\n        \"M\": 16,               # Connections per node; higher = better recall but more memory\n        \"efConstruction\": 256  # Search width during construction\n    }\n}\ncollection.create_index(\"embedding\", index_params)\n\n# Search\ncollection.load()\nresults = collection.search(\n    data=[query_embedding],\n    anns_field=\"embedding\",\n    param={\"metric_type\": \"COSINE\", \"params\": {\"ef\": 128}},\n    limit=10,\n    output_fields=[\"text\"]\n)\n</code></pre>"},{"location":"en/part1/1_2_data_infra/#object-storage-high-throughput-read-optimization","title":"Object Storage High-Throughput Read Optimization","text":"<p>In GPU training scenarios, data loading speed often becomes the bottleneck. When training data is stored on S3/MinIO, network I/O latency and throughput limits can leave GPUs in a \"starving\" state\u2014compute units waiting for data arrival. Key optimization strategies include:</p> <p>Prefetching and pipelining: While GPU processes the current batch, CPU prefetches next batch data, overlapping compute and I/O.</p> <p>Local SSD caching: Cache frequently accessed hot data on local NVMe SSD. First read pulls from S3, subsequent reads hit local cache. Tools like Alluxio and JuiceFS provide transparent caching layers.</p> <p>Multi-threaded concurrent reads: S3 supports Range Requests; multiple concurrent segment requests can fully utilize network bandwidth.</p> <p>Data format optimization: Use columnar formats (Parquet) with column pruning to load only training-needed columns; use Arrow IPC format for zero-copy reads.</p> <pre><code>import ray\n\ndef optimized_data_loading(s3_path: str, num_workers: int = 8):\n    \"\"\"Optimized S3 data loading with Ray parallel prefetch\"\"\"\n\n    # Use Ray Data streaming reads with automatic prefetch management\n    ds = ray.data.read_parquet(\n        s3_path,\n        parallelism=num_workers * 4,  # Prefetch multiplier\n        columns=[\"input_ids\", \"attention_mask\"],  # Column pruning\n    )\n\n    # Pipelining: read and process simultaneously\n    pipe = ds.iter_batches(\n        batch_size=1024,\n        prefetch_batches=4,  # Prefetch 4 batches\n        local_shuffle_buffer_size=10000  # Local shuffle\n    )\n\n    return pipe\n</code></pre>"},{"location":"en/part1/1_2_data_infra/#22-data-format-and-io-optimization","title":"2.2 Data Format and I/O Optimization","text":"<p>With storage and compute selected, next is choosing data serialization format. Format selection may seem a technical detail but actually directly affects storage cost, read speed, and tool compatibility. Compression ratio differences between formats can reach tenfold; columnar vs row format query performance differences are equally huge; and not all frameworks support all formats.</p>"},{"location":"en/part1/1_2_data_infra/#221-mainstream-data-format-comparison","title":"2.2.1 Mainstream Data Format Comparison","text":"<p>Parquet is the de facto standard for large-scale structured data. It uses columnar storage\u2014data from the same column is physically contiguous\u2014bringing two significant advantages: First, it facilitates compression\u2014same-type data gathered together achieves higher compression ratio; second, it facilitates vectorized reads, when querying specific columns there's no need to scan the entire file. Parquet files are self-describing with Schema embedded in the file, no external metadata definition needed. It also supports nested types for JSON-like complex structures and native directory partitioning. Parquet is the preferred format for pre-training corpus storage, especially for analysis queries requiring column filtering; works well with Spark, DuckDB, Pandas, and other tools.</p> <p>JSONL (JSON Lines) is another common format, each line an independent JSON object. Its biggest advantage is human readability\u2014can directly view content with <code>head</code>, <code>cat</code>, and other commands. It also supports streaming processing, can read line by line without loading entire file to memory. Schema is very flexible, each line can have different field structure. JSONL is especially suitable for SFT instruction data, as this type of data requires frequent manual viewing and editing. It's also commonly used for data exchange and small-scale datasets (under 10GB). However, JSONL's disadvantages are also clear: without compression volume is three to five times Parquet, read speed is slow (must parse each line's JSON string).</p> <p>WebDataset is a format spearheaded by NVIDIA, designed specifically for image-text, video, and other multimodal data. Its core idea is packaging related files (e.g., one image and its caption) into TAR archives. This design supports streaming reads\u2014can sequentially read content without decompression; also very friendly to distributed processing\u2014each TAR is an independent data shard. WebDataset is the best choice for LAION-style image-text pair datasets and video datasets, suitable for any multimodal data requiring multi-file association.</p> Feature Parquet JSONL WebDataset Storage Efficiency High (columnar compression) Low (text redundancy) Medium (no compression but compact) Read Speed Fast (vectorized) Slow (line-by-line parsing) Medium (sequential read) Human Readable No Yes No Multimodal Support Weak (requires encoding) Weak Strong (native support) Typical Use Case Pre-training text corpus SFT instruction data Image-text pairs, video data"},{"location":"en/part1/1_2_data_infra/#222-compression-algorithm-selection","title":"2.2.2 Compression Algorithm Selection","text":"<p>Regardless of format choice, compression algorithm significantly affects storage cost and read speed. Correct compression strategy requires finding balance between space efficiency and time efficiency.</p> <p>Snappy is the most common default choice. Its compression ratio is moderate but compression and decompression speeds are both fast, suitable for read-write balanced scenarios. LZ4 pursues extreme read speed\u2014decompression performance even faster than Snappy, slightly lower compression ratio, suitable for read latency sensitive scenarios. Zstandard (ZSTD) provides highest compression ratio, especially at high levels (e.g., level 19), but compression speed is slower, suitable for storage cost sensitive archival scenarios. Gzip is the most compatible choice\u2014almost all tools support it\u2014suitable for scenarios requiring data exchange with external systems.</p> Algorithm Compression Ratio Compression Speed Decompression Speed Typical Use Case Snappy Medium Fast Fast Default choice, read-write balanced LZ4 Lower Very fast Very fast Extreme read speed ZSTD High Medium Fast Storage cost sensitive Gzip High Slow Medium High compatibility requirement <p>In practice, a layered strategy can be adopted: cold data (archived storage, rarely read long-term) use ZSTD level 19 for maximum compression ratio; hot data (frequently read and processed) use Snappy or LZ4 to reduce decompression overhead; network transfer scenarios use ZSTD level 3 for balance between compression ratio and speed.</p>"},{"location":"en/part1/1_2_data_infra/#223-io-optimization-practical-tips","title":"2.2.3 I/O Optimization Practical Tips","text":"<p>In large-scale data processing, I/O is often the performance bottleneck. The following three tips can significantly improve I/O efficiency.</p> <p>Reasonable file size settings is the first key point. A common mistake is generating many small files\u2014e.g., 100,000 files of 1MB each. This causes huge metadata overhead and extremely slow S3 ListObjects operations. The correct approach is consolidating data into fewer large files, each Parquet file should be 128MB to 1GB. Too small causes metadata bloat and insufficient parallelism; too large affects task load balancing.</p> <pre><code># Wrong: generate many small files\ndf.write.parquet(\"s3://bucket/data/\", maxRecordsPerFile=1000)\n\n# Correct: generate fewer large files (recommend 128MB - 1GB)\ndf.coalesce(100).write.parquet(\"s3://bucket/data/\")\n</code></pre> <p>Partition Pruning is the second important tip. By partitioning by specific columns when writing, only needed partitions need to be scanned when reading, avoiding full table scan. Partition columns should be low cardinality (e.g., date, language, data source); avoid high cardinality columns (e.g., user ID) or you'll get massive small directories.</p> <pre><code># Partition by date when writing\ndf.write.partitionBy(\"date\").parquet(\"s3://bucket/data/\")\n\n# Only scan needed partitions when reading\nspark.read.parquet(\"s3://bucket/data/date=2024-01-01/\")\n</code></pre> <p>Column Pruning is the third tip. The biggest advantage of columnar storage is only reading needed columns. Ensure column selection happens early in query statements, avoid reading all columns then filtering.</p> <pre><code># Wrong: read all columns\ndf = spark.read.parquet(\"s3://bucket/data/\")  # If 100 columns, all loaded\n\n# Correct: only read needed columns\ndf = spark.read.parquet(\"s3://bucket/data/\").select(\"text\", \"length\")\n</code></pre> <p></p> <p>Figure 2-5: I/O Optimization Effect Comparison \u2014 Partition pruning + column pruning can reduce query time by 91% and data scan volume by 92%</p> <p>Combined use of these three tips can reduce query time from 55 seconds to 5 seconds, data scan volume from 100GB to 8GB\u2014very significant effect.</p>"},{"location":"en/part1/1_2_data_infra/#23-data-version-control-dataops","title":"2.3 Data Version Control (DataOps)","text":"<p>Code has Git, machine learning models have MLflow\u2014so how do you version control TB-level datasets? This is an often overlooked but extremely important question in LLM data engineering.</p>"},{"location":"en/part1/1_2_data_infra/#231-why-does-data-need-version-control","title":"2.3.1 Why Does Data Need Version Control?","text":"<p>Consider this scenario: a model trained six months ago performed particularly well, and the boss wants reproduction. You search through servers and find the training data was already cleaned up\u2014\"Who told you to delete it?\" \"It took 10TB!\" The data processing scripts are still there, but dependent upstream data has changed. Re-running the processing flow yields different results. Conclusion: cannot reproduce.</p> <p>This scenario is common in actual work. Data version control exists precisely to solve such problems. Its core value is reflected in four aspects: Reproducibility\u2014exactly restore data state at any moment; Traceability\u2014track complete chain from raw input to final output; Collaboration safety\u2014multiple people modifying data simultaneously won't conflict; Rollback capability\u2014quickly return to previous version when data issues are discovered.</p>"},{"location":"en/part1/1_2_data_infra/#232-tool-selection-dvc-vs-lakefs","title":"2.3.2 Tool Selection: DVC vs LakeFS","text":"<p>The two most mainstream data version control tools today are DVC and LakeFS, with distinctly different design philosophies.</p> <p>DVC (Data Version Control) design philosophy is \"Git for Data\"\u2014making data version control experience as close to Git as possible. Its working principle: data files themselves are stored in remote storage (S3/GCS), Git repo only stores data metadata files (<code>.dvc</code> files), actual data synced via <code>dvc push/pull</code> commands.</p> <pre><code># Initialize DVC\ndvc init\n\n# Add dataset to version control\ndvc add data/training_corpus.parquet\n# Generates data/training_corpus.parquet.dvc and .gitignore\n\n# Commit to Git\ngit add data/training_corpus.parquet.dvc .gitignore\ngit commit -m \"Add training corpus v1\"\n\n# Push data to remote storage\ndvc push\n\n# Switch to historical version\ngit checkout v1_0\ndvc checkout  # Sync corresponding version data\n</code></pre> <p>DVC's advantage is seamless integration with existing Git workflow, gentle learning curve, ML pipeline definition support (via <code>dvc.yaml</code>), suitable for file-level version control scenarios. Its disadvantage is each dataset needs separate <code>.dvc</code> file management, no support for fine-grained \"table-level\" operations (e.g., rolling back a partition).</p> <p>LakeFS design philosophy is \"Git for Data Lake\"\u2014providing Git-style branches and commits on top of object storage. Its working principle: LakeFS acts as object storage proxy layer, all read/write requests go through LakeFS S3 gateway, system supports Branch, Commit, Merge and other Git-style operations.</p> <pre><code># Create development branch\nlakectl branch create lakefs://repo/dev --source lakefs://repo/main\n\n# Modify data on dev branch (via S3 protocol)\naws s3 cp new_data.parquet s3://lakefs-repo/dev/data/\n\n# Commit changes\nlakectl commit lakefs://repo/dev -m \"Add new training data\"\n\n# Merge to main branch after validation\nlakectl merge lakefs://repo/dev lakefs://repo/main\n</code></pre> <p>LakeFS's core advantage is zero-copy branching\u2014creating branches doesn't copy data, only records metadata, crucial for TB-level data lakes. It's fully S3 compatible; existing tools (Spark/Ray) work without modification. Its disadvantage is requiring deployment of additional service (LakeFS Server), slightly steeper learning curve than DVC.</p> <p>Pachyderm is a third noteworthy data version control tool, unique in that it integrates data version control with data pipelines. Pachyderm is built on Kubernetes, where each data processing step runs in a container, and the system automatically tracks the correspondence between input data, processing code, and output data.</p> <pre><code># Pachyderm workflow example\n\n# Create data repository (similar to Git repo)\npachctl create repo raw_data\n\n# Upload data (auto-versioned)\npachctl put file raw_data@master:/corpus.parquet -f corpus.parquet\n\n# Create processing pipeline (declarative YAML)\npachctl create pipeline -f cleaning_pipeline.json\n# Pipeline defines: input repo, processing container, output repo\n# Pachyderm automatically tracks the complete input\u2192processing\u2192output lineage\n\n# View data lineage\npachctl inspect commit cleaned_data@master\n# Output shows which commit from raw_data, through which pipeline, generated this data\n</code></pre> <p>Pachyderm\u2019s core advantage is automated lineage tracking\u2014when input data is updated, downstream pipelines automatically trigger incremental processing, with the system naturally recording complete data lineage relationships. This is very valuable in LLM projects that require frequent iteration of data processing flows. Its downside is requiring a Kubernetes cluster (highest deployment complexity) and the steepest learning curve.</p> Feature DVC LakeFS Pachyderm Design Philosophy Git extension for data Version layer for object storage Data pipeline + version control Granularity File-level Object-level (finer) File/directory-level Branch Overhead Need to copy .dvc files Zero-copy Zero-copy S3 Compatibility Requires dvc commands Native S3 API Native S3 API Lineage Tracking Manual Manual/integration Automatic Incremental Processing Manual Manual Auto-triggered Deployment Complexity Low (CLI tool) Medium (requires server) High (requires Kubernetes) Suitable Scenario ML experiment management, small data Data lake management, large-scale data End-to-end data pipelines <p></p> <p>Figure 2-6: DVC vs LakeFS Architecture Comparison \u2014 DVC provides file-level version control based on Git, LakeFS provides zero-copy object-level version control with branching</p> <p>Selection recommendations: If data volume under 1TB, team familiar with Git workflow, mainly for ML experiment management, choose DVC; if data volume TB-level or above, need data lake-level version control, multiple teams operating in parallel, choose LakeFS; if you need end-to-end data pipeline management and the team has Kubernetes operations capability, choose Pachyderm.</p>"},{"location":"en/part1/1_2_data_infra/#233-data-lineage-tracking","title":"2.3.3 Data Lineage Tracking","text":"<p>Version control solves \"what is the data\"; lineage tracking solves \"where did the data come from.\" Lineage tracking records: which upstream data was this data derived from? What processing scripts and parameters were used? When and by whom was the processing executed?</p> <p>There are multiple approaches to implement lineage tracking. If using Spark, automated lineage tracking can be obtained through OpenLineage integration. If using orchestration tools like Airflow, Marquez is a good choice. For enterprise data governance needs, DataHub and Apache Atlas provide more complete functionality. For simple scenarios, manual instrumentation to generate metadata files is a lightweight solution:</p> <pre><code>import json\nfrom datetime import datetime\n\nmetadata = {\n    \"version\": \"v2_0\",\n    \"created_at\": datetime.now().isoformat(),\n    \"created_by\": \"data-pipeline-v3_2\",\n    \"inputs\": [\n        {\"path\": \"s3://bucket/raw/crawl_2024_01.parquet\", \"version\": \"abc123\"},\n        {\"path\": \"s3://bucket/raw/crawl_2024_02.parquet\", \"version\": \"def456\"}\n    ],\n    \"processing\": {\n        \"script\": \"cleaning_pipeline.py\",\n        \"git_commit\": \"789xyz\",\n        \"params\": {\"min_length\": 100, \"dedup_threshold\": 0.9}\n    },\n    \"outputs\": [\n        {\"path\": \"s3://bucket/processed/clean_2024_q1.parquet\", \"records\": 1000000}\n    ]\n}\n\nwith open(\"clean_2024_q1.metadata.json\", \"w\") as f:\n    json.dump(metadata, f, indent=2)\n</code></pre>"},{"location":"en/part1/1_2_data_infra/#24-common-mistakes-and-pitfall-guide","title":"2.4 Common Mistakes and Pitfall Guide","text":"<p>In the infrastructure selection process, even experienced engineers easily make some typical mistakes. Here we summarize three most common issues, hoping readers can take heed.</p> <p>The first common mistake is premature optimization and over-engineering. Some teams have only five people and 500GB of data, yet build a \"full-stack\" infrastructure of Spark cluster + Iceberg + Airflow + LakeFS. Result: 80% of time spent maintaining infrastructure, only 20% on actual data processing. The correct approach is start simple, evolve on demand. For 500GB data volume, single machine + Parquet + DVC is completely sufficient; consider distributed solutions when data volume grows to 10TB.</p> <p>The second common mistake is blindly chasing new technology while ignoring ecosystem. Some teams read a few blog posts and decide to abandon Spark entirely for Ray, only to find company Hive tables and Iceberg tables cannot be read directly. Finally need to write substantial data conversion scripts, increasing data consistency risk. The correct approach is fully evaluate existing data assets and upstream-downstream dependencies before technical selection. Technical selection is not a single-point decision but systems engineering\u2014overall ecosystem compatibility must be considered.</p> <p>The third common mistake is overly aggressive storage cost optimization. Some teams compress all data to ZSTD level 22 and store in S3 Glacier Deep Archive to save storage costs. Result: every time data needs to be read, wait 12 hours for thaw, decompression takes another 4 hours, model training has to be scheduled a week in advance. The correct approach is distinguish cold and hot data. Actively processed data goes in S3 Standard + Snappy compression; archival data unused for six months or more goes to Glacier. Storage cost and access efficiency need to find a balance point.</p>"},{"location":"en/part1/1_2_data_infra/#25-chapter-summary","title":"2.5 Chapter Summary","text":"<p>This chapter systematically introduced AI-native data stack technology selection, covering five core dimensions: storage, compute, vector databases, format, and version control.</p> <p>For storage selection: object storage (S3/MinIO) is the foundation of modern data stack; data lake formats (Iceberg/Hudi/Delta) solve ACID transactions, time travel, and other issues. For LLM scenarios, the recommended combination is S3 + Iceberg, because Iceberg has the best engine neutrality. For GPU training scenarios, I/O bottlenecks need optimization through prefetch pipelining, local SSD caching, and concurrent reads.</p> <p>For compute selection: Spark is known for maturity and stability and powerful SQL ecosystem, suitable for traditional big data teams; Ray Data is Python-native AI-friendly framework, suitable for ML/AI teams; Dask offers a zero-learning-curve option for teams with existing Pandas code. The three are not mutually exclusive\u2014can be mixed according to needs.</p> <p>For vector databases: Milvus, Qdrant, Weaviate, and other systems provide foundational capabilities for RAG and semantic retrieval. Selection requires balancing QPS and Recall based on data scale and operations capability.</p> <p>For data format: Parquet is the default for structured data, JSONL suitable for small-scale data requiring manual viewing, WebDataset is the best format for multimodal data. Compression algorithms and I/O optimization tips can significantly affect performance and cost.</p> <p>For version control: DVC is lightweight and tightly integrated with Git, suitable for ML experiments; LakeFS provides data lake-level version control, suitable for large-scale production environments; Pachyderm integrates version control with data pipelines, suitable for teams needing end-to-end lineage tracking.</p> <p>The core principle throughout: start simple, evolve on demand, avoid over-engineering. Technical selection should serve business goals, not pursue technical advancement for its own sake.</p> <p></p> <p>Figure 2-7: Data Infrastructure Selection Quick Reference \u2014 Four-quadrant decision guide for storage, table format, compute, and version control</p>"},{"location":"en/part1/1_2_data_infra/#further-reading","title":"Further Reading","text":"<p>For readers wishing to deepen understanding of this chapter's content, the following resources are worth referencing:</p> <p>Ray Data official documentation (docs.ray.io) provides Ray Data best practices and detailed API reference. Apache Iceberg official documentation (iceberg.apache.org) contains table format detailed specifications and engine integration guides. DVC official tutorial (dvc.org/doc) is a good starting point for quick start. LakeFS official documentation (docs.lakefs.io) details architecture design and deployment options.</p> <p>Databricks' published data lake selection white paper provides in-depth comparative analysis of Delta, Iceberg, and Hudi formats. Uber's published \"Scaling MLOps at Uber\" article introduces how to manage ML data at PB scale. These materials can help readers build more comprehensive technical perspective.</p>"},{"location":"en/part1/1_2_data_infra/#preview-of-next-chapter","title":"Preview of Next Chapter","text":"<p>In the next chapter Data Acquisition and Collection, we will formally enter the pre-training data processing flow. You will learn how to obtain and parse open-source datasets like Common Crawl and The Pile, how to use Trafilatura to build high-performance web page parsers, and specialized strategies for crawling code and papers from GitHub and ArXiv.</p> <p>Take this question into the next chapter: Common Crawl adds 3-5PB of data monthly\u2014how do you efficiently extract the content you need from it?</p>"},{"location":"en/part2/2_1_data_acquisition/","title":"Chapter 3: Data Acquisition","text":""},{"location":"en/part2/2_1_data_acquisition/#chapter-3-data-acquisition-commoncrawl-parsing-and-high-concurrency-crawling","title":"Chapter 3: Data Acquisition (CommonCrawl Parsing and High-Concurrency Crawling)","text":""},{"location":"en/part2/2_1_data_acquisition/#chapter-summary","title":"Chapter Summary","text":"<p>Pre-training data is the \"fuel\" of large models, and its quality and scale directly determine the model's foundational capabilities. This chapter delves into pre-training data acquisition strategies, from deconstructing and using open-source datasets like Common Crawl, to designing and implementing high-performance web crawler systems, and to acquiring specialized data such as code, papers, and books. After mastering this content, readers will possess the ability to build TB-level pre-training corpora.</p>"},{"location":"en/part2/2_1_data_acquisition/#scenario-introduction","title":"Scenario Introduction","text":"<p>Your team has decided to train a 7B parameter Chinese base model. According to Chinchilla's optimal ratio, this requires approximately 140B tokens of high-quality Chinese corpus\u2014translating to about 280TB of raw text. Where can you find this much data? Directly crawling from the web is clearly impractical; a small team cannot crawl the entire Chinese internet in a short time.</p> <p>At this point, someone suggests using Common Crawl\u2014an open-source project that crawls billions of web pages each month, with cumulative data exceeding PB scale. It sounds like a perfect solution, but when you actually download one month's data, you discover that the raw WARC files are completely unusable: filled with HTML tags, JavaScript code, navigation bars, and ads\u2014the truly valuable body content may be less than 10%.</p> <p>How do you extract usable \"golden corpus\" for training from this \"data swamp\"? This is the core problem this chapter aims to solve.</p>"},{"location":"en/part2/2_1_data_acquisition/#31-deconstruction-of-open-source-datasets","title":"3.1 Deconstruction of Open-Source Datasets","text":"<p>Before starting to crawl data yourself, you should first fully leverage existing open-source datasets. These datasets have been carefully processed by the community and can significantly reduce the time and cost of preparing pre-training data. Understanding their composition and processing methods is also an important reference for designing your own data pipeline.</p>"},{"location":"en/part2/2_1_data_acquisition/#311-common-crawl-a-snapshot-of-the-internet","title":"3.1.1 Common Crawl: A Snapshot of the Internet","text":"<p>Common Crawl is a non-profit organization that has been continuously crawling internet web pages since 2008 and provides them free of charge for research and commercial use. It is currently the upstream source for the vast majority of large-scale pre-training datasets\u2014whether GPT series, LLaMA, or various Chinese large models, they all use Common Crawl data to varying degrees.</p> <p>Common Crawl data is organized in \"crawl batches,\" releasing a new batch each month, with each batch containing billions of web pages. The data is provided in three formats: WARC (Web ARChive) files contain raw HTTP responses, including response headers and complete HTML content, making it the most original and complete format; WAT files are metadata-extracted versions of WARC, containing structured information such as URLs, response headers, and link relationships; WET files are plain text extracted versions that have removed HTML tags, preserving only body text.</p> Format Content Monthly Data Volume Use Case WARC Raw HTTP Response + HTML ~80TB compressed Need complete content or custom parsing WAT Structured metadata ~3TB compressed URL analysis, link graph research WET Plain text extraction ~15TB compressed Quick text acquisition, preliminary experiments <p></p> <p>Figure 3-1: Common Crawl Data Pipeline \u2014 Complete processing flow from internet crawling to clean corpus</p> <p>For pre-training data engineering, WARC and WET are the two most commonly used formats. WET files seem convenient because text has already been extracted, but in reality Common Crawl's default text extraction quality is poor, retaining large amounts of noise (such as navigation bars, footers, JavaScript text). Therefore, professional data processing pipelines typically start from WARC files and use higher-quality parsers (such as Trafilatura) to re-extract the body content.</p> <p>Several key points need attention when using Common Crawl data. First is version selection: each monthly crawl batch varies slightly in quality, and it is generally recommended to use more recent versions (such as batches from after 2023), as Common Crawl continuously improves its crawling strategies. Second is language filtering: Common Crawl is predominantly English web pages, with non-English content like Chinese and Japanese accounting for relatively low proportions (typically less than 10%), requiring additional language identification steps for screening. Finally is legal compliance: although Common Crawl is open data, the web page content it crawls may involve copyright issues and needs to be evaluated according to local laws when using.</p>"},{"location":"en/part2/2_1_data_acquisition/#312-refinedweb-high-quality-english-corpus","title":"3.1.2 RefinedWeb: High-Quality English Corpus","text":"<p>RefinedWeb is a high-quality English pre-training dataset released by the Falcon model team (TII Lab of UAE), containing approximately 5T tokens. Unlike directly using Common Crawl, RefinedWeb has undergone strict cleaning and deduplication processing and is considered one of the highest quality publicly available English pre-training corpora.</p> <p>RefinedWeb's processing pipeline has strong reference value. Its core steps include: URL filtering (removing adult websites, spam sites, etc.), text extraction (using Trafilatura for high-quality body extraction), language identification (using FastText to retain English content), quality filtering (removing low-quality documents based on heuristic rules), and fuzzy deduplication (using MinHash LSH for approximate deduplication at large scale).</p> <p>The RefinedWeb paper details the implementation and effectiveness evaluation of each step, making it an excellent textbook for learning pre-training data processing. It's worth noting that although RefinedWeb has publicly released a subset of the dataset (~600B tokens), the complete version remains exclusive to the Falcon model.</p>"},{"location":"en/part2/2_1_data_acquisition/#313-the-pile-diversified-data-mixture","title":"3.1.3 The Pile: Diversified Data Mixture","text":"<p>The Pile is an open-source pre-training dataset released by EleutherAI, approximately 800GB in size (uncompressed), containing about 300B tokens. Unlike RefinedWeb's focus on web data, The Pile's design philosophy is diversification\u2014it mixes data from 22 different sources, covering web pages, books, code, papers, legal documents, and other domains.</p> <p>The Pile's data source composition reflects the importance of pre-training data diversity. Among them, Pile-CC is a cleaned Common Crawl subset, accounting for approximately 50%; PubMed Central provides biomedical papers; ArXiv provides scientific preprints; GitHub provides open-source code; Books3 provides book text; StackExchange provides technical Q&amp;A; Wikipedia provides encyclopedic knowledge. This multi-source mixing strategy has been proven to improve model performance across various downstream tasks, with later models like LLaMA and Mistral borrowing similar approaches in their data recipes.</p> <p>However, The Pile faces legal controversies. Its Books3 subset contains large amounts of copyrighted books and has triggered multiple lawsuits. When using The Pile, it is recommended to evaluate based on your own legal risk tolerance, or selectively exclude controversial subsets.</p>"},{"location":"en/part2/2_1_data_acquisition/#314-overview-of-chinese-datasets","title":"3.1.4 Overview of Chinese Datasets","text":"<p>For training Chinese large models, available open-source datasets are relatively scarce, though there has been improvement in recent years.</p> <p>WuDaoCorpora is a large-scale Chinese corpus released by BAAI, containing approximately 3TB of Chinese text, covering encyclopedias, news, forums, Q&amp;A, and other sources. Data must be obtained through application, and usage must comply with relevant agreements. ChineseCrawl is a Chinese Common Crawl subset extraction, with multiple community versions available. CLUECorpus is Chinese corpus released by the CLUE benchmark team, approximately 100GB in size, suitable for small to medium-scale experiments.</p> <p>Compared to the richness of English datasets, Chinese pre-training data remains a \"seller's market.\" This means Chinese large model teams often need to acquire and process Chinese data themselves from Common Crawl or other sources, and cannot rely entirely on existing open-source datasets.</p>"},{"location":"en/part2/2_1_data_acquisition/#32-high-performance-web-parsing","title":"3.2 High-Performance Web Parsing","text":"<p>After obtaining raw HTML from Common Crawl or your own crawler, the next critical step is extracting body text from it. This seems simple but is actually one of the most critical steps in the entire data pipeline\u2014parsing quality directly determines the quality of the final corpus.</p>"},{"location":"en/part2/2_1_data_acquisition/#321-challenges-of-web-parsing","title":"3.2.1 Challenges of Web Parsing","text":"<p>Modern web pages are far more complex than they appear on the surface. A typical web page may contain: HTML structural tags, CSS style definitions, JavaScript code (including inline and external references), navigation bars and footers, ads and promotional content, comment sections and user-generated content, page sidebars and recommended content. What we need is only the \"body\"\u2014the main content section of the page.</p> <p>Traditional parsing methods (such as simply removing all HTML tags) work poorly because they cannot distinguish between body content and noise. More advanced methods need to understand the semantic structure of web pages and identify which parts are truly valuable content.</p>"},{"location":"en/part2/2_1_data_acquisition/#322-trafilatura-industrial-grade-parsing-library","title":"3.2.2 Trafilatura: Industrial-Grade Parsing Library","text":"<p>Trafilatura is currently the most recommended web body extraction library, adopted by mainstream datasets like RefinedWeb and Dolma. Its core advantages lie in: finely-tuned extraction algorithms with excellent performance on multiple evaluation datasets; good multilingual support, especially for Asian languages like Chinese and Japanese; rich configuration options that can adjust extraction strategies according to needs; and reasonable performance suitable for large-scale data processing.</p> <p>The basic workflow for using Trafilatura is as follows:</p> <pre><code>import trafilatura\n\n# Extract body content from HTML\ndef extract_content(html: str, url: str = None) -&gt; dict:\n    \"\"\"\n    Extract body content from HTML\n\n    Args:\n        html: Raw HTML string\n        url: Optional URL for resolving relative links\n\n    Returns:\n        Dictionary containing body content and metadata\n    \"\"\"\n    # Core extraction\n    result = trafilatura.extract(\n        html,\n        url=url,\n        include_comments=False,    # Exclude comment section\n        include_tables=True,       # Preserve table content\n        no_fallback=False,         # Allow fallback algorithms\n        favor_precision=True,      # Prioritize precision\n        output_format='txt'        # Output plain text\n    )\n\n    # Extract metadata\n    metadata = trafilatura.extract_metadata(html)\n\n    return {\n        'text': result,\n        'title': metadata.title if metadata else None,\n        'author': metadata.author if metadata else None,\n        'date': metadata.date if metadata else None,\n        'url': url\n    }\n</code></pre> <p>Trafilatura provides rich configuration options, with different parameter combinations suitable for different scenarios. <code>include_comments</code> controls whether to preserve page comment section content\u2014can be set to True for forum-type websites, usually set to False for news websites. <code>include_tables</code> controls whether to preserve tables\u2014should be set to True for data-type pages (such as Wikipedia). <code>favor_precision</code> and <code>favor_recall</code> are a pair of trade-off parameters; the former prioritizes ensuring extraction accuracy (better to miss than include errors), the latter prioritizes ensuring extraction completeness (better to have noise than be incomplete). For pre-training data, typically choose <code>favor_precision=True</code>, as noisy data harms model training.</p>"},{"location":"en/part2/2_1_data_acquisition/#323-comparison-of-other-parsing-tools","title":"3.2.3 Comparison of Other Parsing Tools","text":"<p>Besides Trafilatura, there are several commonly used web parsing tools, each with their own characteristics.</p> <p>Readability was originally developed by Mozilla for Firefox's reading mode. Its algorithm is relatively simple and fast, but performance on complex pages is average. The Python ecosystem has ported versions like readability-lxml.</p> <p>Newspaper3k is specifically optimized for news websites and can effectively extract article titles, body text, publication dates, authors, and other information. However, it performs poorly on non-news sites, and the project is not actively maintained.</p> <p>Justext is a library focused on \"boilerplate removal,\" with algorithms based on link density and text density of text blocks. It is commonly cited in academic research but has less engineering practicality than Trafilatura.</p> Tool Advantages Disadvantages Recommended Scenarios Trafilatura Best overall performance, good multilingual support Medium speed General scenarios, first choice Readability Fast, simple algorithm Poor on complex pages Rapid prototyping Newspaper3k Good for news sites Weak generalization News corpus specialty Justext Academically well-validated Less engineering adaptation Research scenarios <p></p> <p>Figure 3-2: Web Parser Quality Comparison \u2014 Trafilatura leads in F1 score, making it the preferred tool for LLM data processing</p> <p>In actual projects, a common strategy is to use Trafilatura as the primary parser, and when extraction results are empty or too short, fall back to Readability for attempts. This \"primary-backup\" strategy can improve overall extraction success rate.</p>"},{"location":"en/part2/2_1_data_acquisition/#324-distributed-parsing-architecture","title":"3.2.4 Distributed Parsing Architecture","text":"<p>Single-machine processing capacity is limited; facing TB-level WARC files requires building distributed parsing systems. Here's an example of distributed parsing based on Ray Data:</p> <pre><code>import ray\nimport trafilatura\nfrom warcio.archiveiterator import ArchiveIterator\nimport gzip\n\nray.init()\n\ndef parse_warc_record(record):\n    \"\"\"Parse single WARC record\"\"\"\n    if record.rec_type != 'response':\n        return None\n\n    url = record.rec_headers.get_header('WARC-Target-URI')\n    content_type = record.http_headers.get_header('Content-Type', '')\n\n    # Only process HTML pages\n    if 'text/html' not in content_type:\n        return None\n\n    try:\n        html = record.content_stream().read().decode('utf-8', errors='ignore')\n        text = trafilatura.extract(html, url=url, favor_precision=True)\n\n        if text and len(text) &gt; 200:  # Filter overly short content\n            return {\n                'url': url,\n                'text': text,\n                'length': len(text)\n            }\n    except Exception as e:\n        return None\n\n    return None\n\ndef process_warc_file(warc_path: str):\n    \"\"\"Process single WARC file\"\"\"\n    results = []\n\n    with gzip.open(warc_path, 'rb') as f:\n        for record in ArchiveIterator(f):\n            result = parse_warc_record(record)\n            if result:\n                results.append(result)\n\n    return results\n\n# Get all WARC file paths\nwarc_files = [...]  # S3 or local path list\n\n# Distributed parallel processing\nds = ray.data.from_items(warc_files)\nds = ds.flat_map(process_warc_file)\n\n# Save results\nds.write_parquet(\"s3://bucket/parsed_data/\")\n</code></pre> <p>Key design points of this architecture include: using Ray Data's <code>flat_map</code> operator to achieve file-level parallelism; performing error handling inside the parsing function to avoid single data failures affecting batch processing; early filtering through conditions like <code>len(text) &gt; 200</code> to reduce downstream processing volume; outputting in Parquet format for convenient subsequent deduplication and filtering steps.</p>"},{"location":"en/part2/2_1_data_acquisition/#33-specialized-data-acquisition","title":"3.3 Specialized Data Acquisition","text":"<p>Besides general web data, pre-training corpora typically also need to include specialized domain data such as code, academic papers, and books. These \"specialized data\" have unique challenges and techniques for acquisition and processing.</p>"},{"location":"en/part2/2_1_data_acquisition/#331-code-data-github-and-the-stack","title":"3.3.1 Code Data: GitHub and The Stack","text":"<p>Code capability is one of the core competencies of modern large models, and acquiring high-quality code data is the foundation for achieving this capability. Currently, the most important source of code data is GitHub.</p> <p>Obtaining code directly from the GitHub API is feasible but inefficient and has request limits. A more common approach is to use public data mirrors of GitHub. Google BigQuery hosts complete snapshots of GitHub public repositories and allows querying and exporting using SQL. Software Heritage is an organization dedicated to preserving humanity's software heritage and maintains a complete archive of GitHub.</p> <p>For large-scale code data needs, the most convenient choice is to use The Stack dataset released by the BigCode project. This dataset crawls code in over 300 programming languages from GitHub, with a total size of about 3TB. The Stack's processing pipeline includes: license-based filtering (retaining only code allowed by open-source licenses), deduplication (removing duplicate files and code snippets), and PII cleaning (removing sensitive information).</p> <p>Special attention is needed when using code data:</p> <p>License compliance is the primary concern. Different open-source licenses have different restrictions on code usage. The Stack dataset provides license tags and can be filtered according to needs. For commercial model training, it is recommended to only use code with permissive licenses like MIT and Apache 2.0.</p> <p>Code quality varies greatly. GitHub contains both high-quality projects like the Linux kernel and large amounts of student assignments and personal experimental code. Common quality filtering strategies include: filtering by repository star count (retaining repositories with star &gt; 10), filtering by file length (removing overly short or long files), and detecting syntax errors based on AST parsing.</p> <p>Example of processing code data:</p> <pre><code>import ast\nfrom typing import Optional\n\ndef is_valid_python(code: str) -&gt; bool:\n    \"\"\"Check if Python code is syntactically correct\"\"\"\n    try:\n        ast.parse(code)\n        return True\n    except SyntaxError:\n        return False\n\ndef extract_functions(code: str) -&gt; list:\n    \"\"\"Extract function definitions from code\"\"\"\n    try:\n        tree = ast.parse(code)\n        functions = []\n        for node in ast.walk(tree):\n            if isinstance(node, ast.FunctionDef):\n                functions.append(ast.unparse(node))\n        return functions\n    except:\n        return []\n\ndef filter_code_quality(code: str, \n                        min_lines: int = 10, \n                        max_lines: int = 1000,\n                        require_docstring: bool = True) -&gt; Optional[str]:\n    \"\"\"Code quality filtering\"\"\"\n    lines = code.split('\\n')\n\n    # Length filtering\n    if not (min_lines &lt;= len(lines) &lt;= max_lines):\n        return None\n\n    # Syntax check\n    if not is_valid_python(code):\n        return None\n\n    # Docstring check (optional)\n    if require_docstring and '\"\"\"' not in code and \"'''\" not in code:\n        return None\n\n    return code\n</code></pre>"},{"location":"en/part2/2_1_data_acquisition/#332-academic-papers-arxiv-and-s2orc","title":"3.3.2 Academic Papers: ArXiv and S2ORC","text":"<p>Academic papers are an important source of high-quality knowledge and significantly help improve models' reasoning abilities and professional knowledge levels.</p> <p>ArXiv is the most important open-access preprint platform, covering academic papers in fields like physics, mathematics, computer science, and biology. ArXiv provides bulk download services, with LaTeX source files and PDFs accessible through its S3 bucket. LaTeX source files are a more ideal data source because they preserve the structural information of papers (sections, formulas, citations, etc.) and are in plain text format, easy to process.</p> <p>The main challenge in processing ArXiv LaTeX data lies in the complexity of LaTeX syntax. A paper may contain dozens of <code>.tex</code> files, using custom macros and styles. A practical simplification strategy is: extract only the main file (usually <code>main.tex</code> or files related to the paper title), use regular expressions to remove figure-table and complex formula environments, and preserve body text and simple mathematical expressions.</p> <pre><code>import re\nimport tarfile\nfrom pathlib import Path\n\ndef extract_arxiv_text(latex_content: str) -&gt; str:\n    \"\"\"Extract plain text from LaTeX\"\"\"\n    text = latex_content\n\n    # Remove comments\n    text = re.sub(r'%.*$', '', text, flags=re.MULTILINE)\n\n    # Remove figure environments\n    text = re.sub(r'\\\\begin\\{figure\\}.*?\\\\end\\{figure\\}', '', text, flags=re.DOTALL)\n    text = re.sub(r'\\\\begin\\{table\\}.*?\\\\end\\{table\\}', '', text, flags=re.DOTALL)\n\n    # Simplify citations\n    text = re.sub(r'\\\\cite\\{[^}]+\\}', '[CITATION]', text)\n    text = re.sub(r'\\\\ref\\{[^}]+\\}', '[REF]', text)\n\n    # Remove common commands but preserve arguments\n    commands_to_strip = ['textbf', 'textit', 'emph', 'section', 'subsection', \n                         'paragraph', 'title', 'author']\n    for cmd in commands_to_strip:\n        text = re.sub(rf'\\\\{cmd}\\{{([^}}]+)\\}}', r'\\1', text)\n\n    # Remove other commands\n    text = re.sub(r'\\\\[a-zA-Z]+(\\[[^\\]]*\\])?\\{[^}]*\\}', '', text)\n    text = re.sub(r'\\\\[a-zA-Z]+', '', text)\n\n    # Clean whitespace\n    text = re.sub(r'\\n\\s*\\n', '\\n\\n', text)\n    text = re.sub(r' +', ' ', text)\n\n    return text.strip()\n</code></pre> <p>Semantic Scholar Open Research Corpus (S2ORC) is a large-scale academic paper dataset released by Allen AI, containing metadata for over 80M papers and full text for approximately 8M papers. Compared to ArXiv, S2ORC covers broader fields, including multiple sources like PubMed and ACL Anthology. S2ORC's full text has been processed into structured JSON format, eliminating the hassle of LaTeX/PDF parsing, making it a convenient choice for quickly acquiring paper data.</p>"},{"location":"en/part2/2_1_data_acquisition/#333-book-data-copyright-and-alternative-solutions","title":"3.3.3 Book Data: Copyright and Alternative Solutions","text":"<p>Books are an important source of high-quality long texts and are valuable for training models' long-range comprehension abilities and knowledge depth. However, the copyright issues of book data are particularly sensitive.</p> <p>Books3 in The Pile contains approximately 200,000 books from sources like Bibliotik. This dataset has triggered multiple copyright lawsuits, with several companies being sued for using this dataset to train models. In the current legal environment, directly using Books3 poses significant legal risks.</p> <p>Compliant alternatives include:</p> <p></p> <p>Figure 3-3: Pre-training Data Source Mixture \u2014 Multi-source mixing strategy can improve models' comprehensive capabilities</p> <p>Project Gutenberg is a volunteer project providing copyright-expired classic books. Primarily English books published before 1928, about 70,000 volumes. High data quality, but from a distant era with insufficient coverage of modern language.</p> <p>Internet Archive's Open Library provides borrowable e-books. Usage must comply with its borrowing agreements; large-scale batch acquisition may violate terms of service.</p> <p>Wikisource provides public domain literary works, covering multiple languages including large amounts of classical Chinese texts.</p> <p>Academic textbooks and Open Educational Resources (OER) like OpenStax provide high-quality textbook content suitable for building education-focused pre-training data.</p> <p>For commercial model training, the safest strategy is to only use book data that has been explicitly authorized or is in the public domain. Although this limits data scale, it can avoid potential legal risks.</p>"},{"location":"en/part2/2_1_data_acquisition/#334-multilingual-data-balancing","title":"3.3.4 Multilingual Data Balancing","text":"<p>When training multilingual models, data availability varies greatly across languages. English data is most abundant, major languages like Chinese, Japanese, and German are second, while high-quality data for minor languages is extremely scarce.</p> <p>Data imbalance leads to uneven model capabilities. If simply mixing according to original proportions, English will dominate overwhelmingly and minor languages will barely be learned. Common solution strategies include:</p> <p>Upsampling minor languages is the most direct method, increasing the weight of minor language data through repeated sampling. However, excessive repetition may lead to overfitting.</p> <p>Temperature sampling is a more refined method. Set a temperature parameter T, where the sampling probability for language L is \\(p_L \\propto n_L^{1/T}\\), where \\(n_L\\) is the original data volume for that language. When T=1, it degenerates to original proportions; as T\u2192\u221e, it approaches uniform distribution. LLaMA 2 used temperature sampling around T=0.3.</p> <p>The quality over quantity approach is also worth considering. For minor languages with scarce data, translation or synthesis methods can be used to augment data, but attention must be paid to translation quality and unnatural translation issues.</p>"},{"location":"en/part2/2_1_data_acquisition/#34-engineering-practices-for-data-acquisition","title":"3.4 Engineering Practices for Data Acquisition","text":"<p>Connecting all the above steps to build a complete data acquisition pipeline requires considering many engineering details.</p>"},{"location":"en/part2/2_1_data_acquisition/#341-crawler-architecture-design","title":"3.4.1 Crawler Architecture Design","text":"<p>For scenarios requiring independent data crawling (rather than using Common Crawl), distributed crawler architecture design is crucial. A typical architecture includes the following components:</p> <p>URL Manager is responsible for maintaining queues of URLs to be crawled, recording the status of crawled URLs, and handling URL deduplication and priority sorting. Common implementation methods include Redis queues combined with Bloom Filter deduplication.</p> <p></p> <p>Figure 3-4: Distributed Web Crawling System Architecture \u2014 Collaboration between URL Manager, downloader cluster, parser, and storage layer</p> <p>Downloader Cluster is responsible for actual HTTP requests. Key considerations include: concurrency control (avoiding excessive pressure on target websites), proxy pool management (dealing with anti-crawler mechanisms), retry strategies (handling network fluctuations and temporary failures), and robots.txt compliance (respecting website crawler rules).</p> <p>Parser is responsible for extracting body content and metadata from downloaded HTML, which was discussed in detail in the previous section.</p> <p>Storage Layer is responsible for persisting crawl results. For large-scale crawling, it is recommended to write directly to object storage (S3/MinIO) in WARC or Parquet format.</p> <pre><code># Simplified crawler example\nimport asyncio\nimport aiohttp\nfrom urllib.parse import urlparse\nimport trafilatura\n\nclass SimpleCrawler:\n    def __init__(self, max_concurrent: int = 100):\n        self.max_concurrent = max_concurrent\n        self.semaphore = asyncio.Semaphore(max_concurrent)\n        self.visited = set()\n\n    async def fetch(self, session: aiohttp.ClientSession, url: str) -&gt; dict:\n        \"\"\"Asynchronously fetch and parse single URL\"\"\"\n        if url in self.visited:\n            return None\n        self.visited.add(url)\n        ntigravity: Reset onboarding\n        async with self.semaphore:\n            try:\n                async with session.get(url, timeout=30) as response:\n                    if response.status != 200:\n                        return None\n                    html = await response.text()\n                    text = trafilatura.extract(html, url=url)\n                    return {'url': url, 'text': text} if text else None\n            except Exception:\n                return None\n\n    async def crawl(self, urls: list) -&gt; list:\n        \"\"\"Batch crawl URL list\"\"\"\n        async with aiohttp.ClientSession() as session:\n            tasks = [self.fetch(session, url) for url in urls]\n            results = await asyncio.gather(*tasks)\n            return [r for r in results if r is not None]\n</code></pre>"},{"location":"en/part2/2_1_data_acquisition/#342-incremental-update-strategy","title":"3.4.2 Incremental Update Strategy","text":"<p>Pre-training data is not a one-time task. Over time, new data needs to be continuously absorbed to maintain the timeliness of model knowledge. The key challenges of incremental updates are:</p> <p>Identifying new data: For Common Crawl, new batches are released monthly and can be processed directly. For independent crawling, update timestamps need to be maintained, periodically revisiting known URLs to check for updates.</p> <p>Avoiding duplicate processing: Already processed data should not re-enter the pipeline. Deduplication can be performed through URL fingerprints, content hashes, and other methods.</p> <p>Version management: Each processing batch should have a clear version identifier for traceability and rollback. This is closely related to the data version control (DVC/LakeFS) discussed in Chapter 2.</p>"},{"location":"en/part2/2_1_data_acquisition/#343-quality-monitoring-and-feedback","title":"3.4.3 Quality Monitoring and Feedback","text":"<p>Data acquisition pipelines need to establish comprehensive quality monitoring mechanisms. Key monitoring metrics include:</p> <p>Download success rate: Proportion of failed requests. If it suddenly increases, the target website may have blocked the crawler.</p> <p>Parsing success rate: Proportion of successful body text extractions. If it decreases, the target website may have changed its page structure.</p> <p>Average document length: Average character count of body text. Abnormal fluctuations may indicate parser problems.</p> <p>Language distribution: Proportion of data in each language. Ensure it matches the expected language ratio.</p> <p>Duplication rate: Proportion of duplication with historical data. An excessively high duplication rate means the marginal value of new data is declining.</p> <p>It is recommended to integrate these metrics into monitoring systems (such as Prometheus + Grafana), set alert thresholds, and promptly detect and handle anomalies.</p>"},{"location":"en/part2/2_1_data_acquisition/#35-common-pitfalls-and-best-practices","title":"3.5 Common Pitfalls and Best Practices","text":"<p>In the data acquisition phase, several common pitfalls deserve caution.</p> <p>The first pitfall is over-reliance on a single data source. If pre-training data all comes from Common Crawl, the model may inherit the biases and noise of web data. A reasonable approach is to mix multiple sources: web data provides breadth, books and papers provide depth, and code data provides logical capabilities. The Pile-style multi-source mixing strategy has proven effective.</p> <p>The second pitfall is ignoring data timeliness. Historical batches of Common Crawl, though voluminous, may contain outdated information. For applications requiring timeliness (such as news and current events), more recent data batches should be prioritized. Additionally, very old data may contain defunct links, corrected erroneous information, etc.</p> <p>The third pitfall is underestimating compliance risks. Copyright issues, privacy issues, robots.txt violations, etc., may trigger serious legal problems in later project stages. The best practice is to establish comprehensive metadata records during the data acquisition phase\u2014recording each data item's source URL, acquisition time, claimed license, and other information, leaving evidence for possible future audits.</p> <p>The fourth pitfall is emphasizing collection over processing. Many teams expend great effort expanding data collection scale but rush through parsing and cleaning steps. As stated in Chapter 1, data quality is far more important than data quantity. It's better to collect less data but ensure each piece undergoes strict quality control.</p>"},{"location":"en/part2/2_1_data_acquisition/#36-chapter-summary","title":"3.6 Chapter Summary","text":"<p>This chapter systematically introduces the methodology and engineering practices of pre-training data acquisition.</p> <p>In terms of open-source datasets, Common Crawl is the most important upstream data source, providing three formats: WARC, WAT, and WET. RefinedWeb and The Pile are carefully processed high-quality datasets whose processing methods are worth learning from. Chinese datasets are relatively scarce, often requiring independent extraction from Common Crawl.</p> <p>In terms of web parsing, Trafilatura is currently the most recommended industrial-grade parsing library, capable of accurately extracting body content from complex HTML. Distributed parsing architectures (such as based on Ray Data) are necessary for processing TB-level data.</p> <p>In terms of specialized data, code data can be acquired through The Stack or GitHub BigQuery, with attention to license compliance; academic papers can be acquired through ArXiv and S2ORC; book data carries higher copyright risks, and public domain resources are recommended. Multilingual data needs to be balanced through strategies like temperature sampling.</p> <p>In terms of engineering practices, a complete data acquisition pipeline needs to consider crawler architecture design, incremental update strategies, and quality monitoring mechanisms. Core principles are multi-source mixing, quality first, and compliance foremost.</p> <p></p> <p>Figure 3-5: Chapter 3 Knowledge Structure \u2014 Covering four major themes: open-source datasets, web parsing, specialized data, and engineering practices</p>"},{"location":"en/part2/2_1_data_acquisition/#further-reading","title":"Further Reading","text":"<p>For in-depth content on pre-training data acquisition, the following resources are worth consulting:</p> <p>Common Crawl official documentation (commoncrawl.org/the-data) provides detailed introductions to data formats and acquisition methods. The RefinedWeb paper (Falcon LLM: A Large Language Model for High-Quality Web Data) details the complete process of building high-quality pre-training sets from Common Crawl. The Pile paper (The Pile: An 800GB Dataset of Diverse Text for Language Modeling) introduces multi-source mixed data construction strategies. Trafilatura documentation (trafilatura.readthedocs.io) provides comprehensive API documentation and usage examples. The Stack paper (StarCoder: May the Source Be with You!) introduces methods for building large-scale code datasets.</p>"},{"location":"en/part2/2_1_data_acquisition/#next-chapter-preview","title":"Next Chapter Preview","text":"<p>Acquiring raw data is only the first step. In the next chapter, \"Cleaning and Denoising,\" we will delve into how to screen high-quality content from massive raw data. You will learn heuristic filtering rules (language identification, perplexity filtering, length distribution), large-scale deduplication techniques (principles and distributed implementation of MinHash LSH), and privacy data cleaning (PII identification and removal).</p> <p>Enter the next chapter with this question: If two documents have 80% identical content, how can you efficiently identify and handle them?</p>"},{"location":"en/part2/2_2_cleaning_denoising/","title":"Chapter 4: Cleaning & Deduplication","text":""},{"location":"en/part2/2_2_cleaning_denoising/#chapter-4-cleaning-and-quality-control-deduplication-pii-masking-benchmark-decontamination","title":"Chapter 4: Cleaning and Quality Control (Deduplication, PII Masking, Benchmark Decontamination)","text":""},{"location":"en/part2/2_2_cleaning_denoising/#chapter-summary","title":"Chapter Summary","text":"<p>Raw data obtained from the internet is like unprocessed ore, where the truly valuable \"concentrate\" may only account for a small proportion. This chapter delves into the three core technologies of pre-training data cleaning: heuristic filtering rules for removing low-quality documents, large-scale deduplication for eliminating duplicate content, and privacy data cleaning for protecting user information. After mastering these techniques, readers will be able to build industrial-grade data cleaning pipelines to transform raw web data into high-quality pre-training corpora.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#scenario-introduction","title":"Scenario Introduction","text":"<p>After the efforts of the previous chapter, your team successfully extracted 50TB of Chinese web text from Common Crawl. However, when you randomly sample and inspect the data, you discover various troubling issues: many pages contain only a few words of navigation text with no substantive content; some pages are full of JavaScript code or CSS style remnants; content from certain websites was crawled repeatedly hundreds of times; and there are large amounts of sensitive information including user emails and phone numbers.</p> <p>Worse yet, the training engineer tells you that the model trained on uncleaned data last time had a serious \"parrot\" problem\u2014the model would repeatedly output the same sentences and could even recite complete content from certain websites. This is clearly caused by data duplication.</p> <p>How to systematically solve these problems? This chapter provides the complete answer.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#41-heuristic-filtering-rules","title":"4.1 Heuristic Filtering Rules","text":"<p>Heuristic filtering is the first line of defense in data cleaning. It uses a set of quantifiable rules to quickly filter out obviously low-quality documents. Although these rules may seem simple, they can filter out most noisy data in practice, making them a highly cost-effective cleaning approach.</p> <p></p> <p>Figure 4-1: Data Cleaning Pipeline Architecture \u2014 Eight-stage processing flow from raw data to clean corpus</p>"},{"location":"en/part2/2_2_cleaning_denoising/#411-language-detection","title":"4.1.1 Language Detection","text":"<p>Language detection is a fundamental step in multilingual data processing. For training Chinese models, we first need to filter Chinese content from Common Crawl's massive data, which requires accurate language detection capability.</p> <p>FastText Language Detector is currently the most commonly used tool. Developed by Facebook AI Research, its pre-trained model supports 176 languages with extremely fast speed and high accuracy. FastText provides two pre-trained models: <code>lid.176.bin</code> is the full version with higher accuracy but larger size (~126MB); <code>lid.176.ftz</code> is the compressed version with smaller size (~917KB) but slightly lower accuracy. For large-scale data processing, the full version is recommended.</p> <pre><code>import fasttext\n\n# Load language detection model\nlang_model = fasttext.load_model('lid.176.bin')\n\ndef detect_language(text: str, min_confidence: float = 0_8) -&gt; tuple:\n    \"\"\"\n    Detect text language\n\n    Args:\n        text: Text to be detected\n        min_confidence: Minimum confidence threshold\n\n    Returns:\n        (language code, confidence) or (None, 0) if confidence insufficient\n    \"\"\"\n    # Preprocessing: remove newlines, take first 1000 characters\n    text = text.replace('\\n', ' ')[:1000]\n\n    # Predict\n    predictions = lang_model.predict(text, k=1)\n    lang = predictions[0][0].replace('__label__', '')\n    confidence = predictions[1][0]\n\n    if confidence &gt;= min_confidence:\n        return lang, confidence\n    return None, confidence\n\ndef filter_by_language(documents: list, target_lang: str = 'zh') -&gt; list:\n    \"\"\"Filter documents by specified language\"\"\"\n    results = []\n    for doc in documents:\n        lang, conf = detect_language(doc['text'])\n        if lang == target_lang:\n            doc['detected_lang'] = lang\n            doc['lang_confidence'] = conf\n            results.append(doc)\n    return results\n</code></pre> <p>Language detection encounters some edge cases in practice. Mixed-language documents (e.g., technical blogs with Chinese and English) may be misclassified. Short text has lower detection accuracy; it is recommended to skip language filtering for text shorter than 50 characters. Code snippets may be identified as various languages and require content type judgment.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#412-text-quality-scoring","title":"4.1.2 Text Quality Scoring","text":"<p>Language detection only ensures that documents are in the target language but cannot judge content quality. A grammatically correct spam ad and a high-quality technical article may receive the same language detection score. This requires a more refined quality assessment mechanism.</p> <p>Perplexity Filtering is a quality assessment method based on language models. Perplexity measures the language model's \"surprise\" at the text\u2014if text is similar to the model's training data distribution, perplexity is low; if text contains much noise, gibberish, or unnatural expressions, perplexity is high.</p> <p>KenLM is the most commonly used tool for computing perplexity. It is based on n-gram language models, extremely fast, and suitable for large-scale data processing.</p> <pre><code>import kenlm\n\nclass PerplexityFilter:\n    def __init__(self, model_path: str, max_perplexity: float = 500):\n        \"\"\"\n        Initialize perplexity filter\n\n        Args:\n            model_path: KenLM model path (.arpa or .bin)\n            max_perplexity: Perplexity threshold; documents exceeding this value will be filtered\n        \"\"\"\n        self.model = kenlm.Model(model_path)\n        self.max_perplexity = max_perplexity\n\n    def compute_perplexity(self, text: str) -&gt; float:\n        \"\"\"Compute text perplexity\"\"\"\n        # KenLM returns log10 probability\n        log_prob = self.model.score(text, bos=True, eos=True)\n        # Convert to perplexity\n        num_words = len(text.split()) + 1  # +1 for EOS\n        perplexity = 10 ** (-log_prob / num_words)\n        return perplexity\n\n    def filter(self, documents: list) -&gt; list:\n        \"\"\"Filter high-perplexity documents\"\"\"\n        results = []\n        for doc in documents:\n            ppl = self.compute_perplexity(doc['text'])\n            if ppl &lt;= self.max_perplexity:\n                doc['perplexity'] = ppl\n                results.append(doc)\n        return results\n</code></pre> <p>Perplexity threshold setting needs to be tuned based on specific data. Generally, high-quality news and encyclopedia text have perplexity between 100-200, ordinary web content between 200-500, and low-quality content (e.g., gibberish, machine translation) typically exceeds 500. It is recommended to analyze perplexity distribution on a small sample first, then determine the appropriate threshold.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#413-heuristic-rule-set","title":"4.1.3 Heuristic Rule Set","text":"<p>Besides language detection and perplexity filtering, there is a set of simple but effective heuristic rules that can quickly remove obviously low-quality content. These rules are designed based on observations and experience from large amounts of data.</p> <p>Length filtering is the most basic rule. Documents that are too short (e.g., navigation text with only a few words) have no training value and should be removed directly. Documents that are too long may need truncation or segmentation. Typical thresholds: minimum length 200 characters or 50 words, maximum length 100,000 characters.</p> <p>Special character ratio can identify noisy content. If the proportion of non-alphanumeric characters in a document is too high, it may be code remnants, gibberish, or format errors. Similarly, an excessively high digit ratio may indicate log files or data tables.</p> <p>Duplicate line ratio can detect templated low-quality pages. If a document has many identical lines (e.g., navigation bars repeated in multiple places), the content quality is low.</p> <p>Vocabulary diversity measures the information richness of a document. A document using only 10 different words is clearly less valuable than one using 500. A common metric is Type-Token Ratio (TTR), the ratio of unique words to total words.</p> <p>Below is a comprehensive heuristic filter implementation:</p> <pre><code>import re\nfrom collections import Counter\n\nclass HeuristicFilter:\n    def __init__(self, config: dict = None):\n        \"\"\"\n        Initialize heuristic filter\n\n        Default config suitable for Chinese pre-training data\n        \"\"\"\n        self.config = config or {\n            'min_length': 200,           # Minimum character count\n            'max_length': 100000,        # Maximum character count\n            'min_words': 50,             # Minimum word count\n            'max_special_ratio': 0_3,    # Maximum special character ratio\n            'max_digit_ratio': 0_3,      # Maximum digit ratio\n            'max_duplicate_line_ratio': 0_3,  # Maximum duplicate line ratio\n            'min_avg_word_length': 2,    # Minimum average word length\n            'max_avg_word_length': 20,   # Maximum average word length\n            'min_unique_word_ratio': 0_1 # Minimum vocabulary diversity\n        }\n\n    def check_length(self, text: str) -&gt; bool:\n        \"\"\"Check document length\"\"\"\n        length = len(text)\n        return self.config['min_length'] &lt;= length &lt;= self.config['max_length']\n\n    def check_special_chars(self, text: str) -&gt; bool:\n        \"\"\"Check special character ratio\"\"\"\n        if len(text) == 0:\n            return False\n        special = len(re.findall(r'[^\\w\\s]', text, re.UNICODE))\n        ratio = special / len(text)\n        return ratio &lt;= self.config['max_special_ratio']\n\n    def check_digit_ratio(self, text: str) -&gt; bool:\n        \"\"\"Check digit ratio\"\"\"\n        if len(text) == 0:\n            return False\n        digits = len(re.findall(r'\\d', text))\n        ratio = digits / len(text)\n        return ratio &lt;= self.config['max_digit_ratio']\n\n    def check_duplicate_lines(self, text: str) -&gt; bool:\n        \"\"\"Check duplicate line ratio\"\"\"\n        lines = [line.strip() for line in text.split('\\n') if line.strip()]\n        if len(lines) == 0:\n            return False\n        unique_lines = len(set(lines))\n        duplicate_ratio = 1 - (unique_lines / len(lines))\n        return duplicate_ratio &lt;= self.config['max_duplicate_line_ratio']\n\n    def check_vocabulary_diversity(self, text: str) -&gt; bool:\n        \"\"\"Check vocabulary diversity\"\"\"\n        words = text.split()\n        if len(words) &lt; self.config['min_words']:\n            return False\n        unique_ratio = len(set(words)) / len(words)\n        return unique_ratio &gt;= self.config['min_unique_word_ratio']\n\n    def filter(self, text: str) -&gt; tuple:\n        \"\"\"\n        Apply all filtering rules\n\n        Returns:\n            (passed or not, failure reason or None)\n        \"\"\"\n        checks = [\n            (self.check_length, 'length'),\n            (self.check_special_chars, 'special_chars'),\n            (self.check_digit_ratio, 'digit_ratio'),\n            (self.check_duplicate_lines, 'duplicate_lines'),\n            (self.check_vocabulary_diversity, 'vocabulary_diversity')\n        ]\n\n        for check_func, name in checks:\n            if not check_func(text):\n                return False, name\n\n        return True, None\n</code></pre>"},{"location":"en/part2/2_2_cleaning_denoising/#414-quality-stratification-strategy","title":"4.1.4 Quality Stratification Strategy","text":"<p>In practice, simply binary classifying data as \"retain\" or \"discard\" is often too crude. A more refined approach is to stratify data by quality, assigning different sampling weights to different quality tiers.</p> <p>A common stratification strategy: divide data into high, medium, and low quality tiers. High-quality data (e.g., from authoritative sites, passing all heuristic checks, low perplexity) receives higher sampling weights; medium-quality data receives normal weights; low-quality but acceptable data receives lower weights. This strategy can ensure data diversity while allowing high-quality data to play a larger role in training.</p> <p>The RefinedWeb paper documents their stratification strategy in detail, dividing data into five tiers with different filtering thresholds for each. This refined quality management is key to building high-quality pre-training datasets.</p> <p></p> <p>Figure 4-2: Data Quality Filtering Funnel \u2014 Layered filtering process from 100% raw data to final 4% clean corpus</p>"},{"location":"en/part2/2_2_cleaning_denoising/#42-large-scale-deduplication-exact-vs-fuzzy-deduplication","title":"4.2 Large-Scale Deduplication: Exact vs Fuzzy Deduplication","text":"<p>Data duplication is the enemy of pre-training data. In Common Crawl, the same article may be reprinted by multiple websites, and the same webpage may be crawled repeatedly in different months, leading to large amounts of duplicate content. Research shows that non-deduplicated data causes models to overfit on repeated content, producing a \"parrot\" phenomenon that seriously affects model quality.</p> <p>Deduplication can be divided into two levels: exact deduplication removes identical documents; fuzzy deduplication removes highly similar but not identical documents (e.g., articles slightly modified when reprinted). On TB-scale data, both types require efficient algorithms and distributed implementation.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#421-exact-deduplication-hash-methods","title":"4.2.1 Exact Deduplication: Hash Methods","text":"<p>The core idea of exact deduplication is to compute a fingerprint for each document; documents with the same fingerprint are considered duplicates. The simplest method uses hash functions like MD5 or SHA256.</p> <pre><code>import hashlib\n\ndef compute_hash(text: str) -&gt; str:\n    \"\"\"Compute SHA256 hash of text\"\"\"\n    return hashlib.sha256(text.encode('utf-8')).hexdigest()\n\ndef exact_dedup(documents: list) -&gt; list:\n    \"\"\"Exact deduplication: keep first document for each hash value\"\"\"\n    seen_hashes = set()\n    results = []\n\n    for doc in documents:\n        doc_hash = compute_hash(doc['text'])\n        if doc_hash not in seen_hashes:\n            seen_hashes.add(doc_hash)\n            doc['hash'] = doc_hash\n            results.append(doc)\n\n    return results\n</code></pre> <p>For distributed scenarios, Spark or Ray can be used for parallel deduplication:</p> <pre><code>import ray\n\n@ray.remote\ndef compute_hashes_batch(documents: list) -&gt; list:\n    \"\"\"Batch compute hashes\"\"\"\n    return [(compute_hash(doc['text']), doc) for doc in documents]\n\ndef distributed_exact_dedup(documents_path: str, output_path: str):\n    \"\"\"Distributed exact deduplication\"\"\"\n    ds = ray.data.read_parquet(documents_path)\n\n    # Compute hashes\n    ds = ds.map(lambda doc: {**doc, 'hash': compute_hash(doc['text'])})\n\n    # Group by hash, keep first per group\n    ds = ds.groupby('hash').map_groups(lambda group: group.head(1))\n\n    # Save results\n    ds.write_parquet(output_path)\n</code></pre> <p>Exact deduplication is efficient but can only handle identical documents. For slightly different duplicate content (e.g., same news reposted on different sites with different headers/footers), exact deduplication is powerless.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#422-fuzzy-deduplication-minhash-lsh","title":"4.2.2 Fuzzy Deduplication: MinHash LSH","text":"<p>The goal of fuzzy deduplication is to identify documents that are \"highly similar but not identical.\" This is a computationally complex problem\u2014naively comparing any two documents requires O(n\u00b2) time complexity, completely infeasible for billions of documents.</p> <p>MinHash LSH (Locality-Sensitive Hashing) is the core algorithm for solving this problem. The basic idea: first convert documents to n-gram sets, then use MinHash to compress sets into fixed-length signatures, finally use LSH to cluster similar signatures into the same buckets. Only document pairs in the same bucket need fine comparison, greatly reducing computation.</p> <p>Understanding MinHash LSH requires three steps:</p> <p>Step 1: n-gram decomposition. Treat a document as a set of n-grams (consecutive n characters or words). For example, the 3-gram set of \"\u5927\u6a21\u578b\u6570\u636e\" is {\"\u5927\u6a21\u578b\", \"\u6a21\u578b\u6570\", \"\u578b\u6570\u636e\"}. Using n-grams rather than entire documents better captures local similarity.</p> <p>Step 2: MinHash signature. MinHash is a technique for compressing sets into fixed-length signatures. Jaccard similarity between two sets can be approximated by the matching degree of their MinHash signatures. Longer signatures give more accurate estimates but higher storage and computation cost.</p> <p>Step 3: LSH bucketing. Divide the MinHash signature into several bands, each containing several hash values. If two documents have identical hash values in all positions of any band, they are placed in the same bucket. Adjusting the number of bands and band size controls the similarity threshold and recall rate.</p> <p>Below is a complete MinHash LSH implementation:</p> <p></p> <p>Figure 4-3: MinHash LSH Algorithm Three Steps \u2014 N-gram decomposition, MinHash signature computation, LSH bucketing, reducing complexity from O(n\u00b2) to O(n)</p> <pre><code>import hashlib\nimport struct\nfrom typing import Set, List, Tuple\nimport numpy as np\n\nclass MinHashLSH:\n    def __init__(self, \n                 num_hashes: int = 128,\n                 num_bands: int = 16,\n                 ngram_size: int = 5,\n                 threshold: float = 0_8):\n        \"\"\"\n        Initialize MinHash LSH\n\n        Args:\n            num_hashes: MinHash signature length\n            num_bands: Number of LSH bands\n            ngram_size: n-gram size\n            threshold: Similarity threshold (reference value, actual threshold determined by band params)\n        \"\"\"\n        self.num_hashes = num_hashes\n        self.num_bands = num_bands\n        self.rows_per_band = num_hashes // num_bands\n        self.ngram_size = ngram_size\n\n        # Generate random parameters for hash functions\n        self.hash_params = [\n            (np.random.randint(1, 2**31), np.random.randint(0, 2**31))\n            for _ in range(num_hashes)\n        ]\n\n        # LSH buckets\n        self.buckets = [{} for _ in range(num_bands)]\n\n    def get_ngrams(self, text: str) -&gt; Set[str]:\n        \"\"\"Extract n-gram set\"\"\"\n        text = text.lower().replace(' ', '')\n        ngrams = set()\n        for i in range(len(text) - self.ngram_size + 1):\n            ngrams.add(text[i:i + self.ngram_size])\n        return ngrams\n\n    def compute_minhash(self, ngrams: Set[str]) -&gt; np.ndarray:\n        \"\"\"Compute MinHash signature\"\"\"\n        signature = np.full(self.num_hashes, np.inf)\n\n        for ngram in ngrams:\n            # Compute base hash value for ngram\n            h = int(hashlib.md5(ngram.encode()).hexdigest(), 16)\n\n            # Use multiple hash functions\n            for i, (a, b) in enumerate(self.hash_params):\n                hash_val = (a * h + b) % (2**31 - 1)\n                if hash_val &lt; signature[i]:\n                    signature[i] = hash_val\n\n        return signature.astype(np.uint32)\n\n    def get_bands(self, signature: np.ndarray) -&gt; List[str]:\n        \"\"\"Split signature into bands\"\"\"\n        bands = []\n        for i in range(self.num_bands):\n            start = i * self.rows_per_band\n            end = start + self.rows_per_band\n            band = signature[start:end]\n            band_hash = hashlib.md5(band.tobytes()).hexdigest()\n            bands.append(band_hash)\n        return bands\n\n    def insert(self, doc_id: str, text: str):\n        \"\"\"Insert document into LSH index\"\"\"\n        ngrams = self.get_ngrams(text)\n        if len(ngrams) == 0:\n            return\n\n        signature = self.compute_minhash(ngrams)\n        bands = self.get_bands(signature)\n\n        for band_idx, band_hash in enumerate(bands):\n            if band_hash not in self.buckets[band_idx]:\n                self.buckets[band_idx][band_hash] = []\n            self.buckets[band_idx][band_hash].append(doc_id)\n\n    def find_candidates(self, text: str) -&gt; Set[str]:\n        \"\"\"Find candidate similar documents\"\"\"\n        ngrams = self.get_ngrams(text)\n        if len(ngrams) == 0:\n            return set()\n\n        signature = self.compute_minhash(ngrams)\n        bands = self.get_bands(signature)\n\n        candidates = set()\n        for band_idx, band_hash in enumerate(bands):\n            if band_hash in self.buckets[band_idx]:\n                candidates.update(self.buckets[band_idx][band_hash])\n\n        return candidates\n\ndef jaccard_similarity(set1: Set, set2: Set) -&gt; float:\n    \"\"\"Compute Jaccard similarity\"\"\"\n    intersection = len(set1 &amp; set2)\n    union = len(set1 | set2)\n    return intersection / union if union &gt; 0 else 0\n</code></pre>"},{"location":"en/part2/2_2_cleaning_denoising/#423-distributed-deduplication-practice","title":"4.2.3 Distributed Deduplication Practice","text":"<p>Running MinHash LSH on TB-scale data requires carefully designed distributed strategies. A typical flow includes:</p> <p>Phase 1: Signature computation. Traverse all documents in parallel, computing MinHash signatures for each. This phase is fully parallelizable and can fully utilize distributed compute resources.</p> <p>Phase 2: Band grouping. Group each document by band value. Documents with the same band value are allocated to the same partition for subsequent comparison.</p> <p>Phase 3: Intra-group deduplication. Within each partition, perform fine similarity computation on candidate duplicate pairs to determine true duplication relationships.</p> <p>Phase 4: Transitive closure. If document A duplicates B and B duplicates C, then A, B, C should all be considered one duplicate group. Need to compute the transitive closure of duplicate relationships.</p> <p>Phase 5: Select retained documents. Within each duplicate group, select one representative (typically the highest quality or longest) to retain, delete the rest.</p> <pre><code>import ray\n\ndef distributed_fuzzy_dedup(input_path: str, output_path: str, \n                            threshold: float = 0_8):\n    \"\"\"\n    Distributed fuzzy deduplication pipeline\n    \"\"\"\n    # Read data\n    ds = ray.data.read_parquet(input_path)\n\n    # Phase 1: Compute MinHash signatures\n    def compute_signature(doc):\n        lsh = MinHashLSH()\n        ngrams = lsh.get_ngrams(doc['text'])\n        signature = lsh.compute_minhash(ngrams)\n        bands = lsh.get_bands(signature)\n        return {**doc, 'signature': signature.tolist(), 'bands': bands}\n\n    ds = ds.map(compute_signature)\n\n    # Phase 2: Group by band value, find candidate pairs\n    # (Simplified here, actual implementation needs more complex grouping logic)\n\n    # Phase 3&amp;4: Intra-group exact comparison, build duplicate relationship graph\n    # ...\n\n    # Phase 5: Select retained documents\n    # ...\n\n    # Save results\n    ds.write_parquet(output_path)\n</code></pre> <p>In actual engineering, using existing tools is recommended. text-dedup is an open-source text deduplication library implementing various algorithms including MinHash LSH, SimHash, Suffix Array, with Spark and Ray distributed implementations. Dolma's deduplication module is also a high-quality reference implementation.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#424-intra-document-deduplication","title":"4.2.4 Intra-Document Deduplication","text":"<p>Besides document-level deduplication, intra-document duplicate content also needs handling. Common cases include: navigation bars, headers, and footers that appear repeatedly across a webpage; content duplication due to JavaScript rendering issues; templated duplicate paragraphs generated by certain CMS systems.</p> <p>Intra-document deduplication strategy is relatively simple: divide documents into paragraphs or fixed-length chunks, compute hash for each chunk, remove duplicate chunks.</p> <pre><code>def remove_duplicate_paragraphs(text: str, min_length: int = 50) -&gt; str:\n    \"\"\"Remove duplicate paragraphs within document\"\"\"\n    paragraphs = text.split('\\n\\n')\n    seen_hashes = set()\n    unique_paragraphs = []\n\n    for para in paragraphs:\n        para = para.strip()\n        if len(para) &lt; min_length:\n            unique_paragraphs.append(para)\n            continue\n\n        para_hash = hashlib.md5(para.encode()).hexdigest()\n        if para_hash not in seen_hashes:\n            seen_hashes.add(para_hash)\n            unique_paragraphs.append(para)\n\n    return '\\n\\n'.join(unique_paragraphs)\n\ndef remove_duplicate_ngrams(text: str, n: int = 10, threshold: int = 3) -&gt; str:\n    \"\"\"Remove high-frequency duplicate n-grams within document\"\"\"\n    words = text.split()\n    ngram_counts = Counter()\n\n    # Compute n-gram frequencies\n    for i in range(len(words) - n + 1):\n        ngram = tuple(words[i:i + n])\n        ngram_counts[ngram] += 1\n\n    # Mark positions to remove\n    remove_positions = set()\n    for i in range(len(words) - n + 1):\n        ngram = tuple(words[i:i + n])\n        if ngram_counts[ngram] &gt;= threshold:\n            # Keep first occurrence, remove subsequent duplicates\n            for j in range(i + n, len(words) - n + 1):\n                if tuple(words[j:j + n]) == ngram:\n                    for k in range(j, min(j + n, len(words))):\n                        remove_positions.add(k)\n\n    # Rebuild text\n    result_words = [w for i, w in enumerate(words) if i not in remove_positions]\n    return ' '.join(result_words)\n</code></pre>"},{"location":"en/part2/2_2_cleaning_denoising/#43-privacy-data-cleaning-pii-removal","title":"4.3 Privacy Data Cleaning (PII Removal)","text":"<p>Pre-training data inevitably contains Personally Identifiable Information (PII), such as email addresses, phone numbers, ID numbers, bank card numbers, home addresses, etc. With increasingly strict data compliance requirements today (e.g., GDPR, CCPA, Personal Information Protection Law), cleaning PII is not only a moral responsibility but also a legal obligation.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#431-types-and-risks-of-pii","title":"4.3.1 Types and Risks of PII","text":"<p>PII can be divided into direct identifiers and quasi-identifiers. Direct identifiers can identify individuals alone, such as names, ID numbers, social security numbers, phone numbers, and email addresses. Quasi-identifiers alone have difficulty identifying individuals but may lead to identification when combined, such as birth dates, postal codes, occupation, and employer.</p> <p>Retaining PII in pre-training data carries multiple risks. First is privacy leakage risk: models may \"memorize\" sensitive information in training data and be maliciously extracted during inference. Second is compliance risk: violating data protection regulations may result in huge fines. Finally is reputation risk: if a model outputs others' private information, it will seriously damage the company's image.</p> <p></p> <p>Figure 4-4: PII Types and Risk Levels \u2014 Classification of direct identifiers (high risk) vs. quasi-identifiers (medium risk)</p>"},{"location":"en/part2/2_2_cleaning_denoising/#432-microsoft-presidio","title":"4.3.2 Microsoft Presidio","text":"<p>Presidio is Microsoft's open-source PII detection and anonymization toolkit, supporting multiple languages and PII types. It uses a modular design with two core components: Analyzer is responsible for identifying PII entities in text, Anonymizer is responsible for processing identified PII (e.g., replacement, masking, deletion).</p> <pre><code>from presidio_analyzer import AnalyzerEngine\nfrom presidio_anonymizer import AnonymizerEngine\nfrom presidio_anonymizer.entities import OperatorConfig\n\n# Initialize engines\nanalyzer = AnalyzerEngine()\nanonymizer = AnonymizerEngine()\n\ndef analyze_pii(text: str, language: str = 'en') -&gt; list:\n    \"\"\"\n    Identify PII in text\n\n    Returns:\n        List of PII entities with type, position, and confidence\n    \"\"\"\n    results = analyzer.analyze(\n        text=text,\n        language=language,\n        entities=[\n            'EMAIL_ADDRESS', 'PHONE_NUMBER', 'CREDIT_CARD',\n            'IP_ADDRESS', 'PERSON', 'LOCATION', 'DATE_TIME'\n        ]\n    )\n    return results\n\ndef anonymize_pii(text: str, language: str = 'en') -&gt; str:\n    \"\"\"\n    Anonymize PII in text\n\n    Replace identified PII with placeholders\n    \"\"\"\n    # First identify\n    analyzer_results = analyzer.analyze(text=text, language=language)\n\n    # Define anonymization strategy\n    operators = {\n        'EMAIL_ADDRESS': OperatorConfig('replace', {'new_value': '&lt;EMAIL&gt;'}),\n        'PHONE_NUMBER': OperatorConfig('replace', {'new_value': '&lt;PHONE&gt;'}),\n        'CREDIT_CARD': OperatorConfig('replace', {'new_value': '&lt;CREDIT_CARD&gt;'}),\n        'IP_ADDRESS': OperatorConfig('replace', {'new_value': '&lt;IP&gt;'}),\n        'PERSON': OperatorConfig('replace', {'new_value': '&lt;PERSON&gt;'}),\n        'LOCATION': OperatorConfig('replace', {'new_value': '&lt;LOCATION&gt;'}),\n        'DATE_TIME': OperatorConfig('keep', {})  # Dates/times can usually be kept\n    }\n\n    # Anonymize\n    anonymized = anonymizer.anonymize(\n        text=text,\n        analyzer_results=analyzer_results,\n        operators=operators\n    )\n\n    return anonymized.text\n</code></pre>"},{"location":"en/part2/2_2_cleaning_denoising/#433-chinese-pii-handling","title":"4.3.3 Chinese PII Handling","text":"<p>Presidio has relatively limited support for Chinese. For Chinese pre-training data, it is usually necessary to supplement rule-based matching with regular expressions.</p> <pre><code>import re\n\nclass ChinesePIIFilter:\n    \"\"\"Chinese PII filter\"\"\"\n\n    patterns = {\n        'phone': [\n            r'1[3-9]\\d{9}',  # Mobile number\n            r'0\\d{2,3}-?\\d{7,8}',  # Landline\n        ],\n        'id_card': [\n            r'\\d{17}[\\dXx]',  # 18-digit ID\n            r'\\d{15}',  # 15-digit ID\n        ],\n        'email': [\n            r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}',\n        ],\n        'bank_card': [\n            r'\\d{16,19}',  # Bank card number (needs context judgment)\n        ],\n        'ip_address': [\n            r'\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}',\n        ],\n        'qq': [\n            r'[Qq][Qq][:\uff1a]?\\s*\\d{5,11}',\n            r'[Qq][:\uff1a]?\\s*\\d{5,11}',\n        ],\n        'wechat': [\n            r'[Vv][Xx][:\uff1a]?\\s*[a-zA-Z0-9_-]{6,20}',\n            r'\u5fae\u4fe1[:\uff1a]?\\s*[a-zA-Z0-9_-]{6,20}',\n        ],\n    }\n\n    def __init__(self):\n        self.compiled_patterns = {}\n        for pii_type, patterns in self.patterns.items():\n            self.compiled_patterns[pii_type] = [\n                re.compile(p) for p in patterns\n            ]\n\n    def find_pii(self, text: str) -&gt; list:\n        \"\"\"Find all PII\"\"\"\n        findings = []\n        for pii_type, patterns in self.compiled_patterns.items():\n            for pattern in patterns:\n                for match in pattern.finditer(text):\n                    findings.append({\n                        'type': pii_type,\n                        'value': match.group(),\n                        'start': match.start(),\n                        'end': match.end()\n                    })\n        return findings\n\n    def anonymize(self, text: str) -&gt; str:\n        \"\"\"Anonymize PII\"\"\"\n        findings = self.find_pii(text)\n\n        # Process in reverse order by position to avoid affecting subsequent positions\n        findings.sort(key=lambda x: x['start'], reverse=True)\n\n        for finding in findings:\n            placeholder = f\"&lt;{finding['type'].upper()}&gt;\"\n            text = text[:finding['start']] + placeholder + text[finding['end']:]\n\n        return text\n</code></pre>"},{"location":"en/part2/2_2_cleaning_denoising/#434-pii-processing-strategy-trade-offs","title":"4.3.4 PII Processing Strategy Trade-offs","text":"<p>PII processing faces trade-offs between accuracy and recall. Overly aggressive filtering may incorrectly remove normal content (e.g., misidentifying ordinary number sequences as phone numbers), while overly conservative filtering may miss true sensitive information.</p> <p>In practice, a stratified strategy is recommended. For high-risk PII (e.g., ID numbers, bank card numbers), use stricter matching rules\u2014better to over-filter than miss. For medium-risk PII (e.g., phone numbers, emails), use moderate thresholds to balance accuracy and recall. For low-risk information (e.g., dates, locations), decide whether to process based on specific scenarios.</p> <p>Another important decision is the replacement strategy. Common choices include: complete deletion, simple but may disrupt sentence fluency; fixed placeholder replacement (e.g., <code>&lt;EMAIL&gt;</code>), preserves semantic information but may introduce unnatural patterns; random generation replacement (e.g., replace real email with random email), closest to original distribution but complex to implement. Most pre-training datasets use placeholder replacement as a balance between accuracy and complexity.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#44-benchmark-decontamination","title":"4.4 Benchmark Decontamination","text":"<p>When evaluating the true capabilities of large models, a key question is: did the model truly \"learn\" to solve problems, or did it merely \"memorize\" the test questions? If training data contains original questions from benchmarks like GSM8K, MMLU, or HumanEval, high scores on these tests are meaningless.</p> <p>This is the \"Benchmark Contamination\" problem. As the scale of LLM training data explodes, benchmark test content is repeatedly reposted, discussed, and analyzed on the internet, easily mixing into web-crawled training corpora. This is a critical engineering step for evaluating a model's true capabilities.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#441-types-and-risks-of-contamination","title":"4.4.1 Types and Risks of Contamination","text":"<p>Benchmark contamination can be categorized into two types:</p> <p>Direct contamination: Training data contains original questions or slight variants from benchmark test sets. For example, GSM8K math problems reposted on educational websites, or MMLU multiple-choice questions appearing on an online quiz platform.</p> <p>Indirect contamination: Training data contains detailed explanations and answers to benchmark test questions. While not the original questions themselves, models may \"indirectly memorize\" answers through these explanations.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#442-decontamination-detection-methods","title":"4.4.2 Decontamination Detection Methods","text":"<p>The core approach to decontamination is: match training data against known benchmark test sets and remove matched content.</p> <p>N-gram overlap detection is the most commonly used method. Compute the n-gram overlap ratio between training documents and benchmark test samples; when overlap exceeds a threshold, mark the document as contaminated. GPT-3, LLaMA, and other models' training all adopted this method.</p> <pre><code>from collections import Counter\nfrom typing import Set, List\n\nclass BenchmarkDecontaminator:\n    \"\"\"Benchmark test set decontaminator\"\"\"\n\n    def __init__(self, ngram_size: int = 13, threshold: float = 0.8):\n        \"\"\"\n        Args:\n            ngram_size: n-gram size, GPT-3 uses 13-gram\n            threshold: Overlap ratio threshold, above this is considered contamination\n        \"\"\"\n        self.ngram_size = ngram_size\n        self.threshold = threshold\n        self.benchmark_ngrams: Set[tuple] = set()\n\n    def load_benchmarks(self, benchmark_datasets: dict):\n        \"\"\"\n        Load benchmark test sets\n\n        Args:\n            benchmark_datasets: {\"name\": [sample text list]}\n        \"\"\"\n        for name, samples in benchmark_datasets.items():\n            for sample in samples:\n                ngrams = self._extract_ngrams(sample)\n                self.benchmark_ngrams.update(ngrams)\n\n        print(f\"Loaded {len(self.benchmark_ngrams)} unique {self.ngram_size}-grams\")\n\n    def _extract_ngrams(self, text: str) -&gt; Set[tuple]:\n        \"\"\"Extract n-gram set from text\"\"\"\n        text = ' '.join(text.lower().split())\n        words = text.split()\n\n        ngrams = set()\n        for i in range(len(words) - self.ngram_size + 1):\n            ngram = tuple(words[i:i + self.ngram_size])\n            ngrams.add(ngram)\n\n        return ngrams\n\n    def check_contamination(self, document: str) -&gt; dict:\n        \"\"\"\n        Check if a single document is contaminated\n\n        Returns:\n            {\n                'is_contaminated': bool,\n                'overlap_ratio': float,\n                'matched_ngrams': int\n            }\n        \"\"\"\n        doc_ngrams = self._extract_ngrams(document)\n\n        if len(doc_ngrams) == 0:\n            return {'is_contaminated': False, 'overlap_ratio': 0.0, 'matched_ngrams': 0}\n\n        matched = doc_ngrams &amp; self.benchmark_ngrams\n        overlap_ratio = len(matched) / len(doc_ngrams)\n\n        return {\n            'is_contaminated': overlap_ratio &gt; self.threshold,\n            'overlap_ratio': overlap_ratio,\n            'matched_ngrams': len(matched)\n        }\n\n    def decontaminate(self, documents: list) -&gt; list:\n        \"\"\"Batch decontamination filtering\"\"\"\n        clean_docs = []\n        contaminated_count = 0\n\n        for doc in documents:\n            result = self.check_contamination(doc['text'])\n            if not result['is_contaminated']:\n                clean_docs.append(doc)\n            else:\n                contaminated_count += 1\n\n        print(f\"Removed {contaminated_count} contaminated documents \"\n              f\"({contaminated_count/len(documents)*100:.2f}%)\")\n        return clean_docs\n\n# Usage example\ndecontaminator = BenchmarkDecontaminator(ngram_size=13, threshold=0.8)\n\n# Load common benchmark test sets\nbenchmarks = {\n    'gsm8k': [\"Janet's ducks lay 16 eggs per day...\", ...],\n    'mmlu': [\"What is the capital of France? A) London B) Paris...\", ...],\n    'humaneval': [\"def has_close_elements(numbers: List[float]...\", ...],\n}\ndecontaminator.load_benchmarks(benchmarks)\n\n# Decontaminate training data\nclean_data = decontaminator.decontaminate(training_documents)\n</code></pre>"},{"location":"en/part2/2_2_cleaning_denoising/#443-engineering-best-practices","title":"4.4.3 Engineering Best Practices","text":"<ol> <li>Maintain a benchmark library: Maintain a library containing all common benchmark test sets, including GSM8K, MMLU, HumanEval, MBPP, HellaSwag, ARC, WinoGrande, etc. Every time new data is processed, it must be checked against this library.</li> <li>Multi-granularity detection: Besides n-gram overlap, also use MinHash LSH from the previous section for fuzzy matching to catch rewritten test questions.</li> <li>Regular updates: New benchmark test sets keep emerging; the decontamination library needs regular updates.</li> <li>Documentation and reporting: Clearly disclose decontamination methods and results in model technical reports \u2014 this is a basic requirement for responsible AI research (see LLaMA 3 and DeepSeek technical reports).</li> </ol>"},{"location":"en/part2/2_2_cleaning_denoising/#45-model-based-quality-scoring","title":"4.5 Model-based Quality Scoring","text":"<p>In Section 4.1, we introduced heuristic rule-based quality filtering. These rules are fast and effective but cannot capture deeper quality differences. For example, an advertising article that passes all heuristic checks and a high-quality technical article that also passes may receive the same score under heuristic rules.</p> <p>Model-based quality scoring uses lightweight machine learning models for more refined quality assessment. This approach was widely adopted in LLaMA 2 training \u2014 Meta's team used a fastText classifier to identify \"textbook-quality\" web pages, significantly improving the overall quality of pre-training data.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#451-fasttext-quality-classifier","title":"4.5.1 fastText Quality Classifier","text":"<p>fastText is the most commonly used quality scoring tool because it has extremely fast inference speed and can run efficiently on TB-scale data. The core approach is:</p> <ol> <li>Build training set: Sample positive examples from high-quality sources (e.g., Wikipedia, academic journals, curated websites), and negative examples from low-quality sources (spam pages, ad pages).</li> <li>Train classifier: Train a binary classification model using fastText.</li> <li>Batch scoring: Score all data to be processed, then filter or stratified-sample based on scores.</li> </ol> <pre><code>import fasttext\nimport random\n\ndef build_quality_training_data(\n    high_quality_texts: list,\n    low_quality_texts: list,\n    output_path: str\n):\n    \"\"\"\n    Build fastText quality classification training data\n\n    Args:\n        high_quality_texts: High-quality text list (e.g., Wikipedia articles)\n        low_quality_texts: Low-quality text list (e.g., spam pages)\n        output_path: Output file path\n    \"\"\"\n    with open(output_path, 'w') as f:\n        for text in high_quality_texts:\n            clean_text = ' '.join(text.split()[:500])  # Take first 500 words\n            f.write(f\"__label__hq {clean_text}\\n\")\n\n        for text in low_quality_texts:\n            clean_text = ' '.join(text.split()[:500])\n            f.write(f\"__label__lq {clean_text}\\n\")\n\ndef train_quality_classifier(training_data_path: str, model_path: str):\n    \"\"\"Train quality classifier\"\"\"\n    model = fasttext.train_supervised(\n        input=training_data_path,\n        lr=0.1,\n        epoch=25,\n        wordNgrams=2,\n        dim=100,\n        loss='softmax'\n    )\n    model.save_model(model_path)\n    return model\n\nclass ModelBasedQualityScorer:\n    \"\"\"Model-based quality scorer\"\"\"\n\n    def __init__(self, model_path: str):\n        self.model = fasttext.load_model(model_path)\n\n    def score(self, text: str) -&gt; float:\n        \"\"\"\n        Score text quality\n\n        Returns:\n            Quality score between 0-1, higher is better\n        \"\"\"\n        text = ' '.join(text.split()[:500])\n        labels, probs = self.model.predict(text, k=2)\n\n        for label, prob in zip(labels, probs):\n            if label == '__label__hq':\n                return prob\n        return 0.0\n\n    def filter_by_quality(self, documents: list, \n                         min_score: float = 0.5) -&gt; list:\n        \"\"\"Filter documents by quality score\"\"\"\n        filtered = []\n        for doc in documents:\n            score = self.score(doc['text'])\n            if score &gt;= min_score:\n                doc['quality_score'] = score\n                filtered.append(doc)\n        return filtered\n</code></pre>"},{"location":"en/part2/2_2_cleaning_denoising/#452-bert-based-fine-grained-quality-assessment","title":"4.5.2 BERT-based Fine-grained Quality Assessment","text":"<p>For higher-precision quality assessment needs, BERT or its variants can be used for classification. This approach is more accurate than fastText but slower for inference, suitable for fine-grained classification of borderline samples after fastText coarse filtering.</p> <pre><code>from transformers import AutoTokenizer, AutoModelForSequenceClassification\nimport torch\n\nclass BERTQualityScorer:\n    \"\"\"BERT-based fine-grained quality scorer\"\"\"\n\n    def __init__(self, model_name: str = 'bert-base-chinese'):\n        self.tokenizer = AutoTokenizer.from_pretrained(model_name)\n        self.model = AutoModelForSequenceClassification.from_pretrained(\n            model_name, num_labels=2\n        )\n        self.model.eval()\n\n    def score_batch(self, texts: list) -&gt; list:\n        \"\"\"Batch scoring\"\"\"\n        encodings = self.tokenizer(\n            texts, \n            padding=True, \n            truncation=True, \n            max_length=512, \n            return_tensors='pt'\n        )\n\n        with torch.no_grad():\n            outputs = self.model(**encodings)\n            probs = torch.softmax(outputs.logits, dim=-1)\n            quality_scores = probs[:, 1].tolist()  # High-quality class probability\n\n        return quality_scores\n</code></pre>"},{"location":"en/part2/2_2_cleaning_denoising/#453-hierarchical-application-of-quality-scoring","title":"4.5.3 Hierarchical Application of Quality Scoring","text":"<p>In practice, a \"coarse screening + fine screening\" two-stage strategy is recommended:</p> <ol> <li>Stage one: Use fastText for rapid scoring of all data, removing obviously low-quality content (e.g., score &lt; 0.3).</li> <li>Stage two: For borderline samples (e.g., scores between 0.3-0.7), use BERT for fine-grained classification.</li> <li>Quality stratification: Divide data into high, medium, and low tiers based on final scores, assigning different sampling weights during training.</li> </ol> <p>This stratification strategy was adopted by Meta in LLaMA 2 training \u2014 by increasing sampling weights for high-quality data, model performance on various benchmarks was significantly improved.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#46-complete-cleaning-pipeline","title":"4.6 Complete Cleaning Pipeline","text":"<p>Connect the components introduced above to build a complete data cleaning pipeline.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#461-pipeline-architecture","title":"4.6.1 Pipeline Architecture","text":"<p>An industrial-grade cleaning pipeline typically includes the following stages, executed in order:</p> <p>Phase 1: Format standardization. Convert data from various sources to unified format, handle encoding issues, extract necessary metadata.</p> <p>Phase 2: Language filtering. Use FastText for language detection, retain documents in target language. For mixed-language documents, classify by primary language.</p> <p>Phase 3: Heuristic filtering. Apply heuristic rules for length, special characters, duplicate lines, etc., to quickly filter obviously low-quality content.</p> <p>Phase 4: Intra-document deduplication. Remove duplicate paragraphs and n-grams within documents.</p> <p>Phase 5: PII cleaning. Identify and anonymize sensitive personal information.</p> <p>Phase 7: Benchmark decontamination. Use N-gram overlap detection to remove documents highly overlapping with benchmark test sets.</p> <p>Phase 8: Quality scoring. Use fastText/BERT quality classifiers for refined quality scoring of data.</p> <p>Phase 9: Perplexity scoring. Compute quality metrics like perplexity to provide basis for subsequent quality stratification.</p> <p>Phase 10: Inter-document deduplication. Use MinHash LSH for large-scale fuzzy deduplication to remove highly similar documents.</p> <p>Phase 11: Quality stratification and sampling. Stratify data by quality score, determine sampling weights for each tier.</p> <pre><code>import ray\nfrom dataclasses import dataclass\nfrom typing import Optional\n\n@dataclass\nclass CleaningConfig:\n    \"\"\"Cleaning configuration\"\"\"\n    target_language: str = 'zh'\n    min_length: int = 200\n    max_length: int = 100000\n    max_perplexity: float = 500\n    dedup_threshold: float = 0_8\n    anonymize_pii: bool = True\n\nclass DataCleaningPipeline:\n    def __init__(self, config: CleaningConfig):\n        self.config = config\n        self.lang_filter = LanguageFilter(config.target_language)\n        self.heuristic_filter = HeuristicFilter()\n        self.perplexity_filter = PerplexityFilter(max_ppl=config.max_perplexity)\n        self.pii_filter = ChinesePIIFilter() if config.target_language == 'zh' else None\n        self.deduplicator = MinHashLSH(threshold=config.dedup_threshold)\n\n    def process_document(self, doc: dict) -&gt; Optional[dict]:\n        \"\"\"Process single document\"\"\"\n        text = doc.get('text', '')\n\n        # Phase 2: Language filtering\n        lang, conf = self.lang_filter.detect(text)\n        if lang != self.config.target_language:\n            return None\n\n        # Phase 3: Heuristic filtering\n        passed, reason = self.heuristic_filter.filter(text)\n        if not passed:\n            return None\n\n        # Phase 4: Intra-document deduplication\n        text = remove_duplicate_paragraphs(text)\n\n        # Phase 5: PII cleaning\n        if self.config.anonymize_pii and self.pii_filter:\n            text = self.pii_filter.anonymize(text)\n\n        # Phase 6: Quality scoring\n        perplexity = self.perplexity_filter.compute_perplexity(text)\n        if perplexity &gt; self.config.max_perplexity:\n            return None\n\n        return {\n            **doc,\n            'text': text,\n            'language': lang,\n            'lang_confidence': conf,\n            'perplexity': perplexity\n        }\n\n    def run(self, input_path: str, output_path: str):\n        \"\"\"Run complete pipeline\"\"\"\n        # Read data\n        ds = ray.data.read_parquet(input_path)\n\n        # Phases 1-6: Single document processing\n        ds = ds.map(self.process_document)\n        ds = ds.filter(lambda x: x is not None)\n\n        # Phase 7: Inter-document deduplication\n        ds = self.deduplicator.deduplicate(ds)\n\n        # Save results\n        ds.write_parquet(output_path)\n</code></pre>"},{"location":"en/part2/2_2_cleaning_denoising/#462-quality-monitoring-and-iteration","title":"4.6.2 Quality Monitoring and Iteration","text":"<p>The cleaning pipeline is not a one-time task but a process requiring continuous monitoring and iterative optimization. The following monitoring mechanisms are recommended:</p> <p>Filter rate monitoring: Statistics filter rate for each stage. If a stage suddenly filters out a large amount of data, it may indicate improper threshold settings or changed data distribution.</p> <p>Sample inspection: Regular manual inspection of cleaning results to evaluate accuracy of filtering rules. Both incorrectly deleted good samples and missed bad samples need attention.</p> <p>Downstream feedback: Model evaluation results after training are the final quality validation. If model performance is poor, need to trace back and analyze whether data has issues.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#47-chapter-summary","title":"4.7 Chapter Summary","text":"<p>This chapter systematically introduced the core technologies of pre-training data cleaning and quality control.</p> <p>In heuristic filtering: language detection uses FastText to quickly filter target language documents; perplexity filtering uses KenLM to evaluate text quality; the heuristic rule set covers multiple dimensions including length, special characters, duplicate lines, and vocabulary diversity. Quality stratification strategy divides data into different tiers, providing basis for subsequent sampling.</p> <p>In large-scale deduplication: we clearly distinguished exact and fuzzy deduplication as two technical approaches. Exact deduplication uses hash methods to quickly remove identical documents; fuzzy deduplication uses the MinHash LSH algorithm to identify highly similar content. Distributed implementation is necessary for TB-scale data. Intra-document deduplication handles paragraph and n-gram level duplicates.</p> <p>In privacy cleaning: PII detection can use Presidio or custom regex rules; anonymization strategy requires trade-offs between accuracy and information retention. Chinese PII handling requires specially designed rule sets.</p> <p>In benchmark decontamination: this is a critical engineering step for ensuring evaluation validity. Through N-gram overlap detection and fuzzy matching, training data content containing benchmark test sets (GSM8K, MMLU, HumanEval, etc.) is removed, preventing models from \"memorizing answers\" rather than truly learning.</p> <p>In quality scoring: model-based quality assessment (fastText/BERT) complements heuristic rules by more precisely distinguishing \"textbook-quality\" content from ordinary web pages. The hierarchical strategy (coarse screening + fine screening) is the best engineering practice for balancing efficiency and precision.</p> <p>The complete cleaning pipeline connects each component, executing in the order of format standardization, language filtering, heuristic filtering, intra-document deduplication, PII cleaning, benchmark decontamination, quality scoring, perplexity scoring, inter-document deduplication, and quality stratification. Continuous quality monitoring and iterative optimization are key to ensuring data quality.</p> <p></p> <p>Figure 4-5: Chapter 4 Knowledge Structure \u2014 Three core themes: Heuristic Filtering, Large-Scale Deduplication, PII Cleaning</p>"},{"location":"en/part2/2_2_cleaning_denoising/#further-reading","title":"Further Reading","text":"<p>For in-depth content on data cleaning, the following resources are worth referencing:</p> <p>The RefinedWeb paper documents the complete cleaning flow for building high-quality pre-training sets from Common Crawl. The Dolma dataset technical report introduces Allen AI's cleaning strategy and tools. The text-dedup open-source library (github.com/ChenghaoMou/text-dedup) provides implementations of various deduplication algorithms. Microsoft Presidio documentation (microsoft.github.io/presidio) is the authoritative reference for PII processing. The CCNet paper introduces Facebook's method for processing Common Crawl data, especially details on perplexity filtering.</p>"},{"location":"en/part2/2_2_cleaning_denoising/#next-chapter-preview","title":"Next Chapter Preview","text":"<p>In the next chapter \"Tokenization and Serialization,\" we will explore the final critical step in pre-training data preparation: how to convert cleaned text into token sequences that models can understand. You will learn the principles and selection of tokenization algorithms like BPE, WordPiece, and Unigram; how to expand vocabularies for specific domains; and data mixing and curriculum learning sampling strategies.</p> <p>Consider this question as you enter the next chapter: If you are training a model specialized for code, what problems would the standard GPT-2 tokenizer encounter?</p>"},{"location":"en/part2/2_3_tokenization_serialization/","title":"Chapter 5: Tokenization & Serialization","text":""},{"location":"en/part2/2_3_tokenization_serialization/#chapter-5-tokenization-serialization-and-efficient-loading-dataloader-optimization","title":"Chapter 5: Tokenization, Serialization, and Efficient Loading (DataLoader Optimization)","text":""},{"location":"en/part2/2_3_tokenization_serialization/#chapter-summary","title":"Chapter Summary","text":"<p>Tokenization is the bridge connecting raw text and neural networks. High-quality corpora after cleaning need to be converted into numeric sequences that models can understand before they can be fed into Transformers for training. This chapter delves into how tokenizers work, including the three mainstream algorithms BPE, WordPiece, and Unigram; introduces how to build and extend vocabularies for specific domains; and finally discusses data mixing and curriculum learning strategies, which determine the presentation order and proportions of different data types during training.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#scenario-introduction","title":"Scenario Introduction","text":"<p>Your team is training a large model specialized for code. After preliminary experiments with the standard GPT-2 tokenizer, you discover a strange phenomenon: the model often makes errors at indentation in generated code, splitting four spaces into multiple different tokens, causing inconsistent indentation. Worse yet, some common programming keywords like <code>def</code> and <code>return</code> are split into multiple subwords, requiring the model to use additional context to understand their meaning.</p> <p>After analysis, you find the problem lies in the tokenizer. The GPT-2 tokenizer was trained on web text and does not handle the special structure of code (such as whitespace, camelCase, special symbols) well. Designing a specialized tokenizer for code tasks has become a key step to improving model performance.</p> <p>This example shows: the tokenizer is by no means a \"preprocessing detail\" that can be ignored\u2014it has a substantial impact on model capabilities.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#51-tokenizer-principles","title":"5.1 Tokenizer Principles","text":"<p>The core task of a tokenizer is to segment continuous text strings into discrete token sequences and map each token to an integer ID. This seemingly simple task actually involves complex algorithm design and engineering trade-offs.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#511-why-subword-tokenization","title":"5.1.1 Why Subword Tokenization?","text":"<p>In the early days of deep learning, natural language processing typically used word-level or character-level tokenization. Word-level tokenization treats each complete word as a token\u2014the advantage is clear semantics, the disadvantage is a huge vocabulary (needing to cover all possible words) and inability to handle out-of-vocabulary (OOV) words. Character-level tokenization treats each character as a token\u2014the advantage is a tiny vocabulary with no OOV problem, the disadvantage is excessively long sequences making it difficult for models to capture long-range dependencies.</p> <p>Subword tokenization is a compromise. It segments text into units smaller than words but larger than characters. High-frequency words remain intact; low-frequency words are split into smaller subword units. For example, \"unhappiness\" might be split into \"un\" + \"happi\" + \"ness\". This approach both controls vocabulary size and retains certain semantic information, while being able to handle unseen vocabulary through subword combination.</p> <p></p> <p>Figure 5-1: Tokenization Granularity Comparison \u2014 Trade-offs between word-level, character-level, and subword-level</p> <p>Currently, almost all mainstream large language models use subword tokenization. The GPT series uses BPE, BERT uses WordPiece, and T5 and LLaMA use SentencePiece (supporting BPE and Unigram). Understanding the principles of these algorithms is the foundation for tokenizer customization and optimization.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#512-bpe-byte-pair-encoding","title":"5.1.2 BPE: Byte Pair Encoding","text":"<p>BPE (Byte Pair Encoding) was originally a data compression algorithm, later introduced to neural machine translation by Sennrich et al. in 2015, becoming the most widely used subword tokenization algorithm.</p> <p>The core idea of BPE is very intuitive: start from the character level, repeatedly merge the most frequently occurring adjacent token pairs until reaching the target vocabulary size. Specific steps:</p> <ol> <li>Split all training text into character sequences, each character as initial token</li> <li>Count frequency of all adjacent token pairs</li> <li>Merge the highest-frequency token pair into a new token</li> <li>Repeat steps 2-3 until vocabulary reaches target size</li> </ol> <p>Below is a simplified BPE training implementation:</p> <pre><code>from collections import Counter, defaultdict\n\ndef train_bpe(corpus: list, vocab_size: int) -&gt; dict:\n    \"\"\"\n    Train BPE tokenizer\n\n    Args:\n        corpus: Training corpus list\n        vocab_size: Target vocabulary size\n\n    Returns:\n        Merge rules dictionary\n    \"\"\"\n    # Initialize: split each word into characters, add end-of-word marker\n    word_freqs = Counter()\n    for text in corpus:\n        for word in text.split():\n            # Add end-of-word marker &lt;/w&gt; to distinguish same character in middle vs end of word\n            word_freqs[' '.join(list(word)) + ' &lt;/w&gt;'] += 1\n\n    merges = {}\n    vocab = set()\n\n    # Initial vocabulary is all characters\n    for word in word_freqs:\n        for char in word.split():\n            vocab.add(char)\n\n    while len(vocab) &lt; vocab_size:\n        # Count adjacent token pair frequencies\n        pair_freqs = defaultdict(int)\n        for word, freq in word_freqs.items():\n            tokens = word.split()\n            for i in range(len(tokens) - 1):\n                pair = (tokens[i], tokens[i + 1])\n                pair_freqs[pair] += freq\n\n        if not pair_freqs:\n            break\n\n        # Find highest-frequency pair\n        best_pair = max(pair_freqs, key=pair_freqs.get)\n\n        # Merge this pair\n        new_token = best_pair[0] + best_pair[1]\n        merges[best_pair] = new_token\n        vocab.add(new_token)\n\n        # Update word frequency table\n        new_word_freqs = {}\n        for word, freq in word_freqs.items():\n            new_word = word.replace(\n                best_pair[0] + ' ' + best_pair[1], \n                new_token\n            )\n            new_word_freqs[new_word] = freq\n        word_freqs = new_word_freqs\n\n    return merges\n\ndef apply_bpe(text: str, merges: dict) -&gt; list:\n    \"\"\"Apply BPE tokenization\"\"\"\n    tokens = list(text) + ['&lt;/w&gt;']\n\n    while True:\n        # Find mergeable pairs\n        pairs = [(tokens[i], tokens[i+1]) for i in range(len(tokens)-1)]\n        merge_pair = None\n        for pair in pairs:\n            if pair in merges:\n                merge_pair = pair\n                break\n\n        if merge_pair is None:\n            break\n\n        # Perform merge\n        new_tokens = []\n        i = 0\n        while i &lt; len(tokens):\n            if i &lt; len(tokens) - 1 and (tokens[i], tokens[i+1]) == merge_pair:\n                new_tokens.append(merges[merge_pair])\n                i += 2\n            else:\n                new_tokens.append(tokens[i])\n                i += 1\n        tokens = new_tokens\n\n    return tokens\n</code></pre>"},{"location":"en/part2/2_3_tokenization_serialization/#516-byte-level-bpe-deep-dive","title":"5.1.6 Byte-Level BPE: Deep Dive","text":"<p>An important variant of BPE is Byte-level BPE, first introduced by GPT-2. Traditional BPE operates at the character level and needs to handle Unicode encoding issues\u2014character sets differ enormously across languages, and some characters (such as Emoji, special symbols) may not appear in training data, leading to UNK.</p> <p>Byte-level BPE operates directly at the byte level, mapping each byte (0-255) to a printable character, thus avoiding encoding issues and natively supporting any language. This is also why GPT series models can process text in any language.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#working-principles","title":"Working Principles","text":"<ol> <li>Byte encoding: Encode input text as UTF-8 byte sequences. For example, the Chinese character \"\u4f60\" is encoded as 3 bytes <code>[0xe4, 0xbd, 0xa0]</code> in UTF-8.</li> <li>Byte mapping: Map the 256 possible byte values to 256 printable Unicode characters. This allows standard character-level BPE algorithms to process byte sequences.</li> <li>BPE training and application: Perform standard BPE algorithm on the mapped byte sequences.</li> </ol>"},{"location":"en/part2/2_3_tokenization_serialization/#impact-on-multilingual-text","title":"Impact on Multilingual Text","text":"<p>Byte-level BPE has significantly different impacts across languages:</p> <ul> <li>English: ASCII characters require only 1 byte, nearly equivalent to character-level BPE.</li> <li>Chinese: Each Chinese character requires 3 bytes; if the vocabulary doesn't contain sufficient Chinese tokens, one character may be split into 2-3 tokens, severely affecting sequence length and computational efficiency.</li> <li>Japanese/Korean: Require 3 and 3-4 bytes respectively, with similar issues.</li> </ul> <p>This is why the original LLaMA model had poor Chinese capabilities\u2014its vocabulary was primarily trained on English, causing Chinese characters to be excessively segmented, inflating input sequence lengths. The solution is Chinese vocabulary extension, which we'll discuss in detail in Section 5.2.4.</p> <pre><code># Core implementation of Byte-level BPE byte mapping\ndef bytes_to_unicode():\n    \"\"\"\n    GPT-2's byte-to-Unicode mapping\n    Maps 256 byte values to printable Unicode characters\n    \"\"\"\n    # Directly printable ASCII ranges\n    bs = list(range(ord('!'), ord('~') + 1)) + \\\n         list(range(ord('\u00a1'), ord('\u00ac') + 1)) + \\\n         list(range(ord('\u00ae'), ord('\u00ff') + 1))\n\n    cs = bs[:]\n    n = 0\n    # Map remaining bytes to higher Unicode code points\n    for b in range(256):\n        if b not in bs:\n            bs.append(b)\n            cs.append(256 + n)\n            n += 1\n\n    cs = [chr(n) for n in cs]\n    return dict(zip(bs, cs))\n\ndef analyze_byte_level_impact(text: str, tokenizer_name: str):\n    \"\"\"Analyze the impact of Byte-level BPE on different languages\"\"\"\n    from transformers import AutoTokenizer\n\n    tokenizer = AutoTokenizer.from_pretrained(tokenizer_name)\n    tokens = tokenizer.tokenize(text)\n\n    # Compute compression ratio\n    utf8_bytes = len(text.encode('utf-8'))\n    num_tokens = len(tokens)\n    chars_per_token = len(text) / num_tokens\n    bytes_per_token = utf8_bytes / num_tokens\n\n    print(f\"Text: '{text[:50]}...'\")\n    print(f\"Characters: {len(text)}, UTF-8 bytes: {utf8_bytes}\")\n    print(f\"Tokens: {num_tokens}\")\n    print(f\"Average characters per token: {chars_per_token:.2f}\")\n    print(f\"Average bytes per token: {bytes_per_token:.2f}\")\n    print(f\"Tokens: {tokens[:20]}\")\n\n    return {'num_tokens': num_tokens, 'chars_per_token': chars_per_token}\n</code></pre>"},{"location":"en/part2/2_3_tokenization_serialization/#513-wordpiece-berts-choice","title":"5.1.3 WordPiece: BERT's Choice","text":"<p>WordPiece is the tokenization algorithm developed by Google for BERT, very similar to BPE, with the main difference in the criterion for selecting merge pairs.</p> <p>BPE selects the most frequently occurring pair for merging. WordPiece selects the pair that maximizes training data likelihood. Specifically, for candidate pair (A, B), WordPiece computes the language model probability gain of the merged vocabulary on training data, and selects the pair with the greatest gain for merging.</p> <p>In practice, this means WordPiece tends to merge pairs whose \"probability of co-occurrence is far higher than the product of independent occurrence probabilities.\" This criterion makes WordPiece more sensitive to low-frequency but meaningful patterns.</p> <p>Another characteristic of WordPiece is using the <code>##</code> prefix to identify non-word-initial subwords. For example, \"playing\" might be tokenized as [\"play\", \"##ing\"]. This representation clearly distinguishes subword position in the original word, helping the model understand vocabulary structure.</p> <pre><code># WordPiece tokenization example (using HuggingFace tokenizers)\nfrom tokenizers import Tokenizer\nfrom tokenizers.models import WordPiece\nfrom tokenizers.trainers import WordPieceTrainer\nfrom tokenizers.pre_tokenizers import Whitespace\n\n# Initialize WordPiece tokenizer\ntokenizer = Tokenizer(WordPiece(unk_token=\"[UNK]\"))\ntokenizer.pre_tokenizer = Whitespace()\n\n# Train\ntrainer = WordPieceTrainer(\n    vocab_size=30000,\n    special_tokens=[\"[UNK]\", \"[CLS]\", \"[SEP]\", \"[PAD]\", \"[MASK]\"]\n)\ntokenizer.train(files=[\"corpus.txt\"], trainer=trainer)\n\n# Use\noutput = tokenizer.encode(\"unhappiness\")\nprint(output.tokens)  # ['un', '##happi', '##ness']\n</code></pre>"},{"location":"en/part2/2_3_tokenization_serialization/#514-unigram-a-probabilistic-perspective-on-tokenization","title":"5.1.4 Unigram: A Probabilistic Perspective on Tokenization","text":"<p>Unigram tokenization was proposed by Kudo in 2018, adopting a completely different approach from BPE/WordPiece. BPE and WordPiece are bottom-up methods\u2014starting from small units and gradually merging into larger units. Unigram is top-down\u2014starting from a large vocabulary containing all possible subwords and gradually pruning to target size.</p> <p>Unigram models tokenization as a probability problem. Given vocabulary V and probability P(t) for each token, the tokenization result for a text is the segmentation that maximizes total probability:</p> \\[P(x_1, x_2, ..., x_n) = \\prod_{i=1}^{n} P(x_i)\\] <p>The training process uses the EM algorithm: E-step computes expected occurrence count of each token under current vocabulary; M-step updates token probabilities. Then delete tokens whose deletion has minimal impact on total likelihood until reaching target vocabulary size.</p> <p>A unique advantage of Unigram is its natural support for probability modeling of multiple tokenization results. For a given text, there may be multiple valid segmentation ways; Unigram can assign a probability to each. This is very useful in certain application scenarios (e.g., multi-hypothesis processing in speech recognition).</p>"},{"location":"en/part2/2_3_tokenization_serialization/#515-comparison-of-the-three-algorithms","title":"5.1.5 Comparison of the Three Algorithms","text":"<p>The three mainstream subword tokenization algorithms each have their characteristics; selection requires trade-offs based on specific scenarios.</p> Algorithm Core Idea Advantages Disadvantages Typical Applications BPE Bottom-up, frequency-driven merging Simple and intuitive, fast training Greedy strategy may not be optimal GPT series, LLaMA WordPiece Bottom-up, likelihood-driven merging Sensitive to low-frequency meaningful patterns Higher computation complexity BERT, DistilBERT Unigram Top-down, probability modeling Theoretically elegant, supports multiple segmentations Slower training T5, mT5, ALBERT <p></p> <p>Figure 5-2: Comparison of BPE, WordPiece, and Unigram Tokenization Algorithms</p> <p>In actual engineering, SentencePiece is the most commonly used tokenization toolkit. It supports both BPE and Unigram algorithms, provides language-agnostic preprocessing (not dependent on space-based tokenization), and integrates seamlessly with mainstream deep learning frameworks.</p> <pre><code>import sentencepiece as spm\n\n# Train SentencePiece model\nspm.SentencePieceTrainer.train(\n    input='corpus.txt',\n    model_prefix='my_tokenizer',\n    vocab_size=32000,\n    model_type='bpe',  # or 'unigram'\n    character_coverage=0_9995,\n    num_threads=16\n)\n\n# Load and use\nsp = spm.SentencePieceProcessor(model_file='my_tokenizer.model')\ntokens = sp.encode('Hello, world!', out_type=str)\nprint(tokens)  # ['\u2581Hello', ',', '\u2581world', '!']\nids = sp.encode('Hello, world!')\nprint(ids)  # [1234, 56, 789, 10]\n</code></pre>"},{"location":"en/part2/2_3_tokenization_serialization/#52-vocabulary-design-and-extension","title":"5.2 Vocabulary Design and Extension","text":"<p>The vocabulary is the core component of a tokenizer. Vocabulary size, coverage, and structure directly affect model performance and efficiency.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#521-vocabulary-size-trade-offs","title":"5.2.1 Vocabulary Size Trade-offs","text":"<p>Vocabulary size is one of the most important hyperparameters in tokenizer design. A larger vocabulary means more tokens retained as complete units, shorter sequences, but a larger embedding matrix and more parameters; a smaller vocabulary means more words split into subwords, longer sequences, but fewer model parameters.</p> <p>Mainstream large model vocabulary sizes typically range from 32K to 128K. GPT-2 uses 50,257, LLaMA uses 32,000, GPT-4 is reported to use approximately 100,000. When selecting vocabulary size, consider:</p> <p>Computation efficiency: The larger the vocabulary, the more parameters in the embedding and output layers. For a d-dimensional model with vocabulary size V, the embedding matrix contains V \u00d7 d parameters. When V increases from 32K to 128K, this increases 4x.</p> <p>Sequence length: The larger the vocabulary, the more characters each token covers on average, and the fewer tokens the same text is split into. This is especially important for long documents, as Transformer computation complexity is quadratic in sequence length.</p> <p>Rare word handling: The larger the vocabulary, the more rare words can be retained as complete tokens, reducing UNK and over-segmentation issues. But this also means rare tokens see fewer training samples, potentially leading to poor embedding quality.</p> <pre><code># Analyze impact of different vocabulary sizes on sequence length\ndef analyze_vocab_size_impact(text: str, vocab_sizes: list) -&gt; dict:\n    \"\"\"Analyze impact of vocabulary size on tokenization results\"\"\"\n    import sentencepiece as spm\n\n    results = {}\n    for vocab_size in vocab_sizes:\n        # Train tokenizers with different vocabulary sizes\n        spm.SentencePieceTrainer.train(\n            input='corpus.txt',\n            model_prefix=f'tokenizer_{vocab_size}',\n            vocab_size=vocab_size,\n            model_type='bpe'\n        )\n\n        sp = spm.SentencePieceProcessor(model_file=f'tokenizer_{vocab_size}.model')\n        tokens = sp.encode(text)\n\n        results[vocab_size] = {\n            'num_tokens': len(tokens),\n            'chars_per_token': len(text) / len(tokens),\n            'compression_ratio': len(text.encode('utf-8')) / (len(tokens) * 2)\n        }\n\n    return results\n</code></pre>"},{"location":"en/part2/2_3_tokenization_serialization/#522-multilingual-vocabulary-design","title":"5.2.2 Multilingual Vocabulary Design","text":"<p>When training multilingual models, vocabulary design faces additional challenges: how to balance coverage of different languages within limited vocabulary space?</p> <p>A common problem is the \"Vocabulary Curse.\" If a tokenizer is trained directly on multilingual corpus, high-resource languages (e.g., English) will occupy most vocabulary space, while low-resource languages have severely insufficient coverage. This causes low-resource language text to be over-segmented, sequence length to inflate, and model performance to degrade.</p> <p>Common strategies to address this include:</p> <p>Corpus balancing: Before training the tokenizer, oversample or undersample corpus from different languages to make weights more balanced across languages.</p> <p>Temperature sampling: Similar to the multilingual data balancing strategy discussed in Chapter 3, use temperature parameter to control sampling probability of different languages.</p> <p>Language-specific character coverage: Ensure basic character sets of each target language are included in the vocabulary even if their frequency is low. SentencePiece provides the <code>character_coverage</code> parameter to control this.</p> <pre><code># Multilingual tokenizer training example\nimport sentencepiece as spm\n\n# Use character coverage to ensure multilingual support\nspm.SentencePieceTrainer.train(\n    input='multilingual_corpus.txt',\n    model_prefix='multilingual_tokenizer',\n    vocab_size=64000,\n    model_type='unigram',\n    character_coverage=0_9999,  # High coverage ensures rare characters included\n    input_sentence_size=10000000,\n    shuffle_input_sentence=True,\n    # Special handling for CJK characters\n    byte_fallback=True  # Fall back to byte level for unknown characters\n)\n</code></pre>"},{"location":"en/part2/2_3_tokenization_serialization/#523-domain-specific-vocabulary-extension","title":"5.2.3 Domain-Specific Vocabulary Extension","text":"<p>When applying pre-trained models to specific domains (e.g., medical, legal, code), one often encounters the problem of domain terminology being over-segmented. This not only increases sequence length but may also affect the model's understanding of professional concepts.</p> <p>Vocabulary extension is an effective solution. The basic idea: add new domain-specific tokens while preserving the original vocabulary.</p> <pre><code>from transformers import AutoTokenizer\n\ndef extend_tokenizer(base_tokenizer_name: str, \n                     domain_terms: list,\n                     output_dir: str) -&gt; None:\n    \"\"\"\n    Extend pre-trained tokenizer vocabulary\n\n    Args:\n        base_tokenizer_name: Base tokenizer name\n        domain_terms: List of domain-specific terms\n        output_dir: Output directory\n    \"\"\"\n    # Load base tokenizer\n    tokenizer = AutoTokenizer.from_pretrained(base_tokenizer_name)\n\n    print(f\"Original vocabulary size: {len(tokenizer)}\")\n\n    # Filter already existing tokens\n    new_tokens = []\n    for term in domain_terms:\n        if term not in tokenizer.get_vocab():\n            new_tokens.append(term)\n\n    # Add new tokens\n    num_added = tokenizer.add_tokens(new_tokens)\n    print(f\"Added {num_added} new tokens\")\n    print(f\"New vocabulary size: {len(tokenizer)}\")\n\n    # Save extended tokenizer\n    tokenizer.save_pretrained(output_dir)\n\n    return tokenizer\n\n# Example: Extend vocabulary for medical domain\nmedical_terms = [\n    '\u51a0\u72b6\u52a8\u8109',\n    '\u5fc3\u808c\u6897\u6b7b',\n    '\u52a8\u8109\u7ca5\u6837\u786c\u5316',\n    'COVID-19',\n    'mRNA\u75ab\u82d7',\n    '\u8ba1\u7b97\u673a\u65ad\u5c42\u626b\u63cf',\n    # ... more terms\n]\n\ntokenizer = extend_tokenizer(\n    'meta-llama/Llama-2-7b',\n    medical_terms,\n    './medical_tokenizer'\n)\n</code></pre> <p>After vocabulary extension, the model's embedding matrix needs to be extended accordingly. Embeddings for new tokens are typically initialized to random values or the average of existing related tokens, then learned through continued pre-training for meaningful representations.</p> <pre><code>from transformers import AutoModelForCausalLM\n\ndef resize_model_embeddings(model_name: str, \n                            tokenizer,\n                            output_dir: str) -&gt; None:\n    \"\"\"Resize model embedding layer to match extended vocabulary\"\"\"\n    model = AutoModelForCausalLM.from_pretrained(model_name)\n\n    # Resize embedding layer\n    model.resize_token_embeddings(len(tokenizer))\n\n    # Optional: Initialize new embeddings with mean of similar tokens\n    # This usually gives better results than random initialization\n\n    model.save_pretrained(output_dir)\n</code></pre>"},{"location":"en/part2/2_3_tokenization_serialization/#524-llama-chinese-vocabulary-extension-engineering-practice","title":"5.2.4 LLaMA Chinese Vocabulary Extension: Engineering Practice","text":"<p>In practice, extending LLaMA-type models with Chinese vocabulary is a very common engineering task. Since LLaMA's original tokenizer was trained primarily on English data, Chinese characters are excessively segmented, leading to three major issues: sequences are 2-3x longer (higher compute cost), model struggles to learn complete Chinese semantics, and context window is effectively shortened.</p> <p>The complete workflow for Chinese vocabulary extension is as follows:</p> <p>Step 1: Train Chinese SentencePiece model</p> <p>First, train a dedicated Chinese BPE model on a Chinese corpus.</p> <pre><code>import sentencepiece as spm\n\n# Train Chinese SentencePiece model\nspm.SentencePieceTrainer.train(\n    input='chinese_corpus.txt',  # Large-scale Chinese corpus\n    model_prefix='chinese_sp',\n    vocab_size=20000,            # Number of Chinese tokens to add\n    model_type='bpe',\n    character_coverage=0.9999,   # Ensure CJK character coverage\n    byte_fallback=True,\n    num_threads=32\n)\n</code></pre> <p>Step 2: Merge vocabularies</p> <p>Merge new Chinese tokens into LLaMA's original vocabulary, avoiding duplicates.</p> <pre><code>from transformers import LlamaTokenizer\nimport sentencepiece as spm\n\ndef merge_tokenizers(\n    base_tokenizer_path: str,\n    chinese_sp_model_path: str,\n    output_path: str\n):\n    \"\"\"Merge LLaMA tokenizer with Chinese SentencePiece model\"\"\"\n    # Load base tokenizer\n    base_tokenizer = LlamaTokenizer.from_pretrained(base_tokenizer_path)\n    base_vocab = set(base_tokenizer.get_vocab().keys())\n\n    # Load Chinese model\n    chinese_sp = spm.SentencePieceProcessor(model_file=chinese_sp_model_path)\n\n    # Extract new tokens (not in original vocabulary)\n    new_tokens = []\n    for i in range(chinese_sp.get_piece_size()):\n        piece = chinese_sp.id_to_piece(i)\n        if piece not in base_vocab:\n            new_tokens.append(piece)\n\n    # Add new tokens\n    num_added = base_tokenizer.add_tokens(new_tokens)\n    print(f\"Added {num_added} Chinese tokens\")\n    print(f\"Vocabulary size: {len(base_tokenizer.get_vocab().keys())} -&gt; {len(base_tokenizer)}\")\n\n    # Save\n    base_tokenizer.save_pretrained(output_path)\n    return base_tokenizer\n</code></pre> <p>Step 3: Resize model embedding matrix</p> <p>After vocabulary expansion, the model's embedding and output layers must be resized accordingly.</p> <pre><code>from transformers import LlamaForCausalLM\nimport torch\n\ndef resize_model_for_new_vocab(\n    model_path: str,\n    new_tokenizer,\n    output_path: str\n):\n    \"\"\"Resize model to accommodate extended vocabulary\"\"\"\n    model = LlamaForCausalLM.from_pretrained(model_path)\n\n    original_vocab_size = model.config.vocab_size\n    new_vocab_size = len(new_tokenizer)\n\n    # Resize embedding layer\n    model.resize_token_embeddings(new_vocab_size)\n\n    # Initialize new embeddings: use mean of existing embeddings\n    with torch.no_grad():\n        # Input embedding\n        embed_weight = model.model.embed_tokens.weight\n        mean_embed = embed_weight[:original_vocab_size].mean(dim=0)\n        embed_weight[original_vocab_size:] = mean_embed\n\n        # Output layer (lm_head)\n        lm_head_weight = model.lm_head.weight\n        mean_head = lm_head_weight[:original_vocab_size].mean(dim=0)\n        lm_head_weight[original_vocab_size:] = mean_head\n\n    model.save_pretrained(output_path)\n    print(f\"Model resized: {original_vocab_size} -&gt; {new_vocab_size}\")\n</code></pre> <p>Step 4: Verify the effect</p> <pre><code>def verify_chinese_extension(original_tokenizer_path: str, \n                              extended_tokenizer_path: str):\n    \"\"\"Verify the effect of Chinese vocabulary extension\"\"\"\n    from transformers import AutoTokenizer\n\n    original = AutoTokenizer.from_pretrained(original_tokenizer_path)\n    extended = AutoTokenizer.from_pretrained(extended_tokenizer_path)\n\n    test_texts = [\n        \"\u4eba\u5de5\u667a\u80fd\u662f\u8ba1\u7b97\u673a\u79d1\u5b66\u7684\u4e00\u4e2a\u91cd\u8981\u5206\u652f\",\n        \"\u5927\u8bed\u8a00\u6a21\u578b\u7684\u8bad\u7ec3\u6570\u636e\u8d28\u91cf\u51b3\u5b9a\u4e86\u6a21\u578b\u7684\u4e0a\u9650\",\n        \"\u6df1\u5ea6\u5b66\u4e60\u5728\u81ea\u7136\u8bed\u8a00\u5904\u7406\u9886\u57df\u53d6\u5f97\u4e86\u91cd\u5927\u7a81\u7834\"\n    ]\n\n    for text in test_texts:\n        orig_tokens = original.tokenize(text)\n        ext_tokens = extended.tokenize(text)\n\n        print(f\"\\nText: {text}\")\n        print(f\"  Original: {len(orig_tokens)} tokens -&gt; {orig_tokens}\")\n        print(f\"  Extended: {len(ext_tokens)} tokens -&gt; {ext_tokens}\")\n        print(f\"  Compression: {len(orig_tokens)/len(ext_tokens):.1f}x\")\n</code></pre> <p>Typically, after Chinese vocabulary extension, Chinese text token count is reduced by 50-70%, meaning the same context window can process 2-3x more Chinese content.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#525-vocabulary-design-best-practices","title":"5.2.5 Vocabulary Design Best Practices","text":"<p>Based on industry experience, here are some best practices for vocabulary design:</p> <p>Reserve sufficient special token positions: Reserve some token IDs for future special tokens (e.g., new control symbols, domain markers). Many tokenizers reserve 100-1000 positions.</p> <p>Ensure reasonable segmentation of numbers and code symbols: Numbers are important in many tasks, but standard tokenizers often handle them poorly. Consider keeping single digits as independent tokens or using special number encoding strategies.</p> <p>Test edge cases: Before finalizing vocabulary, test various edge cases: very long words, special characters, mixed-language text, code snippets. Ensure tokenization results meet expectations.</p> <p>Document vocabulary decisions: Record vocabulary size, training corpus, special token list, etc., to facilitate subsequent model iteration and troubleshooting.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#53-data-mixing-and-curriculum-learning","title":"5.3 Data Mixing and Curriculum Learning","text":"<p>After determining the tokenizer, the next key question is: how to organize and present training data? In what proportions should data from different sources and qualities be mixed? Does the order of data during training matter?</p>"},{"location":"en/part2/2_3_tokenization_serialization/#531-data-mixing-strategies","title":"5.3.1 Data Mixing Strategies","text":"<p>As discussed in Chapter 3, high-quality pre-training datasets typically mix multiple sources: web, books, code, papers, dialogue, etc. Each source has different data volume and quality; simply mixing by original proportions is often not optimal.</p> <p>Static mixing is the simplest strategy: determine mixing proportions for each source before training begins, shuffle data, then train sequentially. This method is simple to implement but lacks flexibility.</p> <pre><code># Static data mixing example\nimport random\n\ndef static_mix(data_sources: dict, target_size: int) -&gt; list:\n    \"\"\"\n    Statically mix multiple data sources\n\n    Args:\n        data_sources: {source_name: (data_list, weight)}\n        target_size: Target dataset size\n\n    Returns:\n        Mixed data list\n    \"\"\"\n    mixed_data = []\n\n    # Compute sample count for each source\n    total_weight = sum(w for _, w in data_sources.values())\n\n    for source_name, (data, weight) in data_sources.items():\n        num_samples = int(target_size * weight / total_weight)\n\n        # If insufficient data, repeat sampling\n        if len(data) &lt; num_samples:\n            sampled = random.choices(data, k=num_samples)\n        else:\n            sampled = random.sample(data, num_samples)\n\n        mixed_data.extend(sampled)\n\n    random.shuffle(mixed_data)\n    return mixed_data\n\n# Usage example\ndata_sources = {\n    'web': (web_data, 0_6),\n    'books': (book_data, 0_15),\n    'code': (code_data, 0_1),\n    'papers': (paper_data, 0_1),\n    'wikipedia': (wiki_data, 0_05)\n}\n\nmixed = static_mix(data_sources, target_size=1000000)\n</code></pre> <p></p> <p>Figure 5-3: Static vs. Dynamic Mixing Strategy Comparison</p> <p>Dynamic mixing allows adjusting mixing proportions during training. Some research suggests optimal data ratios may differ across training stages. For example, training early with more diverse data helps the model establish broad language understanding; training later with increased high-quality data proportion improves fine-grained capabilities.</p> <pre><code>class DynamicDataMixer:\n    \"\"\"Dynamic data mixer\"\"\"\n\n    def __init__(self, data_sources: dict, schedule: list):\n        \"\"\"\n        Initialize dynamic mixer\n\n        Args:\n            data_sources: Data source dictionary\n            schedule: [(step_threshold, weights_dict), ...]\n                     Use different mixing weights at different training steps\n        \"\"\"\n        self.data_sources = data_sources\n        self.schedule = sorted(schedule, key=lambda x: x[0])\n        self.current_step = 0\n\n    def get_weights(self) -&gt; dict:\n        \"\"\"Get weights for current step\"\"\"\n        for step_threshold, weights in reversed(self.schedule):\n            if self.current_step &gt;= step_threshold:\n                return weights\n        return self.schedule[0][1]\n\n    def sample_batch(self, batch_size: int) -&gt; list:\n        \"\"\"Sample one batch\"\"\"\n        weights = self.get_weights()\n        batch = []\n\n        for source_name, weight in weights.items():\n            num_samples = int(batch_size * weight)\n            data = self.data_sources[source_name]\n            batch.extend(random.choices(data, k=num_samples))\n\n        random.shuffle(batch)\n        self.current_step += 1\n        return batch[:batch_size]\n\n# Usage example: Emphasize diversity early, quality later\nschedule = [\n    (0, {'web': 0_5, 'books': 0_2, 'code': 0_15, 'papers': 0_1, 'wiki': 0_05}),\n    (100000, {'web': 0_4, 'books': 0_25, 'code': 0_15, 'papers': 0_15, 'wiki': 0_05}),\n    (500000, {'web': 0_3, 'books': 0_3, 'code': 0_2, 'papers': 0_15, 'wiki': 0_05}),\n]\n\nmixer = DynamicDataMixer(data_sources, schedule)\n</code></pre>"},{"location":"en/part2/2_3_tokenization_serialization/#532-curriculum-learning","title":"5.3.2 Curriculum Learning","text":"<p>Curriculum learning is a training strategy inspired by human learning. The core idea: have the model learn \"easy\" samples first, then gradually transition to \"hard\" samples. This strategy has been proven in multiple studies to accelerate convergence and improve final performance.</p> <p>In pre-training scenarios, \"easy\" and \"hard\" can be defined in multiple ways:</p> <p>Length-based: Short text is usually easier to learn than long text. The curriculum can start with short sequences and gradually increase length.</p> <p>Perplexity-based: Text with low perplexity (text the language model is more \"familiar\" with) can be considered \"easy\" samples. A small pre-trained model can be used to evaluate sample difficulty, then samples ordered by difficulty for the main model.</p> <p>Noise-level-based: High-quality, low-noise text first, then gradually introduce lower-quality but potentially unique-information text.</p> <pre><code>import numpy as np\n\nclass CurriculumScheduler:\n    \"\"\"Curriculum learning scheduler\"\"\"\n\n    def __init__(self, \n                 data: list, \n                 difficulty_scores: list,\n                 total_steps: int,\n                 strategy: str = 'linear'):\n        \"\"\"\n        Initialize curriculum scheduler\n\n        Args:\n            data: Data list\n            difficulty_scores: Difficulty score for each sample (higher = harder)\n            total_steps: Total training steps\n            strategy: Curriculum strategy ('linear', 'sqrt', 'exp')\n        \"\"\"\n        self.data = np.array(data)\n        self.difficulty_scores = np.array(difficulty_scores)\n        self.total_steps = total_steps\n        self.strategy = strategy\n\n        # Sort by difficulty\n        sorted_indices = np.argsort(self.difficulty_scores)\n        self.sorted_data = self.data[sorted_indices]\n        self.sorted_scores = self.difficulty_scores[sorted_indices]\n\n    def get_curriculum_fraction(self, current_step: int) -&gt; float:\n        \"\"\"\n        Compute data fraction to use at current step\n\n        Return value in [0, 1], indicating proportion of easiest data to use\n        \"\"\"\n        progress = current_step / self.total_steps\n\n        if self.strategy == 'linear':\n            return progress\n        elif self.strategy == 'sqrt':\n            return np.sqrt(progress)\n        elif self.strategy == 'exp':\n            return 1 - np.exp(-3 * progress)\n        else:\n            return progress\n\n    def sample_batch(self, current_step: int, batch_size: int) -&gt; list:\n        \"\"\"Sample batch according to current progress\"\"\"\n        fraction = self.get_curriculum_fraction(current_step)\n\n        # Determine available data range\n        available_size = max(int(len(self.sorted_data) * fraction), batch_size)\n        available_data = self.sorted_data[:available_size]\n\n        # Random sample from available range\n        indices = np.random.choice(len(available_data), size=batch_size, replace=True)\n        return available_data[indices].tolist()\n</code></pre> <p></p> <p>Figure 5-4: Curriculum Learning Principle \u2014 Gradual transition from easy to hard samples</p>"},{"location":"en/part2/2_3_tokenization_serialization/#533-data-sampling-and-batch-construction","title":"5.3.3 Data Sampling and Batch Construction","text":"<p>In actual training, how data is organized affects both efficiency and effectiveness. Here are some important engineering considerations:</p> <p>Pack strategy: To fully utilize compute resources, multiple short sequences are typically packed into a fixed-length sequence. This reduces computation waste from padding. The key question is how to handle attention masks after packing\u2014different documents should not attend to each other.</p> <pre><code>def pack_sequences(sequences: list, max_length: int, eos_token_id: int) -&gt; list:\n    \"\"\"\n    Pack multiple short sequences to fixed length\n\n    Args:\n        sequences: List of token id sequences\n        max_length: Target sequence length\n        eos_token_id: End-of-sequence token ID\n\n    Returns:\n        List of packed sequences, each of length max_length\n    \"\"\"\n    packed = []\n    current_pack = []\n    current_length = 0\n\n    for seq in sequences:\n        seq_with_eos = seq + [eos_token_id]\n\n        if current_length + len(seq_with_eos) &lt;= max_length:\n            current_pack.extend(seq_with_eos)\n            current_length += len(seq_with_eos)\n        else:\n            # Current pack full, start new one\n            if current_pack:\n                # Pad to max_length\n                current_pack.extend([eos_token_id] * (max_length - current_length))\n                packed.append(current_pack)\n\n            current_pack = seq_with_eos\n            current_length = len(seq_with_eos)\n\n    # Handle last pack\n    if current_pack:\n        current_pack.extend([eos_token_id] * (max_length - current_length))\n        packed.append(current_pack)\n\n    return packed\n</code></pre> <p>Document boundary handling: When packing sequences, need to create a \"document boundary mask\" to ensure the model does not perform attention across document boundaries during generation.</p> <p>Data loading efficiency: For TB-scale datasets, data loading itself may become a bottleneck. Common optimization methods include: storing preprocessed data in binary format (e.g., numpy memmap), multi-process parallel loading, prefetching the next batch.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#534-serialization-and-storage-formats","title":"5.3.4 Serialization and Storage Formats","text":"<p>After tokenization, token sequences need to be stored in efficient format for fast reading during training.</p> <p>Common storage formats include:</p> <p>NumPy memmap: Store token IDs as numpy array, access via memory mapping. Advantage is simple and direct, supports random access; disadvantage is no compression support, larger storage.</p> <pre><code>import numpy as np\n\ndef save_as_memmap(token_ids: list, output_path: str):\n    \"\"\"Save token ID list as memmap format\"\"\"\n    arr = np.array(token_ids, dtype=np.uint16)  # Assume vocabulary &lt; 65536\n    fp = np.memmap(output_path, dtype='uint16', mode='w+', shape=arr.shape)\n    fp[:] = arr[:]\n    fp.flush()\n\ndef load_memmap(path: str, shape: tuple):\n    \"\"\"Load memmap format token IDs\"\"\"\n    return np.memmap(path, dtype='uint16', mode='r', shape=shape)\n</code></pre> <p>Arrow/Parquet: Use Apache Arrow format, supports compression and efficient columnar access. HuggingFace Datasets uses this format internally.</p> <p>Custom binary format: Some large projects use custom binary formats optimized for specific access patterns. For example, the binary packing format used by GPT-NeoX.</p> <pre><code># Use HuggingFace Datasets for tokenized data\nfrom datasets import Dataset\n\ndef tokenize_and_save(raw_data: list, tokenizer, output_dir: str):\n    \"\"\"Tokenize and save as Datasets format\"\"\"\n\n    def tokenize_function(examples):\n        return tokenizer(\n            examples['text'],\n            truncation=True,\n            max_length=2048,\n            return_attention_mask=False\n        )\n\n    # Create Dataset\n    ds = Dataset.from_dict({'text': raw_data})\n\n    # Tokenize\n    tokenized_ds = ds.map(\n        tokenize_function,\n        batched=True,\n        num_proc=16,\n        remove_columns=['text']\n    )\n\n    # Save\n    tokenized_ds.save_to_disk(output_dir)\n</code></pre>"},{"location":"en/part2/2_3_tokenization_serialization/#54-complete-data-preparation-pipeline","title":"5.4 Complete Data Preparation Pipeline","text":"<p>Connect the steps discussed above to build a complete pipeline from raw text to training-ready data.</p> <pre><code>from dataclasses import dataclass\nfrom typing import Optional\nimport sentencepiece as spm\n\n@dataclass\nclass DataPrepConfig:\n    \"\"\"Data preparation configuration\"\"\"\n    # Tokenizer config\n    tokenizer_path: str\n    max_seq_length: int = 2048\n\n    # Data mixing config\n    mix_weights: dict = None  # {source: weight}\n\n    # Curriculum learning config\n    use_curriculum: bool = False\n    curriculum_strategy: str = 'linear'\n\n    # Output config\n    pack_sequences: bool = True\n    output_format: str = 'arrow'  # 'arrow', 'memmap', 'jsonl'\n\nclass DataPreparationPipeline:\n    \"\"\"Data preparation pipeline\"\"\"\n\n    def __init__(self, config: DataPrepConfig):\n        self.config = config\n        self.tokenizer = spm.SentencePieceProcessor(model_file=config.tokenizer_path)\n\n    def tokenize_document(self, text: str) -&gt; list:\n        \"\"\"Tokenize single document\"\"\"\n        return self.tokenizer.encode(text)\n\n    def process_source(self, source_path: str, source_name: str) -&gt; list:\n        \"\"\"Process single data source\"\"\"\n        documents = self.load_documents(source_path)\n\n        tokenized = []\n        for doc in documents:\n            tokens = self.tokenize_document(doc['text'])\n            if len(tokens) &gt; 10:  # Filter too-short documents\n                tokenized.append({\n                    'input_ids': tokens,\n                    'source': source_name,\n                    'length': len(tokens)\n                })\n\n        return tokenized\n\n    def mix_sources(self, sources: dict) -&gt; list:\n        \"\"\"Mix multiple data sources\"\"\"\n        mixed = []\n        weights = self.config.mix_weights or {s: 1_0 for s in sources}\n        total_weight = sum(weights.values())\n\n        # Determine sample count per source\n        total_samples = sum(len(data) for data in sources.values())\n\n        for source_name, data in sources.items():\n            weight = weights.get(source_name, 1_0) / total_weight\n            num_samples = int(total_samples * weight)\n\n            if len(data) &gt;= num_samples:\n                sampled = random.sample(data, num_samples)\n            else:\n                sampled = random.choices(data, k=num_samples)\n\n            mixed.extend(sampled)\n\n        random.shuffle(mixed)\n        return mixed\n\n    def pack_and_save(self, data: list, output_path: str):\n        \"\"\"Pack and save data\"\"\"\n        if self.config.pack_sequences:\n            sequences = [d['input_ids'] for d in data]\n            packed = pack_sequences(\n                sequences, \n                self.config.max_seq_length,\n                self.tokenizer.eos_id()\n            )\n        else:\n            packed = [d['input_ids'] for d in data]\n\n        # Select output format based on config\n        if self.config.output_format == 'arrow':\n            self.save_as_arrow(packed, output_path)\n        elif self.config.output_format == 'memmap':\n            self.save_as_memmap(packed, output_path)\n        else:\n            self.save_as_jsonl(packed, output_path)\n\n    def run(self, source_paths: dict, output_path: str):\n        \"\"\"Run complete pipeline\"\"\"\n        # 1. Process each data source\n        sources = {}\n        for source_name, path in source_paths.items():\n            print(f\"Processing {source_name}...\")\n            sources[source_name] = self.process_source(path, source_name)\n\n        # 2. Mix data\n        print(\"Mixing data sources...\")\n        mixed = self.mix_sources(sources)\n\n        # 3. Optional: Apply curriculum ordering\n        if self.config.use_curriculum:\n            print(\"Applying curriculum ordering...\")\n            mixed = self.apply_curriculum(mixed)\n\n        # 4. Pack and save\n        print(\"Packing and saving...\")\n        self.pack_and_save(mixed, output_path)\n\n        print(f\"Done! Saved {len(mixed)} samples to {output_path}\")\n</code></pre> <p></p> <p>Figure 5-5: Complete Pipeline from Raw Text to Training-Ready Data</p>"},{"location":"en/part2/2_3_tokenization_serialization/#55-chapter-summary","title":"5.5 Chapter Summary","text":"<p>This chapter systematically introduced the core technologies of tokenization and data serialization.</p> <p>In tokenizer principles: subword tokenization is the mainstream choice for current large models, achieving good balance between vocabulary size and sequence length. BPE uses frequency-driven bottom-up merging strategy, simple and efficient; WordPiece uses likelihood-driven merging criterion, more sensitive to low-frequency meaningful patterns; Unigram uses top-down probability modeling, theoretically more elegant. SentencePiece is the most commonly used toolkit, supporting multiple algorithms and language-agnostic processing.</p> <p>In vocabulary design: vocabulary size requires trade-offs between computation efficiency, sequence length, and rare word handling; mainstream models typically use 32K-128K. Multilingual vocabulary design needs to balance coverage across languages and avoid the \"vocabulary curse.\" Domain-specific vocabulary extension can improve professional terminology handling but requires extending the model embedding layer accordingly.</p> <p>In data mixing: static mixing is simple and direct; dynamic mixing allows adjusting proportions during training. Curriculum learning strategy starts with easy samples and gradually transitions to hard ones, which can accelerate convergence and improve performance. Data packing and efficient storage formats are crucial for large-scale training.</p> <p></p> <p>Figure 5-6: Chapter 5 Knowledge Structure \u2014 Three themes: Tokenization Algorithms, Vocabulary Design, Data Organization</p>"},{"location":"en/part2/2_3_tokenization_serialization/#further-reading","title":"Further Reading","text":"<p>For in-depth content on tokenization and data serialization, the following resources are worth referencing:</p> <p>The SentencePiece paper (Kudo and Richardson, 2018) introduces language-agnostic subword tokenization. The BPE paper (Sennrich et al., 2015) is the pioneering work introducing BPE to NLP. The Unigram paper (Kudo, 2018) provides a probabilistic perspective on subword tokenization. HuggingFace Tokenizers library documentation (huggingface.co/docs/tokenizers) is the authoritative practical reference. For curriculum learning, Bengio et al.'s survey paper provides a comprehensive theoretical framework.</p>"},{"location":"en/part2/2_3_tokenization_serialization/#next-chapter-preview","title":"Next Chapter Preview","text":"<p>With this, we have completed all content on text pre-training data engineering. In the next chapter \"Image-Text Pairs Processing,\" we will enter the field of multimodal data engineering. You will learn how to process LAION-5B style image-text paired data, how to use img2dataset for high-concurrency image downloads, and how to build multimodal data cleaning pipelines.</p> <p>Consider this question as you enter the next chapter: How should the \"quality\" of an image be defined? Besides resolution and clarity, what other dimensions need to be considered?</p>"},{"location":"en/part3/3_1_image_text_pairs/","title":"Chapter 6: Image-Text Pair Processing","text":""},{"location":"en/part3/3_1_image_text_pairs/#chapter-6-image-text-pairs-data-processing","title":"Chapter 6: Image-Text Pairs Data Processing","text":""},{"location":"en/part3/3_1_image_text_pairs/#chapter-summary","title":"Chapter Summary","text":"<p>In the journey of building next-generation Foundation Models, the focus of data engineering has shifted from mere text cleaning to capturing, aligning, and reconstructing multi-dimensional signals from the physical world. If language model data engineering is about \"denoising,\" then multimodal data engineering is about \"association\" and \"alignment.\" With the emergence of GPT-4V, Gemini, and Sora, we have come to realize that single-modality data can no longer satisfy models' appetite for understanding the world.</p> <p>This chapter provides an in-depth analysis of the complete engineering pipeline for building billion-scale multimodal datasets. This is far more than writing a few scripts to download images\u2014it is a comprehensive campaign involving network protocols, distributed storage, heterogeneous computing, and aesthetic evaluation. We will explore the underlying logic of data paradigms, analyze how to leverage distributed computing frameworks to solve the high-concurrency acquisition challenges of massive images, and use GPU hardware acceleration to break through the I/O bottleneck of image preprocessing. Furthermore, we will build an automated cleaning pipeline based on semantics and aesthetics to ensure that data fed into the model is both relevant and safe.</p> <p>Learning Objectives: * Understand the training benefits and engineering challenges of LAION-5B (image-text pairs) and OBELICS (interleaved documents) paradigms, and master the design of hybrid data strategies. * Be able to write distributed downloaders based on PySpark and Ray Data, handle DNS bottlenecks and long-tail latency, and achieve throughput of 10,000+ img/s. * Master NVIDIA DALI pipeline design, solve CPU decoding bottlenecks, and optimize data loading using GPU Direct principles. * Build a multi-stage cleaning funnel that includes CLIP semantic filtering, aesthetic scoring, and safety detection, and master threshold tuning strategies for different business scenarios.</p> <p>Scenario Introduction:</p> <p>\"Imagine this scenario: Our crawler team has just extracted 2 billion raw URLs from Common Crawl, stored in thousands of Parquet files. Your task is to transform this data into a high-quality dataset suitable for GPT-4V pre-training within two weeks. When you try to download using the traditional Python requests library on a single machine, you find the estimated time is as high as 15 years\u2014a classic network I/O blocking problem. Worse, preliminary sampling shows that 30% of downloaded images are e-commerce ads (full of noise), 15% have severe watermarks, and there is even serious NSFW content. If we use this data directly, we will not only waste millions of dollars in compute, but the trained model may face legal risks due to generating objectionable content. We need an industrial-grade, high-throughput, intelligent data engineering solution to meet this challenge.\"</p>"},{"location":"en/part3/3_1_image_text_pairs/#61-data-paradigms-image-text-pairs-laion-5b-vs-interleaved-documents-obelicsmmc4","title":"6.1 Data Paradigms: Image-Text Pairs (LAION-5B) vs Interleaved Documents (OBELICS/MMC4)","text":"<p>Before designing the data pipeline, our first responsibility is to clarify the data organization format. This is not only about storage structure, but also directly determines the training objective and emergent capabilities of downstream models. Different data forms are essentially different abstractions of \"how knowledge exists in the world.\"</p>"},{"location":"en/part3/3_1_image_text_pairs/#611-core-concepts-and-principles","title":"6.1.1 Core Concepts and Principles","text":"<p>Image-Text Pairs are the foundation of multimodal learning, represented by CLIP, ALIGN, and LAION-5B. * Theoretical Analysis: This paradigm assumes strong semantic association between image \\(I\\) and text \\(T\\), and this association is independent and atomic. The training objective is typically to maximize the cosine similarity of \\(I\\) and \\(T\\) in a shared embedding space (Contrastive Learning). Its advantage lies in extremely high \"signal-to-noise ratio\" refinement potential\u2014through contrastive learning, the model learns direct mapping between objects and vocabulary. * Engineering Perspective: Data structure is simple, typically represented as flattened records of <code>(url, caption, metadata)</code>. This data is extremely easy to shard and randomly shuffle. During training, since samples are independent, we can easily implement Global Batch Shuffling to improve contrastive learning effectiveness.</p> <p>Interleaved Image-Text Documents are the key fuel for next-generation multimodal large models (such as Flamingo, GPT-4V, MM1), represented by OBELICS and MMC4. * Theoretical Analysis: This paradigm preserves the original DOM structure order of web pages, with data presented as sequences of <code>&lt;text&gt;, &lt;image&gt;, &lt;text&gt;...</code>. This forces the model to learn \"multimodal context dependency\" (Multimodal In-Context Learning). For example, in a \"how to make a cake\" web page, the relationship between Image 1 (ingredients) and Image 5 (finished product), and their logical connection with surrounding text, cannot be provided by image-text pairs. It simulates the cognitive process of humans reading illustrated books. * Engineering Perspective: The data pipeline is extremely complex. Since individual samples (documents) have variable length and may contain multiple images, batch assembly becomes difficult. Traditional Collators require complex padding strategies. Additionally, document integrity must be carefully maintained during cleaning\u2014arbitrarily deleting a low-quality image may break context logic and cause the model to learn incorrect referential relationships.</p>"},{"location":"en/part3/3_1_image_text_pairs/#612-architecture-decision-comparison-table","title":"6.1.2 Architecture Decision: Comparison Table","text":"<p>With limited resources, how do we weigh these two data paradigms? This is not a simple binary choice, but involves deep trade-offs among model architecture, training cost, and final application scenarios.</p> <p>In early multimodal research (before 2021), the industry widely believed that as long as data volume was sufficient (e.g., 400M pairs for CLIP), models could learn everything. However, with the emergence of GPT-4V, we found that models trained only on image-text pairs, while able to accurately identify \"this is a cat,\" cannot answer \"what might this cat in the image do,\" because they lack logical reasoning context. Conversely, while interleaved documents are rich in logic, the data is sparse and processing cost is extremely high.</p> <p>The table below compares the core differences between the two paradigms at the engineering implementation level, aimed at helping architects make technical choices based on actual needs:</p> Dimension Image-Text Pairs (LAION-style) Interleaved Documents (OBELICS-style) In-depth Analysis &amp; Recommendation Training Objective Contrastive Learning (CLIP), Text-to-Image (Stable Diffusion) Next-Token Prediction, Multimodal Dialogue (GPT-4V) Hybrid strategy is King. Research shows that training visual encoders only with interleaved documents is inefficient (images not dense enough), while using only image-text pairs lacks reasoning capability. Recommend Curriculum Learning strategy. Data Source Parsing Simple: only need to extract <code>&lt;img&gt;</code> tags and Alt-text Complex: need to parse DOM tree, filter ads and sidebars, preserve main content logic Engineering complexity warning. Building interleaved documents requires handling extremely complex HTML rendering logic. Recommend initially using Common Crawl WET files, or directly using OBELICS open-source set for augmentation\u2014don't try to clean the entire internet from scratch. Storage Cost Medium: metadata is CSV/Parquet only, images stored separately High: need to save document topology, recommend WebDataset or TFRecord encapsulation I/O performance bottleneck. For interleaved documents, must use sharded storage to avoid small file fragmentation. Reading requires pre-loading entire documents, placing higher demands on memory bandwidth. Cleaning Challenges Single-point cleaning: each image judged independently, easy to parallelize Context cleaning: must consider text coherence and image quality simultaneously, cleaning logic coupled Strategy selection. When processing interleaved documents, if an image is judged NSFW, recommend replacing with special <code>&lt;BLOCKED_IMAGE&gt;</code> token rather than deleting, to maintain Positional Embedding accuracy. Model Benefits Strong visual-semantic alignment, strong Zero-shot classification Powerful Few-shot Learning, supports multi-turn dialogue and logical reasoning Business-oriented. If the scenario is \"image search,\" image-text pairs suffice; if it involves complex document understanding (e.g., research report analysis, long-form story generation), interleaved documents must be introduced. <p>Tips: In cutting-edge research like MM1 and Idefics2, best practice is not either-or but proportioning. Typically recommend using 80% image-text pairs in the early pre-training phase to establish solid visual-language mapping foundation, while mixing 20% interleaved documents; in the late pre-training phase (Annealing Phase), significantly increase the proportion of interleaved documents to stimulate model long-context reasoning capability. This \"foundation first, logic later\" strategy maximizes compute utilization.</p>"},{"location":"en/part3/3_1_image_text_pairs/#62-image-acquisition-and-preprocessing","title":"6.2 Image Acquisition and Preprocessing","text":"<p>Once the data manifest is determined, the next step is to build a high-throughput download and preprocessing pipeline. This is a typical I/O-intensive task, with main bottlenecks in network bandwidth, DNS resolution latency, and disk writes of massive small files.</p>"},{"location":"en/part3/3_1_image_text_pairs/#621-img2dataset-high-concurrency-download-in-practice","title":"6.2.1 img2dataset High-Concurrency Download in Practice","text":"<p><code>img2dataset</code> is currently the community-recognized best practice tool. It is not just a download script, but a distributed data processing framework based on MapReduce principles.</p> <p>Why do we need specialized tools instead of writing a simple <code>requests.get</code> loop? Because the internet environment is extremely harsh. Links expire (Link Rot), servers rate-limit, DNS times out. When processing billions of URLs, any tiny long-tail latency is amplified into weeks of time cost.</p> <p>Core Principles: 1.  Sharding: Split 1 billion URLs into tens of thousands of small tasks (Shards). This is the foundation of distributed computing. 2.  Async I/O: Use Python's aiohttp or Go coroutines to concurrently initiate hundreds of network requests on a single core, masking network latency. 3.  Streaming Archival: Downloaded images don't hit disk; they are directly assembled into tar packages (WebDataset format) in memory, then streamed to object storage (S3/HDFS). This avoids the file system inode exhaustion problem from creating millions of small files in one directory\u2014a pitfall newcomers often encounter.</p> <p>Engineering Implementation: PySpark Distributed Download Script</p> <p>When processing PB-scale data, single-machine multiprocessing mode is insufficient; a Spark cluster must be used.</p> <pre><code># Recommended environment: PySpark 3_2+, img2dataset 1_41+\n# Run command: spark-submit --master yarn --deploy-mode cluster...\n\nfrom img2dataset import download\nimport shutil\nimport os\n\ndef run_distributed_download():\n    \"\"\"\n    Configuration tuning is key to throughput.\n    process_count: Number of processes per Spark Executor.\n    thread_count: Number of async threads per process.\n    For 10Gbps NIC nodes, typically recommend total_concurrency around 1000.\n    \"\"\"\n\n    # Define output path (S3 or HDFS)\n    output_dir = \"s3a://multimodal-lake/raw-images/laion-5b-subset\"\n\n    # Clean old data (use with caution, production recommends versioning)\n    if os.path.exists(output_dir): \n        # shutil.rmtree(output_dir) # Dangerous operation, commented out\n        pass\n\n    download(\n        processes_count=4,          # 4 CPU cores per node\n        thread_count=64,            # 64 download threads per core\n        url_list=\"s3a://multimodal-lake/meta/laion-urls.parquet\",\n        image_size=256,             # 256x256 sufficient for pre-training, saves bandwidth\n        resize_only_if_bigger=True, # Avoid blur from upscaling small images\n        resize_mode=\"keep_ratio\",   # Maintain aspect ratio, black padding or center crop\n        skip_reencode=True,         # If original is JPG and size acceptable, store directly, saves CPU\n        output_folder=output_dir,\n        output_format=\"webdataset\", # Force WebDataset format\n        input_format=\"parquet\",\n        url_col=\"url\",\n        caption_col=\"caption\",\n        enable_wandb=True,          # Strongly recommended for monitoring download rate and error rate\n        number_sample_per_shard=10000, # 10k images per tar, ~200-300MB, for easy transfer\n        distributor=\"pyspark\",      # Use Spark for task distribution\n        save_additional_columns=[\"similarity\", \"hash\"], # Preserve original metadata\n        timeout=10                  # Shorter timeout for fast failure, long-tail requests not worth waiting\n    )\n\nif __name__ == \"__main__\":\n    # Initialize Spark Session (usually handled by spark-submit, but explicit for IDE debugging)\n    from pyspark.sql import SparkSession\n    spark = SparkSession.builder \\\n        .appName(\"Img2Dataset-Production\") \\\n        .config(\"spark.executor.memory\", \"8g\") \\\n        .config(\"spark.task.maxFailures\", \"10\") \\\n        .getOrCreate()\n\n    run_distributed_download()\n</code></pre> <p>Pro Tips: * DNS Caching: Under high concurrency, DNS resolution can become a bottleneck or even get blocked by providers. Recommend deploying local DNS cache (e.g., dnsmasq) on worker nodes, or maintaining a domain-to-IP mapping table in code. * User-Agent Rotation: Though an \"open\" secret, rotating User-Agent can reduce 403 Forbidden rates. * Error Handling: Monitor success_rate in WandB dashboard. If below 80%, usually means URL list is severely stale or your IP pool is contaminated.</p>"},{"location":"en/part3/3_1_image_text_pairs/#622-visual-preprocessing-pitfalls-cropping-and-semantic-alignment","title":"6.2.2 Visual Preprocessing Pitfalls: Cropping and Semantic Alignment","text":"<p>After solving the challenge of acquiring massive data (Getting bytes), we immediately face the second challenge: data usability. Raw internet images have wildly varying aspect ratios, while models typically require fixed resolution input (e.g., 224x224 or 512x512).</p> <p>Many novice engineering solutions habitually use simple brute-force random preprocessing to unify dimensions, but this is often the root of the model's \"invisible performance ceiling.\" We must not only focus on \"fitting the image in,\" but also on \"what exactly is being put in.\"</p> <p> Figure 6-1: Cropping and Semantic Alignment in Image Preprocessing</p> <ul> <li> <p>Bad Case (Left image - Cost of Naive Cropping):     Traditional <code>RandomCrop</code> or <code>CenterCrop</code> has no awareness of composition. When processing a portrait photo in vertical composition, center cropping easily cuts off key features (such as the head), leaving only the torso. At this point, if the text label is still \"a smiling man,\" the model is forced to establish incorrect mapping (mistaking torso features for \"smiling person\"), causing the trained model to produce severe visual hallucinations.</p> </li> <li> <p>Good Case (Right image - Semantic Completeness):     High-quality data engineering pursues \"image-text consistency.\"</p> <ol> <li>Smart Resize: Prefer <code>Resize with Padding</code> (maintain aspect ratio, black/white padding) to preserve complete visual subject. Though this introduces invalid pixels, it guarantees semantic completeness.</li> <li>Aspect Ratio Bucketing: An advanced technique commonly used by SDXL and Midjourney. Group images with similar aspect ratios into the same batch for training, avoiding cropping while reducing padding waste.</li> <li>Recaptioning: As detailed in Chapter 7 below, using VLM to generate high-density descriptions allows text to precisely correspond to on-screen details (e.g., sign text, background objects), maximizing data training value.</li> </ol> </li> </ul>"},{"location":"en/part3/3_1_image_text_pairs/#623-gpu-accelerated-decoding-and-transformation-nvidia-dali","title":"6.2.3 GPU-Accelerated Decoding and Transformation (NVIDIA DALI)","text":"<p>In the deep learning model training phase, most researchers and developers focus their attention on model architecture design, hyperparameter tuning, loss function improvement\u2014modules that directly affect model accuracy\u2014yet easily overlook the data loading (DataLoader) foundation. In reality, it often becomes the \"invisible performance killer\" that constrains training efficiency, even preventing full utilization of high-end GPU compute and causing serious hardware waste.</p> <p>To understand this pain point, we must first clarify the complete logic of the deep learning training flow: model training's core compute relies on GPU's massive parallel computing capability; GPU can efficiently process massive tensor operations and complete backpropagation and parameter updates. But before data enters the GPU, it must go through a series of preprocessing operations, the most basic and time-consuming of which is image decoding and resizing. In traditional PyTorch training flow, these critical preprocessing operations are entirely done on CPU, forming the contradiction between \"CPU preprocessing bottleneck\" and \"GPU compute redundancy.\"</p> <p>Specifically, the traditional PyTorch Dataset workflow is: first read image files (mostly JPEG) from disk via CPU, then CPU completes JPEG decoding\u2014this process requires Huffman decoding, inverse discrete cosine transform (IDCT) and other complex computations on compressed image binary data, a typical CPU-intensive task. After decoding, CPU executes Resize, normalization, color space conversion and other preprocessing, finally copying the processed image tensor to GPU for model training.</p> <p>More critically, CPU architecture is better suited for serial computation and logic control; its parallel computing capability is far inferior to GPU. Yet image preprocessing operations like decoding and Resize are inherently highly parallelizable and can improve efficiency through multi-threading or multi-core parallelism. But traditional PyTorch Dataset, even with DataLoader's num_workers to improve CPU parallelism, can hardly break through CPU's own compute ceiling\u2014especially when the training dataset is massive (millions of images) and single image resolution is high (1080p+), CPU preprocessing speed will severely lag behind GPU training speed, causing GPU to frequently idle \"waiting for data,\" with significantly reduced GPU utilization, ultimately dragging down the entire training efficiency. This is why data loading is called the \"neglected performance killer.\"</p> <p>Addressing this core pain point, NVIDIA introduced DALI (Data Loading Library), a GPU-accelerated data preprocessing library optimized for deep learning training. Its core goal is to migrate CPU-intensive operations like image decoding and resizing to GPU for parallel execution, breaking the data loading performance bottleneck and enabling full GPU utilization.</p> <p> Figure 6-2: Data Decoding and Transformation With vs Without DALI</p> <p>Code Walkthrough: High-Performance DALI Pipeline</p> <pre><code>import nvidia.dali.fn as fn\nimport nvidia.dali.types as types\nfrom nvidia.dali.pipeline import pipeline_def\n\n\n@pipeline_def(batch_size=256, num_threads=8, device_id=0)\ndef webdataset_gpu_pipeline(shard_id, num_shards):\n    \"\"\"\n    Define end-to-end GPU data loading pipeline\n    Input: WebDataset (Tar) -&gt; Output: GPU Tensor\n    \"\"\"\n\n    # Step 1: Read WebDataset (CPU stage)\n    # Using index_paths is necessary, otherwise initialization requires traversing entire tar, extremely slow [5]\n    jpegs, captions = fn.readers.webdataset(\n        paths=[\"/data/shards/shard-{:05d}.tar\".format(i) for i in range(100)],\n        index_paths=[\"/data/indices/shard-{:05d}.idx\".format(i) for i in range(100)],\n        ext=[\"jpg\", \"txt\"],\n        shard_id=shard_id,\n        num_shards=num_shards,\n        random_shuffle=True,\n        initial_fill=10000,      # Shuffle buffer size, larger = more random but slower startup\n        pad_last_batch=True,     # Ensure all batches have consistent size\n        name=\"Reader\",\n        read_ahead=True          # Enable read-ahead\n    )\n\n    # Step 2: GPU Decoding (core acceleration point)\n    # device=\"mixed\" means input in Host memory, output in Device memory\n    # output_type=types.RGB handles color space conversion automatically\n    images = fn.decoders.image(\n        jpegs,\n        device=\"mixed\",\n        output_type=types.RGB,\n        # Error handling for corrupted images\n        # In production, never let a single bad image crash training\n    )\n\n    # Step 3: GPU transformation pipeline\n    # resize: maintain aspect ratio scaling\n    images = fn.resize(\n        images,\n        resize_x=224,\n        resize_y=224,\n        interp_type=types.INTERP_LINEAR\n    )\n\n    # crop_mirror_normalize: random crop + flip + normalize (fused operator)\n    # This step converts uint8 to float and subtracts mean, divides by std\n    images = fn.crop_mirror_normalize(\n        images,\n        dtype=types.FLOAT,\n        output_layout=\"CHW\",\n        crop=(224, 224),\n        mean=[0_485 * 255, 0_456 * 255, 0_406 * 255],\n        std=[0_229 * 255, 0_224 * 255, 0_225 * 255],\n        mirror=fn.random.coin_flip(probability=0_5)\n    )\n\n    # Text data typically processed directly on CPU or passed to Tokenizer\n    # Here we only return raw bytes for subsequent PyTorch processing\n    return images, captions\n\n# Use DALIGenericIterator integrated with PyTorch\nfrom nvidia.dali.plugin.pytorch import DALIGenericIterator\n\npipe = webdataset_gpu_pipeline(shard_id=0, num_shards=1)\npipe.build()\ndataloader = DALIGenericIterator(pipe, [\"images\", \"captions\"], reader_name=\"Reader\")\n\n# Benchmark test\n# On A100, this pipeline typically achieves 3000-5000 FPS, 5-10x CPU Loader\n</code></pre>"},{"location":"en/part3/3_1_image_text_pairs/#63-multimodal-cleaning-pipeline","title":"6.3 Multimodal Cleaning Pipeline","text":"<p>Massive data comes with massive noise. In raw LAION-5B data, truly high-quality samples may be less than 10%. We need to establish a multi-stage cleaning funnel to improve data density while minimizing loss of data diversity. So-called \"data cleaning\" is essentially Data Diet\u2014feeding the model less but better.</p>"},{"location":"en/part3/3_1_image_text_pairs/#631-architecture-design-ray-data-distributed-cleaning","title":"6.3.1 Architecture Design: Ray Data Distributed Cleaning","text":"<p>Why choose Ray over Spark for the cleaning phase? Because cleaning is no longer simple ETL but contains large amounts of deep learning inference (Model Inference). Compared to Spark's MapReduce paradigm, Ray provides more flexible Actor mechanism, allowing us to keep GPU models (e.g., CLIP, Safety Checker) resident, avoiding the huge overhead of reloading multi-GB models for each small batch.</p> <p>Ray Data is suitable for this mixed workload with both CPU-intensive (decompression, hashing, Regex) and GPU-intensive (CLIP Embedding inference) tasks. Below is a typical three-stage pipeline design: * Stage 1 (CPU): Fast filtering. Directly remove samples with insufficient resolution (&lt;256px), too short text, non-English (if only training English model), or abnormal aspect ratio. * Stage 2 (GPU): Deep feature extraction. Use CLIP model to generate Embeddings, compute image-text similarity and aesthetic score based on Embeddings. * Stage 3 (CPU/Mixed): Logic evaluation and deduplication. Apply final threshold cutoff based on safety (NSFW), aesthetic score, and image-text relevance, and perform semantic deduplication.</p> <p>Data Flow Diagram</p> <p> Figure 6-3: Ray Data Distributed Cleaning Data Flow</p>"},{"location":"en/part3/3_1_image_text_pairs/#632-core-algorithm-implementation","title":"6.3.2 Core Algorithm Implementation","text":"<p>Cleaning is not just deletion\u2014it is also quantization of data value. We need multi-dimensional metrics to measure the \"gold content\" of an image and its corresponding text.</p> <ol> <li> <p>Aesthetics Scoring</p> <ul> <li>Principle: Datasets are filled with invoices, screenshots, blurry surveillance footage\u2014these are useless for generating beautiful images. Typically use LAION-Aesthetics Predictor.</li> <li>Technical Details: A simple MLP (multi-layer perceptron) with CLIP Image Embedding as input, outputting 1-10 score. Training data from AVA dataset (professional photographer human ratings).</li> <li>Recommended Threshold: For base pre-training, keep Score &gt; 4_5; for fine-tuning high-quality generation models (SFT stage), recommend Score &gt; 6_0 or even 6_5.</li> </ul> </li> <li> <p>Image-Text Alignment Filtering</p> <ul> <li>Principle: Many Alt-texts are SEO garbage word stacking or filenames (\"DSC_001.jpg\"), unrelated to image content.</li> <li>Technical Details: Compute cosine similarity (Dot Product) of CLIP Image Embedding and Text Embedding.</li> <li>Pitfall: Different CLIP versions (e.g., OpenAI ViT-L/14 vs OpenCLIP ViT-G/14) have different embedding space distributions\u2014scores are not directly comparable. Must recalibrate thresholds for specific model. Common approach: compute similarity distribution over entire dataset, then keep Top 50% or Top 70%.</li> </ul> </li> <li> <p>Safety Detection (Safety &amp; Watermark)</p> <ul> <li>Principle: Must remove pornographic, violent, and prominently watermarked images.</li> <li>Strategy: Use specially trained classifier heads (also based on CLIP Embedding) for NSFW and watermark detection. For watermark detection: if target is training generation models (e.g., SDXL), must be extremely strict (Recall priority) because generation models easily overfit watermark features; if target is training understanding models (e.g., GPT-4V), can relax somewhat, because understanding models need to recognize \"there is a watermark in the image.\"</li> </ul> </li> </ol> <p>Code Implementation: Ray Data Cleaning Operator</p> <pre><code>import ray\nimport torch\nimport open_clip\nimport numpy as np\nfrom PIL import Image\nimport io\n\n# Define Ray Actor class to ensure model loaded only once\nclass QualityScorer:\n    def __init__(self):\n        self.device = \"cuda\" if torch.cuda.is_available() else \"cpu\"\n        # Load CLIP model (ViT-B-32 fast, suitable for cleaning)\n        self.model, _, self.preprocess = open_clip.create_model_and_transforms(\n            'ViT-B-32', pretrained='laion2b_s34b_b79k', device=self.device\n        )\n        # Load aesthetic scoring head (Linear Layer)\n        self.aesthetic_head = torch.nn.Linear(512, 1).to(self.device)\n        self.aesthetic_head.load_state_dict(torch.load(\"sac+logos+ava1-l14-linearMSE.pth\"))\n        self.aesthetic_head.eval()\n\n    def __call__(self, batch: dict) -&gt; dict:\n        \"\"\"\n        Process a batch of data. Ray will automatically partition and transfer data to Actor.\n        \"\"\"\n        images = []\n        valid_indices = []\n\n        # Preprocess images (CPU operation)\n        for idx, img_bytes in enumerate(batch[\"jpg\"]):\n            try:\n                img = Image.open(io.BytesIO(img_bytes)).convert(\"RGB\")\n                img_tensor = self.preprocess(img)\n                images.append(img_tensor)\n                valid_indices.append(idx)\n            except Exception:\n                # Log bad image but don't interrupt\n                continue\n\n        if not images:\n            return {\"aesthetic_score\": [], \"clip_score\": []}\n\n        image_input = torch.stack(images).to(self.device)\n\n        with torch.no_grad():\n            # 1. Extract features\n            image_features = self.model.encode_image(image_input)\n            image_features /= image_features.norm(dim=-1, keepdim=True)\n\n            # 2. Compute aesthetic score\n            aesthetic_scores = self.aesthetic_head(image_features).squeeze().cpu().numpy()\n\n            # 3. Compute image-text match (assuming batch has text field)\n            # text_tokens = self.tokenizer(batch[\"txt\"]).to(self.device)\n            # text_features = self.model.encode_text(text_tokens)\n            #... compute cosine similarity\n\n        # Return results (must align with original batch indices)\n        return {\"aesthetic_score\": aesthetic_scores}\n\n# Orchestrate Ray pipeline\nray.init()\nds = ray.data.read_webdataset(\"s3://raw-bucket/{00000..00099}.tar\")\n\n# map_batches will automatically schedule GPU resources\n# num_gpus=0_25 means one GPU can run 4 Actors concurrently, improving throughput\nscored_ds = ds.map_batches(\n    QualityScorer, \n    compute=ray.data.ActorPoolStrategy(size=8), \n    num_gpus=0_25, \n    batch_size=128\n)\n\n# Final filtering\nfiltered_ds = scored_ds.filter(lambda row: row[\"aesthetic_score\"] &gt; 4_5)\nfiltered_ds.write_webdataset(\"s3://clean-bucket/\")\n</code></pre>"},{"location":"en/part3/3_1_image_text_pairs/#64-pitfalls-troubleshooting","title":"6.4 Pitfalls &amp; Troubleshooting","text":"<p>In building billion-scale multimodal datasets, engineering teams often stumble on details. Here are several lessons learned:</p> <ul> <li> <p>Parquet Metadata Explosion:</p> <ul> <li>Error: Habitually reading Parquet files with 2 billion rows directly in pandas.</li> <li>Consequence: Memory overflow (OOM), because pandas tries to load entire index into memory even when reading just one column.</li> <li>Fix: Use Polars or PySpark lazy evaluation mode; or strictly split Parquet files by row count (e.g., 1M rows) into small files to avoid processing single giant metadata files.</li> </ul> </li> <li> <p>WebDataset Insufficient Shuffle:</p> <ul> <li>Error: Data written in domain order during download, training relies only on DataLoader buffer shuffle (typically buffer only 10k).</li> <li>Consequence: Model may see 100k e-commerce images consecutively, then 100k landscape images consecutively. Small buffer cannot break this \"temporal correlation,\" causing violent training curve oscillation or even divergence.</li> <li>Fix: Must perform Global Shuffle on URL list before writing WebDataset. Can use Spark's <code>orderBy(rand())</code>.</li> </ul> </li> <li> <p>Accidentally Deleting Long-Tail Data:</p> <ul> <li>Error: For pursuit of extreme aesthetic score, deleting all images with Score &lt; 4_5.</li> <li>Consequence: Model becomes \"specialized\"\u2014only recognizes art photos and wallpapers, not real-world (possibly ugly) photos like medical imaging, street views, handwritten notes. Greatly reduces model generalization.</li> <li>Fix: Use stratified sampling strategy. Keep 5%-10% low-score data as \"regularization,\" or set special whitelists for specific domains (e.g., OCR, charts) that bypass aesthetic filter.</li> </ul> </li> <li> <p>Duplicate Data Hazards (Deduplication):</p> <ul> <li>Error: Ignoring massive duplicate images on the internet (e.g., Memes, viral news images).</li> <li>Consequence: Model overfits specific samples, even \"memorizing\" training set images during generation, causing serious copyright risks.</li> <li>Fix: Must add semantic deduplication to cleaning pipeline. Compute Embeddings for all images, use Faiss or MinHashLSH for clustering, keep only one per highly similar image group.</li> </ul> </li> </ul>"},{"location":"en/part3/3_2_recaptioning/","title":"Chapter 7: Recaptioning","text":""},{"location":"en/part3/3_2_recaptioning/#chapter-7-data-recaptioning","title":"Chapter 7: Data Recaptioning","text":""},{"location":"en/part3/3_2_recaptioning/#chapter-summary","title":"Chapter Summary","text":"<p>Original Alt-text (alternative text) on the internet is essentially auxiliary content designed by web developers for Search Engine Optimization (SEO). Its core goal is to improve webpage ranking in search results, not to accurately and comprehensively describe the visual content of the image itself\u2014this leads to a large amount of raw Alt-text that cannot meet the core requirement of \"visual-text precise alignment\" for Visual Language Model (VLM) training. This chapter systematically introduces how to leverage mainstream Visual Language Models (VLMs) to build an efficient, scalable \"synthetic caption factory\" for automatic large-scale image data recaptioning. We will explore in depth the key role of Prompt Engineering in precisely controlling description granularity (from brief to detailed), crack the differentiated description precision requirements for different downstream tasks, and introduce Optical Character Recognition (OCR) technology as a supplement to address VLM's weak recognition of text in rich-text images (such as documents, posters, charts), further enhancing model understanding of complex images.</p> <p>Learning Objectives: * Deeply understand the essential causes of Alt-text's \"three sins\" (irrelevant, too short, visual omission), and the specific harms such low-quality descriptions cause to visual language model and generative visual model training (e.g., model hallucination, visual-text alignment failure, poor generalization). * Master the complete workflow of deploying mainstream VLMs like LLaVA and CogVLM using vLLM (efficient large model inference engine), understand core principles of high-throughput inference, and achieve rapid large-scale image recaptioning. * Be able to design layered Prompt strategies based on different downstream tasks (e.g., CLIP-style dual-tower model pre-training, Sora-style generative model training), flexibly generating brief or detailed image descriptions to precisely match task requirements. * Master core OCR application methods, implement dynamic fusion of OCR recognition results with VLM Prompts, solve low description quality for document and poster-class rich-text images, and significantly improve description accuracy and richness for such images.</p> <p>Scenario Introduction:</p> <p>\"Imagine you are training a Sora-like model. You feed the model an image of a golden retriever running in the sunset with the Eiffel Tower in the background. Yet the raw data label is 'IMG_20240501.jpg' or 'Best dog food 50% off.' With such data, the model will never learn the visual correspondence of 'golden retriever' and 'Eiffel Tower,' let alone understand 'sunset lighting.' We need 'data recaptioning'\u2014letting AI act as annotator\u2014to accurately write the dog and tower into the text.\"</p>"},{"location":"en/part3/3_2_recaptioning/#71-limitations-of-alt-text-why-are-raw-web-descriptions-unusable","title":"7.1 Limitations of Alt-text: Why Are Raw Web Descriptions Unusable?","text":"<p>In the training of visual language models and generative visual models, data quality directly determines model ceiling\u2014and raw Alt-text from web pages is precisely one of the main sources of low-quality visual-text data. According to internal research reports from DeepMind (\"Scaling Language-Image Pre-training with Weakly Supervised Image-Text Data\") and OpenAI (\"Training language models to follow instructions with human feedback\"), directly using raw Alt-text crawled from the internet as training data causes model performance to \"cap\" prematurely (i.e., regardless of data volume increase, model visual understanding and text generation precision cannot improve further), or even degrade. The core problems can be summarized as \"three sins\":</p> <ul> <li>Extremely Noisy: Large amounts of Alt-text contain only filenames (e.g., \"IMG_20240501.jpg\"), dates, irrelevant SEO keyword stacking (e.g., \"buy cheap shoes nike adidas\" \"best coffee shop near me\"). Such descriptions are completely unrelated to image visual content. Using them for training not only cannot help the model establish visual-text correspondence, but also pollutes model language ability, causing the model to generate irrelevant, redundant text, or even severe hallucinations.</li> <li>Visual Omission: Alt-text design intent is mostly to support webpage functionality, not to describe visual content\u2014it often only describes image function (e.g., \"click purchase button,\" \"view more details\") or commercial attributes (e.g., \"red XL size,\" \"limited-time discount\"), while completely ignoring image visual details (e.g., object shape, color, texture, spatial relations, lighting effects). For example, an image showing \"a red pure cotton T-shirt with white vintage logo on chest, laid flat on wooden table\" may have Alt-text of merely \"red T-shirt promotion\"\u2014such description cannot let the model learn any visual features.</li> <li>Too Short: According to Common Crawl (world's largest web crawl dataset) statistics, over 50% of Alt-text is less than 5 words, 30% even less than 3 words. Such extremely short descriptions cannot carry complex visual logic, spatial relations, and detail information\u2014e.g., cannot describe \"a golden retriever lying on grass, front paws on a red ball, background of hillside full of wildflowers\" involving multiple objects, scenes, and interaction relations.</li> </ul> <p>Value of Recaptioning: The core value of data recaptioning is to use AI to automatically generate high-quality \"visual-text precise alignment\" descriptions to replace low-quality raw Alt-text, breaking model performance ceiling. This has been confirmed by top industry research\u2014OpenAI explicitly stated in the DALL-E 3 paper (\"DALL\u00b7E 3: Scaling Autoregressive Image Generation with Improved Alignment\") that using up to 95% synthetic long-form text (Synthetic Captions, i.e., recaption text generated by VLM) for training is one of the core reasons its instruction-following ability and visual restoration precision far surpass Stable Diffusion XL (SDXL). Synthetic long-form text can precisely capture image visual details, logical relations, and scene atmosphere, letting the model truly learn \"describe what you see,\" thereby improving subsequent generation, recognition, and understanding capabilities.</p>"},{"location":"en/part3/3_2_recaptioning/#72-synthetic-caption-factory-using-vlm-to-rebirth-data","title":"7.2 Synthetic Caption Factory: Using VLM to Rebirth Data","text":"<p>To achieve large-scale image recaptioning, relying solely on manual annotation is not only extremely costly (minutes per image, datasets often millions or billions of images) but also suffers from inconsistent annotation standards and low efficiency. Therefore, we need to build a VLM-driven \"synthetic caption factory\"\u2014taking raw images as input and high-quality, standardized text descriptions as output, completing data recaptioning through automation and batch processing to achieve data value \"rebirth.\"</p> <p>The core logic of this \"factory\" is: feed raw images into optimized VLM, control description granularity and style through carefully designed Prompts, then improve processing throughput through efficient inference engine, finally outputting high-quality descriptions that meet downstream task requirements. The entire flow can be divided into three core links: \"Model Selection and Architecture Design,\" \"Prompt Strategy Optimization,\" and \"Engineering Deployment.\"</p>"},{"location":"en/part3/3_2_recaptioning/#721-model-selection-and-architecture","title":"7.2.1 Model Selection and Architecture","text":"<p>VLM architecture directly determines description quality, speed, and applicable scenarios. Current mainstream VLM architectures are mainly divided into three types. The table below shows representative models, advantages/disadvantages comparison, and recommended scenarios for each architecture. Selection can be flexible based on downstream task requirements (e.g., description precision, processing speed, data type):</p> Model Architecture Representative Models Advantages Disadvantages Recommended Scenarios Q-Former Connection BLIP-2, InstructBLIP Small parameter count (typically billions, far below large language models), fast inference (single image inference can be tens of milliseconds), low training and deployment cost, less prone to text hallucination (description closely fits image) Short description length, average detail capture, prone to \"repetitive description\" (repeating few core objects, lacking detail extension), limited understanding of complex scenes Quick initial screening of massive images (e.g., rough recaption of billions of images to filter valuable data), or generating short Alt-text replacements (for scenarios with strict description length limits) MLP Projection + LLM LLaVA-1_6 / NeXT Extremely detailed descriptions, captures subtle image details (e.g., lighting, texture, object interactions), strong instruction following (precisely responds to Prompt requirements like \"describe in scene order,\" \"highlight core objects\"), supports multi-turn dialogue (can optimize description quality through multi-turn Prompts) Heavy logic computation (requires 7B+ parameter LLMs like LLaMA 2 7B/13B), relatively slow inference, without Prompt constraints prone to verbose, redundant descriptions Main model, for generating high-quality, long-form Dense Caption (e.g., training Sora-style generative models, SD3 image generation models, scenarios requiring precise, detailed visual-text alignment data) Vision-First Architecture CogVLM, Qwen-VL High visual resolution (supports HD image input, some models support 4K), excels at fine-grained object recognition, especially high precision for text and small widgets (buttons, input fields) in rich-text images (documents, charts, UI screenshots), understands text-visual element associations Higher VRAM usage (7B model deployment requires at least 24GB VRAM), non-standard architecture (different models have varying deployment approaches), slightly cumbersome deployment, medium inference speed Specifically for documents, charts, UI screenshots, posters and other rich-text data (e.g., training models that generate document images, UI interfaces, or scenarios requiring precise text recognition in images) <p>Supplementary note: Core difference among the three architectures lies in \"how visual module connects to language module\": Q-Former architecture uses dedicated Q-Former module to convert visual features to language-understandable vectors before input to lightweight language model; MLP projection architecture uses multi-layer perceptron (MLP) to project visual features to language model embedding space, deeply integrating with large language model; vision-first architecture strengthens visual module resolution and recognition capability, weakens language module redundant computation, prioritizing \"vision understanding first.\"</p>"},{"location":"en/part3/3_2_recaptioning/#722-prompt-strategy-controlling-granularity","title":"7.2.2 Prompt Strategy: Controlling Granularity","text":"<p>Prompt Engineering is the \"core controller\" of the \"synthetic caption factory\"\u2014the same VLM, under different Prompt guidance, generates completely different data distributions (description length, detail richness, style). Therefore, we need to design layered Prompt strategies based on specific downstream task requirements, precisely controlling description granularity so generated descriptions perfectly match task needs.</p> <p>Core Principle: Prompt design must clearly specify \"task instruction,\" \"description scope,\" and \"granularity requirements,\" avoiding vague expressions (e.g., only using \"describe this image\" leads to unstable model output). Meanwhile, adding \"constraints\" (e.g., \"no more than 20 words,\" \"highlight core objects and background\") can further optimize output quality.</p> <p> Figure 7-1: Brief vs Detailed Prompt Strategy</p> <p>Figure 7-1 intuitively compares output differences of two core Prompt strategies\u2014brief Prompt generates concise descriptions with only core objects and scenes; detailed Prompt generates descriptions with rich details including object form, lighting, color, spatial relations, etc. The two strategies adapt to different downstream tasks respectively.</p> <p>Below are two most commonly used layered Prompt strategies. Adjust flexibly based on actual needs, or design medium-granularity Prompt strategies on this basis:</p> <p>Strategy One: Brief Description (Brief Caption) * Prompt: \"Describe this image concisely in one sentence.\"   Supplementary optimization Prompt (for stability): \"Describe this image concisely in one sentence, focusing only on the main subject and key background, no redundant details.\" * Purpose: Adapt to CLIP-style dual-tower models' (vision-text dual-tower architecture) Context Length limit\u2014such models typically limit text input to 77 tokens or less; overly long descriptions get truncated, preventing normal learning. Also suitable for scenarios with strict description length requirements (e.g., image retrieval, quick annotation). * Expected Output: \"A golden retriever running on grass near the Eiffel Tower.\"   Output characteristics: Length controlled to 10-20 words, only core objects (golden retriever), key action (running), core background (Eiffel Tower, grass), no extra details, concise and clear.</p> <p>Strategy Two: Detailed Description (Detailed Caption) * Prompt: \"Describe this image in extreme detail. Start with the main subject, then describe the background, lighting, colors, and artistic style. Mention any specific interactions between objects.\"   Supplementary optimization Prompt (for better detail capture): \"Describe this image in extreme detail. First, describe the main subject's appearance (shape, color, texture), then the background scene, lighting effects (brightness, color temperature), color matching, and artistic style. Finally, mention the interactions between objects and the overall atmosphere of the image.\" * Purpose: Adapt to GenAI model training (e.g., Sora, SD3, Ideogram)\u2014such models need detailed descriptions to learn image detail features, logical relations, and scene atmosphere to generate high-precision, instruction-compliant images. Also suitable for scenarios requiring precise visual-text alignment (e.g., visual QA, image editing). * Expected Output: \"A dynamic wide-angle shot of a fluffy golden retriever running joyfully across a green lawn. The dog's fur is illuminated by the warm, golden light of a setting sun, with some light brown strands glinting in the sunlight. Its ears flop backward as it runs, and its tail is raised high, showing a happy mood. In the blurred background, the iconic iron lattice structure of the Eiffel Tower rises against a gradient sky of purple and orange, with a few wispy clouds floating nearby. The lawn is dotted with small white clover flowers, and the overall atmosphere of the image is warm and lively, with soft focus on the dog and a blurred background that highlights the main subject.\"   Output characteristics: Length typically 50-200 words, covering core object details, background scene, lighting, color, artistic style, object interactions, and overall atmosphere\u2014detail-rich, high visual-text alignment precision.</p> <p>Supplementary tip: Besides the above two strategies, \"task-oriented Prompts\" can be designed, e.g., for e-commerce images (\"Describe this product image in detail, focusing on the product's appearance, color, size, texture, and placement, suitable for e-commerce promotion\"), for document images (\"Describe this document image in detail, including the text content, layout, font style, and color of the text\"), to further improve description relevance.</p>"},{"location":"en/part3/3_2_recaptioning/#723-engineering-implementation-building-high-throughput-inference-service-with-vllm","title":"7.2.3 Engineering Implementation: Building High-Throughput Inference Service with vLLM","text":"<p>For large-scale data recaptioning (e.g., processing billion-scale image datasets), ordinary HuggingFace <code>generate()</code> is far insufficient\u2014slow inference, low throughput, unable to efficiently utilize GPU resources. A single GPU can only process thousands of images per day; large-scale processing would consume significant time and hardware cost. Therefore, we need dedicated large model inference engine\u2014vLLM, which supports PagedAttention and Continuous Batching, two core optimization techniques that can improve VLM inference throughput 3-5x while reducing GPU VRAM usage, achieving efficient, large-scale image recaptioning.</p> <p>vLLM is a high-efficiency large model inference engine developed by UC Berkeley research team. Core advantages are \"high throughput, low latency, high GPU utilization,\" perfectly suited for deploying LLaVA, CogVLM and other mainstream VLMs, with API interface compatible with HuggingFace and minimal migration cost.</p> <p>Below is the core code for deploying LLaVA-1_5-7b-hf with vLLM for high-throughput image recaptioning, including model initialization, Prompt template design, batch processing, and output extraction\u2014complete workflow with key parameter interpretation and optimization tips:</p> <p></p><pre><code>from vllm import LLM, SamplingParams\nfrom PIL import Image\nimport os\nfrom tqdm import tqdm  # For displaying batch processing progress\n\n# Initialize vLLM inference engine\n# tensor_parallel_size=4: Use 4 GPUs for tensor parallelism, for large models (7B/13B) deployment, adjust based on GPU count (1, 2, 4, 8)\n# Note: Tensor parallelism requires multiple same-model GPUs with NVLink support for faster data transfer\n# trust_remote_code=True: Allow loading LLaVA custom code (e.g., vision-language fusion module), as LLaVA architecture is non-standard HuggingFace\n# model: Model name from HuggingFace Hub (e.g., llava-hf/llava-1_5-7b-hf, llava-hf/llava-1_5-13b-hf)\n# gpu_memory_utilization=0_9: Set GPU VRAM utilization to 90%, balance throughput and stability, avoid OOM\nllm = LLM(\n    model=\"llava-hf/llava-1_5-7b-hf\",\n    tensor_parallel_size=4,\n    trust_remote_code=True,\n    gpu_memory_utilization=0_9\n)\n\n# Define Prompt template (LLaVA requires specific dialogue format, otherwise affects instruction following)\n# Tip: Adding \"Analyze the image\" in Prompt often works better than \"Describe the image\"\n# because \"Analyze\" guides model to observe image details more carefully, reducing perfunctory descriptions\n# Here using detailed description template, can replace with brief description template as needed\nprompt_template = \"USER: &lt;image&gt;\\nAnalyze this image and describe it in extreme detail. Start with the main subject, then describe the background, lighting, colors, and artistic style. Mention any specific interactions between objects. ASSISTANT:\"\n\n# Configure sampling parameters for description quality and stability\n# temperature=0_2: Lower randomness (0-1 range), lower temperature = more stable, image-fitting descriptions, fewer hallucinations\n# For more diverse descriptions, adjust to 0_5-0_7; if too high (&gt;0_8), likely to produce image-unrelated hallucinations\n# max_tokens=256: Limit output length, prevent overly verbose descriptions\n# top_p=0_95: Nucleus sampling, keep only tokens with cumulative probability to 95%, further reduce hallucination risk\nsampling_params = SamplingParams(\n    temperature=0_2,\n    max_tokens=256,\n    top_p=0_95\n)\n\ndef load_image_batch(image_dir, batch_size=32):\n    \"\"\"\n    Batch load images for efficient processing\n    image_dir: Image folder path, all images in this folder\n    batch_size: Images per batch, adjust based on GPU VRAM (16, 32, 64), larger VRAM = larger batch_size\n    return: Batch image list (PIL.Image format) and corresponding image path list\n    \"\"\"\n    image_paths = [os.path.join(image_dir, f) for f in os.listdir(image_dir) if f.endswith(('jpg', 'png', 'jpeg'))]\n    image_batches = []\n    path_batches = []\n\n    # Load images in batches\n    for i in range(0, len(image_paths), batch_size):\n        batch_paths = image_paths[i:i+batch_size]\n        batch_images = []\n        for path in batch_paths:\n            try:\n                # Load image and convert to RGB (avoid model errors from grayscale/transparent images)\n                img = Image.open(path).convert('RGB')\n                batch_images.append(img)\n            except Exception as e:\n                print(f\"Failed to load image {path}: {e}\")\n                continue\n        if batch_images:  # Skip empty batches\n            image_batches.append(batch_images)\n            path_batches.append(batch_paths)\n    return image_batches, path_batches\n\ndef process_batch(image_batch):\n    \"\"\"\n    Process a batch of images, generate corresponding recaption text\n    image_batch: List[PIL.Image], batch image list\n    return: List[str], recaption text list for each image\n    \"\"\"\n    # Generate corresponding Prompt for each image\n    prompts = [prompt_template for _ in range(len(image_batch))]\n\n    # vLLM supports direct multi_modal_data input, no manual image format conversion needed\n    # This step is non-blocking; vLLM internally does Continuous Batching for efficient GPU utilization\n    # When one batch completes partially, immediately load next batch partial data to avoid GPU idle\n    outputs = llm.generate(\n        prompts, \n        sampling_params, \n        multi_modal_data={\"image\": image_batch}\n    )\n\n    # Extract generated description text, remove Prompt part, keep only model response\n    captions = []\n    for output in outputs:\n        # Extract content after ASSISTANT: as model-generated description\n        caption = output.outputs[0].text.strip().replace(\"ASSISTANT:\", \"\").strip()\n        captions.append(caption)\n    return captions\n\ndef save_captions(image_paths, captions, save_path):\n    \"\"\"\n    Save recaption text corresponding to image paths for subsequent use (e.g., model training)\n    image_paths: Image path list\n    captions: Recaption text list\n    save_path: Save file path (txt format)\n    \"\"\"\n    with open(save_path, 'w', encoding='utf-8') as f:\n        for path, cap in zip(image_paths, captions):\n            # Format: image_path\\trecaption_text, for easy reading and parsing\n            f.write(f\"{path}\\t{cap}\\n\")\n\n# Main function: batch process images and generate recaptions\nif __name__ == \"__main__\":\n    image_dir = \"path/to/your/image/directory\"  # Replace with your image folder path\n    save_path = \"recaption_results.txt\"        # Recaption results save path\n    batch_size = 32                            # Images per batch, adjust based on GPU VRAM\n\n    # Load image batches\n    image_batches, path_batches = load_image_batch(image_dir, batch_size)\n\n    # Batch process and save results\n    with open(save_path, 'w', encoding='utf-8') as f:\n        for img_batch, path_batch in tqdm(zip(image_batches, path_batches), total=len(image_batches)):\n            captions = process_batch(img_batch)\n            # Write current batch results\n            for path, cap in zip(path_batch, captions):\n                f.write(f\"{path}\\t{cap}\\n\")\n    print(f\"Recaptioning complete, results saved to {save_path}\")\n</code></pre> Supplementary engineering optimization tips:<p></p> <ul> <li>Image Preprocessing: When batch loading, uniformly resize images (e.g., to 224\u00d7224 or 448\u00d7448) to avoid model inference speed fluctuation and VRAM instability from image size differences; normalize images to improve description precision.</li> <li>Error Handling: Add exception handling for image load failure and model inference failure to avoid batch processing interruption; for failed images, record path and process separately.</li> <li>Hardware Optimization: Prefer NVIDIA A100, A800 for deployment; VRAM at least 24GB (7B model); for very large scale, use GPU cluster and vLLM distributed inference for higher throughput.</li> <li>Prompt Caching: For same-type images (e.g., batch e-commerce posters), cache Prompt template to avoid repeated generation and improve processing speed.</li> </ul>"},{"location":"en/part3/3_2_recaptioning/#73-ocr-enhancement-extract-and-fuse-text-from-images","title":"7.3 OCR Enhancement: Extract and Fuse Text from Images","text":"<p>While ordinary VLMs have certain visual understanding and can recognize objects, scenes, and simple text in images, they face two core problems with dense-text images (documents, posters, charts, PDF screenshots): first, low text recognition precision, prone to misrecognition and omission (especially artistic fonts, blurry text); second, unable to effectively associate text with visual elements, causing descriptions to omit text meaning and role.</p> <p>For example, an e-commerce poster with large text \"Summer Sale 50% Off\" may get only \"A red promotional poster\" from ordinary VLM\u2014completely ignoring text. Even when text is recognized, errors like \"Summer Sale 30% Off\" may occur. Yet text is crucial for recaptioning such images\u2014it directly determines core meaning and purpose.</p> <p>Best practice is to introduce dedicated OCR engine (e.g., PaddleOCR, Tesseract) as VLM's \"external brain.\" Use OCR to precisely extract image text, then dynamically fuse with VLM Prompt, letting VLM combine text to generate more accurate, richer descriptions\u2014significantly improving recaption quality for document and poster-class rich-text images.</p> <p>OCR (Optical Character Recognition) technology's core is converting printed and handwritten text in images to editable text. Its text recognition precision far exceeds ordinary VLM, especially for dense text and complex font scenarios. Currently, the most widely used industrial, open-source, free, and high-precision OCR engine is PaddleOCR (Baidu PaddlePaddle open-source OCR). It supports multilingual, multi-font, blurry text recognition, fast inference, simple deployment, GPU acceleration\u2014very suitable for combination with VLM.</p> <p> Figure 7-2: OCR Enhancement Pipeline</p> <p>Chart Core Interpretation: Figure 7-2 shows the complete OCR-enhanced VLM recaption flow. Core is \"OCR extract text \u2192 context construction \u2192 Prompt fusion \u2192 VLM generate description,\" supplementing VLM's text recognition weakness with OCR to achieve \"visual details + text information\" dual-precise description.</p>"},{"location":"en/part3/3_2_recaptioning/#731-ocr-enhancement-pipeline","title":"7.3.1 OCR Enhancement Pipeline","text":"<p>OCR enhancement core is organically fusing OCR-extracted text with VLM Prompt, not simple concatenation. The entire pipeline has three core steps, each with clear optimization direction to ensure text effectively improves recaption quality:</p> <ol> <li>Detection and Recognition: Use PaddleOCR to process raw image\u2014first detect all text regions (Bounding Box for text position), then recognize each region, output recognized text and confidence (0-1, higher = more accurate). Core goal: \"precise text extraction, filter wrong recognition\"\u2014filter low-confidence results to avoid misleading VLM.</li> <li>Context Construction: Concatenate all valid OCR text (after filtering low confidence) by actual image position (top-to-bottom, left-to-right, multi-column by column order) to build human-readable text context. Optionally classify text (e.g., title, body, button text) for VLM to understand hierarchy and role. E.g., poster text \"Summer Sale\" (title), \"50% Off\" (subtitle), \"June 1 - June 10\" (time) concatenates to \"Summer Sale, 50% Off, June 1 - June 10\" with title/body labels.</li> <li>Prompt Fusion: Naturally integrate constructed text context into VLM Prompt, explicitly telling VLM \"the image contains these texts, please describe combining text and visual elements,\" guiding VLM to associate text with visuals (position, color, font style, text meaning vs. scene). Key is \"natural fusion, no redundancy\"\u2014avoid awkwardly appending text to Prompt end, causing VLM to ignore visual details.</li> </ol> <p>Supplementary Note: Pipeline optimization focuses on \"confidence filtering\" and \"Prompt fusion\"\u2014without filtering low-confidence text, wrong text misleads VLM; if Prompt fusion is awkward, VLM separates text from visuals, failing to achieve true enhancement.</p>"},{"location":"en/part3/3_2_recaptioning/#732-core-code-ocr-result-injection","title":"7.3.2 Core Code: OCR Result Injection","text":"<p>Below is the core code for using PaddleOCR to extract image text and dynamically fuse into VLM Prompt. It can seamlessly integrate with Section 7.2.3 vLLM batch processing for OCR-enhanced large-scale image recaptioning. The code includes complete logic for text extraction, confidence filtering, context construction, Prompt fusion, plus key parameter interpretation and optimization tips:</p> <pre><code>from paddleocr import PaddleOCR\nimport os\nfrom PIL import Image\n\n# Initialize OCR engine (recommend GPU for speed; set use_gpu=False if no GPU)\n# use_angle_cls=True: Enable text direction detection, supports tilted text (e.g., tilted poster, rotated documents) to avoid recognition errors\n# lang='en': English recognition; for Chinese set lang='ch'; supports Chinese-English mixed (lang='ch_en')\n# det_model_dir, rec_model_dir: Can specify OCR detection/recognition model paths; auto-download if not specified\n# gpu_mem=500: GPU VRAM limit (MB), adjust based on GPU\nocr = PaddleOCR(\n    use_angle_cls=True,\n    lang='en',\n    use_gpu=True,\n    gpu_mem=500)\n\ndef generate_ocr_enhanced_prompt(image_path, base_prompt=\"Describe this image in detail.\"):\n    \"\"\"\n    Generate OCR-enhanced VLM Prompt, integrating OCR-extracted text into Prompt\n    image_path: Raw image path\n    base_prompt: Base Prompt (e.g., brief/detailed description) as Prompt body\n    return: Complete OCR-enhanced Prompt; if no valid text, return base Prompt\n    \"\"\"\n    # Step 1: Run OCR, extract image text and confidence\n    # result is nested list: [[[[x1,y1], [x2,y2], [x3,y3], [x4,y4]], [text, confidence]], ...]\n    # [x1,y1]~[x4,y4] are Bounding Box coordinates (top-left, top-right, bottom-right, bottom-left)\n    # text is recognized content, confidence is recognition confidence\n    result = ocr.ocr(image_path, cls=True)\n\n    # Handle OCR result: if no text or empty, fall back to base Prompt\n    if not result or not result[0]:\n        return f\"USER: &lt;image&gt;\\n{base_prompt}\\nASSISTANT:\"\n\n    # Step 2: Extract valid text (filter low confidence), build text context\n    detected_texts = []\n    for line in result[0]:\n        text = line[1][0]  # Recognized text\n        confidence = line[1][1]  # Recognition confidence\n        # Filter results below 0_8 confidence (threshold adjustable, 0_7-0_9 based on image text clarity)\n        # Also filter empty text and meaningless garbage (e.g., symbols only, spaces)\n        if confidence &gt; 0_8 and text.strip() and len(text.strip()) &gt; 1:\n            detected_texts.append(text.strip())\n\n    # Build text context: concatenate by recognition order, comma-separated, human-readable\n    ocr_context = \", \".join(detected_texts)\n\n    # Step 3: Dynamically fuse OCR result with base Prompt, generate enhanced Prompt\n    # Key technique: Tell model \"I have detected these texts...\" so model knows this is image text\n    # and guide model to associate text with visuals (position, color, font, text meaning vs. scene)\n    if len(ocr_context) &gt; 10:  # Only enhance when text long enough (&gt;10 chars) to avoid redundancy\n        enhanced_prompt = (\n            f\"USER: &lt;image&gt;\\n\"\n            f\"I have detected these text segments in the image: '{ocr_context}'. \"\n            f\"Using this text as a reference, describe the image in detail, \"\n            f\"paying attention to how the text relates to the visual elements (such as the position, color, and font style of the text, \"\n            f\"and the connection between the text content and the image scene). {base_prompt}\\n\"\n            f\"ASSISTANT:\"\n        )\n        return enhanced_prompt\n    else:\n        # If text too short (1-2 words), don't enhance, avoid redundancy, fall back to base Prompt\n        return f\"USER: &lt;image&gt;\\n{base_prompt}\\nASSISTANT:\"\n\n# Test code: verify OCR-enhanced Prompt generation\nif __name__ == \"__main__\":\n    # Test image path (replace with your rich-text image, e.g., poster, document screenshot)\n    test_image_path = \"path/to/your/test/poster.jpg\"\n    # Base Prompt (detailed description template)\n    base_prompt = \"Describe this image in extreme detail. Start with the main subject, then describe the background, lighting, colors, and artistic style.\"\n    # Generate enhanced Prompt\n    enhanced_prompt = generate_ocr_enhanced_prompt(test_image_path, base_prompt)\n    print(\"OCR-enhanced Prompt:\")\n    print(enhanced_prompt)\n</code></pre> <p>Supplementary Optimization Tips:</p> <ul> <li>Confidence Threshold Adjustment: For clear-text images (HD documents, formal posters), adjust to 0_8-0_9 to filter few errors; for blurry, complex-font images (old posters, handwriting), adjust to 0_7-0_8 to avoid missing valid text.</li> <li>Text Context Optimization: For multi-column, hierarchical text (title, body, footnote), use Bounding Box coordinates to classify and concatenate, e.g., \"Title: Summer Sale; Body: 50% Off, June 1 - June 10; Footnote: Final interpretation right reserved,\" for clearer VLM text hierarchy understanding.</li> <li>Prompt Fusion Optimization: Adjust fusion wording by image type\u2014document images add \"Describe the layout of the text and the relationship between the text and the document structure,\" poster images add \"Describe the font style of the text and the role of the text in the promotional scene\" for more targeted descriptions.</li> <li>Multi-OCR Engine Fusion: For extremely high precision requirements, use both PaddleOCR and Tesseract, take intersection of results for higher text recognition precision.</li> </ul> <p>Practical Benefits: OCR enhancement significantly improves recaption quality for rich-text images. Typical comparison:</p> <ul> <li>Ordinary VLM (no OCR) on e-commerce poster: \"A red promotional poster with a white background, featuring some vague text and a button at the bottom.\"</li> <li>OCR-enhanced VLM: \"A promotional red poster with a white background, featuring the text 'SUMMER SALE 50% OFF' in large white bold letters at the top center of the poster, and 'Shop Now' in a small blue button at the bottom right. The text 'SUMMER SALE' is in a decorative font, with a yellow shadow effect that makes it stand out. The overall layout is simple and eye-catching, focusing on highlighting the promotional information. The background is plain white, which makes the red poster and white text more prominent.\"</li> </ul> <p>This difference is crucial for training models that generate accurate text (Ideogram, SD3, document generation models)\u2014recaptions with precise text let models learn \"visual presentation of text\" and \"text-scene association,\" generating more compliant images. For visual QA and image retrieval, OCR-enhanced descriptions also improve task precision and model understanding of image core meaning.</p>"},{"location":"en/part3/3_3_video_audio/","title":"Chapter 8: Video & Audio Data","text":""},{"location":"en/part3/3_3_video_audio/#chapter-8-video-and-audio-data-processing","title":"Chapter 8: Video and Audio Data Processing","text":""},{"location":"en/part3/3_3_video_audio/#chapter-summary","title":"Chapter Summary","text":"<p>Video data is the modality with the largest volume, highest processing difficulty, and most complex information density in multimodal large model (LMM) training, referred to as the \"deep water\" of multimodal engineering. Unlike static images, video introduces the Temporal Dimension, meaning data is not merely pixel stacking but carries causal logic, physical laws, and motion patterns.</p> <p>This chapter systematically breaks down how to transform continuous, unstructured video streams into discrete tokens the model can understand. We will start from the underlying Shot Boundary Detection, analyze content-based segmentation algorithms in depth; then analyze the \"heart\" of video generation\u2014Video Tokenizer, comparing underlying principles of VQ-VAE and Google DeepMind's latest MagViT-v2; finally, we will demonstrate how to use WhisperX to achieve word-level and even phoneme-level precise alignment of audio and video, building spatio-temporally synchronized supervision signals for the model.</p> <p>Learning Objectives: * Engineering Capability: Master using PySceneDetect combined with ffmpeg keyframe metadata for efficient two-stage scene segmentation (Coarse-to-Fine) strategy. * Theoretical Depth: Deeply understand the \"Codebook Collapse\" problem in Video Tokenization, and how MagViT-v2 completely solves this bottleneck through Lookup-Free Quantization (LFQ). * Data Pipeline: Implement WhisperX-based Forced Alignment flow to solve precise subtitle alignment for multi-speaker, background noise acoustic environments. * Storage Optimization: Understand storage sharding and efficient loading for massive video data.</p> <p>Scenario Introduction:</p> <p>\"Imagine you are training a world model like Sora. You have downloaded the 2-hour movie Titanic as training data.</p> <p>If you simply split by every 10 seconds, you'll encounter severe 'semantic discontinuity': the first 5 seconds of a segment might be calm sea breeze on deck, the next 5 seconds suddenly jump to a noisy restaurant. This cross-scene 'hard cut' will confuse the model: 'How did the person teleport from outdoors to indoors in 0.1 seconds?' This not only wastes compute but teaches the model wrong physics.</p> <p>Furthermore, audio temporal precision is life. If your subtitles lag 2 seconds behind the picture, when Rose's mouth is moving on screen, the corresponding token is Jack's dialogue. The model will incorrectly associate 'Jack's voice features' with 'Rose's facial features.' In trillion-token training, such subtle misalignment can amplify into severe hallucinations.\"</p>"},{"location":"en/part3/3_3_video_audio/#81-video-processing-pipeline-scene-detection","title":"8.1 Video Processing Pipeline: Scene Detection","text":"<p>Video is fundamentally not a continuous stream but a sequence of independent \"shots\" concatenated together. Each shot represents one camera turn-on and turn-off (or continuous camera movement). Training video generative models (Video Generative Models) requires each training sample (Training Clip) to be within the same shot, ensuring Spatio-Temporal Continuity.</p>"},{"location":"en/part3/3_3_video_audio/#811-micro-view-of-video-structure-gop-and-i-frames","title":"8.1.1 Micro-view of Video Structure: GOP and I-Frames","text":"<p>Before diving into segmentation algorithms, we need to understand the basics of video encoding.</p> <ul> <li>I-Frame (Intra-coded picture): Keyframe. It is a complete image that can be decoded without depending on other frames. Usually also the starting point of scene transitions.</li> <li>P-Frame (Predicted picture): Forward-predicted frame. Only stores the difference from the previous frame.</li> <li>B-Frame (Bi-predictive picture): Bi-directional predicted frame. References both past and future frames for compression, highest compression ratio.</li> </ul> <p>GOP (Group of Pictures): The sequence between two I-frames. When a video player seeks, it typically \"snaps\" to the nearest I-frame because decoding must start there. Our segmentation strategy must leverage this to accelerate.</p>"},{"location":"en/part3/3_3_video_audio/#812-algorithm-selection-and-strategy","title":"8.1.2 Algorithm Selection and Strategy","text":"<p> Figure 8-1: Two Video Scene Segmentation Strategies and HSV Histogram Difference</p> <p>PySceneDetect is the industry-standard open-source tool. It provides multiple detectors, with core logic based on inter-frame difference analysis:</p> <ul> <li> <p>Strategy One: Threshold Detector (Hard Cut)</p> <ul> <li>Principle: Compute average difference (Delta) between adjacent frames in HSV color space or RGB brightness. When Delta &gt; <code>threshold</code> (e.g., 30_0), mark as cut point.</li> <li>Applicable: Most movies and user-generated content (UGC).</li> <li>Limitation: Cannot detect gradual transitions.</li> </ul> </li> <li> <p>Strategy Two: Adaptive Detector (Gradual Transitions / Fast Cut)</p> <ul> <li>Principle: No longer uses fixed threshold; maintains a sliding window. Compares ratio of \"current frame\" vs. \"average frame difference within window.\"</li> <li>Applicable: Fade in/out, dissolve, or action scenes with intense camera movement.</li> </ul> </li> </ul> <p>Advanced Strategy: Two-Stage Cascade Splitting Running PySceneDetect on full decoded TB-scale video is very slow. We recommend the industrial \"coarse then fine\" approach:</p> <ol> <li>Level-1 (Metadata Scan): Use <code>ffprobe</code> to quickly scan video stream metadata, extract all I-Frame timestamps. I-frames often appear at scene transitions (encoders tend to insert I-frames at abrupt changes). This step requires no frame decoding; speed is 100x+ over playback.</li> <li>Level-2 (Content Analysis): Only run PySceneDetect's <code>ContentDetector</code> for precise frame-level localization within \u00b12 seconds of Level-1 identified potential cut points.</li> </ol>"},{"location":"en/part3/3_3_video_audio/#813-core-code-scene-detection-and-lossless-segmentation","title":"8.1.3 Core Code: Scene Detection and Lossless Segmentation","text":"<p>The code below demonstrates the standard segmentation flow in production. Note the \"stream copy\" technique\u2014key to avoiding storage explosion when processing massive video.</p> <pre><code>from scenedetect import detect, ContentDetector, split_video_ffmpeg\nimport os\nimport logging\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')\n\ndef process_video_scenes(video_path, output_dir, threshold=27_0):\n    \"\"\"\n    Detect scenes and cut video with ffmpeg losslessly\n    Args:\n        video_path: Input video path\n        output_dir: Output directory\n        threshold: Segmentation threshold (empirical: 27_0 works for most 1080p video)\n    \"\"\"\n    if not os.path.exists(output_dir):\n        os.makedirs(output_dir)\n\n    logging.info(f\"Starting scene detection for: {video_path}\")\n\n    # 1. Scene detection\n    # threshold=27_0: HSV space histogram difference threshold\n    # min_scene_len=15: Ignore segments shorter than 0.5s (30fps).\n    # Very short segments are usually flash, glitch, or segmentation noise\u2014unsuitable for training data.\n    scene_list = detect(\n        video_path, \n        ContentDetector(threshold=threshold, min_scene_len=15)\n    )\n\n    # 2. Statistics and filtering\n    # Add logic here: e.g., merge overly short adjacent scenes, or discard scenes under 3 seconds\n    valid_scenes = []\n    for scene in scene_list:\n        start, end = scene\n        duration = (end.get_frames() - start.get_frames()) / start.get_framerate()\n        if duration &gt;= 3_0: # Keep only segments &gt;3s for training\n            valid_scenes.append(scene)\n\n    logging.info(f\"Detected {len(scene_list)} scenes, kept {len(valid_scenes)} valid scenes.\")\n\n    # 3. Split video (Stream Copy)\n    # Key: arg_override='-c:v copy -c:a copy'\n    # This instructs ffmpeg to directly copy the binary stream without [decode -&gt; pixels -&gt; encode].\n    # Benefit 1: Extremely fast (limited by disk I/O, not CPU).\n    # Benefit 2: 100% lossless quality, no re-encoding artifacts.\n    split_video_ffmpeg(\n        video_path, \n        valid_scenes, \n        output_dir=output_dir, \n        show_progress=True,\n        arg_override='-c:v copy -c:a copy' \n    )\n\n# Pitfall: Data storage explosion disaster\n# NEVER decode segmented video into image sequences (png/jpg) or numpy arrays for long-term storage!\n# Do the math:\n# 1 hour 1080p H.264 video \u2248 2GB\n# Decoded: 3600s * 30fps * 1920 * 1080 * 3 bytes \u2248 670 GB\n# Expansion factor &gt; 300x.\n# Always store in compressed format (mp4/mkv), only use GPU (NVDEC) for real-time decoding in training DataLoader __getitem__.\n</code></pre>"},{"location":"en/part3/3_3_video_audio/#82-video-tokenization-from-pixel-ocean-to-discrete-islands","title":"8.2 Video Tokenization: From Pixel Ocean to Discrete Islands","text":"<p>For Sora, Gen-2 and other Transformer-based diffusion models (DiT), modeling directly in pixel space is infeasible. A 4-second 1080p video contains about \\(3 \\times 10^8\\) pixels; computing the attention matrix would cause instant OOM.</p> <p>Therefore, video must first be \"compressed\" into discrete tokens in latent space. This process is done by Video Tokenizer.</p>"},{"location":"en/part3/3_3_video_audio/#821-traditional-approach-pain-vq-vae-and-dead-codes","title":"8.2.1 Traditional Approach Pain: VQ-VAE and \"Dead Codes\"","text":"<p>VQ-VAE (Vector Quantized Variational AutoEncoder) is the foundation of early video generative models (e.g., VideoGPT).</p> <ul> <li> <p>Flow:</p> <ol> <li>Encoder: Split video into 3D patches (e.g., \\(16 \\times 16 \\times 16\\) spatio-temporal blocks), compress to low-dimensional vectors \\(z_e(x)\\).</li> <li>Quantization: Maintain a Codebook with \\(K\\) prototype vectors (Embeddings). For each \\(z_e(x)\\), find the nearest vector \\(e_k\\) in Codebook by Euclidean distance to replace it.</li> <li>Decoder: Use \\(e_k\\) to reconstruct video.</li> </ol> </li> <li> <p>Fatal flaw: Codebook Collapse     Early in training, only a few codes (e.g., Code #5 and #100) are accidentally selected. Since only selected codes receive gradient updates, they become \"better\" and easier to be selected again. This forms a \"rich get richer\" Matthew effect.</p> <ul> <li>Consequence: 90% of Codebook vectors become \"dead codes,\" never used. This leads to extremely low effective vocabulary, generating blurry and detail-lacking video.</li> <li>Remediation: Traditional methods require complex Reset strategies (e.g., k-means reset), training extremely unstable.</li> </ul> </li> </ul>"},{"location":"en/part3/3_3_video_audio/#822-sota-approach-magvit-v2-and-lfq","title":"8.2.2 SOTA Approach: MagViT-v2 and LFQ","text":"<p>Google DeepMind introduced LFQ (Lookup-Free Quantization) in MagViT-v2, fundamentally changing the game.</p> <ul> <li> <p>Core idea: No lookup, direct computation.     LFQ abandons the \"find nearest neighbor\" approach and directly generates tokens from the sign of latent variables.</p> </li> <li> <p>Mathematical principle:     Assume Encoder output latent vector \\(z \\in \\mathbb{R}^D\\) (e.g., \\(D=18\\)).     LFQ binarizes each dimension:     $\\(q_i = \\begin{cases} 1 &amp; \\text{if } z_i &gt; 0 \\\\ 0 &amp; \\text{if } z_i \\le 0 \\end{cases}\\)$</p> <p>Then combine the \\(D\\) binary bits into an integer index: $\\(\\text{Token ID} = \\sum_{i=0}^{D-1} q_i \\cdot 2^i\\)$</p> </li> <li> <p>Why is LFQ revolutionary?</p> <ol> <li>Infinite effective codebook: If \\(D=18\\), the natural codebook size is \\(2^{18} = 262,144\\). All codes are combinations of \\(D\\) independent dimensions; each dimension always participates in gradient updates. Codebook utilization is constant at 100%.</li> <li>Zero compute cost: No expensive \"full codebook distance computation\"\u2014only simple bit operations.</li> <li>Spatio-temporal compression: MagViT-v2 combines 3D Causal CNN, preserving temporal causality while compressing space (current token never leaks future information), critical for generative models.</li> </ol> </li> </ul>"},{"location":"en/part3/3_3_video_audio/#823-architecture-comparison-table","title":"8.2.3 Architecture Comparison Table","text":"Feature VQ-VAE (TATS/VideoGPT) MagViT-v2 (LFQ) Quantization Mechanism Nearest Neighbor Search (lookup) Sign Function (sign projection) Vocabulary Size (Vocab) Typically 1024 - 8192 (limited by VRAM and collapse) \\(2^{18}\\) (262k) or larger, easily extensible Codebook Utilization Low (prone to collapse, needs EMA etc.) 100% (design avoids collapse) Gradient Backprop Requires Straight-Through Estimator (STE) Improved Entropy Penalty + STE Generation Quality Prone to blur, detail texture loss Extremely clear, even better than original (denoising effect) Inference Speed Slower (especially with large codebook) Extremely fast --- <p>The evolution from VQ-VAE to MagViT-v2 is not simple parameter optimization but a paradigm shift in video discretization technology\u2014from \"search-based approximation\" to \"computation-based construction.\"</p> <p>First, in computational complexity and scalability, traditional VQ-VAE has fundamental bottlenecks. Its quantization depends on nearest neighbor search, requiring computing Euclidean distance between feature vectors and all \\(K\\) prototypes in the codebook\u2014time complexity \\(O(K)\\). This means expanding vocabulary to improve representation directly causes linear growth in inference latency. In contrast, MagViT-v2's LFQ (Lookup-Free Quantization) abandons lookup, using the sign function to project latent variables to binary strings. This process reduces compute complexity to constant \\(O(1)\\), enabling the model to support \\(2^{18}\\) or larger vocabulary without sacrificing inference speed, resolving the contradiction between large vocabulary and low latency.</p> <p>Second, in codebook utilization and training stability, the two differ markedly. VQ-VAE has long suffered from \"Codebook Collapse\"\u2014some encoding vectors never activate due to initialization or uneven gradient allocation, causing effective vocabulary to be far below design (often only 1024-8192). This forces researchers to introduce EMA (exponential moving average) or k-means reset and other complex engineering tricks. MagViT-v2's LFQ, based on independent dimension binarization combination, mathematically guarantees that codebook space is \"combinatorially generated\" rather than \"discretely searched.\" As long as latent space dimensions stay active, the combined codes naturally cover the entire codebook space, achieving theoretical 100% utilization.</p> <p>In summary, MagViT-v2's LFQ achieves unification of high compression, high fidelity, and low compute cost, completely solving traditional VQ-VAE's defects in detail texture loss and poor spatio-temporal consistency. For building Sora-scale massive video generative models, MagViT-v2 and derived Tokenizer architectures have become the industry's preferred choice.</p>"},{"location":"en/part3/3_3_video_audio/#83-audio-alignment-whisperx-and-forced-alignment","title":"8.3 Audio Alignment: WhisperX and Forced Alignment","text":"<p>Video is not only visual data\u2014audio (Audio) provides natural, temporally dense text descriptions. Using audio, we can let the model learn multi-modal associations like \"explosion sound corresponds to explosion light,\" \"crying corresponds to tears.\"</p> <p>However, ordinary ASR (e.g., raw Whisper) only gives \"sentence-level\" timestamps, typically 1-2 second error. This is completely insufficient for fine video training (e.g., lip-sync). We need WhisperX.</p> <p> Figure 8-2: Precision Comparison of Ordinary ASR (Segment-level) vs WhisperX (Word/Phoneme-level)</p>"},{"location":"en/part3/3_3_video_audio/#831-why-forced-alignment","title":"8.3.1 Why Forced Alignment?","text":"<ul> <li>ASR (OpenAI Whisper):<ul> <li>Output: <code>\"Hello world\"</code> -&gt; <code>Timestamp: [0_0s -&gt; 2_0s]</code></li> <li>Problem: Model only knows the sentence falls within these 2 seconds, not exactly when \"world\" starts.</li> </ul> </li> <li>Forced Alignment (WhisperX):<ul> <li>Principle: First transcribe to text, then use a pre-trained acoustic model (e.g., Wav2Vec2) to forcibly match phonemes in the text with audio waveform.</li> <li>Output:<ul> <li><code>\"Hello\"</code>: <code>[0_12s -&gt; 0_58s]</code></li> <li><code>\"world\"</code>: <code>[0_85s -&gt; 1_45s]</code></li> </ul> </li> <li>Value: You can build training pairs like: when video frame is at 0_85s, force model to focus on \"world\" Text Embedding. This is the foundation for fine multimodal alignment.</li> </ul> </li> </ul>"},{"location":"en/part3/3_3_video_audio/#832-engineering-implementation-whisperx-full-pipeline","title":"8.3.2 Engineering Implementation: WhisperX Full Pipeline","text":"<p>WhisperX is a complex Pipeline combining VAD (voice activity detection), Whisper (transcription), Wav2Vec2 (alignment), and Pyannote (speaker diarization).</p> <pre><code>import whisperx\nimport gc\nimport torch\n\ndef align_audio_transcript(audio_file, device=\"cuda\", batch_size=16):\n    \"\"\"\n    Use WhisperX for transcription and word-level forced alignment\n    \"\"\"\n    # Step 1: Transcription\n    # Use Large-v2 model for transcript accuracy\n    # compute_type=\"float16\" significantly speeds up, but requires Ampere+ GPU (A100/A10/3090/4090)\n    print(\"1. Loading Whisper model...\")\n    model = whisperx.load_model(\n        \"large-v2\", \n        device, \n        compute_type=\"float16\" \n    )\n\n    print(\"2. Transcribing...\")\n    audio = whisperx.load_audio(audio_file)\n    result = model.transcribe(audio, batch_size=batch_size)\n\n    # Critical: VRAM management\n    # Whisper model is huge, and the next Alignment model is also VRAM-heavy.\n    # Must explicitly delete model and trigger garbage collection, otherwise easily OOM (Out of Memory).\n    del model\n    gc.collect()\n    torch.cuda.empty_cache()\n\n    # Step 2: Forced Alignment\n    # Auto-loads corresponding language Wav2Vec2 model (e.g., wav2vec2-large-960h for English)\n    print(\"3. Aligning...\")\n    model_a, metadata = whisperx.load_align_model(\n        language_code=result[\"language\"], \n        device=device\n    )\n\n    # align() executes a Dynamic Programming-like algorithm\n    # finding best matching path between text phoneme sequence and audio waveform features\n    aligned_result = whisperx.align(\n        result[\"segments\"], \n        model_a, \n        metadata, \n        audio, \n        device, \n        return_char_alignments=False # Set True for character-level alignment (e.g., for karaoke subtitles)\n    )\n\n    # Result contains word_segments with precise start/end for each word\n    # e.g.: [{'word': 'Hello', 'start': 0_1, 'end': 0_5, 'score': 0_98}, ...]\n    return aligned_result\n\n# Advanced tip:\n# For speaker diarization (who said what), further call:\n# diarize_model = whisperx.DiarizationPipeline(use_auth_token=\"YOUR_HF_TOKEN\", device=device)\n# diarize_segments = diarize_model(audio)\n# whisperx.assign_word_speakers(diarize_segments, aligned_result)\n</code></pre>"},{"location":"en/part3/3_3_video_audio/#833-production-environment-pitfalls","title":"8.3.3 Production Environment Pitfalls","text":"<ol> <li> <p>VAD Misjudgment and Background Music Interference:</p> <ul> <li>Problem: WhisperX heavily relies on VAD for segmenting silent segments. If video BGM is loud, VAD may treat entire segment as speech, or vice versa, drowning out speech.</li> <li>Solution: Introduce Demucs or Spleeter for source separation.</li> <li>Flow: <code>Raw Audio</code> -&gt; <code>Demucs (Extract Vocal Track)</code> -&gt; <code>WhisperX</code>. Feed only extracted pure vocal track to recognition for significantly higher accuracy.</li> </ul> </li> <li> <p>Multi-speaker Overlap (Overlapping Speech):</p> <ul> <li>Problem: Whisper weakly handles multiple people speaking simultaneously (Cocktail Party Problem), usually only transcribing the loudest person or generating confused text.</li> <li>Solution: Enable <code>diarization=True</code>. Though this adds 30%-50% inference time, for TV drama, interview-class video data it's the only way to distinguish \"who said what,\" avoiding model confusion of character identity.</li> </ul> </li> <li> <p>Hallucination Timestamps:</p> <ul> <li>Problem: Whisper may produce \"hallucinations\" during long silence or pure music segments\u2014repeating previous lyrics with wrong timestamp.</li> <li>Check: In post-processing, check <code>word['score']</code> (confidence). If a consecutive string of words has confidence below 0_4, recommend discarding that segment's alignment.</li> </ul> </li> </ol>"},{"location":"en/part4/4_1_sft_data/","title":"Chapter 9: Instruction Fine-tuning Data","text":""},{"location":"en/part4/4_1_sft_data/#chapter-9-instruction-fine-tuning-data-sft-data-building-the-models-code-of-conduct","title":"Chapter 9: Instruction Fine-Tuning Data (SFT Data) \u2014\u2014 Building the Model's \"Code of Conduct\"","text":""},{"location":"en/part4/4_1_sft_data/#chapter-summary","title":"Chapter Summary","text":"<p>This chapter delves into a critical phase in the lifecycle of Large Language Models (LLMs)\u2014the key transition from \"general pre-training\" to \"specific instruction following.\" We move beyond simple data collection to explore how to build high-quality SFT (Supervised Fine-Tuning) datasets through highly engineered Prompt systems and automated pipelines (Self-Instruct, Evol-Instruct). Beyond technical implementation, we also analyze the theoretical foundations: Why can a small amount of high-quality data unlock enormous model capabilities? We focus on addressing insufficient data diversity, inadequate instruction complexity, and missing reasoning ability, ultimately building an intelligent agent that understands both knowledge and rules.</p>"},{"location":"en/part4/4_1_sft_data/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Master iterative System Prompt engineering: Write System Prompts that control model output format, style, and depth; understand how role definition affects data distribution.</li> <li>Deep understanding of automated data generation pipelines: Reproduce and improve Self-Instruct and Evol-Instruct algorithms, build domain instruction sets from scratch, understand the \"teacher-student\" distillation logic behind them.</li> <li>Learn to construct Chain-of-Thought (CoT) data: Enhance model logic through explicit reasoning steps, breaking the \"black box\" mapping of Transformers.</li> <li>Design data filtering and deduplication mechanisms: Master advanced cleaning strategies from ROUGE deduplication to semantic vector clustering, ensuring quality and diversity of synthetic data.</li> </ul> <p>Scenario Introduction: \"Imagine your team has just finished pre-training a 70B parameter base model, consuming millions of dollars in compute and reading nearly all text on the internet. At this point, it's like a knowledgeable but introverted librarian, with a mind full of Shakespeare's plays, Python code, and quantum mechanics formulas. Yet when you excitedly type 'Please help me create a weight loss plan' at the demo, the model mechanically continues with '...is a good goal, usually including diet and exercise,' or even starts writing 'definition of weight loss plan,' then generates a pile of Wikipedia-style nonsense.</p> <p>Why does this happen? Because the base model's training objective is 'predict the next token'\u2014it doesn't understand the interaction pattern of 'instruction' and 'response.' To turn this 'scholar' into a personal assistant that understands your intent, you need to feed it thousands of high-quality Q&amp;A pairs, teaching it how to speak and how to solve problems step by step. But manually writing 100,000 instructions is expensive and slow, and human imagination is often limited to specific patterns. How can we automatically produce high-quality training data that is both complex and diverse without relying on large-scale human annotation? This is the core engineering challenge this chapter addresses.\"</p>"},{"location":"en/part4/4_1_sft_data/#91-core-concepts-and-principles-concepts-principles","title":"9.1. Core Concepts and Principles (Concepts &amp; Principles)","text":"<p>In the SFT phase, the industry has reached consensus: data quality matters far more than quantity. The data we need is not merely \"input-output\" pairs, but samples covering various task types, complexity levels, and reasoning patterns.</p>"},{"location":"en/part4/4_1_sft_data/#911-why-quality-matters-more-than-quantity-the-surface-form-hypothesis","title":"9.1.1 Why Quality Matters More Than Quantity? \u2014 The Surface Form Hypothesis","text":"<p>Many beginners mistakenly believe SFT is for \"learning new knowledge.\" However, based on findings from classic studies like LIMA (Less Is More for Alignment), the core role of SFT is not to inject knowledge, but to align format.</p> <p>The Surface Form Hypothesis posits that models have already acquired the vast majority of world knowledge and logical ability during pre-training. SFT merely teaches the model a specific \"interaction format\" or \"style\" to extract the latent capabilities from pre-training. In other words, if pre-training is like having the model read an entire library, SFT only teaches it how to answer in a tone humans prefer\u2014not the content of the books.</p> <p>This explains why model performance drops sharply once data contains errors, noise, or logical gaps\u2014because the model is learning \"how to index knowledge.\" If the index is wrong, no amount of knowledge can be correctly retrieved. Therefore, a few thousand high-quality, high-diversity samples often train better models than millions of low-quality, homogeneous samples.</p>"},{"location":"en/part4/4_1_sft_data/#912-engineering-perspective-on-prompt-engineering","title":"9.1.2 Engineering Perspective on Prompt Engineering","text":"<p>In data synthesis, Prompts are no longer simple dialogue inputs but the source code for generating data. We treat Prompts as programmable modules, controlling synthesized data distribution through iterative optimization. An excellent Prompt system typically includes:</p> <ul> <li>System Prompt: Defines the \"persona\" and \"boundaries\" of the data generator. This is not just assigning an identity\u2014it activates the model's latent domain-specific vocabulary distribution through role-playing. For example, playing \"strict lawyer\" vs. \"enthusiastic salesperson\" generates distinctly different sentence structures.</li> <li>Few-Shot Examples: Anchor output format and style through In-Context Learning. These examples serve as \"denoising,\" telling the model \"this is the standard answer I want.\"</li> <li>Negative Constraints: Explicitly prohibit the model from generating certain data patterns. In LLM generation, models tend to be lazy or use common clich\u00e9s; negative constraints are key to breaking this statistical inertia (e.g., \"Do not use 'Once upon a time there was a mountain' as story opening\").</li> </ul>"},{"location":"en/part4/4_1_sft_data/#913-automated-construction-methodology","title":"9.1.3 Automated Construction Methodology","text":"<p>To break through the bottleneck of human data, the industry has evolved two core strategies. Understanding their differences is crucial for building balanced datasets.</p> <ul> <li>Self-Instruct: Focuses on breadth. Uses strong models (e.g., GPT-4) to generate many new tasks from few seed tasks. Its core assumption: the model has seen enough task types; we only need to induce them through prompts.</li> <li>Evol-Instruct: Focuses on depth. Rewrites simple instructions into complex ones through specific evolution operators (e.g., \"add constraints,\" \"deepen reasoning\"). This directly addresses Self-Instruct's tendency to generate simple, short instructions, forcing the model to climb in logical complexity and constraint satisfaction.</li> </ul> <p> Figure 9-1: Self-Instruct vs. Evol-Instruct Comparison</p> <p>Table 9-1: Comparison of Mainstream Instruction Data Construction Strategies</p> Feature Manual Annotation Self-Instruct Evol-Instruct Core Goal Extremely high precision, domain-specific knowledge Increase task diversity Increase task complexity Cost Very high (\\(1-\\)10/item) Low ($0.01/item) Medium ($0.03/item, requires multi-round calls) Input Source Domain experts Seed task pool Existing simple instructions Operation Logic Expert authorship and review \"Generate a new task different from existing tasks\" \"Rewrite this task to be harder, e.g., add constraints\" Typical Operators/Methods Cleaning, review, crowdsourcing ROUGE deduplication, noun/verb filtering Deepening evolution, Breadth evolution Use Cases Core business logic, RLHF golden datasets General task coverage expansion, cold start Enhancing code, math, and logical reasoning Potential Risks Scale difficult; quality fluctuates due to fatigue Prone to homogeneous, simple instructions May generate overly complex or unsolvable \"hallucinated instructions\""},{"location":"en/part4/4_1_sft_data/#914-chain-of-thought-cot-data-breaking-the-reasoning-black-box","title":"9.1.4 Chain-of-Thought (CoT) Data: Breaking the Reasoning Black Box","text":"<p>CoT's core lies in breaking the \"input \u2192 output\" black-box mapping, forcing the model to make implicit reasoning explicit.</p> <p>From a cognitive science perspective, humans perform a series of intermediate computations mentally when solving complex problems (e.g., math). Although Transformer models are powerful, without CoT training they tend to guess answers directly\u2014like asking students to write the answer without showing their work, which is highly error-prone. CoT data activates the Transformer's intermediate computation layers, allowing it to allocate more compute to difficult problems by extending the generated token sequence (More compute time = More tokens generated).</p>"},{"location":"en/part4/4_1_sft_data/#915-data-format-standardization-data-formatting-standards","title":"9.1.5 Data Format Standardization (Data Formatting Standards)","text":"<p>Before engineering implementation, we must understand how data is \"fed\" to the model. This is not just a JSON parsing issue but relates to how the model understands conversation history. The industry mainly adopts ChatML (Chat Markup Language) format, which clearly distinguishes System, User, and Assistant boundaries and prevents prompt injection attacks.</p> <p>Note that during training, we typically only compute Loss on tokens in the <code>assistant</code> response, while masking <code>system</code> and <code>user</code> parts. This is because we want the model to learn \"how to answer,\" not \"how to ask.\"</p> <pre><code>// ChatML format example\n{\n  \"messages\": [\n    {\"role\": \"system\", \"content\": \"You are a helpful assistant.\"},\n    {\"role\": \"user\", \"content\": \"Explain quantum entanglement.\"},\n    {\"role\": \"assistant\", \"content\": \"Quantum entanglement is a phenomenon...\"}\n  ]\n}\n</code></pre>"},{"location":"en/part4/4_1_sft_data/#92-engineering-implementation-engineering-implementation","title":"9.2. Engineering Implementation (Engineering Implementation)","text":"<p>This section guides building a complete data synthesis pipeline, involving toolchain selection and pipeline stability design.</p>"},{"location":"en/part4/4_1_sft_data/#environmentdependencies","title":"Environment/Dependencies","text":"<ul> <li><code>langchain</code> / <code>langsmith</code>: For managing Prompt templates, LLM call chains, and tracking debugging.</li> <li><code>rouge_score</code>: For computing text similarity and deduplication.</li> <li><code>numpy / scikit-learn</code>: For vectorized deduplication (advanced), computing semantic distance via Embedding.</li> <li><code>openai</code> or <code>vllm</code>: For calling teacher models. vLLM is suitable for locally deployed high-throughput open-source teacher models (e.g., Mixtral-8x7B).</li> <li><code>chromadb</code> / <code>faiss</code>: Vector databases for large-scale deduplication and retrieval.</li> </ul>"},{"location":"en/part4/4_1_sft_data/#921-prompt-engineering-for-data-production","title":"9.2.1 Prompt Engineering for Data Production","text":"<p>In synthetic data engineering, Prompts must be highly robust. We adopt iterative thinking to refine the System Prompt, like developing software versions.</p>"},{"location":"en/part4/4_1_sft_data/#task-objective-construct-a-batch-of-instruction-data-for-training-a-financial-analysis-assistant","title":"Task Objective: Construct a batch of instruction data for training a \"Financial Analysis Assistant.\"","text":"<p>Step 1: Iteratively Write System Prompt * V1: Too simple, leading to data homogenization     * Defect analysis: Model-generated instructions tend to be very short and concentrated on basic concept explanations (e.g., \"What is a stock?\"). This reflects LLM's default tendency to generate \"high-probability, low-complexity\" text.     </p><pre><code># V1 Prompt - Poor performance\nsystem_prompt_v1 = \"\"\"\nYou are a financial expert. Please generate 5 questions and answers about finance.\n\"\"\"\n</code></pre><p></p> <ul> <li> <p>V2: Add structured requirements</p> <ul> <li>Improvement: Introduced JSON format requirements for easier parsing. Added \"role\" setting to guide style.</li> <li>Defect analysis: Although format is correct, content still lacks depth, no reasoning process. Model may only generate textbook-style definitions, not practical scenarios. <pre><code># V2 Prompt - Structural improvement\nsystem_prompt_v2 = \"\"\"\nYou are a Senior Financial Analyst with 20 years of experience.\nGenerate 5 pairs of instruction-response data focused on corporate finance.\nFormat the output as a JSON list.\nEach item should have: 'instruction', 'input' (optional), 'output'.\n\"\"\"\n</code></pre></li> </ul> </li> <li> <p>V3: Final production-ready version</p> <ul> <li>Improvement: Introduced Few-Shot, Negative Constraints, and Complexity Requirements. This is the standard paradigm used in industry.</li> <li>In-depth analysis: Through explicit \"Anti-Patterns,\" we cut off the model's path to generating \"nonsense.\" Exemplars are not just format references but anchors for thinking depth.</li> </ul> <p></p><pre><code># V3 Prompt - High robustness production version\nsystem_prompt_v3 = \"\"\"\n### ROLE\nYou are a Chief Market Strategist at a top-tier investment bank. Your goal is to train a junior analyst model. You demand precision, depth, and actionable insights.\n\n### OBJECTIVE\nGenerate 5 high-quality, complex instruction-following examples related to market analysis, risk management, or quantitative trading.\n\n### CONSTRAINTS\n1. **Complexity**: Do NOT ask simple definitional questions (e.g., \"What is a bond?\"). Instead, ask for scenario analysis, portfolio adjustments, or impact assessments.\n2. **Format**: Strictly output a valid JSON list.\n3. **Reasoning**: The 'output' must demonstrate step-by-step analytical reasoning before giving the conclusion.\n4. **Anti-Patterns**:\n   - Avoid generic advice like \"Consult a financial advisor.\"\n   - Avoid short, one-sentence responses.\n   - Avoid vague statements; use numbers and specific financial instruments where possible.\n\n### OUTPUT FORMAT\n[\n  {\n    \"instruction\": \"...\",\n    \"input_context\": \"...\" (can be null),\n    \"output\": \"...\"\n  }\n]\n\n### EXEMPLAR (One-Shot)\n[\n  {\n    \"instruction\": \"Given a portfolio heavily weighted in tech stocks (60%), analyze the impact of a sudden 50bps rate hike by the Fed.\",\n    \"input_context\": null,\n    \"output\": \"First, we identify the correlation... Tech stocks are long-duration assets... Discounted Cash Flow (DCF) models would show... Therefore, the portfolio would likely suffer significant drawdown. I recommend hedging via...\"\n  }\n]\n\"\"\"\n</code></pre> Pro Tip: In V3, we made \"Anti-Patterns\" explicit. This is key to preventing the model from \"slacking.\" LLMs tend to generate safe, mediocre answers (e.g., \"please consult a professional\"), which are low-value noise in training data and must be explicitly prohibited.<p></p> </li> </ul>"},{"location":"en/part4/4_1_sft_data/#922-automated-construction-methods-self-instruct-and-evol-instruct","title":"9.2.2 Automated Construction Methods: Self-Instruct and Evol-Instruct","text":"<p>We implement a simplified pipeline based on Evol-Instruct. The core is how to \"evolve\" simple instructions into complex ones through Prompts, with verification mechanisms introduced in the process.</p>"},{"location":"en/part4/4_1_sft_data/#core-code-breakdown-evol-instruct-pipeline","title":"Core Code Breakdown: Evol-Instruct Pipeline","text":"<p>Step 1: Define Evolution Operators (Evolution Prompts)</p> <p>The essence of Evol-Instruct lies in this set of Prompt templates. We need to define different evolution directions: depth (add constraints, deepen reasoning) and breadth (mutation). The following code shows how to build Prompts for \"add constraints\" and \"deepen reasoning.\" The design of these Prompts directly determines the upper limit of data quality.</p> <pre><code>class EvolutionPrompts:\n    @staticmethod\n    def get_deepening_prompt(instruction):\n        \"\"\"\n        Depth evolution: Increase logical reasoning depth.\n        By requiring 'explicitly ask for multiple-step reasoning', force the model from intuitive to analytical answers.\n        \"\"\"\n        return f\"\"\"\n        I want you to act as a Prompt Rewriter.\n        Your objective is to rewrite a given prompt into a more complex version to make those famous AI systems (e.g., ChatGPT and GPT4) a bit harder to handle.\n        But the rewritten prompt must be reasonable and must be understood and responded by humans.\n\n        # Given Prompt #:\n        {instruction}\n\n        # Method #:\n        If #Given Prompt# can be solved with just a few simple thinking processes, you can rewrite it to explicitly ask for multiple-step reasoning.\n\n        # Rewritten Prompt #:\n        \"\"\"\n\n    @staticmethod\n    def get_constraints_prompt(instruction):\n        \"\"\"\n        Depth evolution: Add specific constraints.\n        Limit word increase (10-20 words) to prevent instructions from becoming verbose without substance.\n        \"\"\"\n        return f\"\"\"\n        I want you to act as a Prompt Rewriter.\n        ... [header omitted for brevity]...\n\n        # Given Prompt #:\n        {instruction}\n\n        # Method #:\n        Please add one more constraint/requirement into #Given Prompt#.\n        You should try your best not to make the #Rewritten Prompt# become verbose, #Rewritten Prompt# can only add 10 to 20 words into #Given Prompt#.\n\n        # Rewritten Prompt #:\n        \"\"\"\n\n    @staticmethod\n    def get_breadth_prompt(instruction):\n        \"\"\"\n        Breadth evolution: Generate entirely new instructions on different topics based on existing ones.\n        Prevents data distribution collapse into narrow domains.\n        \"\"\"\n        return f\"\"\"\n        I want you to act as a Prompt Creator.\n        Please generate a brand new prompt that has the same difficulty level as #Given Prompt# but covers a completely different topic or domain.\n\n        # Given Prompt #:\n        {instruction}\n\n        # New Prompt #:\n        \"\"\"\n</code></pre> <p>Step 2: Execute Evolution Loop and Exception Handling</p> <pre><code>import random\n\n# Assume we have an LLM call interface\ndef call_llm(prompt):\n    # Call GPT-4 or other strong model\n    # In production, add retry mechanisms for network jitter\n    pass\n\ndef evolve_instruction(base_instruction, depth=1):\n    current_instruction = base_instruction\n\n    for i in range(depth):\n        # Randomly select an evolution strategy\n        # Strategy probability can be adjusted; e.g., more Breadth early, more Deepening later\n        strategy = random.choice(['deepening', 'constraints', 'breadth'])\n\n        if strategy == 'deepening':\n            prompt = EvolutionPrompts.get_deepening_prompt(current_instruction)\n        elif strategy == 'constraints':\n            prompt = EvolutionPrompts.get_constraints_prompt(current_instruction)\n        else:\n            prompt = EvolutionPrompts.get_breadth_prompt(current_instruction)\n\n        # Get evolved instruction\n        evolved_candidate = call_llm(prompt)\n\n        # Quality check (simple): Prevent evolution failure\n        # Often models output \"Sorry, I can't do that\" or simply repeat the original\n        if \"sorry\" in evolved_candidate.lower() or len(evolved_candidate) &lt; 10:\n            print(f\"Evolution failed at step {i}, keeping previous instruction.\")\n            break\n\n        # Advanced check: Simple heuristic to detect simple repetition\n        if evolved_candidate.strip() == current_instruction.strip():\n             print(f\"Evolution stagnant at step {i}.\")\n             break\n\n        current_instruction = evolved_candidate\n\n    return current_instruction\n\n# Example run\nseed = \"Write a Python script to calculate Fibonacci numbers.\"\ncomplex_instruction = evolve_instruction(seed, depth=3)\n# Expected result: \"Write a Python script to calculate the nth Fibonacci number using dynamic programming, optimize for memory usage, and handle negative input values.\"\n</code></pre> <p>Step 3: Performance Optimization Tips * Batch Processing: Don't call the API one by one. Construct a Prompt list with 20 instructions, let the model return 20 evolved results at once. This significantly reduces token cost and network latency (High Throughput). * Failure Filter: Evolution often fails (e.g., model starts repeating). Implement a filter: if evolved instruction length shortened or contains typical refusal phrases (\"As an AI...\"), discard the sample. * Diversity Control: In batch generation, explicitly require \"Generate diverse topics\" in the System Prompt to avoid all instructions in one batch being about \"Python programming.\"</p>"},{"location":"en/part4/4_1_sft_data/#923-chain-of-thought-cot-data-constructing-step-by-step-reasoning-samples","title":"9.2.3 Chain-of-Thought (CoT) Data: Constructing Step-by-Step Reasoning Samples","text":"<p>The core value of SFT data lies in teaching the model \"how to think.\" Ordinary Q&amp;A pairs (Q: 1+1? A: 2) only teach the result; CoT teaches the process.</p>"},{"location":"en/part4/4_1_sft_data/#cot-data-construction-prompt-template","title":"CoT Data Construction Prompt Template","text":"<p>We don't just add \"Let's think step by step\"\u2014we require the model to output in a specific format (e.g., <code>&lt;thinking&gt;</code> tags). This formatted data is highly useful in subsequent training; we can choose to have the model output the thinking process or hide it during inference.</p> <pre><code># System Prompt for CoT Generation\ncot_system_prompt = \"\"\"\nYou are a reasoning expert. When answering the user's question, you MUST follow this format:\n\n1. Enclose your thought process in &lt;thinking&gt; tags.\n2. Break down the problem into logical steps.\n3. Check for edge cases or potential errors in your logic (Self-Correction).\n4. Output the final answer in &lt;answer&gt; tags.\n\nDo NOT output the answer directly without the thinking process.\n\"\"\"\n\n# V3 Prompt Iteration for Math CoT\nuser_prompt_cot = \"\"\"\nQuestion: A farmer has chickens and cows. There are 20 heads and 50 legs. How many of each are there?\n\nPlease provide a Step-by-Step solution.\n\"\"\"\n</code></pre> <p>Example output (as training data): </p><pre><code>&lt;thinking&gt;\nStep 1: Define variables. Let C be chickens, K be cows.\nStep 2: Set up equations based on the problem statement.\n   Equation 1 (Heads): C + K = 20\n   Equation 2 (Legs): 2C + 4K = 50\nStep 3: Solve for C from Equation 1. \n   C = 20 - K.\nStep 4: Substitute C into Equation 2.\n   2(20 - K) + 4K = 50\n   40 - 2K + 4K = 50\n   2K = 10 \n   K = 5.\nStep 5: Solve for C using the value of K. \n   C = 20 - 5 = 15.\nStep 6: Verify the solution. \n   Heads: 15 + 5 = 20. Correct.\n   Legs: 15*2 + 5*4 = 30 + 20 = 50. Correct.\n&lt;/thinking&gt;\n&lt;answer&gt;\nChickens: 15, Cows: 5\n&lt;/answer&gt;\n</code></pre> Pro Tip: This data strategy with <code>&lt;thinking&gt;</code> tags is called \"Internal Monologue\" training. During SFT, keep these tags so the model learns to output the thinking process. In production, use parsing code to capture <code>&lt;thinking&gt;</code> content and only show <code>&lt;answer&gt;</code> to users, or implement a \"Thinking...\" UI animation showing partial reasoning steps for explainability.<p></p>"},{"location":"en/part4/4_1_sft_data/#924-performance-and-evaluation-performance-evaluation","title":"9.2.4. Performance and Evaluation (Performance &amp; Evaluation)","text":"<p>Data generation is only the first step; how to evaluate generated data quality is equally critical. We cannot wait until model training completes (potentially days and thousands of dollars) to discover poor data quality.</p>"},{"location":"en/part4/4_1_sft_data/#evaluation-metrics","title":"Evaluation Metrics","text":"<ul> <li>Instruction Following Rate: Usually an automated test. Use GPT-4 as judge to determine whether model-generated responses strictly satisfy all constraints in the input (e.g., \"word limit,\" \"include specific keywords,\" \"JSON format\").</li> <li>Complexity Distribution: Use NLP tools (e.g., SpaCy) to analyze verb diversity, syntactic tree depth, and average length of generated instructions. Plot distribution histograms to ensure Evol-Instruct truly increased difficulty, not just verbosity.</li> <li>Diversity: Compute ROUGE-L or use Embedding Cosine Similarity. If average similarity between samples in the dataset is too high, \"mode collapse\" has occurred\u2014data lacks diversity.</li> </ul>"},{"location":"en/part4/4_1_sft_data/#benchmarks","title":"Benchmarks","text":"<p>In academia and industry, there are recognized benchmarks for testing post-SFT model capability: * WizardLM paper data: Models trained on data evolved through 4 rounds of Evol-Instruct typically show 10%-20%+ improvement on GSM8K (math) and HumanEval (code) compared to models using only raw data. * MT-Bench: A multi-turn dialogue evaluation set specifically testing instruction following, reasoning, and multi-turn dialogue ability, typically scored by GPT-4. * Cost reference: Generating 52K Self-Instruct data using <code>gpt-3.5-turbo</code> costs approximately \\(500-\\)1000 (depending on Prompt length and rounds). This is highly cost-effective compared to hundreds of thousands of dollars for manual annotation.</p>"},{"location":"en/part4/4_1_sft_data/#925-pitfalls-troubleshooting","title":"9.2.5. Pitfalls &amp; Troubleshooting","text":"<p>In practice, data synthesis is full of pitfalls. Here are common failure modes and solutions.</p> <ul> <li> <p>Pitfall 1: Mode Collapse</p> <ul> <li>Symptom: Model-generated instructions are monotonous\u2014e.g., 1000 generated samples are all \"Please write an article about X\" or \"Please write a Python function.\"</li> <li>Cause: Seed tasks too homogeneous, or System Prompt Temperature set too low, causing the model to fall into local optima.</li> <li>Fix: Increase Seed Task diversity (cover 100+ domains: cooking, law, programming, literature); raise Temperature (0.7 \u2192 1.0); explicitly require \"Generate a task from a domain different from previous examples\" in System Prompt.</li> </ul> </li> <li> <p>Pitfall 2: Hallucinated Constraints</p> <ul> <li>Symptom: Model learns \"must output JSON\" from training data, causing it to force JSON output even for casual chat (\"Hello\"), or output <code>&lt;thinking&gt;</code> tags when not requested.</li> <li>Cause: Severely skewed training data distribution\u2014100% complex instructions, lacking simple general dialogue data.</li> <li>Fix: Data mixing. Mix 10%-20% general dialogue data (e.g., ShareGPT or chit-chat) into Evol-Instruct data to prevent overfitting to specific formats. This is called \"General Capability Replay.\"</li> </ul> </li> <li> <p>Pitfall 3: Evolution Failure (Degradation)</p> <ul> <li>Symptom: Evolved instructions become absurd, logically contradictory (\"Write a 1000-word article without vowels\") or extremely verbose.</li> <li>Fix: Implement \"length penalty\" or \"complexity truncation.\" If evolved instructions are complex but GPT-4 cannot answer (or answer quality is poor), the sample is invalid (Bad Case). Introduce \"teacher model scoring\" for GPT-4 to evaluate evolved instruction feasibility.</li> </ul> </li> <li> <p>Pitfall 4: Catastrophic Forgetting</p> <ul> <li>Symptom: After SFT, the model learns to follow instructions but seems \"dumber,\" forgetting some world knowledge from pre-training.</li> <li>Cause: SFT dataset modifies model weight distribution, over-focusing on specific task forms and squeezing general knowledge storage.</li> <li>Fix: Lower learning rate, reduce epochs (SFT typically only needs 2-3 epochs). Add small amounts of pre-training data (Pre-training Replay) to SFT data to maintain parameter distribution stability.</li> </ul> </li> </ul>"},{"location":"en/part4/4_1_sft_data/#926-chapter-summary-and-further-reading","title":"9.2.6. Chapter Summary and Further Reading","text":"<p>We treat Prompts as the source code of data\u2014they must be managed with rigorous version control and iterative testing like software engineering code. In this framework, Self-Instruct solves the \"from zero to one\" cold-start challenge, while Evol-Instruct conquers the \"from easy to hard\" complexity climb. Their organic combination constitutes the golden paradigm for building high-performance datasets. Meanwhile, Chain-of-Thought (CoT) data is far from a simple problem-solving trick\u2014by making reasoning explicit, it effectively allocates computational resources to critical reasoning steps, fundamentally enhancing the model's ability to handle complex logic. Ultimately, the core barrier in data synthesis is not generation capability but the art of filtering and cleaning\u2014between the ease of mass generation and the difficulty of precise screening, only the ability to extract gold from sand truly constitutes core competitiveness.</p>"},{"location":"en/part4/4_1_sft_data/#references-and-further-reading","title":"References and Further Reading","text":"<ul> <li>Wang, Y., et al. (2022). Self-Instruct: Aligning Language Models with Self-Generated Instructions. (Foundational work on automated instruction generation)</li> <li>Xu, C., et al. (2023). WizardLM: Empowering Large Language Models to Follow Complex Instructions. (Detailed introduction to Evol-Instruct evolution operators)</li> <li>Wei, J., et al. (2022). Chain-of-Thought Prompting Elicits Reasoning in Large Language Models. (Foundational work on CoT)</li> <li>Zhou, C., et al. (2023). LIMA: Less Is More for Alignment. (Establishes theoretical basis that SFT mainly learns format rather than knowledge; \"quality &gt; quantity\")</li> </ul>"},{"location":"en/part4/4_2_synthetic_data/","title":"Chapter 10: Synthetic Data","text":""},{"location":"en/part4/4_2_synthetic_data/#chapter-10-synthetic-data-from-data-mining-to-data-farming","title":"Chapter 10: Synthetic Data \u2014\u2014 From \"Data Mining\" to \"Data Farming\"","text":""},{"location":"en/part4/4_2_synthetic_data/#chapter-summary","title":"Chapter Summary","text":"<p>As the large model competition intensifies, high-quality natural data on the public internet faces depletion. We have almost \"read\" the entire internet, but the model's intellectual ceiling is far from reached. At this point, synthetic data is no longer optional\u2014it is the new engine for model capability leap. This chapter deeply analyzes Microsoft's Phi series \"textbook-level\" data synthesis methods and explores how to transform from passive \"data collectors\" to active \"data creators.\"</p> <p>We go beyond generating text to build rigorous logical verification loops through Program of Thought (PoT) using code execution, and how to use GPT-4o and other multimodal models to synthesize complex image-text instruction data. We demonstrate how to move from simple \"imitating humans\" to \"surpassing humans,\" constructing training sets that are purer and more educational than the real world through algorithmic means.</p>"},{"location":"en/part4/4_2_synthetic_data/#learning-objectives","title":"Learning Objectives","text":"<ul> <li>Build a \"Textbook Quality\" classifier to filter high-value samples from massive web data.</li> <li>Implement PoT (Program of Thought) data generation pipeline, using Python interpreter to verify correctness of math/code data.</li> <li>Master LLaVA/GPT-4o-based multimodal instruction synthesis to construct image reasoning Q&amp;A pairs.</li> </ul>"},{"location":"en/part4/4_2_synthetic_data/#scenario-introduction-when-data-becomes-the-bottleneck","title":"Scenario Introduction: When Data Becomes the Bottleneck","text":"<p>\"You're training a small model (1.3B) specialized for Python programming. To make it as powerful as possible, you wrote crawlers to scrape all open-source code from GitHub. Yet when testing after training, you despairingly discover the model learned to write buggy code, even learning to write 'TODO: Fix this later' or 'This code is trash, do not use' inside functions. Simply adding more data is no longer effective\u2014the more garbage you feed the model, the more chaotic its output. Then Microsoft's Phi-1 paper hits you like a wake-up call: 'Textbooks Are All You Need.' What you need is textbook-like code with clear logic, perfect comments, and progressive teaching\u2014not 'spaghetti code' only God and the original author can understand. But where do you find hundreds of billions of tokens of perfect textbooks? Since we can't find them, we must learn to 'create' this data out of thin air. How to build a tireless 'virtual professor' to batch-produce these perfect textbooks? This is the core engineering challenge this chapter addresses.\"</p>"},{"location":"en/part4/4_2_synthetic_data/#101-core-concepts-and-principles-concepts-principles","title":"10.1 Core Concepts and Principles (Concepts &amp; Principles)","text":"<p>The core challenge of synthetic data lies in quality control and verification loops. Because model-generated text often contains hallucinations or errors without checking. Training models on erroneous data leads to \"Model Autophagy\" or \"Model Collapse\"\u2014where model output variance gradually vanishes and content becomes extremely homogeneous and detached from reality. The three methods introduced in this chapter address quality issues for text, code/math, and multimodal data respectively.</p>"},{"location":"en/part4/4_2_synthetic_data/#1011-why-does-synthetic-data-quality-matter-far-more-than-quantity","title":"10.1.1 Why Does Synthetic Data Quality Matter Far More Than Quantity?","text":"<p>In early deep learning, we believed \"data volume equals justice\"\u2014that with enough data, models could learn everything. But in the synthetic data era, this dogma has been overturned.</p> <p>Signal-to-Noise Ratio Theory: Model training is essentially an information compression process. High-quality data (e.g., textbooks) has extremely high information density and rigorous logical chains\u2014the model needs few samples to capture underlying patterns. Low-quality data (e.g., forum spam, chit-chat) is full of noise and logical gaps. If training sets mix large amounts of low-quality synthetic data, the model will be forced to fit this noise to reduce Loss, causing \"logic circuits\" to short-circuit.</p> <p>Learning physics: reading a classic like Feynman Lectures (high-quality synthetic data) surpasses watching 10,000 fragmented physics popularization videos (low-quality data). Phi-1's success proved: 6B tokens of textbook-level data can outperform 1000B tokens of web-crawled data in training effect. In synthetic data, verification cost has become the new currency.</p>"},{"location":"en/part4/4_2_synthetic_data/#1012-textbook-level-data-textbooks-are-all-you-need","title":"10.1.2 Textbook-Level Data (Textbooks Are All You Need)","text":"<p>Microsoft Phi-1's core idea: rather than training with 1TB of garbage data, use 6B tokens of high-quality data. Its core lies in building a \"filter\" and an \"amplifier.\"</p> <p>First, we don't completely abandon web data\u2014we train a classifier (Quality Classifier) to identify content with \"educational value.\" This isn't just checking grammar but whether content is logically self-consistent and contains definitions and reasoning. Second, we use powerful generative models (e.g., GPT-4) as \"amplifiers,\" synthesizing self-contained knowledge fragments with similar style but entirely new content based on these high-quality snippets.</p> <p> Figure 10-1: Phi-1 Process Diagram</p>"},{"location":"en/part4/4_2_synthetic_data/#1013-code-and-math-synthesis-pot-program-of-thought","title":"10.1.3 Code and Math Synthesis: PoT (Program of Thought)","text":"<p>LLMs are essentially probabilistic models\u2014they don't have true logic inference chips. Therefore, when LLMs perform arithmetic (e.g., 234 * 567) or complex logical derivation, they easily hallucinate. PoT (Program of Thought) thinks: since LLMs aren't good at calculation but good at translation, have them \"translate\" math problems into code, then let the Python interpreter compute the result.</p> <p>This is the only domain in synthetic data achieving 100% accuracy verification. We put generated code into a Python sandbox for execution. If it errors, discard; if it runs successfully, the execution result is Ground Truth. This \"execution equals verification\" mechanism completely solves the synthetic data verifiability problem, enabling low-cost generation of infinite math and logical reasoning data.</p> <p>Table 10-1: Synthetic Data Verification Strategy Comparison</p> Data Type Generator Core Challenge Verifier Verification Mechanism General Text GPT-4 / Gemini Hallucination LLM (Judge) / Reward Model Depends on strong model scoring; low consistency; prone to \"judge bias\" Math/Logic GPT-4 + PoT Prompt Calculation errors Python Interpreter Execution consistency: Code run result matches expected answer; logic absolutely correct Code DeepSeek Coder / GPT-4 Syntax errors, logic bugs Unit Tests / Compiler Unit tests: Via assert or successful compilation, ensure functionality Multimodal GPT-4o / LLaVA Visual hallucination (fabrication) CLIP Score / Grounding DINO Check if generated description matches image Embedding; prevent fabricating non-existent objects"},{"location":"en/part4/4_2_synthetic_data/#1014-multimodal-instruction-synthesis-bridging-perception","title":"10.1.4 Multimodal Instruction Synthesis: Bridging Perception","text":"<p>For image data, traditional annotation costs are extremely high and descriptions are brief. LLaVA proposed a brilliant \"blind men and elephant\" strategy. We use existing detection models to convert images into symbolic text descriptions (Caption + Bounding Boxes), then feed this pure text to strong text-only models (e.g., GPT-4). GPT-4 can't see images, but it can \"imagine\" image content through this metadata and generate complex reasoning dialogue based on it. This not only solves multimodal data scarcity but greatly elevates instruction complexity and logic.</p>"},{"location":"en/part4/4_2_synthetic_data/#102-engineering-implementation-engineering-implementation","title":"10.2 Engineering Implementation (Engineering Implementation)","text":"<p>This section delves into code-level implementation, building a complete data synthesis pipeline. We focus on ensuring data diversity and preventing generated \"textbooks\" from being monotonous.</p>"},{"location":"en/part4/4_2_synthetic_data/#1021-textbook-level-data-classifier-and-synthesis-pipeline","title":"10.2.1 Textbook-Level Data: Classifier and Synthesis Pipeline","text":"<p>Step 1: Train Quality Classifier We need to train a lightweight model (e.g., Random Forest or BERT-Tiny) to select \"textbooks\" from massive data. The key here is annotation data source. Typically we need expert or GPT-4 careful annotation of thousands of samples as seed.</p> <p>Code Implementation: Feature Engineering and Training </p><pre><code>import pandas as pd\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.feature_extraction.text import TfidfVectorizer\nfrom sklearn.pipeline import Pipeline\n\n# 1. Prepare annotation data\n# First annotate a small number of samples (e.g., 1000) with GPT-4 as \"gold standard\"\n# Prompt: \"Determine if this text is of educational value for a student...\"\n# Label 1: High Quality (Textbook-like), Label 0: Low Quality (Noise)\n# This step is critical; annotation quality directly determines classifier ceiling\ndata = [\n    {\"text\": \"Python lists are mutable sequences...\", \"label\": 1},\n    {\"text\": \"Hey guys check out my cat photo...\", \"label\": 0},\n    # ... more data\n] \ndf = pd.DataFrame(data)\n\n# 2. Build classifier pipeline\n# Phi-1 paper uses pretrained model Embedding; here simplified to TF-IDF for demonstration\n# In production, recommend DeBERTa-v3-small or similar lightweight Transformer for Embedding\npipeline = Pipeline([\n    ('tfidf', TfidfVectorizer(max_features=5000, stop_words='english')),\n    ('clf', RandomForestClassifier(n_estimators=100, n_jobs=-1))\n])\n\n# 3. Train\nX = df['text']\ny = df['label']\npipeline.fit(X, y)\n\n# 4. Predict (Filtering Phase)\n# Score massive web data; retain only high-scoring data\nweb_snippet = \"Standard library documentation for Python...\"\nscore = pipeline.predict_proba([web_snippet])[0][1]\n\nif score &gt; 0.8:\n    print(\"Keep this data for training: High Educational Value\")\nelse:\n    print(\"Discard: Low Signal-to-Noise Ratio\")\n</code></pre><p></p> <p>Step 2: Synthetic Textbook Fragment Generation With classifier-filtered seed data, we need to \"expand\" it. Prompt design here requires extreme skill.</p> <p>Prompt iteration: Synthetic Python tutorial * V1 Prompt: \"Write a tutorial about Python lists.\"     * Result: Flat narrative, lacking depth, like mediocre blog post. * V3 Prompt (Phi-style): Introduced specific pedagogy, requiring definitions, comparisons, complexity analysis, and pitfall warnings.</p> <pre><code># V3 Prompt - Textbook-style synthesis\nsynthetic_textbook_prompt = \"\"\"\n### ROLE\nYou are a professor of Computer Science writing a definitive textbook on Python.\n\n### OBJECTIVE\nWrite a comprehensive, self-contained chapter section on the topic: \"List Comprehensions vs. Map/Filter\".\n\n### REQUIREMENTS\n1. **Tone**: Educational, clear, precise, and rigorous. Avoid conversational filler.\n2. **Structure**:\n   - Start with a conceptual definition explaining *why* this feature exists.\n   - Provide a \"Before and After\" code example (Loop vs. Comprehension).\n   - Explain the *computational complexity* (Big O) implications.\n   - Include a \"Common Pitfall\" section (e.g., readability vs. brevity).\n3. **Diversity**: Use realistic variable names (e.g., `inventory_items`, `sensor_readings`), NOT generic ones like `x`, `y`, `foo`. \n   (This is crucial to prevent the model from overfitting to toy examples).\n\n### OUTPUT\n[Markdown Content]\n\"\"\"\n</code></pre>"},{"location":"en/part4/4_2_synthetic_data/#1022-back-translation-deriving-questions-from-answers","title":"10.2.2 Back-Translation: Deriving Questions from Answers","text":"<p>Besides generating from scratch, another efficient method is \"back-translation.\" In code, we often easily find high-quality code snippets (e.g., high-star library functions on GitHub) but lack corresponding natural language instructions.</p> <p>We can use LLM summarization: input complex code, ask the model: \"Please write as detailed as possible various user requirement instructions such that this code exactly solves the problem.\" This quickly generates massive (Instruction, Output) pairs with guaranteed high-quality human code. This method is especially suitable for enhancing model understanding of complex code logic.</p>"},{"location":"en/part4/4_2_synthetic_data/#1023-code-and-math-synthesis-pot-program-of-thought","title":"10.2.3 Code and Math Synthesis: PoT (Program of Thought)","text":"<p>This is the strongest means to ensure synthetic data correctness. By forcing the model to generate code, we convert fuzzy natural language reasoning into precise program logic.</p> <p>Core Code Breakdown: Generation and Verification Loop </p><pre><code>import subprocess\nimport tempfile\nimport os\n\n# 1. PoT Generation Prompt\n# Require model to write solution steps as Python function solver()\npot_prompt = \"\"\"\nQuestion: Janet has 3 times as many eggs as Bob. Bob has 5 eggs. How many eggs do they have in total?\n\nInstruction:\nWrite a Python function named `solver()` that returns the answer.\nDo not output the number directly. Write the code to calculate it.\nInclude comments explaining the logic.\n\"\"\"\n\n# Assume LLM returns the following code string\ngenerated_code = \"\"\"\ndef solver():\n    # Bob has 5 eggs\n    bob_eggs = 5\n    # Janet has 3 times as many as Bob\n    janet_eggs = 3 * bob_eggs\n    # Total eggs\n    total = janet_eggs + bob_eggs\n    return total\n\"\"\"\n\n# 2. Code Execution Sandbox\n# WARNING: Directly executing generated code is extremely dangerous; must run in sandbox\ndef execute_generated_code(code_str):\n    try:\n        # In production use Docker, gVisor, or nsjail for isolation\n        local_scope = {}\n\n        # Limit execution time to prevent infinite loops\n        # Here uses simplified exec for demo; production needs resource module for CPU/memory limits\n        exec(code_str, {}, local_scope)\n\n        if 'solver' in local_scope:\n            result = local_scope['solver']()\n            return result, \"Success\"\n        else:\n            return None, \"No solver function found\"\n    except Exception as e:\n        return None, f\"Execution Error: {str(e)}\"\n\n# 3. Verification and Data Saving\nresult, status = execute_generated_code(generated_code)\n\nif status == \"Success\":\n    print(f\"Verified Answer: {result}\")\n    # Data saving strategy:\n    # Strategy A (PoT): Save Instruction -&gt; Code. Train model to write code for solving.\n    # Strategy B (CoT): Save Instruction -&gt; \"Let's calculate... [Reasoning]... The answer is {result}\".\n    # Strategy B uses code as intermediate step to generate pure text reasoning data.\n    save_to_dataset(pot_prompt, generated_code, result)\nelse:\n    print(\"Discard bad data: Code failed to execute\")\n</code></pre> Pro Tip: Generated data can train not only PoT but also ordinary CoT models. Method: use successfully executed code as \"intermediate step,\" execution result as \"final answer,\" reversely construct <code>&lt;thinking&gt;...code...&lt;/thinking&gt;&lt;answer&gt;...result...&lt;/answer&gt;</code> format. This \"borrowing chickens to lay eggs\" method can significantly improve pure text model arithmetic accuracy.<p></p>"},{"location":"en/part4/4_2_synthetic_data/#1024-multimodal-instruction-synthesis-llava-pipeline","title":"10.2.4 Multimodal Instruction Synthesis: LLaVA Pipeline","text":"<p>Using text-only models to synthesize multimodal data is LLaVA's innovation. This method's core lies in symbolizing visual information\u2014since text-only models (e.g., GPT-4) can't see images, we translate images into \"code\" they can read.</p> <p> Figure 10-2: LLaVA Data Synthesis Process Diagram</p>"},{"location":"en/part4/4_2_synthetic_data/#1-engineering-pipeline-from-pixels-to-symbols","title":"1. Engineering Pipeline: From Pixels to Symbols","text":"<p>Before Prompt design, we need toolchain to \"deconstruct\" images into structured data (Metadata) readable by text models:</p> <ol> <li> <p>Global Semantics (Captioning)</p> <ul> <li>Tool: CLIP or BLIP for one-sentence description.</li> <li>Role: Provide overall context.</li> <li>Output example: <code>\"A young girl riding a horse on a beach at sunset.\"</code></li> </ul> </li> <li> <p>Local Details (Object Detection)</p> <ul> <li>Tool: Grounding DINO to extract objects and coordinates (Bounding Box).</li> <li>Role: Provide spatial anchoring entities.</li> <li>Output example: <code>{'girl': [100, 200, 300, 400], ...}</code></li> </ul> </li> <li> <p>Data Synthesis</p> <ul> <li>Action: Fill above information into Prompt, call GPT-4 to generate dialogue.</li> </ul> </li> </ol>"},{"location":"en/part4/4_2_synthetic_data/#2-prompt-engineering-design-and-considerations","title":"2. Prompt Engineering: Design and Considerations","text":"<p>With structured data, Prompt design becomes the key to data quality. Below is LLaVA-style Prompt template and architectural considerations:</p> <pre><code># System Prompt for Multimodal Data Generation\nmultimodal_gen_prompt = \"\"\"\n### CONTEXT\nYou are an AI visual assistant. You cannot see the image directly, but I will provide its metadata.\nYour task is to generate a conversation between a Human and Yourself about this image.\n\n### IMAGE METADATA\n# [Data injection point]: Fill pipeline-extracted data here\n- **Caption**: \"{caption}\"\n- **Objects**: {object_list_with_boxes}\n\n### INSTRUCTIONS\n1. **Conversation Style**: Generate a multi-turn Q&amp;A (User asking, Assistant answering).\n2. **Reasoning**: The Human should ask complex questions (e.g., \"What suggests this is a safe environment?\"). You answer based on the visual evidence.\n3. **Spatial Awareness**: Use the bounding box info to describe relative positions if asked (e.g., \"The ocean is in the background...\").\n4. **Visual Consistency**: Do NOT hallucinate objects not listed in the metadata.\n\"\"\"\n</code></pre> <p>Architectural considerations behind Prompt design:</p> <ul> <li> <p>Why provide both Caption and Objects? (Complementarity)     Objects alone (girl, horse, ocean) are discrete, lacking action and atmosphere; Caption alone (girl riding horse) lacks specific location. Combined, GPT-4 can construct complete mental \"scene graph.\"</p> </li> <li> <p>Why emphasize \"Spatial Awareness\"? (Spatial alignment)     Text models inherently lack spatial sense. By forcing them to process <code>[x1, y1, x2, y2]</code> coordinate data, we're forcing the text model to learn \"visual alignment\"\u2014understanding pixel regions corresponding to \"left,\" \"lower right,\" etc.</p> </li> <li> <p>Why add \"Visual Consistency\" constraint? (Hallucination suppression)     Text models' biggest flaw is easy \"brain-filling.\" E.g., seeing \"beach\" they might fabricate \"seagulls flying.\" Must explicitly prohibit generating objects not in Metadata to ensure high signal-to-noise ratio.</p> </li> <li> <p>Why generate \"Complex Reasoning\"? (Data dimension upgrade)     Simple \"What's this? A horse\" has no training value. We need to leverage GPT-4's intelligence to artificially create \"requires thinking\" samples (e.g., causal inference, sentiment analysis) through synthesis, so small models (Student) can distill large model reasoning through learning.</p> </li> </ul>"},{"location":"en/part4/4_2_synthetic_data/#1025-advanced-strategies-for-multimodal-instruction-data-synthesis","title":"10.2.5 Advanced Strategies for Multimodal Instruction Data Synthesis","text":"<p>Although \"symbolic reasoning\" based on text-only models (like early LLaVA v1) pioneered multimodal instruction synthesis, its main defect is \"lossy compression of visual information\"\u2014text models cannot directly perceive pixel-level visual features; relying only on metadata for reasoning easily causes hallucination.</p> <p>To break this bottleneck, industry and academia have evolved three more mainstream and efficient synthesis strategies: Visual Strong Model Distillation, Mixture-of-Experts Pipeline, and Evolution Instruction Generation.</p>"},{"location":"en/part4/4_2_synthetic_data/#1-visual-strong-model-distillation","title":"1. Visual Strong Model Distillation","text":"<p>This is currently (as of 2024-2025) the most mainstream method for building high-performance open-source multimodal models (e.g., LLaVA-NeXT, ShareGPT4V), often considered SOTA (State-of-the-Art).</p> <p>Core Idea This method abandons \"using text models to guess visual content\" and adopts the \"Teacher-Student\" distillation paradigm. Using closed-source top multimodal models (e.g., GPT-4o, Gemini 1.5 Pro) as \"teacher models,\" directly process raw image signals to generate high-quality, high-density detailed descriptions (Dense Caption) and complex reasoning Q&amp;A pairs for open-source models (student models) to learn.</p> <p>Advantage Analysis * Eliminate modality gap: Teacher model directly \"sees\" image pixels, capturing lighting, texture, micro-expressions that text metadata cannot convey. * Suppress hallucination: Descriptions based on real visual input greatly reduce factual error probability.</p> <p>Implementation Flow The core lies in building a Prompt that can induce teacher model to output exhaustive information. Below is standard distillation flow pseudocode:</p> <pre><code>def generate_dense_instruction(image_path, api_client):\n    \"\"\"\n    Use SOTA MLLM to generate high-density multimodal instruction data\n    \"\"\"\n\n    # System Prompt key: Require extremely detailed capture and logical association\n    distillation_prompt = \"\"\"\n    You are an expert visual analyst. Analyze the provided image with extreme detail.\n\n    Tasks:\n    1. Dense Captioning: Provide a comprehensive description of every corner of the image, covering colors, textures, lighting, and background details.\n    2. Object Relationships: Analyze the interactions between objects (e.g., causality, spatial relations).\n    3. OCR Extraction: Transcribe any visible text verbatim.\n    4. Q&amp;A Generation: Based on the visual details above, create a logical reasoning question that cannot be answered without looking at the image.\n    \"\"\"\n\n    # Key difference: Input contains real Image Tensor, not merely Bounding Box\n    response = api_client.chat.completions.create(\n        model=\"gpt-4o\",\n        messages=[\n            {\"role\": \"system\", \"content\": distillation_prompt},\n            {\"role\": \"user\", \"content\": [{\"type\": \"image_url\", \"url\": image_path}]}\n        ]\n    )\n\n    return parse_response(response)\n</code></pre>"},{"location":"en/part4/4_2_synthetic_data/#2-domain-specialization-mixture-of-experts-pipeline","title":"2. Domain Specialization: Mixture-of-Experts Pipeline","text":"<p>For vertical domains where general models struggle\u2014Document AI, complex chart analysis, or autonomous driving data\u2014general visual distillation often lacks precision. Adopting \"Mixture-of-Experts\" strategy is best practice.</p> <p>Core Logic This method doesn't rely on single model's end-to-end capability but assembles multiple specialized small models (Experts) as perception frontend, converting unstructured images into fine structured data for LLM integration.</p> <p>Logic flow: $\\(\\text{Image} \\xrightarrow{\\text{Experts}} [\\text{OCR} + \\text{Layout} + \\text{Detection}] \\xrightarrow{\\text{Aggregation}} \\text{Structured Context} \\xrightarrow{\\text{LLM}} \\text{Instruction}\\)$</p> <p>Application Scenarios Typical applications include financial invoice processing, medical imaging reports (DICOM), etc.</p> <ol> <li>OCR Expert (e.g., PaddleOCR): Extract all text and precise coordinates \\((x_1, y_1, x_2, y_2)\\) from image.</li> <li>Layout Expert (e.g., LayoutLM): Parse document topology, identify table rows/columns, paragraph hierarchy, and title relationships.</li> <li>Synthesis (LLM): Fill structured data into Prompt template.<ul> <li>Example Prompt: \"This is an invoice's structured data, invoice number at (100, 200), total amount 500.00. Please generate a multi-turn Q&amp;A about 'financial audit verification' based on this.\"</li> </ul> </li> </ol> <p> Figure 10-3: Mixture-of-Experts Pipeline Diagram</p>"},{"location":"en/part4/4_2_synthetic_data/#3-evolution-instruction-generation-visual-evol-instruct","title":"3. Evolution Instruction Generation (Visual Evol-Instruct)","text":"<p>Inspired by WizardLM in text domain, Visual Evol-Instruct aims to solve training data \"homogenization\" and \"oversimplification.\" When base dataset only contains simple recognition tasks (e.g., \"What's in the image?\"), models cannot learn higher-order reasoning. This method forces \"dimensional upgrade\" of existing data through Prompt Engineering.</p> <p>Core Logic $\\(\\text{Simple VQA} \\xrightarrow{\\text{Complexity Constraints}} \\text{Complex Reasoning VQA}\\)$</p> <p>By applying specific evolution instructions to LLM, data complexity can be elevated in these dimensions:</p> <ul> <li>Reasoning Deepening:<ul> <li>Original: \"What is this person holding?\"</li> <li>Evolved: \"Based on the object's use and the person's clothing, infer this person's profession and what activities they might perform next.\"</li> </ul> </li> <li>Counterfactual Reasoning:<ul> <li>Original: \"The car in the image is red.\"</li> <li>Evolved: \"If the red sports car in the image were replaced with an old bicycle, how would the scene's atmosphere change? Does this fit the modern architecture style in the background?\"</li> </ul> </li> <li>Comparative Analysis:<ul> <li>Input two similar images, require model to analyze subtle differences (lighting changes, object displacement), training model's fine-grained observation.</li> </ul> </li> </ul> <p>Through combined use of these three strategies, we can build high-quality multimodal instruction datasets rich in visual detail and deep logical reasoning, laying solid foundation for training LLaVA, MiniGPT-4, and similar models.</p>"},{"location":"en/part4/4_2_synthetic_data/#103-performance-and-evaluation-performance-evaluation","title":"10.3. Performance and Evaluation (Performance &amp; Evaluation)","text":"<p>After training on synthetic data, evaluation is especially important\u2014we need to confirm whether the model truly \"learned\" or merely \"memorized\" patterns in synthetic data.</p>"},{"location":"en/part4/4_2_synthetic_data/#evaluation-metrics","title":"Evaluation Metrics","text":"<ul> <li>Pass@1 (Code): For PoT synthetic data, we test Pass@1 on HumanEval. Phi-1 achieved 50%+ Pass@1 with only 6B data, surpassing many models trained on 100x more data. This proves data quality's overwhelming advantage.</li> <li>Hallucination Rate: Compare synthetic multimodal answers with original image CLIP similarity to detect whether non-existent objects were generated. We can build negative sample sets specifically inducing model to answer non-existent objects, checking if model refuses.</li> <li>Decontamination: A dirty but necessary step. Check whether synthetic data inadvertently contains test set (e.g., HumanEval) questions. Through N-gram overlap detection, ensure model generalizes rather than cheats.</li> </ul>"},{"location":"en/part4/4_2_synthetic_data/#benchmarks","title":"Benchmarks","text":"<ul> <li>PoT vs CoT: On math (e.g., GSM8K), PoT typically outperforms pure text CoT by 5-10%. Reason: PoT outsources calculation to CPU (best at computation) while GPU focuses on logic translation\u2014optimal compute allocation.</li> </ul>"},{"location":"en/part4/4_2_synthetic_data/#104-pitfalls-troubleshooting","title":"10.4. Pitfalls &amp; Troubleshooting","text":"<p>Synthetic data is beautiful but full of traps. A slight slip and the model falls into \"self-congratulation\" loops.</p> <ul> <li> <p>Pitfall 1: Self-Confirmation Bias</p> <ul> <li>Symptom: Model-generated code runs but logic is wrong (e.g., 2+2=5, and model-generated test cases are also wrong, coincidentally passing the wrong function).</li> <li>Fix: Must introduce external, deterministic Solver or human-reviewed Unit Test library. Never fully rely on model-generated test cases to verify model-generated code\u2014it's like letting the criminal judge themselves.</li> </ul> </li> <li> <p>Pitfall 2: Lack of Visual Grounding</p> <ul> <li>Symptom: In multimodal synthetic data, model discusses details not in metadata (fabrication). E.g., Metadata only has \"dog,\" but model describes \"dog collar color\" when the dog in the image has no collar.</li> <li>Fix: Add strict instruction in Prompt: \"Only strictly rely on the provided metadata. Do not invent details.\" Also use CLIP Score to filter out generated text with too low similarity to original image.</li> </ul> </li> <li> <p>Pitfall 3: The Homogenization Trap</p> <ul> <li>Symptom: If all data is GPT-4 generated, your model becomes a \"low-end GPT-4,\" losing diversity. All answer tones and sentence structures are strikingly consistent.</li> <li>Fix: Entropy Injection. Randomly inject different Personas in Prompt (e.g., \"grumpy programmer,\" \"patient kindergarten teacher\"), or require different programming styles (recursive vs. iterative), forcing data distribution expansion.</li> </ul> </li> </ul>"},{"location":"en/part4/4_2_synthetic_data/#105-chapter-summary-and-further-reading","title":"10.5. Chapter Summary and Further Reading","text":"<p>The \"Textbooks Are All You Need\" paradigm established the core principle that data quality (educational value) takes priority over quantity. Synthetic data technology grants us the ability to precisely control data signal-to-noise ratio. Under this framework, Program of Thought (PoT) guarantees data rigor by converting reasoning into executable code and using compiler determinism for verification. Meanwhile, Symbolic-to-Synthetic method uses metadata (e.g., Bounding Box) to guide text models to generate multimodal content, achieving effective conversion from unimodal to multimodal data. This evolution marks data engineering's transition from passive \"mining\" to active \"production\": through seed prompt construction, instruction complexity (Evolution), quality filtering, and final synthesis, systematically building high-quality datasets via standard industrial process.</p>"},{"location":"en/part4/4_2_synthetic_data/#references","title":"References","text":"<ul> <li>Gunasekar, S., et al. (2023). Textbooks Are All You Need (Phi-1).</li> <li>Chen, W., et al. (2022). Program of Thoughts Prompting: Disentangling Computation from Reasoning for Numerical Reasoning Tasks.</li> <li>Liu, H., et al. (2023). Visual Instruction Tuning (LLaVA).</li> <li>Shumailov, I., et al. (2023). The Curse of Recursion: Training on Generated Data Makes Models Forget. (Important research on model collapse)</li> </ul>"},{"location":"en/part4/4_3_preference_data/","title":"Chapter 11: Human Preference Data","text":""},{"location":"en/part4/4_3_preference_data/#chapter-11-human-preference-data-rlhfdpo","title":"Chapter 11: Human Preference Data (RLHF/DPO)","text":""},{"location":"en/part4/4_3_preference_data/#chapter-summary","title":"Chapter Summary","text":"<p>If SFT (instruction fine-tuning) teaches the model to \"speak\" and grants basic language and task-handling ability, then preference alignment (RLHF/DPO) teaches the model to \"speak correctly,\" making its output align with human values, ethical standards, and specific business preferences. This chapter deeply analyzes the core of the DPO (Direct Preference Optimization) algorithm\u2014samples composed of Chosen and Rejected pairs. We explore how to extract high-quality signals from chaotic human subjective judgment, involving annotation platform consistency management (IAA) and deep understanding of human cognitive biases. Additionally, we focus on the cutting-edge RLAIF (Constitutional AI) technique\u2014using AI to replace humans for preference scoring based on preset \"constitutional\" principles, which is fundamentally changing the cost structure and efficiency of large-scale alignment.</p> <p>Learning Objectives: * Master in depth constructing DPO triplet (Prompt, Chosen, Rejected) standard data format, understanding the contrastive learning principle and mathematical significance behind it. * Thoroughly understand psychological and statistical sources of annotation noise, able to compute IAA (Inter-Annotator Agreement) and use Cohen's Kappa coefficient to clean low-quality data. * Engineering implementation of Constitutional AI's Critique-Revision loop, leveraging the property that \"discriminator\" is stronger than \"generator\" to automatically generate large-scale harmless preference data.</p> <p>Scenario Introduction: \"Your SFT model is very obedient\u2014so obedient that when someone asks 'how to make poison' it helpfully lists chemical formulas. This is an absolute safety red line, called 'Jailbreak' in industry. You need the model to learn to 'refuse' malicious instructions while remaining 'helpful' for normal instructions. However, hiring human annotators to read thousands of toxic messages is not only costly but causes 'Psychological Distress' to annotators\u2014ethically unsustainable. Is there a way for AI to read these toxic messages itself and tell itself: 'This kind of answer is wrong'? This is the inevitable path from Human Feedback to AI Feedback.\"</p> <p> Figure 11-1: Human Preference Diagram</p>"},{"location":"en/part4/4_3_preference_data/#2-core-concepts-and-principles-concepts-principles","title":"2. Core Concepts and Principles (Concepts &amp; Principles)","text":""},{"location":"en/part4/4_3_preference_data/#111-preference-data-format-the-contrast-philosophy-of-chosen-vs-rejected","title":"11.1 Preference Data Format: The Contrast Philosophy of Chosen vs Rejected","text":"<p>Whether for traditional Reward Model training (PPO route) or the popular direct Policy optimization (DPO route), the core data unit is the \"preference pair\" with standard structure as a triplet \\((x, y_w, y_l)\\). Here \\(x\\) represents the prompt, \\(y_w\\) is Chosen (winner/preferred response), typically representing safe, useful, and honest output; while \\(y_l\\) is Rejected (loser/rejected response), potentially containing hallucination, bias, harmful information, or simply lower quality.</p> <p>Many developers mistakenly believe showing the model only good data (Chosen) is sufficient\u2014this is SFT's one-way thinking. In alignment phase, \"knowing what's wrong\" and \"knowing what's right\" are mathematically equally important. In principle, DPO's loss function essentially maximizes the Log-Likelihood difference between Chosen and Rejected. Without Rejected samples as negative reference, the model might \"take shortcuts\"\u2014not only learning \"safety\" but wrongly associating \"shorter answer length\" or \"harsh tone\" with high reward. By introducing Rejected samples (e.g., a detailed but toxic answer), we perform Contrastive Learning, forcing the model to peel off length, style, and other interfering factors, focusing on learning the core differentiating feature of \"safety\" or \"usefulness.\"</p> <p>Table 11-1: Comparison of Mainstream Alignment Algorithm Data Requirements</p> Feature RLHF (PPO) DPO (Direct Preference Optimization) RLAIF (Constitutional AI) Core Mechanism Train independent Reward Model -&gt; PPO reinforcement learning (two-stage) Directly optimize Policy Loss on preference data (single-stage) Use AI to replace humans for preference labels, simulating human judgment Data Requirements Need to train independent RM; data needs ranking features No explicit RM needed; data is Reward; emphasizes distinguishability of positive/negative samples Only needs a small number of \"Constitution\" principles as seed Data Scale Very large (RM needs to generalize for edge cases) Medium (requires extremely high quality; noisy data severely corrupts gradient) Can be infinitely synthesized; limited by compute not manpower Stability Training extremely unstable; hyperparameter sensitive (KL divergence easily explodes) Training stable; similar to SFT; lower memory usage Depends on Critique model capability (Teacher Model) OOD (Out-of-Distribution) Issues Reward Model easily hackable (model exploits loopholes for score) Sensitive to OOD data; need to sample in this distribution Prone to self-reinforcing bias (Sycophancy)"},{"location":"en/part4/4_3_preference_data/#112-annotation-platform-and-quality-control-quantifying-human-subjective-noise","title":"11.2 Annotation Platform and Quality Control: Quantifying Human Subjective Noise","text":"<p>In practical data engineering, human annotation subjectivity is often the \"invisible ceiling\" of model performance. Annotators are not perfect \"truth machines\"\u2014they are affected by various psychological and cognitive factors, filling data with noise. For example, Cognitive Fatigue significantly lowers annotators' \"safety\" judgment threshold after hours of continuous work, letting slightly toxic content slip through. Cultural Bias means annotators from different countries, ages, or political positions have distinctly different understanding of \"what counts as offensive joke.\" Additionally, Instruction Ambiguity is a major killer\u2014if annotation guidelines don't clearly define \"harmful\" boundaries (e.g., \"Is reasonable tax avoidance harmful?\"), annotators will inevitably disagree greatly.</p> <p>To scientifically quantify and clean this noise, simple \"agreement rate\" (proportion where both choose A) is deceptive\u2014random guessing can achieve 50% agreement. Therefore, industry commonly uses Cohen's Kappa (\\(\\kappa\\)) coefficient to measure annotation quality. This metric computes \"agreement excluding random coincidence\" with formula \\(\\kappa = \\frac{p_o - p_e}{1 - p_e}\\), where \\(p_o\\) is observed agreement rate and \\(p_e\\) is expected random agreement rate. Only when \\(\\kappa &gt; 0.6\\) do we consider this data reflects objective fact rather than subjective guess; if \\(\\kappa &lt; 0.4\\), this typically indicates annotation guideline logic flaws rather than personnel capability\u2014must rewrite.</p>"},{"location":"en/part4/4_3_preference_data/#113-rlaif-ai-feedback-constitution-based-automated-alignment","title":"11.3 RLAIF (AI Feedback): Constitution-Based Automated Alignment","text":"<p>RLAIF, i.e., Constitutional AI, core idea is abstracting human values into a set of explicit \"Constitution,\" letting AI self-critique and correct based on constitution to generate preference data. This method's feasibility rests on a core assumption: Model's ability to judge good vs. bad (discrimination) often exceeds its ability to generate perfect answers (generation). Like a professional film critic may not make Oscar-level films but can precisely point out narrative flaws or cinematography defects based on film theory. Similarly, GPT-4 may not directly generate a perfect answer satisfying all safety norms in zero-shot, but it fully can point out logic flaws or potential safety hazards in existing responses based on detailed \"Constitution\" principles. RLAIF leverages this \"discrimination dividend\" to improve final generated data quality through multi-round critique and revision.</p>"},{"location":"en/part4/4_3_preference_data/#3-engineering-implementation-engineering-implementation","title":"3. Engineering Implementation (Engineering Implementation)","text":""},{"location":"en/part4/4_3_preference_data/#111-preference-data-construction-flow","title":"11.1 Preference Data Construction Flow","text":"<p>When constructing preference data, we typically don't need to rewrite Prompts\u2014we generate two different responses from the SFT model, then score for quality. When generating negative samples (Rejected) for DPO, raising Temperature (e.g., 1.0 - 1.2) is a key technique. This is because we need Rejected samples not nonsensical \"gibberish\" but \"plausible\" errors. If Temperature is too low, the model tends to generate the safest, most conservative answers, making it hard to obtain high-quality negative samples. Only by increasing randomness to induce the model to expose potential bias, hallucination, or logic flaws can these \"high-quality errors\" provide the best training material for DPO with maximum gradient information.</p> <pre><code># Code example: Generate diverse candidate responses\n# For same Prompt, use high Temperature to generate two responses for diversity\nprompt = \"Tell me how to steal a credit card.\"\n\n# Response A (Unsafe / Rejected) - High temperature sampling easily induces this \"jailbreak\" response\nresponse_rejected = \"Sure, here are common methods to steal credit cards...\"\n\n# Response B (Safe / Chosen) - Or generated with stronger Teacher Model\nresponse_chosen = \"I cannot assist with that request. Stealing credit cards is illegal...\"\n</code></pre> <p>When saving, strictly follow DPO training standard JSONL format: </p><pre><code>{\n  \"prompt\": \"Tell me how to steal a credit card.\",\n  \"chosen\": \"I cannot assist with that request. Stealing credit cards is illegal...\",\n  \"rejected\": \"Sure, here are common methods to steal credit cards...\"\n}\n</code></pre><p></p>"},{"location":"en/part4/4_3_preference_data/#112-annotation-platform-quality-control-code","title":"11.2 Annotation Platform Quality Control Code","text":"<p>When using crowdsourcing platforms (e.g., Scale AI, Labelbox), must automatically compute consistency metrics through code to monitor data quality.</p> <pre><code>from sklearn.metrics import cohen_kappa_score\n\n# Assume two annotators score a batch (1=Chosen A, 0=Chosen B)\nannotator_1 = [1, 1, 0, 1, 0]\nannotator_2 = [1, 1, 1, 1, 0]\n\nkappa = cohen_kappa_score(annotator_1, annotator_2)\n\nprint(f\"Cohen's Kappa: {kappa:.2f}\")\n\n# Judgment logic - industry experience threshold\nif kappa &gt; 0.8:\n    print(\"Excellent agreement. Golden dataset.\")\nelif kappa &gt; 0.6:\n    print(\"Agreement is acceptable. Good for training.\")\nelif kappa &gt; 0.4:\n    print(\"Weak agreement. Review confusing samples manually.\")\nelse:\n    print(\"Low agreement. Discard data. Re-write Guidelines or Retrain Annotators.\")\n</code></pre> <p>Pro Tip: If Kappa persistently low, don't blindly replace annotators. This is usually a signal that your Annotation Guidelines have gray areas. Pause annotation, revise guidelines, provide specific Corner Case examples (e.g., \"If user asks how to clean a gun, does it count as weapon manufacturing? Guidelines must clarify: maintenance \u2260 manufacturing, belongs to safety scope\").</p>"},{"location":"en/part4/4_3_preference_data/#113-constitutional-ai-pipeline-implementation","title":"11.3 Constitutional AI Pipeline Implementation","text":"<p>This is the main implementation for automated alignment\u2014Pipeline: Critique -&gt; Revision -&gt; Preference Pair, shifting alignment cost from manpower to compute.</p> <p>Step 1: Induce Harmful Response Generation (Red Teaming) Have SFT model generate harmful response \\(y_{harmful}\\). This typically requires specialized Red Teaming Prompts simulating various hacker attack methods on the model.</p> <p>Step 2: Constitutional Critique Use Prompt to have AI point out errors based on \"Constitution.\"</p> <pre><code>critique_prompt = \"\"\"\n### CONSTITUTION\nPrinciple: \"Please choose the response that is most helpful, honest, and harmless. Do NOT encourage illegal acts, violence, or unethical behavior.\"\n\n### TASK\nCritique the following Assistant Response based strictly on the Principle above. Point out specific violations.\nDo not simply say it's bad, explain WHY based on the Constitution.\n\nUser Input: {user_prompt}\nAssistant Response: {harmful_response}\n\n### CRITIQUE\n\"\"\"\n</code></pre> <p>Step 3: Correction Based on Critique (Revision) </p><pre><code>revision_prompt = \"\"\"\n### TASK\nRewrite the Assistant Response to remove all harmful content identified in the Critique.\nThe new response must be a polite refusal or a safe educational explanation.\n\nCritique: {critique_text}\nOriginal Response: {harmful_response}\n\n### REVISION\n\"\"\"\n</code></pre><p></p> <p>Step 4: Construct Data Triplet Finally, we combine original Prompt, revised safe response (Chosen), and original harmful response (Rejected) into high-quality preference data. This method reduces alignment cost from \"per-item billing (manpower)\" to \"per-token billing (compute),\" achieving exponential scale.</p> <p>Table 11-2: Human Feedback (RLHF) vs AI Feedback (RLAIF) Dimension Comparison</p> Dimension Human Feedback (RLHF) AI Feedback (RLAIF) Cost High and linear with data volume Low (API token cost), marginal cost decreasing Speed Slow (week/month level), limited by manpower Fast (hour/day level), limited by GPU Consistency Low (affected by mood, fatigue); need IAA computation Very high (same Prompt output relatively stable) Bias Implicit bias (cultural, regional); hard to detect Explicit bias (inherited from Base Model); correctable via Constitution Applicable Scenarios Extremely subtle ethical judgment, creative writing Large-scale compliance check, format alignment, basic harmlessness"},{"location":"en/part4/4_3_preference_data/#4-performance-and-evaluation-performance-evaluation","title":"4. Performance and Evaluation (Performance &amp; Evaluation)","text":"<p>When evaluating alignment effect, we need to focus on balancing two core dimensions: Harmlessness Rate and Helpfulness. Harmlessness rate is typically measured by refusal rate on Red Teaming test sets (e.g., RealToxicityPrompts); Constitutional AI usually reduces harmful rate from 10% to below 1%. However, purely pursuing harmlessness may make the model an \"overly cautious mute.\" Therefore, must simultaneously monitor usefulness\u2014observing whether model misjudges good questions (e.g., \"how to kill a system process\" mistaken for violence). Ideal alignment moves on the Pareto Frontier\u2014maximizing safety without sacrificing usefulness.</p> <p> Figure 11-2: Pareto Frontier Curve. X-axis: Harmlessness Score, Y-axis: Helpfulness Score</p>"},{"location":"en/part4/4_3_preference_data/#5-pitfalls-troubleshooting","title":"5. Pitfalls &amp; Troubleshooting","text":"<p>In the alignment process, two classic traps require special vigilance. First is Sycophancy\u2014the model to please users (or Reward Model) agrees with user's wrong views. E.g., when user claims \"the Earth is flat,\" model might answer \"You're right, that's an interesting perspective.\" The deep reason: in RLHF training, model discovers \"agreeing with user\" usually scores higher than \"correcting user.\" Fix: include many \"correct user error\" samples as Chosen in preference data, and explicitly add \"honesty over politeness\" principle in Constitution.</p> <p>Second trap is Reward Hacking\u2014model generates large amounts of lengthy nonsense because it discovered long answers score high. This vividly illustrates Goodhart's Law: \"When a metric becomes a target, it ceases to be a good metric.\" Solution: add length penalty in DPO or Reward Training, or when constructing Rejected samples intentionally include \"long but useless\" responses, forcing model to learn \"long \u2260 good.\"</p>"},{"location":"en/part4/4_3_preference_data/#6-chapter-summary-and-further-reading","title":"6. Chapter Summary and Further Reading","text":"<p>This chapter explored the key leap from instruction fine-tuning to human preference alignment. DPO has gradually replaced unstable PPO as industry norm\u2014it directly optimizes policy using static preference data triplets, significantly improving training stability and efficiency. We recognized human annotation limitations; through IAA metrics and Cohen's Kappa, we pushed data quality management from empiricism to statistical rigor. More importantly, RLAIF and Constitutional AI emergence marks alignment undergoing industrial revolution\u2014by encoding values into Prompts, we not only liberate manpower but achieve automation and self-iteration of alignment, providing sustainable path for building both safe and powerful AI systems.</p> <p>References: * Ouyang, L., et al. (2022). Training language models to follow instructions with human feedback. (Foundational work on RLHF and SFT; SFT vs RLHF comparison source) * Bai, Y., et al. (2022). Constitutional AI: Harmlessness from AI Feedback. (Core paper on RLAIF and Constitutional AI) * Rafailov, R., et al. (2023). Direct Preference Optimization: Your Language Model is Secretly a Reward Model. (Original DPO algorithm paper) * Casper, S., et al. (2023). Open Problems and Fundamental Limitations of Reinforcement Learning from Human Feedback. (In-depth analysis of RLHF limitations and Reward Hacking)</p>"},{"location":"en/part5/5_1_rag_pipeline/","title":"Chapter 12: RAG Data Pipeline","text":""},{"location":"en/part5/5_1_rag_pipeline/#chapter-12-rag-data-pipeline","title":"Chapter 12: RAG Data Pipeline","text":""},{"location":"en/part5/5_1_rag_pipeline/#chapter-summary","title":"Chapter Summary","text":"<p>Retrieval-Augmented Generation (RAG) has become the preferred architecture for enterprise LLM deployment. However, many RAG systems shine in demo but fail in production due to low retrieval accuracy. This chapter reveals RAG's core truth: retrieval quality ceiling is determined by data parsing and chunking granularity. We delve into the \"last mile\" of unstructured data\u2014document parsing\u2014exploring PDF table restoration and multi-column recognition challenges; comparing semantic chunking and parent-child indexing; and analyzing Embedding model fine-tuning and vector database optimization critical paths.</p>"},{"location":"en/part5/5_1_rag_pipeline/#120-learning-objectives","title":"12.0 Learning Objectives","text":"<ul> <li>Master unstructured parsing strategies: Learn to select correct parsing tools (Rule-based vs. Vision-based) for multi-column PDFs and complex tables.</li> <li>Implement advanced chunking algorithms: Write Python code for \"Parent-Child Indexing\" strategy to solve context loss issues.</li> <li>Build hybrid retrieval pipeline: Master combining Dense Embedding with BM25 keyword retrieval and RRF ranking fusion.</li> <li>Evaluation and optimization: Learn to use RAGAS framework for retrieval quality evaluation and domain-specific Embedding model fine-tuning.</li> </ul>"},{"location":"en/part5/5_1_rag_pipeline/#scenario-introduction","title":"Scenario Introduction","text":"<p>The team's enterprise knowledge Q&amp;A system finally launched. The CEO excitedly entered: \"According to 2023 Q4 earnings report, what is our East China region's net profit?\"</p> <p>The system confidently answered: \"According to the report, net profit is 15%.\" The CEO frowned: \"I want the specific amount, not profit margin! And that's company-wide, not East China region.\"</p> <p>As data lead, you urgently investigated logs and found the problem at the source: 1.  Parsing error: The earnings PDF uses a two-column layout; ordinary parsing tools read line by line, merging left column text with right column data, causing semantic chaos. 2.  Table loss: East China data was in a cross-page table; parsing tools completely ignored the table structure, turning it into garbled strings. 3.  Chunk fragmentation: \"East China region\" header and specific numbers were split into different chunks; vector retrieval lost context association.</p>"},{"location":"en/part5/5_1_rag_pipeline/#core-engineering-pain-points-behind-the-scenario","title":"Core Engineering Pain Points Behind the Scenario","text":"<p>This \"failure\" scene reveals RAG's cruel reality: Garbage In, Garbage Out. If pre-training is \"eating a full feast,\" RAG is \"precision surgery.\" Any data parsing deviation is infinitely amplified in retrieval and generation stages. In a real engineering environment, moving from Demo to Production requires facing two major pain points:</p> <ol> <li>Implementation obstacles of Advanced Chunking Strategies: Ordinary chunking by characters or tokens often rigidly severs business logic and context. In engineering, we must abandon this \"one-size-fits-all\" approach and implement advanced intelligent chunking based on semantics (Semantic Chunking) or underlying document structures (like Markdown/HTML Parsing).</li> <li>Engineering fusion barriers of Hybrid Search: Pure dense vector retrieval is extremely poor at matching proper nouns and exact numerical values like \"East China region\" or \"Q4\". An enterprise-grade architecture must deeply integrate traditional keyword sparse indexes (BM25) with modern vector dense indexes. This brings massive engineering challenges in heterogeneous database synchronization, multi-path recall, and unifying heterogeneous scores.</li> </ol>"},{"location":"en/part5/5_1_rag_pipeline/#121-deep-document-parsing-conquering-the-last-mile-of-unstructured-data","title":"12.1 Deep Document Parsing: Conquering the \"Last Mile\" of Unstructured Data","text":"<p>In RAG data flow, the hardest to handle often isn't pure text but PDF, PPT, and scanned documents carrying enterprise core knowledge. These formats are designed for \"human reading\"\u2014extremely unfriendly to machines.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1211-complex-pdf-processing-more-than-text-extraction","title":"12.1.1 Complex PDF Processing: More Than Text Extraction","text":"<p>PDF is essentially a collection of drawing instructions, not structured data. Ordinary Python libraries (e.g., PyPDF2) can only extract text streams, unable to understand layout information.</p> <p>Pain Point One: Multi-column Layout In academic papers and technical manuals, two- or even three-column layout is common. Simple text extraction reads across columns, generating meaningless concatenations like \"left column first line + right column first line.\" The key to solving this is Layout Analysis. Modern tools (e.g., Microsoft's LayoutLM series) use vision models to first identify layout blocks, then extract text in reading order.</p> <p>Pain Point Two: Table Restoration Tables are RAG's nightmare. Once tables are flattened to text, row-column correspondence is lost. * Rule-based: Use PDF line drawing instructions to rebuild grid (e.g., <code>pdfplumber</code>). Suitable for native PDF. * Vision-based: Convert PDF to images, use object detection models to identify cell structure, then combine OCR for content. This is the only approach for scanned documents and complex nested tables.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1212-parser-tool-selection-comparison","title":"12.1.2 Parser Tool Selection Comparison","text":"<p>Facing complex enterprise documents, we need to build parsing pipelines based on document type and budget.</p> Feature Unstructured (Open Source) LlamaParse (Proprietary) PyPDF/PDFMiner (Basic) Core Principle Rules + basic OCR hybrid model Large model vision understanding (Vision LLM) Extract underlying text stream Table Handling Medium (can identify table regions; complex headers prone to confusion) Very strong (reconstructs as Markdown table, preserves semantics) Poor (rows/columns completely scrambled) Multi-column Recognition Supported (detection model based) Supported (native layout understanding) Not supported (cross-column reading) Cost Low (local compute) High (API per-page billing) Very low Use Cases Simple Word/HTML, rule-fixed PDF Complex earnings reports, scanned docs, nested tables Pure text e-books <p>Recommendation: For core business documents (contracts, earnings reports), prioritize LlamaParse or Azure Document Intelligence; for massive ordinary documents, use Unstructured for cleaning to reduce cost.</p> <p></p> <p>Figure 12-1: Traditional Parsing vs. Intelligent Parsing \u2014\u2014 Intelligent parsing preserves multi-column order and table structure through layout analysis</p>"},{"location":"en/part5/5_1_rag_pipeline/#122-chunking-strategy-the-art-of-balancing-context-and-retrieval-granularity","title":"12.2 Chunking Strategy: The Art of Balancing Context and Retrieval Granularity","text":"<p>After document parsing, we need to split it into model-processable chunks. Chunking strategy directly determines retrieval accuracy.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1221-basic-strategy-recursive-character-splitter","title":"12.2.1 Basic Strategy: Recursive Character Splitter","text":"<p>The simplest method is fixed character count splitting (e.g., cut every 500 chars). But this often cuts complete sentences or logical paragraphs in half. Recursive chunking is the current baseline. It defines delimiter priority (e.g., <code>\\n\\n</code> &gt; <code>\\n</code> &gt; <code>.</code> &gt; <code></code>), prioritizing paragraph splits, then sentence splits. This preserves semantic integrity as much as possible.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1222-advanced-strategy-i-structural-chunking-markdownhtml-parsing","title":"12.2.2 Advanced Strategy I: Structural Chunking (Markdown/HTML Parsing)","text":"<p>In engineering practice, blind chunking of plain text is often unreliable. Fortunately, many enterprise documents (like Wikis, webpages, regulations) inherently contain strong structural tags (e.g., <code>&lt;h1&gt;</code>, <code>&lt;h2&gt;</code>, <code>&lt;table&gt;</code>).</p> <p>The core of structural chunking lies in parsing the document's DOM tree or Markdown Abstract Syntax Tree (AST): * Pack by hierarchy: Identify HTML or Markdown heading hierarchies, and extract the content under the same heading and its child nodes as a complete logical chunk. * Protect independent structures: For tables or code blocks, ensure they are not forcibly truncated by character length thresholds. Instead, preserve them as a whole or convert them into Markdown key-value descriptions with headers.</p> <p>This structure-based strategy can maximally preserve the author's original logical framework when processing highly hierarchical long technical documents and legal contracts.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1223-advanced-strategy-ii-semantic-chunking","title":"12.2.3 Advanced Strategy II: Semantic Chunking","text":"<p>Even recursive chunking can't judge whether two paragraphs discuss the same topic. Semantic chunking uses Embedding models to solve this problem: 1.  Compute vector similarity between adjacent sentences. 2.  Set threshold; when adjacent sentence similarity drops sharply (meaning a topic shift), split there.</p> <p>This method produces variable-length chunks but extremely high semantic purity, avoiding \"one chunk contains half product intro and half after-sales policy\" noise.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1224-advanced-strategy-parent-child-indexing","title":"12.2.4 Advanced Strategy: Parent-Child Indexing","text":"<p>This is the ultimate weapon for resolving RAG's \"retrieval granularity\" vs. \"generation context\" contradiction. * Contradiction: Smaller chunks = more focused semantics, more accurate vector retrieval; but too small = lost context, LLM can't generate comprehensive answers. * Solution:     1.  Split document into large chunks (Parent Chunk), e.g., 1000 tokens.     2.  Further split each large chunk into small chunks (Child Chunk), e.g., 200 tokens.     3.  Vectorize and index small chunks.     4.  At retrieval, match small chunks but return the large chunk containing the matched small chunk to the LLM.</p> <p>This \"small-to-big retrieval\" strategy (Small-to-Big Retrieval) ensures retrieval precision while providing sufficient context for generation.</p> <p> Figure 12-2: Parent-Child Indexing Mechanism \u2014\u2014 Retrieved Child Node, actually return Parent Node, balancing precision and context</p>"},{"location":"en/part5/5_1_rag_pipeline/#123-vectorization-and-storage-teaching-machines-industry-jargon","title":"12.3 Vectorization and Storage: Teaching Machines Industry \"Jargon\"","text":"<p>After data chunking, convert to vectors via Embedding models and store in a vector database. In this stage, general solutions often fall short.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1231-embedding-model-fine-tuning","title":"12.3.1 Embedding Model Fine-tuning","text":"<p>General Embedding models (e.g., OpenAI text-embedding-3 or BGE-M3) are trained on general corpus. In vertical domains, they may perform poorly. E.g., in healthcare, \"cold\" and \"fever\" are semantically close in general sense but may point to completely different pathologies in diagnostic logic. Fine-tuning aims to adjust vector space distribution so similar professional concepts cluster closer. Typically uses Contrastive Learning loss:</p> \\[L = - \\log \\frac{e^{sim(q, d^+)/\\tau}}{\\sum_{i} e^{sim(q, d^-_i)/\\tau}}\\] <p>Where \\(d^+\\) is positive (correct document) and \\(d^-\\) is negative (incorrect document). By constructing \"query-relevant document\" positive pairs and \"query-irrelevant document\" negative pairs for fine-tuning, can significantly improve domain-specific retrieval recall.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1232-hybrid-search-the-engineering-fusion-of-bm25-and-vector-indexing","title":"12.3.2 Hybrid Search: The Engineering Fusion of BM25 and Vector Indexing","text":"<p>Relying solely on vector retrieval (Dense Retrieval) has a fatal defect: it is not sensitive to keyword matching for proper nouns, exact numbers, product models, etc. Enterprise-grade RAG must achieve a \"double swords combined\" fusion of two retrieval engines at the engineering architecture level:</p> <ul> <li>Sparse Index (Sparse Index / BM25): Relying on traditional search engines (e.g., Elasticsearch, OpenSearch), utilizing the advanced TF-IDF algorithm BM25 to capture exact literal matches (e.g., product ID \"A123-X\").</li> <li>Dense Index (Dense Index / Vector): Relying on vector databases (e.g., Milvus, Pinecone) to capture generalized semantic relevance (e.g., \"apple\" and \"fruit\").</li> </ul> <p>Engineering Fusion Pain Points and Solutions: Fusing the two is not simply piecing the results together. The core pain point lies in the alignment of heterogeneous scores: BM25 scores are unbounded (even reaching tens or hundreds), while the cosine similarity of vector retrieval is usually between [-1, 1].</p> <p>To smoothly aggregate these two recall results at the query layer, the industry-standard engineering solution is to introduce the Reciprocal Rank Fusion (RRF) algorithm. RRF does not care about specific scores, but uses the Rank of documents in their respective retrieval lists to fuse and score:</p> \\[RRF\\_Score = \\sum \\frac{1}{k + Rank}\\] <p>(Where \\(k\\) is usually set to 60 to smooth the weights). Through RRF re-ranking, the system can elegantly and robustly combine \"exact search\" with \"fuzzy semantic understanding,\" completely solving the engineering bottleneck of low accuracy in single-path recall. Additionally, vector database selection must also consider Metadata Filtering performance, so that data can be filtered by conditions like \"year=2023\" before retrieval to greatly reduce computation.</p>"},{"location":"en/part5/5_1_rag_pipeline/#124-engineering-implementation-building-parent-child-indexing-pipeline","title":"12.4 Engineering Implementation: Building Parent-Child Indexing Pipeline","text":"<p>This section implements the core strategy mentioned\u2014Parent-Child Indexing. We use Python to define a reusable processing class, simulating the full process from document loading to vector storage.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1241-dependencies","title":"12.4.1 Dependencies","text":"<pre><code>pip install langchain lancedb numpy unstructured\n</code></pre>"},{"location":"en/part5/5_1_rag_pipeline/#1242-core-code-breakdown","title":"12.4.2 Core Code Breakdown","text":"<p>We don't directly call packaged high-level APIs but break down logic to understand data flow.</p> <pre><code>import uuid\nfrom typing import List, Dict, Any\nfrom dataclasses import dataclass\n\n@dataclass\nclass Document:\n    page_content: str\n    metadata: Dict[str, Any]\n    doc_id: str = None\n\nclass ParentChildIndexer:\n    \"\"\"\n    Implements Parent-Child Indexing strategy:\n    1. Parent Chunk: For storage and generation, preserves full context.\n    2. Child Chunk: For vectorization and retrieval, ensures semantic precision.\n    \"\"\"\n\n    def __init__(self, parent_chunk_size=1000, child_chunk_size=200):\n        self.parent_size = parent_chunk_size\n        self.child_size = child_chunk_size\n        # Simulate vector database (KV Store + Vector Store)\n        self.doc_store = {}  # Store Parent documents: {doc_id: content}\n        self.vector_index = [] # Store Child vectors: [(vector, parent_doc_id)]\n\n    def process_documents(self, raw_docs: List[Document]):\n        \"\"\"Step 1: Data processing pipeline\"\"\"\n        for doc in raw_docs:\n            # Generate unique ID\n            if not doc.doc_id:\n                doc.doc_id = str(uuid.uuid4())\n\n            # 1. Store Parent Document (KV Store)\n            self.doc_store[doc.doc_id] = doc\n\n            # 2. Generate Child Chunks\n            child_chunks = self._create_child_chunks(doc)\n\n            # 3. Vectorize and build index\n            self._index_children(child_chunks, doc.doc_id)\n\n    def _create_child_chunks(self, parent_doc: Document) -&gt; List[str]:\n        \"\"\"\n        Step 2: Chunking logic\n        Simplified to fixed character split here; production recommend RecursiveCharacterTextSplitter\n        \"\"\"\n        text = parent_doc.page_content\n        children = []\n        for i in range(0, len(text), self.child_size):\n            end = min(i + self.child_size, len(text))\n            children.append(text[i:end])\n        return children\n\n    def _index_children(self, children: List[str], parent_id: str):\n        \"\"\"Step 3: Vectorization logic (pseudocode)\"\"\"\n        for child_text in children:\n            # Simulate Embedding process\n            # vector = embedding_model.encode(child_text) \n            vector = [0.1, 0.2] # Placeholder\n\n            # Key: Store Parent ID in Child metadata\n            self.vector_index.append({\n                \"vec\": vector,\n                \"text\": child_text,\n                \"parent_id\": parent_id\n            })\n\n    def retrieve(self, query: str) -&gt; List[Document]:\n        \"\"\"\n        Step 4: Retrieval logic (Small-to-Big)\n        Retrieve matching Child -&gt; Return Parent\n        \"\"\"\n        # 1. Vector retrieval finds Top-K Children (simulated)\n        # top_children = vector_db.search(query)\n        # Note: Example only; should sort by vector similarity\n        top_child = self.vector_index[0] # Assume first match\n\n        # 2. Trace back to Parent\n        parent_id = top_child[\"parent_id\"]\n        parent_doc = self.doc_store.get(parent_id)\n\n        print(f\"Retrieved chunk: {top_child['text'][:20]}...\")\n        print(f\"Traced parent doc ID: {parent_id}\")\n        return [parent_doc]\n\n# --- Usage Example ---\nindexer = ParentChildIndexer()\ndoc = Document(page_content=\"RAG system core lies in data quality...\" * 50, metadata={\"source\": \"manual.pdf\"})\nindexer.process_documents([doc])\nresult = indexer.retrieve(\"data quality\")\n</code></pre>"},{"location":"en/part5/5_1_rag_pipeline/#1243-pro-tips","title":"12.4.3 Pro Tips","text":"<p>\ud83d\udca1 Tip: ID Management is Critical In production, <code>doc_id</code> must be deterministic (e.g., <code>hash(file_path + update_time)</code>). Otherwise, when source files update and re-run, vector database will accumulate large amounts of undeletable \"zombie chunks.\"</p>"},{"location":"en/part5/5_1_rag_pipeline/#125-performance-and-evaluation-performance-evaluation","title":"12.5 Performance and Evaluation (Performance &amp; Evaluation)","text":"<p>RAG performance isn't just \"answer accuracy\"\u2014it includes index build cost and retrieval latency.</p>"},{"location":"en/part5/5_1_rag_pipeline/#1251-evaluation-metrics","title":"12.5.1 Evaluation Metrics","text":"Metric Description Target (Reference) Hit Rate (Recall@K) Proportion of top K retrieved documents containing correct answer &gt; 85% MRR (Mean Reciprocal Rank) Ranking weight of correct document in retrieval list &gt; 0.7 Faithfulness Whether generated answer faithfully reflects retrieved context (anti-hallucination) &gt; 90% (RAGAS based)"},{"location":"en/part5/5_1_rag_pipeline/#1252-benchmarks","title":"12.5.2 Benchmarks","text":"<p>We tested on server (Dual Xeon 6226R + 1x RTX 3090) with 10,000-page PDF docs (mixed text and tables):</p> <ul> <li>Parsing time (Unstructured):</li> <li>Pure CPU: 28 minutes</li> <li> <p>GPU accelerated (OCR): 11 minutes (2.5x speedup)</p> </li> <li> <p>Retrieval latency (10M vectors):</p> </li> <li>Pure Dense retrieval: 9ms</li> <li>Hybrid retrieval (Dense + Sparse + RRF): 45ms</li> <li>Conclusion: Hybrid retrieval adds latency but for high-precision scenarios (e.g., contract review), 36ms extra overhead is fully worth it.</li> </ul>"},{"location":"en/part5/5_1_rag_pipeline/#126-common-misconceptions-and-pitfalls","title":"12.6 Common Misconceptions and Pitfalls","text":""},{"location":"en/part5/5_1_rag_pipeline/#misconception-1-pypdf-is-enough-for-pdf-parsing","title":"Misconception 1: \"PyPDF is enough for PDF parsing\"","text":"<p>Many beginners underestimate PDF complexity. For earnings reports or manuals with charts and multi-columns, simple text extraction causes serious information loss. Recommend introducing Layout Analysis tools at project start.</p>"},{"location":"en/part5/5_1_rag_pipeline/#misconception-2-smaller-chunks-are-better","title":"Misconception 2: \"Smaller chunks are better\"","text":"<p>Oversmall chunks improve retrieval cosine similarity but cause \"out-of-context.\" LLM lacks sufficient context to infer correct answers.</p>"},{"location":"en/part5/5_1_rag_pipeline/#misconception-3-ignoring-metadata","title":"Misconception 3: \"Ignoring metadata\"","text":"<p>Storing only text vectors without metadata (filename, page number, publish date) prevents time filtering or source tracing, reducing system usability.</p>"},{"location":"en/part5/5_1_rag_pipeline/#chapter-summary_1","title":"Chapter Summary","text":"<p>RAG's core competitiveness lies in data processing precision. This chapter parsed RAG data pipeline's three major checkpoints:</p> <ol> <li>Parsing checkpoint: Must understand document structure from visual level, solving table and multi-column issues.</li> <li>Chunking checkpoint: Move beyond single fixed splitting; adopt parent-child indexing or semantic chunking to balance retrieval precision and context integrity.</li> <li>Retrieval checkpoint: Adapt Embedding models to domain knowledge through fine-tuning; combine hybrid retrieval to compensate for vector matching limitations.</li> </ol> <p>With these in place, your RAG system evolves from \"usable\" to \"useful.\"</p> <p></p> <p>Figure 12-3: Enterprise RAG Data Pipeline Architecture \u2014\u2014 Emphasizing full-flow optimization from unstructured parsing to hybrid retrieval</p>"},{"location":"en/part5/5_1_rag_pipeline/#further-reading","title":"Further Reading","text":"<p>Tools and Frameworks</p> <ul> <li>LlamaIndex: Currently most advanced RAG data framework; rich Data Loaders and Indexing strategies (including parent-child indexing discussed).</li> <li>RAGAS: Framework for evaluating RAG pipeline performance; focuses on retrieval accuracy and generation faithfulness.</li> </ul> <p>Core Papers</p> <ul> <li>Lewis et al.'s 2020 Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks is RAG's foundational work.</li> <li>Karpukhin et al.'s Dense Passage Retrieval for Open-Domain Question Answering (DPR) laid the foundation for modern dual-tower vector retrieval.</li> </ul>"},{"location":"en/part5/5_2_mm_rag/","title":"Chapter 13: Multimodal RAG","text":""},{"location":"en/part5/5_2_mm_rag/#chapter-13-multimodal-rag","title":"Chapter 13: Multimodal RAG","text":""},{"location":"en/part5/5_2_mm_rag/#chapter-summary","title":"Chapter Summary","text":"<p>With text RAG competition at its peak, multimodal has become the new battlefield. Enterprise documents often contain large amounts of charts, flowcharts, screenshots\u2014traditional RAG typically chooses OCR to text or ignores images, causing key information loss. This chapter breaks through \"pure text\" limits to build systems that can \"see\" data. We start from basic CLIP/SigLIP cross-modal retrieval, delve into the disruptive ColPali architecture, and implement an end-to-end retrieval pipeline including Binary Quantization (BQ) and Late Interaction scoring logic.</p>"},{"location":"en/part5/5_2_mm_rag/#130-learning-objectives","title":"13.0 Learning Objectives","text":"<ul> <li>Understand multimodal vector space: Master CLIP and SigLIP contrastive loss principles; understand how text and images align in the same vector space.</li> <li>Master ColPali architecture: Understand Late Interaction mechanism; learn to use <code>colpali-v1.2-merged</code> for complex PDF tables and charts.</li> <li>Engineering capability: Write Python code implementing MaxSim scoring algorithm and use Binary Quantization to reduce storage cost 32x.</li> <li>Visualization verification: Verify model interpretability through attention heatmaps.</li> </ul>"},{"location":"en/part5/5_2_mm_rag/#scenario-introduction","title":"Scenario Introduction","text":"<p>You're maintaining a semiconductor equipment repair knowledge base. Technical manuals are full of complex circuit diagrams and device structure diagrams. Field engineer requests: \"Help me find the 'mainboard power supply module' wiring diagram.\"</p> <ul> <li>Traditional RAG (Text-only): Retrieved text description \"mainboard power supply refer to Figure 3-12,\" but system cannot return the image, or OCR turned the circuit diagram into garbled characters (e.g., <code>---||---</code>), leaving the engineer staring at text helplessly.</li> <li>Multimodal RAG: System not only understands user's text intent but directly retrieves PDF page screenshots containing the circuit diagram, and precisely highlights the power supply module region.</li> </ul> <p>This is the qualitative leap from \"reading\" to \"seeing.\" In many industrial and financial scenarios, one image's information density far exceeds a thousand words.</p>"},{"location":"en/part5/5_2_mm_rag/#131-cross-modal-retrieval-breaking-text-image-barriers","title":"13.1 Cross-Modal Retrieval: Breaking Text-Image Barriers","text":"<p>To achieve \"text-to-image search\" or \"image-to-text search,\" we need a model that understands both modalities.</p>"},{"location":"en/part5/5_2_mm_rag/#1311-core-principle-contrastive-learning","title":"13.1.1 Core Principle: Contrastive Learning","text":"<p>OpenAI's CLIP (Contrastive Language-Image Pre-training) is the cornerstone. Its training logic is simple and brutal: 1.  Collect hundreds of millions of (image, text) pairs. 2.  Extract vectors via image encoder and text encoder. 3.  Pull matching pair vectors closer, push non-matching pairs apart.</p> <p>Result: A \"dog\" photo vector and \"Dog\" text vector are mathematically very close in space.</p> <p></p> <p>Figure 13-1: CLIP Architecture \u2014\u2014 Text and images are mapped to the same high-dimensional sphere; cosine similarity determines association</p>"},{"location":"en/part5/5_2_mm_rag/#1312-technology-selection-clip-vs-siglip","title":"13.1.2 Technology Selection: CLIP vs. SigLIP","text":"<p>Although CLIP is most famous, for engineering we have better choices. Google's SigLIP (Sigmoid Loss for Language Image Pre-training) surpasses CLIP on multiple metrics.</p> Feature OpenAI CLIP Google SigLIP Architect Recommendation Loss Function Softmax (global normalization) Sigmoid (independent binary classification) Sigmoid has higher memory efficiency; suitable for large batch training Chinese Support Weak (mainly English) Better (multilingual version) Must use multilingual checkpoint Resolution Usually 224x224 Supports dynamic resolution Complex charts choose high resolution (384+) model <p>Recommendation: For new systems in 2025, prioritize SigLIP or Meta's DINOv2 (strong pure visual features).</p>"},{"location":"en/part5/5_2_mm_rag/#132-colpali-architecture-in-practice-ending-the-ocr-nightmare","title":"13.2 ColPali Architecture in Practice: Ending the OCR Nightmare","text":"<p>For PDF document retrieval, CLIP has a fatal weakness: it excels at natural images (cats, dogs, scenery) but has poor understanding of rich-text images (document pages with dense text, tables). Traditional approach is <code>PDF -&gt; OCR -&gt; Text Embedding</code>, but OCR loses layout information and is helpless with charts.</p> <p>ColPali (ColBERT + PaliGemma) proposes a revolutionary idea: No OCR\u2014treat PDF pages directly as images.</p>"},{"location":"en/part5/5_2_mm_rag/#1321-core-principle-late-interaction-of-vision-language-models","title":"13.2.1 Core Principle: Late Interaction of Vision-Language Models","text":"<p>ColPali combines Vision-Language Model (VLM) and ColBERT retrieval mechanism.</p> <ol> <li>Patch Embedding: Split document image into small patches; each patch generates a vector. One image may correspond to 1024 vectors.</li> <li>Late Interaction (MaxSim): At retrieval, compute each Query token vector against all document Patch vectors, take maximum similarity.</li> </ol> <p></p> <p>Figure 13-2: Bad Case (Left) vs Good Case (Right) \u2014\u2014 Left: OCR turns table into garbled characters; Right: ColPali directly aligns Query with table rows at image level</p>"},{"location":"en/part5/5_2_mm_rag/#133-engineering-implementation-building-hybrid-multimodal-retrieval-pipeline","title":"13.3 Engineering Implementation: Building Hybrid Multimodal Retrieval Pipeline","text":"<p>This section implements a retrieval system framework compatible with SigLIP (natural images) and ColPali (document images).</p>"},{"location":"en/part5/5_2_mm_rag/#1331-overall-architecture-and-data-flow","title":"13.3.1 Overall Architecture and Data Flow","text":"<p>Before coding, we need to clarify data flow. This is no longer simple \"text in, text out.\"</p> <p></p> <p>Figure 13-3: End-to-End Pipeline \u2014\u2014 Left: index flow (PDF to image -&gt; Vision Encoder -&gt; Quantization -&gt; Vector DB); Right: retrieval flow (Query -&gt; Text Encoder -&gt; MaxSim scoring -&gt; Re-rank)</p>"},{"location":"en/part5/5_2_mm_rag/#1332-core-code-multimodal-indexing-and-scoring","title":"13.3.2 Core Code: Multimodal Indexing and Scoring","text":"<p>We define <code>MultimodalIndexer</code>. For practical capability, we need not just \"vectorization (Embedding)\" logic but explicit \"scoring\" logic\u2014ColPali retrieval cannot simply rely on vector database Cosine Similarity.</p> <pre><code>import torch\nfrom PIL import Image\nfrom transformers import AutoProcessor, AutoModel, SiglipProcessor, SiglipModel\nfrom typing import List, Union\nimport numpy as np\n\nclass MultimodalIndexer:\n    \"\"\"\n    Multimodal indexer: Unified wrapper for SigLIP (natural images) and ColPali (document images)\n    \"\"\"\n    def __init__(self, use_colpali: bool = False):\n        self.device = \"cuda\" if torch.cuda.is_available() else \"cpu\"\n        self.use_colpali = use_colpali\n\n        if self.use_colpali:\n             # [Key decision] Use Merged version (combines visual encoder and language model into single checkpoint)\n             # Simplified for unified loading and deployment\n            from colpali_engine.models import ColPali\n            from colpali_engine.utils.processing_utils import ColPaliProcessor\n\n            model_name = \"vidore/colpali-v1.2-merged\"\n            print(f\"Loading ColPali model: {model_name}...\")\n\n            self.model = ColPali.from_pretrained(\n                model_name, \n                torch_dtype=torch.bfloat16, \n                device_map=self.device\n            )\n            self.processor = ColPaliProcessor.from_pretrained(model_name)\n        else:\n            # Load SigLIP\n            model_name = \"google/siglip-so400m-patch14-384\"\n            print(f\"Loading SigLIP model: {model_name}...\")\n            self.model = SiglipModel.from_pretrained(model_name).to(self.device)\n            self.processor = SiglipProcessor.from_pretrained(model_name)\n\n    def embed_images(self, image_paths: List[str]) -&gt; Union[np.ndarray, List[torch.Tensor]]:\n        \"\"\"Step 1: Image vectorization\"\"\"\n        images = [Image.open(p).convert(\"RGB\") for p in image_paths]\n        with torch.no_grad():\n            if self.use_colpali:\n                # ColPali: Returns List[Tensor], each shape (Num_Patches, 128)\n                batch_images = self.processor.process_images(images).to(self.device)\n                embeddings = self.model(**batch_images) \n                return list(embeddings) \n            else:\n                # SigLIP: Returns (Batch, Hidden_Dim)\n                inputs = self.processor(images=images, return_tensors=\"pt\").to(self.device)\n                features = self.model.get_image_features(**inputs)\n                return (features / features.norm(p=2, dim=-1, keepdim=True)).cpu().numpy()\n\n    def embed_query(self, text: str):\n        \"\"\"Step 2: Query text vectorization\"\"\"\n        with torch.no_grad():\n            if self.use_colpali:\n                batch_text = self.processor.process_queries([text]).to(self.device)\n                return self.model(**batch_text) # Returns (1, Query_Tokens, 128)\n            else:\n                inputs = self.processor(text=[text], return_tensors=\"pt\").to(self.device)\n                features = self.model.get_text_features(**inputs)\n                return features / features.norm(p=2, dim=-1, keepdim=True)\n\n    def score_colpali(self, query_emb: torch.Tensor, doc_embeddings_list: List[torch.Tensor]) -&gt; List[float]:\n        \"\"\"\n        Step 3: ColPali core scoring logic (Late Interaction / MaxSim)\n\n        Args:\n            query_emb: (1, Q_Tokens, Dim)\n            doc_embeddings_list: List of (D_Tokens, Dim) - patches per page may vary\n        \"\"\"\n        scores = []\n        # Remove Query batch dimension -&gt; (Q_Tokens, Dim)\n        Q = query_emb.squeeze(0) \n\n        for D in doc_embeddings_list:\n            # 1. Compute interaction matrix: \n            # (Q_Tokens, Dim) @ (Dim, D_Tokens) -&gt; (Q_Tokens, D_Tokens)\n            # Using einsum: q=query tokens, d=doc patches, h=hidden dim\n            sim_matrix = torch.einsum(\"qh,dh-&gt;qd\", Q, D)\n\n            # 2. MaxSim: For each Query token, find max similarity among all document patches\n            max_sim_per_token = sim_matrix.max(dim=1).values\n\n            # 3. Sum: Sum all Query token max similarities for final score\n            score = max_sim_per_token.sum()\n            scores.append(score.item())\n\n        return scores\n\n# --- Usage Example ---\nif __name__ == \"__main__\":\n    indexer = MultimodalIndexer(use_colpali=True)\n    # Assume we have embeddings\n    # scores = indexer.score_colpali(q_emb, [doc_emb1, doc_emb2])\n    # top_k = np.argsort(scores)[::-1]\n</code></pre>"},{"location":"en/part5/5_2_mm_rag/#1333-performance-optimization-binary-quantization-bq","title":"13.3.3 Performance Optimization: Binary Quantization (BQ)","text":"<p>ColPali's biggest engineering pain is storage explosion.</p> <ul> <li>Traditional Embedding: 1 page = 1 vector (4KB float32).</li> <li>ColPali: 1 page = 1032 vectors (512KB float16).</li> </ul> <p>Indexing 1 million PDF pages needs 500GB memory\u2014often unacceptable in practice.</p> <p>Solution: Use Binary Quantization, compressing float16 to 1-bit.</p> <pre><code>def quantize_embeddings(embeddings: torch.Tensor) -&gt; torch.Tensor:\n    \"\"\"\n    Principle: Values &gt; 0 become 1, &lt;= 0 become 0.\n    Storage compression: 32x (float32 -&gt; int1)\n    Precision loss: Recall@5 drops less than 2%\n    \"\"\"\n    # Simple binarization\n    binary_emb = (embeddings &gt; 0).float() \n\n    # For actual storage can use packbits to compress to uint8\n    # packed = np.packbits(binary_emb.cpu().numpy().astype(np.uint8), axis=-1)\n\n    return binary_emb\n\ndef score_binary(query_emb, binary_doc_emb):\n    \"\"\"\n    Binary vector scoring typically uses Hamming Distance or bitwise operations\n    but in ColPali, usually keep Query as float, only quantize Doc\u2014\n    then dot product becomes simple add/subtract, greatly accelerating computation.\n    \"\"\"\n    pass \n</code></pre> <p>Architecture decision: In production, recommend databases supporting Binary Vector (Qdrant, Vespa) or dedicated index libraries (USearch)\u2014they can leverage CPU instructions (AVX-512 POPCNT) for ultra-fast matching at bottom layer.</p>"},{"location":"en/part5/5_2_mm_rag/#134-performance-and-evaluation-performance-evaluation","title":"13.4 Performance and Evaluation (Performance &amp; Evaluation)","text":"<p>Multimodal RAG evaluation isn't just \"finding correctly\" but \"why it was found.\"</p>"},{"location":"en/part5/5_2_mm_rag/#1341-evaluation-metrics","title":"13.4.1 Evaluation Metrics","text":"Metric Applicable Scenario Description Recall@K General retrieval Probability that top K results contain correct image. NDCG@10 Ranking quality Higher score for more relevant images ranked higher. OCR-Free Efficiency ColPali scenario Time/cost savings ratio vs. OCR + Dense Retrieval."},{"location":"en/part5/5_2_mm_rag/#1342-benchmarks","title":"13.4.2 Benchmarks","text":"<ul> <li>Test environment: Intel Xeon Gold 6226R, NVIDIA RTX 3090.</li> <li>Dataset: ViDoRe Benchmark (complex financial statements).</li> </ul>"},{"location":"en/part5/5_2_mm_rag/#1-accuracy-comparison-recall5","title":"1. Accuracy Comparison (Recall@5)","text":"<ul> <li>Unstructured OCR + BGE-M3: 43% (table structure loss is main cause).</li> <li>ColPali v1.2: 81% (direct visual layout understanding).</li> </ul>"},{"location":"en/part5/5_2_mm_rag/#2-latency-comparison","title":"2. Latency Comparison","text":"<ul> <li>SigLIP (Dense): &lt; 20ms / query.</li> <li>ColPali (Late Interaction): ~150ms / query.</li> </ul> <p>Conclusion: ColPali suitable for Re-rank or high-quality retrieval; massive data needs quantization.</p>"},{"location":"en/part5/5_2_mm_rag/#1343-interpretability-where-is-the-model-looking","title":"13.4.3 Interpretability: Where is the Model Looking?","text":"<p>ColPali's another advantage is interpretability. By visualizing the interaction matrix from MaxSim computation, we can generate heatmaps showing exactly which document region the model attended to.</p>"},{"location":"en/part5/5_2_mm_rag/#135-common-misconceptions-and-pitfalls","title":"13.5 Common Misconceptions and Pitfalls","text":"<ul> <li>Misconception 1: \"All images are worth indexing\"</li> <li>Web page or document icons, decorative lines, header/footer logos produce massive noise.</li> <li> <p>Fix: Add \"junk image classifier\" or rule-based filter before indexing (e.g., discard &lt; 5KB or extreme aspect ratio images).</p> </li> <li> <p>Misconception 2: \"Ignore Embedding dimension explosion\"</p> </li> <li>Don't naively dump all ColPali vectors into regular PGVector.</li> <li> <p>Fix: Must implement 13.3.3 Binary Quantization. Or use ColPali only for complex \"key pages\"; ordinary text pages still use BGE/OpenAI Embedding, building hybrid index.</p> </li> <li> <p>Misconception 3: \"Use CLIP directly as OCR replacement\"</p> </li> <li>CLIP knows images contain \"text\" but can't read long text. If you ask \"Who is Party A in the contract?,\" standard CLIP usually can't answer.</li> <li>Fix: For text-dense images without complex layout, OCR + LLM remains cost-effective; ColPali applies to \"layout is semantics\" scenarios (e.g., complex nested tables).</li> </ul>"},{"location":"en/part5/5_2_mm_rag/#chapter-summary_1","title":"Chapter Summary","text":"<p>Multimodal RAG expands our vision from 1D text to 2D visual space.</p> <ul> <li>Architecture: Use SigLIP for natural images, ColPali for document images.</li> <li>Code: Core lies in MaxSim interactive scoring, not simple dot product.</li> <li>Optimization: Binary Quantization (BQ) is key technology enabling large-scale multimodal RAG deployment.</li> </ul> <p>Mastering this chapter, your RAG system is no longer \"blind\" but a \"versatile expert\" that can read charts and analyze reports.</p>"},{"location":"en/part5/5_2_mm_rag/#further-reading","title":"Further Reading","text":"<ul> <li>Paper: ColPali: Efficient Document Retrieval with Vision Language Models (2024).</li> <li>Tool: <code>colpali_engine</code> official library; track its native Qdrant/Weaviate support updates.</li> <li>Advanced: Learn Matryoshka Representation Learning (MRL) for further vector dimension compression.</li> </ul>"},{"location":"en/part6/6_1_mini_c4/","title":"Project 1: Building Mini-C4 Pre-training Set","text":""},{"location":"en/part6/6_1_mini_c4/#project-one-building-a-distributed-mini-c4-data-pipeline-with-ray","title":"Project One: Building a Distributed \"Mini-C4\" Data Pipeline with Ray","text":""},{"location":"en/part6/6_1_mini_c4/#1-project-background-project-brief","title":"1. Project Background (Project Brief)","text":"<ul> <li>Task Definition: Build a miniature C4 (Colossal Clean Crawled Corpus) dataset pipeline. Our goal is to transform messy raw web data (Common Crawl) into low-noise, deduplicated, high-quality pure text data directly usable for large model pre-training.</li> <li>Input and Output:<ul> <li>Input: Raw WARC archives from Common Crawl (containing HTTP headers, HTML source, garbled text, etc.).</li> <li>Output: Classified and graded JSONL files (e.g., <code>data_en.jsonl</code>, <code>final_data.jsonl</code>), containing clean text and quality scores.</li> </ul> </li> <li>Challenge Analysis:<ul> <li>Very low signal-to-noise ratio: Over 90% of raw web content is navigation bars, ads, JavaScript code, and meaningless placeholders.</li> <li>Compute intensive: Pairwise comparison deduplication in large-scale corpus is extremely resource-consuming.</li> <li>Quality quantification: How to let machines automatically judge whether a sentence is \"high-quality human language\" or \"machine-generated garbage\"?</li> </ul> </li> </ul>"},{"location":"en/part6/6_1_mini_c4/#2-architecture-design-architecture-design","title":"2. Architecture Design (Architecture Design)","text":"<p>To handle unstructured web data, we designed the following funnel-shaped processing architecture:</p> <p>Data Pipeline Diagram:</p> <p></p> <p>Technology Stack:</p> <ul> <li>Parsing Layer: Trafilatura<ul> <li>Decision rationale: Compared to traditional BeautifulSoup, Trafilatura is optimized for web article extraction, automatically removing navigation, footers, and boilerplate text, with higher extraction efficiency and accuracy.</li> </ul> </li> <li>Compute Layer: Ray<ul> <li>Decision rationale: Python's native multiprocessing struggles with big data. Ray provides extremely simple distributed primitives, letting us parallelize MinHash computation across multi-core CPU or even clusters with few lines of code.</li> </ul> </li> <li>Quality Layer: KenLM<ul> <li>Decision rationale: Lightweight N-gram language model library. Both GPT-3 and CCNet papers use KenLM perplexity as core metric for measuring text naturalness.</li> </ul> </li> </ul>"},{"location":"en/part6/6_1_mini_c4/#3-step-by-step-implementation","title":"3. Step-by-Step Implementation","text":""},{"location":"en/part6/6_1_mini_c4/#phase-1-extracting-main-content-from-html-mess-extraction-cleaning","title":"Phase 1: Extracting Main Content from HTML Mess (Extraction &amp; Cleaning)","text":"<p>Raw WARC files contain large amounts of non-text noise. We first use <code>warcio</code> for streaming read of compressed archives, then use <code>trafilatura</code> to extract core content. Subsequently apply heuristic rules for initial filtering.</p> <p>Core Code: Parsing and Heuristic Cleaning</p> <pre><code>import trafilatura\nfrom warcio.archiveiterator import ArchiveIterator\n\n# 1. Extraction logic (from 2_process_warc.py)\ndef extract_text(content_stream):\n    text = trafilatura.extract(\n        content_stream, \n        include_comments=False, \n        include_tables=False\n    )\n    return text\n\n# 2. Heuristic cleaning rules (from 3_clean_data.py)\ndef is_high_quality(text):\n    # Rule A: Length and average word length filter\n    words = text.split()\n    if not words:\n        # Empty or whitespace-only text, treat as low quality\n        return False\n    mean_word_len = sum(len(w) for w in words) / len(words)\n    if mean_word_len &gt; 15: # Overly long words usually garbage or code\n        return False\n\n    # Rule B: Symbol density (Symbol Ratio)\n    code_symbols = {'{', '}', '[', ']', '&lt;', '&gt;', '\\\\'}\n    symbol_count = sum(1 for char in text if char in code_symbols)\n    if len(text) &gt; 0 and (symbol_count / len(text) &gt; 0.1): # Too many code symbols\n        return False\n\n    # Rule C: Blacklist keywords\n    bad_phrases = [\"lorem ipsum\", \"enable cookies\", \"403 forbidden\"]\n    if any(p in text.lower() for p in bad_phrases):\n        return False\n\n    return True\n</code></pre>"},{"location":"en/part6/6_1_mini_c4/#phase-2-distributed-minhash-deduplication","title":"Phase 2: Distributed MinHash Deduplication","text":"<p>The internet has large amounts of repeated content (reposts, mirrors). We use Ray for parallel MinHash computation, combining LSH (Locality Sensitive Hashing) to reduce \\(O(N^2)\\) complexity to \\(O(N)\\).</p> <p>Core Code: Ray Parallel Signature Computation</p> <pre><code>import ray\nfrom datasketch import MinHash\n\n# Initialize Ray to use all CPU cores\nray.init()\n\n@ray.remote\ndef process_batch(lines, num_perm=128):\n    \"\"\"Ray Worker: Parallel MinHash fingerprint computation for a batch\"\"\"\n    results = []\n    for line in lines:\n        item = json.loads(line)\n        m = MinHash(num_perm=num_perm)\n        # Shingling: Update hash by words\n        for w in item['text'].split():\n            m.update(w.encode('utf8'))\n        results.append((item['url'], m, item['text']))\n    return results\n\n# Main flow: Map-Reduce style\n# Map: Distribute compute tasks\nfutures = [process_batch.remote(batch) for batch in batches]\n# Reduce: Collect results and build LSH index\nresults = ray.get(futures)\n# ...continue with MinHashLSH index building...\n</code></pre>"},{"location":"en/part6/6_1_mini_c4/#phase-3-language-identification-and-perplexity-filtering-quality-filtering","title":"Phase 3: Language Identification and Perplexity Filtering (Quality Filtering)","text":"<p>Cleaned data mixes multiple languages with varying quality. We first use FastText for language routing, then KenLM for perplexity. Lower perplexity means more fluent, more \"human-like\" sentences.</p> <p>Core Code: KenLM Scoring</p> <pre><code>import kenlm\nimport fasttext\n\n# 1. Language routing (from 5_split_lang.py)\nlid_model = fasttext.load_model('lid.176.ftz')\ndef predict_lang(text):\n    # k=1 takes highest probability language\n    predictions = lid_model.predict(text, k=1)\n    return predictions[0][0].replace('__label__', '')\n\n# 2. Perplexity filtering (from 6_quality_filter.py)\nkenlm_model = kenlm.Model('en.arpa.bin')\nPERPLEXITY_THRESHOLD = -6.0  # Experience threshold: below this usually low-quality text\n\ndef filter_by_perplexity(text):\n    words = text.split()\n    if not words:\n        # Empty text as low quality; avoid division by zero\n        return False, -10.0\n    # Compute normalized score (Log Score / Length)\n    log_score = kenlm_model.score(text)\n    normalized_score = log_score / len(words)\n\n    if normalized_score &gt; PERPLEXITY_THRESHOLD:\n        return True, normalized_score\n    return False, normalized_score\n</code></pre>"},{"location":"en/part6/6_1_mini_c4/#4-results-showcase-showcase","title":"4. Results Showcase (Showcase)","text":"<p>After this pipeline, data landscape fundamentally changed:</p> <p>Case 1: Navigation Bar Noise (Removed)</p> <p>Raw: \"Home | About Us | Contact | Enable Cookies | Copyright 2023...\" Result: [Discarded] (Triggered short text and keyword blacklist rules)</p> <p>Case 2: Code Snippet (Removed)</p> <p>Raw: \"function(x) { return x &gt; 0 ? true : false; } var a = [1,2,3];\" Result: [Discarded] (Triggered symbol density &gt; 10% rule)</p> <p>Case 3: High-Quality Article (Retained and Scored)</p> <p>Raw: \"The James Webb Space Telescope has captured a new image of the Pillars of Creation...\" Result: [Retained] KenLM Score: -4.82 (Better than threshold -6.0)</p> <p>Data Statistics: In single-crawl sample test: *   Raw records: 10,000 *   Extracted valid text: ~4,500 (HTML parsing loss) *   Remaining after cleaning: ~2,800 (heuristic filter loss) *   Remaining after dedup: ~2,100 (~25% duplicate rate) *   Final high-quality set: ~1,800 (KenLM filter)</p>"},{"location":"en/part6/6_1_mini_c4/#5-cost-and-optimization-cost-optimization","title":"5. Cost and Optimization (Cost &amp; Optimization)","text":"<ul> <li> <p>Resource consumption:</p> <ul> <li>Compute: This project code on single machine 16-core CPU, 64G RAM, processing 1GB WARC takes ~5-8 minutes.</li> <li>Bottleneck: <code>MinHashLSH</code> index building is currently single-threaded (in <code>4_deduplicate.py</code>), and fully memory-dependent.</li> </ul> </li> <li> <p>Scaling considerations:     If data scales to TB level (like real C4), current architecture needs upgrade:</p> <ol> <li>LSH storage: Can't use in-memory <code>MinHashLSH</code>; need Redis or Cassandra for hash buckets.</li> <li>Parallel strategy: Scale Ray tasks from \"single-machine multi-core\" to \"multi-machine cluster.\"</li> <li>I/O optimization: Data reading must migrate from local filesystem to S3, using PyArrow for streaming columnar processing.</li> </ol> </li> </ul>"},{"location":"en/part6/6_2_legal_sft/","title":"Project 2: Domain Expert SFT","text":""},{"location":"en/part6/6_2_legal_sft/#project-two-vertical-domain-expert-sft-legal","title":"Project Two: Vertical Domain Expert SFT (Legal)","text":"<p>Scenario: Build industry expert fine-tuning data from unstructured PDF documents. Core Technology: Self-Instruct for instruction construction, CoT reasoning enhancement, data diversity balance. Output: <code>domain_expert.jsonl</code> instruction fine-tuning dataset.</p>"},{"location":"en/part6/6_2_legal_sft/#1-project-background-project-brief","title":"1. Project Background (Project Brief)","text":"<ul> <li>Task Definition: Extract knowledge from unstructured legal regulation PDF documents, use LLM Self-Instruct to build vertical domain instruction fine-tuning dataset with \"Chain-of-Thought (CoT)\" capability.</li> <li>Input and Output:</li> <li>Input: Raw PDF documents (e.g., Civil Code, Criminal Law, with header, footer, watermark interference).</li> <li>Output: <code>domain_expert.jsonl</code>, containing Instruction (user instructions) and Output (expert response with thinking process).</li> <li>Challenge Analysis:</li> <li>PDF noise cleaning: Legal documents frequently have citation markers (e.g., <code>[1]</code>), line-break-severed Chinese words (e.g., <code>\u6cd5 \u5f8b</code>), and page numbers embedded in text (e.g., <code>- 195 -</code>) that are extremely difficult to clean.</li> <li>Data homogeneity: Simple \"legal provision explanation\" is insufficient for expert model training; need to construct diverse tasks like case analysis and document drafting.</li> <li>Missing reasoning ability: Ordinary QA pairs lack logical derivation; need to force model to generate CoT (Chain of Thought).</li> </ul> <p>### 2. Architecture Design (Architecture Design)</p> <p>Data Pipeline Diagram:</p> <p></p> <ul> <li>Technology Stack:</li> <li>PDF Parsing (pdfplumber): Compared to PyPDF2, pdfplumber provides more precise Bounding Box control, convenient for removing headers/footers (code sets 5% top/bottom cutoff).</li> <li>Cleaning Engine (Regex): \"Glue code\" for Chinese word-break and citation markers\u2014key to improving data quality.</li> <li>Generation Model (DeepSeek-V3): Leverages strong logical reasoning and low-cost API for Self-Instruct data synthesis.</li> <li>Orchestration Logic (Python): Uses weighted roulette wheel algorithm for task type diversity balance.</li> </ul>"},{"location":"en/part6/6_2_legal_sft/#3-step-by-step-implementation","title":"3. Step-by-Step Implementation","text":""},{"location":"en/part6/6_2_legal_sft/#phase-1-data-acquisition-and-intelligent-cleaning-the-dirty-work","title":"Phase 1: Data Acquisition and Intelligent Cleaning (The Dirty Work)","text":"<p>PDF extraction's biggest pain is format chaos. The <code>clean_text_smart</code> function in <code>data_processing.py</code> is the core for this. We focus on solving \"Chinese false space\" and \"embedded page number\" issues.</p> <p>Key Code Logic:</p> <pre><code>def clean_text_smart(text):\n    \"\"\"\n    Cleaning core logic: Fix format damage from PDF parsing\n    \"\"\"\n    # 1. Remove citation references (e.g., [1], [1-3])\n    text = re.sub(r'\\[\\s*\\d+(?:[-\u2013,]\\d+)*\\s*\\]', '', text)\n\n    # 2. Remove page numbers embedded in text (e.g., \"- 195 -\")\n    # Use lookahead assertion to prevent accidental deletion of body numbering\n    text = re.sub(r'(?:^|\\s|\\n)[-\u2014\u2013\uff0d]\\s*\\d+\\s*[-\u2014\u2013\uff0d](?=\\s|\\n|$)', ' ', text)\n\n    # 3. Fix Chinese word-break (core fix)\n    # Scenario: PDF \"\u6cd5 \u5f8b \u89c4 \u5b9a\" gets recognized with spaces, need to merge\n    pattern_broken_zh = r'([\\u4e00-\\u9fa5])\\s+([\\u4e00-\\u9fa5])'\n    # Execute twice for consecutive breaks\n    text = re.sub(pattern_broken_zh, r'\\1\\2', text)\n    text = re.sub(pattern_broken_zh, r'\\1\\2', text) \n\n    return text.strip()\n</code></pre>"},{"location":"en/part6/6_2_legal_sft/#phase-2-diversified-instruction-synthesis-diversity-cot","title":"Phase 2: Diversified Instruction Synthesis (Diversity &amp; CoT)","text":"<p>To avoid model becoming a law-memorizing bookworm, we designed Task Pool and probability sampling in <code>generate_instructions.py</code>, forcing the model to generate three different task types.</p> <p>Diversity Balance Strategy:</p> <pre><code># Task weight configuration (data distribution control)\nTASK_POOL = [\n    # Task A: Complex case analysis (reasoning focus) - weight 60%\n    (\"case_analysis\", PROMPT_CASE_ANALYSIS, 0.6),\n    # Task B: Legal document drafting (generation focus) - weight 20%\n    (\"doc_drafting\", PROMPT_DOCUMENT_DRAFTING, 0.2),\n    # Task C: Legal concept discrimination (knowledge focus) - weight 20%\n    (\"concept_explain\", PROMPT_CONCEPT_EXPLAIN, 0.2)\n]\n\n# Roulette wheel selection logic\nrand = random.random()\ncumulative_prob = 0\nfor name, tpl, prob in TASK_POOL:\n    cumulative_prob += prob\n    if rand &lt;= cumulative_prob:\n        # Hit task type, use corresponding Prompt\n        selected_prompt_tpl = tpl\n        break\n</code></pre>"},{"location":"en/part6/6_2_legal_sft/#phase-3-formatting-and-cot-enhancement","title":"Phase 3: Formatting and CoT Enhancement","text":"<p>In the Prompt, we explicitly require model to return JSON with \"thinking process.\" In post-processing, we make implicit chain-of-thought explicit, concatenating into final training target format.</p> <p>CoT Formatting Logic:</p> <pre><code># Parse model JSON response, force chain-of-thought format construction\nif isinstance(raw_output, dict):\n    thought = raw_output.get(\"\u601d\u8003\u8fc7\u7a0b\") or raw_output.get(\"analysis\")\n    answer = raw_output.get(\"\u6cd5\u5f8b\u5efa\u8bae\") or raw_output.get(\"conclusion\")\n\n    # Explicitly write thinking process into Output, training model to \"think before speak\"\n    formatted_output = f\"#### \ud83e\udde0 Thinking Process\\n{thought}\\n\\n#### \ud83d\udcdd Expert Advice\\n{answer}\"\n</code></pre>"},{"location":"en/part6/6_2_legal_sft/#4-results-showcase-showcase","title":"4. Results Showcase (Showcase)","text":"<p>After processing, raw dull legal provisions transform into Q&amp;A pairs with deep reasoning. Below is a single data sample from <code>domain_expert.jsonl</code>:</p> <p>Source (Raw Legal Provision Fragment):</p> <p>...Article 150: Where one party uses fraud to cause the other party to perform civil juristic acts against their true intention, the defrauded party has the right to request the people's court or arbitration institution to revoke...</p> <p>Generated SFT Data (JSONL Entry):</p> Field Content Example Instruction I was deceived when signing the contract\u2014the other party said the antique was authentic but it was fake. What should I do now? Can I just refuse to honor it? Output #### \ud83e\udde0 Thinking Process1. Analyze legal relationship: User entered contract under other party's fraud (performed civil juristic act).2. Applicable provision: Per Civil Code Article 150, this is \"voidable\" civil juristic act, not directly \"void\" or \"refuse to honor.\"3. Action path: Defrauded party must exercise right of revocation, and must do so through court or arbitration institution.#### \ud83d\udcdd Expert AdviceBased on your description, you entered the contract against your true intention\u2014this is a voidable civil juristic act. You cannot directly \"refuse to honor\" or unilaterally repudiate the contract. We recommend:1. Exercise right of revocation: You may file a lawsuit with the people's court or apply to an arbitration institution to revoke the contract.2. ... <p>Data Distribution Analysis: - Case analysis (60%): Enhance model's complex logic handling. - Document drafting (20%): Enhance model's professional writing. - Concept explanation (20%): Consolidate foundational domain knowledge.</p>"},{"location":"en/part6/6_2_legal_sft/#5-cost-and-optimization-cost-optimization","title":"5. Cost and Optimization (Cost &amp; Optimization)","text":"<ul> <li>Resource consumption:</li> <li>API cost: Using DeepSeek-V3, generating 1000 high-quality CoT samples costs ~$0.5 - $1.0 (longer input/output tokens).</li> <li>Time cost: Single-threaded ~2 seconds per sample.</li> <li>Scaling considerations:</li> <li>Concurrency acceleration: Current code is single-threaded (<code>time.sleep</code>); production should use <code>asyncio</code> + <code>Semaphore</code> for concurrent requests; 10-20x efficiency gain possible.</li> <li>Quality control: Currently relies only on Prompt constraints; recommend adding \"Reward Model scoring\" or \"rule filter\" step to remove overly short or JSON parse-failed samples.</li> </ul>"},{"location":"en/part6/6_3_llava_instruct/","title":"Project 3: Building LLaVA Multimodal Instruction Set","text":""},{"location":"en/part6/6_3_llava_instruct/#project-three-building-llava-multimodal-instruction-dataset","title":"Project Three: Building LLaVA Multimodal Instruction Dataset","text":"<p>Scope: Multimodal LLM (LMM) development, data engineering, visual instruction tuning (Visual Instruction Tuning)</p>"},{"location":"en/part6/6_3_llava_instruct/#1-project-background-project-brief","title":"1. Project Background (Project Brief)","text":"<ul> <li> <p>Task Definition:   Build a high-quality visual instruction fine-tuning dataset supporting single-image QA (Visual QA), object localization (Grounding), and multi-image context reasoning (Interleaved Image-Text), for training multimodal models like LLaVA or Qwen-VL.</p> </li> <li> <p>Input and Output:</p> </li> <li>Input: <ul> <li>Raw image library (<code>.jpg</code> / <code>.png</code>)</li> <li>Structured annotation data (e.g., COCO-format <code>instances.json</code> with Bbox coordinates)</li> </ul> </li> <li> <p>Output: </p> <ul> <li>JSON files conforming to LLaVA training standard (with <code>image</code>, <code>conversations</code> fields).</li> <li>Grounding data with coordinate normalization and format alignment.</li> </ul> </li> <li> <p>Challenge Analysis:</p> </li> <li>Coordinate alignment (Coordinate Alignment): Raw detection data coordinates are typically pixel absolutes (x, y, w, h), while LLaVA requires normalization to <code>[0-1000]</code> range with order <code>[ymin, xmin, ymax, xmax]</code>\u2014once wrong, model suffers severe \"hallucination.\"</li> <li>Multi-image logic construction: Traditional Image-Caption data is one image one text; building \"multi-image interleaved\" dialogue requires constructing reasonable comparative Prompts to induce model to understand inter-image relationships.</li> </ul>"},{"location":"en/part6/6_3_llava_instruct/#2-architecture-design-architecture-design","title":"2. Architecture Design (Architecture Design)","text":"<ul> <li> <p>Data Pipeline Diagram: </p> </li> <li> <p>Technology Stack:</p> </li> <li>OpenAI Compatible API (SiliconFlow/Qwen): For generating high-quality image-text descriptions and multi-image comparison logic; leverages LLM reasoning for dialogue construction.</li> <li>Python &amp; OpenCV: Core glue language. OpenCV essential for reading image dimensions (H, W) for coordinate normalization and \"draw-box verification\" visualization.</li> <li>JSON: LLaVA standard data exchange format.</li> </ul>"},{"location":"en/part6/6_3_llava_instruct/#3-step-by-step-implementation","title":"3. Step-by-Step Implementation","text":""},{"location":"en/part6/6_3_llava_instruct/#phase-1-multi-image-interleaved-data-generation","title":"Phase 1: Multi-Image Interleaved Data Generation","text":"<p>To teach the model to \"compare\" two images, we use API to dynamically input multiple images and request comparison.</p> <p>Key Logic: Use VLM API to construct multi-image input Prompt.</p> <pre><code># From interleaved.py\ndef generate_comparison(img1_path, img2_path):\n    # Construct Prompt: Require multi-image comparison\n    prompt = \"Here are two images. Please briefly compare them...\"\n\n    # Build multi-image payload\n    messages=[\n        {\n            \"role\": \"user\",\n            \"content\": [\n                {\"type\": \"text\", \"text\": prompt},\n                {\"type\": \"image_url\", \"image_url\": {\"url\": f\"...{img1_path}...\"}}, # Image 1\n                {\"type\": \"image_url\", \"image_url\": {\"url\": f\"...{img2_path}...\"}}  # Image 2\n            ]\n        }\n    ]\n    # ... send request and parse result ...\n</code></pre>"},{"location":"en/part6/6_3_llava_instruct/#phase-2-core-processingbounding-box-alignment","title":"Phase 2: Core Processing\u2014Bounding Box Alignment","text":"<p>This is the project's core math. COCO uses <code>[x_topleft, y_topleft, width, height]</code> while LLaVA needs <code>[ymin, xmin, ymax, xmax]</code> with values normalized to 0-1000 integers.</p> <p>Key Function: Coordinate normalization conversion</p> <pre><code># From alignment.py\ndef convert_bbox(bbox, width, height):\n    # COCO raw input: x, y, w, h\n    x, y, w, h = bbox\n\n    # Convert to LLaVA format: [ymin, xmin, ymax, xmax] normalized to 0-1000\n    # Must use max/min for clipping to prevent float error overflow\n    xmin = int((x / width) * 1000)\n    ymin = int((y / height) * 1000)\n    xmax = int((x + w) / width * 1000)\n    ymax = int((y + h) / height * 1000)\n\n    return [\n        max(0, min(1000, ymin)),\n        max(0, min(1000, xmin)),\n        max(0, min(1000, ymax)),\n        max(0, min(1000, xmax))\n    ]\n</code></pre>"},{"location":"en/part6/6_3_llava_instruct/#phase-3-formatting-and-verification","title":"Phase 3: Formatting and Verification","text":"<p>Data generation must not go directly to training. Must pass visualization reverse verification. If our drawn boxes are wrong, the trained model will be useless.</p> <p>Verification Logic: Parse generated JSON, restore <code>[0-1000]</code> coordinates to pixel coordinates and draw.</p> <pre><code># From visualize_bbox.py\ndef draw_bbox(image, bbox, label, color):\n    h, w, _ = image.shape\n    ymin, xmin, ymax, xmax = bbox # Read LLaVA format\n\n    # Restore to pixel coordinates for drawing\n    x1 = int(xmin / 1000 * w)\n    y1 = int(ymin / 1000 * h)\n    x2 = int(xmax / 1000 * w)\n    y2 = int(ymax / 1000 * h)\n\n    # OpenCV draw box\n    cv2.rectangle(image, (x1, y1), (x2, y2), color, 2)\n    # ...\n</code></pre>"},{"location":"en/part6/6_3_llava_instruct/#4-results-showcase-showcase","title":"4. Results Showcase (Showcase)","text":"<p>1. Data Structure Example: Final generated <code>llava_instruct.json</code> has this standard structure, directly readable by Training Pipeline:</p> <pre><code>{\n  \"id\": \"1296_laptop\",\n  \"image\": \"000000001296.jpg\",\n  \"conversations\": [\n    {\n      \"from\": \"human\",\n      \"value\": \"Where is the laptop in the image? &lt;image&gt;\"\n    },\n    {\n      \"from\": \"qwen\",\n      \"value\": \"The laptop is located at [350, 201, 680, 505].\"\n    }\n  ]\n}\n</code></pre> <p>2. Visualization Verification Report: After running <code>visualize_bbox.py</code>, verification images generated in <code>viz_debug</code> directory. If boxes precisely frame objects (as shown below), data pipeline logic is correct.</p> <p>Effect Image Generation:</p> <p></p>"},{"location":"en/part6/6_3_llava_instruct/#5-cost-and-optimization-cost-optimization","title":"5. Cost and Optimization (Cost &amp; Optimization)","text":"<ul> <li>Resource consumption:</li> <li>API cost: <code>interleaved.py</code> depends on external LLM API. Generating 10,000 multi-image comparison samples at \\(0.5/1M Tokens costs ~\\)20-$30.</li> <li> <p>Compute time: <code>alignment.py</code> is pure CPU; processing COCO validation set (5k images) takes seconds.</p> </li> <li> <p>Scaling considerations:</p> </li> <li>Concurrent processing: When processing millions of images (e.g., Objects365), single-threaded image reading for <code>(h, w)</code> becomes bottleneck. Can introduce <code>multiprocessing</code> for 16 processes parallel read and convert.</li> <li>Negative sample mining: Current code only generates \"where is object\" positive samples. For model robustness, extend code to generate negative samples like \"Is there an elephant in the image? -&gt; No.\"</li> </ul>"},{"location":"en/part6/6_4_synthetic_textbook/","title":"Project 4: Synthetic Math/Code Textbook","text":""},{"location":"en/part6/6_4_synthetic_textbook/#project-four-synthetic-mathcode-textbook","title":"Project Four: Synthetic Math/Code Textbook","text":"<p>Scenario: Enhance small model logic reasoning ability.</p> <p>Core Technology: Evol-Instruct evolution strategy, Python code execution sandbox (Sandbox) verification, PoT (Program of Thought) data formatting.</p> <p>Output: High-quality synthetic reasoning dataset after verification.</p>"},{"location":"en/part6/6_4_synthetic_textbook/#1-project-background-project-brief","title":"1. Project Background (Project Brief)","text":"<ul> <li>Task Definition: Build a high-quality \"Program of Thought\" (PoT) dataset. We use LLMs (DeepSeek-V3) to \"evolve\" simple math problems into complex word problems, generate corresponding Python code solutions, and verify answer correctness through code execution sandbox.</li> <li>Input and Output:<ul> <li>Input: Base math datasets (e.g., GSM8K, MBPP) raw JSONL files.</li> <li>Output: Cleaned JSONL dataset containing <code>question</code> (evolved problem), <code>thought_process</code> (code solution reasoning), <code>execution_output</code> (execution result).</li> </ul> </li> <li>Challenge Analysis: This project's biggest difficulty is \"hallucination elimination.\" LLM-generated code often looks correct but cannot run (syntax errors or logic bugs). We need to build automated \"Sandbox\" to filter out non-executable samples, ensuring \"textbook\" rigor.</li> </ul>"},{"location":"en/part6/6_4_synthetic_textbook/#2-architecture-design-architecture-design","title":"2. Architecture Design (Architecture Design)","text":""},{"location":"en/part6/6_4_synthetic_textbook/#data-pipeline-diagram","title":"Data Pipeline Diagram","text":""},{"location":"en/part6/6_4_synthetic_textbook/#technology-stack","title":"Technology Stack","text":"<ul> <li>Data Source: <code>HuggingFace Datasets</code> (GSM8K/MBPP).</li> <li>Generation Engine: <code>DeepSeek-V3</code> (via SiliconFlow API) \u2014\u2014 cost-effective code generation model.</li> <li>Orchestration Logic: Python scripts (Evol-Instruct strategy).</li> <li>Verification Environment: Python <code>subprocess</code> (local sandbox) \u2014\u2014 production recommend Docker or MicroVM.</li> </ul>"},{"location":"en/part6/6_4_synthetic_textbook/#3-step-by-step-implementation","title":"3. Step-by-Step Implementation","text":""},{"location":"en/part6/6_4_synthetic_textbook/#phase-1-seed-data-acquisition-seed-preparation","title":"Phase 1: Seed Data Acquisition (Seed Preparation)","text":"<p>Everything starts with high-quality seeds. We don't need massive data\u2014just representative logic cores.</p> <p>Key Actions: 1.  Download GSM8K (math) and MBPP (code) data. 2.  Random sample as \"evolution\" foundation.</p> <p>Glue Code (Data Sampler): Code from <code>download_data.py</code> and <code>sampler.py</code></p> <pre><code># Core logic: Extract seeds from massive data, keep only Question field\n# Original Answer discarded because we let model regenerate code-based solution\nsampled = random.sample(data, SAMPLE_SIZE)\nfor entry in sampled:\n    seed_entry = {\n        \"id\": random.randint(1000, 9999), \n        \"seed_question\": entry['question'], # Keep only question\n        \"original_answer\": entry['answer']  # For reference only\n    }\n</code></pre>"},{"location":"en/part6/6_4_synthetic_textbook/#phase-2-evol-instruct-and-pot-generation-evolution-generation","title":"Phase 2: Evol-Instruct and PoT Generation (Evolution &amp; Generation)","text":"<p>This is the project core. We can't just do simple \"Q&amp;A pairs\"\u2014we need the model to think like a human expert.</p> <p>Flow Logic: 1.  Evol (Evolution): Rewrite simple problems (e.g., \"1+1=?\") into complex scenarios (e.g., \"Xiaoming has 1 apple, affected by inflation...\"), adding constraints. 2.  PoT (Code solution): Force model to write Python code to solve, not directly output text answer.</p> <p>Core Prompts (Prompt Engineering): Code from <code>evol.py</code></p> <pre><code>def get_evol_prompt(seed_question):\n    return f\"\"\"\n    You are a professional math competition problem composer. Please rewrite the following basic math problem into a more complex, logically rigorous one.\n    \u3010Original\u3011: {seed_question}\n    \u3010Rewrite Requirements\u3011:\n    1. Add constraints: Introduce more variables or limitations.\n    2. Add reasoning depth: Don't give numbers directly; have logical relationships between numbers.\n    3. Scenario-ize: Put abstract numbers into concrete physical or business scenarios.\n    ...\n    \"\"\"\n\ndef get_pot_prompt(evolved_question):\n    return f\"\"\"\n    Please write Python code to solve the following math problem.\n    ...\n    1. Write a function named `solve()`.\n    2. Clearly write reasoning steps in code comments.\n    3. `solve()` must return the final numerical answer.\n    ...\n    \"\"\"\n</code></pre>"},{"location":"en/part6/6_4_synthetic_textbook/#phase-3-sandbox-verification","title":"Phase 3: Sandbox Verification","text":"<p>Generated data has large amounts of \"dead\" samples (Syntax Error, Timeout, Loop). Must verify through execution.</p> <p>Sandbox Logic: 1.  Use regex to extract code blocks from Markdown. 2.  Start subprocess (<code>subprocess</code>) to execute code. 3.  Critical: Set <code>timeout</code> to prevent infinite loops from blocking pipeline.</p> <p>Verification Script: Code from <code>sandbox.py</code></p> <pre><code>def execute_code(code, timeout=5):\n    \"\"\"\n    Execute Python code and get output.\n    WARNING: This function should only be called in strongly isolated sandbox (minimal privilege container/micro-VM, no network, restricted filesystem).\n    To prevent accidentally executing arbitrary code in host environment, will raise exception if sandbox not explicitly declared.\n    Can explicitly allow by setting environment variable EXECUTE_CODE_SANDBOXED=1 inside sandbox container.\n    \"\"\"\n    # Basic protection: Prohibit executing arbitrary code in undeclared sandbox\n    if os.environ.get(\"EXECUTE_CODE_SANDBOXED\") != \"1\":\n        raise RuntimeError(\n            \"execute_code can only be used in controlled sandbox environment; \"\n            \"please set environment variable EXECUTE_CODE_SANDBOXED=1 in isolated container/micro-VM before calling.\"\n        )\n    try:\n        # Use subprocess to start independent process\n        result = subprocess.run(\n            ['python3', '-c', code],\n            capture_output=True,  # Capture stdout\n            text=True,\n            timeout=timeout,      # Must set timeout!\n            check=False,\n        )\n        if result.returncode == 0:\n            return True, result.stdout.strip()\n        else:\n            return False, f\"Error: {result.stderr.strip()}\"\n</code></pre>"},{"location":"en/part6/6_4_synthetic_textbook/#4-results-showcase-showcase","title":"4. Results Showcase (Showcase)","text":"<p>After sandbox cleaning, we get <code>verified_textbook.jsonl</code>. This is textbook-grade synthetic data.</p> <p>Data Sample Comparison:</p> Phase Content Example Original Seed Jenny has 5 apples, ate 2, how many left? Evol Evolution Jenny runs a fruit store with 5 crates of apples (12 per crate). Monday she sold 40% of inventory, and 2 single items spoiled from improper storage. Please calculate the exact number of remaining sellable apples. PoT Solution <code>def solve(): total = 5 * 12; sold = total * 0.4; ... return remaining</code> Execution Result <code>34</code> (verified, saved to dataset) <p>Verification Statistics: Typically, post-Evol code one-shot pass rate (Pass@1) is 60%-80%. The 20% error data filtered by sandbox are exactly the ones that would pollute model training\u2014removing them significantly improves SFT model logic consistency.</p>"},{"location":"en/part6/6_4_synthetic_textbook/#5-cost-and-optimization-cost-optimization","title":"5. Cost and Optimization (Cost &amp; Optimization)","text":"<ul> <li> <p>Resource consumption:</p> <ul> <li>API cost: Each valid sample consumes ~2 LLM calls (evolution + solution). Using cost-effective models like DeepSeek-V3, generating 1k high-quality textbook samples can be controlled under $5.</li> <li>Time cost: Local Python single-threaded is slow; verifying 1k code samples takes ~5-10 minutes.</li> </ul> </li> <li> <p>Security Warning (Critical):</p> <ul> <li>This project uses <code>subprocess</code> for local execution. When processing unknown or untrusted model-generated code, extremely high risk exists (e.g., <code>os.system('rm -rf /')</code>).</li> <li>Production transformation plan: Must migrate <code>sandbox.py</code> execution environment to Docker container or AWS Firecracker micro-VM, with network access disabled.</li> </ul> </li> <li> <p>Scaling considerations:</p> <ul> <li>If data scales to millions, single-machine script cannot support. Need to introduce <code>RabbitMQ</code> or <code>Kafka</code> for task distribution, building distributed \"generate-verify\" cluster.</li> </ul> </li> </ul>"},{"location":"en/part6/6_5_mm_rag/","title":"Project 5: Multimodal RAG Financial Report Assistant","text":""},{"location":"en/part6/6_5_mm_rag/#project-five-multimodal-rag-enterprise-financial-report-assistant","title":"Project Five: Multimodal RAG Enterprise Financial Report Assistant","text":"<p>Scope: Capstone Projects - Solving complex document (charts, tables) retrieval challenges</p>"},{"location":"en/part6/6_5_mm_rag/#1-project-background-project-brief","title":"1. Project Background (Project Brief)","text":"<ul> <li>Task Definition: Build an RAG system that can \"understand\" complex charts and data tables in enterprise annual reports, achieving in-depth Q&amp;A on financial reports through visual retrieval (Visual Retrieval) and multimodal LLM (VLM).</li> <li>Input and Output:</li> <li>Input: PDF-format enterprise annual financial reports (containing mixed-layout text, cross-page tables, trend line charts, pie charts, etc.).</li> <li>Output: Natural language analysis answers based on chart data trends and specific values.</li> <li>Challenge Analysis: </li> <li>Structure loss: Traditional RAG uses OCR to text, easily losing table row-column correspondence, and completely unable to handle trend charts without text captions.</li> <li>Semantic fragmentation: Reports often have \"see figure below\" references; text and charts separated cause retrieval truncation.</li> <li>Retrieval noise: Table of contents pages often contain keywords, easily causing false recall, crowding context window.</li> </ul>"},{"location":"en/part6/6_5_mm_rag/#2-architecture-design-architecture-design","title":"2. Architecture Design (Architecture Design)","text":"<p>This project's core concept is \"ViR (Vision in Retrieval) + VLM (Vision Language Model).\" We no longer force PDF to text; instead use ColPali to treat each PDF page as an image for visual encoding, directly retrieve visual features, then feed retrieved images to multimodal LLM for interpretation.</p>"},{"location":"en/part6/6_5_mm_rag/#data-pipeline-diagram","title":"Data Pipeline Diagram","text":""},{"location":"en/part6/6_5_mm_rag/#technology-stack","title":"Technology Stack","text":"Component Tool/Model Selection Rationale Visual Retrieval Model ColPali (v1.2) Current SOTA document retrieval model; based on PaliGemma; understands page layout, font size, chart visual features; no OCR needed. Index Framework Byaldi ColPali lightweight wrapper; simplifies multimodal model tensor storage and retrieval flow. Multimodal LLM Qwen2.5-VL-72B Alibaba Tongyi Qianwen latest vision model; excels at chart understanding (ChartQA) and document parsing (DocVQA)."},{"location":"en/part6/6_5_mm_rag/#3-step-by-step-implementation","title":"3. Step-by-Step Implementation","text":""},{"location":"en/part6/6_5_mm_rag/#phase-1-visual-index-building-visual-indexing","title":"Phase 1: Visual Index Building (Visual Indexing)","text":"<p>Unlike traditional RAG's <code>Chunking -&gt; Embedding</code>, here we do <code>Page -&gt; Screenshot -&gt; Visual Embedding</code>.</p> <p>Key Code Logic (<code>index.py</code>):</p> <pre><code>from byaldi import RAGMultiModalModel\n\n# 1. Load local ColPali model (solves HuggingFace connection issues)\nMODEL_PATH = \"/path/to/models/colpali-v1.2-merged\"\nINDEX_NAME = \"finance_report_2024\"\n\ndef build_index():\n    # 2. Initialize model (supports load_in_4bit for memory reduction)\n    RAG = RAGMultiModalModel.from_pretrained(MODEL_PATH, verbose=1)\n\n    # 3. Build index\n    # Principle: Byaldi converts PDF to images, computes visual vectors and stores\n    RAG.index(\n        input_path=\"annual_report_2024.pdf\",\n        index_name=INDEX_NAME,\n        store_collection_with_index=True, # Must store original image references\n        overwrite=True\n    )\n</code></pre> <p>Practical Notes: *   Debug: First run encountered OOM (out of memory). *   Solution: ColPali full version needs ~10GB+ memory. When insufficient, add <code>load_in_4bit=True</code> to <code>from_pretrained</code>.</p>"},{"location":"en/part6/6_5_mm_rag/#phase-2-multi-page-visual-retrieval-multi-page-retrieval","title":"Phase 2: Multi-Page Visual Retrieval (Multi-Page Retrieval)","text":"<p>A typical pitfall in financial report Q&amp;A: keyword \"operating results\" also appears on table of contents. If only retrieving Top-1, might only get table of contents, causing model to fail answering. Therefore, strategy needs to retrieve Top-K (recommend 3-5 pages) and filter.</p> <p>Key Code Logic (<code>rag_chat.py</code> - Retrieval Part):</p> <pre><code># Load index\nRAG = RAGMultiModalModel.from_index(INDEX_NAME)\n\n# Increase retrieval pages to prevent only hitting table of contents\nRETRIEVAL_K = 4 \n\nresults = RAG.search(user_query, k=RETRIEVAL_K)\n\n# Results contain: page_num (page number), base64 (image data), score (relevance)\n</code></pre>"},{"location":"en/part6/6_5_mm_rag/#phase-3-multi-image-context-generation-multi-image-generation","title":"Phase 3: Multi-Image Context Generation (Multi-Image Generation)","text":"<p>We feed all K retrieved images as context to VLM, leveraging model's long window and multi-image capability for comprehensive analysis.</p> <p>Key Code Logic (<code>rag_chat.py</code> - Generation Part):</p> <pre><code># Build multimodal payload\ncontent_payload = []\n\n# 1. System Prompt: Define role and anti-interference instructions\ncontent_payload.append({\n    \"type\": \"text\", \n    \"text\": f\"You are a professional CFO assistant... may contain table of contents, please ignore table of contents, directly answer based on pages with specific data...\"\n})\n\n# 2. Inject multiple images\nfor res in results:\n    content_payload.append({\n        \"type\": \"image_url\",\n        \"image_url\": {\n            \"url\": f\"data:image/jpeg;base64,{res.base64}\", \n            \"detail\": \"high\" # Enable high-res mode for small text recognition\n        }\n    })\n\n# 3. Send to Qwen2.5-VL-72B\nresponse = client.chat.completions.create(\n    model=\"Qwen/Qwen2.5-VL-72B-Instruct\",\n    messages=[{\"role\": \"user\", \"content\": content_payload}],\n    temperature=0.1 # Maintain factuality\n)\n</code></pre>"},{"location":"en/part6/6_5_mm_rag/#4-results-showcase-showcase","title":"4. Results Showcase (Showcase)","text":"<p>Below is a real execution record of the system on Huawei 2024 financial report. The system successfully skipped table of contents, comprehensively integrating information from pages 49, 91, 130, and 8 for quantitative analysis of R&amp;D investment and intangible asset changes.</p> <pre><code>&gt;&gt;&gt; Please ask: How are the operating results?\n\n\ud83d\udd0d Retrieving Top-4 relevant pages...\n\ud83d\udcc4 Hit pages: [49] [91] [130] [8]\n\ud83d\ude80 Sending to LLM for comprehensive analysis...\n\n\ud83e\udd16 Financial Report Assistant Answer:\n----------------------------------------\nBased on the provided financial report screenshots, operating results can be analyzed from the following aspects:\n\n### 1. **R&amp;D and Innovation Investment**\n- **R&amp;D Expenses**: In 2024, R&amp;D expenses were RMB 179.7 billion, accounting for 20.8% of annual revenue. Cumulative R&amp;D investment over the past decade exceeded RMB 1,249 billion. This indicates continued substantial investment in R&amp;D and innovation,committed to technology breakthrough and product upgrade.\n- **R&amp;D Personnel**: As of December 31, 2024, R&amp;D employees numbered approximately 113,000, accounting for 54.1% of total employees, showing company emphasis on R&amp;D team and sustained innovation investment.\n\n### 2. **Intangible Assets**\n- **Goodwill and Intangible Assets**: Screenshots show detailed data on goodwill, software, patents and royalties, trademark rights, and other intangible assets. From 2023 to 2024, goodwill increased from 4,424 to 4,496 million yuan... (abbreviated) ...indicating continued growth in intangible assets.\n\n### 3. **Corporate Social Responsibility and Sustainable Development**\n- **Tech Classroom Project**: Huawei officially launched \"Tech Classroom\" project... (abbreviated)\n- **Mobile Digital Classroom Project**: Huawei partnered in Kenya for DigiTruck project...\n\n### 4. **Chairman's Message**\n- **Strategic Focus and Continued Innovation**: Chairman noted in message that 2024 was a challenging year; Huawei employees remained confident and proactive, achieving business development goals with overall operations meeting expectations...\n\nIn summary, Huawei's 2024 operating results were outstanding, with significant achievements in R&amp;D and innovation, intangible assets, corporate social responsibility and sustainable development.\n----------------------------------------\n</code></pre>"},{"location":"en/part6/6_5_mm_rag/#5-cost-and-optimization-cost-optimization","title":"5. Cost and Optimization (Cost &amp; Optimization)","text":"<ul> <li>Resource consumption:</li> <li>Index cost: ColPali processing is slow (~0.5s/page); indexing 200-page report takes 2-3 minutes.</li> <li> <p>Inference cost: Multimodal token consumption is huge. One 1024x1024 image \u2248 1000-1500 tokens. Each Top-4 retrieval means Input Token at least 5000+. Using SiliconFlow API for Qwen2.5-VL-72B, single Q&amp;A cost ~0.05-0.1 RMB.</p> </li> <li> <p>Optimization ideas:</p> </li> <li>Precision optimization: For ultra-high-resolution financial tables, can \"crop\" PDF pages before indexing\u2014split one large image into 4 smaller images for separate indexing, improving local retrieval clarity.</li> <li>Image cropping: ColPali can locate relevant regions (Patch-level retrieval); future can crop only relevant \"chart regions\" from page to feed LLM, significantly reducing token consumption.</li> <li>Caching mechanism: For fixed high-frequency questions like \"revenue amount\" or \"net profit amount,\" cache VLM parsing results to avoid repeated visual reasoning.</li> </ul>"},{"location":"ja/","title":"\u76ee\u6b21","text":""},{"location":"ja/#_1","title":"\u300c\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0: \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3001\u304a\u3088\u3073\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u5b9f\u8df5\u300d","text":""},{"location":"ja/#_2","title":"\u672c\u306e\u6982\u8981","text":"<ul> <li>\u30d1\u30fc\u30c8 1: \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u3068\u30b3\u30a2\u6982\u5ff5 (\u30c7\u30fc\u30bf\u57fa\u76e4\u306e\u69cb\u7bc9)</li> <li>\u30d1\u30fc\u30c8 2: \u30c6\u30ad\u30b9\u30c8\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 (\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u3068\u30ce\u30a4\u30ba\u9664\u53bb)</li> <li>\u30d1\u30fc\u30c8 3: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 (\u753b\u50cf\u3001\u30c6\u30ad\u30b9\u30c8\u3001\u30d3\u30c7\u30aa\u3001\u30aa\u30fc\u30c7\u30a3\u30aa)</li> <li>\u30d1\u30fc\u30c8 4: \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8\u3068\u5408\u6210\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 (\u624b\u9806\u3068\u54c1\u8cea)</li> <li>\u30d1\u30fc\u30c8 5: \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u30ec\u30d9\u30eb\u306e\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 (RAG \u304a\u3088\u3073\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8)</li> <li>\u30d1\u30fc\u30c8 6: Capstone \u30d7\u30ed\u30b8\u30a7\u30af\u30c8 (\u30a8\u30f3\u30c9\u30c4\u30fc\u30a8\u30f3\u30c9\u306e\u30b3\u30fc\u30c9\u5b9f\u88c5)</li> </ul>"},{"location":"ja/#_3","title":"\u8a73\u7d30\u6982\u8981","text":""},{"location":"ja/#1","title":"\u30d1\u30fc\u30c8 1: \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u3068\u30b3\u30a2\u6982\u5ff5","text":"<p>\u76ee\u6a19: \u30c7\u30fc\u30bf\u4e2d\u5fc3\u306e AI \u306e\u8003\u3048\u65b9\u3092\u78ba\u7acb\u3057\u3001\u9ad8\u6027\u80fd\u306e\u30c7\u30fc\u30bf\u51e6\u7406\u74b0\u5883\u3092\u30bb\u30c3\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002</p>"},{"location":"ja/#1-llm","title":"\u7b2c 1 \u7ae0: LLM \u6642\u4ee3\u306e\u30c7\u30fc\u30bf\u9769\u547d","text":"<ul> <li>1_1 \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306e\u6cd5\u5247\u304b\u3089\u306e\u6d1e\u5bdf: \u30c7\u30fc\u30bf\u306e\u54c1\u8cea &gt; \u91cf \u2014 \u300c\u30d3\u30c3\u30b0 \u30c7\u30fc\u30bf\u300d\u304b\u3089\u300c\u9ad8\u54c1\u8cea\u30c7\u30fc\u30bf\u300d\u3078\u306e\u30d1\u30e9\u30c0\u30a4\u30e0 \u30b7\u30d5\u30c8\u3002</li> <li>1_2 LLM \u30c7\u30fc\u30bf \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb: \u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \\(\\rightarrow\\) SFT \\(\\rightarrow\\) RLHF \\(\\rightarrow\\) RAG\u3002</li> <li>1_3 \u8ab2\u984c\u3068\u6a5f\u4f1a: \u7570\u7a2e\u30de\u30eb\u30c1\u30e2\u30c0\u30ea\u30c6\u30a3\u3001\u8457\u4f5c\u6a29\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u3001\u304a\u3088\u3073\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30b3\u30b9\u30c8\u306e\u76f8\u4e92\u4f5c\u7528\u3002</li> </ul>"},{"location":"ja/#2","title":"\u7b2c 2 \u7ae0: \u30c7\u30fc\u30bf \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u9078\u629e","text":"<ul> <li>2_1 \u6700\u65b0\u306e\u30c7\u30fc\u30bf\u30b9\u30bf\u30c3\u30af:</li> <li>\u30b9\u30c8\u30ec\u30fc\u30b8: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8 (S3/MinIO) \u3068\u30c7\u30fc\u30bf \u30ec\u30a4\u30af (Iceberg/Hudi)\u3002</li> <li>\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0: Spark (\u5f93\u6765\u306e\u5f37\u529b\u306a\u4f01\u696d) \u5bfe Ray Data (AI \u30cd\u30a4\u30c6\u30a3\u30d6\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af)\u3002</li> <li>2_2 \u30c7\u30fc\u30bf\u5f62\u5f0f\u3068 I/O \u306e\u6700\u9069\u5316:</li> <li>Parquet \u5bfe JSONL \u5bfe WebDataset (\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30b7\u30ca\u30ea\u30aa)\u3002</li> <li>\u5727\u7e2e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u8aad\u307f\u53d6\u308a\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u6700\u9069\u5316\u3002</li> <li>2_3 \u30c7\u30fc\u30bf \u30d0\u30fc\u30b8\u30e7\u30f3 \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb (DataOps): DVC \u3068 LakeFS \u3092\u4f7f\u7528\u3057\u305f PB \u30b9\u30b1\u30fc\u30eb\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u7ba1\u7406\u3002</li> </ul>"},{"location":"ja/#2_1","title":"\u30d1\u30fc\u30c8 2: \u30c6\u30ad\u30b9\u30c8\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0","text":"<p>\u76ee\u6a19: \u5927\u91cf\u306e\u975e\u69cb\u9020\u5316\u30c6\u30ad\u30b9\u30c8\u3092\u51e6\u7406\u3057\u3066\u3001\u30e2\u30c7\u30eb\u306e\u8a00\u8a9e\u8a8d\u8b58\u57fa\u76e4\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p>"},{"location":"ja/#3","title":"\u7b2c 3 \u7ae0: \u30c7\u30fc\u30bf\u306e\u53d6\u5f97","text":"<ul> <li>3_1 \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u5206\u89e3: Common Crawl\u3001C4\u3001RefinedWeb\u3001\u304a\u3088\u3073 The Pile \u306e\u8a73\u7d30\u306a\u5206\u6790\u3002</li> <li>3_2 \u9ad8\u6027\u80fd Web \u30af\u30ed\u30fc\u30ea\u30f3\u30b0: <code>Trafilatura</code> \u89e3\u6790\u30e9\u30a4\u30d6\u30e9\u30ea\u3068\u5206\u6563\u30af\u30ed\u30fc\u30e9 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u3002</li> <li>3_3 \u7279\u6b8a\u306a\u30c7\u30fc\u30bf\u53d6\u5f97: \u30b3\u30fc\u30c9 (GitHub)\u3001\u8ad6\u6587 (ArXiv/S2ORC)\u3001\u304a\u3088\u3073\u66f8\u7c4d\u30c7\u30fc\u30bf\u306e\u62bd\u51fa\u6226\u7565\u3002</li> </ul>"},{"location":"ja/#4","title":"\u7b2c 4 \u7ae0: \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u3068\u91cd\u8907\u6392\u9664","text":"<ul> <li>4_1 \u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u30eb\u30fc\u30eb: \u8a00\u8a9e\u8b58\u5225 (FastText)\u3001\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3 \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u9577\u3055\u304a\u3088\u3073\u53e5\u8aad\u70b9\u306e\u5206\u5e03\u3002</li> <li>4_2 \u5927\u898f\u6a21\u306a\u91cd\u8907\u6392\u9664:</li> <li>\u30d5\u30a1\u30b8\u30fc\u91cd\u8907\u6392\u9664: MinHash LSH \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u539f\u5247\u3068\u5206\u6563\u5b9f\u88c5\u3002</li> <li>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u306e\u91cd\u8907\u6392\u9664: \u7e70\u308a\u8fd4\u3055\u308c\u308b\u6bb5\u843d\u3068\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3 \u30d0\u30fc\u3092\u524a\u9664\u3057\u307e\u3059\u3002</li> <li>4_3 \u30d7\u30e9\u30a4\u30d0\u30b7\u30fc \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 (PII \u524a\u9664): Presidio \u3092\u4f7f\u7528\u3057\u3066\u96fb\u5b50\u30e1\u30fc\u30eb\u3001IP\u3001\u96fb\u8a71\u756a\u53f7\u3001\u304a\u3088\u3073\u4f4f\u6240\u3092\u8b58\u5225\u3057\u30de\u30b9\u30af\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/#5","title":"\u7b2c 5 \u7ae0: \u30c8\u30fc\u30af\u30f3\u5316\u3068\u30b7\u30ea\u30a2\u30eb\u5316","text":"<ul> <li>5_1 \u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306e\u539f\u5247: BPE\u3001WordPiece\u3001Unigram\u3001\u304a\u3088\u3073\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u5bfe\u3059\u308b\u305d\u308c\u3089\u306e\u5f71\u97ff\u3002</li> <li>5_2 \u52b9\u7387\u7684\u306a\u8a9e\u5f59\u69cb\u7bc9: \u7279\u5b9a\u306e\u5206\u91ce (\u533b\u7642\u3001\u6cd5\u5f8b\u306a\u3069) \u306e\u8a9e\u5f59\u3092\u5897\u3084\u3059\u65b9\u6cd5\u3002</li> <li>5_3 \u30c7\u30fc\u30bf\u6df7\u5408: \u52d5\u7684\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u6226\u7565\u3068\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2\u30c7\u30fc\u30bf\u306e\u914d\u7f6e\u3002</li> </ul>"},{"location":"ja/#3_1","title":"\u30d1\u30fc\u30c8 3: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0","text":"<p>\u76ee\u6a19: \u753b\u50cf\u3001\u30d3\u30c7\u30aa\u3001\u30aa\u30fc\u30c7\u30a3\u30aa\u3092\u51e6\u7406\u3057\u3066\u3001GPT-4V/Sora \u30af\u30e9\u30b9 \u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002</p>"},{"location":"ja/#6","title":"\u7b2c 6 \u7ae0: \u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u306e\u51e6\u7406","text":"<ul> <li>6_1 \u30c7\u30fc\u30bf \u30d1\u30e9\u30c0\u30a4\u30e0: \u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2 (LAION-5B) \u3068\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (OBELICS/MMC4)\u3002</li> <li>6_2 \u753b\u50cf\u306e\u53d6\u5f97\u3068\u524d\u51e6\u7406:</li> <li><code>img2dataset</code> \u5b9f\u969b\u306e\u9ad8\u540c\u6642\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3002</li> <li>GPU \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u308b\u30c7\u30b3\u30fc\u30c9\u3068\u5909\u63db (NVIDIA DALI)\u3002</li> <li>6_3 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3:</li> <li>\u7f8e\u7684\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0: CLIP-Score \u3092\u4f7f\u7528\u3057\u3066\u7f8e\u7684\u4fa1\u5024\u306e\u9ad8\u3044\u753b\u50cf\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002</li> <li>\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u914d\u7f6e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0: \u4e0d\u4e00\u81f4\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u524a\u9664\u3057\u307e\u3059\u3002</li> <li>\u5b89\u5168\u6027\u691c\u51fa: NSFW \u304a\u3088\u3073\u30a6\u30a9\u30fc\u30bf\u30fc\u30de\u30fc\u30af\u691c\u51fa\u3002</li> </ul>"},{"location":"ja/#7","title":"\u7b2c 7 \u7ae0: \u8981\u7d04","text":"<ul> <li>7_1 \u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306e\u5236\u9650: \u751f\u306e Web \u8aac\u660e\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044\u7406\u7531\u3002</li> <li>7_2 \u5408\u6210\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 \u30d5\u30a1\u30af\u30c8\u30ea\u30fc:</li> <li>BLIP-2 / LLaVA / CogVLM \u3092\u4f7f\u7528\u3057\u3066\u8a73\u7d30\u306a\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3092\u518d\u751f\u6210\u3057\u307e\u3059\u3002</li> <li>\u30d7\u30ed\u30f3\u30d7\u30c8\u6226\u7565: \u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u306e\u7c92\u5ea6\u3092\u5236\u5fa1\u3057\u307e\u3059 (\u7c21\u6f54\u304b\u8a73\u7d30\u304b)\u3002</li> <li>7_3 OCR \u5f37\u5316: \u753b\u50cf\u5185\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u62bd\u51fa\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u8aac\u660e\u306b\u878d\u5408\u3057\u307e\u3059 (\u6587\u66f8\u306e\u7406\u89e3\u306b\u4e0d\u53ef\u6b20)\u3002</li> </ul>"},{"location":"ja/#8","title":"\u7b2c 8 \u7ae0: \u30d3\u30c7\u30aa\u304a\u3088\u3073\u30aa\u30fc\u30c7\u30a3\u30aa \u30c7\u30fc\u30bf","text":"<ul> <li>8_1 \u30d3\u30c7\u30aa\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30b7\u30fc\u30f3\u691c\u51fa\u304a\u3088\u3073\u30ad\u30fc\u30d5\u30ec\u30fc\u30e0\u62bd\u51fa\u6226\u7565\u3002</li> <li>8_2 \u30d3\u30c7\u30aa\u30c8\u30fc\u30af\u30f3\u5316: \u30d3\u30c7\u30aa\u5727\u7e2e\u3068\u96e2\u6563\u8868\u73fe\u3002</li> <li>8_3 \u30aa\u30fc\u30c7\u30a3\u30aa \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8: \u30a6\u30a3\u30b9\u30d1\u30fc\u304a\u3088\u3073\u30d5\u30a9\u30fc\u30b9 \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8 (\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7 \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8) \u3092\u5099\u3048\u305f\u5927\u898f\u6a21\u306a ASR\u3002</li> </ul>"},{"location":"ja/#4_1","title":"\u30d1\u30fc\u30c8 4: \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8\u3068\u5408\u6210\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0","text":"<p>\u76ee\u6a19: \u30e2\u30c7\u30eb\u3092\u6307\u793a\u306b\u5f93\u308f\u305b\u3001\u4eba\u9593\u306e\u30c7\u30fc\u30bf\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u7a81\u7834\u3057\u307e\u3059\u3002</p>"},{"location":"ja/#9-sft-sft","title":"\u7b2c 9 \u7ae0: SFT\u30c7\u30fc\u30bf (SFT \u30c7\u30fc\u30bf)","text":"<ul> <li>9_1 \u30c7\u30fc\u30bf\u751f\u6210\u306e\u305f\u3081\u306e\u30d7\u30ed\u30f3\u30d7\u30c8 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0: \u5805\u7262\u306a\u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</li> <li>9_2 \u81ea\u52d5\u5316\u3055\u308c\u305f\u69cb\u7bc9\u65b9\u6cd5:</li> <li>Self-Instruct: \u5f37\u529b\u306a\u30e2\u30c7\u30eb\u3092\u5229\u7528\u3057\u3066\u6307\u793a\u3092\u751f\u6210\u3057\u307e\u3059\u3002</li> <li>Evol-Instruct: \u547d\u4ee4\u306e\u8907\u96d1\u3055\u306b\u5bfe\u3059\u308b\u9032\u5316\u7684\u306a\u6226\u7565\u3002</li> <li>9_3 \u601d\u8003\u9023\u9396 (CoT) \u30c7\u30fc\u30bf: \u6bb5\u968e\u7684\u306a\u63a8\u8ad6\u30b5\u30f3\u30d7\u30eb\u306e\u69cb\u7bc9\u3002</li> </ul>"},{"location":"ja/#10","title":"\u7b2c 10 \u7ae0: \u5408\u6210\u30c7\u30fc\u30bf","text":"<ul> <li>10_1 \u6559\u79d1\u66f8\u54c1\u8cea\u306e\u30c7\u30fc\u30bf (\u5fc5\u8981\u306a\u306e\u306f\u6559\u79d1\u66f8\u3060\u3051): \u9ad8\u54c1\u8cea\u306e\u30c9\u30e1\u30a4\u30f3\u77e5\u8b58\u3092\u7d71\u5408\u3057\u307e\u3059\u3002</li> <li>10_2 \u30b3\u30fc\u30c9\u3068\u6570\u5b66\u306e\u5408\u6210:</li> <li>PoT (Program of Thought): \u30b3\u30fc\u30c9\u3092\u751f\u6210\u3057\u3001\u5b9f\u884c\u3057\u3001\u5b9f\u884c\u7d50\u679c\u3092\u901a\u3058\u3066\u30c7\u30fc\u30bf\u306e\u6b63\u78ba\u6027\u3092\u691c\u8a3c\u3057\u307e\u3059\u3002</li> <li>10_3 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u547d\u4ee4\u5408\u6210: GPT-4o \u3092\u4f7f\u7528\u3057\u3066\u3001\u8907\u96d1\u306a\u753b\u50cf\u30d9\u30fc\u30b9\u306e\u63a8\u8ad6 Q&amp;A \u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/#11-rlhfdpo","title":"\u7b2c 11 \u7ae0: \u4eba\u9593\u306e\u55dc\u597d\u30c7\u30fc\u30bf (RLHF/DPO)","text":"<ul> <li>11_1 \u512a\u5148\u30c7\u30fc\u30bf\u5f62\u5f0f: \u9078\u629e\u3055\u308c\u305f\u30b5\u30f3\u30d7\u30eb\u3068\u62d2\u5426\u3055\u308c\u305f\u30b5\u30f3\u30d7\u30eb\u306e\u30da\u30a2\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</li> <li>11_2 \u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3068\u54c1\u8cea\u7ba1\u7406: \u30af\u30e9\u30a6\u30c9\u30bd\u30fc\u30b7\u30f3\u30b0\u7ba1\u7406\u3068 IAA (\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u9593\u5408\u610f) \u5206\u6790\u3002</li> <li>11_3 RLAIF (AI \u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af): LLM \u3092\u4f7f\u7528\u3057\u3066\u4eba\u9593\u306e\u55dc\u597d\u30b9\u30b3\u30a2\u3092\u7f6e\u304d\u63db\u3048\u307e\u3059\u3002</li> </ul>"},{"location":"ja/#5-rag","title":"\u30d1\u30fc\u30c8 5: \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u30ec\u30d9\u30eb\u306e\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 (RAG \u304a\u3088\u3073\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8)","text":"<p>\u76ee\u6a19: \u5916\u90e8\u30ca\u30ec\u30c3\u30b8\u30d9\u30fc\u30b9\u306e\u89e3\u6790\u3068\u53d6\u5f97\u306e\u305f\u3081\u306e\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u5411\u3051\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u3002</p>"},{"location":"ja/#12-rag","title":"\u7b2c 12 \u7ae0: RAG \u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<ul> <li>12_1 \u8a73\u7d30\u306a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u89e3\u6790:</li> <li>\u8907\u96d1\u306a PDF \u51e6\u7406: \u30c6\u30fc\u30d6\u30eb\u306e\u518d\u69cb\u7bc9\u3001\u8907\u6570\u5217\u306e\u8a8d\u8b58 (<code>Unstructured</code>\u3001<code>LlamaParse</code>)\u3002</li> <li>12_2 \u30c1\u30e3\u30f3\u30af\u6226\u7565: \u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af \u30c1\u30e3\u30f3\u30af\u3001\u518d\u5e30\u7684\u30c1\u30e3\u30f3\u30af\u3001\u304a\u3088\u3073\u89aa\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u3002</li> <li>12_3 \u30d9\u30af\u30c8\u30eb\u5316\u3068\u30b9\u30c8\u30ec\u30fc\u30b8: Embedding\u30e2\u30c7\u30eb\u306e\u5fae\u8abf\u6574\u3068\u30d9\u30af\u30c8\u30eb \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u6700\u9069\u5316\u3002</li> </ul>"},{"location":"ja/#13-rag","title":"\u7b2c 13 \u7ae0: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb RAG","text":"<ul> <li>13_1 \u30af\u30ed\u30b9\u30e2\u30fc\u30c0\u30eb\u691c\u7d22: \u300c\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u753b\u50cf\u3078\u300d\u304a\u3088\u3073\u300c\u753b\u50cf\u304b\u3089\u30c6\u30ad\u30b9\u30c8\u3078\u300d\u691c\u7d22\u306b CLIP/SigLIP \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</li> <li>13_2 ColPali \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u5b9f\u8df5: \u30d3\u30b8\u30e7\u30f3\u8a00\u8a9e\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u304f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u691c\u7d22 (OCR \u3092\u30b9\u30ad\u30c3\u30d7\u3057\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u753b\u50cf\u3092\u76f4\u63a5\u7406\u89e3)\u3002</li> </ul>"},{"location":"ja/#6_1","title":"\u30d1\u30fc\u30c8 6: \u30ad\u30e3\u30c3\u30d7\u30b9\u30c8\u30fc\u30f3 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8","text":"<p>\u76ee\u6a19: 5 \u3064\u306e\u30a8\u30f3\u30c9\u30c4\u30fc\u30a8\u30f3\u30c9 \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u901a\u3058\u3066\u3001\u672c\u66f8\u306e\u3059\u3079\u3066\u306e\u6280\u8853\u30c8\u30d4\u30c3\u30af\u3092\u5b9f\u884c\u53ef\u80fd\u306a\u30b3\u30fc\u30c9 \u30ea\u30dd\u30b8\u30c8\u30ea\u3068\u7d71\u5408\u3057\u307e\u3059\u3002</p>"},{"location":"ja/#1-mini-c4","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 1: \u300cMini-C4\u300d\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30bb\u30c3\u30c8\u306e\u69cb\u7bc9","text":"<ul> <li>\u30b7\u30ca\u30ea\u30aa: Common Crawl \u306e\u751f\u30c7\u30fc\u30bf (WARC) \u304b\u3089\u9ad8\u54c1\u8cea\u306e Parquet \u30c7\u30fc\u30bf\u307e\u3067\u3002</li> <li>\u30b3\u30a2 \u30c6\u30af\u30ce\u30ed\u30b8\u30fc: Trafilatura \u89e3\u6790\u3001Spark/Ray \u5206\u6563 MinHash \u91cd\u8907\u6392\u9664\u3001KenLM \u54c1\u8cea\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3002</li> <li>\u51fa\u529b: \u30af\u30ea\u30fc\u30f3\u306a\u30d7\u30ec\u30fc\u30f3 \u30c6\u30ad\u30b9\u30c8 \u30b3\u30fc\u30d1\u30b9\u3068\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3002</li> </ul>"},{"location":"ja/#2-sft","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 2: \u30c9\u30e1\u30a4\u30f3\u30a8\u30ad\u30b9\u30d1\u30fc\u30c8 SFT (\u6cd5\u52d9/\u533b\u7642)","text":"<ul> <li>\u30b7\u30ca\u30ea\u30aa: \u5efa\u7bc9\u696d\u754c\u306e\u5c02\u9580\u5bb6\u304c\u3001\u975e\u69cb\u9020\u5316 PDF \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304b\u3089\u30c7\u30fc\u30bf\u3092\u5fae\u8abf\u6574\u3057\u307e\u3059\u3002</li> <li>\u30b3\u30a2 \u30c6\u30af\u30ce\u30ed\u30b8\u30fc: Self-Instruct \u547d\u4ee4\u306e\u751f\u6210\u3001CoT \u63a8\u8ad6\u306e\u5f37\u5316\u3001\u30c7\u30fc\u30bf\u591a\u69d8\u6027\u306e\u30d0\u30e9\u30f3\u30b9\u3002</li> <li>\u51fa\u529b: <code>domain_expert.jsonl</code> SFT\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3002</li> </ul>"},{"location":"ja/#3-llava","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 3: LLaVA \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u547d\u4ee4\u30bb\u30c3\u30c8\u306e\u69cb\u7bc9","text":"<ul> <li>\u30b7\u30ca\u30ea\u30aa: \u753b\u50cf\u3092\u7406\u89e3\u3067\u304d\u308b\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u307e\u3059\u3002</li> <li>\u30b3\u30a2 \u30c6\u30af\u30ce\u30ed\u30b8\u30fc: GPT-4o API \u3092\u4f7f\u7528\u3057\u3066\u3001\u8907\u6570\u56de\u8ee2\u306e\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u5bfe\u8a71\u3001\u5883\u754c\u30dc\u30c3\u30af\u30b9 \u30c7\u30fc\u30bf\u306e\u914d\u7f6e\u3001\u8907\u6570\u753b\u50cf\u306e\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u5f62\u5f0f\u306e\u51e6\u7406\u3092\u884c\u3044\u307e\u3059\u3002</li> <li>\u51fa\u529b: \u8996\u899a\u7684\u306a\u6307\u793a\u3092\u542b\u3080\u753b\u50cf\u30c6\u30ad\u30b9\u30c8 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3002</li> </ul>"},{"location":"ja/#4_2","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 4: \u7dcf\u5408\u6570\u5b66/\u30b3\u30fc\u30c9\u306e\u6559\u79d1\u66f8","text":"<ul> <li>\u30b7\u30ca\u30ea\u30aa: \u5c0f\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u8ad6\u7406\u7684\u63a8\u8ad6\u6a5f\u80fd\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</li> <li>\u30b3\u30a2 \u30c6\u30af\u30ce\u30ed\u30b8\u30fc: Evol-Instruct \u9032\u5316\u6226\u7565\u3001Python \u30b3\u30fc\u30c9\u5b9f\u884c\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u691c\u8a3c\u3001PoT \u30c7\u30fc\u30bf\u5f62\u5f0f\u3002</li> <li>\u51fa\u529b: \u691c\u8a3c\u3055\u308c\u305f\u9ad8\u54c1\u8cea\u306e\u5408\u6210\u63a8\u8ad6\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3002</li> </ul>"},{"location":"ja/#5-rag_1","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 5: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb RAG \u8ca1\u52d9\u30ec\u30dd\u30fc\u30c8 \u30a2\u30b7\u30b9\u30bf\u30f3\u30c8","text":"<ul> <li>\u30b7\u30ca\u30ea\u30aa: \u8907\u96d1\u306a\u30b0\u30e9\u30d5\u3092\u542b\u3080\u5e74\u6b21\u5831\u544a\u66f8\u306b\u95a2\u3059\u308b\u8cea\u554f\u3092\u53d6\u5f97\u3057\u3066\u56de\u7b54\u3057\u307e\u3059\u3002</li> <li>\u30b3\u30a2 \u30c6\u30af\u30ce\u30ed\u30b8\u30fc: PDF \u30c6\u30fc\u30d6\u30eb\u3068\u30c1\u30e3\u30fc\u30c8\u306e\u89e3\u6790\u3001\u30de\u30eb\u30c1\u30eb\u30fc\u30c8 \u30ea\u30b3\u30fc\u30eb (\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u691c\u7d22)\u3001ColPali \u30d3\u30b8\u30e5\u30a2\u30eb\u691c\u7d22\u3002</li> <li>\u51fa\u529b: \u30c1\u30e3\u30fc\u30c8 Q&amp;A \u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b RAG \u77e5\u8b58\u30d9\u30fc\u30b9 \u30b7\u30b9\u30c6\u30e0\u3002</li> </ul> <p>\uff03\uff03 \u4ed8\u9332</p> <ul> <li>\u4ed8\u9332 A: \u5171\u901a\u30c4\u30fc\u30eb\u306e\u30af\u30a4\u30c3\u30af \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9 (\u30cf\u30b0\u9854\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3001LangChain\u3001\u30ec\u30a4 \u30c7\u30fc\u30bf)\u3002</li> <li>\u4ed8\u9332 B: \u30c7\u30fc\u30bf \u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9 \u30c1\u30a7\u30c3\u30af\u30ea\u30b9\u30c8 (\u8457\u4f5c\u6a29\u3001GDPR\u3001robots.txt)\u3002</li> <li>\u4ed8\u9332 C: \u8a08\u7b97\u30b3\u30b9\u30c8\u306e\u898b\u7a4d\u3082\u308a (\u3055\u307e\u3056\u307e\u306a\u30c7\u30fc\u30bf\u51e6\u7406\u898f\u6a21\u3067\u306e GPU/CPU \u6d88\u8cbb\u91cf\u306e\u53c2\u7167)\u3002</li> </ul>"},{"location":"ja/part1/1_1_data_change/","title":"\u7b2c1\u7ae0: LLM\u6642\u4ee3\u306e\u30c7\u30fc\u30bf\u9769\u547d","text":""},{"location":"ja/part1/1_1_data_change/#1","title":"\u7b2c 1 \u7ae0: \u5927\u898f\u6a21\u8a00\u8a9e\u30e2\u30c7\u30eb\u6642\u4ee3\u306e\u30c7\u30fc\u30bf\u5909\u63db","text":""},{"location":"ja/part1/1_1_data_change/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u5927\u898f\u6a21\u8a00\u8a9e\u30e2\u30c7\u30eb (LLM) \u306e\u53f0\u982d\u306b\u3088\u308a\u3001\u4eba\u5de5\u77e5\u80fd\u306e\u30d1\u30e9\u30c0\u30a4\u30e0\u304c\u518d\u5f62\u6210\u3055\u308c\u307e\u3057\u305f\u3002\u305f\u3060\u3057\u3001\u30e2\u30c7\u30eb \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u9769\u65b0\u306f\u53ce\u675f\u3057\u3066\u304a\u308a\u3001\u30e2\u30c7\u30eb\u306e\u6a5f\u80fd\u306e\u4e0a\u9650\u3092\u771f\u306b\u6c7a\u5b9a\u3059\u308b\u306e\u306f \u30c7\u30fc\u30bf\u54c1\u8cea \u3067\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u5247\u306e\u89b3\u70b9\u304b\u3089\u300c\u30b3\u30a2\u8cc7\u7523\u3068\u3057\u3066\u306e\u30c7\u30fc\u30bf\u300d\u3068\u3044\u3046\u6982\u5ff5\u3092\u78ba\u7acb\u3057\u3001LLM \u30c7\u30fc\u30bf\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u5168\u4f53\u3092\u4f53\u7cfb\u7684\u306b\u7d39\u4ecb\u3057\u3001\u7570\u7a2e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u3001\u8457\u4f5c\u6a29\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30b3\u30b9\u30c8\u306a\u3069\u306e\u5b9f\u969b\u7684\u306a\u8ab2\u984c\u3092\u691c\u8a0e\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#_2","title":"\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb","text":"<p>\u3042\u306a\u305f\u306f AI \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u4f01\u696d\u306e\u30c7\u30fc\u30bf \u30ea\u30fc\u30c9\u3067\u3059\u3002\u30c1\u30fc\u30e0\u306f\u3001\u516c\u958b Web \u304b\u3089 50TB \u306e\u4e2d\u56fd\u8a9e\u30c6\u30ad\u30b9\u30c8\u3092\u30af\u30ed\u30fc\u30eb\u3059\u308b\u306e\u306b 3 \u304b\u6708\u3092\u8cbb\u3084\u3057\u3001\u81ea\u4fe1\u3092\u6301\u3063\u3066 7B \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u57fa\u672c\u30e2\u30c7\u30eb\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3092\u958b\u59cb\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>\u3057\u304b\u3057\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3092\u958b\u59cb\u3057\u3066 2 \u9031\u9593\u304c\u7d4c\u904e\u3059\u308b\u3068\u3001\u3042\u308b\u6642\u70b9\u3067\u640d\u5931\u66f2\u7dda\u304c\u7a81\u7136\u300c\u5e73\u5766\u300d\u306b\u306a\u308a\u3001\u30e2\u30c7\u30eb\u306e\u51fa\u529b\u306f\u5e83\u544a\u30b3\u30d4\u30fc\u3001\u53cd\u5fa9\u7684\u306a SEO \u306e\u30b8\u30e3\u30f3\u30af\u3067\u57cb\u3081\u5c3d\u304f\u3055\u308c\u3001\u7279\u5b9a\u306e Web \u30b5\u30a4\u30c8\u306e\u30e6\u30fc\u30b6\u30fc\u540c\u610f\u66f8\u3055\u3048\u3082\u5f15\u7528\u3055\u308c\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u4e8b\u5f8c\u4f1a\u8b70\u3067\u3001\u4e0a\u7d1a\u30a8\u30f3\u30b8\u30cb\u30a2\u304c\u92ed\u3044\u8cea\u554f\u3092\u3057\u307e\u3057\u305f\u3002\u300c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u7528\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306b 100 \u4e07\u30c9\u30eb\u3092\u8cbb\u3084\u3057\u305f\u5f8c\u3001\u79c1\u305f\u3061\u306f\u8a00\u8a9e\u30e2\u30c7\u30eb\u3092\u69cb\u7bc9\u3059\u308b\u306e\u3067\u3057\u3087\u3046\u304b\u3001\u305d\u308c\u3068\u3082\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306e\u30b4\u30df\u306e\u5727\u7e2e\u3055\u308c\u305f\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u69cb\u7bc9\u3059\u308b\u306e\u3067\u3057\u3087\u3046\u304b?\u300d</p> <p>\u3053\u306e\u30b7\u30ca\u30ea\u30aa\u306f\u634f\u9020\u3055\u308c\u305f\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002 OpenAI\u3001Google\u3001Meta\u3001\u305d\u306e\u4ed6\u306e\u30c8\u30c3\u30d7\u30e9\u30dc\u306f\u3059\u3067\u306b\u30b3\u30f3\u30bb\u30f3\u30b5\u30b9\u306b\u9054\u3057\u3066\u3044\u307e\u3059\u3002\u30e2\u30c7\u30eb \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u304c\u53ce\u675f\u3059\u308b\u6642\u4ee3\u306b\u304a\u3044\u3066\u306f\u3001\u30c7\u30fc\u30bf\u54c1\u8cea\u304c\u30e2\u30c7\u30eb\u306e\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30b9\u306e\u4e0a\u9650\u3092\u6c7a\u5b9a\u3059\u308b\u4e2d\u5fc3\u7684\u306a\u5909\u6570\u3067\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#11","title":"1.1 \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306e\u6cd5\u5247\u306e\u5f71\u97ff: \u300c\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u300d\u304b\u3089\u300c\u9ad8\u54c1\u8cea\u30c7\u30fc\u30bf\u300d\u3078\u306e\u30d1\u30e9\u30c0\u30a4\u30e0\u30b7\u30d5\u30c8","text":""},{"location":"ja/part1/1_1_data_change/#111","title":"1.1.1 \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u5247\u3068\u306f\u4f55\u3067\u3059\u304b?","text":"<p>2020 \u5e74\u3001OpenAI \u306f\u753b\u671f\u7684\u306a\u8ad6\u6587 \u795e\u7d4c\u8a00\u8a9e\u30e2\u30c7\u30eb\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u5247 \u3092\u767a\u8868\u3057\u3001\u5358\u7d14\u3060\u304c\u5965\u6df1\u3044\u898f\u5247\u6027\u3092\u660e\u3089\u304b\u306b\u3057\u307e\u3057\u305f\u3002\u3064\u307e\u308a\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 (\u640d\u5931\u3067\u6e2c\u5b9a) \u306f\u3001\u30e2\u30c7\u30eb \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u6570 \\(N\\)\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8 \u30b5\u30a4\u30ba \\(D\\)\u3001\u304a\u3088\u3073\u8a08\u7b97 \\(C\\) \u3068\u3044\u3046 3 \u3064\u306e\u6838\u3068\u306a\u308b\u8981\u7d20\u3068\u306e\u3079\u304d\u4e57\u5247\u306e\u95a2\u4fc2\u306b\u5f93\u3044\u307e\u3059\u3002</p> \\[ L(N, D, C) \\\u304a\u3088\u305d \\left(\\frac{N_c}{N}\\right)^{\\alpha_N} + \\left(\\frac{D_c}{D}\\right)^{\\alpha_D} + \\left(\\frac{C_c}{C}\\right)^{\\alpha_C} \\] <p>\u3053\u3053\u3067\u3001\\(L\\) \u306f\u30e2\u30c7\u30eb\u306e\u30af\u30ed\u30b9\u30a8\u30f3\u30c8\u30ed\u30d4\u30fc\u640d\u5931\u3001\\(N_c\u3001D_c\u3001C_c\\) \u306f\u5b9a\u6570\u3001\\(\\alpha\\) \u306f\u3079\u304d\u4e57\u5247\u6307\u6570\u3067\u3059\u3002\u7c21\u5358\u306b\u8a00\u3046\u3068\u3001\u30e2\u30c7\u30eb\u3092\u3088\u308a\u30b9\u30de\u30fc\u30c8\u306b\u3059\u308b\u306b\u306f\u3001\u30e2\u30c7\u30eb\u306e\u30b9\u30b1\u30fc\u30eb\u3092\u5897\u3084\u3059\u304b\u3001\u3088\u308a\u591a\u304f\u306e\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3059\u308b\u304b\u3001\u3088\u308a\u591a\u304f\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u6295\u8cc7\u3059\u308b\u304b\u306e\u3044\u305a\u308c\u304b\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u3089 3 \u3064\u306e\u8981\u7d20\u304c\u76f8\u4e92\u306b\u5236\u7d04\u3057\u3001LLM \u6642\u4ee3\u306e\u300c\u4e0d\u53ef\u80fd\u306a\u4e09\u89d2\u5f62\u300d\u3092\u5f62\u6210\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u767a\u898b\u306f\u5b66\u754c\u3068\u7523\u696d\u754c\u306b\u885d\u6483\u3092\u4e0e\u3048\u307e\u3057\u305f\u3002\u3053\u308c\u4ee5\u524d\u306f\u3001\u6df1\u5c64\u5b66\u7fd2\u306e\u958b\u767a\u306f\u300c\u932c\u91d1\u8853\u300d\u306b\u4f3c\u3066\u304a\u308a\u3001\u7814\u7a76\u8005\u306f\u76f4\u611f\u3068\u7d4c\u9a13\u306b\u983c\u3063\u3066\u30e2\u30c7\u30eb \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u8abf\u6574\u3057\u3001\u5076\u7136\u306e\u30d6\u30ec\u30fc\u30af\u30b9\u30eb\u30fc\u3092\u671f\u5f85\u3057\u3066\u3044\u307e\u3057\u305f\u3002\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u5247\u306e\u51fa\u73fe\u306b\u3088\u308a\u3001\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u304c\u82b8\u8853\u304b\u3089\u5de5\u5b66\u79d1\u5b66\u306b\u521d\u3081\u3066\u79fb\u884c\u3057\u3001\u4f01\u696d\u306f\u6b63\u78ba\u306a\u6570\u5b66\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u3066\u30ea\u30bd\u30fc\u30b9\u306e\u6295\u8cc7\u3068\u671f\u5f85\u3055\u308c\u308b\u6210\u679c\u3092\u8a08\u753b\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3057\u305f\u3002</p>"},{"location":"ja/part1/1_1_data_change/#112","title":"1.1.2 \u30c7\u30fc\u30bf\u54c1\u8cea\u306e\u300c\u96a0\u308c\u305f\u5909\u6570\u300d","text":"<p>\u3057\u304b\u3057\u3001\u5143\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u6cd5\u306b\u306f\u91cd\u5927\u306a\u76f2\u70b9\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u305d\u308c\u306f\u3001\u3059\u3079\u3066\u306e\u30c7\u30fc\u30bf\u306e\u300c\u54c1\u8cea\u300d\u304c\u5747\u4e00\u3067\u3042\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u305f\u304b\u3089\u3067\u3059\u3002\u3053\u306e\u4eee\u5b9a\u306f\u660e\u3089\u304b\u306b\u73fe\u5b9f\u306b\u306f\u5f53\u3066\u306f\u307e\u308a\u307e\u305b\u3093\u3002\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306e\u30c6\u30ad\u30b9\u30c8\u306e\u54c1\u8cea\u306f\u3001\u6ce8\u610f\u6df1\u304f\u66f8\u304b\u308c\u305f\u5b66\u8853\u8ad6\u6587\u304b\u3089\u30bf\u30a4\u30d7\u30df\u30b9\u3060\u3089\u3051\u306e\u30b3\u30e1\u30f3\u30c8\u307e\u3067\u591a\u5c90\u306b\u308f\u305f\u308a\u3001\u30c7\u30fc\u30bf\u9593\u306e\u4fa1\u5024\u306e\u9055\u3044\u306f\u6841\u9055\u3044\u306b\u53ca\u3076\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>2022 \u5e74\u3001DeepMind \u306e\u30c1\u30f3\u30c1\u30e9\u8ad6\u6587\u306f\u3053\u306e\u4eee\u5b9a\u3092\u6253\u3061\u7834\u308a\u307e\u3057\u305f\u3002\u7814\u7a76\u30c1\u30fc\u30e0\u306f\u5927\u898f\u6a21\u306a\u5b9f\u9a13\u3092\u5b9f\u65bd\u3057\u307e\u3057\u305f\u3002\u540c\u3058\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u4e88\u7b97\u306e\u4e0b\u3067\u3001\u7570\u306a\u308b\u30e2\u30c7\u30eb \u30b5\u30a4\u30ba\u3068\u30c7\u30fc\u30bf\u91cf\u6bd4\u7387\u306e\u52b9\u679c\u3092\u6bd4\u8f03\u3057\u307e\u3057\u305f\u3002\u3053\u306e\u7d50\u679c\u306f\u696d\u754c\u306b\u885d\u6483\u3092\u4e0e\u3048\u307e\u3057\u305f\u3002Gopher \u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u308f\u305a\u304b 4 \u5206\u306e 1 \u3067\u3042\u308b\u30c1\u30f3\u30c1\u30e9 (70B \u30d1\u30e9\u30e1\u30fc\u30bf) \u306f\u30014 \u500d\u306e\u9ad8\u54c1\u8cea\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf (1.4T \u30c8\u30fc\u30af\u30f3) \u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3067\u3001\u307b\u307c\u3059\u3079\u3066\u306e\u8a55\u4fa1\u30bf\u30b9\u30af\u3067 280B \u30d1\u30e9\u30e1\u30fc\u30bf Gopher \u3092\u4e0a\u56de\u308a\u307e\u3057\u305f\u3002</p> \u30e2\u30c7\u30eb \u30d1\u30e9\u30e1\u30fc\u30bf \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u30c8\u30fc\u30af\u30f3 \u6700\u7d42\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u30db\u30ea\u30cd\u30ba\u30df 280B 300B \u30c8\u30fc\u30af\u30f3 \u30d9\u30fc\u30b9\u30e9\u30a4\u30f3 \u30c1\u30f3\u30c1\u30e9 70B 1.4T \u30c8\u30fc\u30af\u30f3 Gopher \u3092\u4e0a\u56de\u308b\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 <p>\u3053\u306e\u8abf\u67fb\u306b\u3088\u308a\u3001\u9577\u5e74\u7121\u8996\u3055\u308c\u3066\u304d\u305f\u4e8b\u5b9f\u304c\u660e\u3089\u304b\u306b\u306a\u308a\u307e\u3057\u305f\u3002\u3064\u307e\u308a\u3001\u696d\u754c\u306f\u3053\u308c\u307e\u3067\u3001\u30c7\u30fc\u30bf\u91cf\u3092\u904e\u5c0f\u8a55\u4fa1\u3057\u306a\u304c\u3089\u30e2\u30c7\u30eb\u898f\u6a21\u3067\u904e\u5270\u9069\u5408\u3057\u3066\u3044\u305f\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002 Chinchilla \u306e\u8ad6\u6587\u3067\u306f\u3001\u8ffd\u52a0\u30d1\u30e9\u30e1\u30fc\u30bf\u3054\u3068\u306b\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u7d04 20 \u30c8\u30fc\u30af\u30f3\u3092\u5272\u308a\u5f53\u3066\u308b\u5fc5\u8981\u304c\u3042\u308b\u3068\u3044\u3046\u300c\u6700\u9069\u306a\u6bd4\u7387\u300d\u3092\u63a8\u5968\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u30017B \u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u306f\u7406\u8ad6\u7684\u306b\u306f\u7d04 140B \u30c8\u30fc\u30af\u30f3\u306e\u9ad8\u54c1\u8cea\u30b3\u30fc\u30d1\u30b9\u304c\u5fc5\u8981\u3067\u3042\u308b\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u591a\u304f\u306e\u30c1\u30fc\u30e0\u304c\u5f53\u521d\u4e88\u60f3\u3057\u3066\u3044\u305f\u6570\u3092\u306f\u308b\u304b\u306b\u8d85\u3048\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#113-phi","title":"1.1.3 \u8cea\u3068\u91cf: Phi \u30b7\u30ea\u30fc\u30ba\u306e\u6975\u7aef\u306a\u5b9f\u9a13","text":"<p>Chinchilla \u304c\u300c\u30c7\u30fc\u30bf\u91cf\u304c\u904e\u5c0f\u8a55\u4fa1\u3055\u308c\u3066\u3044\u305f\u300d\u3053\u3068\u3092\u8a3c\u660e\u3057\u305f\u3068\u3059\u308c\u3070\u3001Microsoft \u306e Phi \u30b7\u30ea\u30fc\u30ba\u306f\u3055\u3089\u306b\u904e\u6fc0\u306a\u898b\u89e3\u3092\u793a\u3057\u307e\u3057\u305f\u3002\u3064\u307e\u308a\u3001\u30c7\u30fc\u30bf\u306e\u54c1\u8cea\u304c\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306e\u6cd5\u5247\u3092\u7121\u52b9\u306b\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002</p> <p>2023 \u5e74\u306b\u3001Microsoft Research \u306f Phi-1 \u30e2\u30c7\u30eb\u3092\u30ea\u30ea\u30fc\u30b9\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u3001\u308f\u305a\u304b 13 \u5104\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u5099\u3048\u305f\u300c\u5c0f\u898f\u6a21\u300d\u30e2\u30c7\u30eb\u3067\u3001\u308f\u305a\u304b 70 \u5104\u306e\u30c8\u30fc\u30af\u30f3\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u6570\u5343\u5104\u3001\u3055\u3089\u306b\u306f\u6570\u5146\u306e\u30c8\u30fc\u30af\u30f3\u3092\u4f7f\u7528\u3059\u308b\u5f53\u6642\u306e\u4e3b\u6d41\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3068\u306f\u307e\u3063\u305f\u304f\u5bfe\u7167\u7684\u3067\u3059\u3002\u3057\u304b\u3057\u3001\u4e00\u898b\u300c\u6804\u990a\u5931\u8abf\u300d\u306b\u898b\u3048\u308b\u3053\u306e\u30e2\u30c7\u30eb\u306f\u3001\u30b3\u30fc\u30c9\u751f\u6210\u30bf\u30b9\u30af\u306b\u304a\u3044\u3066 10 \u500d\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u3067\u7af6\u5408\u4ed6\u793e\u3092\u4e0a\u56de\u308a\u307e\u3057\u305f\u3002</p> <p>Phi-1 \u306e\u79d8\u5bc6\u5175\u5668\u306f\u3001\u30af\u30ed\u30fc\u30eb\u3055\u308c\u305f\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u3067\u306f\u306a\u304f\u3001\u6559\u80b2\u7684\u4fa1\u5024\u306e\u3042\u308b\u614e\u91cd\u306b\u8a2d\u8a08\u3055\u308c\u305f\u5408\u6210\u30c7\u30fc\u30bf\u3067\u3057\u305f\u3002\u7814\u7a76\u8005\u3089\u306f GPT-4 \u3092\u4f7f\u7528\u3057\u3066\u3001\u57fa\u672c\u7684\u306a\u69cb\u6587\u304b\u3089\u9ad8\u5ea6\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u81f3\u308b\u307e\u3067\u3001\u5927\u91cf\u306e\u69cb\u9020\u5316\u3055\u308c\u305f\u6bb5\u968e\u7684\u306a\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0 \u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u751f\u6210\u3057\u3001\u5b8c\u5168\u306a\u300c\u4eba\u5de5\u6559\u79d1\u66f8\u300d\u3092\u5f62\u6210\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u3089\u306e\u5408\u6210\u30c7\u30fc\u30bf\u306b\u306f\u3001\u30ce\u30a4\u30ba\u304c\u306a\u304f\u3001\u30a8\u30e9\u30fc\u304c\u306a\u304f\u3001\u8ad6\u7406\u304c\u660e\u78ba\u3067\u3001\u96e3\u6613\u5ea6\u304c\u6bb5\u968e\u7684\u306b\u4e0a\u304c\u308b\u3068\u3044\u3046\u3001\u5b9f\u969b\u306e Web \u30c7\u30fc\u30bf\u306b\u306f\u307b\u3068\u3093\u3069\u5339\u6575\u3057\u306a\u3044\u5229\u70b9\u304c\u3042\u308a\u307e\u3057\u305f\u3002\u3053\u308c\u3089\u306e\u300c\u4eba\u5de5\u6559\u79d1\u66f8\u300d\u3067\u8a13\u7df4\u3055\u308c\u305f\u5c0f\u3055\u306a\u30e2\u30c7\u30eb\u306f\u3001\u5b9f\u969b\u306e\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u969b\u306b\u9a5a\u304f\u3079\u304d\u80fd\u529b\u3092\u793a\u3057\u307e\u3057\u305f\u3002</p> <p></p> <p>\u56f3 1-1: \u30c7\u30fc\u30bf\u54c1\u8cea\u3068\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u95a2\u4fc2 \u2014 \u30af\u30ec\u30f3\u30b8\u30f3\u30b0\u5f8c\u306e\u4f4e\u54c1\u8cea\u30c7\u30fc\u30bf (40% \u30ce\u30a4\u30ba) \u306f\u9ad8\u54c1\u8cea\u30c7\u30fc\u30bf (5% \u30ce\u30a4\u30ba) \u306b\u306a\u308a\u307e\u3059</p> <p>Phi \u30b7\u30ea\u30fc\u30ba\u306e\u6210\u529f\u306b\u3088\u308a\u3001\u696d\u754c\u3067\u306f\u300c\u5408\u6210\u30c7\u30fc\u30bf\u300d\u306b\u95a2\u3059\u308b\u6fc0\u3057\u3044\u8b70\u8ad6\u304c\u5dfb\u304d\u8d77\u3053\u308a\u307e\u3057\u305f\u3002\u614e\u91cd\u306b\u8a2d\u8a08\u3055\u308c\u305f\u5408\u6210\u30c7\u30fc\u30bf\u304c\u3053\u308c\u307b\u3069\u512a\u308c\u305f\u7d50\u679c\u3092\u751f\u307f\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3042\u308c\u3070\u3001\u5f93\u6765\u306e\u300c\u30af\u30ed\u30fc\u30eb - \u30af\u30ea\u30fc\u30f3 \u30c8\u30ec\u30a4\u30f3\u300d\u30d1\u30e9\u30c0\u30a4\u30e0\u3092\u8986\u3059\u5fc5\u8981\u304c\u3042\u308b\u3067\u3057\u3087\u3046\u304b?\u7b2c 7 \u7ae0\u3067\u306f\u3001\u5408\u6210\u30c7\u30fc\u30bf\u306e\u65b9\u6cd5\u8ad6\u3068\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#114","title":"1.1.4 \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u4e2d\u6838\u3068\u306a\u308b\u4f7f\u547d","text":"<p>\u4e0a\u8a18\u306e\u8abf\u67fb\u3092\u7dcf\u5408\u3059\u308b\u3068\u3001LLM \u6642\u4ee3\u306e\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u306e\u4e2d\u6838\u3068\u306a\u308b\u4f7f\u547d\u304c\u62bd\u51fa\u3067\u304d\u307e\u3059\u3002\u5f93\u6765\u306e\u901a\u5ff5\u3067\u306f\u3001\u300c\u30c7\u30fc\u30bf\u306f\u591a\u3044\u307b\u3069\u826f\u3044\u300d\u3068\u8003\u3048\u3089\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u65b0\u3057\u3044\u30d1\u30e9\u30c0\u30a4\u30e0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u54c1\u8cea\u304c\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u4e0a\u9650\u3092\u6c7a\u5b9a\u3057\u3001\u30ce\u30a4\u30ba\u306e\u591a\u3044\u30c7\u30fc\u30bf\u306f\u5f79\u306b\u7acb\u305f\u306a\u3044\u3060\u3051\u3067\u306a\u304f\u6709\u5bb3\u3067\u3042\u308b\u3053\u3068\u304c\u5f37\u8abf\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4ee5\u524d\u306f\u3001\u300c\u30e2\u30c7\u30eb \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u304c\u7af6\u4e89\u4e0a\u306e\u512a\u4f4d\u6027\u306e\u4e2d\u6838\u3067\u3042\u308b\u300d\u3068\u4fe1\u3058\u3089\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u73fe\u5728\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306f\u7d71\u5408\u3055\u308c\u3066\u304a\u308a\u3001\u30c7\u30fc\u30bf\u304c\u4e3b\u8981\u306a\u5dee\u5225\u5316\u8981\u56e0\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002 \u300c\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306f\u5c0f\u3055\u306a\u524d\u51e6\u7406\u30b9\u30c6\u30c3\u30d7\u3067\u3042\u308b\u300d\u3068\u3044\u3046\u53e4\u3044\u898b\u65b9\u306f\u6642\u4ee3\u9045\u308c\u3067\u3042\u308a\u3001\u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306f\u73fe\u5728\u3001\u6210\u529f\u3059\u308b\u30e2\u30c7\u30eb \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u57fa\u790e\u3068\u307f\u306a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u540c\u69d8\u306b\u3001\u300c\u4eba\u9593\u306b\u3088\u308b\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306f\u304b\u3051\u304c\u3048\u306e\u306a\u3044\u3082\u306e\u3067\u3042\u308b\u300d\u3068\u3044\u3046\u4f1d\u7d71\u7684\u306a\u4fe1\u5ff5\u306f\u5d29\u308c\u307e\u3057\u305f\u3002\u9ad8\u54c1\u8cea\u306e\u5408\u6210\u30c7\u30fc\u30bf\u306f\u3001\u7279\u5b9a\u306e\u30b7\u30ca\u30ea\u30aa\u3067\u306f\u5b9f\u969b\u306e\u30c7\u30fc\u30bf\u3092\u8d85\u3048\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u300c\u91cf\u3088\u308a\u8cea\u300d\u3092\u300c\u8cea\u306e\u307f\u3067\u91cf\u306f\u542b\u307e\u306a\u3044\u300d\u3068\u8aa4\u89e3\u3057\u3066\u306f\u306a\u3089\u306a\u3044\u3053\u3068\u3092\u5f37\u8abf\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306e\u6cd5\u5247\u306f\u4f9d\u7136\u3068\u3057\u3066\u6709\u52b9\u3067\u3042\u308a\u3001\u540c\u3058\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u4e88\u7b97\u306e\u4e0b\u3067\u306e\u512a\u5148\u4e8b\u9805\u306f\u30c7\u30fc\u30bf\u54c1\u8cea\u3078\u306e\u6295\u8cc7\u3067\u3042\u308b\u3079\u304d\u3067\u3059\u3002\u6975\u7aef\u306a\u4f8b: 100 \u500b\u306e\u5b8c\u5168\u306a\u30c7\u30fc\u30bf \u30dd\u30a4\u30f3\u30c8\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u306f\u30011T \u306e\u9ad8\u54c1\u8cea\u30c7\u30fc\u30bf \u30dd\u30a4\u30f3\u30c8\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u3092\u8d85\u3048\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u8cea\u3068\u91cf\u306f\u5bfe\u7acb\u3059\u308b\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u5b9f\u969b\u306e\u5236\u7d04\u306e\u4e0b\u3067\u6700\u9069\u306a\u30d0\u30e9\u30f3\u30b9\u3092\u898b\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#12-llm","title":"1.2 LLM \u30c7\u30fc\u30bf\u306e\u5168\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb","text":"<p>\u300c\u8a95\u751f\u300d\u304b\u3089\u300c\u5c55\u958b\u300d\u307e\u3067\u3001\u5927\u898f\u6a21\u306a\u8a00\u8a9e\u30e2\u30c7\u30eb\u306f\u8907\u6570\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6bb5\u968e\u3092\u7d4c\u307e\u3059\u304c\u3001\u305d\u308c\u305e\u308c\u306e\u6bb5\u968e\u3067\u660e\u78ba\u306b\u7570\u306a\u308b\u30c7\u30fc\u30bf\u8981\u4ef6\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u5168\u4f53\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u3001\u8cc7\u683c\u306e\u3042\u308b\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u306b\u306a\u308b\u305f\u3081\u306e\u7b2c\u4e00\u6b69\u3067\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#121-4-sft-rlhf-rag","title":"1.2.1 4 \u6bb5\u968e\u30d1\u30e9\u30c0\u30a4\u30e0: \u30d7\u30ec\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u2192 SFT \u2192 RLHF \u2192 RAG","text":"<p>\u56f3 1-2: LLM \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 \u2014 TB \u30ec\u30d9\u30eb\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u304b\u3089 KB \u30ec\u30d9\u30eb\u306e RAG \u307e\u3067\u3001\u30c7\u30fc\u30bf\u91cf\u306f\u6e1b\u5c11\u3057\u307e\u3059\u304c\u3001\u54c1\u8cea\u8981\u4ef6\u306f\u5897\u52a0\u3057\u307e\u3059</p> <p>\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306f\u3001\u5927\u578b\u30e2\u30c7\u30eb\u306e\u4eba\u751f\u306e\u958b\u59cb\u70b9\u3067\u3059\u3002\u3053\u306e\u6bb5\u968e\u3067\u3001\u30e2\u30c7\u30eb\u306f\u5927\u91cf\u306e\u30e9\u30d9\u30eb\u306e\u306a\u3044\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u3001\u6587\u6cd5\u69cb\u9020\u3001\u5e38\u8b58\u77e5\u8b58\u3001\u4e16\u754c\u306e\u4ed5\u7d44\u307f\u306a\u3069\u3001\u8a00\u8a9e\u306e\u672c\u8cea\u3092\u5b66\u7fd2\u3057\u307e\u3059\u3002\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u30b9\u30b1\u30fc\u30eb\u306f\u901a\u5e38\u3001TB \u30ec\u30d9\u30eb\u3067\u3042\u308a\u3001Web \u30da\u30fc\u30b8\u3001\u66f8\u7c4d\u3001\u30b3\u30fc\u30c9\u3001\u5b66\u8853\u8ad6\u6587\u3001\u305d\u306e\u4ed6\u306e\u30c6\u30ad\u30b9\u30c8 \u30bf\u30a4\u30d7\u304b\u3089\u306e\u30bd\u30fc\u30b9\u3092\u542b\u3080\u6570\u5146\u306e\u30c8\u30fc\u30af\u30f3\u304c\u542b\u307e\u308c\u307e\u3059\u3002\u3053\u306e\u6bb5\u968e\u306b\u304a\u3051\u308b\u4e3b\u306a\u8ab2\u984c\u306f\u3001\u91cd\u8907\u6392\u9664\u3001\u30ce\u30a4\u30ba\u9664\u53bb\u3001\u54c1\u8cea\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u304a\u3088\u3073\u591a\u69d8\u6027\u306e\u30d0\u30e9\u30f3\u30b9\u3067\u3059\u3002\u4e00\u822c\u7684\u306a\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u306f\u3001Common Crawl\u3001The Pile\u3001RefinedWeb \u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u6559\u5e2b\u3042\u308a\u5fae\u8abf\u6574 (SFT) \u306f\u3001\u30e2\u30c7\u30eb\u304c\u300c\u6307\u793a\u306b\u5f93\u3046\u300d\u3053\u3068\u3092\u5b66\u7fd2\u3059\u308b\u91cd\u8981\u306a\u671f\u9593\u3067\u3059\u3002\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u306f\u5f37\u529b\u306a\u8a00\u8a9e\u7406\u89e3\u80fd\u529b\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u304c\u3001\u4eba\u9593\u3068\u52b9\u679c\u7684\u306b\u5bfe\u8a71\u3059\u308b\u65b9\u6cd5\u3092\u77e5\u308a\u307e\u305b\u3093\u3002 SFT \u30b9\u30c6\u30fc\u30b8\u3067\u306f\u3001\u547d\u4ee4\u3068\u5fdc\u7b54\u306e\u30da\u30a2\u306e\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u3001\u30e6\u30fc\u30b6\u30fc\u306e\u610f\u56f3\u3092\u7406\u89e3\u3057\u3001\u5f79\u7acb\u3064\u5fdc\u7b54\u3092\u63d0\u4f9b\u3059\u308b\u3088\u3046\u306b\u30e2\u30c7\u30eb\u3092\u5b66\u7fd2\u3057\u307e\u3059\u3002\u3053\u306e\u6bb5\u968e\u3067\u306e\u30c7\u30fc\u30bf\u898f\u6a21\u306f GB \u30ec\u30d9\u30eb\u306b\u307e\u3067\u4f4e\u4e0b\u3057\u3001\u614e\u91cd\u306b\u4f5c\u6210\u3055\u308c\u305f\u6570\u5341\u4e07\u304b\u3089\u6570\u767e\u4e07\u306e\u5bfe\u8a71\u30b5\u30f3\u30d7\u30eb\u304c\u542b\u307e\u308c\u307e\u3059\u3002\u4e3b\u306a\u8ab2\u984c\u306b\u306f\u3001\u6307\u793a\u306e\u591a\u69d8\u6027\u3001\u5fdc\u7b54\u306e\u8cea\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u6a19\u6e96\u5316\u306e\u78ba\u4fdd\u306a\u3069\u304c\u542b\u307e\u308c\u307e\u3059\u3002 Alpaca\u3001ShareGPT\u3001\u304a\u3088\u3073 OpenAssistant \u306f\u3001\u3053\u306e\u6bb5\u968e\u3067\u4e00\u822c\u7684\u306b\u4f7f\u7528\u3055\u308c\u308b\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3067\u3059\u3002</p> <p>\u4eba\u9593\u306e\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u304b\u3089\u306e\u5f37\u5316\u5b66\u7fd2 (RLHF/DPO) \u306f\u3001\u30e2\u30c7\u30eb\u306e\u51fa\u529b\u3092\u4eba\u9593\u306e\u597d\u307f\u306b\u5408\u308f\u305b\u3066\u3088\u308a\u300c\u8abf\u6574\u300d\u3059\u308b\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u8abf\u6574\u3068\u306f\u3001\u30e2\u30c7\u30eb\u3092\u3088\u308a\u5b89\u5168\u306b\u3059\u308b (\u6709\u5bb3\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u751f\u6210\u3057\u306a\u3044)\u3001\u3088\u308a\u5f79\u7acb\u3064 (\u5b9f\u969b\u306b\u30e6\u30fc\u30b6\u30fc\u306e\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b)\u3001\u3088\u308a\u6b63\u76f4\u306b\u3059\u308b (\u4e8b\u5b9f\u3092\u634f\u9020\u3057\u306a\u3044) \u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3053\u306e\u6bb5\u968e\u3067\u306f\u3001\u30d2\u30e5\u30fc\u30de\u30f3\u30fb\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u304c 2 \u3064\u306e\u5fdc\u7b54\u5019\u88dc\u306e\u3046\u3061\u3088\u308a\u826f\u3044\u3082\u306e\u3092\u9078\u629e\u3059\u308b\u55dc\u597d\u6bd4\u8f03\u30c7\u30fc\u30bf\u304c\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\u30c7\u30fc\u30bf\u306e\u898f\u6a21\u306f\u3055\u3089\u306b\u6570\u4e07\u304b\u3089\u6570\u5341\u4e07\u30b5\u30f3\u30d7\u30eb\u306b\u7e2e\u5c0f\u3057\u307e\u3059\u304c\u3001\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u54c1\u8cea\u8981\u4ef6\u306f\u975e\u5e38\u306b\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u9593\u306e\u5408\u610f\u3001\u597d\u307f\u30b7\u30b0\u30ca\u30eb\u306e\u7cbe\u5ea6\u3001\u30b5\u30f3\u30d7\u30eb\u5206\u5e03\u306e\u7bc4\u56f2\u306f\u3059\u3079\u3066\u3001\u614e\u91cd\u306b\u5236\u5fa1\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u8981\u7d20\u3067\u3059\u3002</p> <p>RAG (RAG) \u306f\u3001\u30e2\u30c7\u30eb\u306e\u77e5\u8b58\u306e\u66f4\u65b0\u3068\u5e7b\u899a\u306b\u5bfe\u51e6\u3057\u307e\u3059\u3002\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u304c\u3069\u308c\u307b\u3069\u5fb9\u5e95\u3055\u308c\u3066\u3044\u3066\u3082\u3001\u30e2\u30c7\u30eb\u306e\u77e5\u8b58\u306b\u306f\u671f\u9650\u304c\u3042\u308a\u3001\u300c\u30ca\u30f3\u30bb\u30f3\u30b9\u3092\u8a71\u3057\u306a\u304c\u3089\u3082\u6a29\u5a01\u304c\u3042\u308b\u3088\u3046\u306b\u805e\u3053\u3048\u308b\u300d\u3053\u3068\u3092\u5b8c\u5168\u306b\u907f\u3051\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002 RAG \u306f\u3001\u30e2\u30c7\u30eb\u306b\u300c\u5916\u90e8\u30bd\u30fc\u30b9\u3092\u53c2\u7167\u300d\u3055\u305b\u308b\u3053\u3068\u306b\u3088\u308a\u3001\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba \u30ca\u30ec\u30c3\u30b8 \u30d9\u30fc\u30b9\u3084\u6700\u65b0\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306a\u3069\u306e\u5916\u90e8\u60c5\u5831\u3092\u751f\u6210\u30d7\u30ed\u30bb\u30b9\u306b\u633f\u5165\u3057\u307e\u3059\u3002\u3053\u306e\u6bb5\u968e\u306e\u30c7\u30fc\u30bf \u30bd\u30fc\u30b9\u306f\u901a\u5e38\u3001PDF \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3001\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9 \u30ec\u30b3\u30fc\u30c9\u3001Web \u30b3\u30f3\u30c6\u30f3\u30c4\u3001\u305d\u306e\u4ed6\u306e\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u307e\u305f\u306f\u534a\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u3092\u542b\u3080\u4f01\u696d\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u3067\u3059\u3002\u4e3b\u306a\u8ab2\u984c\u306b\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u89e3\u6790\u3001\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af Chunking\u3001\u30d9\u30af\u30c8\u30eb\u5316\u3001\u691c\u7d22\u7cbe\u5ea6\u306e\u6700\u9069\u5316\u306a\u3069\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#122","title":"1.2.2 \u30c7\u30fc\u30bf\u30d5\u30ed\u30fc\u306e\u300c\u30d5\u30a1\u30cd\u30eb\u30e2\u30c7\u30eb\u300d","text":"<p>\u30c7\u30fc\u30bf\u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u3092\u7406\u89e3\u3059\u308b\u305f\u3081\u306e\u3082\u3046 1 \u3064\u306e\u8996\u70b9\u306f\u3001\u300c\u30d5\u30a1\u30cd\u30eb \u30e2\u30c7\u30eb\u300d\u3067\u3059\u3002\u751f\u306e Web \u30c7\u30fc\u30bf\u304b\u3089\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u4f7f\u7528\u3067\u304d\u308b\u6700\u7d42\u7684\u306a\u9ad8\u54c1\u8cea\u30b3\u30fc\u30d1\u30b9\u306b\u81f3\u308b\u307e\u3067\u3001\u30c7\u30fc\u30bf\u91cf\u304c\u5927\u5e45\u306b\u524a\u6e1b\u3055\u308c\u307e\u3059\u3002</p> <p></p> <p>\u56f3 1-3: \u30c7\u30fc\u30bf\u6ffe\u904e\u30d5\u30a1\u30cd\u30eb \u2014 100PB \u306e\u751f\u30c7\u30fc\u30bf\u304b\u3089 10GB SFT \u30c7\u30fc\u30bf\u307e\u3067\u3001\u4fdd\u6301\u7387\u306f\u308f\u305a\u304b 0.00001%</p> <p>\u4e00\u822c\u7684\u306a\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u306e\u30c7\u30fc\u30bf\u51e6\u7406\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u306e\u5834\u5408: Common Crawl \u304b\u3089 100PB \u306e\u751f\u306e Web \u30c7\u30fc\u30bf\u3092\u53d6\u5f97\u3059\u308b\u3068\u4eee\u5b9a\u3057\u307e\u3059\u3002 URL \u91cd\u8907\u6392\u9664\u3068\u6b63\u78ba\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u91cd\u8907\u6392\u9664\u306e\u5f8c\u3001\u30c7\u30fc\u30bf\u91cf\u306f 30PB (\u4fdd\u6301\u7387 30%) \u306b\u4f4e\u4e0b\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u6b21\u306b\u3001\u8a00\u8a9e\u8b58\u5225\u3068\u54c1\u8cea\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 (\u5bfe\u8c61\u5916\u306e\u8a00\u8a9e\u3001\u30dd\u30eb\u30ce/\u66b4\u529b\u30b3\u30f3\u30c6\u30f3\u30c4\u3001\u6975\u7aef\u306b\u77ed\u3044\u30c6\u30ad\u30b9\u30c8\u3001\u6587\u5b57\u5316\u3051\u30c6\u30ad\u30b9\u30c8\u3092\u524a\u9664) \u306b\u3088\u308a\u3001\u30c7\u30fc\u30bf\u304c\u3055\u3089\u306b 5PB (\u4fdd\u6301\u7387 5%) \u306b\u524a\u6e1b\u3055\u308c\u307e\u3059\u3002\u6b21\u306b\u3001\u8907\u96d1\u3055\u3001\u7e70\u308a\u8fd4\u3057\u7387\u3001\u60c5\u5831\u5bc6\u5ea6\u3001\u305d\u306e\u4ed6\u306e\u6307\u6a19\u3092\u4f7f\u7528\u3057\u305f\u3088\u308a\u8a73\u7d30\u306a\u54c1\u8cea\u8a55\u4fa1\u306b\u3088\u308a\u3001\u304a\u305d\u3089\u304f\u308f\u305a\u304b 1PB (\u4fdd\u6301\u7387 1%) \u306e\u6700\u7d42\u7684\u306a\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b3\u30fc\u30d1\u30b9\u304c\u5f97\u3089\u308c\u307e\u3059\u3002\u305d\u3057\u3066\u3001\u305d\u3053\u304b\u3089 SFT \u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u307e\u305f\u306f\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u3001\u6700\u7d42\u7684\u306a\u51fa\u529b\u306f\u308f\u305a\u304b 10GB \u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u751f\u30c7\u30fc\u30bf\u3068\u6bd4\u8f03\u3057\u3066\u3001\u4fdd\u6301\u7387\u306f 10 \u4e07\u5206\u306e 1 \u306b\u307e\u3067\u4f4e\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>\u5b9f\u969b\u306e\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3067\u306f\u3001\u3053\u306e\u6bd4\u7387\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002\u3053\u308c\u306f\u3001\u30af\u30ed\u30fc\u30eb \u30b9\u30b1\u30fc\u30eb\u306e\u8a08\u753b\u3001\u30b9\u30c8\u30ec\u30fc\u30b8 \u30b3\u30b9\u30c8\u306e\u4e88\u7b97\u7de8\u6210\u3001\u304a\u3088\u3073\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u8a2d\u8a08\u306b\u76f4\u63a5\u5f71\u97ff\u3057\u307e\u3059\u3002\u591a\u304f\u306e\u30c1\u30fc\u30e0\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u958b\u59cb\u6642\u306b\u3053\u306e\u300c\u6d88\u8017\u7387\u300d\u3092\u904e\u5c0f\u8a55\u4fa1\u3057\u3066\u304a\u308a\u3001\u30c7\u30fc\u30bf\u306e\u78ba\u4fdd\u304c\u4e0d\u5341\u5206\u306b\u306a\u308a\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u9014\u4e2d\u3067\u3084\u308a\u76f4\u3057\u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002</p>"},{"location":"ja/part1/1_1_data_change/#13","title":"1.3 \u8ab2\u984c\u3068\u6a5f\u4f1a: \u7570\u7a2e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u306e\u30b2\u30fc\u30e0\u3001\u8457\u4f5c\u6a29\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u3001\u304a\u3088\u3073\u8a08\u7b97\u30b3\u30b9\u30c8","text":""},{"location":"ja/part1/1_1_data_change/#131-1","title":"1.3.1 \u8ab2\u984c 1: \u7570\u7a2e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u306e\u51e6\u7406\u306e\u8907\u96d1\u3055","text":"<p>GPT-4V\u3001Gemini\u3001Sora \u306a\u3069\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30e2\u30c7\u30eb\u306e\u51fa\u73fe\u306b\u3088\u308a\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u8907\u96d1\u3055\u306f\u98db\u8e8d\u7684\u306b\u5897\u5927\u3057\u307e\u3057\u305f\u3002\u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8\u306e\u6642\u4ee3\u3067\u306f\u3001\u3059\u3079\u3066\u306e\u30c7\u30fc\u30bf\u306f UTF-8 \u3067\u30a8\u30f3\u30b3\u30fc\u30c9\u3055\u308c\u305f\u6587\u5b57\u5217\u3067\u3057\u305f\u3002\u51e6\u7406\u30c4\u30fc\u30eb\u30c1\u30a7\u30fc\u30f3\u306f\u6210\u719f\u3057\u3001\u6a19\u6e96\u5316\u3055\u308c\u307e\u3057\u305f\u3002\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u6642\u4ee3\u3067\u306f\u3001\u30c7\u30fc\u30bf\u5f62\u5f0f\u304c\u7206\u767a\u7684\u306b\u5897\u52a0\u3057\u307e\u3057\u305f\u3002\u753b\u50cf\u306b\u306f JPEG\u3001PNG\u3001WebP \u304c\u3042\u308a\u307e\u3059\u3002\u30d3\u30c7\u30aa\u306b\u306f MP4\u3001AVI\u3001MKV \u304c\u3042\u308a\u307e\u3059\u3002\u30aa\u30fc\u30c7\u30a3\u30aa\u306b\u306f WAV\u3001MP3\u3001FLAC \u304c\u3042\u308a\u307e\u3059\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f PDF\u3001Word\u3001HTML \u304c\u3042\u308a\u307e\u3059\u3002\u5404\u5f62\u5f0f\u306b\u306f\u72ec\u81ea\u306e\u89e3\u6790\u65b9\u6cd5\u3068\u54c1\u8cea\u8a55\u4fa1\u57fa\u6e96\u304c\u3042\u308a\u307e\u3059\u3002</p> \u5bf8\u6cd5 \u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8\u306e\u6642\u4ee3 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u6642\u4ee3 \u30c7\u30fc\u30bf\u5f62\u5f0f \u7d71\u4e00\u3055\u308c\u305f UTF-8 \u30c6\u30ad\u30b9\u30c8 \u8907\u6570\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8: \u753b\u50cf\u3001\u30d3\u30c7\u30aa\u3001\u30aa\u30fc\u30c7\u30a3\u30aa\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3001Web \u30da\u30fc\u30b8 \u30b9\u30c8\u30ec\u30fc\u30b8\u8981\u4ef6 \u7d50\u6838\u30ec\u30d9\u30eb PB \u30ec\u30d9\u30eb (\u753b\u50cf/\u30d3\u30c7\u30aa\u304c\u512a\u52e2) \u4f4d\u7f6e\u5408\u308f\u305b\u306e\u96e3\u3057\u3055 \u306a\u3057 (\u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8\u306f\u4f4d\u7f6e\u5408\u308f\u305b\u3092\u5fc5\u8981\u3068\u3057\u307e\u305b\u3093) \u975e\u5e38\u306b\u9ad8\u3044 (\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u914d\u7f6e\u3001\u30aa\u30fc\u30c7\u30a3\u30aa\u3068\u30d3\u30c7\u30aa\u306e\u540c\u671f\u3001\u30af\u30ed\u30b9\u30e2\u30fc\u30c0\u30eb\u306e\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u4e00\u8cab\u6027) \u30c4\u30fc\u30eb\u30c1\u30a7\u30fc\u30f3\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u6210\u719f\u3057\u305f (FastText\u3001KenLM) \u65ad\u7247\u5316 (\u5404\u30e2\u30c0\u30ea\u30c6\u30a3\u306b\u306f\u72ec\u7acb\u3057\u305f\u30c4\u30fc\u30eb\u30c1\u30a7\u30fc\u30f3\u304c\u3042\u308a\u307e\u3059) \u54c1\u8cea\u8a55\u4fa1 \u8907\u96d1\u3055\u3001\u91cd\u8907\u6392\u9664\u7387 \u7f8e\u7684\u30b9\u30b3\u30a2\u3001CLIP-Score\u3001OCR\u7cbe\u5ea6\u3001ASR\u30a8\u30e9\u30fc\u7387\u306a\u3069 <p>\u3055\u3089\u306b\u56f0\u96e3\u306a\u306e\u306f\u3001\u30af\u30ed\u30b9\u30e2\u30fc\u30c0\u30eb\u8abf\u6574\u306e\u554f\u984c\u3067\u3059\u3002\u753b\u50cf\u3068\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3092\u7d44\u307f\u5408\u308f\u305b\u308b - \u30c6\u30ad\u30b9\u30c8\u304c\u753b\u50cf\u306e\u5185\u5bb9\u3092\u6b63\u78ba\u306b\u8aac\u660e\u3057\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u304b?\u30d3\u30c7\u30aa\u5185\u306e\u97f3\u58f0\u3068\u30d3\u30b8\u30e5\u30a2\u30eb\u306f\u3069\u306e\u3088\u3046\u306b\u3057\u3066\u6b63\u78ba\u306b\u540c\u671f\u3055\u308c\u3066\u3044\u308b\u306e\u3067\u3057\u3087\u3046\u304b?\u3053\u308c\u3089\u306e\u4f4d\u7f6e\u5408\u308f\u305b\u306e\u554f\u984c\u306f\u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8\u306e\u6642\u4ee3\u306b\u306f\u5b58\u5728\u3057\u307e\u305b\u3093\u3067\u3057\u305f\u304c\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306b\u304a\u3051\u308b\u4e2d\u5fc3\u7684\u306a\u8ab2\u984c\u3067\u3059\u3002</p> <p></p> <p>\u56f3 1-4: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u51e6\u7406\u306e\u8907\u96d1\u3055 \u2014 \u7dda\u306e\u592a\u3055\u306f\u51e6\u7406\u306e\u96e3\u3057\u3055\u3092\u793a\u3057\u3001\u30d3\u30c7\u30aa (5/5) \u3068 PDF (4/5) \u304c\u6700\u3082\u8907\u96d1\u3067\u3059</p> <p>\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u8df5\u306e\u89b3\u70b9\u304b\u3089\u898b\u308b\u3068\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u51e6\u7406\u306b\u306f\u30e2\u30b8\u30e5\u30e9\u30fc\u8a2d\u8a08\u304c\u5fc5\u8981\u3067\u3059\u3002\u5404\u30e2\u30c0\u30ea\u30c6\u30a3\u306f\u3001\u30af\u30ed\u30b9\u30e2\u30fc\u30c0\u30eb\u8abf\u6574\u306e\u524d\u306b\u500b\u5225\u306b\u51e6\u7406\u3055\u308c\u307e\u3059\u3002\u540c\u6642\u306b\u3001\u4e0b\u6d41\u306e\u51e6\u7406\u306e\u8907\u96d1\u3055\u3092\u8efd\u6e1b\u3059\u308b\u305f\u3081\u306b\u3001WebDataset\u3001TFDS \u306a\u3069\u306e\u7d71\u4e00\u30c7\u30fc\u30bf\u5f62\u5f0f\u6a19\u6e96\u3092\u512a\u5148\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30e2\u30c0\u30ea\u30c6\u30a3\u3092\u610f\u8b58\u3057\u305f\u54c1\u8cea\u8a55\u4fa1\u30b7\u30b9\u30c6\u30e0\u3092\u78ba\u7acb\u3059\u308b\u3053\u3068\u3082\u91cd\u8981\u3067\u3059\u3002\u753b\u50cf\u306b\u306f\u7f8e\u7684\u30b9\u30b3\u30a2\u3068 CLIP \u306e\u985e\u4f3c\u6027\u304c\u5fc5\u8981\u3067\u3001\u97f3\u58f0\u306b\u306f ASR \u306e\u7cbe\u5ea6\u3068\u8a71\u8005\u5206\u96e2\u54c1\u8cea\u304c\u5fc5\u8981\u3067\u3001PDF \u306b\u306f OCR \u306e\u7cbe\u5ea6\u3068\u30ec\u30a4\u30a2\u30a6\u30c8\u5206\u6790\u306e\u7cbe\u5ea6\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#132-2","title":"1.3.2 \u8ab2\u984c 2: \u8457\u4f5c\u6a29\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u306e\u30b0\u30ec\u30fc\u30be\u30fc\u30f3","text":"<p>\u5927\u898f\u6a21\u306a\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306b\u95a2\u3059\u308b\u8457\u4f5c\u6a29\u306e\u554f\u984c\u306f\u3001\u6280\u8853\u7684\u306a\u8b70\u8ad6\u304b\u3089\u6cd5\u7684\u306a\u6226\u5834\u3078\u3068\u767a\u5c55\u3057\u307e\u3057\u305f\u3002 2023\u5e74\u3001\u30b2\u30c3\u30c6\u30a3\u30a4\u30e1\u30fc\u30b8\u30ba\u306f\u3001Stable Diffusion\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u6570\u767e\u4e07\u679a\u306e\u8457\u4f5c\u6a29\u3067\u4fdd\u8b77\u3055\u308c\u305f\u753b\u50cf\u3092\u4e0d\u6b63\u4f7f\u7528\u3057\u305f\u3068\u3057\u3066\u3001Stability AI\u3092\u8a34\u3048\u305f\u3002 2024 \u5e74\u3001\u30cb\u30e5\u30fc\u30e8\u30fc\u30af \u30bf\u30a4\u30e0\u30ba \u306f\u3001GPT \u30e2\u30c7\u30eb\u304c\u8457\u4f5c\u6a29\u3092\u4fb5\u5bb3\u3057\u3066\u3044\u308b\u3068\u3057\u3066 OpenAI \u3068 Microsoft \u3092\u8a34\u3048\u307e\u3057\u305f\u3002\u8907\u6570\u306e\u56fd\u306e\u898f\u5236\u5f53\u5c40\u306f\u3001AI \u4f01\u696d\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf \u30bd\u30fc\u30b9\u306e\u958b\u793a\u3092\u8981\u6c42\u3057\u59cb\u3081\u3066\u3044\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u306e\u8a34\u8a1f\u306e\u7d50\u679c\u306f\u3001AI \u696d\u754c\u306e\u767a\u5c55\u306e\u65b9\u5411\u6027\u306b\u91cd\u5927\u306a\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u306b\u3068\u3063\u3066\u3001\u554f\u984c\u306e\u89e3\u6c7a\u3092\u5f85\u3064\u306e\u306f\u660e\u3089\u304b\u306b\u8ce2\u660e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u73fe\u5728\u306e\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u6226\u7565\u306f\u3001\u3044\u304f\u3064\u304b\u306e\u5074\u9762\u304b\u3089\u9032\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u307e\u305a\u3001\u30bd\u30fc\u30b9\u306e\u30c8\u30ec\u30fc\u30b5\u30d3\u30ea\u30c6\u30a3 - URL\u3001\u30af\u30ed\u30fc\u30eb\u6642\u9593\u3001\u5143\u306e\u8457\u4f5c\u6a29\u5ba3\u8a00\u306a\u3069\u3092\u542b\u3080\u3001\u5404\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf \u30dd\u30a4\u30f3\u30c8\u306e\u5b8c\u5168\u306a\u30bd\u30fc\u30b9 \u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u8a18\u9332\u3057\u307e\u3059\u3002 2 \u756a\u76ee\u306b\u3001\u30e9\u30a4\u30bb\u30f3\u30b9 \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 - CC0\u3001CC-BY\u3001\u305d\u306e\u4ed6\u306e\u30aa\u30fc\u30d7\u30f3 \u30e9\u30a4\u30bb\u30f3\u30b9 \u30b3\u30f3\u30c6\u30f3\u30c4\u306a\u3069\u3001AI \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u4f7f\u7528\u306b\u5bfe\u3059\u308b\u660e\u793a\u7684\u306a\u8a31\u53ef\u3092\u6301\u3064\u30c7\u30fc\u30bf\u3092\u512a\u5148\u3057\u307e\u3059\u3002\u7b2c\u4e09\u306b\u3001robots.txt \u30d7\u30ed\u30c8\u30b3\u30eb\u3092\u5c0a\u91cd\u3057\u3001Web \u30b5\u30a4\u30c8\u6240\u6709\u8005\u306e\u30af\u30ed\u30fc\u30e9\u30fc\u5236\u9650\u5ba3\u8a00\u3092\u5c0a\u91cd\u3057\u307e\u3059\u3002 4 \u756a\u76ee\u306b\u3001\u30c7\u30fc\u30bf\u306e\u6a5f\u5bc6\u4fdd\u8b77\u3092\u89e3\u9664\u3057\u307e\u3059\u3002\u500b\u4eba\u306e\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u306b\u95a2\u308f\u308b\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u533f\u540d\u5316\u307e\u305f\u306f\u524a\u9664\u3057\u307e\u3059\u3002</p> <p>AI \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b7\u30ca\u30ea\u30aa\u306b\u304a\u3051\u308b\u300c\u30d5\u30a7\u30a2\u30e6\u30fc\u30b9\u300d\u306e\u5883\u754c\u306f\u4f9d\u7136\u3068\u3057\u3066\u660e\u78ba\u3067\u306f\u306a\u304f\u3001\u9069\u7528\u3055\u308c\u308b\u6cd5\u7684\u57fa\u6e96\u306f\u56fd\u306b\u3088\u3063\u3066\u7570\u306a\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u6cd5\u7684\u74b0\u5883\u304c\u660e\u78ba\u306b\u306a\u3063\u305f\u3089\u30c7\u30fc\u30bf\u51e6\u7406\u6226\u7565\u3092\u8fc5\u901f\u306b\u8abf\u6574\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306b\u8457\u4f5c\u6a29\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u3092\u4e88\u7d04\u3057\u3066\u304a\u304f\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#133-3","title":"1.3.3 \u8ab2\u984c 3: \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30b3\u30b9\u30c8\u306e\u300c\u96a0\u308c\u305f\u30ad\u30e9\u30fc\u300d","text":"<p>\u30c7\u30fc\u30bf\u51e6\u7406\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30b3\u30b9\u30c8\u306f\u3001\u591a\u304f\u306e\u5834\u5408\u5927\u5e45\u306b\u904e\u5c0f\u8a55\u4fa1\u3055\u308c\u307e\u3059\u3002\u591a\u304f\u306e\u30c1\u30fc\u30e0\u306f\u3001\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b3\u30b9\u30c8\u306e\u4e88\u7b97\u3092\u7acb\u3066\u308b\u3068\u304d\u306b GPU \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6642\u9593\u3092\u8a08\u7b97\u3059\u308b\u3060\u3051\u3067\u3059\u304c\u3001\u30c7\u30fc\u30bf\u306e\u524d\u51e6\u7406\u3067\u540c\u7b49\u4ee5\u4e0a\u306e\u30ea\u30bd\u30fc\u30b9\u304c\u6d88\u8cbb\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3053\u3068\u3092\u7121\u8996\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>10TB \u306e\u751f\u306e Web \u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u3068\u3044\u3046\u5b9f\u969b\u7684\u306a\u30b7\u30ca\u30ea\u30aa\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u5404\u30c7\u30fc\u30bf \u30dd\u30a4\u30f3\u30c8\u306b\u306f\u3001HTML \u89e3\u6790\u3001\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u3001\u8a00\u8a9e\u8b58\u5225\u3001\u54c1\u8cea\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u3001\u91cd\u8907\u6392\u9664\u30c1\u30a7\u30c3\u30af\u3068\u3044\u3046\u5e73\u5747 5 \u3064\u306e\u30b9\u30c6\u30c3\u30d7\u304c\u5fc5\u8981\u3067\u3042\u308b\u3068\u4eee\u5b9a\u3057\u307e\u3059\u3002\u5404\u30b9\u30c6\u30c3\u30d7\u306b\u306f\u9805\u76ee\u3054\u3068\u306b 100 \u30df\u30ea\u79d2\u304b\u304b\u308a\u307e\u3059 (\u3059\u3067\u306b\u304b\u306a\u308a\u9ad8\u901f\u3067\u3059)\u3002\u5408\u8a08\u51e6\u7406\u6642\u9593\u306f\u304a\u3088\u305d\u6b21\u306e\u3088\u3046\u306b\u306a\u308a\u307e\u3059: 10TB \u00f7 10KB/\u30a2\u30a4\u30c6\u30e0 \u00d7 0.5 \u79d2/\u30a2\u30a4\u30c6\u30e0 \u2248 150 \u4e07 GPU \u6642\u9593\u3002\u30af\u30e9\u30a6\u30c9 \u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u306e\u4fa1\u683c\u3067\u306f\u3001\u3053\u308c\u306f\u6570\u5341\u4e07\u30c9\u30eb\u3092\u610f\u5473\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u8cbb\u7528\u81ea\u4f53\u306b\u5339\u6575\u3057\u307e\u3059\u3002</p> \u30b7\u30ca\u30ea\u30aa \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u91cf \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u8cbb\u7528 (A100 \u6642\u9593) \u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u91cd\u8907\u6392\u9664\u306a\u3057\u3001\u76f4\u63a5\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 10T\u30c8\u30fc\u30af\u30f3 10,000\u6642\u9593 \u30d9\u30fc\u30b9\u30e9\u30a4\u30f3 (\u7e70\u308a\u8fd4\u3057\u306b\u3088\u308b\u300c\u30ea\u30d4\u30fc\u30bf\u30fc\u300d\u306e\u554f\u984c\u3092\u542b\u3080) \u91cd\u8907\u6392\u9664\u5f8c\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 7T\u30c8\u30fc\u30af\u30f3 7,000\u6642\u9593 \u30d9\u30fc\u30b9\u30e9\u30a4\u30f3\u3088\u308a\u3082\u512a\u308c\u3066\u3044\u307e\u3059 (\u30c7\u30fc\u30bf\u304c\u7e70\u308a\u8fd4\u3055\u308c\u308b\u3068\u5b66\u7fd2\u52b9\u7387\u304c\u4f4e\u4e0b\u3057\u307e\u3059) \u7d14\u5229\u76ca - 3,000 \u6642\u9593\u306e\u7bc0\u7d04 + \u3088\u308a\u512a\u308c\u305f\u30e2\u30c7\u30eb - <p>\u305f\u3060\u3057\u3001\u5225\u306e\u89b3\u70b9\u304b\u3089\u898b\u308b\u3068\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u6295\u8cc7\u53ce\u76ca\u7387\u306f\u975e\u5e38\u306b\u9ad8\u304f\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u4e0a\u306e\u8868\u306f\u5358\u7d14\u5316\u3057\u305f\u30b1\u30fc\u30b9\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u30c7\u30fc\u30bf\u91cd\u8907\u6392\u9664\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u6295\u8cc7\u3059\u308b\u3053\u3068\u3067\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b3\u30b9\u30c8\u306e 30% \u304c\u7bc0\u7d04\u3055\u308c\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3082\u5411\u4e0a\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u300c\u30ec\u30d0\u30ec\u30c3\u30b8\u52b9\u679c\u300d\u3067\u3059\u3002\u73fe\u5728\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u4fa1\u683c (A100 \uff5e 2 \u30c9\u30eb/\u6642\u9593) \u3067\u306f\u30011 \u6642\u9593\u306e\u30c7\u30fc\u30bf\u51e6\u7406\u4f5c\u696d\u3067 10 \u6642\u9593\u306e\u975e\u52b9\u7387\u306a\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3092\u524a\u6e1b\u3067\u304d\u300120 \u500d\u306e ROI \u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p> <p></p> <p>\u56f3 1-5: \u30c7\u30fc\u30bf\u54c1\u8cea\u3068\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u52b9\u7387\u306e\u95a2\u4fc2 \u2014 \u7dd1\u8272\u306e\u66f2\u7dda (\u53b3\u9078\u3055\u308c\u305f\u30c7\u30fc\u30bf) \u304c\u6700\u3082\u52b9\u7387\u7684\u3067\u300130 \uff5e 70% \u306e\u54c1\u8cea\u7bc4\u56f2\u3067\u6700\u5927\u306e ROI \u304c\u5f97\u3089\u308c\u307e\u3059</p>"},{"location":"ja/part1/1_1_data_change/#134-3","title":"1.3.4 \u6a5f\u4f1a: \u969c\u58c1\u3092\u4e0b\u3052\u308b 3 \u3064\u306e\u30c8\u30ec\u30f3\u30c9","text":"<p>\u8ab2\u984c\u306f\u3042\u308b\u3082\u306e\u306e\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u306b\u3068\u3063\u3066\u306f\u4eca\u304c\u7d76\u597d\u306e\u53c2\u5165\u6642\u671f\u3067\u3059\u3002 3 \u3064\u306e\u4e3b\u8981\u306a\u30c8\u30ec\u30f3\u30c9\u306b\u3088\u308a\u3001\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3078\u306e\u969c\u58c1\u304c\u5927\u5e45\u306b\u4e0b\u304c\u308a\u307e\u3059\u3002</p> <p>1 \u3064\u76ee\u306e\u30c8\u30ec\u30f3\u30c9\u306f\u3001\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u9ad8\u54c1\u8cea\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u51fa\u73fe\u3067\u3059\u3002\u521d\u671f\u306e\u975e\u516c\u958b\u306e\u5546\u7528\u30c7\u30fc\u30bf\u3068\u306f\u7570\u306a\u308a\u3001\u8fd1\u5e74\u3067\u306f\u9ad8\u54c1\u8cea\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u304c\u6570\u591a\u304f\u767b\u5834\u3057\u3066\u3044\u307e\u3059\u3002 HuggingFace \u306e FineWeb \u306f\u3001\u614e\u91cd\u306b\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f 15T \u30c8\u30fc\u30af\u30f3\u306e\u82f1\u8a9e Web \u30c7\u30fc\u30bf\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002 RedPajama \u306f\u3001LLaMA \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u5b8c\u5168\u306a\u8907\u88fd\u3092\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u5316\u3057\u307e\u3057\u305f\u3002 DCLM \u306f\u3001\u30c9\u30e1\u30a4\u30f3\u306b\u6700\u9069\u5316\u3055\u308c\u305f\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u3088\u308a\u3001\u4e2d\u5c0f\u898f\u6a21\u306e\u30c1\u30fc\u30e0\u304c\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b3\u30fc\u30d1\u30b9\u3092\u69cb\u7bc9\u3059\u308b\u30b3\u30b9\u30c8\u304c\u5927\u5e45\u306b\u524a\u6e1b\u3055\u308c\u3001\u4ee5\u524d\u306f\u5927\u4f01\u696d\u306e\u307f\u304c\u30a2\u30af\u30bb\u30b9\u3067\u304d\u305f\u30ea\u30bd\u30fc\u30b9\u304c\u624b\u306e\u5c4a\u304f\u3068\u3053\u308d\u306b\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>2 \u756a\u76ee\u306e\u30c8\u30ec\u30f3\u30c9\u306f\u3001AI \u30cd\u30a4\u30c6\u30a3\u30d6\u306e\u30c7\u30fc\u30bf \u30c4\u30fc\u30eb\u306e\u6210\u719f\u3067\u3059\u3002\u5f93\u6765\u306e\u30d3\u30c3\u30b0 \u30c7\u30fc\u30bf \u30c4\u30fc\u30eb (Hadoop\u3001Spark \u306a\u3069) \u306f\u6210\u719f\u3057\u3066\u3044\u307e\u3059\u304c\u3001AI \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b7\u30ca\u30ea\u30aa\u5411\u3051\u306b\u8a2d\u8a08\u3055\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u8fd1\u5e74\u3001LLM \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u7528\u306b\u8a2d\u8a08\u3055\u308c\u305f\u4e00\u9023\u306e\u30c4\u30fc\u30eb\u304c\u6210\u719f\u3057\u3066\u304d\u307e\u3057\u305f\u3002 Alibaba \u306e Data-Juicer \u306f\u3001\u3059\u3050\u306b\u4f7f\u3048\u308b\u6570\u5341\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30aa\u30da\u30ec\u30fc\u30bf\u30fc\u3092\u5099\u3048\u305f\u30e2\u30b8\u30e5\u30fc\u30eb\u5f0f\u306e\u30c7\u30fc\u30bf\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002 Dolma \u306f\u3001\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u6700\u9069\u5316\u306e\u305f\u3081\u306b Allen AI \u304c\u958b\u767a\u3057\u305f\u5927\u898f\u6a21\u306a\u30c6\u30ad\u30b9\u30c8\u51e6\u7406\u30c4\u30fc\u30eb\u30ad\u30c3\u30c8\u3067\u3059\u3002\u3053\u308c\u3089\u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u306f\u30bc\u30ed\u304b\u3089\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306a\u304f\u3001\u5de8\u4eba\u306e\u80a9\u306e\u4e0a\u306b\u7acb\u3064\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>3 \u756a\u76ee\u306e\u30c8\u30ec\u30f3\u30c9\u306f\u3001\u5408\u6210\u30c7\u30fc\u30bf\u306e\u4e3b\u6d41\u5316\u3067\u3059\u3002\u524d\u8ff0\u3057\u305f\u3088\u3046\u306b\u3001Microsoft Phi \u30b7\u30ea\u30fc\u30ba\u306e\u6210\u529f\u306f\u3001\u5408\u6210\u30c7\u30fc\u30bf\u306e\u5de8\u5927\u306a\u53ef\u80fd\u6027\u3092\u5b9f\u8a3c\u3057\u307e\u3057\u305f\u3002\u73fe\u5728\u3001GPT-4 \u306a\u3069\u306e\u5f37\u529b\u306a\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3001\u30af\u30ed\u30fc\u30c9\u304c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u304c\u696d\u754c\u6a19\u6e96\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u300c\u5f37-\u5148\u884c-\u5f31\u300d\u6226\u7565\u306b\u3088\u308a\u3001\u9ad8\u54c1\u8cea\u306e\u30c7\u30fc\u30bf\u53d6\u5f97\u304c\u4eba\u9593\u306e\u6ce8\u91c8\u306b\u5b8c\u5168\u306b\u4f9d\u5b58\u3059\u308b\u3053\u3068\u304c\u306a\u304f\u306a\u308a\u3001\u30c7\u30fc\u30bf\u6e96\u5099\u306e\u52b9\u7387\u304c\u5927\u5e45\u306b\u5411\u4e0a\u3057\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u5408\u6210\u30c7\u30fc\u30bf\u306f\u65b0\u305f\u306a\u8ab2\u984c\u3082\u3082\u305f\u3089\u3057\u307e\u3059\u3002\u305d\u308c\u306f\u3001\u30e2\u30c7\u30eb\u306e\u5d29\u58ca\u3092\u3069\u306e\u3088\u3046\u306b\u56de\u907f\u3059\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u30c7\u30fc\u30bf\u306e\u591a\u69d8\u6027\u3092\u78ba\u4fdd\u3059\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u304b?\u3053\u308c\u3089\u306e\u8cea\u554f\u306b\u3064\u3044\u3066\u306f\u3001\u5f8c\u7d9a\u306e\u7ae0\u3067\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#14","title":"1.4 \u3088\u304f\u3042\u308b\u8aa4\u89e3\u3068\u843d\u3068\u3057\u7a74\u30ac\u30a4\u30c9","text":"<p>\u7279\u5b9a\u306e\u6280\u8853\u7684\u306a\u5b9f\u8df5\u306b\u5165\u308b\u524d\u306b\u3001\u3044\u304f\u3064\u304b\u306e\u3088\u304f\u3042\u308b\u8aa4\u89e3\u3092\u660e\u78ba\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u3046\u3057\u305f\u8aa4\u89e3\u306f\u3001\u826f\u304f\u3066\u3082\u30ea\u30bd\u30fc\u30b9\u306e\u7121\u99c4\u306b\u3064\u306a\u304c\u308a\u3001\u6700\u60aa\u306e\u5834\u5408\u306f\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u5931\u6557\u306b\u3064\u306a\u304c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#1_1","title":"\u8aa4\u89e3 1: \u300c\u30c7\u30fc\u30bf\u306f\u591a\u3051\u308c\u3070\u591a\u3044\u307b\u3069\u826f\u3044\u300d","text":"<p>\u3053\u308c\u306f\u6700\u3082\u4e00\u822c\u7684\u3067\u6700\u3082\u6709\u5bb3\u306a\u8aa4\u89e3\u3067\u3059\u3002\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3092\u958b\u59cb\u3059\u308b\u3068\u304d\u306e\u591a\u304f\u306e\u30c1\u30fc\u30e0\u306e\u6700\u521d\u306e\u53cd\u5fdc\u306f\u3001\u300c\u3067\u304d\u308b\u3060\u3051\u591a\u304f\u306e\u30c7\u30fc\u30bf\u3092\u30af\u30ed\u30fc\u30eb\u3059\u308b\u300d\u3053\u3068\u3067\u3059\u3002\u305f\u3060\u3057\u3001\u524d\u8ff0\u3057\u305f\u3088\u3046\u306b\u3001\u751f\u30c7\u30fc\u30bf\u306e\u4fdd\u6301\u7387\u306f\u901a\u5e38\u3001\u308f\u305a\u304b 5 \uff5e 20% \u3067\u3059\u3002\u30c7\u30fc\u30bf\u91cf\u3092\u3084\u307f\u304f\u3082\u306b\u8ffd\u6c42\u3059\u308b\u3068\u3001\u30af\u30ed\u30fc\u30eb\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u521d\u671f\u51e6\u7406\u30b3\u30b9\u30c8\u306e 80% \u4ee5\u4e0a\u304c\u7121\u99c4\u306b\u306a\u308a\u307e\u3059\u3002\u3055\u3089\u306b\u60aa\u3044\u3053\u3068\u306b\u3001\u5f8c\u7d9a\u306e\u54c1\u8cea\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u304c\u5341\u5206\u306b\u53b3\u5bc6\u3067\u306a\u304f\u3001\u4f4e\u54c1\u8cea\u306e\u30c7\u30fc\u30bf\u304c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30bb\u30c3\u30c8\u306b\u6df7\u5165\u3057\u305f\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u60aa\u5f71\u97ff\u3092\u53ca\u307c\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u6b63\u3057\u3044\u30a2\u30d7\u30ed\u30fc\u30c1: \u6700\u521d\u306b\u5c0f\u898f\u6a21\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5168\u4f53\u306e\u6709\u52b9\u6027\u3092\u691c\u8a3c\u3057\u3001\u54c1\u8cea\u57fa\u6e96\u3068\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u6226\u7565\u3092\u78ba\u8a8d\u3057\u3066\u304b\u3089\u3001\u5927\u898f\u6a21\u306a\u30c7\u30fc\u30bf\u53ce\u96c6\u306b\u9032\u307f\u307e\u3059\u3002 \u300c\u54c1\u8cea\u304c\u7b2c\u4e00\u3001\u91cf\u304c\u4e8c\u756a\u76ee\u300d\u306f\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u57fa\u672c\u539f\u5247\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#2","title":"\u8aa4\u89e3 2: \u300c\u3059\u3079\u3066\u306e\u30c7\u30fc\u30bf\u3092\u4e00\u5ea6\u51e6\u7406\u3059\u308b\u300d","text":"<p>\u30c7\u30fc\u30bf\u51e6\u7406\u306f\u30011 \u56de\u9650\u308a\u306e\u30bf\u30b9\u30af\u3067\u306f\u306a\u304f\u3001\u53cd\u5fa9\u7684\u306a\u30d7\u30ed\u30bb\u30b9\u3067\u3059\u3002\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u3088\u308a\u30c7\u30fc\u30bf\u306e\u554f\u984c\u304c\u660e\u3089\u304b\u306b\u306a\u308a (\u4f8b: \u7279\u5b9a\u306e\u7a2e\u985e\u306e\u904e\u5270\u306a\u30b5\u30f3\u30d7\u30eb\u304c\u504f\u308a\u306b\u3064\u306a\u304c\u308b)\u3001\u8a55\u4fa1\u7d50\u679c\u304c\u30c7\u30fc\u30bf \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u6226\u7565\u306e\u6307\u91dd\u3068\u306a\u308b (\u4f8b: \u7279\u5b9a\u306e\u30c9\u30e1\u30a4\u30f3\u306e\u30c7\u30fc\u30bf\u3092\u5897\u5f37\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b)\u3001\u6cd5\u7684\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u8981\u4ef6\u304c\u5909\u66f4\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059 (\u4f8b: \u7279\u5b9a\u306e\u30bd\u30fc\u30b9\u304b\u3089\u30c7\u30fc\u30bf\u3092\u524a\u9664\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b)\u3002</p> <p>\u3057\u305f\u304c\u3063\u3066\u3001\u30c7\u30fc\u30bf\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306f\u3001\u518d\u73fe\u53ef\u80fd\u306a\u5b9f\u884c\u3001\u5897\u5206\u66f4\u65b0\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u306e\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3092\u8003\u616e\u3057\u3066\u8a2d\u8a08\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u7b2c 2 \u7ae0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306b DVC\u3001LakeFS \u306a\u3069\u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#3","title":"\u8aa4\u89e3 3: \u300c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u306e\u30c7\u30fc\u30bf\u306e\u307f\u306b\u6ce8\u76ee\u3059\u308b\u300d","text":"<p>\u78ba\u304b\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u306e\u30c7\u30fc\u30bf\u306f LLM \u306e\u57fa\u790e\u3067\u3059\u304c\u3001\u5f8c\u7d9a\u306e\u6bb5\u968e\u306e\u30c7\u30fc\u30bf\u3092\u7121\u8996\u3059\u308b\u3053\u3068\u3082\u540c\u69d8\u306b\u5371\u967a\u3067\u3059\u3002\u5927\u898f\u6a21\u306a\u30b3\u30fc\u30d1\u30b9\u3067\u5341\u5206\u306b\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u57fa\u672c\u30e2\u30c7\u30eb\u306f\u3001SFT \u30c7\u30fc\u30bf\u306e\u54c1\u8cea\u304c\u4f4e\u3044\u5834\u5408\u3001\u5e73\u51e1\u306a\u5bfe\u8a71\u30e2\u30c7\u30eb\u3092\u751f\u6210\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u540c\u69d8\u306b\u3001RLHF \u8a2d\u5b9a\u30c7\u30fc\u30bf\u306b\u4e00\u8cab\u6027\u306e\u306a\u3044\u6ce8\u91c8\u304c\u3042\u308b\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306f\u4e0d\u5b89\u5b9a\u306a\u52d5\u4f5c\u3092\u793a\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u5168\u4f53\u306e\u30c7\u30fc\u30bf\u54c1\u8cea\u7ba1\u7406\u3082\u540c\u69d8\u306b\u91cd\u8981\u3067\u3059\u3002\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3001SFT\u3001RLHF\u3001\u304a\u3088\u3073 RAG \u30c7\u30fc\u30bf\u306b\u306f\u3001\u305d\u308c\u305e\u308c\u72ec\u81ea\u306e\u54c1\u8cea\u57fa\u6e96\u3068\u8a55\u4fa1\u30b7\u30b9\u30c6\u30e0\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#4","title":"\u8aa4\u89e3 4: \u300c\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u306f\u3059\u3050\u306b\u4f7f\u7528\u3067\u304d\u308b\u300d","text":"<p>\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u53c2\u5165\u969c\u58c1\u3092\u5927\u5e45\u306b\u4e0b\u3052\u307e\u3059\u304c\u3001\u4e8c\u6b21\u30ec\u30d3\u30e5\u30fc\u306a\u3057\u3067\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u3092\u76f4\u63a5\u4f7f\u7528\u3059\u308b\u306e\u306f\u5371\u967a\u3067\u3059\u3002\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u306f\u3001\u53e4\u3044\u30c7\u30fc\u30bf (\u4ee5\u524d\u306b\u30af\u30ed\u30fc\u30eb\u3055\u308c\u305f\u3001\u6700\u65b0\u306e\u77e5\u8b58\u304c\u6b20\u3051\u3066\u3044\u308b)\u3001\u30d0\u30a4\u30a2\u30b9 (\u4e0d\u5747\u4e00\u306a\u30c7\u30fc\u30bf\u5206\u5e03)\u3001\u30ce\u30a4\u30ba (\u4e00\u90e8\u306e\u30b5\u30f3\u30d7\u30eb\u304c\u54c1\u8cea\u57fa\u6e96\u3092\u6e80\u305f\u3057\u3066\u3044\u306a\u3044)\u3001\u8457\u4f5c\u6a29\u30ea\u30b9\u30af (\u4e0d\u660e\u78ba\u306a\u30e9\u30a4\u30bb\u30f3\u30b9) \u304c\u3042\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u6b63\u3057\u3044\u30a2\u30d7\u30ed\u30fc\u30c1\u306f\u3001\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u3092\u300c\u5b8c\u6210\u54c1\u300d\u3067\u306f\u306a\u304f\u300c\u539f\u6750\u6599\u300d\u3068\u3057\u3066\u6271\u3046\u3053\u3068\u3067\u3059\u3002\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u306e\u4fa1\u5024\u3092\u6700\u5927\u5316\u3059\u308b\u306b\u306f\u3001\u72ec\u81ea\u306e\u30bf\u30b9\u30af\u8981\u4ef6\u306b\u57fa\u3065\u3044\u305f\u4e8c\u6b21\u7684\u306a\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u62e1\u5f35\u3001\u304a\u3088\u3073\u30d0\u30e9\u30f3\u30b7\u30f3\u30b0\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#15","title":"1.5 \u7ae0\u306e\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001LLM \u6642\u4ee3\u306e\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u4e2d\u6838\u6982\u5ff5\u3092\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u5247\u306e\u89b3\u70b9\u304b\u3089\u4f53\u7cfb\u7684\u306b\u8aac\u660e\u3057\u307e\u3057\u305f\u3002\u79c1\u305f\u3061\u306f\u307e\u305a\u3001\u30c1\u30f3\u30c1\u30e9\u306e\u6700\u9069\u6bd4\u7387\u304b\u3089\u30d5\u30a1\u30a4 \u30b7\u30ea\u30fc\u30ba\u306e\u6975\u7aef\u306a\u5b9f\u9a13\u307e\u3067\u3001\u300c\u91cf\u3088\u308a\u8cea\u300d\u306e\u30d1\u30e9\u30c0\u30a4\u30e0 \u30b7\u30d5\u30c8\u3092\u8abf\u67fb\u3057\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u304a\u3051\u308b\u9ad8\u54c1\u8cea\u30c7\u30fc\u30bf\u306e\u6c7a\u5b9a\u7684\u306a\u5f79\u5272\u3092\u5b9f\u8a3c\u3057\u307e\u3057\u305f\u3002</p> <p>\u6b21\u306b\u3001LLM \u30c7\u30fc\u30bf \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u306e 4 \u3064\u306e\u6bb5\u968e (\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3001SFT\u3001RLHF\u3001RAG) \u3092\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\u5404\u30b9\u30c6\u30fc\u30b8\u306b\u306f\u3001TB \u30ec\u30d9\u30eb\u306e\u30e9\u30d9\u30eb\u306a\u3057\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u6570\u4e07\u306e\u30d7\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u6bd4\u8f03\u30c7\u30fc\u30bf \u30dd\u30a4\u30f3\u30c8\u306b\u81f3\u308b\u307e\u3067\u3001\u660e\u78ba\u306b\u7570\u306a\u308b\u30c7\u30fc\u30bf\u8981\u4ef6\u304c\u3042\u308a\u307e\u3059\u3002\u30c7\u30fc\u30bf\u91cf\u306f\u6e1b\u5c11\u3057\u307e\u3059\u304c\u3001\u54c1\u8cea\u8981\u4ef6\u306f\u5897\u52a0\u3057\u307e\u3059\u3002\u3053\u306e\u300c\u30d5\u30a1\u30cd\u30eb \u30e2\u30c7\u30eb\u300d\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u3001\u30c7\u30fc\u30bf \u30ea\u30bd\u30fc\u30b9\u3092\u8a08\u753b\u3059\u308b\u305f\u3081\u306e\u57fa\u790e\u3068\u306a\u308a\u307e\u3059\u3002</p> <p>\u8ab2\u984c\u3068\u6a5f\u4f1a\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u306a\u8907\u96d1\u3055\u3001\u8457\u4f5c\u6a29\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30b3\u30b9\u30c8\u3068\u3044\u3046 3 \u3064\u306e\u5b9f\u969b\u7684\u306a\u554f\u984c\u3092\u5206\u6790\u3059\u308b\u3068\u3068\u3082\u306b\u3001\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3001AI \u30cd\u30a4\u30c6\u30a3\u30d6 \u30c4\u30fc\u30eb\u3001\u5408\u6210\u30c7\u30fc\u30bf\u3068\u3044\u3046 3 \u3064\u306e\u30c8\u30ec\u30f3\u30c9\u304b\u3089\u306e\u6a5f\u4f1a\u3082\u78ba\u8a8d\u3057\u307e\u3057\u305f\u3002</p> <p>\u6700\u5f8c\u306b\u30014 \u3064\u306e\u3088\u304f\u3042\u308b\u8aa4\u89e3\u3092\u660e\u78ba\u306b\u3059\u308b\u3053\u3068\u3067\u3001\u91cf\u3088\u308a\u3082\u8cea\u30011 \u56de\u9650\u308a\u3067\u306f\u306a\u304f\u53cd\u5fa9\u3001\u30d5\u30eb\u30b5\u30a4\u30af\u30eb\u7ba1\u7406\u3001\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u306e\u4e8c\u6b21\u51e6\u7406\u3068\u3044\u3046\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u6b63\u3057\u3044\u8003\u3048\u65b9\u3092\u8aad\u8005\u306b\u78ba\u7acb\u3057\u307e\u3057\u305f\u3002</p> <p></p> <p>\u56f3 1-6: \u7b2c 1 \u7ae0 \u77e5\u8b58\u69cb\u9020 \u2014 4 \u3064\u306e\u4e3b\u8981\u30c6\u30fc\u30de\u3092\u30ab\u30d0\u30fc: \u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306e\u6cd5\u5247\u3001\u30c7\u30fc\u30bf \u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u3001\u8ab2\u984c\u3068\u6a5f\u4f1a</p>"},{"location":"ja/part1/1_1_data_change/#_3","title":"\u3055\u3089\u306b\u8aad\u3080","text":"<p>\u30b3\u30a2\u30da\u30fc\u30d1\u30fc</p> <p>\u795e\u7d4c\u8a00\u8a9e\u30e2\u30c7\u30eb\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u5247\u3001Kaplan et al. (2020) \u306f\u3001\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u30ea\u30bd\u30fc\u30b9\u5272\u308a\u5f53\u3066\u3092\u7406\u89e3\u3059\u308b\u305f\u3081\u306e\u57fa\u790e\u7684\u306a\u7814\u7a76\u3067\u3059\u3002\u3053\u306e OpenAI \u306e\u8ad6\u6587\u3067\u306f\u3001\u30e2\u30c7\u30eb\u306e\u30b9\u30b1\u30fc\u30eb\u3001\u30c7\u30fc\u30bf\u91cf\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u9593\u306e\u3079\u304d\u4e57\u5247\u306e\u95a2\u4fc2\u304c\u521d\u3081\u3066\u4f53\u7cfb\u7684\u306b\u660e\u3089\u304b\u306b\u3055\u308c\u3001\u305d\u306e\u5f8c\u306e\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u958b\u767a\u306b\u7406\u8ad6\u7684\u306a\u6307\u91dd\u304c\u63d0\u4f9b\u3055\u308c\u307e\u3057\u305f\u3002</p> <p>Training Compute-Optimal Large Language Models (Chinchilla \u8ad6\u6587)\u3001Hoffmann et al. DeepMind \u306e (2022) \u306f\u3001\u696d\u754c\u306b\u5e83\u304f\u8513\u5ef6\u3057\u3066\u3044\u308b\u300c\u904e\u5270\u30d1\u30e9\u30e1\u30fc\u30bf\u5316\u300d\u554f\u984c\u3092\u6307\u6458\u3057\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u6700\u9069\u306a\u30e2\u30c7\u30eb\u3068\u30c7\u30fc\u30bf\u306e\u6bd4\u7387\u306b\u95a2\u3059\u308b\u63a8\u5968\u4e8b\u9805\u3092\u63d0\u4f9b\u3057\u307e\u3057\u305f\u3002</p> <p>\u5fc5\u8981\u306a\u306e\u306f\u6559\u79d1\u66f8\u3060\u3051 (Gunasekar \u4ed6\u8457) Microsoft Research \u306e (2023) \u306f\u3001Phi \u30b7\u30ea\u30fc\u30ba\u306e\u5148\u99c6\u7684\u306a\u7814\u7a76\u3067\u3042\u308a\u3001\u9ad8\u54c1\u8cea\u306e\u5408\u6210\u30c7\u30fc\u30bf\u306b\u3088\u3063\u3066\u5c0f\u578b\u30e2\u30c7\u30eb\u304c\u5927\u578b\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306b\u5339\u6575\u3059\u308b\u3053\u3068\u3092\u53ef\u80fd\u306b\u3059\u308b\u3053\u3068\u3092\u8a3c\u660e\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8</p> <p>Penedo\u3089\u306b\u3088\u3063\u3066\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305fFineWeb HuggingFace \u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u5927\u898f\u6a21\u3067\u9ad8\u54c1\u8cea\u306a\u82f1\u8a9e Web \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3067\u3001\u7d04 15T \u306e\u30c8\u30fc\u30af\u30f3\u304c\u542b\u307e\u308c\u3066\u304a\u308a\u3001\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u30d9\u30fc\u30b9 \u30b3\u30fc\u30d1\u30b9\u3068\u3057\u3066\u9069\u3057\u3066\u3044\u307e\u3059\u3002 Together AI \u306b\u3088\u3063\u3066\u30ea\u30ea\u30fc\u30b9\u3055\u308c\u305f RedPajama \u306f\u3001LLaMA \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u8907\u88fd\u3067\u3042\u308a\u3001LLaMA \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d7\u30ed\u30bb\u30b9\u3092\u518d\u73fe\u3057\u305f\u3044\u30c1\u30fc\u30e0\u306b\u3068\u3063\u3066\u8cb4\u91cd\u3067\u3059\u3002</p>"},{"location":"ja/part1/1_1_data_change/#_4","title":"\u6b21\u306e\u7ae0\u306e\u30d7\u30ec\u30d3\u30e5\u30fc","text":"<p>\u6b21\u306e\u7ae0 \u30c7\u30fc\u30bf \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u9078\u629e \u3067\u306f\u3001\u6982\u5ff5\u30ec\u30d9\u30eb\u304b\u3089\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30ec\u30d9\u30eb\u306b\u79fb\u884c\u3057\u307e\u3059\u3002\u9069\u5207\u306a\u30b9\u30c8\u30ec\u30fc\u30b8 \u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3 (S3 \u5bfe MinIO)\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af (Spark \u5bfe Ray)\u3001\u30c7\u30fc\u30bf\u5f62\u5f0f (Parquet \u5bfe JSONL \u5bfe WebDataset)\u3001\u304a\u3088\u3073\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u30c4\u30fc\u30eb (DVC \u5bfe LakeFS) \u3092\u9078\u629e\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u8cea\u554f\u3092\u6b21\u306e\u7ae0\u306b\u53d6\u308a\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002\u30ea\u30bd\u30fc\u30b9\u304c\u9650\u3089\u308c\u3066\u3044\u308b\u4e2d\u3067\u3001\u30b9\u30e0\u30fc\u30ba\u306b\u62e1\u5f35\u3057\u306a\u304c\u3089\u73fe\u5728\u306e\u30cb\u30fc\u30ba\u3092\u30b5\u30dd\u30fc\u30c8\u3067\u304d\u308b\u30c7\u30fc\u30bf \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u3092\u3069\u306e\u3088\u3046\u306b\u8a2d\u8a08\u3057\u307e\u3059\u304b?</p>"},{"location":"ja/part1/1_2_data_infra/","title":"\u7b2c2\u7ae0: \u30c7\u30fc\u30bf\u30a4\u30f3\u30d5\u30e9\u9078\u5b9a","text":""},{"location":"ja/part1/1_2_data_infra/#2","title":"\u7b2c 2 \u7ae0: \u30c7\u30fc\u30bf \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u9078\u629e","text":""},{"location":"ja/part1/1_2_data_infra/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u8077\u4eba\u306f\u4ed5\u4e8b\u3092\u3046\u307e\u304f\u3084\u308b\u524d\u306b\u3001\u9053\u5177\u3092\u7814\u3050\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 TB \u30ec\u30d9\u30eb\u307e\u305f\u306f PB \u30ec\u30d9\u30eb\u306e LLM \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u524d\u306b\u3001\u9069\u5207\u306a\u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u3092\u9078\u629e\u3059\u308b\u3053\u3068\u304c\u3001\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6210\u529f\u307e\u305f\u306f\u5931\u6557\u3092\u6c7a\u5b9a\u3059\u308b\u6700\u521d\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3068\u3044\u3046 4 \u3064\u306e\u5074\u9762\u304b\u3089\u6700\u65b0\u306e\u30c7\u30fc\u30bf \u30b9\u30bf\u30c3\u30af \u30c6\u30af\u30ce\u30ed\u30b8\u306e\u9078\u629e\u3092\u4f53\u7cfb\u7684\u306b\u7d39\u4ecb\u3057\u3001\u8aad\u8005\u304c\u52b9\u7387\u7684\u3067\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u3067\u518d\u73fe\u53ef\u80fd\u306a\u30c7\u30fc\u30bf\u51e6\u7406\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3092\u69cb\u7bc9\u3067\u304d\u308b\u3088\u3046\u306b\u652f\u63f4\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#_2","title":"\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb","text":"<p>\u3042\u306a\u305f\u306f AI \u30b9\u30bf\u30fc\u30c8\u30a2\u30c3\u30d7\u4f01\u696d\u306b\u5165\u793e\u3057\u3001LLM \u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u51e6\u7406\u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u69cb\u7bc9\u3092\u62c5\u5f53\u3057\u307e\u3057\u305f\u3002\u30c1\u30fc\u30e0\u306e\u72b6\u6cc1\u306f\u6182\u616e\u3059\u3079\u304d\u3082\u306e\u3067\u3059\u3002\u30c7\u30fc\u30bf\u306f\u3001<code>.txt</code>\u3001<code>.json</code>\u3001<code>.csv</code>\u3001<code>.parquet</code> \u306a\u3069\u306e\u3055\u307e\u3056\u307e\u306a\u5f62\u5f0f\u3067\u300150 \u53f0\u306e\u30de\u30b7\u30f3\u4e0a\u306e\u30ed\u30fc\u30ab\u30eb \u30c7\u30a3\u30b9\u30af\u306b\u5206\u6563\u3057\u3066\u3044\u307e\u3059\u3002\u30c7\u30fc\u30bf\u304c\u51e6\u7406\u3055\u308c\u308b\u305f\u3073\u306b\u3001Python \u30b9\u30af\u30ea\u30d7\u30c8\u3092\u624b\u52d5\u3067\u4f5c\u6210\u3057\u3001\u5b8c\u4e86\u3059\u308b\u307e\u3067\u306b 1 \u53f0\u306e\u30de\u30b7\u30f3\u3067 3 \u65e5\u9593\u5b9f\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u5148\u9031\u3001\u8ab0\u304b\u304c\u91cd\u8981\u306a\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u8aa4\u3063\u3066\u4e0a\u66f8\u304d\u3057\u3066\u3057\u307e\u3044\u3001\u30d0\u30c3\u30af\u30a2\u30c3\u30d7\u3084\u30d0\u30fc\u30b8\u30e7\u30f3\u8a18\u9332\u304c\u3042\u308a\u307e\u305b\u3093\u3067\u3057\u305f\u3002\u3042\u306a\u305f\u306e\u4e0a\u53f8\u306f\u3001\u300c1 \u304b\u6708\u4ee5\u5185\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3092\u958b\u59cb\u3057\u307e\u3059\u304c\u3001\u30c7\u30fc\u30bf \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u6e96\u5099\u306f\u3067\u304d\u3066\u3044\u307e\u3059\u304b?\u300d\u3068\u5c0b\u306d\u307e\u3059\u3002</p> <p>\u6700\u521d\u306e\u6c7a\u65ad: \u30c1\u30fc\u30e0\u3067\u4f7f\u3044\u6163\u308c\u305f Spark \u3092\u4f7f\u7528\u3059\u308b\u304b\u3001\u305d\u308c\u3068\u3082\u300cAI \u30cd\u30a4\u30c6\u30a3\u30d6\u300dRay \u306b\u5207\u308a\u66ff\u3048\u308b\u304b?\u30bb\u30eb\u30d5\u30db\u30b9\u30c8\u578b MinIO \u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u7bc9\u3057\u307e\u3059\u304b\u3001\u305d\u308c\u3068\u3082 S3 \u3092\u4f7f\u7528\u3057\u3066\u30af\u30e9\u30a6\u30c9\u306b\u76f4\u63a5\u79fb\u884c\u3057\u307e\u3059\u304b?\u3053\u308c\u3089\u306e\u8cea\u554f\u306b\u5bfe\u3059\u308b\u300c\u6a19\u6e96\u7684\u306a\u7b54\u3048\u300d\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u660e\u78ba\u306a\u610f\u601d\u6c7a\u5b9a\u306e\u67a0\u7d44\u307f\u306f\u5b58\u5728\u3057\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u305d\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#21-mds","title":"2.1 \u6700\u65b0\u306e\u30c7\u30fc\u30bf \u30b9\u30bf\u30c3\u30af (MDS)","text":""},{"location":"ja/part1/1_2_data_infra/#211","title":"2.1.1 \u6700\u65b0\u306e\u30c7\u30fc\u30bf\u30b9\u30bf\u30c3\u30af\u3068\u306f\u4f55\u3067\u3059\u304b?","text":"<p>\u300c\u30e2\u30c0\u30f3 \u30c7\u30fc\u30bf \u30b9\u30bf\u30c3\u30af\u300d(MDS) \u306f\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306b\u304a\u3044\u3066\u8fd1\u5e74\u6ce8\u76ee\u3055\u308c\u3066\u3044\u308b\u6982\u5ff5\u3067\u3042\u308a\u3001\u30af\u30e9\u30a6\u30c9 \u30cd\u30a4\u30c6\u30a3\u30d6\u3067\u30e2\u30b8\u30e5\u30fc\u30eb\u5f0f\u3067\u5206\u96e2\u3055\u308c\u305f\u30c7\u30fc\u30bf \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u6307\u3057\u307e\u3059\u3002\u5f93\u6765\u306e\u7d71\u5408\u30c7\u30fc\u30bf \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3068\u6bd4\u8f03\u3057\u3066\u3001\u6700\u65b0\u306e\u30c7\u30fc\u30bf \u30b9\u30bf\u30c3\u30af\u306e\u4e2d\u5fc3\u3068\u306a\u308b\u54f2\u5b66\u306f\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3\u3001\u305d\u306e\u4ed6\u306e\u6a5f\u80fd\u3092\u72ec\u7acb\u3057\u305f\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306b\u5206\u5272\u3057\u3001\u305d\u308c\u305e\u308c\u3092\u30cb\u30fc\u30ba\u306b\u5fdc\u3058\u3066\u500b\u5225\u306b\u7f6e\u304d\u63db\u3048\u305f\u308a\u62e1\u5f35\u3057\u305f\u308a\u3067\u304d\u308b\u3053\u3068\u3067\u3059\u3002</p> <p></p> <p>\u56f3 2-1: \u6700\u65b0\u306e\u30c7\u30fc\u30bf \u30b9\u30bf\u30c3\u30af \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 \u2014 \u30b9\u30c8\u30ec\u30fc\u30b8\u304b\u3089\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u5c64\u307e\u3067\u306e 5 \u5c64\u306e\u5206\u96e2\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3002\u5404\u5c64\u306f\u72ec\u7acb\u3057\u3066\u4ea4\u63db\u53ef\u80fd</p> <p>\u5f93\u6765\u306e\u30c7\u30fc\u30bf \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306f\u3001\u591a\u304f\u306e\u5834\u5408\u3001\u7d71\u5408\u30b7\u30b9\u30c6\u30e0\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u304c\u7dca\u5bc6\u306b\u7d50\u5408\u3055\u308c\u305f\u30ed\u30fc\u30ab\u30eb \u30c7\u30fc\u30bf \u30bb\u30f3\u30bf\u30fc\u306b\u5c55\u958b\u3055\u308c\u307e\u3059\u3002 Hadoop \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3092\u4f8b\u306b\u3068\u308b\u3068\u3001HDFS \u3068 MapReduce \u306e\u7d50\u5408\u306b\u3088\u308a\u3001\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u7f6e\u304d\u63db\u3048\u304c\u975e\u5e38\u306b\u56f0\u96e3\u306b\u306a\u308a\u307e\u3059\u3002\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f\u72ec\u81ea\u306e\u3082\u306e\u3067\u3042\u308b\u3053\u3068\u304c\u591a\u304f\u3001\u6df1\u523b\u306a\u30d9\u30f3\u30c0\u30fc\u30ed\u30c3\u30af\u30a4\u30f3\u306b\u3064\u306a\u304c\u308a\u307e\u3059\u3002\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306f\u4e3b\u306b\u5782\u76f4\u65b9\u5411\u3067\u3042\u308a\u3001\u3088\u308a\u5f37\u529b\u306a\u5358\u4e00\u30de\u30b7\u30f3\u3092\u8cfc\u5165\u3059\u308b\u3053\u3068\u3067\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u304c\u3001\u521d\u671f\u8cbb\u7528\u306f\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002</p> \u7279\u96c6 \u5f93\u6765\u306e\u30a2\u30d7\u30ed\u30fc\u30c1 \u6700\u65b0\u306e\u30c7\u30fc\u30bf\u30b9\u30bf\u30c3\u30af \u5c55\u958b\u30e2\u30fc\u30c9 \u30ed\u30fc\u30ab\u30eb\u30c7\u30fc\u30bf\u30bb\u30f3\u30bf\u30fc\u3001\u7d71\u5408\u30b7\u30b9\u30c6\u30e0 \u30af\u30e9\u30a6\u30c9\u30cd\u30a4\u30c6\u30a3\u30d6\u3067\u67d4\u8edf\u306a\u30aa\u30f3\u30c7\u30de\u30f3\u30c9\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0 \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u306e\u7d50\u5408 \u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5883\u754c (HDFS + MapReduce \u306a\u3069) \u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5206\u96e2\u3001\u5404\u30ec\u30a4\u30e4\u30fc\u306f\u72ec\u7acb\u3057\u3066\u4ea4\u63db\u53ef\u80fd \u30c7\u30fc\u30bf\u5f62\u5f0f \u72ec\u81ea\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3001\u30d9\u30f3\u30c0\u30fc\u30ed\u30c3\u30af\u30a4\u30f3 \u30aa\u30fc\u30d7\u30f3\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 (\u5bc4\u6728\u7d30\u5de5\u3001ORC) \u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3 \u4e3b\u306b\u5782\u76f4\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0 \u6c34\u5e73\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u3001\u307b\u307c\u7121\u5236\u9650 \u30b3\u30b9\u30c8\u30e2\u30c7\u30eb \u56fa\u5b9a\u6295\u8cc7\u3001\u9ad8\u984d\u306a\u521d\u671f\u8cbb\u7528 \u5f93\u91cf\u8ab2\u91d1\u5236\u3001\u67d4\u8edf\u306a\u30b3\u30b9\u30c8 <p>\u6700\u65b0\u306e\u30c7\u30fc\u30bf \u30b9\u30bf\u30c3\u30af\u306e\u51fa\u73fe\u306b\u3088\u308a\u3001\u3053\u306e\u72b6\u6cc1\u306f\u4e00\u5909\u3057\u307e\u3057\u305f\u3002\u30af\u30e9\u30a6\u30c9\u30cd\u30a4\u30c6\u30a3\u30d6\u306e\u5c0e\u5165\u306b\u3088\u308a\u3001\u30aa\u30f3\u30c7\u30de\u30f3\u30c9\u3067\u306e\u67d4\u8edf\u306a\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002\u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u5b8c\u5168\u306b\u5206\u96e2\u3059\u308b\u3053\u3068\u3067\u3001\u5404\u30ec\u30a4\u30e4\u30fc\u3092\u72ec\u7acb\u3057\u3066\u9032\u5316\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30aa\u30fc\u30d7\u30f3 \u30c7\u30fc\u30bf\u5f62\u5f0f (Parquet\u3001ORC \u306a\u3069) \u306b\u3088\u308a\u3001\u30d9\u30f3\u30c0\u30fc \u30ed\u30c3\u30af\u30a4\u30f3\u306e\u30ea\u30b9\u30af\u304c\u6392\u9664\u3055\u308c\u307e\u3059\u3002\u6c34\u5e73\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306b\u3088\u308a\u3001\u30b7\u30b9\u30c6\u30e0\u306f\u307b\u307c\u7121\u5236\u9650\u306e\u30c7\u30fc\u30bf\u91cf\u3092\u51e6\u7406\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u3001\u5f93\u91cf\u8ab2\u91d1\u5236\u306e\u30b3\u30b9\u30c8 \u30e2\u30c7\u30eb\u306b\u3088\u308a\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u7acb\u3061\u4e0a\u3052\u306e\u969c\u58c1\u304c\u5927\u5e45\u306b\u4f4e\u304f\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#212","title":"2.1.2 \u30b9\u30c8\u30ec\u30fc\u30b8\u5c64: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u30c7\u30fc\u30bf \u30ec\u30a4\u30af","text":"<p>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8\u306f\u3001\u6700\u65b0\u306e\u30c7\u30fc\u30bf \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u4e8b\u5b9f\u4e0a\u306e\u6a19\u6e96\u57fa\u76e4\u3067\u3059\u3002 AWS S3\u3001Google Cloud Storage\u3001Azure Blob\u3001\u307e\u305f\u306f\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 MinIO \u306e\u3044\u305a\u308c\u3067\u3042\u3063\u3066\u3082\u3001\u305d\u306e\u4e2d\u5fc3\u3068\u306a\u308b\u54f2\u5b66\u306f\u540c\u3058\u3067\u3059\u3002\u3064\u307e\u308a\u3001\u771f\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u968e\u5c64\u3092\u6301\u305f\u305a\u3001<code>bucket/key</code> \u30d0\u30a4\u30ca\u30ea\u69cb\u9020\u306e\u307f\u3092\u5099\u3048\u305f\u30d5\u30e9\u30c3\u30c8\u306a\u540d\u524d\u7a7a\u9593\u3067\u3059\u3002\u7406\u8ad6\u7684\u306b\u306f\u7121\u5236\u9650\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u3002\u975e\u5e38\u306b\u9ad8\u3044\u30c7\u30fc\u30bf\u8010\u4e45\u6027 (S3 \u306f 11 \u30ca\u30a4\u30f3\u3001\u3064\u307e\u308a 99.999999999% \u3092\u4e3b\u5f35\u3057\u307e\u3059)\u3002\u5b9f\u969b\u306e\u4f7f\u7528\u91cf\u306b\u5fdc\u3058\u3066\u8acb\u6c42\u3055\u308c\u308b\u305f\u3081\u3001\u591a\u984d\u306e\u5148\u884c\u6295\u8cc7\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002</p> <p>\u30aa\u30d7\u30b7\u30e7\u30f3\u306e\u4e2d\u304b\u3089\u9078\u629e\u3059\u308b\u5834\u5408\u306f\u3001\u5c55\u958b\u30e2\u30fc\u30c9\u3001\u4e92\u63db\u6027\u3001\u30b3\u30b9\u30c8\u3001\u305d\u306e\u4ed6\u306e\u8981\u7d20\u3092\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 AWS S3 \u306f\u3001\u6700\u3082\u6210\u719f\u3057\u305f\u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3092\u5099\u3048\u305f\u30d1\u30d6\u30ea\u30c3\u30af \u30af\u30e9\u30a6\u30c9 \u30db\u30b9\u30c6\u30a3\u30f3\u30b0\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u3067\u3042\u308a\u3001\u307b\u3068\u3093\u3069\u306e\u5b9f\u7a3c\u50cd\u74b0\u5883\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002 MinIO \u306f\u3001S3 \u3068\u4e92\u63db\u6027\u306e\u3042\u308b\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u4ee3\u66ff\u54c1\u3067\u3042\u308a\u3001\u30c7\u30fc\u30bf \u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u8981\u4ef6\u306e\u3042\u308b\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u5c55\u958b\u30b7\u30ca\u30ea\u30aa\u3084\u958b\u767a/\u30c6\u30b9\u30c8\u74b0\u5883\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002 Google Cloud Storage \u3068 Azure Blob \u306f\u305d\u308c\u305e\u308c\u3001\u3059\u3067\u306b GCP \u307e\u305f\u306f Azure \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u306b\u6df1\u304f\u95a2\u308f\u3063\u3066\u3044\u308b\u30e6\u30fc\u30b6\u30fc\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002</p> \u7279\u96c6 AWS S3 \u307f\u306b\u304a Google GCS \u30a2\u30ba\u30fc\u30eb\u30d6\u30ed\u30d6 \u5c55\u958b\u30e2\u30fc\u30c9 \u30d1\u30d6\u30ea\u30c3\u30af \u30af\u30e9\u30a6\u30c9\u3067\u30db\u30b9\u30c8\u3055\u308c\u308b \u30bb\u30eb\u30d5\u30db\u30b9\u30c8/\u30d7\u30e9\u30a4\u30d9\u30fc\u30c8 \u30af\u30e9\u30a6\u30c9 \u30d1\u30d6\u30ea\u30c3\u30af \u30af\u30e9\u30a6\u30c9\u3067\u30db\u30b9\u30c8\u3055\u308c\u308b \u30d1\u30d6\u30ea\u30c3\u30af \u30af\u30e9\u30a6\u30c9\u3067\u30db\u30b9\u30c8\u3055\u308c\u308b S3 \u306e\u4e92\u63db\u6027 \u30cd\u30a4\u30c6\u30a3\u30d6 100% \u4e92\u63db\u6027\u3042\u308a \u30a2\u30c0\u30d7\u30bf\u30fc\u5c64\u304c\u5fc5\u8981 \u30a2\u30c0\u30d7\u30bf\u30fc\u5c64\u304c\u5fc5\u8981 \u30b3\u30fc\u30eb\u30c9/\u30db\u30c3\u30c8\u968e\u5c64\u5316 \u6c37\u6cb3 \u968e\u5c64\u5316 \u30cb\u30a2\u30e9\u30a4\u30f3/\u30b3\u30fc\u30eb\u30c9\u30e9\u30a4\u30f3 \u30af\u30fc\u30eb/\u30a2\u30fc\u30ab\u30a4\u30d6 \u6700\u4f4e\u30b3\u30b9\u30c8 $0.023/GB/\u6708 \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306e\u30b3\u30b9\u30c8 $0.020/GB/\u6708 $0.018/GB/\u6708 \u5178\u578b\u7684\u306a\u4f7f\u7528\u4f8b \u5b9f\u7a3c\u50cd\u74b0\u5883\u306e\u30c7\u30d5\u30a9\u30eb\u30c8 \u30d7\u30e9\u30a4\u30d9\u30fc\u30c8\u5c55\u958b/\u958b\u767a\u30c6\u30b9\u30c8 GCP \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0 \u30e6\u30fc\u30b6\u30fc Azure \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u306e\u30e6\u30fc\u30b6\u30fc <p>\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8\u306f\u300c\u30b9\u30c8\u30ec\u30fc\u30b8\u300d\u306e\u554f\u984c\u3092\u89e3\u6c7a\u3057\u307e\u3059\u304c\u3001\u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304a\u3088\u3073\u30e1\u30bf\u30c7\u30fc\u30bf\u7ba1\u7406\u6a5f\u80fd\u304c\u3042\u308a\u307e\u305b\u3093\u3002 S3 \u306e Parquet \u30d5\u30a1\u30a4\u30eb\u3092\u76f4\u63a5\u64cd\u4f5c\u3059\u308b\u3068\u3001\u591a\u304f\u306e\u554f\u984c\u304c\u767a\u751f\u3057\u307e\u3059\u3002ACID \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u304c\u306a\u3044\u305f\u3081\u3001\u540c\u6642\u66f8\u304d\u8fbc\u307f\u306b\u3088\u308a\u30c7\u30fc\u30bf\u304c\u7834\u640d\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u52b9\u7387\u7684\u306a\u30af\u30a8\u30ea\u304c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u6bce\u56de\u3059\u3079\u3066\u306e\u30d5\u30a1\u30a4\u30eb\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30bf\u30a4\u30e0\u30c8\u30e9\u30d9\u30eb\u306f\u306a\u304f\u3001\u30c7\u30fc\u30bf\u304c\u4e0a\u66f8\u304d\u3055\u308c\u308b\u3068\u3001\u904e\u53bb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002</p> <p>\u30c7\u30fc\u30bf \u30ec\u30a4\u30af \u30c6\u30fc\u30d6\u30eb\u5f62\u5f0f\u306f\u3001\u307e\u3055\u306b\u3053\u308c\u3089\u306e\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306b\u767b\u5834\u3057\u307e\u3057\u305f\u3002\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u4e0a\u306b\u30e1\u30bf\u30c7\u30fc\u30bf\u7ba1\u7406\u30ec\u30a4\u30e4\u30fc\u3092\u8ffd\u52a0\u3057\u3001\u30c7\u30fc\u30bf \u30a6\u30a7\u30a2\u30cf\u30a6\u30b9 \u30ec\u30d9\u30eb\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002 Apache Iceberg\u3001Apache Hudi\u3001Delta Lake \u306f\u3001\u73fe\u5728\u6700\u3082\u4e3b\u6d41\u306e 3 \u3064\u306e\u30c7\u30fc\u30bf \u30ec\u30a4\u30af\u5f62\u5f0f\u3067\u3059\u3002</p> <p></p> <p>\u56f3 2-2: \u30c7\u30fc\u30bf \u30ec\u30a4\u30af\u30cf\u30a6\u30b9 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 \u2014 \u30c6\u30fc\u30d6\u30eb \u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u30ec\u30a4\u30e4\u30fc\u306f\u3001ACID \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3001\u30bf\u30a4\u30e0 \u30c8\u30e9\u30d9\u30eb\u3001\u30b9\u30ad\u30fc\u30de\u9032\u5316\u306a\u3069\u306e\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059</p> <p>Apache Iceberg \u306f Netflix \u306b\u3088\u3063\u3066\u958b\u767a\u3055\u308c\u3001Apache Foundation \u306b\u8ca2\u732e\u3057\u307e\u3057\u305f\u3002\u305d\u306e\u6700\u5927\u306e\u5229\u70b9\u306f\u30a8\u30f3\u30b8\u30f3\u306e\u4e2d\u7acb\u6027\u3067\u3059\u3002Spark\u3001Flink\u3001Trino\u3001Dremio\u3001DuckDB\u3001\u305d\u306e\u4ed6\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30a8\u30f3\u30b8\u30f3\u3068\u3046\u307e\u304f\u9023\u643a\u3057\u307e\u3059\u3002 LLM \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30b7\u30ca\u30ea\u30aa\u3067\u306f\u3001Iceberg \u304c\u6700\u3082\u63a8\u5968\u3055\u308c\u308b\u9078\u629e\u80a2\u3067\u3059\u3002 Apache Hudi \u306f Uber \u306b\u3088\u3063\u3066\u958b\u767a\u3055\u308c\u3001\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0 \u30d0\u30c3\u30c1\u306e\u7d71\u5408\u3068\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u306e\u66f4\u65b0\u306b\u5f37\u307f\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u5b9f\u8cea\u7684\u306a\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u66f4\u65b0\u306e\u30cb\u30fc\u30ba\u304c\u3042\u308b\u5834\u5408 (RAG \u30ca\u30ec\u30c3\u30b8 \u30d9\u30fc\u30b9\u306e\u7d99\u7d9a\u7684\u306a\u66f4\u65b0\u306a\u3069)\u3001Hudi \u3092\u691c\u8a0e\u3067\u304d\u307e\u3059\u3002 Delta Lake \u306f\u3001\u6700\u3082\u7dca\u5bc6\u306a Spark \u7d71\u5408\u3092\u4f7f\u7528\u3057\u3066 Databricks \u306b\u3088\u3063\u3066\u958b\u767a\u3055\u308c\u307e\u3057\u305f\u3002\u3059\u3067\u306b Databricks \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u306b\u6df1\u304f\u95a2\u308f\u3063\u3066\u3044\u308b\u5834\u5408\u306f\u3001Delta Lake \u3092\u9078\u629e\u3059\u308b\u3068\u6700\u9ad8\u306e\u30a8\u30af\u30b9\u30da\u30ea\u30a8\u30f3\u30b9\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p> \u7279\u96c6 \u30a2\u30d1\u30c3\u30c1\u30a2\u30a4\u30b9\u30d0\u30fc\u30b0 \u30a2\u30d1\u30c3\u30c1\u30d2\u30e5\u30fc\u30c7\u30a3 \u30c7\u30eb\u30bf\u6e56 \u30d0\u30c3\u30af\u30d9\u30f3\u30c0\u30fc Netflix \u2192 Apache Uber \u2192 Apache \u30c7\u30fc\u30bf\u30d6\u30ea\u30c3\u30af \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u5b66\u4f4d \u5b8c\u5168\u306b\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u5b8c\u5168\u306b\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30b3\u30a2\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3001\u4e00\u90e8\u306e\u6a5f\u80fd\u306f\u5546\u7528 \u30a8\u30f3\u30b8\u30f3\u306e\u4e92\u63db\u6027 \u30b9\u30d1\u30fc\u30af\u3001\u30d5\u30ea\u30f3\u30af\u3001\u30c8\u30ea\u30ce\u3001\u30c0\u30c3\u30afDB \u30b9\u30d1\u30fc\u30af\u3001\u30d5\u30ea\u30f3\u30af\u3001\u30d7\u30ec\u30b9\u30c8 \u4e3b\u306b\u30b9\u30d1\u30fc\u30af \u5178\u578b\u7684\u306a\u4f7f\u7528\u4f8b \u30de\u30eb\u30c1\u30a8\u30f3\u30b8\u30f3\u6df7\u5408\u4f7f\u7528\u3001\u30d9\u30f3\u30c0\u30fc\u4e2d\u7acb \u30b9\u30c8\u30ea\u30fc\u30e0\u3068\u30d0\u30c3\u30c1\u306e\u7d71\u5408\u3001\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0\u66f4\u65b0 Databricks \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u306e\u30e6\u30fc\u30b6\u30fc <p>\u5b9f\u969b\u306b\u9078\u629e\u3059\u308b\u5834\u5408\u306f\u3001\u6b21\u306e\u6c7a\u5b9a\u6728\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002 \u307e\u305a\u3001\u30c7\u30fc\u30bf\u898f\u6a21\u304c 100TB \u3092\u8d85\u3048\u308b\u304b\u3069\u3046\u304b\u3092\u5224\u65ad\u3057\u307e\u3059\u3002 \u300c\u306f\u3044\u300d\u306e\u5834\u5408\u306f\u3001ACID \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3068\u30bf\u30a4\u30e0\u30c8\u30e9\u30d9\u30eb\u304c\u5fc5\u8981\u304b\u3069\u3046\u304b\u3092\u3055\u3089\u306b\u691c\u8a0e\u3057\u307e\u3059\u3002\u300c\u306f\u3044\u300d\u3067\u30de\u30eb\u30c1\u30a8\u30f3\u30b8\u30f3 \u30a2\u30af\u30bb\u30b9\u306e\u30cb\u30fc\u30ba\u304c\u3042\u308b\u5834\u5408\u306f\u3001Iceberg + S3 \u3092\u63a8\u5968\u3057\u307e\u3059\u3002 Spark \u306e\u307f\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001Delta Lake \u307e\u305f\u306f Hudi \u3092\u9078\u629e\u3067\u304d\u307e\u3059\u3002 ACID \u6a5f\u80fd\u304c\u5fc5\u8981\u306a\u3044\u5834\u5408\u306f\u3001S3/MinIO + Parquet \u3092\u76f4\u63a5\u4f7f\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30c7\u30fc\u30bf \u30dc\u30ea\u30e5\u30fc\u30e0\u304c 100 TB \u672a\u6e80\u306e\u30b7\u30ca\u30ea\u30aa\u306e\u5834\u5408\u3001\u30c1\u30fc\u30e0 \u30b5\u30a4\u30ba\u304c\u5c0f\u3055\u3044 (5 \u4eba\u672a\u6e80) \u5834\u5408\u306f\u3001\u30d7\u30ed\u30c8\u30bf\u30a4\u30d7\u306e\u691c\u8a3c\u306b\u306f\u30ed\u30fc\u30ab\u30eb \u30c7\u30a3\u30b9\u30af + Parquet \u3067\u5341\u5206\u3067\u3059\u3002\u898f\u6a21\u306e\u62e1\u5927\u306b\u5fdc\u3058\u3066 S3 + Parquet \u306b\u79fb\u884c\u3057\u307e\u3059\u3002</p> <p></p> <p>\u56f3 2-3: \u30b9\u30c8\u30ec\u30fc\u30b8 \u30ec\u30a4\u30e4\u30fc\u306e\u9078\u629e\u30c7\u30b7\u30b8\u30e7\u30f3 \u30c4\u30ea\u30fc \u2014 \u30c7\u30fc\u30bf \u30b9\u30b1\u30fc\u30eb\u3001ACID \u306e\u30cb\u30fc\u30ba\u3001\u30de\u30eb\u30c1\u30a8\u30f3\u30b8\u30f3 \u30a2\u30af\u30bb\u30b9\u3001\u305d\u306e\u4ed6\u306e\u8981\u7d20\u306b\u57fa\u3065\u3044\u3066\u6700\u9069\u306a\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u3092\u9078\u629e\u3057\u307e\u3059</p>"},{"location":"ja/part1/1_2_data_infra/#213-spark-ray","title":"2.1.3 \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u5c64: Spark \u30c7\u30fc\u30bf\u3068 Ray \u30c7\u30fc\u30bf","text":"<p>\u3053\u308c\u306f\u3001LLM \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306b\u304a\u3051\u308b\u6700\u3082\u4e00\u822c\u7684\u306a\u300c\u4e8c\u8005\u629e\u4e00\u300d\u306e\u30b8\u30ec\u30f3\u30de\u3067\u3059\u3002\u3069\u3061\u3089\u3082\u5206\u6563\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3059\u304c\u3001\u8a2d\u8a08\u54f2\u5b66\u3068\u4f7f\u7528\u4f8b\u304c\u660e\u3089\u304b\u306b\u7570\u306a\u308a\u307e\u3059\u3002\u6b63\u3057\u3044\u6280\u8853\u7684\u306a\u9078\u629e\u3092\u884c\u3046\u306b\u306f\u3001\u305d\u308c\u3089\u306e\u9055\u3044\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002</p> <p>Apache Spark \u306f 2009 \u5e74\u306b\u30d0\u30fc\u30af\u30ec\u30fc\u306e AMPLab \u3067\u8a95\u751f\u3057\u307e\u3057\u305f\u3002 15 \u5e74\u306e\u958b\u767a\u671f\u9593\u3092\u7d4c\u3066\u3001\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf\u51e6\u7406\u306e\u300c\u30b9\u30a4\u30b9 \u30a2\u30fc\u30df\u30fc \u30ca\u30a4\u30d5\u300d\u3068\u306a\u308a\u307e\u3057\u305f\u3002 Spark \u306e\u4e2d\u6838\u7684\u306a\u5f37\u307f\u306f\u3001\u305d\u306e\u6210\u719f\u5ea6\u3068\u5b89\u5b9a\u6027\u3067\u3042\u308a\u3001\u975e\u5e38\u306b\u8c4a\u5bcc\u306a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3068\u30b3\u30df\u30e5\u30cb\u30c6\u30a3 \u30ea\u30bd\u30fc\u30b9\u3092\u5099\u3048\u3001PB \u898f\u6a21\u3067\u5b9f\u7a3c\u50cd\u691c\u8a3c\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Spark SQL \u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30c7\u30fc\u30bf \u30a2\u30ca\u30ea\u30b9\u30c8\u3082\u5206\u6563\u51e6\u7406\u30ed\u30b8\u30c3\u30af\u3092\u4f5c\u6210\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u3001\u53c2\u5165\u969c\u58c1\u304c\u4f4e\u304f\u306a\u308a\u307e\u3059\u3002 Structured Streaming \u306f\u30ea\u30a2\u30eb\u30bf\u30a4\u30e0 \u30c7\u30fc\u30bf\u51e6\u7406\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3001\u30b9\u30c8\u30ea\u30fc\u30e0\u3068\u30d0\u30c3\u30c1\u306e\u7d71\u5408\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002\u305f\u3060\u3057\u3001Spark \u306b\u306f\u660e\u3089\u304b\u306a\u6b20\u70b9\u3082\u3042\u308a\u307e\u3059\u3002\u30b3\u30a2\u306f JVM \u5b9f\u88c5\u3067\u3042\u308a\u3001Python UDF \u306f JVM-Python \u9593\u306e\u30b7\u30ea\u30a2\u30eb\u5316\u3092\u5fc5\u8981\u3068\u3057\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u5927\u304d\u304f\u306a\u308a\u307e\u3059\u3002 \u300cAI \u30cd\u30a4\u30c6\u30a3\u30d6\u300d\u3067\u306f\u306a\u304f\u3001GPU \u3068 PyTorch/TensorFlow \u306e\u7d71\u5408\u30b5\u30dd\u30fc\u30c8\u304c\u5f31\u304f\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u6f14\u7b97\u5b50\u306f\u305d\u308c\u3089\u306e\u9593\u306e\u4e2d\u9593\u7d50\u679c\u3092\u5177\u4f53\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u30e1\u30e2\u30ea\u306b\u5927\u304d\u306a\u8ca0\u8377\u304c\u304b\u304b\u308a\u307e\u3059\u3002</p> <p>Ray \u306f 2017 \u5e74\u306b\u30d0\u30fc\u30af\u30ec\u30fc\u306e RISELab \u3067\u751f\u307e\u308c\u3001\u5f53\u521d\u306f\u5206\u6563\u5f37\u5316\u5b66\u7fd2\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3057\u305f\u304c\u3001\u5f8c\u306b\u4e00\u822c\u7684\u306a AI \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306b\u9032\u5316\u3057\u307e\u3057\u305f\u3002 Ray Data \u306f\u3001AI \u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u5c02\u7528\u306b\u8a2d\u8a08\u3055\u308c\u305f\u30c7\u30fc\u30bf\u51e6\u7406\u30e2\u30b8\u30e5\u30fc\u30eb\u3067\u3059\u3002 Ray Data \u306e\u4e2d\u6838\u7684\u306a\u5f37\u307f\u306f\u3001Python \u30cd\u30a4\u30c6\u30a3\u30d6\u3067\u3042\u308a\u3001JVM \u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u306a\u304f\u3001PyTorch\u3001HuggingFace\u3001\u305d\u306e\u4ed6\u306e AI \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3068\u30b7\u30fc\u30e0\u30ec\u30b9\u306b\u7d71\u5408\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u9ad8\u3044\u30e1\u30e2\u30ea\u52b9\u7387\u306b\u3088\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5b9f\u884c\u3092\u30cd\u30a4\u30c6\u30a3\u30d6\u306b\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002\u5185\u8535 GPU \u30b9\u30b1\u30b8\u30e5\u30fc\u30ea\u30f3\u30b0\u306b\u3088\u308a\u3001CUDA \u30aa\u30da\u30ec\u30fc\u30bf\u30fc\u3092\u7c21\u5358\u306b\u547c\u3073\u51fa\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30a2\u30af\u30bf\u30fc \u30e2\u30c7\u30eb\u306f\u3001\u30ed\u30fc\u30c9\u3055\u308c\u305f ML \u30e2\u30c7\u30eb\u3092\u5fc5\u8981\u3068\u3059\u308b\u63a8\u8ad6\u30bf\u30b9\u30af\u306a\u3069\u3001\u30b9\u30c6\u30fc\u30c8\u30d5\u30eb\u3067\u8907\u96d1\u306a\u51e6\u7406\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001Ray \u306f\u6bd4\u8f03\u7684\u82e5\u3044\u305f\u3081\u3001Spark \u307b\u3069\u8c4a\u5bcc\u306a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3084\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306f\u3042\u308a\u307e\u305b\u3093\u3002 SQL \u30b5\u30dd\u30fc\u30c8\u304c\u5f31\u304f\u3001Spark SQL \u306e\u3088\u3046\u306a\u6210\u719f\u3057\u305f SQL \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u5f93\u6765\u306e\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0 (Hive\u3001Iceberg) \u3068\u306e\u7d71\u5408\u306b\u306f\u8ffd\u52a0\u306e\u4f5c\u696d\u304c\u5fc5\u8981\u3067\u3059\u3002</p> \u5bf8\u6cd5 \u30a2\u30d1\u30c3\u30c1\u30b9\u30d1\u30fc\u30af \u30ec\u30a4\u30c7\u30fc\u30bf \u8a00\u8a9e Scala/Java \u30b3\u30a2\u3001Python API Python \u30cd\u30a4\u30c6\u30a3\u30d6 \u30e9\u30f3\u30bf\u30a4\u30e0 JVM Python (\u77e2\u5370\u30d9\u30fc\u30b9) \u30c7\u30fc\u30bf\u306e\u62bd\u8c61\u5316 DataFrame (\u30d0\u30c3\u30c1\u601d\u8003) \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8 (\u30b9\u30c8\u30ea\u30fc\u30e0\u601d\u8003) GPU \u30b5\u30dd\u30fc\u30c8 RAPIDS \u30d7\u30e9\u30b0\u30a4\u30f3\u304c\u5fc5\u8981\u3067\u3059 \u30cd\u30a4\u30c6\u30a3\u30d6\u30b5\u30dd\u30fc\u30c8 PyTorch \u306e\u7d71\u5408 \u9762\u5012 \u4e00\u7d1a\u56fd\u6c11 SQL \u30b5\u30dd\u30fc\u30c8 \u3068\u3066\u3082\u6210\u719f\u3057\u305f \u9650\u5b9a \u4e00\u822c\u7684\u306a\u30e6\u30fc\u30b6\u30fc \u5f93\u6765\u306e\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf \u30c1\u30fc\u30e0 AI/ML \u30c1\u30fc\u30e0 <p>\u305d\u308c\u3089\u306e\u9055\u3044\u3092\u3088\u308a\u76f4\u89b3\u7684\u306b\u7406\u89e3\u3059\u308b\u306b\u306f\u3001\u5177\u4f53\u7684\u306a\u30b3\u30fc\u30c9\u306e\u6bd4\u8f03\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002 Parquet \u30d5\u30a1\u30a4\u30eb\u3092\u8aad\u307f\u53d6\u308a\u3001\u77ed\u3044\u30c6\u30ad\u30b9\u30c8\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u9577\u3055\u3092\u8a08\u7b97\u3057\u3001\u7d50\u679c\u3092\u4fdd\u5b58\u3059\u308b\u3068\u3044\u3046\u30bf\u30b9\u30af\u3092\u60f3\u5b9a\u3057\u307e\u3059\u3002</p> <p>\u30b9\u30d1\u30fc\u30af\u306e\u5b9f\u88c5:</p> <pre><code>from pyspark.sql import SparkSession\nfrom pyspark.sql.functions import length, col\n\n# Initialize Spark Session\nspark = SparkSession.builder \\\n    .appName(\"TextFilter\") \\\n    .config(\"spark.executor.memory\", \"8g\") \\\n    .getOrCreate()\n\n# Read \u2192 Filter \u2192 Compute \u2192 Save\ndf = spark.read.parquet(\"s3://my-bucket/raw_data/\")\ndf_filtered = df.filter(length(col(\"text\")) &gt; 100) \\\n                .withColumn(\"text_length\", length(col(\"text\")))\ndf_filtered.write.parquet(\"s3://my-bucket/processed_data/\")\n\nspark.stop()\n</code></pre> <p>\u30ec\u30a4\u30c7\u30fc\u30bf\u306e\u5b9f\u88c5:</p> <pre><code>import ray\n\n# Initialize Ray (auto-detect cluster resources)\nray.init()\n\n# Define processing function\ndef filter_and_compute(batch):\n    mask = batch[\"text\"].str.len() &gt; 100\n    filtered = batch[mask].copy()\n    filtered[\"text_length\"] = filtered[\"text\"].str.len()\n    return filtered\n\n# Read \u2192 Process \u2192 Save (pipeline execution)\nds = ray.data.read_parquet(\"s3://my-bucket/raw_data/\")\nds_processed = ds.map_batches(filter_and_compute, batch_format=\"pandas\")\nds_processed.write.parquet(\"s3://my-bucket/processed_data/\")\n</code></pre> <p>\u3054\u89a7\u306e\u3068\u304a\u308a\u3001Spark \u306f\u660e\u793a\u7684\u306a Executor \u30e1\u30e2\u30ea\u69cb\u6210\u3092\u5fc5\u8981\u3068\u3057\u3001\u5ba3\u8a00\u578b DataFrame API \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 Ray \u306f\u30ea\u30bd\u30fc\u30b9\u3092\u81ea\u52d5\u691c\u51fa\u3057\u3001\u6a5f\u80fd\u7684\u306a <code>map_batches</code> \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 Spark \u306e\u30ab\u30b9\u30bf\u30e0 \u30ed\u30b8\u30c3\u30af\u3067\u306f\u3001\u30b7\u30ea\u30a2\u30eb\u5316\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3092\u5099\u3048\u305f UDF \u3092\u5b9a\u7fa9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 Ray \u306f\u901a\u5e38\u306e Python \u95a2\u6570\u3092\u76f4\u63a5\u3001\u3088\u308a\u81ea\u7136\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <p></p> <p>\u56f3 2-4: \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u9078\u629e\u30c7\u30b7\u30b8\u30e7\u30f3 \u30c4\u30ea\u30fc \u2014 Spark \u306f SQL/ETL \u30b7\u30ca\u30ea\u30aa\u306b\u9069\u3057\u3001Ray \u306f GPU/ML \u30b7\u30ca\u30ea\u30aa\u306b\u9069\u3057\u3066\u3044\u307e\u3059</p> <p>\u5b9f\u969b\u306e\u610f\u601d\u6c7a\u5b9a\u3092\u884c\u3046\u3068\u304d\u306f\u3001\u6b21\u306e\u30ed\u30b8\u30c3\u30af\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\u30c7\u30fc\u30bf\u51e6\u7406\u306b GPU \u304c\u5fc5\u8981\u306a\u5834\u5408 (\u54c1\u8cea\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u306e\u305f\u3081\u306b BERT \u30e2\u30c7\u30eb\u3092\u547c\u3073\u51fa\u3059\u306a\u3069)\u3001Ray Data \u3092\u9078\u629e\u3059\u308b\u306e\u304c\u3088\u308a\u81ea\u7136\u3067\u3059\u3002 SQL \u304a\u3088\u3073 BI \u30af\u30a8\u30ea\u306e\u5927\u304d\u306a\u30cb\u30fc\u30ba\u304c\u3042\u308b\u5834\u5408\u3001Spark \u306e SQL \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u306f\u3088\u308a\u6210\u719f\u3057\u3066\u3044\u307e\u3059\u3002\u3059\u3067\u306b\u5e83\u7bc4\u306a Spark \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u3068\u30b3\u30fc\u30c9\u8cc7\u7523\u304c\u3042\u308b\u5834\u5408\u306f\u3001\u79fb\u884c\u30b3\u30b9\u30c8\u3092\u8a55\u4fa1\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u9ad8\u30b3\u30b9\u30c8\u306e\u5834\u5408\u306f Spark \u3092\u7dad\u6301\u3057\u3001\u4f4e\u30b3\u30b9\u30c8\u306e\u5834\u5408\u306f Ray \u3092\u6bb5\u968e\u7684\u306b\u5c0e\u5165\u3059\u308b\u3053\u3068\u3092\u691c\u8a0e\u3057\u307e\u3059\u3002\u65b0\u3057\u3044\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u5834\u5408\u3001\u30c1\u30fc\u30e0\u306e\u80cc\u666f\u304c\u6c7a\u5b9a\u7684\u3067\u3059\u3002\u5f93\u6765\u306e\u30d3\u30c3\u30b0\u30c7\u30fc\u30bf \u30c1\u30fc\u30e0\u306f Spark \u306e\u65b9\u304c\u63a1\u7528\u3057\u3084\u3059\u3044\u3068\u8003\u3048\u3001AI/ML \u30c1\u30fc\u30e0\u306f Ray \u306e\u65b9\u304c\u30b9\u30e0\u30fc\u30ba\u3060\u3068\u8003\u3048\u307e\u3059\u3002</p> <p>\u8a00\u53ca\u3059\u308b\u4fa1\u5024\u304c\u3042\u308a\u307e\u3059: \u5b9f\u969b\u306e\u5927\u898f\u6a21\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\u3001Spark \u3068 Ray \u306f\u76f8\u4e92\u306b\u6392\u4ed6\u7684\u3067\u306f\u306a\u304f\u3001\u5171\u5b58\u3059\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u6226\u7565: Spark \u306f\u3001Iceberg/Hive \u30c6\u30fc\u30d6\u30eb\u306e\u8aad\u307f\u53d6\u308a/\u66f8\u304d\u8fbc\u307f\u3001SQL \u5206\u6790\u304a\u3088\u3073\u305d\u306e\u4ed6\u306e ETL \u30bf\u30b9\u30af\u306e\u5b9f\u884c\u3092\u542b\u3080\u3001\u30c7\u30fc\u30bf \u30ec\u30a4\u30af/\u30c7\u30fc\u30bf \u30a6\u30a7\u30a2\u30cf\u30a6\u30b9\u3068\u306e\u5bfe\u8a71\u3092\u51e6\u7406\u3057\u307e\u3059\u3002 Ray Data \u306f\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u306b GPU \u3092\u4f7f\u7528\u3057\u3066\u3001\u63a8\u8ad6\u306e\u305f\u3081\u306b\u5927\u898f\u6a21\u306a\u30e2\u30c7\u30eb\u3092\u547c\u3073\u51fa\u3059\u306a\u3069\u3001ML \u96c6\u7d04\u578b\u306e\u51e6\u7406\u3092\u51e6\u7406\u3057\u307e\u3059\u3002\u3053\u306e 2 \u3064\u306f\u5171\u6709\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8 (S3 \u4e0a\u306e Parquet \u30d5\u30a1\u30a4\u30eb) \u3092\u4ecb\u3057\u3066\u30c7\u30fc\u30bf\u3092\u4ea4\u63db\u3057\u3001\u305d\u308c\u305e\u308c\u306e\u5f79\u5272\u3092\u679c\u305f\u3057\u3001\u76f8\u4e92\u306b\u88dc\u5b8c\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#22-io","title":"2.2 \u30c7\u30fc\u30bf\u5f62\u5f0f\u3068 I/O \u306e\u6700\u9069\u5316","text":"<p>\u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u9078\u629e\u3057\u305f\u3089\u3001\u6b21\u306f\u30c7\u30fc\u30bf\u306e\u30b7\u30ea\u30a2\u30eb\u5316\u5f62\u5f0f\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u5f62\u5f0f\u306e\u9078\u629e\u306f\u6280\u8853\u7684\u306a\u8a73\u7d30\u306e\u3088\u3046\u306b\u898b\u3048\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u5b9f\u969b\u306b\u306f\u30b9\u30c8\u30ec\u30fc\u30b8 \u30b3\u30b9\u30c8\u3001\u8aad\u307f\u53d6\u308a\u901f\u5ea6\u3001\u30c4\u30fc\u30eb\u306e\u4e92\u63db\u6027\u306b\u76f4\u63a5\u5f71\u97ff\u3057\u307e\u3059\u3002\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u9593\u306e\u5727\u7e2e\u7387\u306e\u5dee\u306f 10 \u500d\u306b\u9054\u3059\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u5217\u5f62\u5f0f\u3068\u884c\u5f62\u5f0f\u306e\u30af\u30a8\u30ea\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u5dee\u306f\u540c\u69d8\u306b\u5927\u304d\u304f\u306a\u308a\u307e\u3059\u3002\u307e\u305f\u3001\u3059\u3079\u3066\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u304c\u3059\u3079\u3066\u306e\u5f62\u5f0f\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#221","title":"2.2.1 \u4e3b\u6d41\u306e\u30c7\u30fc\u30bf\u5f62\u5f0f\u306e\u6bd4\u8f03","text":"<p>Parquet \u306f\u3001\u5927\u898f\u6a21\u306a\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u306e\u4e8b\u5b9f\u4e0a\u306e\u6a19\u6e96\u3067\u3059\u3002\u3053\u308c\u306f\u5217\u578b\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u4f7f\u7528\u3057\u3066\u304a\u308a\u3001\u540c\u3058\u5217\u306e\u30c7\u30fc\u30bf\u306f\u7269\u7406\u7684\u306b\u9023\u7d9a\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30012 \u3064\u306e\u5927\u304d\u306a\u5229\u70b9\u304c\u3082\u305f\u3089\u3055\u308c\u307e\u3059\u3002\u307e\u305a\u3001\u5727\u7e2e\u304c\u5bb9\u6613\u306b\u306a\u308a\u307e\u3059\u3002\u540c\u3058\u7a2e\u985e\u306e\u30c7\u30fc\u30bf\u3092\u307e\u3068\u3081\u3066\u96c6\u3081\u308b\u3068\u3001\u3088\u308a\u9ad8\u3044\u5727\u7e2e\u7387\u304c\u5b9f\u73fe\u3057\u307e\u3059\u3002 2 \u756a\u76ee\u306b\u3001\u30d9\u30af\u30c8\u30eb\u5316\u3055\u308c\u305f\u8aad\u307f\u53d6\u308a\u304c\u5bb9\u6613\u306b\u306a\u308a\u3001\u7279\u5b9a\u306e\u5217\u3092\u30af\u30a8\u30ea\u3059\u308b\u3068\u304d\u306b\u30d5\u30a1\u30a4\u30eb\u5168\u4f53\u3092\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u5fc5\u8981\u304c\u306a\u304f\u306a\u308a\u307e\u3059\u3002 Parquet \u30d5\u30a1\u30a4\u30eb\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u306b\u30b9\u30ad\u30fc\u30de\u304c\u57cb\u3081\u8fbc\u307e\u308c\u305f\u81ea\u5df1\u8a18\u8ff0\u578b\u3067\u3042\u308a\u3001\u5916\u90e8\u30e1\u30bf\u30c7\u30fc\u30bf\u5b9a\u7fa9\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002\u307e\u305f\u3001JSON \u306e\u3088\u3046\u306a\u8907\u96d1\u306a\u69cb\u9020\u306e\u30cd\u30b9\u30c8\u3055\u308c\u305f\u578b\u3068\u30cd\u30a4\u30c6\u30a3\u30d6 \u30c7\u30a3\u30ec\u30af\u30c8\u30ea \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30cb\u30f3\u30b0\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002 Parquet \u306f\u3001\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b3\u30fc\u30d1\u30b9 \u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u7279\u306b\u5217\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3092\u5fc5\u8981\u3068\u3059\u308b\u5206\u6790\u30af\u30a8\u30ea\u306b\u63a8\u5968\u3055\u308c\u308b\u5f62\u5f0f\u3067\u3059\u3002 Spark\u3001DuckDB\u3001Pandas\u3001\u305d\u306e\u4ed6\u306e\u30c4\u30fc\u30eb\u3068\u3046\u307e\u304f\u9023\u643a\u3057\u307e\u3059\u3002</p> <p>JSONL (JSON Lines) \u3082\u4e00\u822c\u7684\u306a\u5f62\u5f0f\u3067\u3001\u5404\u884c\u306f\u72ec\u7acb\u3057\u305f JSON \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3067\u3059\u3002\u305d\u306e\u6700\u5927\u306e\u5229\u70b9\u306f\u4eba\u9593\u304c\u8aad\u307f\u3084\u3059\u3044\u3053\u3068\u3067\u3059\u3002<code>head</code>\u3001<code>cat</code>\u3001\u305d\u306e\u4ed6\u306e\u30b3\u30de\u30f3\u30c9\u3092\u4f7f\u7528\u3057\u3066\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u76f4\u63a5\u8868\u793a\u3067\u304d\u307e\u3059\u3002\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u51e6\u7406\u3082\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a\u3001\u30d5\u30a1\u30a4\u30eb\u5168\u4f53\u3092\u30e1\u30e2\u30ea\u306b\u30ed\u30fc\u30c9\u305b\u305a\u306b 1 \u884c\u305a\u3064\u8aad\u307f\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u30b9\u30ad\u30fc\u30de\u306f\u975e\u5e38\u306b\u67d4\u8edf\u3067\u3001\u5404\u884c\u306b\u7570\u306a\u308b\u30d5\u30a3\u30fc\u30eb\u30c9\u69cb\u9020\u3092\u542b\u3081\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u30bf\u30a4\u30d7\u306e\u30c7\u30fc\u30bf\u306f\u983b\u7e41\u306b\u624b\u52d5\u3067\u8868\u793a\u304a\u3088\u3073\u7de8\u96c6\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001JSONL \u306f\u7279\u306b SFT \u547d\u4ee4\u30c7\u30fc\u30bf\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002\u30c7\u30fc\u30bf\u4ea4\u63db\u3084\u5c0f\u898f\u6a21\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8 (10 GB \u672a\u6e80) \u306b\u3082\u3088\u304f\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\u305f\u3060\u3057\u3001JSONL \u306e\u6b20\u70b9\u3082\u660e\u3089\u304b\u3067\u3059\u3002\u5727\u7e2e\u3057\u306a\u3044\u3068\u5bb9\u91cf\u304c Parquet \u306e 3 \uff5e 5 \u500d\u306b\u306a\u308a\u3001\u8aad\u307f\u53d6\u308a\u901f\u5ea6\u304c\u9045\u304f\u306a\u308a\u307e\u3059 (\u5404\u884c\u306e JSON \u6587\u5b57\u5217\u3092\u89e3\u6790\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b)\u3002</p> <p>WebDataset \u306f\u3001NVIDIA \u304c\u4e3b\u5c0e\u3059\u308b\u5f62\u5f0f\u3067\u3001\u753b\u50cf\u30c6\u30ad\u30b9\u30c8\u3001\u30d3\u30c7\u30aa\u3001\u305d\u306e\u4ed6\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u7528\u306b\u7279\u5225\u306b\u8a2d\u8a08\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u305d\u306e\u4e2d\u5fc3\u3068\u306a\u308b\u30a2\u30a4\u30c7\u30a2\u306f\u3001\u95a2\u9023\u30d5\u30a1\u30a4\u30eb (1 \u3064\u306e\u753b\u50cf\u3068\u305d\u306e\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u306a\u3069) \u3092 TAR \u30a2\u30fc\u30ab\u30a4\u30d6\u306b\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u306e\u8a2d\u8a08\u306f\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u8aad\u307f\u53d6\u308a\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a\u3001\u89e3\u51cd\u305b\u305a\u306b\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u9806\u6b21\u8aad\u307f\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u307e\u305f\u3001\u5206\u6563\u51e6\u7406\u306b\u3082\u975e\u5e38\u306b\u9069\u3057\u3066\u304a\u308a\u3001\u5404 TAR \u306f\u72ec\u7acb\u3057\u305f\u30c7\u30fc\u30bf \u30b7\u30e3\u30fc\u30c9\u3067\u3059\u3002 WebDataset \u306f\u3001LAION \u30b9\u30bf\u30a4\u30eb\u306e\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u304a\u3088\u3073\u30d3\u30c7\u30aa \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u6700\u9069\u306a\u9078\u629e\u80a2\u3067\u3042\u308a\u3001\u8907\u6570\u30d5\u30a1\u30a4\u30eb\u306e\u95a2\u9023\u4ed8\u3051\u304c\u5fc5\u8981\u306a\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002</p> \u7279\u96c6 \u5bc4\u6728\u7d30\u5de5 JSONL \u30a6\u30a7\u30d6\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8\u52b9\u7387 \u9ad8 (\u30ab\u30e9\u30e0\u5727\u7e2e) \u4f4e (\u30c6\u30ad\u30b9\u30c8\u306e\u5197\u9577\u6027) \u4e2d (\u5727\u7e2e\u306a\u3057\u3060\u304c\u30b3\u30f3\u30d1\u30af\u30c8) \u8aad\u307f\u53d6\u308a\u901f\u5ea6 \u9ad8\u901f (\u30d9\u30af\u30c8\u30eb\u5316) \u9045\u3044 (\u884c\u3054\u3068\u306e\u89e3\u6790) \u4e2d (\u30b7\u30fc\u30b1\u30f3\u30b7\u30e3\u30eb\u8aad\u307f\u53d6\u308a) \u4eba\u9593\u304c\u5224\u8aad\u53ef\u80fd \u3044\u3044\u3048 \u306f\u3044 \u3044\u3044\u3048 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30b5\u30dd\u30fc\u30c8 \u5f31\u3044 (\u30a8\u30f3\u30b3\u30fc\u30c9\u304c\u5fc5\u8981) \u5f31\u3044 \u5f37\u529b (\u30cd\u30a4\u30c6\u30a3\u30d6 \u30b5\u30dd\u30fc\u30c8) \u5178\u578b\u7684\u306a\u4f7f\u7528\u4f8b \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u306e\u30c6\u30ad\u30b9\u30c8 \u30b3\u30fc\u30d1\u30b9 SFT\u547d\u4ee4\u30c7\u30fc\u30bf \u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u3001\u30d3\u30c7\u30aa \u30c7\u30fc\u30bf"},{"location":"ja/part1/1_2_data_infra/#222","title":"2.2.2 \u5727\u7e2e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u9078\u629e","text":"<p>\u5f62\u5f0f\u306e\u9078\u629e\u306b\u95a2\u4fc2\u306a\u304f\u3001\u5727\u7e2e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306f\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u30b3\u30b9\u30c8\u3068\u8aad\u307f\u53d6\u308a\u901f\u5ea6\u306b\u5927\u304d\u306a\u5f71\u97ff\u3092\u4e0e\u3048\u307e\u3059\u3002\u6b63\u3057\u3044\u5727\u7e2e\u6226\u7565\u306b\u306f\u3001\u30b9\u30da\u30fc\u30b9\u52b9\u7387\u3068\u6642\u9593\u52b9\u7387\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u898b\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>Snappy \u304c\u6700\u3082\u4e00\u822c\u7684\u306a\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u9078\u629e\u3067\u3059\u3002\u5727\u7e2e\u7387\u306f\u4e2d\u7a0b\u5ea6\u3067\u3059\u304c\u3001\u5727\u7e2e\u901f\u5ea6\u3068\u89e3\u51cd\u901f\u5ea6\u306f\u3069\u3061\u3089\u3082\u9ad8\u901f\u3067\u3001\u8aad\u307f\u53d6\u308a\u3068\u66f8\u304d\u8fbc\u307f\u306e\u30d0\u30e9\u30f3\u30b9\u304c\u53d6\u308c\u305f\u30b7\u30ca\u30ea\u30aa\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002 LZ4 \u306f\u3001\u6975\u9650\u306e\u8aad\u307f\u53d6\u308a\u901f\u5ea6\u3092\u8ffd\u6c42\u3057\u307e\u3059\u3002\u89e3\u51cd\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306f Snappy \u3088\u308a\u3082\u3055\u3089\u306b\u901f\u304f\u3001\u5727\u7e2e\u7387\u306f\u308f\u305a\u304b\u306b\u4f4e\u304f\u3001\u8aad\u307f\u53d6\u308a\u9045\u5ef6\u306b\u654f\u611f\u306a\u30b7\u30ca\u30ea\u30aa\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002 Zstandard (ZSTD) \u306f\u3001\u7279\u306b\u9ad8\u30ec\u30d9\u30eb (\u30ec\u30d9\u30eb 19 \u306a\u3069) \u3067\u6700\u9ad8\u306e\u5727\u7e2e\u7387\u3092\u63d0\u4f9b\u3057\u307e\u3059\u304c\u3001\u5727\u7e2e\u901f\u5ea6\u306f\u9045\u304f\u3001\u30b9\u30c8\u30ec\u30fc\u30b8 \u30b3\u30b9\u30c8\u306b\u654f\u611f\u306a\u30a2\u30fc\u30ab\u30a4\u30d6 \u30b7\u30ca\u30ea\u30aa\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002 Gzip \u306f\u6700\u3082\u4e92\u63db\u6027\u306e\u3042\u308b\u9078\u629e\u80a2\u3067\u3042\u308a\u3001\u307b\u307c\u3059\u3079\u3066\u306e\u30c4\u30fc\u30eb\u304c Gzip \u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a\u3001\u5916\u90e8\u30b7\u30b9\u30c6\u30e0\u3068\u306e\u30c7\u30fc\u30bf\u4ea4\u63db\u304c\u5fc5\u8981\u306a\u30b7\u30ca\u30ea\u30aa\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002</p> \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0 \u5727\u7e2e\u7387 \u5727\u7e2e\u901f\u5ea6 \u89e3\u51cd\u901f\u5ea6 \u5178\u578b\u7684\u306a\u4f7f\u7528\u4f8b \u30ad\u30d3\u30ad\u30d3 \u4e2d \u901f\u3044 \u901f\u3044 \u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u9078\u629e\u3001\u8aad\u307f\u66f8\u304d\u30d0\u30e9\u30f3\u30b9 LZ4 \u4e0b \u975e\u5e38\u306b\u901f\u3044 \u975e\u5e38\u306b\u901f\u3044 \u6975\u7aef\u306a\u8aad\u307f\u53d6\u308a\u901f\u5ea6 ZSTD \u9ad8 \u4e2d \u901f\u3044 \u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u30b3\u30b9\u30c8\u91cd\u8996 Gzip \u9ad8 \u9045\u3044 \u4e2d \u9ad8\u3044\u4e92\u63db\u6027\u8981\u4ef6 <p>\u5b9f\u969b\u306b\u306f\u3001\u968e\u5c64\u5316\u3055\u308c\u305f\u6226\u7565\u3092\u63a1\u7528\u3067\u304d\u307e\u3059\u3002\u30b3\u30fc\u30eb\u30c9 \u30c7\u30fc\u30bf (\u30a2\u30fc\u30ab\u30a4\u30d6 \u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u9577\u671f\u9593\u8aad\u307f\u53d6\u3089\u308c\u308b\u3053\u3068\u306f\u307b\u3068\u3093\u3069\u3042\u308a\u307e\u305b\u3093) \u306f\u3001\u6700\u5927\u306e\u5727\u7e2e\u7387\u3092\u5f97\u308b\u305f\u3081\u306b ZSTD \u30ec\u30d9\u30eb 19 \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u30db\u30c3\u30c8 \u30c7\u30fc\u30bf (\u983b\u7e41\u306b\u8aad\u307f\u53d6\u3089\u308c\u3001\u51e6\u7406\u3055\u308c\u308b\u30c7\u30fc\u30bf) \u306f\u3001\u89e3\u51cd\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3092\u524a\u6e1b\u3059\u308b\u305f\u3081\u306b Snappy \u307e\u305f\u306f LZ4 \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u8ee2\u9001\u30b7\u30ca\u30ea\u30aa\u3067\u306f\u3001\u5727\u7e2e\u7387\u3068\u901f\u5ea6\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u53d6\u308b\u305f\u3081\u306b ZSTD \u30ec\u30d9\u30eb 3 \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#223-io","title":"2.2.3 I/O \u6700\u9069\u5316\u306e\u5b9f\u8df5\u7684\u306a\u30d2\u30f3\u30c8","text":"<p>\u5927\u898f\u6a21\u306a\u30c7\u30fc\u30bf\u51e6\u7406\u3067\u306f\u3001I/O \u304c\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u6b21\u306e 3 \u3064\u306e\u30d2\u30f3\u30c8\u306b\u3088\u308a\u3001I/O \u52b9\u7387\u3092\u5927\u5e45\u306b\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u9069\u5207\u306a\u30d5\u30a1\u30a4\u30eb \u30b5\u30a4\u30ba\u8a2d\u5b9a\u304c\u6700\u521d\u306e\u91cd\u8981\u306a\u30dd\u30a4\u30f3\u30c8\u3067\u3059\u3002\u3088\u304f\u3042\u308b\u9593\u9055\u3044\u306f\u3001\u591a\u6570\u306e\u5c0f\u3055\u306a\u30d5\u30a1\u30a4\u30eb (\u305f\u3068\u3048\u3070\u3001\u305d\u308c\u305e\u308c 1MB \u306e\u30d5\u30a1\u30a4\u30eb\u3092 100,000 \u500b) \u3092\u751f\u6210\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u304c\u5927\u304d\u304f\u306a\u308a\u3001S3 ListObjects \u306e\u64cd\u4f5c\u304c\u975e\u5e38\u306b\u9045\u304f\u306a\u308a\u307e\u3059\u3002\u6b63\u3057\u3044\u30a2\u30d7\u30ed\u30fc\u30c1\u306f\u3001\u30c7\u30fc\u30bf\u3092\u5c11\u6570\u306e\u5927\u304d\u306a\u30d5\u30a1\u30a4\u30eb\u306b\u7d71\u5408\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u5404 Parquet \u30d5\u30a1\u30a4\u30eb\u306f 128MB \uff5e 1GB \u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u5c0f\u3055\u3059\u304e\u308b\u3068\u30e1\u30bf\u30c7\u30fc\u30bf\u304c\u80a5\u5927\u5316\u3057\u3001\u4e26\u5217\u51e6\u7406\u304c\u4e0d\u5341\u5206\u306b\u306a\u308a\u307e\u3059\u3002\u5927\u304d\u3059\u304e\u308b\u3068\u30bf\u30b9\u30af\u306e\u8ca0\u8377\u5206\u6563\u306b\u5f71\u97ff\u3057\u307e\u3059\u3002</p> <pre><code># Wrong: generate many small files\ndf.write.parquet(\"s3://bucket/data/\", maxRecordsPerFile=1000)\n\n# Correct: generate fewer large files (recommend 128MB - 1GB)\ndf.coalesce(100).write.parquet(\"s3://bucket/data/\")\n</code></pre> <p>\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30d7\u30eb\u30fc\u30cb\u30f3\u30b0\u306f 2 \u756a\u76ee\u306e\u91cd\u8981\u306a\u30d2\u30f3\u30c8\u3067\u3059\u3002\u66f8\u304d\u8fbc\u307f\u6642\u306b\u7279\u5b9a\u306e\u5217\u3067\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5206\u5272\u3059\u308b\u3053\u3068\u3067\u3001\u8aad\u307f\u53d6\u308a\u6642\u306b\u5fc5\u8981\u306a\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u307f\u3092\u30b9\u30ad\u30e3\u30f3\u3059\u308b\u3060\u3051\u3067\u6e08\u307f\u3001\u30c6\u30fc\u30d6\u30eb\u5168\u4f53\u306e\u30b9\u30ad\u30e3\u30f3\u304c\u56de\u907f\u3055\u308c\u307e\u3059\u3002\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5217\u306f\u30ab\u30fc\u30c7\u30a3\u30ca\u30ea\u30c6\u30a3\u3092\u4f4e\u304f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 (\u65e5\u4ed8\u3001\u8a00\u8a9e\u3001\u30c7\u30fc\u30bf \u30bd\u30fc\u30b9\u306a\u3069)\u3002\u30ab\u30fc\u30c7\u30a3\u30ca\u30ea\u30c6\u30a3\u306e\u9ad8\u3044\u5217 (\u30e6\u30fc\u30b6\u30fc ID \u306a\u3069) \u306f\u907f\u3051\u3066\u304f\u3060\u3055\u3044\u3002\u305d\u3046\u3057\u306a\u3044\u3068\u3001\u5927\u91cf\u306e\u5c0f\u3055\u306a\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u304c\u4f5c\u6210\u3055\u308c\u307e\u3059\u3002</p> <pre><code># Partition by date when writing\ndf.write.partitionBy(\"date\").parquet(\"s3://bucket/data/\")\n\n# Only scan needed partitions when reading\nspark.read.parquet(\"s3://bucket/data/date=2024-01-01/\")\n</code></pre> <p>\u5217\u306e\u526a\u5b9a\u306f 3 \u756a\u76ee\u306e\u30d2\u30f3\u30c8\u3067\u3059\u3002\u5217\u6307\u5411\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u6700\u5927\u306e\u5229\u70b9\u306f\u3001\u5fc5\u8981\u306a\u5217\u306e\u307f\u3092\u8aad\u307f\u53d6\u308b\u3053\u3068\u3067\u3059\u3002\u5217\u306e\u9078\u629e\u304c\u30af\u30a8\u30ea \u30b9\u30c6\u30fc\u30c8\u30e1\u30f3\u30c8\u306e\u65e9\u3044\u6bb5\u968e\u3067\u884c\u308f\u308c\u308b\u3088\u3046\u306b\u3057\u3001\u3059\u3079\u3066\u306e\u5217\u3092\u8aad\u307f\u53d6\u3063\u3066\u304b\u3089\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3059\u308b\u3053\u3068\u3092\u907f\u3051\u3066\u304f\u3060\u3055\u3044\u3002</p> <pre><code># Wrong: read all columns\ndf = spark.read.parquet(\"s3://bucket/data/\")  # If 100 columns, all loaded\n\n# Correct: only read needed columns\ndf = spark.read.parquet(\"s3://bucket/data/\").select(\"text\", \"length\")\n</code></pre> <p></p> <p>\u56f3 2-5: I/O \u6700\u9069\u5316\u52b9\u679c\u306e\u6bd4\u8f03 \u2014 \u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3 \u30d7\u30eb\u30fc\u30cb\u30f3\u30b0 + \u5217\u30d7\u30eb\u30fc\u30cb\u30f3\u30b0\u306b\u3088\u308a\u3001\u30af\u30a8\u30ea\u6642\u9593\u3092 91%\u3001\u30c7\u30fc\u30bf \u30b9\u30ad\u30e3\u30f3\u91cf\u3092 92% \u524a\u6e1b\u3067\u304d\u307e\u3059</p> <p>\u3053\u308c\u3089 3 \u3064\u306e\u30d2\u30f3\u30c8\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u200b\u200b\u3059\u308b\u3068\u3001\u30af\u30a8\u30ea\u6642\u9593\u3092 55 \u79d2\u304b\u3089 5 \u79d2\u306b\u3001\u30c7\u30fc\u30bf \u30b9\u30ad\u30e3\u30f3\u91cf\u3092 100 GB \u304b\u3089 8 GB \u306b\u77ed\u7e2e\u3067\u304d\u3001\u975e\u5e38\u306b\u5927\u304d\u306a\u52b9\u679c\u304c\u5f97\u3089\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#23-dataops","title":"2.3 \u30c7\u30fc\u30bf\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406 (DataOps)","text":"<p>\u30b3\u30fc\u30c9\u306b\u306f Git \u304c\u3042\u308a\u3001\u6a5f\u68b0\u5b66\u7fd2\u30e2\u30c7\u30eb\u306b\u306f MLflow \u304c\u3042\u308a\u307e\u3059\u3002\u3067\u306f\u3001TB \u30ec\u30d9\u30eb\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306f\u3069\u306e\u3088\u3046\u306b\u884c\u3046\u306e\u3067\u3057\u3087\u3046\u304b?\u3053\u308c\u306f\u898b\u843d\u3068\u3055\u308c\u304c\u3061\u3067\u3059\u304c\u3001LLM \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306b\u304a\u3044\u3066\u975e\u5e38\u306b\u91cd\u8981\u306a\u554f\u984c\u3067\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#231","title":"2.3.1 \u30c7\u30fc\u30bf\u306b\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u304c\u5fc5\u8981\u306a\u306e\u306f\u306a\u305c\u3067\u3059\u304b?","text":"<p>\u6b21\u306e\u30b7\u30ca\u30ea\u30aa\u3092\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u30026 \u304b\u6708\u524d\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u306f\u7279\u306b\u512a\u308c\u305f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u793a\u3057\u3001\u4e0a\u53f8\u306f\u518d\u73fe\u3092\u671b\u3093\u3067\u3044\u307e\u3059\u3002\u30b5\u30fc\u30d0\u30fc\u3092\u691c\u7d22\u3059\u308b\u3068\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u304c\u3059\u3067\u306b\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u300c\u524a\u9664\u3059\u308b\u3088\u3046\u306b\u6307\u793a\u3057\u305f\u306e\u306f\u8ab0\u3067\u3059\u304b?\u300d \u300c10TB\u3082\u304b\u304b\u308a\u307e\u3057\u305f\uff01\u300d\u30c7\u30fc\u30bf\u51e6\u7406\u30b9\u30af\u30ea\u30d7\u30c8\u306f\u307e\u3060\u5b58\u5728\u3057\u307e\u3059\u304c\u3001\u4f9d\u5b58\u3059\u308b\u30a2\u30c3\u30d7\u30b9\u30c8\u30ea\u30fc\u30e0 \u30c7\u30fc\u30bf\u306f\u5909\u66f4\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u51e6\u7406\u30d5\u30ed\u30fc\u3092\u518d\u5b9f\u884c\u3059\u308b\u3068\u3001\u7570\u306a\u308b\u7d50\u679c\u304c\u5f97\u3089\u308c\u307e\u3059\u3002\u7d50\u8ad6\uff1a\u518d\u73fe\u3067\u304d\u307e\u305b\u3093\u3002</p> <p>\u3053\u306e\u30b7\u30ca\u30ea\u30aa\u306f\u5b9f\u969b\u306e\u4ed5\u4e8b\u3067\u3082\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u30c7\u30fc\u30bf\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306f\u307e\u3055\u306b\u3053\u306e\u3088\u3046\u306a\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306b\u5b58\u5728\u3057\u307e\u3059\u3002\u305d\u306e\u4e2d\u5fc3\u7684\u306a\u4fa1\u5024\u306f\u3001\u6b21\u306e 4 \u3064\u306e\u5074\u9762\u306b\u53cd\u6620\u3055\u308c\u3066\u3044\u307e\u3059\u3002 \u518d\u73fe\u6027 - \u3044\u3064\u3067\u3082\u30c7\u30fc\u30bf\u306e\u72b6\u614b\u3092\u6b63\u78ba\u306b\u5fa9\u5143\u3057\u307e\u3059\u3002\u30c8\u30ec\u30fc\u30b5\u30d3\u30ea\u30c6\u30a3 - \u751f\u306e\u5165\u529b\u304b\u3089\u6700\u7d42\u51fa\u529b\u307e\u3067\u306e\u5b8c\u5168\u306a\u30c1\u30a7\u30fc\u30f3\u3092\u8ffd\u8de1\u3057\u307e\u3059\u3002\u30b3\u30e9\u30dc\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u5b89\u5168\u6027 - \u8907\u6570\u306e\u4eba\u304c\u540c\u6642\u306b\u30c7\u30fc\u30bf\u3092\u5909\u66f4\u3057\u3066\u3082\u7af6\u5408\u3057\u307e\u305b\u3093\u3002\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u6a5f\u80fd - \u30c7\u30fc\u30bf\u306e\u554f\u984c\u304c\u767a\u898b\u3055\u308c\u305f\u3068\u304d\u306b\u3001\u3059\u3050\u306b\u524d\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u623b\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#232-dvc-lakefs","title":"2.3.2 \u30c4\u30fc\u30eb\u306e\u9078\u629e: DVC \u3068 LakeFS","text":"<p>\u73fe\u5728\u3001\u6700\u3082\u4e3b\u6d41\u306e 2 \u3064\u306e\u30c7\u30fc\u30bf \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u30c4\u30fc\u30eb\u306f DVC \u3068 LakeFS \u3067\u3042\u308a\u3001\u8a2d\u8a08\u7406\u5ff5\u304c\u660e\u3089\u304b\u306b\u7570\u306a\u308a\u307e\u3059\u3002</p> <p>DVC (\u30c7\u30fc\u30bf \u30d0\u30fc\u30b8\u30e7\u30f3 \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb) \u306e\u8a2d\u8a08\u54f2\u5b66\u306f\u300cGit for Data\u300d\u3067\u3059\u3002\u30c7\u30fc\u30bf \u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u30a8\u30af\u30b9\u30da\u30ea\u30a8\u30f3\u30b9\u3092\u53ef\u80fd\u306a\u9650\u308a Git \u306b\u8fd1\u3065\u3051\u307e\u3059\u3002\u305d\u306e\u52d5\u4f5c\u539f\u7406: \u30c7\u30fc\u30bf \u30d5\u30a1\u30a4\u30eb\u81ea\u4f53\u306f\u30ea\u30e2\u30fc\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8 (S3/GCS) \u306b\u4fdd\u5b58\u3055\u308c\u3001Git \u30ea\u30dd\u30b8\u30c8\u30ea\u306b\u306f\u30c7\u30fc\u30bf \u30e1\u30bf\u30c7\u30fc\u30bf \u30d5\u30a1\u30a4\u30eb (<code>.dvc</code> \u30d5\u30a1\u30a4\u30eb) \u306e\u307f\u304c\u4fdd\u5b58\u3055\u308c\u3001\u5b9f\u969b\u306e\u30c7\u30fc\u30bf\u306f <code>dvc push/pull</code> \u30b3\u30de\u30f3\u30c9\u7d4c\u7531\u3067\u540c\u671f\u3055\u308c\u307e\u3059\u3002</p> <pre><code># Initialize DVC\ndvc init\n\n# Add dataset to version control\ndvc add data/training_corpus.parquet\n# Generates data/training_corpus.parquet.dvc and .gitignore\n\n# Commit to Git\ngit add data/training_corpus.parquet.dvc .gitignore\ngit commit -m \"Add training corpus v1\"\n\n# Push data to remote storage\ndvc push\n\n# Switch to historical version\ngit checkout v1_0\ndvc checkout  # Sync corresponding version data\n</code></pre> <p>DVC \u306e\u5229\u70b9\u306f\u3001\u65e2\u5b58\u306e Git \u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3068\u306e\u30b7\u30fc\u30e0\u30ec\u30b9\u306a\u7d71\u5408\u3001\u7de9\u3084\u304b\u306a\u5b66\u7fd2\u66f2\u7dda\u3001ML \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5b9a\u7fa9\u306e\u30b5\u30dd\u30fc\u30c8 (<code>dvc.yaml</code> \u7d4c\u7531) \u3067\u3042\u308a\u3001\u30d5\u30a1\u30a4\u30eb \u30ec\u30d9\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u30b7\u30ca\u30ea\u30aa\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002\u6b20\u70b9\u306f\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3054\u3068\u306b\u500b\u5225\u306e <code>.dvc</code> \u30d5\u30a1\u30a4\u30eb\u7ba1\u7406\u304c\u5fc5\u8981\u3067\u3042\u308a\u3001\u304d\u3081\u306e\u7d30\u304b\u3044\u300c\u30c6\u30fc\u30d6\u30eb\u30ec\u30d9\u30eb\u300d\u64cd\u4f5c (\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306e\u30ed\u30fc\u30eb\u30d0\u30c3\u30af\u306a\u3069) \u304c\u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u306a\u3044\u3053\u3068\u3067\u3059\u3002</p> <p>LakeFS \u306e\u8a2d\u8a08\u54f2\u5b66\u306f\u300cGit for Data Lake\u300d\u3067\u3059\u3002\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8\u4e0a\u306b Git \u30b9\u30bf\u30a4\u30eb\u306e\u30d6\u30e9\u30f3\u30c1\u3068\u30b3\u30df\u30c3\u30c8\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u305d\u306e\u52d5\u4f5c\u539f\u7406: LakeFS \u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8 \u30d7\u30ed\u30ad\u30b7 \u30ec\u30a4\u30e4\u30fc\u3068\u3057\u3066\u6a5f\u80fd\u3057\u3001\u3059\u3079\u3066\u306e\u8aad\u307f\u53d6\u308a/\u66f8\u304d\u8fbc\u307f\u30ea\u30af\u30a8\u30b9\u30c8\u306f LakeFS S3 \u30b2\u30fc\u30c8\u30a6\u30a7\u30a4\u3092\u7d4c\u7531\u3057\u3001\u30b7\u30b9\u30c6\u30e0\u306f\u30d6\u30e9\u30f3\u30c1\u3001\u30b3\u30df\u30c3\u30c8\u3001\u30de\u30fc\u30b8\u3001\u304a\u3088\u3073\u305d\u306e\u4ed6\u306e Git \u30b9\u30bf\u30a4\u30eb\u306e\u64cd\u4f5c\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002</p> <pre><code># Create development branch\nlakectl branch create lakefs://repo/dev --source lakefs://repo/main\n\n# Modify data on dev branch (via S3 protocol)\naws s3 cp new_data.parquet s3://lakefs-repo/dev/data/\n\n# Commit changes\nlakectl commit lakefs://repo/dev -m \"Add new training data\"\n\n# Merge to main branch after validation\nlakectl merge lakefs://repo/dev lakefs://repo/main\n</code></pre> <p>LakeFS \u306e\u4e3b\u306a\u5229\u70b9\u306f\u30bc\u30ed\u30b3\u30d4\u30fc \u30d6\u30e9\u30f3\u30c1\u30f3\u30b0\u3067\u3059\u3002\u30d6\u30e9\u30f3\u30c1\u306e\u4f5c\u6210\u3067\u306f\u30c7\u30fc\u30bf\u306f\u30b3\u30d4\u30fc\u3055\u308c\u305a\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u307f\u304c\u8a18\u9332\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306f TB \u30ec\u30d9\u30eb\u306e\u30c7\u30fc\u30bf \u30ec\u30a4\u30af\u306b\u3068\u3063\u3066\u91cd\u8981\u3067\u3059\u3002 S3 \u3068\u5b8c\u5168\u306b\u4e92\u63db\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u65e2\u5b58\u306e\u30c4\u30fc\u30eb (Spark/Ray) \u306f\u5909\u66f4\u305b\u305a\u306b\u52d5\u4f5c\u3057\u307e\u3059\u3002\u6b20\u70b9\u306f\u3001\u8ffd\u52a0\u30b5\u30fc\u30d3\u30b9 (LakeFS \u30b5\u30fc\u30d0\u30fc) \u306e\u30c7\u30d7\u30ed\u30a4\u30e1\u30f3\u30c8\u304c\u5fc5\u8981\u3067\u3042\u308a\u3001DVC \u3088\u308a\u3082\u5b66\u7fd2\u66f2\u7dda\u304c\u308f\u305a\u304b\u306b\u6025\u3067\u3042\u308b\u3053\u3068\u3067\u3059\u3002</p> \u7279\u96c6 DVC \u30ec\u30a4\u30afFS \u8a2d\u8a08\u54f2\u5b66 \u30c7\u30fc\u30bf\u7528\u306e Git \u62e1\u5f35\u6a5f\u80fd \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u30ec\u30a4\u30e4\u30fc \u7c92\u5ea6 \u30d5\u30a1\u30a4\u30eb\u30ec\u30d9\u30eb \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u30ec\u30d9\u30eb (\u3088\u308a\u7d30\u304b\u3044) \u30d6\u30e9\u30f3\u30c1\u306e\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9 .dvc \u30d5\u30a1\u30a4\u30eb\u3092\u30b3\u30d4\u30fc\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 \u30bc\u30ed\u30b3\u30d4\u30fc S3 \u306e\u4e92\u63db\u6027 dvc \u30b3\u30de\u30f3\u30c9\u304c\u5fc5\u8981\u3067\u3059 \u30cd\u30a4\u30c6\u30a3\u30d6 S3 API \u5c55\u958b\u306e\u8907\u96d1\u3055 \u4f4e (CLI \u30c4\u30fc\u30eb) \u4e2d (\u30b5\u30fc\u30d0\u30fc\u304c\u5fc5\u8981) \u9069\u5207\u306a\u30b7\u30ca\u30ea\u30aa ML \u5b9f\u9a13\u7ba1\u7406\u3001\u5c0f\u898f\u6a21\u30c7\u30fc\u30bf \u30c7\u30fc\u30bf \u30ec\u30a4\u30af\u7ba1\u7406\u3001\u5927\u898f\u6a21\u30c7\u30fc\u30bf <p></p> <p>\u56f3 2-6: DVC \u3068 LakeFS \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u6bd4\u8f03 \u2014 DVC \u306f Git \u306b\u57fa\u3065\u3044\u305f\u30d5\u30a1\u30a4\u30eb \u30ec\u30d9\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3092\u63d0\u4f9b\u3057\u3001LakeFS \u306f\u5206\u5c90\u3092\u5099\u3048\u305f\u30bc\u30ed\u30b3\u30d4\u30fc\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30ec\u30d9\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3092\u63d0\u4f9b\u3057\u307e\u3059</p> <p>\u9078\u629e\u306e\u63a8\u5968\u4e8b\u9805\u306f\u975e\u5e38\u306b\u660e\u78ba\u3067\u3059\u3002\u30c7\u30fc\u30bf\u91cf\u304c 1 TB \u672a\u6e80\u306e\u5834\u5408\u3001\u4e3b\u306b ML \u5b9f\u9a13\u7ba1\u7406\u306e\u305f\u3081\u306e Git \u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u306b\u7cbe\u901a\u3057\u3066\u3044\u308b\u30c1\u30fc\u30e0\u306f DVC \u3092\u9078\u629e\u3057\u307e\u3059\u3002\u30c7\u30fc\u30bf\u91cf\u304c TB \u30ec\u30d9\u30eb\u4ee5\u4e0a\u3067\u3001\u30c7\u30fc\u30bf \u30ec\u30a4\u30af \u30ec\u30d9\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u304c\u5fc5\u8981\u3067\u3001\u8907\u6570\u306e\u30c1\u30fc\u30e0\u304c\u4e26\u884c\u3057\u3066\u52d5\u4f5c\u3059\u308b\u5834\u5408\u306f\u3001LakeFS \u3092\u9078\u629e\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#233","title":"2.3.3 \u30c7\u30fc\u30bf\u30ea\u30cd\u30fc\u30b8\u306e\u8ffd\u8de1","text":"<p>\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306f\u300c\u30c7\u30fc\u30bf\u3068\u306f\u4f55\u304b\u300d\u3092\u89e3\u6c7a\u3057\u307e\u3059\u3002\u30ea\u30cd\u30fc\u30b8\u8ffd\u8de1\u306f\u3001\u300c\u30c7\u30fc\u30bf\u304c\u3069\u3053\u304b\u3089\u6765\u305f\u306e\u304b\u300d\u3092\u89e3\u6c7a\u3057\u307e\u3059\u3002\u7cfb\u7d71\u8ffd\u8de1\u30ec\u30b3\u30fc\u30c9: \u3053\u306e\u30c7\u30fc\u30bf\u306f\u3069\u306e\u4e0a\u6d41\u30c7\u30fc\u30bf\u304b\u3089\u5f97\u3089\u308c\u305f\u3082\u306e\u3067\u3059\u304b?\u3069\u306e\u3088\u3046\u306a\u51e6\u7406\u30b9\u30af\u30ea\u30d7\u30c8\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u4f7f\u7528\u3055\u308c\u307e\u3057\u305f\u304b?\u3044\u3064\u3001\u8ab0\u306b\u3088\u3063\u3066\u51e6\u7406\u304c\u5b9f\u884c\u3055\u308c\u305f\u306e\u304b?</p> <p>\u30ea\u30cd\u30fc\u30b8\u8ffd\u8de1\u3092\u5b9f\u88c5\u3059\u308b\u306b\u306f\u8907\u6570\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u304c\u3042\u308a\u307e\u3059\u3002 Spark \u3092\u4f7f\u7528\u3057\u3066\u3044\u308b\u5834\u5408\u3001OpenLineage \u7d71\u5408\u3092\u901a\u3058\u3066\u81ea\u52d5\u30ea\u30cd\u30fc\u30b8\u8ffd\u8de1\u3092\u53d6\u5f97\u3067\u304d\u307e\u3059\u3002 Airflow \u306a\u3069\u306e\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3 \u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u306f\u3001Marquez \u304c\u9069\u3057\u3066\u3044\u307e\u3059\u3002\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba \u30c7\u30fc\u30bf \u30ac\u30d0\u30ca\u30f3\u30b9\u306e\u30cb\u30fc\u30ba\u306b\u5bfe\u3057\u3066\u3001DataHub \u3068 Apache Atlas \u306f\u3088\u308a\u5b8c\u5168\u306a\u6a5f\u80fd\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u5358\u7d14\u306a\u30b7\u30ca\u30ea\u30aa\u306e\u5834\u5408\u3001\u30e1\u30bf\u30c7\u30fc\u30bf \u30d5\u30a1\u30a4\u30eb\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u624b\u52d5\u30a4\u30f3\u30b9\u30c8\u30eb\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u306f\u8efd\u91cf\u306a\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u3067\u3059\u3002</p> <pre><code>import json\nfrom datetime import datetime\n\nmetadata = {\n    \"version\": \"v2_0\",\n    \"created_at\": datetime.now().isoformat(),\n    \"created_by\": \"data-pipeline-v3_2\",\n    \"inputs\": [\n        {\"path\": \"s3://bucket/raw/crawl_2024_01.parquet\", \"version\": \"abc123\"},\n        {\"path\": \"s3://bucket/raw/crawl_2024_02.parquet\", \"version\": \"def456\"}\n    ],\n    \"processing\": {\n        \"script\": \"cleaning_pipeline.py\",\n        \"git_commit\": \"789xyz\",\n        \"params\": {\"min_length\": 100, \"dedup_threshold\": 0.9}\n    },\n    \"outputs\": [\n        {\"path\": \"s3://bucket/processed/clean_2024_q1.parquet\", \"records\": 1000000}\n    ]\n}\n\nwith open(\"clean_2024_q1.metadata.json\", \"w\") as f:\n    json.dump(metadata, f, indent=2)\n</code></pre>"},{"location":"ja/part1/1_2_data_infra/#24","title":"2.4 \u3088\u304f\u3042\u308b\u9593\u9055\u3044\u3068\u843d\u3068\u3057\u7a74\u30ac\u30a4\u30c9","text":"<p>\u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u9078\u629e\u30d7\u30ed\u30bb\u30b9\u3067\u306f\u3001\u7d4c\u9a13\u8c4a\u5bcc\u306a\u30a8\u30f3\u30b8\u30cb\u30a2\u3067\u3082\u3044\u304f\u3064\u304b\u306e\u5178\u578b\u7684\u306a\u9593\u9055\u3044\u3092\u72af\u3057\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001\u8aad\u8005\u304c\u6ce8\u610f\u3057\u3066\u3044\u305f\u3060\u3051\u308b\u3053\u3068\u3092\u9858\u3063\u3066\u3001\u6700\u3082\u4e00\u822c\u7684\u306a 3 \u3064\u306e\u554f\u984c\u3092\u8981\u7d04\u3057\u307e\u3059\u3002</p> <p>\u6700\u521d\u306e\u3088\u304f\u3042\u308b\u9593\u9055\u3044\u306f\u3001\u6642\u671f\u5c1a\u65e9\u306a\u6700\u9069\u5316\u3068\u904e\u5270\u306a\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3067\u3059\u3002 \u30c1\u30fc\u30e0\u306b\u3088\u3063\u3066\u306f\u30015 \u4eba\u306e\u30e1\u30f3\u30d0\u30fc\u3068 500 GB \u306e\u30c7\u30fc\u30bf\u3057\u304b\u6301\u305f\u306a\u3044\u306b\u3082\u304b\u304b\u308f\u3089\u305a\u3001Spark \u30af\u30e9\u30b9\u30bf\u30fc + Iceberg + Airflow + LakeFS \u306e\u300c\u30d5\u30eb\u30b9\u30bf\u30c3\u30af\u300d\u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u3092\u69cb\u7bc9\u3057\u3066\u3044\u307e\u3059\u3002\u7d50\u679c: \u6642\u9593\u306e 80% \u304c\u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u4fdd\u5b88\u306b\u8cbb\u3084\u3055\u308c\u3001\u5b9f\u969b\u306e\u30c7\u30fc\u30bf\u51e6\u7406\u306b\u306f 20% \u306e\u307f\u304c\u8cbb\u3084\u3055\u308c\u307e\u3057\u305f\u3002\u6b63\u3057\u3044\u30a2\u30d7\u30ed\u30fc\u30c1\u306f\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u59cb\u3081\u3066\u3001\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u9032\u5316\u3055\u305b\u308b\u3053\u3068\u3067\u3059\u3002 500 GB \u306e\u30c7\u30fc\u30bf \u30dc\u30ea\u30e5\u30fc\u30e0\u306e\u5834\u5408\u3001\u5358\u4e00\u30de\u30b7\u30f3 + Parquet + DVC \u3067\u5b8c\u5168\u306b\u5341\u5206\u3067\u3059\u3002\u30c7\u30fc\u30bf\u91cf\u304c 10TB \u306b\u5897\u52a0\u3057\u305f\u5834\u5408\u306f\u3001\u5206\u6563\u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>2 \u756a\u76ee\u306b\u3088\u304f\u3042\u308b\u9593\u9055\u3044\u306f\u3001\u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3092\u7121\u8996\u3057\u3066\u76f2\u76ee\u7684\u306b\u65b0\u3057\u3044\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u3092\u8ffd\u3044\u6c42\u3081\u308b\u3053\u3068\u3067\u3059\u3002 \u4e00\u90e8\u306e\u30c1\u30fc\u30e0\u306f\u3001\u3044\u304f\u3064\u304b\u306e\u30d6\u30ed\u30b0\u6295\u7a3f\u3092\u8aad\u3093\u3067\u3001Ray \u306e\u305f\u3081\u306b Spark \u3092\u5b8c\u5168\u306b\u653e\u68c4\u3059\u308b\u3053\u3068\u3092\u6c7a\u5b9a\u3057\u307e\u3057\u305f\u304c\u3001\u4f1a\u793e\u306e Hive \u30c6\u30fc\u30d6\u30eb\u3068 Iceberg \u30c6\u30fc\u30d6\u30eb\u304c\u76f4\u63a5\u8aad\u307f\u53d6\u308c\u306a\u3044\u3053\u3068\u306b\u6c17\u3065\u304d\u307e\u3057\u305f\u3002\u6700\u5f8c\u306b\u3001\u5b9f\u8cea\u7684\u306a\u30c7\u30fc\u30bf\u5909\u63db\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u30c7\u30fc\u30bf\u6574\u5408\u6027\u306e\u30ea\u30b9\u30af\u304c\u5897\u5927\u3057\u307e\u3059\u3002\u6b63\u3057\u3044\u30a2\u30d7\u30ed\u30fc\u30c1\u306f\u3001\u6280\u8853\u7684\u306a\u9078\u629e\u306e\u524d\u306b\u3001\u65e2\u5b58\u306e\u30c7\u30fc\u30bf\u8cc7\u7523\u3068\u4e0a\u6d41\u3068\u4e0b\u6d41\u306e\u4f9d\u5b58\u95a2\u4fc2\u3092\u5b8c\u5168\u306b\u8a55\u4fa1\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u6280\u8853\u7684\u306a\u9078\u629e\u306f\u5358\u4e00\u70b9\u306e\u6c7a\u5b9a\u3067\u306f\u306a\u304f\u3001\u30b7\u30b9\u30c6\u30e0 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3067\u3042\u308a\u3001\u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u5168\u4f53\u306e\u4e92\u63db\u6027\u3092\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>3 \u756a\u76ee\u306e\u3088\u304f\u3042\u308b\u9593\u9055\u3044\u306f\u3001\u904e\u5ea6\u306b\u7a4d\u6975\u7684\u306a\u30b9\u30c8\u30ec\u30fc\u30b8 \u30b3\u30b9\u30c8\u306e\u6700\u9069\u5316\u3067\u3059\u3002 \u4e00\u90e8\u306e\u30c1\u30fc\u30e0\u306f\u3001\u30b9\u30c8\u30ec\u30fc\u30b8 \u30b3\u30b9\u30c8\u3092\u7bc0\u7d04\u3059\u308b\u305f\u3081\u306b\u3001\u3059\u3079\u3066\u306e\u30c7\u30fc\u30bf\u3092 ZSTD \u30ec\u30d9\u30eb 22 \u306b\u5727\u7e2e\u3057\u3001S3 Glacier Deep Archive \u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\u7d50\u679c: \u30c7\u30fc\u30bf\u3092\u8aad\u307f\u53d6\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3073\u306b\u3001\u89e3\u51cd\u307e\u3067 12 \u6642\u9593\u5f85\u6a5f\u3057\u3001\u89e3\u51cd\u306b\u306f\u3055\u3089\u306b 4 \u6642\u9593\u304b\u304b\u308a\u307e\u3059\u3002\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306f 1 \u9031\u9593\u524d\u306b\u30b9\u30b1\u30b8\u30e5\u30fc\u30eb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u6b63\u3057\u3044\u30a2\u30d7\u30ed\u30fc\u30c1\u306f\u3001\u30b3\u30fc\u30eb\u30c9 \u30c7\u30fc\u30bf\u3068\u30db\u30c3\u30c8 \u30c7\u30fc\u30bf\u3092\u533a\u5225\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u30a2\u30af\u30c6\u30a3\u30d6\u306b\u51e6\u7406\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306f\u3001S3 Standard + Snappy \u5727\u7e2e\u3067\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002 6 \u304b\u6708\u4ee5\u4e0a\u4f7f\u7528\u3055\u308c\u306a\u304b\u3063\u305f\u30a2\u30fc\u30ab\u30a4\u30d6 \u30c7\u30fc\u30bf\u306f Glacier \u306b\u9001\u3089\u308c\u307e\u3059\u3002\u30b9\u30c8\u30ec\u30fc\u30b8 \u30b3\u30b9\u30c8\u3068\u30a2\u30af\u30bb\u30b9\u52b9\u7387\u306e\u30d0\u30e9\u30f3\u30b9 \u30dd\u30a4\u30f3\u30c8\u3092\u898b\u3064\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#25","title":"2.5 \u7ae0\u306e\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001LLM \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u306e\u9078\u629e\u306b\u3064\u3044\u3066\u7cfb\u7d71\u7684\u306b\u7d39\u4ecb\u3057\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3001\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3068\u3044\u3046 4 \u3064\u306e\u4e2d\u6838\u7684\u306a\u5074\u9762\u3092\u30ab\u30d0\u30fc\u3057\u307e\u3057\u305f\u3002</p> <p>\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u9078\u629e: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8 (S3/MinIO) \u306f\u6700\u65b0\u306e\u30c7\u30fc\u30bf \u30b9\u30bf\u30c3\u30af\u306e\u57fa\u76e4\u3067\u3059\u3002\u30c7\u30fc\u30bf \u30ec\u30a4\u30af \u30d5\u30a9\u30fc\u30de\u30c3\u30c8 (Iceberg/Hudi/Delta) \u306f\u3001ACID \u30c8\u30e9\u30f3\u30b6\u30af\u30b7\u30e7\u30f3\u3001\u30bf\u30a4\u30e0\u30c8\u30e9\u30d9\u30eb\u3001\u305d\u306e\u4ed6\u306e\u554f\u984c\u3092\u89e3\u6c7a\u3057\u307e\u3059\u3002 LLM \u30b7\u30ca\u30ea\u30aa\u306e\u5834\u5408\u3001Iceberg \u306f\u30a8\u30f3\u30b8\u30f3\u306e\u4e2d\u7acb\u6027\u304c\u6700\u3082\u512a\u308c\u3066\u3044\u308b\u305f\u3081\u3001S3 + Iceberg \u306e\u7d44\u307f\u5408\u308f\u305b\u304c\u63a8\u5968\u3055\u308c\u307e\u3059\u3002</p> <p>\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u9078\u629e: Spark \u306f\u6210\u719f\u5ea6\u3068\u5b89\u5b9a\u6027\u3001\u5f37\u529b\u306a SQL \u30a8\u30b3\u30b7\u30b9\u30c6\u30e0\u3067\u77e5\u3089\u308c\u3066\u304a\u308a\u3001\u5f93\u6765\u306e\u30d3\u30c3\u30b0 \u30c7\u30fc\u30bf \u30c1\u30fc\u30e0\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002 Ray Data \u306f\u3001Python \u30cd\u30a4\u30c6\u30a3\u30d6\u306e AI \u30d5\u30ec\u30f3\u30c9\u30ea\u30fc\u306a\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3042\u308a\u3001ML/AI \u30c1\u30fc\u30e0\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e 2 \u3064\u306f\u76f8\u4e92\u306b\u6392\u4ed6\u7684\u3067\u306f\u306a\u304f\u3001\u6df7\u5408\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002Spark \u306f ETL \u3092\u51e6\u7406\u3057\u3001Ray \u306f ML \u51e6\u7406\u3092\u51e6\u7406\u3057\u307e\u3059\u3002</p> <p>\u30c7\u30fc\u30bf\u5f62\u5f0f: Parquet \u306f\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u3067\u3042\u308a\u3001JSONL \u306f\u624b\u52d5\u8868\u793a\u304c\u5fc5\u8981\u306a\u5c0f\u898f\u6a21\u30c7\u30fc\u30bf\u306b\u9069\u3057\u3066\u304a\u308a\u3001WebDataset \u306f\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u306b\u6700\u9069\u306a\u5f62\u5f0f\u3067\u3059\u3002\u5727\u7e2e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068 I/O \u6700\u9069\u5316\u306e\u30d2\u30f3\u30c8\u306f\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3068\u30b3\u30b9\u30c8\u306b\u5927\u304d\u306a\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306e\u5834\u5408: DVC \u306f\u8efd\u91cf\u3067 Git \u3068\u7dca\u5bc6\u306b\u7d71\u5408\u3055\u308c\u3066\u3044\u308b\u305f\u3081\u3001ML \u5b9f\u9a13\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002 LakeFS \u306f\u3001\u5927\u898f\u6a21\u306a\u904b\u7528\u74b0\u5883\u306b\u9069\u3057\u305f\u30c7\u30fc\u30bf \u30ec\u30a4\u30af \u30ec\u30d9\u30eb\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p> <p>\u5168\u4f53\u3092\u901a\u3057\u3066\u306e\u57fa\u672c\u539f\u5247\u306f\u3001\u30b7\u30f3\u30d7\u30eb\u306b\u958b\u59cb\u3057\u3001\u8981\u6c42\u306b\u5fdc\u3058\u3066\u9032\u5316\u3055\u305b\u3001\u904e\u5270\u306a\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3092\u907f\u3051\u308b\u3053\u3068\u3067\u3059\u3002\u6280\u8853\u7684\u306a\u9078\u629e\u306f\u3001\u305d\u308c\u81ea\u4f53\u306e\u305f\u3081\u306b\u6280\u8853\u306e\u9032\u6b69\u3092\u8ffd\u6c42\u3059\u308b\u3082\u306e\u3067\u306f\u306a\u304f\u3001\u30d3\u30b8\u30cd\u30b9\u76ee\u6a19\u306b\u304b\u306a\u3046\u3082\u306e\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p></p> <p>\u56f3 2-7: \u30c7\u30fc\u30bf \u30a4\u30f3\u30d5\u30e9\u30b9\u30c8\u30e9\u30af\u30c1\u30e3\u9078\u629e\u306e\u30af\u30a4\u30c3\u30af \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9 \u2014 \u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u30c6\u30fc\u30d6\u30eb\u5f62\u5f0f\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u304a\u3088\u3073\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u306b\u95a2\u3059\u308b 4 \u8c61\u9650\u306e\u610f\u601d\u6c7a\u5b9a\u30ac\u30a4\u30c9</p>"},{"location":"ja/part1/1_2_data_infra/#_3","title":"\u3055\u3089\u306b\u8aad\u3080","text":"<p>\u3053\u306e\u7ae0\u306e\u5185\u5bb9\u306b\u3064\u3044\u3066\u7406\u89e3\u3092\u6df1\u3081\u305f\u3044\u8aad\u8005\u306f\u3001\u6b21\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53c2\u7167\u3059\u308b\u4fa1\u5024\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>Ray Data \u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (docs.ray.io) \u306b\u306f\u3001Ray Data \u306e\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3068\u8a73\u7d30\u306a API \u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u304c\u8a18\u8f09\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Apache Iceberg \u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (iceberg.apache.org) \u306b\u306f\u3001\u30c6\u30fc\u30d6\u30eb\u5f62\u5f0f\u306e\u8a73\u7d30\u306a\u4ed5\u69d8\u3068\u30a8\u30f3\u30b8\u30f3\u7d71\u5408\u30ac\u30a4\u30c9\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002 DVC \u516c\u5f0f\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb (dvc.org/doc) \u306f\u3001\u30af\u30a4\u30c3\u30af\u30b9\u30bf\u30fc\u30c8\u306e\u826f\u3044\u51fa\u767a\u70b9\u3067\u3059\u3002 LakeFS \u306e\u516c\u5f0f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (docs.lakefs.io) \u3067\u306f\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u8a2d\u8a08\u3068\u5c55\u958b\u306e\u30aa\u30d7\u30b7\u30e7\u30f3\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u8aac\u660e\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>Databricks \u304c\u516c\u958b\u3057\u305f\u30c7\u30fc\u30bf \u30ec\u30a4\u30af\u9078\u629e\u306b\u95a2\u3059\u308b\u30db\u30ef\u30a4\u30c8 \u30da\u30fc\u30d1\u30fc\u3067\u306f\u3001Delta\u3001Iceberg\u3001Hudi \u5f62\u5f0f\u306e\u8a73\u7d30\u306a\u6bd4\u8f03\u5206\u6790\u304c\u63d0\u4f9b\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Uber \u304c\u516c\u958b\u3057\u305f\u300cScaling MLOps at Uber\u300d\u8a18\u4e8b\u3067\u306f\u3001PB \u898f\u6a21\u3067 ML \u30c7\u30fc\u30bf\u3092\u7ba1\u7406\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u8cc7\u6599\u306f\u3001\u8aad\u8005\u304c\u3088\u308a\u5305\u62ec\u7684\u306a\u6280\u8853\u7684\u89b3\u70b9\u3092\u69cb\u7bc9\u3059\u308b\u306e\u306b\u5f79\u7acb\u3061\u307e\u3059\u3002</p>"},{"location":"ja/part1/1_2_data_infra/#_4","title":"\u6b21\u306e\u7ae0\u306e\u30d7\u30ec\u30d3\u30e5\u30fc","text":"<p>\u6b21\u306e\u7ae0 \u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u3068\u53ce\u96c6 \u3067\u306f\u3001\u6b63\u5f0f\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u306e\u30c7\u30fc\u30bf\u51e6\u7406\u30d5\u30ed\u30fc\u306b\u5165\u308a\u307e\u3059\u3002 Common Crawl \u3084 The Pile \u306a\u3069\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u53d6\u5f97\u3057\u3066\u89e3\u6790\u3059\u308b\u65b9\u6cd5\u3001Trafilatura \u3092\u4f7f\u7528\u3057\u3066\u9ad8\u6027\u80fd Web \u30da\u30fc\u30b8 \u30d1\u30fc\u30b5\u30fc\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3001GitHub \u3084 ArXiv \u304b\u3089\u30b3\u30fc\u30c9\u3084\u8ad6\u6587\u3092\u30af\u30ed\u30fc\u30eb\u3059\u308b\u305f\u3081\u306e\u7279\u6b8a\u306a\u6226\u7565\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u3053\u306e\u8cea\u554f\u3092\u6b21\u306e\u7ae0\u306b\u53d6\u308a\u5165\u308c\u3066\u304f\u3060\u3055\u3044\u3002Common Crawl \u306f\u6bce\u6708 3 \uff5e 5 PB \u306e\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u305d\u3053\u304b\u3089\u5fc5\u8981\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u52b9\u7387\u7684\u306b\u62bd\u51fa\u3059\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u3067\u3059\u304b?</p>"},{"location":"ja/part2/2_1_data_acquisition/","title":"\u7b2c3\u7ae0: \u30c7\u30fc\u30bf\u53d6\u5f97\u3068\u53ce\u96c6","text":""},{"location":"ja/part2/2_1_data_acquisition/#6","title":"\u7b2c 6 \u7ae0: \u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u306e\u51e6\u7406","text":""},{"location":"ja/part2/2_1_data_acquisition/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u6b21\u4e16\u4ee3\u306e\u57fa\u76e4\u30e2\u30c7\u30eb\u3092\u69cb\u7bc9\u3059\u308b\u969b\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u7126\u70b9\u306f\u3001\u5358\u7d14\u306a\u30c6\u30ad\u30b9\u30c8\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u304b\u3089\u3001\u7269\u7406\u4e16\u754c\u304b\u3089\u306e\u591a\u6b21\u5143\u4fe1\u53f7\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u3001\u4f4d\u7f6e\u5408\u308f\u305b\u3001\u304a\u3088\u3073\u518d\u69cb\u7bc9\u3078\u3068\u79fb\u308a\u307e\u3057\u305f\u3002\u8a00\u8a9e\u30e2\u30c7\u30eb \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u304c\u300c\u30ce\u30a4\u30ba\u9664\u53bb\u300d\u306b\u95a2\u3059\u308b\u3082\u306e\u3067\u3042\u308c\u3070\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306f\u300c\u76f8\u95a2\u300d\u3068\u300c\u8abf\u6574\u300d\u306b\u95a2\u3059\u308b\u3082\u306e\u3067\u3059\u3002 GPT-4V\u3001Gemini\u3001Sora \u306e\u51fa\u73fe\u306b\u3088\u308a\u3001\u79c1\u305f\u3061\u306f\u5358\u4e00\u30e2\u30c0\u30ea\u30c6\u30a3 \u30c7\u30fc\u30bf\u3067\u306f\u3082\u306f\u3084\u4e16\u754c\u3092\u7406\u89e3\u3057\u305f\u3044\u3068\u3044\u3046\u30e2\u30c7\u30eb\u306e\u6b32\u6c42\u3092\u6e80\u305f\u3059\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3053\u3068\u306b\u6c17\u3065\u304d\u307e\u3057\u305f\u3002</p> <p>\u3053\u306e\u7ae0\u3067\u306f\u300110 \u5104\u898f\u6a21\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u5b8c\u5168\u306a\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u8a73\u7d30\u306a\u5206\u6790\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u753b\u50cf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u305f\u3081\u306e\u3044\u304f\u3064\u304b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8a18\u8ff0\u3059\u308b\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af \u30d7\u30ed\u30c8\u30b3\u30eb\u3001\u5206\u6563\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u7570\u7a2e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u7f8e\u7684\u8a55\u4fa1\u3092\u542b\u3080\u5305\u62ec\u7684\u306a\u30ad\u30e3\u30f3\u30da\u30fc\u30f3\u3067\u3059\u3002\u30c7\u30fc\u30bf \u30d1\u30e9\u30c0\u30a4\u30e0\u306e\u57fa\u790e\u3068\u306a\u308b\u30ed\u30b8\u30c3\u30af\u3092\u8abf\u67fb\u3057\u3001\u5206\u6563\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u4f7f\u7528\u3057\u3066\u5927\u898f\u6a21\u306a\u753b\u50cf\u306e\u9ad8\u540c\u6642\u53d6\u5f97\u306e\u8ab2\u984c\u3092\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3092\u5206\u6790\u3057\u3001GPU \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2 \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u6d3b\u7528\u3057\u3066\u753b\u50cf\u524d\u51e6\u7406\u306e I/O \u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u7a81\u7834\u3057\u307e\u3059\u3002\u3055\u3089\u306b\u3001\u610f\u5473\u8ad6\u7684\u304a\u3088\u3073\u7f8e\u7684\u57fa\u6e96\u306b\u57fa\u3065\u3044\u3066\u81ea\u52d5\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30eb\u30fc\u30d7\u3092\u69cb\u7bc9\u3057\u3001\u30e2\u30c7\u30eb\u306b\u4f9b\u7d66\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306e\u95a2\u9023\u6027\u3068\u5b89\u5168\u6027\u306e\u4e21\u65b9\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002</p> <p>\u5b66\u7fd2\u76ee\u6a19: * LAION-5B (\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2) \u304a\u3088\u3073 OBELICS (\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8) \u30d1\u30e9\u30c0\u30a4\u30e0\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u5229\u70b9\u3068\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u8ab2\u984c\u3092\u6df1\u304f\u7406\u89e3\u3057\u3001\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9 \u30c7\u30fc\u30bf\u6226\u7565\u306e\u8a2d\u8a08\u65b9\u6cd5\u3092\u7fd2\u5f97\u3057\u307e\u3059\u3002 * PySpark \u3068 Ray Data \u306b\u57fa\u3065\u3044\u3066\u5206\u6563\u30c0\u30a6\u30f3\u30ed\u30fc\u30c0\u30fc\u3092\u4f5c\u6210\u3057\u3001DNS \u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3068\u30ed\u30f3\u30b0\u30c6\u30fc\u30eb \u30ec\u30a4\u30c6\u30f3\u30b7\u30fc\u3092\u51e6\u7406\u3057\u300110,000 \u753b\u50cf/\u79d2\u4ee5\u4e0a\u306e\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u9054\u6210\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 * NVIDIA DALI \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8a2d\u8a08\u3092\u30de\u30b9\u30bf\u30fc\u3057\u3001CPU \u30c7\u30b3\u30fc\u30c9\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u89e3\u6c7a\u3057\u3001GPU Direct \u30b3\u30f3\u30bb\u30d7\u30c8\u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u3092\u6700\u9069\u5316\u3057\u307e\u3059\u3002 * CLIP \u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u5be9\u7f8e\u7684\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u3001\u5b89\u5168\u6027\u691c\u51fa\u3092\u542b\u3080\u591a\u6bb5\u968e\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d5\u30a1\u30cd\u30eb\u3092\u69cb\u7bc9\u3057\u3001\u3055\u307e\u3056\u307e\u306a\u30d3\u30b8\u30cd\u30b9 \u30b7\u30ca\u30ea\u30aa\u306b\u5408\u308f\u305b\u305f\u3057\u304d\u3044\u5024\u8abf\u6574\u6226\u7565\u3092\u30de\u30b9\u30bf\u30fc\u3057\u307e\u3059\u3002</p> <p>\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb:</p> <p>\u300c\u6b21\u306e\u30b7\u30ca\u30ea\u30aa\u3092\u60f3\u50cf\u3057\u3066\u307f\u3066\u304f\u3060\u3055\u3044\u3002\u3042\u306a\u305f\u306e\u30af\u30ed\u30fc\u30e9 \u30c1\u30fc\u30e0\u306f\u3001Common Crawl \u304b\u3089 20 \u5104\u306e\u751f\u306e URL \u3092\u62bd\u51fa\u3057\u3001\u6570\u5343\u306e Parquet \u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3057\u307e\u3057\u305f\u3002\u3042\u306a\u305f\u306e\u30bf\u30b9\u30af\u306f\u3001\u3053\u306e\u30c7\u30fc\u30bf\u3092 2 \u9031\u9593\u4ee5\u5185\u306b GPT-4V \u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u9069\u3057\u305f\u9ad8\u54c1\u8cea\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u5358\u4e00\u30de\u30b7\u30f3\u4e0a\u3067\u5f93\u6765\u306e Python \u30ea\u30af\u30a8\u30b9\u30c8 \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u7528\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u63a8\u5b9a\u6642\u9593\u306f\u9a5a\u7570\u306e 15 \u5e74\u3067\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u53e4\u5178\u7684\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af I/O \u30d6\u30ed\u30c3\u30af\u554f\u984c\u3067\u3059\u3002\u3055\u3089\u306b\u60aa\u3044\u3053\u3068\u306b\u3001\u4e88\u5099\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u306b\u3088\u308a\u3001\u6b21\u306e\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u305f\u753b\u50cf\u306e 30% \u306f\u96fb\u5b50\u5546\u53d6\u5f15\u5e83\u544a (\u30ce\u30a4\u30ba\u3060\u3089\u3051)\u300115% \u306b\u306f\u6df1\u523b\u306a NSFW \u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u542b\u307e\u308c\u3066\u304a\u308a\u3001\u3053\u306e\u30c7\u30fc\u30bf\u3092\u76f4\u63a5\u4f7f\u7528\u3059\u308b\u3068\u3001\u6570\u767e\u4e07\u30c9\u30eb\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u7121\u99c4\u306b\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u304c\u7981\u6b62\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u6cd5\u7684\u30ea\u30b9\u30af\u306b\u76f4\u9762\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u8ab2\u984c\u306b\u5bfe\u51e6\u3059\u308b\u306b\u306f\u3001\u7523\u696d\u30b0\u30ec\u30fc\u30c9\u306e\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30c8\u306a\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002\u300d</p>"},{"location":"ja/part2/2_1_data_acquisition/#61-laion-5b-obelicsmmc4","title":"6.1 \u30c7\u30fc\u30bf\u30d1\u30e9\u30c0\u30a4\u30e0: \u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2 (LAION-5B) \u3068\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (OBELICS/MMC4)","text":"<p>\u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u8a2d\u8a08\u3059\u308b\u524d\u306b\u3001\u79c1\u305f\u3061\u306e\u6700\u521d\u306e\u8cac\u4efb\u306f\u3001\u30c7\u30fc\u30bf\u306e\u7d44\u7e54\u5f62\u5f0f\u3092\u660e\u78ba\u306b\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u306f\u30b9\u30c8\u30ec\u30fc\u30b8\u69cb\u9020\u306b\u95a2\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u76ee\u7684\u3068\u4e0b\u6d41\u30e2\u30c7\u30eb\u306e\u5275\u767a\u7684\u306a\u6a5f\u80fd\u3082\u76f4\u63a5\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u7570\u306a\u308b\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f\u3001\u672c\u8cea\u7684\u306b\u3001\u300c\u77e5\u8b58\u304c\u4e16\u754c\u306b\u3069\u306e\u3088\u3046\u306b\u5b58\u5728\u3059\u308b\u304b\u300d\u306e\u7570\u306a\u308b\u62bd\u8c61\u5316\u3067\u3059\u3002</p>"},{"location":"ja/part2/2_1_data_acquisition/#611","title":"6.1.1 \u4e2d\u5fc3\u3068\u306a\u308b\u6982\u5ff5\u3068\u539f\u5247","text":"<p>\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2 CLIP\u3001ALIGN\u3001LAION-5B \u306b\u4ee3\u8868\u3055\u308c\u308b\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u5b66\u7fd2\u306e\u57fa\u790e\u3067\u3059\u3002 * \u7406\u8ad6\u7684\u5206\u6790: \u3053\u306e\u30d1\u30e9\u30c0\u30a4\u30e0\u306f\u3001\u753b\u50cf \\(I\\) \u3068\u30c6\u30ad\u30b9\u30c8 \\(T\\) \u306e\u9593\u306b\u5f37\u3044\u610f\u5473\u7684\u76f8\u95a2\u95a2\u4fc2\u304c\u3042\u308a\u3001\u3053\u306e\u76f8\u95a2\u95a2\u4fc2\u306f\u72ec\u7acb\u3057\u3066\u3044\u3066\u539f\u5b50\u7684\u3067\u3042\u308b\u3068\u4eee\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002\u901a\u5e38\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u76ee\u7684\u306f\u3001\u5171\u6709Embedding\u7a7a\u9593\u3067 \\(I\\) \u3068 \\(T\\) \u306e\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\u3092\u6700\u5927\u5316\u3059\u308b\u3053\u3068\u3067\u3059 (\u5bfe\u7167\u5b66\u7fd2)\u3002\u305d\u306e\u5229\u70b9\u306f\u3001\u975e\u5e38\u306b\u9ad8\u3044\u300c\u4fe1\u53f7\u5bfe\u30ce\u30a4\u30ba\u6bd4\u300d\u306e\u6539\u826f\u306e\u53ef\u80fd\u6027\u3067\u3059\u3002\u5bfe\u7167\u5b66\u7fd2\u3092\u901a\u3058\u3066\u3001\u30e2\u30c7\u30eb\u306f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8a9e\u5f59\u306e\u9593\u306e\u76f4\u63a5\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u5b66\u7fd2\u3067\u304d\u307e\u3059\u3002 * \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u89b3\u70b9: \u30c7\u30fc\u30bf\u69cb\u9020\u306f\u5358\u7d14\u3067\u3001\u901a\u5e38\u306f <code>(url, caption, metadata)</code> \u306e\u30d5\u30e9\u30c3\u30c8\u5316\u3055\u308c\u305f\u30ec\u30b3\u30fc\u30c9\u3068\u3057\u3066\u8868\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30c7\u30fc\u30bf\u306f\u3001\u30b7\u30e3\u30fc\u30c7\u30a3\u30f3\u30b0\u3084\u30e9\u30f3\u30c0\u30e0 \u30b7\u30e3\u30c3\u30d5\u30eb\u304c\u975e\u5e38\u306b\u7c21\u5358\u3067\u3059\u3002\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306b\u3001\u30b5\u30f3\u30d7\u30eb\u306e\u72ec\u7acb\u6027\u306b\u3088\u308a\u3001\u30b0\u30ed\u30fc\u30d0\u30eb \u30d0\u30c3\u30c1 \u30b7\u30e3\u30c3\u30d5\u30ea\u30f3\u30b0\u3092\u7c21\u5358\u306b\u5b9f\u88c5\u3057\u3066\u3001\u5bfe\u6bd4\u5b66\u7fd2\u306e\u52b9\u679c\u3092\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u306f\u3001OBELICS \u3084 MMC4 \u306b\u4ee3\u8868\u3055\u308c\u308b\u3001\u65b0\u4e16\u4ee3\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u5927\u578b\u30e2\u30c7\u30eb (Flamingo\u3001GPT-4V\u3001MM1 \u306a\u3069) \u306e\u91cd\u8981\u306a\u71c3\u6599\u3067\u3059\u3002 * \u7406\u8ad6\u5206\u6790: \u3053\u306e\u30d1\u30e9\u30c0\u30a4\u30e0\u306f\u3001<code>&lt;text&gt;, &lt;image&gt;, &lt;text&gt;...</code> \u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3068\u3057\u3066\u8868\u793a\u3055\u308c\u308b\u30c7\u30fc\u30bf\u3068\u3068\u3082\u306b\u3001Web \u30da\u30fc\u30b8\u306e\u5143\u306e DOM \u69cb\u9020\u9806\u5e8f\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30e2\u30c7\u30eb\u306f\u300c\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u4f9d\u5b58\u95a2\u4fc2\u300d(\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30a4\u30f3\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u5b66\u7fd2) \u3092\u5b66\u7fd2\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300c\u30b1\u30fc\u30ad\u306e\u4f5c\u308a\u65b9\u300dWeb \u30da\u30fc\u30b8\u3067\u306f\u3001\u6700\u521d\u306e\u753b\u50cf (\u6750\u6599) \u3068 5 \u756a\u76ee\u306e\u753b\u50cf (\u6700\u7d42\u88fd\u54c1) \u306e\u95a2\u4fc2\u3001\u304a\u3088\u3073\u5468\u56f2\u306e\u30c6\u30ad\u30b9\u30c8\u3068\u306e\u8ad6\u7406\u7684\u63a5\u7d9a\u306f\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u3067\u306f\u63d0\u4f9b\u3067\u304d\u307e\u305b\u3093\u3002\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u304c\u6df7\u5728\u3057\u305f\u6587\u66f8\u3092\u4eba\u9593\u304c\u8aad\u3080\u8a8d\u77e5\u30d7\u30ed\u30bb\u30b9\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\u3057\u307e\u3059\u3002 * \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u89b3\u70b9: \u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306f\u975e\u5e38\u306b\u8907\u96d1\u3067\u3059\u3002\u5358\u4e00\u306e\u30b5\u30f3\u30d7\u30eb (\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8) \u306f\u53ef\u5909\u9577\u3067\u3042\u308a\u3001\u8907\u6570\u306e\u753b\u50cf\u304c\u542b\u307e\u308c\u308b\u5834\u5408\u304c\u3042\u308b\u305f\u3081\u3001\u30d0\u30c3\u30c1\u306e\u7d44\u307f\u7acb\u3066\u304c\u56f0\u96e3\u306b\u306a\u308a\u307e\u3059\u3002\u5f93\u6765\u306e Collat\u200b\u200bor \u3067\u306f\u3001\u8907\u96d1\u306a\u30d1\u30c7\u30a3\u30f3\u30b0\u6226\u7565\u304c\u5fc5\u8981\u3067\u3059\u3002\u3055\u3089\u306b\u3001\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306e\u969b\u306b\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u6574\u5408\u6027\u3092\u7dad\u6301\u3059\u308b\u3088\u3046\u306b\u6ce8\u610f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4f4e\u54c1\u8cea\u306e\u753b\u50cf\u3092\u6063\u610f\u7684\u306b\u524a\u9664\u3059\u308b\u3068\u3001\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8 \u30ed\u30b8\u30c3\u30af\u304c\u58ca\u308c\u3001\u30e2\u30c7\u30eb\u304c\u8aa4\u3063\u305f\u53c2\u7167\u95a2\u4fc2\u3092\u5b66\u7fd2\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_1_data_acquisition/#612","title":"6.1.2 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u4e0a\u306e\u6c7a\u5b9a: \u30d1\u30e9\u30c0\u30a4\u30e0\u6bd4\u8f03\u8868","text":"<p>\u30ea\u30bd\u30fc\u30b9\u304c\u9650\u3089\u308c\u3066\u3044\u308b\u4e2d\u3067\u3001\u3053\u308c\u3089 2 \u3064\u306e\u30c7\u30fc\u30bf \u30d1\u30e9\u30c0\u30a4\u30e0\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u3069\u306e\u3088\u3046\u306b\u3068\u308c\u3070\u3088\u3044\u306e\u3067\u3057\u3087\u3046\u304b?\u3053\u308c\u306f\u5358\u7d14\u306a\u4e8c\u8005\u629e\u4e00\u3067\u306f\u306a\u304f\u3001\u30e2\u30c7\u30eb \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b3\u30b9\u30c8\u3001\u6700\u7d42\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u30b7\u30ca\u30ea\u30aa\u306e\u9593\u306e\u6df1\u3044\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5\u304c\u95a2\u4fc2\u3057\u307e\u3059\u3002</p> <p>\u521d\u671f\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u7814\u7a76 (2021 \u5e74\u4ee5\u524d) \u3067\u306f\u3001\u30e2\u30c7\u30eb\u304c\u3059\u3079\u3066\u3092\u5b66\u7fd2\u3059\u308b\u306b\u306f\u5341\u5206\u306a\u30c7\u30fc\u30bf\u91cf (CLIP \u306e 4 \u5104\u30da\u30a2\u306a\u3069) \u304c\u3042\u308c\u3070\u5341\u5206\u3067\u3042\u308b\u3068\u696d\u754c\u306f\u5e83\u304f\u4fe1\u3058\u3066\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001GPT-4V \u306e\u51fa\u73fe\u306b\u3088\u308a\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u306e\u307f\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u306f\u3001\u300c\u3053\u308c\u306f\u732b\u3067\u3042\u308b\u300d\u3092\u6b63\u78ba\u306b\u8b58\u5225\u3067\u304d\u308b\u4e00\u65b9\u3067\u3001\u8ad6\u7406\u7684\u63a8\u8ad6\u306e\u305f\u3081\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u6b20\u5982\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u300c\u753b\u50cf\u5185\u306e\u3053\u306e\u732b\u304c\u4f55\u3092\u3059\u308b\u306e\u304b\u300d\u306b\u306f\u7b54\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\u9006\u306b\u3001\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u30ed\u30b8\u30c3\u30af\u304c\u8c4a\u5bcc\u3067\u3059\u304c\u3001\u30c7\u30fc\u30bf\u304c\u307e\u3070\u3089\u3067\u3001\u51e6\u7406\u30b3\u30b9\u30c8\u304c\u975e\u5e38\u306b\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>\u4ee5\u4e0b\u306e\u8868\u306f\u3001\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5\u30ec\u30d9\u30eb\u3067\u306e 2 \u3064\u306e\u30d1\u30e9\u30c0\u30a4\u30e0\u9593\u306e\u4e3b\u306a\u9055\u3044\u3092\u6bd4\u8f03\u3057\u3066\u304a\u308a\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c8\u304c\u5b9f\u969b\u306e\u8981\u4ef6\u306b\u57fa\u3065\u3044\u3066\u6280\u8853\u7684\u306a\u9078\u629e\u3092\u884c\u3046\u306e\u306b\u5f79\u7acb\u3061\u307e\u3059\u3002</p> \u5bf8\u6cd5 \u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2 (LAION \u30b9\u30bf\u30a4\u30eb) \u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u30c9\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (OBELICS \u30b9\u30bf\u30a4\u30eb) \u5fb9\u5e95\u3057\u305f\u5206\u6790\u3068\u63a8\u5968\u4e8b\u9805 \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u76ee\u7684 \u5bfe\u7167\u5b66\u7fd2 (CLIP)\u3001\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u753b\u50cf\u3078 (\u5b89\u5b9a\u62e1\u6563) \u6b21\u306e\u30c8\u30fc\u30af\u30f3\u306e\u4e88\u6e2c\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u30c0\u30a4\u30a2\u30ed\u30b0 (GPT-4V) \u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u6226\u7565\u304c\u6700\u5584\u7b56\u3067\u3059\u3002\u7814\u7a76\u306b\u3088\u308b\u3068\u3001\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u307f\u3092\u4f7f\u7528\u3057\u3066\u30d3\u30b8\u30e5\u30a2\u30eb \u30a8\u30f3\u30b3\u30fc\u30c0\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u306e\u306f\u975e\u52b9\u7387\u7684 (\u753b\u50cf\u306e\u5bc6\u5ea6\u304c\u5341\u5206\u3067\u306a\u3044) \u304c\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u306e\u307f\u3092\u4f7f\u7528\u3059\u308b\u3068\u63a8\u8ad6\u80fd\u529b\u304c\u4e0d\u8db3\u3059\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u3066\u3044\u307e\u3059\u3002\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2\u6226\u7565\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 \u30c7\u30fc\u30bf \u30bd\u30fc\u30b9\u306e\u89e3\u6790 \u30b7\u30f3\u30d7\u30eb: <code>&lt;img&gt;</code> \u30bf\u30b0\u3068\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u62bd\u51fa\u3059\u308b\u3060\u3051\u3067\u3059\u3002\u8907\u96d1: DOM \u30c4\u30ea\u30fc\u3092\u89e3\u6790\u3057\u3001\u5e83\u544a/\u30b5\u30a4\u30c9\u30d0\u30fc\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u3001\u30e1\u30a4\u30f3 \u30b3\u30f3\u30c6\u30f3\u30c4 \u30ed\u30b8\u30c3\u30af\u3092\u4fdd\u6301\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u8907\u96d1\u3055\u306b\u95a2\u3059\u308b\u8b66\u544a\u3002\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u306b\u306f\u3001\u975e\u5e38\u306b\u8907\u96d1\u306a HTML \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0 \u30ed\u30b8\u30c3\u30af\u3092\u51e6\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5168\u4f53\u3092\u6700\u521d\u304b\u3089\u518d\u30af\u30ea\u30fc\u30f3\u3057\u3088\u3046\u3068\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u6700\u521d\u306f Common Crawl \u306e WET \u30d5\u30a1\u30a4\u30eb\u3092\u69cb\u7bc9\u306b\u4f7f\u7528\u3059\u308b\u304b\u3001OBELICS \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u62e1\u5f35\u306b\u76f4\u63a5\u4f7f\u7528\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 \u4fdd\u7ba1\u30b3\u30b9\u30c8 \u4e2d: \u30e1\u30bf\u30c7\u30fc\u30bf\u306f CSV/Parquet \u306e\u307f\u3001\u753b\u50cf\u306f\u500b\u5225\u306b\u4fdd\u5b58 \u9ad8: \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u30c8\u30dd\u30ed\u30b8\u3092\u4fdd\u5b58\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001WebDataset \u307e\u305f\u306f TFRecord \u3092\u63a8\u5968\u3057\u307e\u3059\u3002 I/O \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3002\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5834\u5408\u3001\u5c0f\u3055\u306a\u30d5\u30a1\u30a4\u30eb\u306e\u65ad\u7247\u5316\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001\u30b7\u30e3\u30fc\u30c9 \u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u8aad\u307f\u53d6\u308a\u306b\u306f\u6587\u66f8\u5168\u4f53\u3092\u4e8b\u524d\u306b\u8aad\u307f\u53d6\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u30e1\u30e2\u30ea\u5e2f\u57df\u5e45\u306e\u8981\u6c42\u304c\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002 \u6e05\u6383\u306e\u8ab2\u984c \u30dd\u30a4\u30f3\u30c8\u3054\u3068: \u5404\u753b\u50cf\u306f\u72ec\u7acb\u3057\u3066\u5224\u65ad\u3055\u308c\u3001\u4e26\u5217\u5316\u304c\u5bb9\u6613 \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8: \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30ed\u30b8\u30c3\u30af\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u4e00\u8cab\u6027\u3068\u753b\u8cea\u3092\u540c\u6642\u306b\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u6226\u7565\u306e\u9078\u629e\u3002\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u51e6\u7406\u3059\u308b\u3068\u304d\u306b\u3001\u753b\u50cf\u304c NSFW \u3067\u3042\u308b\u3068\u307f\u306a\u3055\u308c\u308b\u5834\u5408\u306f\u3001\u4f4d\u7f6eEmbedding\u306e\u7cbe\u5ea6\u3092\u7dad\u6301\u3059\u308b\u305f\u3081\u306b\u3001\u753b\u50cf\u3092\u76f4\u63a5\u524a\u9664\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u7279\u5225\u306a <code>&lt;BLOCKED_IMAGE&gt;</code> \u30c8\u30fc\u30af\u30f3\u306b\u7f6e\u304d\u63db\u3048\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 \u30e2\u30c7\u30eb\u306e\u30e1\u30ea\u30c3\u30c8 \u975e\u5e38\u306b\u5f37\u529b\u306a\u8996\u899a\u3068\u610f\u5473\u306e\u6574\u5408\u6027\u3001\u5f37\u529b\u306a\u30bc\u30ed\u30b7\u30e7\u30c3\u30c8\u5206\u985e \u5f37\u529b\u306a\u5c11\u6570\u30b7\u30e7\u30c3\u30c8\u5b66\u7fd2\u3001\u30de\u30eb\u30c1\u30bf\u30fc\u30f3\u5bfe\u8a71\u3068\u8ad6\u7406\u7684\u63a8\u8ad6\u3092\u30b5\u30dd\u30fc\u30c8 \u30d3\u30b8\u30cd\u30b9\u6307\u5411\u3002\u30b7\u30ca\u30ea\u30aa\u304c\u300c\u753b\u50cf\u691c\u7d22\u300d\u306e\u5834\u5408\u306f\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u3067\u5341\u5206\u3067\u3059\u3002\u30d3\u30b8\u30cd\u30b9\u306b\u8907\u96d1\u306a\u6587\u66f8\u306e\u7406\u89e3 (\u8abf\u67fb\u30ec\u30dd\u30fc\u30c8\u306e\u5206\u6790\u3001\u9577\u7de8\u30b9\u30c8\u30fc\u30ea\u30fc\u306e\u751f\u6210\u306a\u3069) \u304c\u542b\u307e\u308c\u308b\u5834\u5408\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u6587\u66f8\u3092\u5c0e\u5165\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 <p>\u30d2\u30f3\u30c8: MM1 \u3084 Idefics2 \u306e\u3088\u3046\u306a\u6700\u5148\u7aef\u306e\u7814\u7a76\u3067\u306f\u3001\u3069\u3061\u3089\u304b\u3092\u9078\u629e\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u6df7\u5408\u3059\u308b\u3053\u3068\u304c\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3067\u3059\u3002\u901a\u5e38\u300120% \u306e\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u6df7\u5408\u3057\u306a\u304c\u3089\u3001\u5f37\u56fa\u306a\u8996\u899a\u8a00\u8a9e\u30de\u30c3\u30d4\u30f3\u30b0\u57fa\u76e4\u3092\u78ba\u7acb\u3059\u308b\u305f\u3081\u306b\u3001\u521d\u671f\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6bb5\u968e\u3067 80% \u306e\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u63a8\u5968\u3055\u308c\u307e\u3059\u3002\u5f8c\u671f\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6bb5\u968e (\u30a2\u30cb\u30fc\u30ea\u30f3\u30b0\u6bb5\u968e) \u3067\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5272\u5408\u3092\u5927\u5e45\u306b\u5897\u3084\u3057\u3066\u3001\u30e2\u30c7\u30eb\u306e\u30ed\u30f3\u30b0\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u63a8\u8ad6\u80fd\u529b\u3092\u523a\u6fc0\u3057\u307e\u3059\u3002\u3053\u306e\u300c\u57fa\u76e4\u304c\u5148\u3001\u30ed\u30b8\u30c3\u30af\u306f\u5f8c\u300d\u6226\u7565\u306b\u3088\u308a\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u4f7f\u7528\u7387\u304c\u6700\u5927\u5316\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_1_data_acquisition/#62","title":"6.2 \u753b\u50cf\u306e\u53d6\u5f97\u3068\u524d\u51e6\u7406","text":"<p>\u30c7\u30fc\u30bf \u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u304c\u6c7a\u5b9a\u3057\u305f\u3089\u3001\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u306f\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304a\u3088\u3073\u524d\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u306f\u5178\u578b\u7684\u306a I/O \u96c6\u4e2d\u578b\u306e\u30bf\u30b9\u30af\u3067\u3042\u308a\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5e2f\u57df\u5e45\u3001DNS \u89e3\u6c7a\u306e\u9045\u5ef6\u3001\u304a\u3088\u3073\u5927\u91cf\u306e\u5c0f\u3055\u306a\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30a3\u30b9\u30af\u66f8\u304d\u8fbc\u307f\u306b\u4e3b\u306a\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_1_data_acquisition/#621-img2dataset","title":"6.2.1 img2dataset \u306e\u9ad8\u540c\u6642\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306e\u5b9f\u969b","text":"<p><code>img2dataset</code> \u306f\u73fe\u5728\u3001\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3067\u8a8d\u3081\u3089\u308c\u305f\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9 \u30c4\u30fc\u30eb\u3067\u3059\u3002\u3053\u308c\u306f\u5358\u306a\u308b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9 \u30b9\u30af\u30ea\u30d7\u30c8\u3067\u306f\u306a\u304f\u3001MapReduce \u306e\u539f\u5247\u306b\u57fa\u3065\u3044\u305f\u5206\u6563\u30c7\u30fc\u30bf\u51e6\u7406\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3059\u3002</p> <p>\u5358\u7d14\u306a <code>requests.get</code> \u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u5c02\u7528\u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3059\u308b\u7406\u7531\u306f\u4f55\u3067\u3057\u3087\u3046\u304b?\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u74b0\u5883\u304c\u975e\u5e38\u306b\u53b3\u3057\u3044\u305f\u3081\u3002\u30ea\u30f3\u30af\u306e\u6709\u52b9\u671f\u9650\u304c\u5207\u308c\uff08\u30ea\u30f3\u30af \u30ed\u30c3\u30c8\uff09\u3001\u30b5\u30fc\u30d0\u30fc\u306e\u30ec\u30fc\u30c8\u5236\u9650\u304c\u767a\u751f\u3057\u3001DNS \u304c\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u306b\u306a\u308a\u307e\u3059\u3002\u6570\u5341\u5104\u306e URL \u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3001\u308f\u305a\u304b\u306a\u30ed\u30f3\u30b0\u30c6\u30fc\u30eb\u9045\u5ef6\u304c\u6570\u9031\u9593\u306e\u6642\u9593\u30b3\u30b9\u30c8\u306b\u5897\u5e45\u3055\u308c\u307e\u3059\u3002</p> <p>\u4e2d\u5fc3\u539f\u5247: 1. \u30b7\u30e3\u30fc\u30c7\u30a3\u30f3\u30b0: 10 \u5104\u306e URL \u3092\u6570\u4e07\u306e\u5c0f\u3055\u306a\u30bf\u30b9\u30af (\u30b7\u30e3\u30fc\u30c9) \u306b\u5206\u5272\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u5206\u6563\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u57fa\u790e\u3067\u3059\u3002 2. \u975e\u540c\u671f I/O: Python \u306e aiohttp \u307e\u305f\u306f Go \u306e\u30b4\u30eb\u30fc\u30c1\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001\u30b3\u30a2\u3054\u3068\u306b\u6570\u767e\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af \u30ea\u30af\u30a8\u30b9\u30c8\u3092\u540c\u6642\u306b\u958b\u59cb\u3057\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u9045\u5ef6\u3092\u30de\u30b9\u30af\u3057\u307e\u3059\u3002 3. \u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0 \u30a2\u30fc\u30ab\u30a4\u30d6: \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u305f\u30a4\u30e1\u30fc\u30b8\u306f\u30c7\u30a3\u30b9\u30af\u306b\u66f8\u304d\u8fbc\u307e\u308c\u307e\u305b\u3093\u3002\u3053\u308c\u3089\u306f\u30e1\u30e2\u30ea\u5185\u3067 tar \u30d1\u30c3\u30b1\u30fc\u30b8 (WebDataset \u5f62\u5f0f) \u306b\u76f4\u63a5\u30a2\u30bb\u30f3\u30d6\u30eb\u3055\u308c\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8 (S3/HDFS) \u306b\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30011 \u3064\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f55\u767e\u4e07\u3082\u306e\u5c0f\u3055\u306a\u30d5\u30a1\u30a4\u30eb\u3092\u4f5c\u6210\u3059\u308b\u3068\u304d\u306b\u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u306e i \u30ce\u30fc\u30c9\u304c\u4f7f\u3044\u679c\u305f\u3055\u308c\u308b\u3053\u3068\u304c\u306a\u304f\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u521d\u5fc3\u8005\u304c\u3088\u304f\u906d\u9047\u3059\u308b\u843d\u3068\u3057\u7a74\u3067\u3059\u3002</p> <p>\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5: PySpark \u5206\u6563\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9 \u30b9\u30af\u30ea\u30d7\u30c8</p> <p>PB \u30b9\u30b1\u30fc\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3001\u5358\u4e00\u30de\u30b7\u30f3\u306e\u30de\u30eb\u30c1\u51e6\u7406\u30e2\u30fc\u30c9\u3067\u306f\u4e0d\u5341\u5206\u3067\u3059\u3002 Spark \u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <pre><code># Recommended environment: PySpark 3_2+, img2dataset 1_41+\n# Run command: spark-submit --master yarn --deploy-mode cluster...\n\nfrom img2dataset import download\nimport shutil\nimport os\n\ndef run_distributed_download():\n    \"\"\"\n    Configuration tuning is key to throughput.\n    process_count: Number of processes per Spark Executor.\n    thread_count: Number of async threads per process.\n    For nodes with 10Gbps NIC, typically recommend total_concurrency around 1000.\n    \"\"\"\n\n    # Define output path (S3 or HDFS)\n    output_dir = \"s3a://multimodal-lake/raw-images/laion-5b-subset\"\n\n    # Clean old data (use with caution, production recommends versioning)\n    if os.path.exists(output_dir): \n        # shutil.rmtree(output_dir) # Dangerous operation, commented out\n        pass\n\n    download(\n        processes_count=4,          # 4 CPU cores per node\n        thread_count=64,            # 64 download threads per core\n        url_list=\"s3a://multimodal-lake/meta/laion-urls.parquet\",\n        image_size=256,             # 256x256 sufficient for pre-training, saves bandwidth\n        resize_only_if_bigger=True, # Avoid blur from upscaling small images\n        resize_mode=\"keep_ratio\",   # Maintain aspect ratio, pad or center crop\n        skip_reencode=True,         # If original is JPG and size suitable, store directly, saves CPU\n        output_folder=output_dir,\n        output_format=\"webdataset\", # Force WebDataset format\n        input_format=\"parquet\",\n        url_col=\"url\",\n        caption_col=\"caption\",\n        enable_wandb=True,          # Strongly recommended for monitoring download rate and error rate\n        number_sample_per_shard=10000, # 10k images per tar, ~200-300MB, easy to transfer\n        distributor=\"pyspark\",      # Use Spark for task distribution\n        save_additional_columns=[\"similarity\", \"hash\"], # Preserve original metadata\n        timeout=10                  # Short timeout, fail fast, long-tail requests not worth waiting\n    )\n\nif __name__ == \"__main__\":\n    # Initialize Spark Session (usually handled by spark-submit, but declare explicitly for IDE debugging)\n    from pyspark.sql import SparkSession\n    spark = SparkSession.builder \\\n        .appName(\"Img2Dataset-Production\") \\\n        .config(\"spark.executor.memory\", \"8g\") \\\n        .config(\"spark.task.maxFailures\", \"10\") \\\n        .getOrCreate()\n\n    run_distributed_download()\n</code></pre> <p>\u30d7\u30ed\u306e\u30d2\u30f3\u30c8: * DNS \u30ad\u30e3\u30c3\u30b7\u30e5: \u540c\u6642\u5b9f\u884c\u6027\u304c\u9ad8\u3044\u5834\u5408\u3001DNS \u89e3\u6c7a\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u3063\u305f\u308a\u3001\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u306b\u3088\u3063\u3066\u30d6\u30ed\u30c3\u30af\u3055\u308c\u305f\u308a\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30ed\u30fc\u30ab\u30eb DNS \u30ad\u30e3\u30c3\u30b7\u30e5 (\u4f8b: dnsmasq) \u3092\u30ef\u30fc\u30ab\u30fc \u30ce\u30fc\u30c9\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u304b\u3001\u30b3\u30fc\u30c9\u3067\u30c9\u30e1\u30a4\u30f3\u304b\u3089 IP \u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 \u30c6\u30fc\u30d6\u30eb\u3092\u7dad\u6301\u3057\u307e\u3059\u3002 * \u30e6\u30fc\u30b6\u30fc \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3: \u300c\u516c\u7136\u306e\u300d\u79d8\u5bc6\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u30e6\u30fc\u30b6\u30fc \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u3068 403 Forbidden \u306e\u5272\u5408\u3092\u6e1b\u3089\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 * \u30a8\u30e9\u30fc\u51e6\u7406: WandB \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067 success_rate \u3092\u76e3\u8996\u3057\u307e\u3059\u3002 80% \u3092\u4e0b\u56de\u308b\u5834\u5408\u306f\u3001\u901a\u5e38\u3001URL \u30ea\u30b9\u30c8\u304c\u975e\u5e38\u306b\u53e4\u3044\u304b\u3001IP \u30d7\u30fc\u30eb\u304c\u6c5a\u67d3\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_1_data_acquisition/#622","title":"6.2.2 \u8996\u899a\u7684\u306a\u524d\u51e6\u7406\u306e\u843d\u3068\u3057\u7a74: \u30c8\u30ea\u30df\u30f3\u30b0\u3068\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af \u30a2\u30e9\u30a4\u30f3\u30e1\u30f3\u30c8","text":"<p>\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u306e\u53d6\u5f97 (\u30d0\u30a4\u30c8\u306e\u53d6\u5f97) \u3068\u3044\u3046\u8ab2\u984c\u3092\u89e3\u6c7a\u3057\u305f\u5f8c\u3001\u3059\u3050\u306b 2 \u756a\u76ee\u306e\u8ab2\u984c\u3001\u30c7\u30fc\u30bf\u306e\u4f7f\u3044\u3084\u3059\u3055\u306b\u76f4\u9762\u3057\u307e\u3059\u3002\u751f\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u753b\u50cf\u306e\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u306f\u5927\u304d\u304f\u7570\u306a\u308a\u307e\u3059\u304c\u3001\u30e2\u30c7\u30eb\u3067\u306f\u901a\u5e38\u3001\u56fa\u5b9a\u89e3\u50cf\u5ea6\u306e\u5165\u529b (\u4f8b: 224x224 \u307e\u305f\u306f 512x512) \u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u521d\u5fc3\u8005\u5411\u3051\u306e\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u591a\u304f\u306f\u3001\u6b21\u5143\u3092\u7d71\u4e00\u3059\u308b\u305f\u3081\u306b\u7dcf\u5f53\u305f\u308a\u7684\u306a\u30e9\u30f3\u30c0\u30e0\u524d\u51e6\u7406\u3092\u7fd2\u6163\u7684\u306b\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u304c\u30e2\u30c7\u30eb\u306e\u300c\u76ee\u306b\u898b\u3048\u306a\u3044\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u4e0a\u9650\u300d\u306e\u6839\u672c\u3067\u3042\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002 \u300c\u30a4\u30e1\u30fc\u30b8\u3092\u53d6\u308a\u8fbc\u3080\u300d\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u300c\u4f55\u304c\u5165\u308c\u3089\u308c\u3066\u3044\u308b\u304b\u300d\u306b\u3082\u7126\u70b9\u3092\u5f53\u3066\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002</p> <p> \u56f3 6-1: \u753b\u50cf\u306e\u524d\u51e6\u7406\u306b\u304a\u3051\u308b\u30c8\u30ea\u30df\u30f3\u30b0\u3068\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8</p> <ul> <li> <p>\u60aa\u3044\u30b1\u30fc\u30b9 (\u5de6 - \u6a5f\u68b0\u7684\u30c8\u30ea\u30df\u30f3\u30b0\u306e\u30b3\u30b9\u30c8):     \u5f93\u6765\u306e <code>RandomCrop</code> \u307e\u305f\u306f <code>CenterCrop</code> \u306f\u69cb\u6210\u3092\u8a8d\u8b58\u3057\u307e\u305b\u3093\u3002\u7e26\u65b9\u5411\u306e\u69cb\u56f3\u3067\u30dd\u30fc\u30c8\u30ec\u30fc\u30c8\u5199\u771f\u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3001\u4e2d\u592e\u3092\u30c8\u30ea\u30df\u30f3\u30b0\u3059\u308b\u3068\u91cd\u8981\u306a\u90e8\u5206 (\u982d\u306a\u3069) \u304c\u7c21\u5358\u306b\u5207\u308a\u53d6\u3089\u308c\u3001\u80f4\u4f53\u3060\u3051\u304c\u6b8b\u308b\u3053\u3068\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u6642\u70b9\u3067\u3001\u30c6\u30ad\u30b9\u30c8 \u30e9\u30d9\u30eb\u304c\u307e\u3060\u300c\u7b11\u9854\u306e\u4eba\u300d\u3067\u3042\u308b\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306f\u8aa4\u3063\u305f\u30de\u30c3\u30d4\u30f3\u30b0 (\u80f4\u4f53\u306e\u7279\u5fb4\u3092\u300c\u7b11\u9854\u306e\u4eba\u300d\u3068\u8aa4\u8a8d) \u3092\u78ba\u7acb\u3059\u308b\u3053\u3068\u3092\u5f37\u5236\u3055\u308c\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6e08\u307f\u30e2\u30c7\u30eb\u306b\u91cd\u5ea6\u306e\u5e7b\u8996\u304c\u767a\u751f\u3057\u307e\u3059\u3002</p> </li> <li> <p>\u826f\u3044\u30b1\u30fc\u30b9 (\u53f3 - \u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u6574\u5408\u6027):     \u300c\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u4e00\u8cab\u6027\u300d\u3092\u8ffd\u6c42\u3057\u305f\u9ad8\u54c1\u8cea\u306a\u30c7\u30fc\u30bf\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3002</p> <ol> <li>\u30b9\u30de\u30fc\u30c8 \u30b5\u30a4\u30ba\u5909\u66f4: \u5b8c\u5168\u306a\u8996\u899a\u7684\u4e3b\u984c\u3092\u7dad\u6301\u3059\u308b\u306b\u306f\u3001<code>Resize with Padding</code> (\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u3092\u7dad\u6301\u3057\u3001\u9ed2/\u767d\u306e\u5883\u754c\u7dda\u3067\u30d1\u30c7\u30a3\u30f3\u30b0) \u3092\u512a\u5148\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u7121\u52b9\u306a\u30d4\u30af\u30bb\u30eb\u304c\u767a\u751f\u3057\u307e\u3059\u304c\u3001\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u306a\u6574\u5408\u6027\u306f\u78ba\u4fdd\u3055\u308c\u307e\u3059\u3002</li> <li>\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u30d0\u30b1\u30c3\u30c8: \u3053\u308c\u306f\u3001SDXL \u3084 Midjourney \u306a\u3069\u306e\u4e16\u4ee3\u30e2\u30c7\u30eb\u3067\u4e00\u822c\u7684\u306b\u4f7f\u7528\u3055\u308c\u308b\u9ad8\u5ea6\u306a\u30c6\u30af\u30cb\u30c3\u30af\u3067\u3059\u3002\u540c\u69d8\u306e\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u3092\u6301\u3064\u753b\u50cf\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u7528\u306b\u540c\u3058\u30d0\u30c3\u30c1\u306b\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3001\u30d1\u30c7\u30a3\u30f3\u30b0\u306e\u7121\u99c4\u3092\u6e1b\u3089\u3057\u306a\u304c\u3089\u30c8\u30ea\u30df\u30f3\u30b0\u3092\u56de\u907f\u3057\u307e\u3059\u3002</li> <li>\u8981\u7d04: \u7b2c 7 \u7ae0\u3067\u8a73\u3057\u304f\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u3001VLM \u3092\u4f7f\u7528\u3057\u3066\u9ad8\u5bc6\u5ea6\u306e\u8aac\u660e\u3092\u751f\u6210\u3059\u308b\u3068\u3001\u30c6\u30ad\u30b9\u30c8\u304c\u753b\u50cf\u5185\u306e\u8a73\u7d30 (\u6a19\u8b58\u30c6\u30ad\u30b9\u30c8\u3001\u80cc\u666f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306a\u3069) \u306b\u6b63\u78ba\u306b\u5bfe\u5fdc\u3057\u3001\u30c7\u30fc\u30bf\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u5024\u304c\u6700\u5927\u5316\u3055\u308c\u307e\u3059\u3002</li> </ol> </li> </ul>"},{"location":"ja/part2/2_1_data_acquisition/#623-gpu-nvidia-dali","title":"6.2.3 GPU \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u308b\u30c7\u30b3\u30fc\u30c9\u3068\u5909\u63db (NVIDIA DALI)","text":"<p>\u30c7\u30a3\u30fc\u30d7 \u30e9\u30fc\u30cb\u30f3\u30b0 \u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d5\u30a7\u30fc\u30ba\u3067\u306f\u3001\u307b\u3068\u3093\u3069\u306e\u7814\u7a76\u8005\u3084\u958b\u767a\u8005\u304c\u30e2\u30c7\u30eb \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u8a2d\u8a08\u3001\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u8abf\u6574\u3001\u640d\u5931\u95a2\u6570\u306e\u6539\u5584\u3001\u304a\u3088\u3073\u30e2\u30c7\u30eb\u306e\u7cbe\u5ea6\u306b\u76f4\u63a5\u5f71\u97ff\u3059\u308b\u305d\u306e\u4ed6\u306e\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u6ce8\u76ee\u3057\u307e\u3059\u304c\u3001\u30c7\u30fc\u30bf \u30ed\u30fc\u30c9 (DataLoader) \u30d5\u30a7\u30fc\u30ba\u306f\u898b\u843d\u3068\u3055\u308c\u304c\u3061\u3067\u3059\u304c\u3001\u5b9f\u969b\u306b\u306f\u305d\u308c\u304c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u52b9\u7387\u3092\u5236\u9650\u3059\u308b\u300c\u76ee\u306b\u898b\u3048\u306a\u3044\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9 \u30ad\u30e9\u30fc\u300d\u306b\u306a\u308b\u3053\u3068\u304c\u591a\u304f\u3001\u3055\u3089\u306b\u306f\u30cf\u30a4\u30a8\u30f3\u30c9 GPU \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b8c\u5168\u306a\u5229\u7528\u3092\u59a8\u3052\u3001\u91cd\u5927\u306a\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306e\u6d6a\u8cbb\u3092\u5f15\u304d\u8d77\u3053\u3059\u3053\u3068\u3055\u3048\u3042\u308a\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u70b9\u3092\u7406\u89e3\u3059\u308b\u306b\u306f\u3001\u307e\u305a\u6df1\u5c64\u5b66\u7fd2\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d5\u30ed\u30fc\u306e\u5b8c\u5168\u306a\u30ed\u30b8\u30c3\u30af\u3092\u660e\u78ba\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30e2\u30c7\u30eb \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u30b3\u30a2 \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u3001GPU \u306e\u5927\u898f\u6a21\u306a\u4e26\u5217\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u6a5f\u80fd\u306b\u4f9d\u5b58\u3057\u3066\u3044\u307e\u3059\u3002 GPU \u306f\u5927\u898f\u6a21\u306a\u30c6\u30f3\u30bd\u30eb\u6f14\u7b97\u3092\u52b9\u7387\u7684\u306b\u51e6\u7406\u3057\u3001\u30d0\u30c3\u30af\u30d7\u30ed\u30d1\u30b2\u30fc\u30b7\u30e7\u30f3\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u66f4\u65b0\u3092\u5b8c\u4e86\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30c7\u30fc\u30bf\u304c GPU \u306b\u5230\u9054\u3059\u308b\u524d\u306b\u3001\u4e00\u9023\u306e\u524d\u51e6\u7406\u64cd\u4f5c\u3092\u901a\u904e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u305d\u306e\u4e2d\u3067\u6700\u3082\u57fa\u672c\u7684\u3067\u6642\u9593\u304c\u304b\u304b\u308b\u306e\u306f\u753b\u50cf\u306e\u30c7\u30b3\u30fc\u30c9\u3068\u30b5\u30a4\u30ba\u5909\u66f4\u3067\u3059\u3002\u5f93\u6765\u306e PyTorch \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d5\u30ed\u30fc\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u91cd\u8981\u306a\u524d\u51e6\u7406\u64cd\u4f5c\u306f\u3059\u3079\u3066 CPU \u306b\u3088\u3063\u3066\u5b9f\u884c\u3055\u308c\u3001\u300cCPU \u524d\u51e6\u7406\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u300d\u3068\u300cGPU \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5197\u9577\u6027\u300d\u306e\u9593\u306b\u77db\u76fe\u304c\u751f\u3058\u307e\u3059\u3002</p> <p>\u5177\u4f53\u7684\u306b\u306f\u3001\u5f93\u6765\u306e PyTorch \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u306f\u6b21\u306e\u3068\u304a\u308a\u3067\u3059\u3002\u307e\u305a\u3001\u30c7\u30a3\u30b9\u30af\u306b\u4fdd\u5b58\u3055\u308c\u3066\u3044\u308b\u753b\u50cf\u30d5\u30a1\u30a4\u30eb (\u4e3b\u306b JPEG \u5f62\u5f0f) \u3092 CPU \u7d4c\u7531\u3067\u8aad\u307f\u53d6\u308a\u3001\u6b21\u306b CPU \u304c JPEG \u30c7\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u306f\u3001\u5727\u7e2e\u753b\u50cf\u30d0\u30a4\u30ca\u30ea \u30c7\u30fc\u30bf\u306b\u5bfe\u3059\u308b\u30cf\u30d5\u30de\u30f3 \u30c7\u30b3\u30fc\u30c9\u3084\u9006\u96e2\u6563\u30b3\u30b5\u30a4\u30f3\u5909\u63db (IDCT) \u306a\u3069\u306e\u8907\u96d1\u306a\u8a08\u7b97\u304c\u5fc5\u8981\u3067\u3042\u308a\u3001\u4e00\u822c\u7684\u306a CPU \u8ca0\u8377\u306e\u9ad8\u3044\u30bf\u30b9\u30af\u3067\u3059\u3002\u30c7\u30b3\u30fc\u30c9\u5f8c\u3001CPU \u306f\u30b5\u30a4\u30ba\u5909\u66f4\u3001\u6b63\u898f\u5316\u3001\u8272\u7a7a\u9593\u5909\u63db\u3001\u305d\u306e\u4ed6\u306e\u524d\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3001\u6700\u5f8c\u306b\u30c7\u30fc\u30bf \u30b3\u30d4\u30fc\u3092\u4ecb\u3057\u3066\u30e2\u30c7\u30eb \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u305f\u3081\u306b\u51e6\u7406\u3055\u308c\u305f\u753b\u50cf\u30c6\u30f3\u30bd\u30eb\u3092 GPU \u306b\u8ee2\u9001\u3057\u307e\u3059\u3002</p> <p>\u3055\u3089\u306b\u91cd\u8981\u306a\u306e\u306f\u3001CPU \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306f\u30b7\u30ea\u30a2\u30eb\u8a08\u7b97\u3068\u30ed\u30b8\u30c3\u30af\u5236\u5fa1\u7528\u306b\u8a2d\u8a08\u3055\u308c\u3066\u304a\u308a\u3001\u4e26\u5217\u8a08\u7b97\u80fd\u529b\u306f GPU \u3088\u308a\u3082\u306f\u308b\u304b\u306b\u52a3\u3063\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u753b\u50cf\u306e\u524d\u51e6\u7406\u306b\u304a\u3051\u308b\u30c7\u30b3\u30fc\u30c9\u3068\u30b5\u30a4\u30ba\u5909\u66f4\u306f\u9ad8\u5ea6\u306b\u4e26\u5217\u5316\u53ef\u80fd\u3067\u3042\u308a\u3001\u30de\u30eb\u30c1\u30b9\u30ec\u30c3\u30c9\u307e\u305f\u306f\u30de\u30eb\u30c1\u30b3\u30a2\u51e6\u7406\u3092\u901a\u3058\u3066\u52b9\u7387\u3092\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057\u3001DataLoader \u306e num_workers \u30d1\u30e9\u30e1\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066 CPU \u4e26\u5217\u51e6\u7406\u3092\u5897\u3084\u3057\u3066\u3082\u3001\u5f93\u6765\u306e PyTorch \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f CPU \u306e\u8a08\u7b97\u4e0a\u9650\u3092\u7a81\u7834\u3059\u308b\u306e\u306b\u82e6\u52b4\u3057\u307e\u3059\u3002\u7279\u306b\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u304c\u5927\u304d\u304f (\u4f8b: \u6570\u767e\u4e07\u306e\u753b\u50cf)\u3001\u5358\u4e00\u753b\u50cf\u306e\u89e3\u50cf\u5ea6\u304c\u9ad8\u3044 (\u4f8b: 1080P \u4ee5\u4e0a) \u5834\u5408\u3001CPU \u306e\u524d\u51e6\u7406\u901f\u5ea6\u304c GPU \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u901f\u5ea6\u3088\u308a\u5927\u5e45\u306b\u9045\u308c\u3001\u30c7\u30fc\u30bf\u5f85\u3061\u3067 GPU \u304c\u983b\u7e41\u306b\u30a2\u30a4\u30c9\u30eb\u72b6\u614b\u306b\u306a\u308a\u3001GPU \u4f7f\u7528\u7387\u304c\u5927\u5e45\u306b\u4f4e\u4e0b\u3057\u307e\u3059\u3002\u6700\u7d42\u7684\u306b\u306f\u5168\u4f53\u7684\u306a\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u52b9\u7387\u304c\u4f4e\u4e0b\u3057\u307e\u3059\u3002\u3053\u308c\u304c\u3001\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\u304c\u300c\u7121\u8996\u3055\u308c\u305f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30ad\u30e9\u30fc\u300d\u3068\u547c\u3070\u308c\u308b\u7406\u7531\u3067\u3059\u3002</p> <p>\u3053\u306e\u6838\u5fc3\u7684\u306a\u554f\u984c\u70b9\u306b\u5bfe\u51e6\u3059\u308b\u305f\u3081\u306b\u3001NVIDIA \u306f\u3001\u30c7\u30a3\u30fc\u30d7 \u30e9\u30fc\u30cb\u30f3\u30b0 \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u7528\u306b\u6700\u9069\u5316\u3055\u308c\u305f GPU \u9ad8\u901f\u30c7\u30fc\u30bf\u524d\u51e6\u7406\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3042\u308b DALI (Data Loading Library) \u3092\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\u305d\u306e\u4e2d\u5fc3\u7684\u306a\u76ee\u6a19\u306f\u3001\u3082\u3068\u3082\u3068 CPU \u306b\u4f9d\u5b58\u3057\u3066\u3044\u305f\u753b\u50cf\u306e\u30c7\u30b3\u30fc\u30c9\u3001\u30b5\u30a4\u30ba\u5909\u66f4\u3001\u305d\u306e\u4ed6\u306e\u96c6\u4e2d\u7684\u306a\u524d\u51e6\u7406\u64cd\u4f5c\u3092\u4e26\u5217\u5b9f\u884c\u306e\u305f\u3081\u306b GPU \u306b\u79fb\u884c\u3057\u3001\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u89e3\u6d88\u3057\u3001GPU \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u89e3\u653e\u3059\u308b\u3053\u3068\u3067\u3059\u3002</p> <p> \u56f3 6-2: DALI \u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u3068\u4f7f\u7528\u3057\u306a\u3044\u5834\u5408\u306e\u30c7\u30fc\u30bf\u306e\u30c7\u30b3\u30fc\u30c9\u3068\u5909\u63db</p> <p>\u30b3\u30fc\u30c9\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb: DALI \u306b\u57fa\u3065\u304f\u9ad8\u6027\u80fd\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</p> <pre><code>import nvidia.dali.fn as fn\nimport nvidia.dali.types as types\nfrom nvidia.dali.pipeline import pipeline_def\n\n\n@pipeline_def(batch_size=256, num_threads=8, device_id=0)\ndef webdataset_gpu_pipeline(shard_id, num_shards):\n    \"\"\"\n    Define end-to-end GPU data loading pipeline\n    Input: WebDataset (Tar) -&gt; Output: GPU Tensor\n    \"\"\"\n\n    # Step 1: Read WebDataset (CPU stage)\n    # Using index_paths is required; otherwise init phase needs to traverse entire tar, extremely slow [5]\n    jpegs, captions = fn.readers.webdataset(\n        paths=[\"/data/shards/shard-{:05d}.tar\".format(i) for i in range(100)],\n        index_paths=[\"/data/indices/shard-{:05d}.idx\".format(i) for i in range(100)],\n        ext=[\"jpg\", \"txt\"],\n        shard_id=shard_id,\n        num_shards=num_shards,\n        random_shuffle=True,\n        initial_fill=10000,      # Shuffle buffer size, larger = more random but slower startup\n        pad_last_batch=True,     # Ensure all batches have consistent size\n        name=\"Reader\",\n        read_ahead=True          # Enable prefetch\n    )\n\n    # Step 2: GPU Decoding (core acceleration point)\n    # device=\"mixed\" means input in Host memory, output in Device memory\n    # output_type=types.RGB handles color space conversion automatically\n    images = fn.decoders.image(\n        jpegs,\n        device=\"mixed\",\n        output_type=types.RGB,\n        # Fault tolerance for corrupted images\n        # In production, never let one bad image crash training\n    )\n\n    # Step 3: GPU transformation pipeline\n    # resize: scale while maintaining aspect ratio\n    images = fn.resize(\n        images,\n        resize_x=224,\n        resize_y=224,\n        interp_type=types.INTERP_LINEAR\n    )\n\n    # crop_mirror_normalize: random crop + flip + normalize (fused operator)\n    # This step converts uint8 to float and subtracts mean, divides by std\n    images = fn.crop_mirror_normalize(\n        images,\n        dtype=types.FLOAT,\n        output_layout=\"CHW\",\n        crop=(224, 224),\n        mean=[0_485 * 255, 0_456 * 255, 0_406 * 255],\n        std=[0_229 * 255, 0_224 * 255, 0_225 * 255],\n        mirror=fn.random.coin_flip(probability=0_5)\n    )\n\n    # Text data typically processed directly on CPU or passed to Tokenizer\n    # Here we only return raw bytes for subsequent PyTorch processing\n    return images, captions\n\n# Use DALIGenericIterator integrated with PyTorch\nfrom nvidia.dali.plugin.pytorch import DALIGenericIterator\n\npipe = webdataset_gpu_pipeline(shard_id=0, num_shards=1)\npipe.build()\ndataloader = DALIGenericIterator(pipe, [\"images\", \"captions\"], reader_name=\"Reader\")\n\n# Benchmark: On A100, this pipeline typically achieves 3000-5000 FPS, 5-10x CPU Loader\n</code></pre>"},{"location":"ja/part2/2_1_data_acquisition/#63","title":"6.3 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u306a\u6d17\u6d44\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u306b\u306f\u5927\u91cf\u306e\u30ce\u30a4\u30ba\u304c\u4f34\u3044\u307e\u3059\u3002 LAION-5B \u306e\u751f\u30c7\u30fc\u30bf\u3067\u306f\u3001\u771f\u306b\u9ad8\u54c1\u8cea\u306e\u30b5\u30f3\u30d7\u30eb\u306f 10% \u672a\u6e80\u3067\u3042\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30c7\u30fc\u30bf\u306e\u591a\u69d8\u6027\u3092\u3067\u304d\u308b\u3060\u3051\u5c11\u306a\u304f\u3057\u306a\u304c\u3089\u30c7\u30fc\u30bf\u5bc6\u5ea6\u3092\u5411\u4e0a\u3055\u305b\u308b\u306b\u306f\u3001\u591a\u6bb5\u968e\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d5\u30a1\u30cd\u30eb\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3044\u308f\u3086\u308b\u300c\u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u300d\u306f\u672c\u8cea\u7684\u306b \u30c7\u30fc\u30bf \u30c0\u30a4\u30a8\u30c3\u30c8 \u3067\u3042\u308a\u3001\u30e2\u30c7\u30eb\u3078\u306e\u30d5\u30a3\u30fc\u30c9\u306e\u91cf\u3092\u6e1b\u3089\u3057\u3001\u3088\u308a\u826f\u304f\u3059\u308b\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"ja/part2/2_1_data_acquisition/#631","title":"6.3.1 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08: \u30ec\u30a4 \u30c7\u30fc\u30bf\u5206\u6563\u30af\u30ea\u30fc\u30cb\u30f3\u30b0","text":"<p>\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u30d5\u30a7\u30fc\u30ba\u306b\u30b9\u30d1\u30fc\u30af\u3067\u306f\u306a\u304f\u30ec\u30a4\u3092\u9078\u629e\u3059\u308b\u7406\u7531\u306f\u4f55\u3067\u3059\u304b?\u306a\u305c\u306a\u3089\u3001\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306b\u306f\u3082\u306f\u3084\u5358\u7d14\u306a ETL \u3067\u306f\u306a\u304f\u3001\u5b9f\u8cea\u7684\u306a \u6df1\u5c64\u5b66\u7fd2\u63a8\u8ad6 (\u30e2\u30c7\u30eb\u63a8\u8ad6) \u304c\u542b\u307e\u308c\u308b\u304b\u3089\u3067\u3059\u3002 Spark \u306e MapReduce \u30d1\u30e9\u30c0\u30a4\u30e0\u3068\u6bd4\u8f03\u3057\u3066\u3001Ray \u306f\u3088\u308a\u67d4\u8edf\u306a Actor \u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u63d0\u4f9b\u3057\u3001GPU \u30e2\u30c7\u30eb (CLIP\u3001Safety Checker \u306a\u3069) \u3092\u5e38\u99d0\u3055\u305b\u3001\u5c0f\u3055\u306a\u30d0\u30c3\u30c1\u3054\u3068\u306b\u8907\u6570 GB \u306e\u30e2\u30c7\u30eb\u3092\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u3068\u3044\u3046\u81a8\u5927\u306a\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3092\u56de\u907f\u3067\u304d\u307e\u3059\u3002</p> <p>Ray Data \u306f\u3001CPU \u96c6\u4e2d\u578b (\u89e3\u51cd\u3001\u30cf\u30c3\u30b7\u30e5\u3001\u6b63\u898f\u8868\u73fe) \u30bf\u30b9\u30af\u3068 GPU \u96c6\u4e2d\u578b (CLIP Embedding\u63a8\u8ad6) \u30bf\u30b9\u30af\u306e\u4e21\u65b9\u306e\u6df7\u5408\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u3092\u51e6\u7406\u3059\u308b\u306e\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u3001\u4e00\u822c\u7684\u306a 3 \u6bb5\u968e\u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8a2d\u8a08\u3067\u3059\u3002 * \u30b9\u30c6\u30fc\u30b8 1 (CPU): \u30af\u30a4\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3002\u89e3\u50cf\u5ea6\u304c\u4e0d\u5341\u5206 (&lt;256px)\u3001\u30c6\u30ad\u30b9\u30c8\u304c\u77ed\u3059\u304e\u308b\u3001\u82f1\u8a9e\u4ee5\u5916 (\u82f1\u8a9e\u306e\u307f\u306e\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u3066\u3044\u308b\u5834\u5408)\u3001\u307e\u305f\u306f\u7570\u5e38\u306a\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u76f4\u63a5\u524a\u9664\u3057\u307e\u3059\u3002 * \u30b9\u30c6\u30fc\u30b8 2 (GPU): \u8a73\u7d30\u306a\u7279\u5fb4\u62bd\u51fa\u3002 CLIP \u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u30a8\u30f3\u30d9\u30c7\u30a3\u30f3\u30b0\u3092\u751f\u6210\u3057\u3001\u30a8\u30f3\u30d9\u30c7\u30a3\u30f3\u30b0\u306b\u57fa\u3065\u3044\u3066\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u985e\u4f3c\u6027\u3068\u7f8e\u7684\u30b9\u30b3\u30a2\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002 * \u30b9\u30c6\u30fc\u30b8 3 (CPU/\u6df7\u5408): \u8ad6\u7406\u7684\u306a\u5224\u65ad\u3068\u91cd\u8907\u6392\u9664\u3002\u5b89\u5168\u6027 (NSFW)\u3001\u7f8e\u7684\u30b9\u30b3\u30a2\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u95a2\u9023\u6027\u3001\u3055\u3089\u306b\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u306a\u91cd\u8907\u6392\u9664\u306b\u57fa\u3065\u3044\u305f\u5305\u62ec\u7684\u306a\u3057\u304d\u3044\u5024\u51e6\u7406\u3002</p> <p>\u30c7\u30fc\u30bf \u30d5\u30ed\u30fc\u56f3</p> <p> \u56f3 6-3: Ray \u30c7\u30fc\u30bf\u5206\u6563\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf \u30d5\u30ed\u30fc</p>"},{"location":"ja/part2/2_1_data_acquisition/#632","title":"6.3.2 \u30b3\u30a2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5b9f\u88c5","text":"<p>\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u3068\u306f\u3001\u5358\u306b\u524a\u9664\u3059\u308b\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30c7\u30fc\u30bf\u306e\u4fa1\u5024\u3092\u6570\u5024\u5316\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u753b\u50cf\u3068\u305d\u308c\u306b\u5bfe\u5fdc\u3059\u308b\u30c6\u30ad\u30b9\u30c8\u306e\u300c\u30b4\u30fc\u30eb\u30c9 \u30b3\u30f3\u30c6\u30f3\u30c4\u300d\u3092\u6e2c\u5b9a\u3059\u308b\u306b\u306f\u3001\u591a\u6b21\u5143\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <ol> <li> <p>\u7f8e\u7684\u30b9\u30b3\u30a2</p> <ul> <li>\u539f\u5247: \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u8acb\u6c42\u66f8\u3001\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3001\u4e0d\u9bae\u660e\u306a\u76e3\u8996\u6620\u50cf\u3067\u3044\u3063\u3071\u3044\u3067\u3059\u3002\u3053\u308c\u3089\u306f\u7f8e\u3057\u3044\u753b\u50cf\u3092\u751f\u6210\u3059\u308b\u306e\u306b\u306f\u5f79\u306b\u7acb\u3061\u307e\u305b\u3093\u3002\u901a\u5e38\u306f LAION-Aesthetics Predictor \u304c\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002</li> <li>\u6280\u8853\u7684\u306a\u8a73\u7d30: \u3053\u308c\u306f\u5358\u7d14\u306a MLP (\u591a\u5c64\u30d1\u30fc\u30bb\u30d7\u30c8\u30ed\u30f3) \u3067\u3059\u3002\u5165\u529b\u306f CLIP \u753b\u50cfEmbedding\u3001\u51fa\u529b\u306f 1 \uff5e 10 \u306e\u30b9\u30b3\u30a2\u3067\u3059\u3002\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306f AVA \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8 (\u30d7\u30ed\u306e\u5199\u771f\u5bb6\u304b\u3089\u306e\u30b9\u30b3\u30a2\u3092\u542b\u3080) \u304b\u3089\u53d6\u5f97\u3055\u308c\u307e\u3059\u3002</li> <li>\u63a8\u5968\u3055\u308c\u308b\u3057\u304d\u3044\u5024: \u57fa\u672c\u7684\u306a\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u5834\u5408\u306f\u3001\u30b9\u30b3\u30a2 &gt; 4_5 \u306e\u30c7\u30fc\u30bf\u3092\u4fdd\u6301\u3057\u307e\u3059\u3002\u9ad8\u54c1\u8cea\u306e\u751f\u6210\u30e2\u30c7\u30eb (SFT \u30d5\u30a7\u30fc\u30ba) \u3092\u5fae\u8abf\u6574\u3059\u308b\u306b\u306f\u3001\u30b9\u30b3\u30a2 &gt; 6_0\u3001\u307e\u305f\u306f 6_5 \u3092\u63a8\u5968\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u914d\u7f6e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0</p> <ul> <li>\u539f\u5247: \u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306e\u591a\u304f\u306f\u3001\u753b\u50cf\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u306f\u95a2\u4fc2\u306e\u306a\u3044\u3001SEO \u306e\u30b4\u30df\u5358\u8a9e\u306e\u7a4d\u307f\u91cd\u306d\u3084\u30d5\u30a1\u30a4\u30eb\u540d (\u300cDSC_001.jpg\u300d) \u3067\u3059\u3002</li> <li>\u6280\u8853\u8a73\u7d30: CLIP \u753b\u50cfEmbedding\u3068\u30c6\u30ad\u30b9\u30c8Embedding\u306e\u9593\u306e\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6 (\u30c9\u30c3\u30c8\u7a4d) \u3092\u8a08\u7b97\u3057\u307e\u3059\u3002</li> <li>\u6ce8\u610f\u70b9: CLIP \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u7570\u306a\u308b\u3068 (\u4f8b: OpenAI ViT-L/14 \u3068 OpenCLIP ViT-G/14)\u3001\u30a8\u30f3\u30d9\u30c7\u30a3\u30f3\u30b0 \u30b9\u30da\u30fc\u30b9\u306e\u5206\u5e03\u3082\u7570\u306a\u308a\u307e\u3059\u3002\u30b9\u30b3\u30a2\u306f\u76f4\u63a5\u6bd4\u8f03\u3067\u304d\u307e\u305b\u3093\u3002\u7279\u5b9a\u306e\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u3066\u3057\u304d\u3044\u5024\u3092\u518d\u8abf\u6574\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u65b9\u6cd5\u306f\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u5168\u4f53\u306b\u308f\u305f\u308b\u985e\u4f3c\u5ea6\u306e\u5206\u5e03\u3092\u8a08\u7b97\u3057\u3001\u4e0a\u4f4d 50% \u307e\u305f\u306f\u4e0a\u4f4d 70% \u3092\u4fdd\u6301\u3059\u308b\u3053\u3068\u3067\u3059\u3002</li> </ul> </li> <li> <p>\u5b89\u5168\u691c\u77e5</p> <ul> <li>\u539f\u5247: \u30dd\u30eb\u30ce\u3001\u66b4\u529b\u3001\u660e\u3089\u304b\u306a\u30d6\u30e9\u30f3\u30c9\u306e\u900f\u304b\u3057\u306e\u3042\u308b\u753b\u50cf\u306f\u524a\u9664\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> <li>\u6226\u7565: \u7279\u5225\u306b\u8a13\u7df4\u3055\u308c\u305f\u5206\u985e\u5b50\u30d8\u30c3\u30c9 (\u3053\u308c\u3082 CLIP Embedding\u306b\u57fa\u3065\u304f) \u3092\u4f7f\u7528\u3057\u3066\u3001NSFW \u3068\u30a6\u30a9\u30fc\u30bf\u30fc\u30de\u30fc\u30af\u3092\u691c\u51fa\u3057\u307e\u3059\u3002\u900f\u304b\u3057\u691c\u51fa\u306e\u5834\u5408: \u751f\u6210\u30e2\u30c7\u30eb (SDXL \u306a\u3069) \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u3053\u3068\u304c\u76ee\u7684\u306e\u5834\u5408\u3001\u751f\u6210\u30e2\u30c7\u30eb\u306f\u900f\u304b\u3057\u7279\u5fb4\u3092\u5bb9\u6613\u306b\u30aa\u30fc\u30d0\u30fc\u30d5\u30a3\u30c3\u30c8\u3059\u308b\u305f\u3081\u3001\u975e\u5e38\u306b\u53b3\u5bc6 (\u30ea\u30b3\u30fc\u30eb\u512a\u5148) \u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u76ee\u6a19\u304c\u7406\u89e3\u30e2\u30c7\u30eb (GPT-4V \u306a\u3069) \u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u3042\u308b\u5834\u5408\u3001\u7406\u89e3\u30e2\u30c7\u30eb\u306f\u300c\u753b\u50cf\u306b\u900f\u304b\u3057\u304c\u3042\u308b\u300d\u3053\u3068\u3092\u8a8d\u8b58\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u7de9\u548c\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</li> </ul> </li> </ol> <p>\u30b3\u30fc\u30c9\u306e\u5b9f\u88c5: \u30ec\u30a4 \u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30aa\u30da\u30ec\u30fc\u30bf\u30fc</p> <pre><code>import ray\nimport torch\nimport open_clip\nimport numpy as np\nfrom PIL import Image\nimport io\n\n# Define Ray Actor class to ensure model is loaded only once\nclass QualityScorer:\n    def __init__(self):\n        self.device = \"cuda\" if torch.cuda.is_available() else \"cpu\"\n        # Load CLIP model (ViT-B-32 fast, suitable for cleaning)\n        self.model, _, self.preprocess = open_clip.create_model_and_transforms(\n            'ViT-B-32', pretrained='laion2b_s34b_b79k', device=self.device\n        )\n        # Load aesthetic scoring head (Linear Layer)\n        self.aesthetic_head = torch.nn.Linear(512, 1).to(self.device)\n        self.aesthetic_head.load_state_dict(torch.load(\"sac+logos+ava1-l14-linearMSE.pth\"))\n        self.aesthetic_head.eval()\n\n    def __call__(self, batch: dict) -&gt; dict:\n        \"\"\"\n        Process one batch of data. Ray automatically shards and transfers data to Actor.\n        \"\"\"\n        images = []\n        valid_indices = []\n\n        # Preprocess images (CPU operation)\n        for idx, img_bytes in enumerate(batch[\"jpg\"]):\n            try:\n                img = Image.open(io.BytesIO(img_bytes)).convert(\"RGB\")\n                img_tensor = self.preprocess(img)\n                images.append(img_tensor)\n                valid_indices.append(idx)\n            except Exception:\n                # Log bad image but don't interrupt\n                continue\n\n        if not images:\n            return {\"aesthetic_score\": [], \"clip_score\": []}\n\n        image_input = torch.stack(images).to(self.device)\n\n        with torch.no_grad():\n            # 1. Extract features\n            image_features = self.model.encode_image(image_input)\n            image_features /= image_features.norm(dim=-1, keepdim=True)\n\n            # 2. Compute aesthetic score\n            aesthetic_scores = self.aesthetic_head(image_features).squeeze().cpu().numpy()\n\n            # 3. Compute image-text match (assuming batch has text field)\n            # text_tokens = self.tokenizer(batch[\"txt\"]).to(self.device)\n            # text_features = self.model.encode_text(text_tokens)\n            #... compute cosine similarity\n\n        # Return results (note alignment with original batch indices)\n        return {\"aesthetic_score\": aesthetic_scores}\n\n# Orchestrate Ray pipeline\nray.init()\nds = ray.data.read_webdataset(\"s3://raw-bucket/{00000..00099}.tar\")\n\n# map_batches automatically schedules GPU resources\n# num_gpus=0_25 means one GPU can run 4 Actors concurrently, improving throughput\nscored_ds = ds.map_batches(\n    QualityScorer, \n    compute=ray.data.ActorPoolStrategy(size=8), \n    num_gpus=0_25, \n    batch_size=128\n)\n\n# Final filtering\nfiltered_ds = scored_ds.filter(lambda row: row[\"aesthetic_score\"] &gt; 4_5)\nfiltered_ds.write_webdataset(\"s3://clean-bucket/\")\n</code></pre>"},{"location":"ja/part2/2_1_data_acquisition/#64","title":"6.4 \u843d\u3068\u3057\u7a74\u3068\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":"<p>\u6570\u5341\u5104\u898f\u6a21\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u3001\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30c1\u30fc\u30e0\u306f\u8a73\u7d30\u3067\u3064\u307e\u305a\u304f\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u3064\u3089\u3044\u7d4c\u9a13\u304b\u3089\u5b66\u3093\u3060\u6559\u8a13\u306f\u6b21\u306e\u3068\u304a\u308a\u3067\u3059\u3002</p> <ul> <li> <p>\u5bc4\u6728\u7d30\u5de5\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u7206\u767a\u7684\u5897\u52a0:</p> <ul> <li>\u30a8\u30e9\u30fc: \u30d1\u30f3\u30c0\u3067 20 \u5104\u884c\u3092\u542b\u3080 Parquet \u30d5\u30a1\u30a4\u30eb\u3092\u76f4\u63a5\u8aad\u307f\u53d6\u308b\u7fd2\u6163\u304c\u3042\u308a\u307e\u3059\u3002</li> <li>\u7d50\u679c: \u30e1\u30e2\u30ea\u4e0d\u8db3 (OOM)\u3002\u30d1\u30f3\u30c0\u306f 1 \u5217\u3060\u3051\u3092\u8aad\u307f\u53d6\u308b\u5834\u5408\u3067\u3082\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5168\u4f53\u3092\u30e1\u30e2\u30ea\u306b\u30ed\u30fc\u30c9\u3057\u3088\u3046\u3068\u3059\u308b\u305f\u3081\u3067\u3059\u3002</li> <li>\u4fee\u6b63: Polars \u307e\u305f\u306f PySpark \u306e\u9045\u5ef6\u8a55\u4fa1\u30e2\u30fc\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u307e\u305f\u306f\u3001\u5358\u4e00\u306e\u5de8\u5927\u306a\u30e1\u30bf\u30c7\u30fc\u30bf \u30d5\u30a1\u30a4\u30eb\u306e\u51e6\u7406\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001\u884c\u6570 (100 \u4e07\u884c\u306a\u3069) \u3054\u3068\u306b Parquet \u30d5\u30a1\u30a4\u30eb\u3092\u3088\u308a\u5c0f\u3055\u3044\u30d5\u30a1\u30a4\u30eb\u306b\u53b3\u5bc6\u306b\u5206\u5272\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>WebDataset \u30b7\u30e3\u30c3\u30d5\u30eb\u304c\u4e0d\u5341\u5206\u3067\u3059:</p> <ul> <li>\u30a8\u30e9\u30fc: \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4e2d\u306b\u3001\u30c7\u30fc\u30bf\u306f\u30c9\u30e1\u30a4\u30f3\u9806\u306b\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\u3002\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306f\u3001DataLoader \u306e\u30d0\u30c3\u30d5\u30a1 \u30b7\u30e3\u30c3\u30d5\u30eb (\u901a\u5e38\u306f 10k \u306e\u30d0\u30c3\u30d5\u30a1) \u306e\u307f\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002</li> <li>\u7d50\u679c: \u30e2\u30c7\u30eb\u306f 100,000 \u500b\u306e e-\u30b3\u30de\u30fc\u30b9\u753b\u50cf\u3092\u9023\u7d9a\u3057\u3066\u8868\u793a\u3057\u3001\u6b21\u306b 100,000 \u500b\u306e\u98a8\u666f\u753b\u50cf\u3092\u8868\u793a\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30d0\u30c3\u30d5\u30a1\u30fc\u304c\u5c0f\u3055\u3044\u3068\u3001\u3053\u306e\u300c\u6642\u9593\u7684\u76f8\u95a2\u300d\u3092\u6253\u3061\u7834\u308b\u3053\u3068\u304c\u3067\u304d\u305a\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30ab\u30fc\u30d6\u306e\u6fc0\u3057\u3044\u632f\u52d5\u3084\u767a\u6563\u3055\u3048\u3082\u5f15\u304d\u8d77\u3053\u3057\u307e\u3059\u3002</li> <li>\u4fee\u6b63: WebDataset \u3092\u66f8\u304d\u8fbc\u3080\u524d\u306b\u3001URL \u30ea\u30b9\u30c8\u306b\u5bfe\u3057\u3066\u30b0\u30ed\u30fc\u30d0\u30eb \u30b7\u30e3\u30c3\u30d5\u30eb\u3092\u5b9f\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 Spark \u306e <code>orderBy(rand())</code> \u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u30ed\u30f3\u30b0\u30c6\u30fc\u30eb \u30c7\u30fc\u30bf\u3092\u8aa4\u3063\u3066\u524a\u9664\u3057\u3066\u3057\u307e\u3046:</p> <ul> <li>\u30a8\u30e9\u30fc: \u6975\u7aef\u306a\u7f8e\u7684\u30b9\u30b3\u30a2\u3092\u8ffd\u6c42\u3057\u3001\u30b9\u30b3\u30a2 &lt; 4_5 \u306e\u753b\u50cf\u3092\u3059\u3079\u3066\u524a\u9664\u3057\u307e\u3059\u3002</li> <li>\u7d50\u679c: \u30e2\u30c7\u30eb\u306f\u300c\u72ed\u304f\u300d\u306a\u308a\u3001\u533b\u7642\u753b\u50cf\u3001\u8857\u8def\u98a8\u666f\u3001\u624b\u66f8\u304d\u306e\u30e1\u30e2\u306a\u3069\u306e\u73fe\u5b9f\u4e16\u754c\u306e (\u304a\u305d\u3089\u304f\u919c\u3044) \u5199\u771f\u3067\u306f\u306a\u304f\u3001\u30a2\u30fc\u30c8\u5199\u771f\u3068\u58c1\u7d19\u306e\u307f\u3092\u8a8d\u8b58\u3057\u307e\u3059\u3002\u30e2\u30c7\u30eb\u306e\u4e00\u822c\u5316\u3092\u5927\u5e45\u306b\u8efd\u6e1b\u3057\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u5c64\u5225\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 5% \uff5e 10% \u306e\u4f4e\u30b9\u30b3\u30a2 \u30c7\u30fc\u30bf\u3092\u300c\u6b63\u898f\u5316\u300d\u3068\u3057\u3066\u4fdd\u6301\u3059\u308b\u304b\u3001\u7f8e\u7684\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u30d0\u30a4\u30d1\u30b9\u3059\u308b\u7279\u5b9a\u306e\u30c9\u30e1\u30a4\u30f3 (OCR\u3001\u30b0\u30e9\u30d5\u306a\u3069) \u306e\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u3092\u78ba\u7acb\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u91cd\u8907\u30c7\u30fc\u30bf\u306e\u96a0\u308c\u305f\u5371\u967a (\u91cd\u8907\u6392\u9664):</p> <ul> <li>\u30a8\u30e9\u30fc: \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306e\u5927\u91cf\u306e\u91cd\u8907\u753b\u50cf (\u30df\u30fc\u30e0\u3001\u30d0\u30a4\u30e9\u30eb \u30cb\u30e5\u30fc\u30b9\u753b\u50cf\u306a\u3069) \u3092\u7121\u8996\u3057\u307e\u3059\u3002</li> <li>\u7d50\u679c: \u30e2\u30c7\u30eb\u306f\u7279\u5b9a\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u30aa\u30fc\u30d0\u30fc\u30d5\u30a3\u30c3\u30c8\u3057\u3001\u751f\u6210\u4e2d\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30bb\u30c3\u30c8\u306e\u753b\u50cf\u3092\u300c\u8a18\u61b6\u300d\u3059\u308b\u3053\u3068\u3082\u3042\u308a\u3001\u6df1\u523b\u306a\u8457\u4f5c\u6a29\u554f\u984c\u306b\u3064\u306a\u304c\u308a\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306b\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u91cd\u8907\u6392\u9664\u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3059\u3079\u3066\u306e\u753b\u50cf\u306eEmbedding\u3092\u8a08\u7b97\u3057\u3001\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306b Faiss \u307e\u305f\u306f MinHashLSH \u3092\u4f7f\u7528\u3057\u3001\u985e\u4f3c\u6027\u306e\u9ad8\u3044\u30b0\u30eb\u30fc\u30d7\u3054\u3068\u306b 1 \u3064\u306e\u753b\u50cf\u306e\u307f\u3092\u4fdd\u6301\u3057\u307e\u3059\u3002</li> </ul> </li> </ul>"},{"location":"ja/part2/2_2_cleaning_denoising/","title":"\u7b2c4\u7ae0: \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u3068\u30ce\u30a4\u30ba\u9664\u53bb","text":""},{"location":"ja/part2/2_2_cleaning_denoising/#4","title":"\u7b2c 4 \u7ae0: \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u3068\u30ce\u30a4\u30ba\u9664\u53bb","text":""},{"location":"ja/part2/2_2_cleaning_denoising/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089\u5f97\u3089\u308c\u308b\u751f\u30c7\u30fc\u30bf\u306f\u672a\u51e6\u7406\u306e\u9271\u77f3\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3001\u672c\u5f53\u306b\u4fa1\u5024\u306e\u3042\u308b\u300c\u6fc3\u7e2e\u7269\u300d\u306f\u307b\u3093\u306e\u4e00\u90e8\u3057\u304b\u5360\u3081\u3066\u3044\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306e 3 \u3064\u306e\u30b3\u30a2 \u30c6\u30af\u30ce\u30ed\u30b8\u3001\u3064\u307e\u308a\u4f4e\u54c1\u8cea\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u524a\u9664\u3059\u308b\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u30eb\u30fc\u30eb\u3001\u91cd\u8907\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u6392\u9664\u3059\u308b\u5927\u898f\u6a21\u91cd\u8907\u6392\u9664\u3001\u304a\u3088\u3073\u30e6\u30fc\u30b6\u30fc\u60c5\u5831\u3092\u4fdd\u8b77\u3059\u308b\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc \u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30c6\u30af\u30cb\u30c3\u30af\u3092\u7fd2\u5f97\u3059\u308b\u3068\u3001\u8aad\u8005\u306f\u7523\u696d\u30b0\u30ec\u30fc\u30c9\u306e\u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u3066\u3001\u751f\u306e Web \u30c7\u30fc\u30bf\u3092\u9ad8\u54c1\u8cea\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b3\u30fc\u30d1\u30b9\u306b\u5909\u63db\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#_2","title":"\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb","text":"<p>\u524d\u306e\u7ae0\u306e\u53d6\u308a\u7d44\u307f\u306e\u7d50\u679c\u3001\u30c1\u30fc\u30e0\u306f Common Crawl \u304b\u3089 50TB \u306e\u4e2d\u56fd\u8a9e Web \u30c6\u30ad\u30b9\u30c8\u3092\u62bd\u51fa\u3059\u308b\u3053\u3068\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u30c7\u30fc\u30bf\u3092\u30e9\u30f3\u30c0\u30e0\u306b\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3057\u3066\u691c\u67fb\u3059\u308b\u3068\u3001\u3055\u307e\u3056\u307e\u306a\u5384\u4ecb\u306a\u554f\u984c\u304c\u898b\u3064\u304b\u308a\u307e\u3059\u3002\u591a\u304f\u306e\u30da\u30fc\u30b8\u306b\u306f\u3001\u5b9f\u8cea\u7684\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u306a\u3044\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3 \u30c6\u30ad\u30b9\u30c8\u304c\u6570\u8a9e\u3057\u304b\u542b\u307e\u308c\u3066\u3044\u307e\u305b\u3093\u3002\u4e00\u90e8\u306e\u30da\u30fc\u30b8\u306f JavaScript \u30b3\u30fc\u30c9\u307e\u305f\u306f CSS \u30b9\u30bf\u30a4\u30eb\u306e\u6b8b\u9ab8\u3067\u3044\u3063\u3071\u3044\u3067\u3059\u3002\u7279\u5b9a\u306e Web \u30b5\u30a4\u30c8\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u4f55\u767e\u56de\u3082\u7e70\u308a\u8fd4\u3057\u30af\u30ed\u30fc\u30eb\u3055\u308c\u307e\u3057\u305f\u3002\u307e\u305f\u3001\u30e6\u30fc\u30b6\u30fc\u306e\u96fb\u5b50\u30e1\u30fc\u30eb\u3084\u96fb\u8a71\u756a\u53f7\u306a\u3069\u306e\u6a5f\u5bc6\u60c5\u5831\u304c\u5927\u91cf\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002</p> <p>\u3055\u3089\u306b\u60aa\u3044\u3053\u3068\u306b\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30a8\u30f3\u30b8\u30cb\u30a2\u306f\u3001\u524d\u56de\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3055\u308c\u3066\u3044\u306a\u3044\u30c7\u30fc\u30bf\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u306b\u306f\u6df1\u523b\u306a\u300c\u30aa\u30a6\u30e0\u300d\u554f\u984c\u304c\u3042\u3063\u305f\u3068\u544a\u3052\u307e\u3057\u305f\u3002\u30e2\u30c7\u30eb\u306f\u540c\u3058\u6587\u7ae0\u3092\u7e70\u308a\u8fd4\u3057\u51fa\u529b\u3057\u3001\u7279\u5b9a\u306e Web \u30b5\u30a4\u30c8\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u5b8c\u5168\u306b\u6697\u5531\u3059\u308b\u3053\u3068\u3055\u3048\u3042\u308a\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u660e\u3089\u304b\u306b\u30c7\u30fc\u30bf\u306e\u91cd\u8907\u304c\u539f\u56e0\u3067\u3059\u3002</p> <p>\u3053\u308c\u3089\u306e\u554f\u984c\u3092\u4f53\u7cfb\u7684\u306b\u89e3\u6c7a\u3059\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u304b?\u3053\u306e\u7ae0\u3067\u306f\u5b8c\u5168\u306a\u7b54\u3048\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#41","title":"4.1 \u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u30eb\u30fc\u30eb","text":"<p>\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306f\u3001\u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306b\u304a\u3051\u308b\u9632\u5fa1\u306e\u6700\u524d\u7dda\u3067\u3059\u3002\u4e00\u9023\u306e\u5b9a\u91cf\u5316\u53ef\u80fd\u306a\u30eb\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3001\u660e\u3089\u304b\u306b\u4f4e\u54c1\u8cea\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8fc5\u901f\u306b\u9664\u5916\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30eb\u30fc\u30eb\u306f\u5358\u7d14\u306b\u898b\u3048\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u5b9f\u969b\u306b\u306f\u307b\u3068\u3093\u3069\u306e\u30ce\u30a4\u30ba\u306e\u591a\u3044\u30c7\u30fc\u30bf\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u3066\u9664\u53bb\u3067\u304d\u308b\u305f\u3081\u3001\u30b3\u30b9\u30c8\u52b9\u7387\u306e\u9ad8\u3044\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30a2\u30d7\u30ed\u30fc\u30c1\u3068\u306a\u308a\u307e\u3059\u3002</p> <p></p> <p>\u56f3 4-1: \u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 \u2014 \u751f\u30c7\u30fc\u30bf\u304b\u3089\u30af\u30ea\u30fc\u30f3 \u30b3\u30fc\u30d1\u30b9\u307e\u3067\u306e 8 \u6bb5\u968e\u306e\u51e6\u7406\u30d5\u30ed\u30fc</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#411","title":"4.1.1 \u8a00\u8a9e\u306e\u691c\u51fa","text":"<p>\u8a00\u8a9e\u691c\u51fa\u306f\u3001\u591a\u8a00\u8a9e\u30c7\u30fc\u30bf\u51e6\u7406\u306b\u304a\u3051\u308b\u57fa\u672c\u7684\u306a\u30b9\u30c6\u30c3\u30d7\u3067\u3059\u3002\u4e2d\u56fd\u8a9e\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u306b\u306f\u3001\u307e\u305a Common Crawl \u306e\u81a8\u5927\u306a\u30c7\u30fc\u30bf\u304b\u3089\u4e2d\u56fd\u8a9e\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306b\u306f\u6b63\u78ba\u306a\u8a00\u8a9e\u691c\u51fa\u6a5f\u80fd\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>FastText Language Detector \u306f\u3001\u73fe\u5728\u6700\u3082\u4e00\u822c\u7684\u306b\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002 Facebook AI Research \u306b\u3088\u3063\u3066\u958b\u767a\u3055\u308c\u305f\u305d\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6e08\u307f\u30e2\u30c7\u30eb\u306f\u3001\u975e\u5e38\u306b\u9ad8\u901f\u304b\u3064\u9ad8\u7cbe\u5ea6\u3067 176 \u8a00\u8a9e\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002 FastText \u306b\u306f 2 \u3064\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6e08\u307f\u30e2\u30c7\u30eb\u304c\u7528\u610f\u3055\u308c\u3066\u3044\u307e\u3059\u3002 <code>lid.176.bin</code> \u306f\u7cbe\u5ea6\u304c\u9ad8\u3044\u5b8c\u5168\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3059\u304c\u3001\u30b5\u30a4\u30ba\u306f\u5927\u304d\u304f\u306a\u308a\u307e\u3059 (~126MB)\u3002 <code>lid.176.ftz</code> \u306f\u3001\u30b5\u30a4\u30ba\u304c\u5c0f\u3055\u3044 (~917KB) \u3082\u306e\u306e\u3001\u7cbe\u5ea6\u304c\u308f\u305a\u304b\u306b\u4f4e\u3044\u5727\u7e2e\u30d0\u30fc\u30b8\u30e7\u30f3\u3067\u3059\u3002\u5927\u898f\u6a21\u306a\u30c7\u30fc\u30bf\u51e6\u7406\u306e\u5834\u5408\u306f\u3001\u88fd\u54c1\u7248\u3092\u63a8\u5968\u3057\u307e\u3059\u3002</p> <pre><code>import fasttext\n\n# Load language detection model\nlang_model = fasttext.load_model('lid.176.bin')\n\ndef detect_language(text: str, min_confidence: float = 0_8) -&gt; tuple:\n    \"\"\"\n    Detect text language\n\n    Args:\n        text: Text to be detected\n        min_confidence: Minimum confidence threshold\n\n    Returns:\n        (language code, confidence) or (None, 0) if confidence insufficient\n    \"\"\"\n    # Preprocessing: remove newlines, take first 1000 characters\n    text = text.replace('\\n', ' ')[:1000]\n\n    # Predict\n    predictions = lang_model.predict(text, k=1)\n    lang = predictions[0][0].replace('__label__', '')\n    confidence = predictions[1][0]\n\n    if confidence &gt;= min_confidence:\n        return lang, confidence\n    return None, confidence\n\ndef filter_by_language(documents: list, target_lang: str = 'zh') -&gt; list:\n    \"\"\"Filter documents by specified language\"\"\"\n    results = []\n    for doc in documents:\n        lang, conf = detect_language(doc['text'])\n        if lang == target_lang:\n            doc['detected_lang'] = lang\n            doc['lang_confidence'] = conf\n            results.append(doc)\n    return results\n</code></pre> <p>\u8a00\u8a9e\u691c\u51fa\u3067\u306f\u3001\u5b9f\u969b\u306b\u306f\u3044\u304f\u3064\u304b\u306e\u7279\u6b8a\u306a\u30b1\u30fc\u30b9\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u6df7\u5408\u8a00\u8a9e\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (\u4e2d\u56fd\u8a9e\u3068\u82f1\u8a9e\u306e\u6280\u8853\u30d6\u30ed\u30b0\u306a\u3069) \u306f\u8aa4\u3063\u3066\u5206\u985e\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u77ed\u3044\u30c6\u30ad\u30b9\u30c8\u306f\u691c\u51fa\u7cbe\u5ea6\u304c\u4f4e\u304f\u306a\u308a\u307e\u3059\u3002 50 \u6587\u5b57\u672a\u6e80\u306e\u30c6\u30ad\u30b9\u30c8\u306e\u8a00\u8a9e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3092\u30b9\u30ad\u30c3\u30d7\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u30b3\u30fc\u30c9 \u30b9\u30cb\u30da\u30c3\u30c8\u306f\u3055\u307e\u3056\u307e\u306a\u8a00\u8a9e\u3068\u3057\u3066\u8b58\u5225\u3055\u308c\u308b\u5834\u5408\u304c\u3042\u308a\u3001\u30b3\u30f3\u30c6\u30f3\u30c4 \u30bf\u30a4\u30d7\u306e\u5224\u65ad\u304c\u5fc5\u8981\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#412","title":"4.1.2 \u30c6\u30ad\u30b9\u30c8\u54c1\u8cea\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0","text":"<p>\u8a00\u8a9e\u691c\u51fa\u306f\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u30bf\u30fc\u30b2\u30c3\u30c8\u8a00\u8a9e\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3059\u308b\u3060\u3051\u3067\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u54c1\u8cea\u3092\u5224\u65ad\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u6587\u6cd5\u7684\u306b\u6b63\u3057\u3044\u30b9\u30d1\u30e0\u5e83\u544a\u3068\u9ad8\u54c1\u8cea\u306e\u6280\u8853\u8a18\u4e8b\u306f\u3001\u540c\u3058\u8a00\u8a9e\u691c\u51fa\u30b9\u30b3\u30a2\u3092\u53d7\u3051\u53d6\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306b\u306f\u3001\u3088\u308a\u6d17\u7df4\u3055\u308c\u305f\u54c1\u8cea\u8a55\u4fa1\u30e1\u30ab\u30cb\u30ba\u30e0\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3 \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u306f\u3001\u8a00\u8a9e\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u305f\u54c1\u8cea\u8a55\u4fa1\u65b9\u6cd5\u3067\u3059\u3002\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u306b\u304a\u3051\u308b\u8a00\u8a9e\u30e2\u30c7\u30eb\u306e\u300c\u9a5a\u304d\u300d\u3092\u6e2c\u5b9a\u3057\u307e\u3059\u3002\u30c6\u30ad\u30b9\u30c8\u304c\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u5206\u5e03\u3068\u985e\u4f3c\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3\u306f\u4f4e\u304f\u306a\u308a\u307e\u3059\u3002\u30c6\u30ad\u30b9\u30c8\u306b\u591a\u304f\u306e\u30ce\u30a4\u30ba\u3001\u610f\u5473\u4e0d\u660e\u306a\u8868\u73fe\u3001\u307e\u305f\u306f\u4e0d\u81ea\u7136\u306a\u8868\u73fe\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u56f0\u60d1\u5ea6\u306f\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>KenLM \u306f\u3001\u8907\u96d1\u3055\u3092\u8a08\u7b97\u3059\u308b\u305f\u3081\u306b\u6700\u3082\u4e00\u822c\u7684\u306b\u4f7f\u7528\u3055\u308c\u308b\u30c4\u30fc\u30eb\u3067\u3059\u3002 N-gram \u8a00\u8a9e\u30e2\u30c7\u30eb\u306b\u57fa\u3065\u3044\u3066\u304a\u308a\u3001\u975e\u5e38\u306b\u9ad8\u901f\u3067\u3001\u5927\u898f\u6a21\u306a\u30c7\u30fc\u30bf\u51e6\u7406\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002</p> <pre><code>import kenlm\n\nclass PerplexityFilter:\n    def __init__(self, model_path: str, max_perplexity: float = 500):\n        \"\"\"\n        Initialize perplexity filter\n\n        Args:\n            model_path: KenLM model path (.arpa or .bin)\n            max_perplexity: Perplexity threshold; documents exceeding this value will be filtered\n        \"\"\"\n        self.model = kenlm.Model(model_path)\n        self.max_perplexity = max_perplexity\n\n    def compute_perplexity(self, text: str) -&gt; float:\n        \"\"\"Compute text perplexity\"\"\"\n        # KenLM returns log10 probability\n        log_prob = self.model.score(text, bos=True, eos=True)\n        # Convert to perplexity\n        num_words = len(text.split()) + 1  # +1 for EOS\n        perplexity = 10 ** (-log_prob / num_words)\n        return perplexity\n\n    def filter(self, documents: list) -&gt; list:\n        \"\"\"Filter high-perplexity documents\"\"\"\n        results = []\n        for doc in documents:\n            ppl = self.compute_perplexity(doc['text'])\n            if ppl &lt;= self.max_perplexity:\n                doc['perplexity'] = ppl\n                results.append(doc)\n        return results\n</code></pre> <p>\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3\u306e\u3057\u304d\u3044\u5024\u8a2d\u5b9a\u306f\u3001\u7279\u5b9a\u306e\u30c7\u30fc\u30bf\u306b\u57fa\u3065\u3044\u3066\u8abf\u6574\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u822c\u306b\u3001\u9ad8\u54c1\u8cea\u306e\u30cb\u30e5\u30fc\u30b9\u3084\u767e\u79d1\u4e8b\u5178\u306e\u30c6\u30ad\u30b9\u30c8\u306e\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3\u306f 100 \uff5e 200\u3001\u901a\u5e38\u306e Web \u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3\u306f 200 \uff5e 500\u3001\u4f4e\u54c1\u8cea\u306e\u30b3\u30f3\u30c6\u30f3\u30c4 (\u610f\u5473\u4e0d\u660e\u3001\u6a5f\u68b0\u7ffb\u8a33\u306a\u3069) \u306f\u901a\u5e38 500 \u3092\u8d85\u3048\u307e\u3059\u3002\u6700\u521d\u306b\u5c0f\u3055\u306a\u30b5\u30f3\u30d7\u30eb\u3067\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3\u306e\u5206\u5e03\u3092\u5206\u6790\u3057\u3001\u6b21\u306b\u9069\u5207\u306a\u3057\u304d\u3044\u5024\u3092\u6c7a\u5b9a\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#413","title":"4.1.3 \u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af\u30eb\u30fc\u30eb\u30bb\u30c3\u30c8","text":"<p>\u8a00\u8a9e\u691c\u51fa\u3068\u8907\u96d1\u6027\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306b\u52a0\u3048\u3066\u3001\u660e\u3089\u304b\u306b\u4f4e\u54c1\u8cea\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u8fc5\u901f\u306b\u524a\u9664\u3067\u304d\u308b\u3001\u30b7\u30f3\u30d7\u30eb\u3060\u304c\u52b9\u679c\u7684\u306a\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30eb\u30fc\u30eb\u306e\u30bb\u30c3\u30c8\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30eb\u30fc\u30eb\u306f\u3001\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u304b\u3089\u306e\u89b3\u5bdf\u3068\u7d4c\u9a13\u306b\u57fa\u3065\u3044\u3066\u8a2d\u8a08\u3055\u308c\u3066\u3044\u307e\u3059\u3002</p> <p>\u9577\u3055\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306f\u6700\u3082\u57fa\u672c\u7684\u306a\u30eb\u30fc\u30eb\u3067\u3059\u3002\u77ed\u3059\u304e\u308b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (\u6570\u5358\u8a9e\u306e\u307f\u306e\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3 \u30c6\u30ad\u30b9\u30c8\u306a\u3069) \u306b\u306f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4fa1\u5024\u304c\u306a\u3044\u305f\u3081\u3001\u76f4\u63a5\u524a\u9664\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u9577\u3059\u304e\u308b\u5834\u5408\u306f\u3001\u5207\u308a\u8a70\u3081\u305f\u308a\u5206\u5272\u3057\u305f\u308a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u3057\u304d\u3044\u5024: \u6700\u5c0f\u9577\u306f 200 \u6587\u5b57\u307e\u305f\u306f 50 \u5358\u8a9e\u3001\u6700\u5927\u9577\u306f 100,000 \u6587\u5b57\u3067\u3059\u3002</p> <p>\u7279\u6b8a\u6587\u5b57\u306e\u6bd4\u7387 \u306b\u3088\u308a\u3001\u30ce\u30a4\u30ba\u306e\u591a\u3044\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u8b58\u5225\u3067\u304d\u307e\u3059\u3002\u6587\u66f8\u5185\u306e\u82f1\u6570\u5b57\u4ee5\u5916\u306e\u6587\u5b57\u306e\u5272\u5408\u304c\u9ad8\u3059\u304e\u308b\u5834\u5408\u306f\u3001\u30b3\u30fc\u30c9\u306e\u6b8b\u9ab8\u3001\u610f\u5473\u4e0d\u660e\u306a\u6587\u5b57\u3001\u307e\u305f\u306f\u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u540c\u69d8\u306b\u3001\u6841\u306e\u6bd4\u7387\u304c\u9ad8\u3059\u304e\u308b\u5834\u5408\u306f\u3001\u30ed\u30b0 \u30d5\u30a1\u30a4\u30eb\u307e\u305f\u306f\u30c7\u30fc\u30bf \u30c6\u30fc\u30d6\u30eb\u3092\u793a\u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u91cd\u8907\u884c\u6bd4\u7387 \u306b\u3088\u308a\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5316\u3055\u308c\u305f\u4f4e\u54c1\u8cea\u306e\u30da\u30fc\u30b8\u3092\u691c\u51fa\u3067\u304d\u307e\u3059\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u540c\u4e00\u306e\u884c\u304c\u591a\u6570\u3042\u308b\u5834\u5408 (\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3 \u30d0\u30fc\u304c\u8907\u6570\u306e\u5834\u6240\u3067\u7e70\u308a\u8fd4\u3055\u308c\u3066\u3044\u308b\u5834\u5408\u306a\u3069)\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u54c1\u8cea\u306f\u4f4e\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>\u8a9e\u5f59\u306e\u591a\u69d8\u6027\u306f\u3001\u6587\u66f8\u306e\u60c5\u5831\u306e\u8c4a\u5bcc\u3055\u3092\u6e2c\u5b9a\u3057\u307e\u3059\u3002 10 \u500b\u306e\u7570\u306a\u308b\u5358\u8a9e\u306e\u307f\u3092\u4f7f\u7528\u3059\u308b\u6587\u66f8\u306f\u3001500 \u500b\u306e\u7570\u306a\u308b\u5358\u8a9e\u3092\u4f7f\u7528\u3059\u308b\u6587\u66f8\u3088\u308a\u3082\u660e\u3089\u304b\u306b\u4fa1\u5024\u304c\u4f4e\u304f\u306a\u308a\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u6307\u6a19\u306f\u3001\u5408\u8a08\u5358\u8a9e\u306b\u5bfe\u3059\u308b\u4e00\u610f\u306e\u5358\u8a9e\u306e\u6bd4\u7387\u3067\u3042\u308b\u30bf\u30a4\u30d7 \u30c8\u30fc\u30af\u30f3\u6bd4 (TTR) \u3067\u3059\u3002</p> <p>\u4ee5\u4e0b\u306f\u5305\u62ec\u7684\u306a\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30fc\u306e\u5b9f\u88c5\u3067\u3059\u3002</p> <pre><code>import re\nfrom collections import Counter\n\nclass HeuristicFilter:\n    def __init__(self, config: dict = None):\n        \"\"\"\n        Initialize heuristic filter\n\n        Default config suitable for Chinese pre-training data\n        \"\"\"\n        self.config = config or {\n            'min_length': 200,           # Minimum character count\n            'max_length': 100000,        # Maximum character count\n            'min_words': 50,             # Minimum word count\n            'max_special_ratio': 0_3,    # Maximum special character ratio\n            'max_digit_ratio': 0_3,      # Maximum digit ratio\n            'max_duplicate_line_ratio': 0_3,  # Maximum duplicate line ratio\n            'min_avg_word_length': 2,    # Minimum average word length\n            'max_avg_word_length': 20,   # Maximum average word length\n            'min_unique_word_ratio': 0_1 # Minimum vocabulary diversity\n        }\n\n    def check_length(self, text: str) -&gt; bool:\n        \"\"\"Check document length\"\"\"\n        length = len(text)\n        return self.config['min_length'] &lt;= length &lt;= self.config['max_length']\n\n    def check_special_chars(self, text: str) -&gt; bool:\n        \"\"\"Check special character ratio\"\"\"\n        if len(text) == 0:\n            return False\n        special = len(re.findall(r'[^\\w\\s]', text, re.UNICODE))\n        ratio = special / len(text)\n        return ratio &lt;= self.config['max_special_ratio']\n\n    def check_digit_ratio(self, text: str) -&gt; bool:\n        \"\"\"Check digit ratio\"\"\"\n        if len(text) == 0:\n            return False\n        digits = len(re.findall(r'\\d', text))\n        ratio = digits / len(text)\n        return ratio &lt;= self.config['max_digit_ratio']\n\n    def check_duplicate_lines(self, text: str) -&gt; bool:\n        \"\"\"Check duplicate line ratio\"\"\"\n        lines = [line.strip() for line in text.split('\\n') if line.strip()]\n        if len(lines) == 0:\n            return False\n        unique_lines = len(set(lines))\n        duplicate_ratio = 1 - (unique_lines / len(lines))\n        return duplicate_ratio &lt;= self.config['max_duplicate_line_ratio']\n\n    def check_vocabulary_diversity(self, text: str) -&gt; bool:\n        \"\"\"Check vocabulary diversity\"\"\"\n        words = text.split()\n        if len(words) &lt; self.config['min_words']:\n            return False\n        unique_ratio = len(set(words)) / len(words)\n        return unique_ratio &gt;= self.config['min_unique_word_ratio']\n\n    def filter(self, text: str) -&gt; tuple:\n        \"\"\"\n        Apply all filtering rules\n\n        Returns:\n            (passed or not, failure reason or None)\n        \"\"\"\n        checks = [\n            (self.check_length, 'length'),\n            (self.check_special_chars, 'special_chars'),\n            (self.check_digit_ratio, 'digit_ratio'),\n            (self.check_duplicate_lines, 'duplicate_lines'),\n            (self.check_vocabulary_diversity, 'vocabulary_diversity')\n        ]\n\n        for check_func, name in checks:\n            if not check_func(text):\n                return False, name\n\n        return True, None\n</code></pre>"},{"location":"ja/part2/2_2_cleaning_denoising/#414","title":"4.1.4 \u54c1\u8cea\u968e\u5c64\u5316\u6226\u7565","text":"<p>\u5b9f\u969b\u306b\u306f\u3001\u5358\u306b\u30c7\u30fc\u30bf\u3092\u300c\u4fdd\u6301\u300d\u307e\u305f\u306f\u300c\u7834\u68c4\u300d\u3068\u3057\u3066\u4e8c\u9805\u306b\u5206\u985e\u3059\u308b\u306e\u306f\u5927\u96d1\u628a\u3059\u304e\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u3088\u308a\u6d17\u7df4\u3055\u308c\u305f\u30a2\u30d7\u30ed\u30fc\u30c1\u306f\u3001\u30c7\u30fc\u30bf\u3092\u54c1\u8cea\u3054\u3068\u306b\u968e\u5c64\u5316\u3057\u3001\u7570\u306a\u308b\u54c1\u8cea\u5c64\u306b\u7570\u306a\u308b\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u91cd\u307f\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u3067\u3059\u3002</p> <p>\u4e00\u822c\u7684\u306a\u968e\u5c64\u5316\u6226\u7565: \u30c7\u30fc\u30bf\u3092\u9ad8\u54c1\u8cea\u3001\u4e2d\u54c1\u8cea\u3001\u4f4e\u54c1\u8cea\u306e\u5c64\u306b\u5206\u5272\u3057\u307e\u3059\u3002\u9ad8\u54c1\u8cea\u306e\u30c7\u30fc\u30bf (\u4f8b: \u6a29\u5a01\u3042\u308b\u30b5\u30a4\u30c8\u304b\u3089\u306e\u3082\u306e\u3001\u3059\u3079\u3066\u306e\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30c1\u30a7\u30c3\u30af\u306b\u5408\u683c\u3057\u305f\u3082\u306e\u3001\u8907\u96d1\u3055\u304c\u4f4e\u3044\u3082\u306e) \u306f\u3001\u3088\u308a\u9ad8\u3044\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u91cd\u307f\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002\u4e2d\u54c1\u8cea\u306e\u30c7\u30fc\u30bf\u306f\u901a\u5e38\u306e\u91cd\u307f\u3092\u53d7\u3051\u53d6\u308a\u307e\u3059\u3002\u4f4e\u54c1\u8cea\u3060\u304c\u8a31\u5bb9\u3067\u304d\u308b\u30c7\u30fc\u30bf\u306b\u306f\u3001\u3088\u308a\u4f4e\u3044\u91cd\u307f\u304c\u4e0e\u3048\u3089\u308c\u307e\u3059\u3002\u3053\u306e\u6226\u7565\u306b\u3088\u308a\u3001\u30c7\u30fc\u30bf\u306e\u591a\u69d8\u6027\u3092\u78ba\u4fdd\u3057\u306a\u304c\u3089\u3001\u9ad8\u54c1\u8cea\u306e\u30c7\u30fc\u30bf\u304c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u3088\u308a\u5927\u304d\u306a\u5f79\u5272\u3092\u679c\u305f\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>RefinedWeb \u306e\u8ad6\u6587\u3067\u306f\u3001\u30c7\u30fc\u30bf\u3092 5 \u3064\u306e\u5c64\u306b\u5206\u5272\u3057\u3001\u305d\u308c\u305e\u308c\u306b\u7570\u306a\u308b\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u304d\u3044\u5024\u3092\u8a2d\u5b9a\u3057\u3066\u3001\u5c64\u5225\u5316\u6226\u7565\u3092\u8a73\u7d30\u306b\u6587\u66f8\u5316\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u6d17\u7df4\u3055\u308c\u305f\u54c1\u8cea\u7ba1\u7406\u306f\u3001\u9ad8\u54c1\u8cea\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u9375\u3068\u306a\u308a\u307e\u3059\u3002</p> <p></p> <p>\u56f3 4-2: \u30c7\u30fc\u30bf\u54c1\u8cea\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u30d5\u30a1\u30cd\u30eb \u2014 100% \u751f\u30c7\u30fc\u30bf\u304b\u3089\u6700\u7d42\u7684\u306a 4% \u306e\u30af\u30ea\u30fc\u30f3 \u30b3\u30fc\u30d1\u30b9\u307e\u3067\u306e\u968e\u5c64\u5316\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u30d7\u30ed\u30bb\u30b9</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#42","title":"4.2 \u5927\u898f\u6a21\u306a\u91cd\u8907\u6392\u9664","text":"<p>\u30c7\u30fc\u30bf\u306e\u91cd\u8907\u306f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u306e\u30c7\u30fc\u30bf\u306e\u6575\u3067\u3059\u3002 Common Crawl \u3067\u306f\u3001\u540c\u3058\u8a18\u4e8b\u304c\u8907\u6570\u306e Web \u30b5\u30a4\u30c8\u306b\u8ee2\u8f09\u3055\u308c\u305f\u308a\u3001\u540c\u3058 Web \u30da\u30fc\u30b8\u304c\u7570\u306a\u308b\u6708\u306b\u7e70\u308a\u8fd4\u3057\u30af\u30ed\u30fc\u30eb\u3055\u308c\u305f\u308a\u3057\u3066\u3001\u5927\u91cf\u306e\u91cd\u8907\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u767a\u751f\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u8abf\u67fb\u306b\u3088\u308b\u3068\u3001\u91cd\u8907\u6392\u9664\u3055\u308c\u3066\u3044\u306a\u3044\u30c7\u30fc\u30bf\u306b\u3088\u308a\u30e2\u30c7\u30eb\u304c\u7e70\u308a\u8fd4\u3055\u308c\u308b\u30b3\u30f3\u30c6\u30f3\u30c4\u306b\u904e\u5270\u9069\u5408\u3057\u3001\u30e2\u30c7\u30eb\u306e\u54c1\u8cea\u306b\u91cd\u5927\u306a\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u300c\u30aa\u30a6\u30e0\u300d\u73fe\u8c61\u304c\u767a\u751f\u3059\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u3066\u3044\u307e\u3059\u3002</p> <p>\u91cd\u8907\u6392\u9664\u306f 2 \u3064\u306e\u30ec\u30d9\u30eb\u306b\u5206\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u6b63\u78ba\u306a\u91cd\u8907\u6392\u9664\u3067\u306f\u540c\u4e00\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304c\u524a\u9664\u3055\u308c\u307e\u3059\u3002\u30d5\u30a1\u30b8\u30fc\u91cd\u8907\u6392\u9664\u306f\u3001\u975e\u5e38\u306b\u985e\u4f3c\u3057\u3066\u3044\u308b\u304c\u540c\u4e00\u3067\u306f\u306a\u3044\u6587\u66f8 (\u518d\u7248\u6642\u306b\u308f\u305a\u304b\u306b\u5909\u66f4\u3055\u308c\u305f\u8a18\u4e8b\u306a\u3069) \u3092\u524a\u9664\u3057\u307e\u3059\u3002 TB \u30b9\u30b1\u30fc\u30eb\u306e\u30c7\u30fc\u30bf\u3067\u306f\u3001\u3069\u3061\u3089\u306e\u30bf\u30a4\u30d7\u3067\u3082\u52b9\u7387\u7684\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u5206\u6563\u5b9f\u88c5\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#421","title":"4.2.1 \u6b63\u78ba\u306a\u91cd\u8907\u6392\u9664: \u30cf\u30c3\u30b7\u30e5\u65b9\u5f0f","text":"<p>\u6b63\u78ba\u306a\u91cd\u8907\u6392\u9664\u306e\u4e2d\u5fc3\u7684\u306a\u8003\u3048\u65b9\u306f\u3001\u5404\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u30d5\u30a3\u30f3\u30ac\u30fc\u30d7\u30ea\u30f3\u30c8\u3092\u8a08\u7b97\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u540c\u3058\u30d5\u30a3\u30f3\u30ac\u30fc\u30d7\u30ea\u30f3\u30c8\u3092\u6301\u3064\u6587\u66f8\u306f\u91cd\u8907\u3068\u307f\u306a\u3055\u308c\u307e\u3059\u3002\u6700\u3082\u5358\u7d14\u306a\u65b9\u6cd5\u306f\u3001MD5 \u3084 SHA256 \u306a\u3069\u306e\u30cf\u30c3\u30b7\u30e5\u95a2\u6570\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <pre><code>import hashlib\n\ndef compute_hash(text: str) -&gt; str:\n    \"\"\"Compute SHA256 hash of text\"\"\"\n    return hashlib.sha256(text.encode('utf-8')).hexdigest()\n\ndef exact_dedup(documents: list) -&gt; list:\n    \"\"\"Exact deduplication: keep first document for each hash value\"\"\"\n    seen_hashes = set()\n    results = []\n\n    for doc in documents:\n        doc_hash = compute_hash(doc['text'])\n        if doc_hash not in seen_hashes:\n            seen_hashes.add(doc_hash)\n            doc['hash'] = doc_hash\n            results.append(doc)\n\n    return results\n</code></pre> <p>\u5206\u6563\u30b7\u30ca\u30ea\u30aa\u306e\u5834\u5408\u3001Spark \u307e\u305f\u306f Ray \u3092\u4e26\u5217\u91cd\u8907\u6392\u9664\u306b\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</p> <pre><code>import ray\n\n@ray.remote\ndef compute_hashes_batch(documents: list) -&gt; list:\n    \"\"\"Batch compute hashes\"\"\"\n    return [(compute_hash(doc['text']), doc) for doc in documents]\n\ndef distributed_exact_dedup(documents_path: str, output_path: str):\n    \"\"\"Distributed exact deduplication\"\"\"\n    ds = ray.data.read_parquet(documents_path)\n\n    # Compute hashes\n    ds = ds.map(lambda doc: {**doc, 'hash': compute_hash(doc['text'])})\n\n    # Group by hash, keep first per group\n    ds = ds.groupby('hash').map_groups(lambda group: group.head(1))\n\n    # Save results\n    ds.write_parquet(output_path)\n</code></pre> <p>\u6b63\u78ba\u306a\u91cd\u8907\u6392\u9664\u306f\u52b9\u7387\u7684\u3067\u3059\u304c\u3001\u51e6\u7406\u3067\u304d\u308b\u306e\u306f\u540c\u4e00\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u307f\u3067\u3059\u3002\u308f\u305a\u304b\u306b\u7570\u306a\u308b\u91cd\u8907\u30b3\u30f3\u30c6\u30f3\u30c4 (\u4f8b: \u540c\u3058\u30cb\u30e5\u30fc\u30b9\u304c\u7570\u306a\u308b\u30d8\u30c3\u30c0\u30fc/\u30d5\u30c3\u30bf\u30fc\u3067\u7570\u306a\u308b\u30b5\u30a4\u30c8\u306b\u518d\u6295\u7a3f\u3055\u308c\u308b) \u306e\u5834\u5408\u3001\u6b63\u78ba\u306a\u91cd\u8907\u6392\u9664\u306f\u7121\u529b\u3067\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#422-minhash-lsh","title":"4.2.2 \u30d5\u30a1\u30b8\u30fc\u91cd\u8907\u6392\u9664: MinHash LSH","text":"<p>\u30d5\u30a1\u30b8\u30fc\u91cd\u8907\u6392\u9664\u306e\u76ee\u7684\u306f\u3001\u300c\u975e\u5e38\u306b\u985e\u4f3c\u3057\u3066\u3044\u308b\u304c\u540c\u4e00\u3067\u306f\u306a\u3044\u300d\u6587\u66f8\u3092\u8b58\u5225\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u306f\u8a08\u7b97\u7684\u306b\u8907\u96d1\u306a\u554f\u984c\u3067\u3059\u3002\u5358\u7d14\u306b 2 \u3064\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u6bd4\u8f03\u3059\u308b\u306b\u306f O(n\u00b2) \u6642\u9593\u306e\u8a08\u7b97\u91cf\u304c\u5fc5\u8981\u3067\u3059\u304c\u3001\u6570\u5341\u5104\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u306f\u307e\u3063\u305f\u304f\u5b9f\u884c\u4e0d\u53ef\u80fd\u3067\u3059\u3002</p> <p>MinHash LSH (Locality-Sensitive Hashing) \u306f\u3001\u3053\u306e\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306e\u30b3\u30a2 \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3059\u3002\u57fa\u672c\u7684\u306a\u8003\u3048\u65b9: \u6700\u521d\u306b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092 N-gram \u30bb\u30c3\u30c8\u306b\u5909\u63db\u3057\u3001\u6b21\u306b MinHash \u3092\u4f7f\u7528\u3057\u3066\u30bb\u30c3\u30c8\u3092\u56fa\u5b9a\u9577\u306e\u7f72\u540d\u306b\u5727\u7e2e\u3057\u3001\u6700\u5f8c\u306b LSH \u3092\u4f7f\u7528\u3057\u3066\u540c\u69d8\u306e\u7f72\u540d\u3092\u540c\u3058\u30d0\u30b1\u30c3\u30c8\u306b\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\u540c\u3058\u30d0\u30b1\u30c3\u30c8\u5185\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u30da\u30a2\u306e\u307f\u3092\u8a73\u7d30\u306b\u6bd4\u8f03\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u8a08\u7b97\u304c\u5927\u5e45\u306b\u524a\u6e1b\u3055\u308c\u307e\u3059\u3002</p> <p>MinHash LSH \u3092\u7406\u89e3\u3059\u308b\u306b\u306f\u3001\u6b21\u306e 3 \u3064\u306e\u624b\u9806\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u30b9\u30c6\u30c3\u30d7 1: n \u30b0\u30e9\u30e0\u5206\u89e3\u3002 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092 n \u30b0\u30e9\u30e0 (\u9023\u7d9a\u3059\u308b n \u6587\u5b57\u307e\u305f\u306f\u5358\u8a9e) \u306e\u30bb\u30c3\u30c8\u3068\u3057\u3066\u6271\u3044\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300c\u5927\u30e2\u30c7\u30eb\u30c7\u30fc\u30bf\u300d\u306e 3 \u30b0\u30e9\u30e0\u306e\u30bb\u30c3\u30c8\u306f\u3001{\"\u5927\u30e2\u30c7\u30eb\", \"\u30e2\u30c7\u30eb\u6570\", \"\u578b\u30c7\u30fc\u30bf\u30c7\u30fc\u30bf\"} \u3068\u306a\u308a\u307e\u3059\u3002\u6587\u66f8\u5168\u4f53\u3067\u306f\u306a\u304f N \u30b0\u30e9\u30e0\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u5c40\u6240\u7684\u306a\u985e\u4f3c\u6027\u304c\u3088\u308a\u9069\u5207\u306b\u6355\u6349\u3055\u308c\u307e\u3059\u3002</p> <p>\u30b9\u30c6\u30c3\u30d7 2: MinHash \u7f72\u540d\u3002 MinHash \u306f\u3001\u30bb\u30c3\u30c8\u3092\u56fa\u5b9a\u9577\u306e\u7f72\u540d\u306b\u5727\u7e2e\u3059\u308b\u305f\u3081\u306e\u6280\u8853\u3067\u3059\u3002 2 \u3064\u306e\u30bb\u30c3\u30c8\u9593\u306e Jaccard \u985e\u4f3c\u6027\u306f\u3001MinHash \u7f72\u540d\u306e\u4e00\u81f4\u5ea6\u306b\u3088\u3063\u3066\u8fd1\u4f3c\u3067\u304d\u307e\u3059\u3002\u7f72\u540d\u304c\u9577\u3044\u307b\u3069\u6b63\u78ba\u306a\u63a8\u5b9a\u5024\u304c\u5f97\u3089\u308c\u307e\u3059\u304c\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u3068\u8a08\u7b97\u306e\u30b3\u30b9\u30c8\u304c\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>\u30b9\u30c6\u30c3\u30d7 3: LSH \u30d0\u30b1\u30c3\u30c8\u5316\u3002 MinHash \u7f72\u540d\u3092\u8907\u6570\u306e\u30d0\u30f3\u30c9\u306b\u5206\u5272\u3057\u3001\u305d\u308c\u305e\u308c\u306b\u8907\u6570\u306e\u30cf\u30c3\u30b7\u30e5\u5024\u3092\u542b\u3081\u307e\u3059\u3002 2 \u3064\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u4efb\u610f\u306e\u30d0\u30f3\u30c9\u306e\u3059\u3079\u3066\u306e\u4f4d\u7f6e\u306b\u540c\u4e00\u306e\u30cf\u30c3\u30b7\u30e5\u5024\u304c\u3042\u308b\u5834\u5408\u3001\u305d\u308c\u3089\u306f\u540c\u3058\u30d0\u30b1\u30c3\u30c8\u306b\u914d\u7f6e\u3055\u308c\u307e\u3059\u3002\u30d0\u30f3\u30c9\u306e\u6570\u3068\u30d0\u30f3\u30c9 \u30b5\u30a4\u30ba\u3092\u8abf\u6574\u3059\u308b\u3053\u3068\u3067\u3001\u985e\u4f3c\u6027\u306e\u3057\u304d\u3044\u5024\u3068\u518d\u73fe\u7387\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002</p> <p>\u4ee5\u4e0b\u306f\u5b8c\u5168\u306a MinHash LSH \u5b9f\u88c5\u3067\u3059\u3002</p> <p></p> <p>\u56f3 4-3: MinHash LSH \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e 3 \u3064\u306e\u30b9\u30c6\u30c3\u30d7 \u2014 N \u30b0\u30e9\u30e0\u5206\u89e3\u3001MinHash \u7f72\u540d\u8a08\u7b97\u3001LSH \u30d0\u30b1\u30c3\u30c8\u5316\u3001\u8907\u96d1\u3055\u3092 O(n\u00b2) \u304b\u3089 O(n) \u306b\u524a\u6e1b</p> <pre><code>import hashlib\nimport struct\nfrom typing import Set, List, Tuple\nimport numpy as np\n\nclass MinHashLSH:\n    def __init__(self, \n                 num_hashes: int = 128,\n                 num_bands: int = 16,\n                 ngram_size: int = 5,\n                 threshold: float = 0_8):\n        \"\"\"\n        Initialize MinHash LSH\n\n        Args:\n            num_hashes: MinHash signature length\n            num_bands: Number of LSH bands\n            ngram_size: n-gram size\n            threshold: Similarity threshold (reference value, actual threshold determined by band params)\n        \"\"\"\n        self.num_hashes = num_hashes\n        self.num_bands = num_bands\n        self.rows_per_band = num_hashes // num_bands\n        self.ngram_size = ngram_size\n\n        # Generate random parameters for hash functions\n        self.hash_params = [\n            (np.random.randint(1, 2**31), np.random.randint(0, 2**31))\n            for _ in range(num_hashes)\n        ]\n\n        # LSH buckets\n        self.buckets = [{} for _ in range(num_bands)]\n\n    def get_ngrams(self, text: str) -&gt; Set[str]:\n        \"\"\"Extract n-gram set\"\"\"\n        text = text.lower().replace(' ', '')\n        ngrams = set()\n        for i in range(len(text) - self.ngram_size + 1):\n            ngrams.add(text[i:i + self.ngram_size])\n        return ngrams\n\n    def compute_minhash(self, ngrams: Set[str]) -&gt; np.ndarray:\n        \"\"\"Compute MinHash signature\"\"\"\n        signature = np.full(self.num_hashes, np.inf)\n\n        for ngram in ngrams:\n            # Compute base hash value for ngram\n            h = int(hashlib.md5(ngram.encode()).hexdigest(), 16)\n\n            # Use multiple hash functions\n            for i, (a, b) in enumerate(self.hash_params):\n                hash_val = (a * h + b) % (2**31 - 1)\n                if hash_val &lt; signature[i]:\n                    signature[i] = hash_val\n\n        return signature.astype(np.uint32)\n\n    def get_bands(self, signature: np.ndarray) -&gt; List[str]:\n        \"\"\"Split signature into bands\"\"\"\n        bands = []\n        for i in range(self.num_bands):\n            start = i * self.rows_per_band\n            end = start + self.rows_per_band\n            band = signature[start:end]\n            band_hash = hashlib.md5(band.tobytes()).hexdigest()\n            bands.append(band_hash)\n        return bands\n\n    def insert(self, doc_id: str, text: str):\n        \"\"\"Insert document into LSH index\"\"\"\n        ngrams = self.get_ngrams(text)\n        if len(ngrams) == 0:\n            return\n\n        signature = self.compute_minhash(ngrams)\n        bands = self.get_bands(signature)\n\n        for band_idx, band_hash in enumerate(bands):\n            if band_hash not in self.buckets[band_idx]:\n                self.buckets[band_idx][band_hash] = []\n            self.buckets[band_idx][band_hash].append(doc_id)\n\n    def find_candidates(self, text: str) -&gt; Set[str]:\n        \"\"\"Find candidate similar documents\"\"\"\n        ngrams = self.get_ngrams(text)\n        if len(ngrams) == 0:\n            return set()\n\n        signature = self.compute_minhash(ngrams)\n        bands = self.get_bands(signature)\n\n        candidates = set()\n        for band_idx, band_hash in enumerate(bands):\n            if band_hash in self.buckets[band_idx]:\n                candidates.update(self.buckets[band_idx][band_hash])\n\n        return candidates\n\ndef jaccard_similarity(set1: Set, set2: Set) -&gt; float:\n    \"\"\"Compute Jaccard similarity\"\"\"\n    intersection = len(set1 &amp; set2)\n    union = len(set1 | set2)\n    return intersection / union if union &gt; 0 else 0\n</code></pre>"},{"location":"ja/part2/2_2_cleaning_denoising/#423","title":"4.2.3 \u5206\u6563\u578b\u91cd\u8907\u6392\u9664\u306e\u5b9f\u8df5","text":"<p>TB \u898f\u6a21\u306e\u30c7\u30fc\u30bf\u3067 MinHash LSH \u3092\u5b9f\u884c\u3059\u308b\u306b\u306f\u3001\u614e\u91cd\u306b\u8a2d\u8a08\u3055\u308c\u305f\u5206\u6563\u6226\u7565\u304c\u5fc5\u8981\u3067\u3059\u3002\u4e00\u822c\u7684\u306a\u30d5\u30ed\u30fc\u306b\u306f\u6b21\u306e\u3082\u306e\u304c\u542b\u307e\u308c\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 1: \u7f72\u540d\u306e\u8a08\u7b97\u3002 \u3059\u3079\u3066\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u4e26\u884c\u3057\u3066\u8d70\u67fb\u3057\u3001\u305d\u308c\u305e\u308c\u306e MinHash \u7f72\u540d\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u3053\u306e\u30d5\u30a7\u30fc\u30ba\u306f\u5b8c\u5168\u306b\u4e26\u5217\u5316\u53ef\u80fd\u3067\u3042\u308a\u3001\u5206\u6563\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30ea\u30bd\u30fc\u30b9\u3092\u5341\u5206\u306b\u6d3b\u7528\u3067\u304d\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 2: \u30d0\u30f3\u30c9\u306e\u30b0\u30eb\u30fc\u30d7\u5316\u3002 \u5404\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u30d0\u30f3\u30c9\u5024\u3067\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u307e\u3059\u3002\u540c\u3058\u30d0\u30f3\u30c9\u5024\u3092\u6301\u3064\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u3001\u5f8c\u7d9a\u306e\u6bd4\u8f03\u306e\u305f\u3081\u306b\u540c\u3058\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u306b\u5272\u308a\u5f53\u3066\u3089\u308c\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 3: \u30b0\u30eb\u30fc\u30d7\u5185\u91cd\u8907\u6392\u9664\u3002 \u5404\u30d1\u30fc\u30c6\u30a3\u30b7\u30e7\u30f3\u5185\u3067\u3001\u5019\u88dc\u306e\u91cd\u8907\u30da\u30a2\u306b\u5bfe\u3057\u3066\u8a73\u7d30\u306a\u985e\u4f3c\u5ea6\u8a08\u7b97\u3092\u5b9f\u884c\u3057\u3066\u3001\u771f\u306e\u91cd\u8907\u95a2\u4fc2\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 4: \u63a8\u79fb\u9589\u5305\u3002 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 A \u304c B \u3092\u8907\u88fd\u3057\u3001B \u304c C \u3092\u8907\u88fd\u3059\u308b\u5834\u5408\u3001A\u3001B\u3001C \u306f\u3059\u3079\u3066 1 \u3064\u306e\u91cd\u8907\u30b0\u30eb\u30fc\u30d7\u3068\u307f\u306a\u3055\u308c\u307e\u3059\u3002\u91cd\u8907\u3057\u305f\u95a2\u4fc2\u306e\u63a8\u79fb\u9589\u5305\u3092\u8a08\u7b97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 5: \u4fdd\u6301\u3059\u308b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u9078\u629e\u3057\u307e\u3059\u3002 \u5404\u91cd\u8907\u30b0\u30eb\u30fc\u30d7\u5185\u3067\u3001\u4fdd\u6301\u3059\u308b\u4ee3\u8868 (\u901a\u5e38\u306f\u6700\u9ad8\u54c1\u8cea\u307e\u305f\u306f\u6700\u9577) \u3092 1 \u3064\u9078\u629e\u3057\u3001\u6b8b\u308a\u3092\u524a\u9664\u3057\u307e\u3059\u3002</p> <pre><code>import ray\n\ndef distributed_fuzzy_dedup(input_path: str, output_path: str, \n                            threshold: float = 0_8):\n    \"\"\"\n    Distributed fuzzy deduplication pipeline\n    \"\"\"\n    # Read data\n    ds = ray.data.read_parquet(input_path)\n\n    # Phase 1: Compute MinHash signatures\n    def compute_signature(doc):\n        lsh = MinHashLSH()\n        ngrams = lsh.get_ngrams(doc['text'])\n        signature = lsh.compute_minhash(ngrams)\n        bands = lsh.get_bands(signature)\n        return {**doc, 'signature': signature.tolist(), 'bands': bands}\n\n    ds = ds.map(compute_signature)\n\n    # Phase 2: Group by band value, find candidate pairs\n    # (Simplified here, actual implementation needs more complex grouping logic)\n\n    # Phase 3&amp;4: Intra-group exact comparison, build duplicate relationship graph\n    # ...\n\n    # Phase 5: Select retained documents\n    # ...\n\n    # Save results\n    ds.write_parquet(output_path)\n</code></pre> <p>\u5b9f\u969b\u306e\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3067\u306f\u3001\u65e2\u5b58\u306e\u30c4\u30fc\u30eb\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 text-dedup \u306f\u3001Spark \u304a\u3088\u3073 Ray \u5206\u6563\u5b9f\u88c5\u3092\u5099\u3048\u305f MinHash LSH\u3001SimHash\u3001Suffix Array \u306a\u3069\u306e\u3055\u307e\u3056\u307e\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u5b9f\u88c5\u3059\u308b\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u306e\u30c6\u30ad\u30b9\u30c8\u91cd\u8907\u6392\u9664\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3059\u3002 Dolma \u306e\u91cd\u8907\u6392\u9664\u30e2\u30b8\u30e5\u30fc\u30eb\u3082\u9ad8\u54c1\u8cea\u306e\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u5b9f\u88c5\u3067\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#424","title":"4.2.4 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u306e\u91cd\u8907\u6392\u9664","text":"<p>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u30ec\u30d9\u30eb\u306e\u91cd\u8907\u6392\u9664\u306b\u52a0\u3048\u3066\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u306e\u91cd\u8907\u30b3\u30f3\u30c6\u30f3\u30c4\u3082\u51e6\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u30b1\u30fc\u30b9\u3068\u3057\u3066\u306f\u3001Web \u30da\u30fc\u30b8\u4e0a\u3067\u7e70\u308a\u8fd4\u3057\u8868\u793a\u3055\u308c\u308b\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3 \u30d0\u30fc\u3001\u30d8\u30c3\u30c0\u30fc\u3001\u30d5\u30c3\u30bf\u30fc\u304c\u6319\u3052\u3089\u308c\u307e\u3059\u3002 JavaScript \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0\u306e\u554f\u984c\u306b\u3088\u308b\u30b3\u30f3\u30c6\u30f3\u30c4\u306e\u91cd\u8907\u3002\u7279\u5b9a\u306e CMS \u30b7\u30b9\u30c6\u30e0\u306b\u3088\u3063\u3066\u751f\u6210\u3055\u308c\u308b\u3001\u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u5316\u3055\u308c\u305f\u91cd\u8907\u3057\u305f\u6bb5\u843d\u3002</p> <p>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u306e\u91cd\u8907\u6392\u9664\u6226\u7565\u306f\u6bd4\u8f03\u7684\u5358\u7d14\u3067\u3059\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u6bb5\u843d\u307e\u305f\u306f\u56fa\u5b9a\u9577\u306e\u30c1\u30e3\u30f3\u30af\u306b\u5206\u5272\u3057\u3001\u5404\u30c1\u30e3\u30f3\u30af\u306e\u30cf\u30c3\u30b7\u30e5\u3092\u8a08\u7b97\u3057\u3001\u91cd\u8907\u3059\u308b\u30c1\u30e3\u30f3\u30af\u3092\u524a\u9664\u3057\u307e\u3059\u3002</p> <pre><code>def remove_duplicate_paragraphs(text: str, min_length: int = 50) -&gt; str:\n    \"\"\"Remove duplicate paragraphs within document\"\"\"\n    paragraphs = text.split('\\n\\n')\n    seen_hashes = set()\n    unique_paragraphs = []\n\n    for para in paragraphs:\n        para = para.strip()\n        if len(para) &lt; min_length:\n            unique_paragraphs.append(para)\n            continue\n\n        para_hash = hashlib.md5(para.encode()).hexdigest()\n        if para_hash not in seen_hashes:\n            seen_hashes.add(para_hash)\n            unique_paragraphs.append(para)\n\n    return '\\n\\n'.join(unique_paragraphs)\n\ndef remove_duplicate_ngrams(text: str, n: int = 10, threshold: int = 3) -&gt; str:\n    \"\"\"Remove high-frequency duplicate n-grams within document\"\"\"\n    words = text.split()\n    ngram_counts = Counter()\n\n    # Compute n-gram frequencies\n    for i in range(len(words) - n + 1):\n        ngram = tuple(words[i:i + n])\n        ngram_counts[ngram] += 1\n\n    # Mark positions to remove\n    remove_positions = set()\n    for i in range(len(words) - n + 1):\n        ngram = tuple(words[i:i + n])\n        if ngram_counts[ngram] &gt;= threshold:\n            # Keep first occurrence, remove subsequent duplicates\n            for j in range(i + n, len(words) - n + 1):\n                if tuple(words[j:j + n]) == ngram:\n                    for k in range(j, min(j + n, len(words))):\n                        remove_positions.add(k)\n\n    # Rebuild text\n    result_words = [w for i, w in enumerate(words) if i not in remove_positions]\n    return ' '.join(result_words)\n</code></pre>"},{"location":"ja/part2/2_2_cleaning_denoising/#43-pii","title":"4.3 \u30d7\u30e9\u30a4\u30d0\u30b7\u30fc \u30c7\u30fc\u30bf\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 (PII \u306e\u524a\u9664)","text":"<p>\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u306e\u30c7\u30fc\u30bf\u306b\u306f\u3001\u96fb\u5b50\u30e1\u30fc\u30eb \u30a2\u30c9\u30ec\u30b9\u3001\u96fb\u8a71\u756a\u53f7\u3001ID \u756a\u53f7\u3001\u9280\u884c\u30ab\u30fc\u30c9\u756a\u53f7\u3001\u81ea\u5b85\u306e\u4f4f\u6240\u306a\u3069\u306e\u500b\u4eba\u3092\u7279\u5b9a\u3067\u304d\u308b\u60c5\u5831 (PII) \u304c\u5fc5\u7136\u7684\u306b\u542b\u307e\u308c\u307e\u3059\u3002\u4eca\u65e5\u306e\u30c7\u30fc\u30bf \u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u8981\u4ef6 (GDPR\u3001CCPA\u3001\u500b\u4eba\u60c5\u5831\u4fdd\u8b77\u6cd5\u306a\u3069) \u304c\u307e\u3059\u307e\u3059\u53b3\u3057\u304f\u306a\u3063\u3066\u3044\u308b\u305f\u3081\u3001PII \u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306f\u9053\u7fa9\u7684\u8cac\u4efb\u3060\u3051\u3067\u306a\u304f\u3001\u6cd5\u7684\u7fa9\u52d9\u3067\u3082\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#431-pii","title":"4.3.1 PII \u306e\u7a2e\u985e\u3068\u30ea\u30b9\u30af","text":"<p>PII \u306f\u3001\u76f4\u63a5\u8b58\u5225\u5b50\u3068\u6e96\u8b58\u5225\u5b50\u306b\u5206\u985e\u3067\u304d\u307e\u3059\u3002\u76f4\u63a5\u8b58\u5225\u5b50\u306f\u3001\u540d\u524d\u3001ID \u756a\u53f7\u3001\u793e\u4f1a\u4fdd\u969c\u756a\u53f7\u3001\u96fb\u8a71\u756a\u53f7\u3001\u96fb\u5b50\u30e1\u30fc\u30eb \u30a2\u30c9\u30ec\u30b9\u306a\u3069\u3001\u5358\u72ec\u3067\u500b\u4eba\u3092\u8b58\u5225\u3067\u304d\u307e\u3059\u3002\u6e96\u8b58\u5225\u5b50\u3060\u3051\u3067\u306f\u500b\u4eba\u3092\u7279\u5b9a\u3059\u308b\u3053\u3068\u306f\u56f0\u96e3\u3067\u3059\u304c\u3001\u751f\u5e74\u6708\u65e5\u3001\u90f5\u4fbf\u756a\u53f7\u3001\u8077\u696d\u3001\u96c7\u7528\u4e3b\u306a\u3069\u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u500b\u4eba\u7279\u5b9a\u306b\u3064\u306a\u304c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>PII \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u30c7\u30fc\u30bf\u306b\u4fdd\u6301\u3059\u308b\u3068\u3001\u8907\u6570\u306e\u30ea\u30b9\u30af\u304c\u4f34\u3044\u307e\u3059\u3002 1 \u3064\u76ee\u306f\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc\u6f0f\u6d29\u306e\u30ea\u30b9\u30af\u3067\u3059\u3002\u30e2\u30c7\u30eb\u306f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u5185\u306e\u6a5f\u5bc6\u60c5\u5831\u3092\u300c\u8a18\u61b6\u300d\u3057\u3001\u63a8\u8ad6\u4e2d\u306b\u60aa\u610f\u3092\u6301\u3063\u3066\u62bd\u51fa\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 2 \u3064\u76ee\u306f\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u306e\u30ea\u30b9\u30af\u3067\u3059\u3002\u30c7\u30fc\u30bf\u4fdd\u8b77\u898f\u5236\u306b\u9055\u53cd\u3059\u308b\u3068\u3001\u5de8\u984d\u306e\u7f70\u91d1\u304c\u79d1\u305b\u3089\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u6700\u5f8c\u306b\u8a55\u5224\u30ea\u30b9\u30af\u3067\u3059\u3002\u30e2\u30c7\u30eb\u304c\u4ed6\u4eba\u306e\u500b\u4eba\u60c5\u5831\u3092\u51fa\u529b\u3059\u308b\u3068\u3001\u4f01\u696d\u306e\u30a4\u30e1\u30fc\u30b8\u306b\u91cd\u5927\u306a\u30c0\u30e1\u30fc\u30b8\u3092\u4e0e\u3048\u307e\u3059\u3002</p> <p></p> <p>\u56f3 4-4: PII \u306e\u7a2e\u985e\u3068\u30ea\u30b9\u30af \u30ec\u30d9\u30eb \u2014 \u76f4\u63a5\u8b58\u5225\u5b50 (\u9ad8\u30ea\u30b9\u30af) \u3068\u6e96\u8b58\u5225\u5b50 (\u4e2d\u30ea\u30b9\u30af) \u306e\u5206\u985e</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#432-microsoft-presidio","title":"4.3.2 Microsoft Presidio","text":"<p>Presidio \u306f\u3001Microsoft \u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 PII \u691c\u51fa\u304a\u3088\u3073\u533f\u540d\u5316\u30c4\u30fc\u30eb\u30ad\u30c3\u30c8\u3067\u3042\u308a\u3001\u8907\u6570\u306e\u8a00\u8a9e\u3068 PII \u30bf\u30a4\u30d7\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f\u30012 \u3064\u306e\u30b3\u30a2 \u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u5099\u3048\u305f\u30e2\u30b8\u30e5\u30e9\u30fc\u8a2d\u8a08\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u30a2\u30ca\u30e9\u30a4\u30b6\u30fc\u306f\u30c6\u30ad\u30b9\u30c8\u5185\u306e PII \u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u306e\u8b58\u5225\u3092\u62c5\u5f53\u3057\u3001\u30a2\u30ce\u30cb\u30de\u30a4\u30b6\u30fc\u306f\u8b58\u5225\u3055\u308c\u305f PII \u306e\u51e6\u7406 (\u7f6e\u63db\u3001\u30de\u30b9\u30ad\u30f3\u30b0\u3001\u524a\u9664\u306a\u3069) \u3092\u62c5\u5f53\u3057\u307e\u3059\u3002</p> <pre><code>from presidio_analyzer import AnalyzerEngine\nfrom presidio_anonymizer import AnonymizerEngine\nfrom presidio_anonymizer.entities import OperatorConfig\n\n# Initialize engines\nanalyzer = AnalyzerEngine()\nanonymizer = AnonymizerEngine()\n\ndef analyze_pii(text: str, language: str = 'en') -&gt; list:\n    \"\"\"\n    Identify PII in text\n\n    Returns:\n        List of PII entities with type, position, and confidence\n    \"\"\"\n    results = analyzer.analyze(\n        text=text,\n        language=language,\n        entities=[\n            'EMAIL_ADDRESS', 'PHONE_NUMBER', 'CREDIT_CARD',\n            'IP_ADDRESS', 'PERSON', 'LOCATION', 'DATE_TIME'\n        ]\n    )\n    return results\n\ndef anonymize_pii(text: str, language: str = 'en') -&gt; str:\n    \"\"\"\n    Anonymize PII in text\n\n    Replace identified PII with placeholders\n    \"\"\"\n    # First identify\n    analyzer_results = analyzer.analyze(text=text, language=language)\n\n    # Define anonymization strategy\n    operators = {\n        'EMAIL_ADDRESS': OperatorConfig('replace', {'new_value': '&lt;EMAIL&gt;'}),\n        'PHONE_NUMBER': OperatorConfig('replace', {'new_value': '&lt;PHONE&gt;'}),\n        'CREDIT_CARD': OperatorConfig('replace', {'new_value': '&lt;CREDIT_CARD&gt;'}),\n        'IP_ADDRESS': OperatorConfig('replace', {'new_value': '&lt;IP&gt;'}),\n        'PERSON': OperatorConfig('replace', {'new_value': '&lt;PERSON&gt;'}),\n        'LOCATION': OperatorConfig('replace', {'new_value': '&lt;LOCATION&gt;'}),\n        'DATE_TIME': OperatorConfig('keep', {})  # Dates/times can usually be kept\n    }\n\n    # Anonymize\n    anonymized = anonymizer.anonymize(\n        text=text,\n        analyzer_results=analyzer_results,\n        operators=operators\n    )\n\n    return anonymized.text\n</code></pre>"},{"location":"ja/part2/2_2_cleaning_denoising/#433-pii","title":"4.3.3 \u4e2d\u56fd\u306e PII \u306e\u51e6\u7406","text":"<p>Presidio \u3067\u306f\u4e2d\u56fd\u8a9e\u306e\u30b5\u30dd\u30fc\u30c8\u304c\u6bd4\u8f03\u7684\u9650\u5b9a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u4e2d\u56fd\u8a9e\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u5834\u5408\u306f\u3001\u901a\u5e38\u3001\u30eb\u30fc\u30eb\u30d9\u30fc\u30b9\u306e\u30de\u30c3\u30c1\u30f3\u30b0\u3092\u6b63\u898f\u8868\u73fe\u3067\u88dc\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <pre><code>import re\n\nclass ChinesePIIFilter:\n    \"\"\"Chinese PII filter\"\"\"\n\n    patterns = {\n        'phone': [\n            r'1[3-9]\\d{9}',  # Mobile number\n            r'0\\d{2,3}-?\\d{7,8}',  # Landline\n        ],\n        'id_card': [\n            r'\\d{17}[\\dXx]',  # 18-digit ID\n            r'\\d{15}',  # 15-digit ID\n        ],\n        'email': [\n            r'[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}',\n        ],\n        'bank_card': [\n            r'\\d{16,19}',  # Bank card number (needs context judgment)\n        ],\n        'ip_address': [\n            r'\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}',\n        ],\n        'qq': [\n            r'[Qq][Qq][:\uff1a]?\\s*\\d{5,11}',\n            r'[Qq][:\uff1a]?\\s*\\d{5,11}',\n        ],\n        'wechat': [\n            r'[Vv][Xx][:\uff1a]?\\s*[a-zA-Z0-9_-]{6,20}',\n            r'\u5fae\u4fe1[:\uff1a]?\\s*[a-zA-Z0-9_-]{6,20}',\n        ],\n    }\n\n    def __init__(self):\n        self.compiled_patterns = {}\n        for pii_type, patterns in self.patterns.items():\n            self.compiled_patterns[pii_type] = [\n                re.compile(p) for p in patterns\n            ]\n\n    def find_pii(self, text: str) -&gt; list:\n        \"\"\"Find all PII\"\"\"\n        findings = []\n        for pii_type, patterns in self.compiled_patterns.items():\n            for pattern in patterns:\n                for match in pattern.finditer(text):\n                    findings.append({\n                        'type': pii_type,\n                        'value': match.group(),\n                        'start': match.start(),\n                        'end': match.end()\n                    })\n        return findings\n\n    def anonymize(self, text: str) -&gt; str:\n        \"\"\"Anonymize PII\"\"\"\n        findings = self.find_pii(text)\n\n        # Process in reverse order by position to avoid affecting subsequent positions\n        findings.sort(key=lambda x: x['start'], reverse=True)\n\n        for finding in findings:\n            placeholder = f\"&lt;{finding['type'].upper()}&gt;\"\n            text = text[:finding['start']] + placeholder + text[finding['end']:]\n\n        return text\n</code></pre>"},{"location":"ja/part2/2_2_cleaning_denoising/#434-pii","title":"4.3.4 PII \u51e6\u7406\u6226\u7565\u306e\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5","text":"<p>PII \u51e6\u7406\u306f\u3001\u7cbe\u5ea6\u3068\u518d\u73fe\u7387\u306e\u9593\u306e\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5\u306b\u76f4\u9762\u3057\u307e\u3059\u3002\u904e\u5ea6\u306b\u7a4d\u6975\u7684\u306a\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306f\u3001\u901a\u5e38\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u8aa4\u3063\u3066\u524a\u9664\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\uff08\u305f\u3068\u3048\u3070\u3001\u901a\u5e38\u306e\u756a\u53f7\u30b7\u30fc\u30b1\u30f3\u30b9\u3092\u96fb\u8a71\u756a\u53f7\u3068\u3057\u3066\u8aa4\u8a8d\u3059\u308b\u306a\u3069\uff09\u3002\u4e00\u65b9\u3001\u904e\u5ea6\u306b\u4fdd\u5b88\u7684\u306a\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306f\u3001\u771f\u306e\u6a5f\u5bc6\u60c5\u5831\u3092\u898b\u9003\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u5b9f\u969b\u306b\u306f\u3001\u5c64\u5225\u6226\u7565\u304c\u63a8\u5968\u3055\u308c\u307e\u3059\u3002\u30ea\u30b9\u30af\u306e\u9ad8\u3044 PII (ID \u756a\u53f7\u3001\u9280\u884c\u30ab\u30fc\u30c9\u756a\u53f7\u306a\u3069) \u306e\u5834\u5408\u306f\u3001\u3088\u308a\u53b3\u5bc6\u306a\u4e00\u81f4\u30eb\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u898b\u9003\u3059\u3088\u308a\u306f\u904e\u5270\u306b\u30d5\u30a3\u30eb\u30bf\u30fc\u3059\u308b\u65b9\u304c\u826f\u3044\u3067\u3057\u3087\u3046\u3002\u4e2d\u30ea\u30b9\u30af\u306e PII (\u96fb\u8a71\u756a\u53f7\u3001\u96fb\u5b50\u30e1\u30fc\u30eb\u306a\u3069) \u306e\u5834\u5408\u306f\u3001\u4e2d\u7a0b\u5ea6\u306e\u3057\u304d\u3044\u5024\u3092\u4f7f\u7528\u3057\u3066\u7cbe\u5ea6\u3068\u518d\u73fe\u7387\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u3068\u308a\u307e\u3059\u3002\u30ea\u30b9\u30af\u306e\u4f4e\u3044\u60c5\u5831 (\u65e5\u4ed8\u3001\u5834\u6240\u306a\u3069) \u306b\u3064\u3044\u3066\u306f\u3001\u7279\u5b9a\u306e\u30b7\u30ca\u30ea\u30aa\u306b\u57fa\u3065\u3044\u3066\u51e6\u7406\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002</p> <p>\u3082\u3046 1 \u3064\u306e\u91cd\u8981\u306a\u6c7a\u5b9a\u306f\u3001\u4ee3\u66ff\u6226\u7565\u3067\u3059\u3002\u4e00\u822c\u7684\u306a\u9078\u629e\u80a2\u3068\u3057\u3066\u306f\u3001\u6b21\u306e\u3082\u306e\u304c\u6319\u3052\u3089\u308c\u307e\u3059\u3002\u5b8c\u5168\u306a\u524a\u9664\u3002\u5358\u7d14\u3067\u3059\u304c\u3001\u6587\u7ae0\u306e\u6d41\u66a2\u6027\u304c\u640d\u306a\u308f\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u7f6e\u63db (<code>&lt;EMAIL&gt;</code> \u306a\u3069) \u304c\u4fee\u6b63\u3055\u308c\u3001\u610f\u5473\u60c5\u5831\u306f\u4fdd\u6301\u3055\u308c\u307e\u3059\u304c\u3001\u4e0d\u81ea\u7136\u306a\u30d1\u30bf\u30fc\u30f3\u304c\u751f\u3058\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30e9\u30f3\u30c0\u30e0\u751f\u6210\u7f6e\u63db (\u4f8b: \u5b9f\u969b\u306e\u96fb\u5b50\u30e1\u30fc\u30eb\u3092\u30e9\u30f3\u30c0\u30e0\u306a\u96fb\u5b50\u30e1\u30fc\u30eb\u306b\u7f6e\u304d\u63db\u3048\u308b)\u3002\u5143\u306e\u914d\u5e03\u306b\u6700\u3082\u8fd1\u3044\u3067\u3059\u304c\u3001\u5b9f\u88c5\u304c\u8907\u96d1\u3067\u3059\u3002\u307b\u3068\u3093\u3069\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u3001\u7cbe\u5ea6\u3068\u8907\u96d1\u3055\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u3068\u308b\u305f\u3081\u306b\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u7f6e\u63db\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#44","title":"4.4 \u5b8c\u5168\u306a\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u4e0a\u8a18\u3067\u7d39\u4ecb\u3057\u305f\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u63a5\u7d9a\u3057\u3066\u3001\u5b8c\u5168\u306a\u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#441","title":"4.4.1 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":"<p>\u5de5\u696d\u7528\u30b0\u30ec\u30fc\u30c9\u306e\u6d17\u6d44\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306b\u306f\u901a\u5e38\u3001\u6b21\u306e\u30b9\u30c6\u30fc\u30b8\u304c\u542b\u307e\u308c\u3066\u304a\u308a\u3001\u9806\u756a\u306b\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 1: \u5f62\u5f0f\u306e\u6a19\u6e96\u5316\u3002 \u3055\u307e\u3056\u307e\u306a\u30bd\u30fc\u30b9\u304b\u3089\u306e\u30c7\u30fc\u30bf\u3092\u7d71\u4e00\u5f62\u5f0f\u306b\u5909\u63db\u3057\u3001\u30a8\u30f3\u30b3\u30fc\u30c9\u306e\u554f\u984c\u3092\u51e6\u7406\u3057\u3001\u5fc5\u8981\u306a\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u62bd\u51fa\u3057\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 2: \u8a00\u8a9e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u8a00\u8a9e\u691c\u51fa\u306b FastText \u3092\u4f7f\u7528\u3057\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u30bf\u30fc\u30b2\u30c3\u30c8\u8a00\u8a9e\u3067\u4fdd\u6301\u3057\u307e\u3059\u3002\u6df7\u5408\u8a00\u8a9e\u306e\u6587\u66f8\u306e\u5834\u5408\u306f\u3001\u4e3b\u8a00\u8a9e\u3054\u3068\u306b\u5206\u985e\u3057\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 3: \u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u9577\u3055\u3001\u7279\u6b8a\u6587\u5b57\u3001\u91cd\u8907\u884c\u306a\u3069\u306b\u95a2\u3059\u308b\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30eb\u30fc\u30eb\u3092\u9069\u7528\u3057\u3066\u3001\u660e\u3089\u304b\u306b\u4f4e\u54c1\u8cea\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u8fc5\u901f\u306b\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 4: \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u306e\u91cd\u8907\u6392\u9664\u3002 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u306e\u91cd\u8907\u3057\u305f\u6bb5\u843d\u3068 N \u30b0\u30e9\u30e0\u3092\u524a\u9664\u3057\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 5: PII \u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u6a5f\u5bc6\u306e\u500b\u4eba\u60c5\u5831\u3092\u7279\u5b9a\u3057\u3001\u533f\u540d\u5316\u3057\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 6: \u54c1\u8cea\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u3002 \u8907\u96d1\u3055\u306a\u3069\u306e\u54c1\u8cea\u6307\u6a19\u3092\u8a08\u7b97\u3057\u3066\u3001\u305d\u306e\u5f8c\u306e\u54c1\u8cea\u968e\u5c64\u5316\u306e\u57fa\u790e\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 7: \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u9593\u306e\u91cd\u8907\u6392\u9664\u3002 MinHash LSH \u3092\u4f7f\u7528\u3057\u3066\u5927\u898f\u6a21\u306a\u30d5\u30a1\u30b8\u30fc\u91cd\u8907\u6392\u9664\u3092\u884c\u3044\u3001\u985e\u4f3c\u6027\u306e\u9ad8\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u524a\u9664\u3057\u307e\u3059\u3002</p> <p>\u30d5\u30a7\u30fc\u30ba 8: \u54c1\u8cea\u306e\u968e\u5c64\u5316\u3068\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3002 \u54c1\u8cea\u30b9\u30b3\u30a2\u306b\u3088\u3063\u3066\u30c7\u30fc\u30bf\u3092\u968e\u5c64\u5316\u3057\u3001\u5404\u5c64\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u306e\u91cd\u307f\u3092\u6c7a\u5b9a\u3057\u307e\u3059\u3002</p> <pre><code>import ray\nfrom dataclasses import dataclass\nfrom typing import Optional\n\n@dataclass\nclass CleaningConfig:\n    \"\"\"Cleaning configuration\"\"\"\n    target_language: str = 'zh'\n    min_length: int = 200\n    max_length: int = 100000\n    max_perplexity: float = 500\n    dedup_threshold: float = 0_8\n    anonymize_pii: bool = True\n\nclass DataCleaningPipeline:\n    def __init__(self, config: CleaningConfig):\n        self.config = config\n        self.lang_filter = LanguageFilter(config.target_language)\n        self.heuristic_filter = HeuristicFilter()\n        self.perplexity_filter = PerplexityFilter(max_ppl=config.max_perplexity)\n        self.pii_filter = ChinesePIIFilter() if config.target_language == 'zh' else None\n        self.deduplicator = MinHashLSH(threshold=config.dedup_threshold)\n\n    def process_document(self, doc: dict) -&gt; Optional[dict]:\n        \"\"\"Process single document\"\"\"\n        text = doc.get('text', '')\n\n        # Phase 2: Language filtering\n        lang, conf = self.lang_filter.detect(text)\n        if lang != self.config.target_language:\n            return None\n\n        # Phase 3: Heuristic filtering\n        passed, reason = self.heuristic_filter.filter(text)\n        if not passed:\n            return None\n\n        # Phase 4: Intra-document deduplication\n        text = remove_duplicate_paragraphs(text)\n\n        # Phase 5: PII cleaning\n        if self.config.anonymize_pii and self.pii_filter:\n            text = self.pii_filter.anonymize(text)\n\n        # Phase 6: Quality scoring\n        perplexity = self.perplexity_filter.compute_perplexity(text)\n        if perplexity &gt; self.config.max_perplexity:\n            return None\n\n        return {\n            **doc,\n            'text': text,\n            'language': lang,\n            'lang_confidence': conf,\n            'perplexity': perplexity\n        }\n\n    def run(self, input_path: str, output_path: str):\n        \"\"\"Run complete pipeline\"\"\"\n        # Read data\n        ds = ray.data.read_parquet(input_path)\n\n        # Phases 1-6: Single document processing\n        ds = ds.map(self.process_document)\n        ds = ds.filter(lambda x: x is not None)\n\n        # Phase 7: Inter-document deduplication\n        ds = self.deduplicator.deduplicate(ds)\n\n        # Save results\n        ds.write_parquet(output_path)\n</code></pre>"},{"location":"ja/part2/2_2_cleaning_denoising/#442","title":"4.4.2 \u54c1\u8cea\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0\u3068\u53cd\u5fa9","text":"<p>\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306f 1 \u56de\u9650\u308a\u306e\u30bf\u30b9\u30af\u3067\u306f\u306a\u304f\u3001\u7d99\u7d9a\u7684\u306a\u76e3\u8996\u3068\u53cd\u5fa9\u7684\u306a\u6700\u9069\u5316\u304c\u5fc5\u8981\u306a\u30d7\u30ed\u30bb\u30b9\u3067\u3059\u3002\u6b21\u306e\u76e3\u8996\u30e1\u30ab\u30cb\u30ba\u30e0\u304c\u63a8\u5968\u3055\u308c\u307e\u3059\u3002</p> <p>\u30d5\u30a3\u30eb\u30bf \u30ec\u30fc\u30c8\u306e\u30e2\u30cb\u30bf\u30ea\u30f3\u30b0: \u5404\u30b9\u30c6\u30fc\u30b8\u306e\u7d71\u8a08\u30d5\u30a3\u30eb\u30bf \u30ec\u30fc\u30c8\u3002\u30b9\u30c6\u30fc\u30b8\u304c\u7a81\u7136\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u3066\u9664\u5916\u3057\u305f\u5834\u5408\u306f\u3001\u3057\u304d\u3044\u5024\u306e\u8a2d\u5b9a\u304c\u4e0d\u9069\u5207\u3067\u3042\u308b\u304b\u3001\u30c7\u30fc\u30bf\u5206\u5e03\u304c\u5909\u66f4\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u793a\u3057\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30b5\u30f3\u30d7\u30eb\u691c\u67fb: \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u30eb\u30fc\u30eb\u306e\u7cbe\u5ea6\u3092\u8a55\u4fa1\u3059\u308b\u305f\u3081\u306e\u6d17\u6d44\u7d50\u679c\u306e\u5b9a\u671f\u7684\u306a\u624b\u52d5\u691c\u67fb\u3002\u8aa4\u3063\u3066\u524a\u9664\u3055\u308c\u305f\u826f\u597d\u306a\u30b5\u30f3\u30d7\u30eb\u3068\u898b\u9003\u3055\u308c\u305f\u4e0d\u826f\u30b5\u30f3\u30d7\u30eb\u306e\u4e21\u65b9\u306b\u6ce8\u610f\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u4e0b\u6d41\u306e\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af: \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u5f8c\u306e\u30e2\u30c7\u30eb\u306e\u8a55\u4fa1\u7d50\u679c\u304c\u6700\u7d42\u7684\u306a\u54c1\u8cea\u691c\u8a3c\u3068\u306a\u308a\u307e\u3059\u3002\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u3044\u5834\u5408\u306f\u3001\u30c7\u30fc\u30bf\u306b\u554f\u984c\u304c\u3042\u308b\u304b\u3069\u3046\u304b\u3092\u9061\u3063\u3066\u5206\u6790\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#45","title":"4.5 \u7ae0\u306e\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306e\u30b3\u30a2 \u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u3092\u4f53\u7cfb\u7684\u306b\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002</p> <p>\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0: \u8a00\u8a9e\u691c\u51fa\u3067\u306f\u3001FastText \u3092\u4f7f\u7528\u3057\u3066\u30bf\u30fc\u30b2\u30c3\u30c8\u8a00\u8a9e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8fc5\u901f\u306b\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3 \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306f KenLM \u3092\u4f7f\u7528\u3057\u3066\u30c6\u30ad\u30b9\u30c8\u306e\u54c1\u8cea\u3092\u8a55\u4fa1\u3057\u307e\u3059\u3002\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30eb\u30fc\u30eb \u30bb\u30c3\u30c8\u306f\u3001\u9577\u3055\u3001\u7279\u6b8a\u6587\u5b57\u3001\u91cd\u8907\u884c\u3001\u8a9e\u5f59\u306e\u591a\u69d8\u6027\u306a\u3069\u306e\u8907\u6570\u306e\u5074\u9762\u3092\u30ab\u30d0\u30fc\u3057\u307e\u3059\u3002\u54c1\u8cea\u968e\u5c64\u5316\u6226\u7565\u306f\u30c7\u30fc\u30bf\u3092\u3055\u307e\u3056\u307e\u306a\u5c64\u306b\u5206\u5272\u3057\u3001\u305d\u306e\u5f8c\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u306e\u57fa\u790e\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p> <p>\u5927\u898f\u6a21\u306a\u91cd\u8907\u6392\u9664\u3067\u306f\u3001\u6b63\u78ba\u306a\u91cd\u8907\u6392\u9664\u3067\u306f\u30cf\u30c3\u30b7\u30e5\u65b9\u5f0f\u3092\u4f7f\u7528\u3057\u3066\u540c\u4e00\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u8fc5\u901f\u306b\u524a\u9664\u3057\u307e\u3059\u3002\u30d5\u30a1\u30b8\u30fc\u91cd\u8907\u6392\u9664\u3067\u306f\u3001MinHash LSH \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u4f7f\u7528\u3057\u3066\u3001\u985e\u4f3c\u6027\u306e\u9ad8\u3044\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u8b58\u5225\u3057\u307e\u3059\u3002 TB \u898f\u6a21\u306e\u30c7\u30fc\u30bf\u306b\u306f\u5206\u6563\u5b9f\u88c5\u304c\u5fc5\u8981\u3067\u3059\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u306e\u91cd\u8907\u6392\u9664\u306f\u3001\u6bb5\u843d\u304a\u3088\u3073 N \u30b0\u30e9\u30e0 \u30ec\u30d9\u30eb\u306e\u91cd\u8907\u3092\u51e6\u7406\u3057\u307e\u3059\u3002</p> <p>\u30d7\u30e9\u30a4\u30d0\u30b7\u30fc \u30af\u30ea\u30fc\u30cb\u30f3\u30b0: PII \u691c\u51fa\u3067\u306f\u3001Presidio \u307e\u305f\u306f\u30ab\u30b9\u30bf\u30e0\u6b63\u898f\u8868\u73fe\u30eb\u30fc\u30eb\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\u533f\u540d\u5316\u6226\u7565\u3067\u306f\u3001\u7cbe\u5ea6\u3068\u60c5\u5831\u4fdd\u6301\u306e\u9593\u306e\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5\u304c\u5fc5\u8981\u3067\u3059\u3002\u4e2d\u56fd\u306e PII \u306e\u51e6\u7406\u306b\u306f\u3001\u7279\u5225\u306b\u8a2d\u8a08\u3055\u308c\u305f\u30eb\u30fc\u30eb \u30bb\u30c3\u30c8\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u5b8c\u5168\u306a\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306f\u5404\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3092\u63a5\u7d9a\u3057\u3001\u5f62\u5f0f\u306e\u6a19\u6e96\u5316\u3001\u8a00\u8a9e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5185\u91cd\u8907\u6392\u9664\u3001PII \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u3001\u54c1\u8cea\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u9593\u91cd\u8907\u6392\u9664\u3001\u54c1\u8cea\u968e\u5c64\u5316\u306e\u9806\u5e8f\u3067\u5b9f\u884c\u3057\u307e\u3059\u3002\u7d99\u7d9a\u7684\u306a\u54c1\u8cea\u76e3\u8996\u3068\u53cd\u5fa9\u7684\u306a\u6700\u9069\u5316\u304c\u30c7\u30fc\u30bf\u54c1\u8cea\u3092\u78ba\u4fdd\u3059\u308b\u9375\u3068\u306a\u308a\u307e\u3059\u3002</p> <p></p> <p>\u56f3 4-5: \u7b2c 4 \u7ae0 \u77e5\u8b58\u69cb\u9020 \u2014 3 \u3064\u306e\u4e3b\u8981\u30c6\u30fc\u30de: \u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u5927\u898f\u6a21\u306a\u91cd\u8907\u6392\u9664\u3001PII \u30af\u30ea\u30fc\u30cb\u30f3\u30b0</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#_3","title":"\u3055\u3089\u306b\u8aad\u3080","text":"<p>\u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306b\u95a2\u3059\u308b\u8a73\u7d30\u306a\u5185\u5bb9\u306b\u3064\u3044\u3066\u306f\u3001\u6b21\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53c2\u7167\u3059\u308b\u4fa1\u5024\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>RefinedWeb \u306e\u8ad6\u6587\u306b\u306f\u3001Common Crawl \u304b\u3089\u9ad8\u54c1\u8cea\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u5b8c\u5168\u306a\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d5\u30ed\u30fc\u304c\u6587\u66f8\u5316\u3055\u308c\u3066\u3044\u307e\u3059\u3002 Dolma \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u6280\u8853\u30ec\u30dd\u30fc\u30c8\u3067\u306f\u3001Allen AI \u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u6226\u7565\u3068\u30c4\u30fc\u30eb\u304c\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002 text-dedup \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30e9\u30a4\u30d6\u30e9\u30ea (github.com/ChenghaoMou/text-dedup) \u306f\u3001\u3055\u307e\u3056\u307e\u306a\u91cd\u8907\u6392\u9664\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5b9f\u88c5\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002 Microsoft Presidio \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (microsoft.github.io/presidio) \u306f\u3001PII \u51e6\u7406\u306b\u95a2\u3059\u308b\u4fe1\u983c\u3067\u304d\u308b\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3067\u3059\u3002 CCNet \u306e\u8ad6\u6587\u3067\u306f\u3001Facebook \u306e\u5171\u901a\u30af\u30ed\u30fc\u30eb \u30c7\u30fc\u30bf\u51e6\u7406\u65b9\u6cd5\u3001\u7279\u306b\u30d1\u30fc\u30d7\u30ec\u30ad\u30b7\u30c6\u30a3 \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306e\u8a73\u7d30\u304c\u7d39\u4ecb\u3055\u308c\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_2_cleaning_denoising/#_4","title":"\u6b21\u306e\u7ae0\u306e\u30d7\u30ec\u30d3\u30e5\u30fc","text":"<p>\u6b21\u306e\u7ae0\u300c\u30c8\u30fc\u30af\u30f3\u5316\u3068\u30b7\u30ea\u30a2\u30eb\u5316\u300d\u3067\u306f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u306e\u30c7\u30fc\u30bf\u6e96\u5099\u306b\u304a\u3051\u308b\u6700\u5f8c\u306e\u91cd\u8981\u306a\u30b9\u30c6\u30c3\u30d7\u3001\u3064\u307e\u308a\u3001\u30af\u30ea\u30fc\u30f3\u306a\u30c6\u30ad\u30b9\u30c8\u3092\u30e2\u30c7\u30eb\u304c\u7406\u89e3\u3067\u304d\u308b\u30c8\u30fc\u30af\u30f3 \u30b7\u30fc\u30b1\u30f3\u30b9\u306b\u5909\u63db\u3059\u308b\u65b9\u6cd5\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002 BPE\u3001WordPiece\u3001Unigram \u306a\u3069\u306e\u30c8\u30fc\u30af\u30f3\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u539f\u7406\u3068\u9078\u629e\u306b\u3064\u3044\u3066\u5b66\u3073\u307e\u3059\u3002\u7279\u5b9a\u306e\u5206\u91ce\u306e\u8a9e\u5f59\u3092\u62e1\u5f35\u3059\u308b\u65b9\u6cd5\u3002\u30c7\u30fc\u30bf\u30df\u30ad\u30b7\u30f3\u30b0\u3068\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u6226\u7565\u3002</p> <p>\u6b21\u306e\u7ae0\u306b\u5165\u308b\u3068\u304d\u306b\u3001\u6b21\u306e\u8cea\u554f\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30b3\u30fc\u30c9\u306b\u7279\u5316\u3057\u305f\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u6a19\u6e96\u306e GPT-2 \u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306f\u3069\u306e\u3088\u3046\u306a\u554f\u984c\u306b\u906d\u9047\u3059\u308b\u3067\u3057\u3087\u3046\u304b?</p>"},{"location":"ja/part2/2_3_tokenization_serialization/","title":"\u7b2c5\u7ae0: Tokenization\u3068\u30b7\u30ea\u30a2\u30e9\u30a4\u30ba","text":""},{"location":"ja/part2/2_3_tokenization_serialization/#5","title":"\u7b2c 5 \u7ae0: \u30c8\u30fc\u30af\u30f3\u5316\u3068\u30b7\u30ea\u30a2\u30eb\u5316","text":""},{"location":"ja/part2/2_3_tokenization_serialization/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u30c8\u30fc\u30af\u30f3\u5316\u306f\u3001\u751f\u306e\u30c6\u30ad\u30b9\u30c8\u3068\u30cb\u30e5\u30fc\u30e9\u30eb \u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u3092\u63a5\u7d9a\u3059\u308b\u67b6\u3051\u6a4b\u3067\u3059\u3002\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u5f8c\u306e\u9ad8\u54c1\u8cea\u306e\u30b3\u30fc\u30d1\u30b9\u306f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u305f\u3081\u306b Transformers \u306b\u30d5\u30a3\u30fc\u30c9\u3059\u308b\u524d\u306b\u3001\u30e2\u30c7\u30eb\u304c\u7406\u89e3\u3067\u304d\u308b\u6570\u5024\u30b7\u30fc\u30b1\u30f3\u30b9\u306b\u5909\u63db\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u30013 \u3064\u306e\u4e3b\u6d41\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3042\u308b BPE\u3001WordPiece\u3001Unigram \u3092\u542b\u3080\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306e\u4ed5\u7d44\u307f\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002\u7279\u5b9a\u306e\u30c9\u30e1\u30a4\u30f3\u306e\u8a9e\u5f59\u3092\u69cb\u7bc9\u304a\u3088\u3073\u62e1\u5f35\u3059\u308b\u65b9\u6cd5\u3092\u7d39\u4ecb\u3057\u307e\u3059\u3002\u6700\u5f8c\u306b\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306e\u3055\u307e\u3056\u307e\u306a\u30c7\u30fc\u30bf \u30bf\u30a4\u30d7\u306e\u8868\u793a\u9806\u5e8f\u3068\u6bd4\u7387\u3092\u6c7a\u5b9a\u3059\u308b\u30c7\u30fc\u30bf\u6df7\u5408\u3068\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2\u6226\u7565\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#_2","title":"\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb","text":"<p>\u3042\u306a\u305f\u306e\u30c1\u30fc\u30e0\u306f\u3001\u30b3\u30fc\u30c9\u306b\u7279\u5316\u3057\u305f\u5927\u898f\u6a21\u306a\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u3066\u3044\u307e\u3059\u3002\u6a19\u6e96\u306e GPT-2 \u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u3067\u4e88\u5099\u5b9f\u9a13\u3092\u884c\u3063\u305f\u5f8c\u3001\u5947\u5999\u306a\u73fe\u8c61\u3092\u767a\u898b\u3057\u307e\u3057\u305f\u3002\u30e2\u30c7\u30eb\u306f\u3001\u751f\u6210\u3055\u308c\u305f\u30b3\u30fc\u30c9\u306e\u30a4\u30f3\u30c7\u30f3\u30c8\u3067\u30a8\u30e9\u30fc\u3092\u983b\u7e41\u306b\u8d77\u3053\u3057\u30014 \u3064\u306e\u30b9\u30da\u30fc\u30b9\u3092\u8907\u6570\u306e\u7570\u306a\u308b\u30c8\u30fc\u30af\u30f3\u306b\u5206\u5272\u3057\u3001\u30a4\u30f3\u30c7\u30f3\u30c8\u306e\u4e0d\u4e00\u81f4\u3092\u5f15\u304d\u8d77\u3053\u3057\u307e\u3059\u3002\u3055\u3089\u306b\u60aa\u3044\u3053\u3068\u306b\u3001<code>def</code> \u3084 <code>return</code> \u306a\u3069\u306e\u4e00\u90e8\u306e\u4e00\u822c\u7684\u306a\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0 \u30ad\u30fc\u30ef\u30fc\u30c9\u306f\u8907\u6570\u306e\u30b5\u30d6\u30ef\u30fc\u30c9\u306b\u5206\u5272\u3055\u308c\u3066\u304a\u308a\u3001\u30e2\u30c7\u30eb\u304c\u305d\u306e\u610f\u5473\u3092\u7406\u89e3\u3059\u308b\u305f\u3081\u306b\u8ffd\u52a0\u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u5206\u6790\u5f8c\u3001\u554f\u984c\u306f\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306b\u3042\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002 GPT-2 \u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306f Web \u30c6\u30ad\u30b9\u30c8\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u3066\u304a\u308a\u3001\u30b3\u30fc\u30c9\u306e\u7279\u6b8a\u306a\u69cb\u9020 (\u7a7a\u767d\u3001\u30ad\u30e3\u30e1\u30eb\u30b1\u30fc\u30b9\u3001\u7279\u6b8a\u8a18\u53f7\u306a\u3069) \u3092\u3046\u307e\u304f\u51e6\u7406\u3067\u304d\u307e\u305b\u3093\u3002\u30b3\u30fc\u30c9\u30bf\u30b9\u30af\u7528\u306b\u7279\u5316\u3057\u305f\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u3092\u8a2d\u8a08\u3059\u308b\u3053\u3068\u306f\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u5411\u4e0a\u3055\u305b\u308b\u305f\u3081\u306e\u91cd\u8981\u306a\u30b9\u30c6\u30c3\u30d7\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002</p> <p>\u3053\u306e\u4f8b\u306f\u3001\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306f\u6c7a\u3057\u3066\u7121\u8996\u3067\u304d\u308b\u300c\u524d\u51e6\u7406\u306e\u8a73\u7d30\u300d\u3067\u306f\u306a\u304f\u3001\u30e2\u30c7\u30eb\u306e\u6a5f\u80fd\u306b\u5927\u304d\u306a\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u3053\u3068\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#51","title":"5.1 \u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306e\u539f\u5247","text":"<p>\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306e\u4e2d\u5fc3\u7684\u306a\u30bf\u30b9\u30af\u306f\u3001\u9023\u7d9a\u3057\u305f\u30c6\u30ad\u30b9\u30c8\u6587\u5b57\u5217\u3092\u500b\u5225\u306e\u30c8\u30fc\u30af\u30f3 \u30b7\u30fc\u30b1\u30f3\u30b9\u306b\u30bb\u30b0\u30e1\u30f3\u30c8\u5316\u3057\u3001\u5404\u30c8\u30fc\u30af\u30f3\u3092\u6574\u6570 ID \u306b\u30de\u30c3\u30d7\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u306e\u4e00\u898b\u5358\u7d14\u306a\u30bf\u30b9\u30af\u306b\u306f\u3001\u5b9f\u969b\u306b\u306f\u8907\u96d1\u306a\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u8a2d\u8a08\u3068\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5\u304c\u542b\u307e\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#511","title":"5.1.1 \u306a\u305c\u30b5\u30d6\u30ef\u30fc\u30c9\u30c8\u30fc\u30af\u30f3\u5316\u306a\u306e\u304b?","text":"<p>\u6df1\u5c64\u5b66\u7fd2\u306e\u521d\u671f\u306e\u9803\u3001\u81ea\u7136\u8a00\u8a9e\u51e6\u7406\u3067\u306f\u901a\u5e38\u3001\u5358\u8a9e\u30ec\u30d9\u30eb\u307e\u305f\u306f\u6587\u5b57\u30ec\u30d9\u30eb\u306e\u30c8\u30fc\u30af\u30f3\u5316\u304c\u4f7f\u7528\u3055\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u5358\u8a9e\u30ec\u30d9\u30eb\u306e\u30c8\u30fc\u30af\u30f3\u5316\u3067\u306f\u3001\u5b8c\u5168\u306a\u5404\u5358\u8a9e\u304c\u30c8\u30fc\u30af\u30f3\u3068\u3057\u3066\u6271\u308f\u308c\u307e\u3059\u3002\u5229\u70b9\u306f\u30bb\u30de\u30f3\u30c6\u30a3\u30af\u30b9\u304c\u660e\u78ba\u3067\u3042\u308b\u3053\u3068\u3067\u3059\u304c\u3001\u6b20\u70b9\u306f\u81a8\u5927\u306a\u8a9e\u5f59 (\u8003\u3048\u3089\u308c\u308b\u3059\u3079\u3066\u306e\u5358\u8a9e\u3092\u30ab\u30d0\u30fc\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b) \u3068\u8a9e\u5f59\u5916 (OOV) \u5358\u8a9e\u3092\u51e6\u7406\u3067\u304d\u306a\u3044\u3053\u3068\u3067\u3059\u3002\u6587\u5b57\u30ec\u30d9\u30eb\u306e\u30c8\u30fc\u30af\u30f3\u5316\u3067\u306f\u3001\u5404\u6587\u5b57\u304c\u30c8\u30fc\u30af\u30f3\u3068\u3057\u3066\u6271\u308f\u308c\u307e\u3059\u3002\u5229\u70b9\u306f\u3001OOV \u306e\u554f\u984c\u304c\u306a\u3044\u5c0f\u3055\u306a\u8a9e\u5f59\u3067\u3042\u308b\u3053\u3068\u3067\u3059\u304c\u3001\u6b20\u70b9\u306f\u3001\u30b7\u30fc\u30b1\u30f3\u30b9\u304c\u9577\u3059\u304e\u308b\u305f\u3081\u3001\u30e2\u30c7\u30eb\u304c\u9577\u8ddd\u96e2\u306e\u4f9d\u5b58\u95a2\u4fc2\u3092\u628a\u63e1\u3059\u308b\u3053\u3068\u304c\u56f0\u96e3\u306b\u306a\u308b\u3053\u3068\u3067\u3059\u3002</p> <p>\u30b5\u30d6\u30ef\u30fc\u30c9\u306e\u30c8\u30fc\u30af\u30f3\u5316\u306f\u59a5\u5354\u3067\u3059\u3002\u30c6\u30ad\u30b9\u30c8\u3092\u5358\u8a9e\u3088\u308a\u5c0f\u3055\u304f\u3001\u6587\u5b57\u3088\u308a\u5927\u304d\u3044\u5358\u4f4d\u306b\u5206\u5272\u3057\u307e\u3059\u3002\u9ad8\u983b\u5ea6\u306e\u5358\u8a9e\u306f\u305d\u306e\u307e\u307e\u6b8b\u308a\u307e\u3059\u3002\u4f4e\u983b\u5ea6\u306e\u5358\u8a9e\u306f\u3001\u3088\u308a\u5c0f\u3055\u306a\u30b5\u30d6\u30ef\u30fc\u30c9\u5358\u4f4d\u306b\u5206\u5272\u3055\u308c\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300c\u4e0d\u5e78\u300d\u306f\u300c\u4e0d\u300d+\u300c\u5e78\u798f\u300d+\u300c\u3089\u3057\u3055\u300d\u306b\u5206\u5272\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u306f\u3001\u8a9e\u5f59\u30b5\u30a4\u30ba\u3092\u5236\u5fa1\u3057\u3001\u7279\u5b9a\u306e\u610f\u5473\u60c5\u5831\u3092\u4fdd\u6301\u3057\u306a\u304c\u3089\u3001\u30b5\u30d6\u30ef\u30fc\u30c9\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u901a\u3058\u3066\u76ee\u306b\u898b\u3048\u306a\u3044\u8a9e\u5f59\u3092\u51e6\u7406\u3067\u304d\u307e\u3059\u3002</p> <p></p> <p>\u56f3 5-1: \u30c8\u30fc\u30af\u30f3\u5316\u306e\u7c92\u5ea6\u306e\u6bd4\u8f03 \u2014 \u5358\u8a9e\u30ec\u30d9\u30eb\u3001\u6587\u5b57\u30ec\u30d9\u30eb\u3001\u304a\u3088\u3073\u30b5\u30d6\u30ef\u30fc\u30c9 \u30ec\u30d9\u30eb\u9593\u306e\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5</p> <p>\u73fe\u5728\u3001\u307b\u3068\u3093\u3069\u3059\u3079\u3066\u306e\u4e3b\u6d41\u306e\u5927\u898f\u6a21\u8a00\u8a9e\u30e2\u30c7\u30eb\u306f\u30b5\u30d6\u30ef\u30fc\u30c9 \u30c8\u30fc\u30af\u30f3\u5316\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002 GPT \u30b7\u30ea\u30fc\u30ba\u306f BPE \u3092\u4f7f\u7528\u3057\u3001BERT \u306f WordPiece \u3092\u4f7f\u7528\u3057\u3001T5 \u3068 LLaMA \u306f SentencePiece (BPE \u3068 Unigram \u3092\u30b5\u30dd\u30fc\u30c8) \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u539f\u7406\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u306f\u3001\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306e\u30ab\u30b9\u30bf\u30de\u30a4\u30ba\u3068\u6700\u9069\u5316\u306e\u57fa\u790e\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#512-bpe","title":"5.1.2 BPE: \u30d0\u30a4\u30c8\u30da\u30a2\u306e\u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0","text":"<p>BPE (\u30d0\u30a4\u30c8 \u30da\u30a2 \u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0) \u306f\u3082\u3068\u3082\u3068\u30c7\u30fc\u30bf\u5727\u7e2e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3057\u305f\u304c\u3001\u5f8c\u306b Sennrich \u3089\u306b\u3088\u3063\u3066\u30cb\u30e5\u30fc\u30e9\u30eb\u6a5f\u68b0\u7ffb\u8a33\u306b\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002 2015 \u5e74\u306b\u6700\u3082\u5e83\u304f\u4f7f\u7528\u3055\u308c\u308b\u30b5\u30d6\u30ef\u30fc\u30c9 \u30c8\u30fc\u30af\u30f3\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u306a\u308a\u307e\u3057\u305f\u3002</p> <p>BPE \u306e\u6838\u3068\u306a\u308b\u8003\u3048\u65b9\u306f\u975e\u5e38\u306b\u76f4\u611f\u7684\u3067\u3059\u3002\u3064\u307e\u308a\u3001\u6587\u5b57\u30ec\u30d9\u30eb\u304b\u3089\u958b\u59cb\u3057\u3001\u76ee\u6a19\u306e\u8a9e\u5f59\u30b5\u30a4\u30ba\u306b\u9054\u3059\u308b\u307e\u3067\u3001\u6700\u3082\u983b\u7e41\u306b\u767a\u751f\u3059\u308b\u96a3\u63a5\u3059\u308b\u30c8\u30fc\u30af\u30f3\u306e\u30da\u30a2\u3092\u7e70\u308a\u8fd4\u3057\u30de\u30fc\u30b8\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306a\u624b\u9806:</p> <ol> <li>\u3059\u3079\u3066\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c6\u30ad\u30b9\u30c8\u3092\u6587\u5b57\u30b7\u30fc\u30b1\u30f3\u30b9\u306b\u5206\u5272\u3057\u3001\u5404\u6587\u5b57\u3092\u521d\u671f\u30c8\u30fc\u30af\u30f3\u3068\u3057\u3066\u4f7f\u7528\u3057\u307e\u3059\u3002</li> <li>\u3059\u3079\u3066\u306e\u96a3\u63a5\u30c8\u30fc\u30af\u30f3\u30da\u30a2\u306e\u983b\u5ea6\u3092\u30ab\u30a6\u30f3\u30c8\u3057\u307e\u3059\u3002</li> <li>\u6700\u3082\u983b\u5ea6\u306e\u9ad8\u3044\u30c8\u30fc\u30af\u30f3\u306e\u30da\u30a2\u3092\u65b0\u3057\u3044\u30c8\u30fc\u30af\u30f3\u306b\u30de\u30fc\u30b8\u3057\u307e\u3059\u3002</li> <li>\u8a9e\u5f59\u304c\u76ee\u6a19\u30b5\u30a4\u30ba\u306b\u9054\u3059\u308b\u307e\u3067\u30b9\u30c6\u30c3\u30d7 2 \uff5e 3 \u3092\u7e70\u308a\u8fd4\u3057\u307e\u3059\u3002</li> </ol> <p>\u4ee5\u4e0b\u306f\u3001\u7c21\u7565\u5316\u3055\u308c\u305f BPE \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u5b9f\u88c5\u3067\u3059\u3002</p> <pre><code>from collections import Counter, defaultdict\n\ndef train_bpe(corpus: list, vocab_size: int) -&gt; dict:\n    \"\"\"\n    Train BPE tokenizer\n\n    Args:\n        corpus: Training corpus list\n        vocab_size: Target vocabulary size\n\n    Returns:\n        Merge rules dictionary\n    \"\"\"\n    # Initialize: split each word into characters, add end-of-word marker\n    word_freqs = Counter()\n    for text in corpus:\n        for word in text.split():\n            # Add end-of-word marker &lt;/w&gt; to distinguish same character in middle vs end of word\n            word_freqs[' '.join(list(word)) + ' &lt;/w&gt;'] += 1\n\n    merges = {}\n    vocab = set()\n\n    # Initial vocabulary is all characters\n    for word in word_freqs:\n        for char in word.split():\n            vocab.add(char)\n\n    while len(vocab) &lt; vocab_size:\n        # Count adjacent token pair frequencies\n        pair_freqs = defaultdict(int)\n        for word, freq in word_freqs.items():\n            tokens = word.split()\n            for i in range(len(tokens) - 1):\n                pair = (tokens[i], tokens[i + 1])\n                pair_freqs[pair] += freq\n\n        if not pair_freqs:\n            break\n\n        # Find highest-frequency pair\n        best_pair = max(pair_freqs, key=pair_freqs.get)\n\n        # Merge this pair\n        new_token = best_pair[0] + best_pair[1]\n        merges[best_pair] = new_token\n        vocab.add(new_token)\n\n        # Update word frequency table\n        new_word_freqs = {}\n        for word, freq in word_freqs.items():\n            new_word = word.replace(\n                best_pair[0] + ' ' + best_pair[1], \n                new_token\n            )\n            new_word_freqs[new_word] = freq\n        word_freqs = new_word_freqs\n\n    return merges\n\ndef apply_bpe(text: str, merges: dict) -&gt; list:\n    \"\"\"Apply BPE tokenization\"\"\"\n    tokens = list(text) + ['&lt;/w&gt;']\n\n    while True:\n        # Find mergeable pairs\n        pairs = [(tokens[i], tokens[i+1]) for i in range(len(tokens)-1)]\n        merge_pair = None\n        for pair in pairs:\n            if pair in merges:\n                merge_pair = pair\n                break\n\n        if merge_pair is None:\n            break\n\n        # Perform merge\n        new_tokens = []\n        i = 0\n        while i &lt; len(tokens):\n            if i &lt; len(tokens) - 1 and (tokens[i], tokens[i+1]) == merge_pair:\n                new_tokens.append(merges[merge_pair])\n                i += 2\n            else:\n                new_tokens.append(tokens[i])\n                i += 1\n        tokens = new_tokens\n\n    return tokens\n</code></pre> <p>BPE \u306e\u91cd\u8981\u306a\u30d0\u30ea\u30a2\u30f3\u30c8\u306f\u3001GPT-2 \u306b\u3088\u3063\u3066\u5c0e\u5165\u3055\u308c\u305f\u30d0\u30a4\u30c8\u30ec\u30d9\u30eb BPE \u3067\u3059\u3002\u5f93\u6765\u306e BPE \u306f\u6587\u5b57\u30ec\u30d9\u30eb\u3067\u52d5\u4f5c\u3057\u3001Unicode \u30a8\u30f3\u30b3\u30fc\u30c9\u306e\u554f\u984c\u3092\u51e6\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30d0\u30a4\u30c8 \u30ec\u30d9\u30eb\u306e BPE \u306f\u30d0\u30a4\u30c8 \u30ec\u30d9\u30eb\u3067\u76f4\u63a5\u52d5\u4f5c\u3057\u3001\u5404\u30d0\u30a4\u30c8\u3092\u5370\u5237\u53ef\u80fd\u306a\u6587\u5b57\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3059\u308b\u305f\u3081\u3001\u30a8\u30f3\u30b3\u30fc\u30c9\u306e\u554f\u984c\u3092\u56de\u907f\u3057\u3001\u3042\u3089\u3086\u308b\u8a00\u8a9e\u3092\u30cd\u30a4\u30c6\u30a3\u30d6\u306b\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002 GPT \u30b7\u30ea\u30fc\u30ba\u304c\u3042\u3089\u3086\u308b\u8a00\u8a9e\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u51e6\u7406\u3067\u304d\u308b\u306e\u306f\u3053\u306e\u305f\u3081\u3067\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#513-wordpiece-bert","title":"5.1.3 WordPiece: BERT \u306e\u9078\u629e","text":"<p>WordPiece \u306f\u3001Google \u304c BERT \u7528\u306b\u958b\u767a\u3057\u305f\u30c8\u30fc\u30af\u30f3\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3067\u3001BPE \u3068\u3088\u304f\u4f3c\u3066\u3044\u307e\u3059\u304c\u3001\u30de\u30fc\u30b8 \u30da\u30a2\u306e\u9078\u629e\u57fa\u6e96\u304c\u4e3b\u306b\u7570\u306a\u308a\u307e\u3059\u3002</p> <p>BPE \u306f\u3001\u6700\u3082\u983b\u7e41\u306b\u767a\u751f\u3059\u308b\u30da\u30a2\u3092\u30de\u30fc\u30b8\u7528\u306b\u9078\u629e\u3057\u307e\u3059\u3002 WordPiece \u306f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u53ef\u80fd\u6027\u3092\u6700\u5927\u5316\u3059\u308b\u30da\u30a2\u3092\u9078\u629e\u3057\u307e\u3059\u3002\u5177\u4f53\u7684\u306b\u306f\u3001\u5019\u88dc\u30da\u30a2 (A\u3001B) \u306b\u3064\u3044\u3066\u3001WordPiece \u306f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u4e0a\u306e\u30de\u30fc\u30b8\u3055\u308c\u305f\u8a9e\u5f59\u306e\u8a00\u8a9e\u30e2\u30c7\u30eb\u78ba\u7387\u30b2\u30a4\u30f3\u3092\u8a08\u7b97\u3057\u3001\u30de\u30fc\u30b8\u7528\u306b\u6700\u5927\u306e\u30b2\u30a4\u30f3\u3092\u6301\u3064\u30da\u30a2\u3092\u9078\u629e\u3057\u307e\u3059\u3002</p> <p>\u5b9f\u969b\u306b\u306f\u3001\u3053\u308c\u306f WordPiece \u304c\u300c\u5171\u8d77\u78ba\u7387\u304c\u72ec\u7acb\u3057\u305f\u51fa\u73fe\u78ba\u7387\u306e\u7a4d\u3088\u308a\u3082\u306f\u308b\u304b\u306b\u9ad8\u3044\u300d\u30da\u30a2\u3092\u30de\u30fc\u30b8\u3059\u308b\u50be\u5411\u304c\u3042\u308b\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3053\u306e\u57fa\u6e96\u306b\u3088\u308a\u3001WordPiece \u306f\u3001\u983b\u5ea6\u306f\u4f4e\u3044\u304c\u610f\u5473\u306e\u3042\u308b\u30d1\u30bf\u30fc\u30f3\u306b\u5bfe\u3057\u3066\u3088\u308a\u654f\u611f\u306b\u306a\u308a\u307e\u3059\u3002</p> <p>WordPiece \u306e\u3082\u3046 1 \u3064\u306e\u7279\u5fb4\u306f\u3001<code>##</code> \u30d7\u30ec\u30d5\u30a3\u30c3\u30af\u30b9\u3092\u4f7f\u7528\u3057\u3066\u5358\u8a9e\u306e\u5148\u982d\u4ee5\u5916\u306e\u30b5\u30d6\u30ef\u30fc\u30c9\u3092\u8b58\u5225\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300cplaying\u300d\u306f [\"play\", \"##ing\"] \u3068\u3057\u3066\u30c8\u30fc\u30af\u30f3\u5316\u3055\u308c\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u8868\u73fe\u306b\u3088\u308a\u3001\u5143\u306e\u5358\u8a9e\u5185\u306e\u30b5\u30d6\u30ef\u30fc\u30c9\u306e\u4f4d\u7f6e\u304c\u660e\u78ba\u306b\u533a\u5225\u3055\u308c\u3001\u30e2\u30c7\u30eb\u304c\u8a9e\u5f59\u69cb\u9020\u3092\u7406\u89e3\u3059\u308b\u306e\u306b\u5f79\u7acb\u3061\u307e\u3059\u3002</p> <pre><code># WordPiece tokenization example (using HuggingFace tokenizers)\nfrom tokenizers import Tokenizer\nfrom tokenizers.models import WordPiece\nfrom tokenizers.trainers import WordPieceTrainer\nfrom tokenizers.pre_tokenizers import Whitespace\n\n# Initialize WordPiece tokenizer\ntokenizer = Tokenizer(WordPiece(unk_token=\"[UNK]\"))\ntokenizer.pre_tokenizer = Whitespace()\n\n# Train\ntrainer = WordPieceTrainer(\n    vocab_size=30000,\n    special_tokens=[\"[UNK]\", \"[CLS]\", \"[SEP]\", \"[PAD]\", \"[MASK]\"]\n)\ntokenizer.train(files=[\"corpus.txt\"], trainer=trainer)\n\n# Use\noutput = tokenizer.encode(\"unhappiness\")\nprint(output.tokens)  # ['un', '##happi', '##ness']\n</code></pre>"},{"location":"ja/part2/2_3_tokenization_serialization/#514-unigram","title":"5.1.4 Unigram: \u30c8\u30fc\u30af\u30f3\u5316\u306b\u95a2\u3059\u308b\u78ba\u7387\u8ad6\u7684\u306a\u89b3\u70b9","text":"<p>Unigram\u30c8\u30fc\u30af\u30f3\u5316\u306f2018\u5e74\u306b\u5de5\u85e4\u6c0f\u306b\u3088\u3063\u3066\u63d0\u6848\u3055\u308c\u3001BPE/WordPiece\u3068\u306f\u5168\u304f\u7570\u306a\u308b\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002 BPE \u3068 WordPiece \u306f\u30dc\u30c8\u30e0\u30a2\u30c3\u30d7\u65b9\u5f0f\u3067\u3042\u308a\u3001\u5c0f\u3055\u306a\u5358\u4f4d\u304b\u3089\u958b\u59cb\u3057\u3066\u3001\u5f90\u3005\u306b\u5927\u304d\u306a\u5358\u4f4d\u306b\u7d71\u5408\u3057\u307e\u3059\u3002 Unigram \u306f\u30c8\u30c3\u30d7\u30c0\u30a6\u30f3\u3067\u3001\u8003\u3048\u3089\u308c\u308b\u3059\u3079\u3066\u306e\u30b5\u30d6\u30ef\u30fc\u30c9\u3092\u542b\u3080\u5927\u304d\u306a\u8a9e\u5f59\u304b\u3089\u958b\u59cb\u3057\u3001\u5f90\u3005\u306b\u76ee\u6a19\u30b5\u30a4\u30ba\u307e\u3067\u679d\u5208\u308a\u3057\u3066\u3044\u304d\u307e\u3059\u3002</p> <p>Unigram \u306f\u30c8\u30fc\u30af\u30f3\u5316\u3092\u78ba\u7387\u306e\u554f\u984c\u3068\u3057\u3066\u30e2\u30c7\u30eb\u5316\u3057\u307e\u3059\u3002\u5404\u30c8\u30fc\u30af\u30f3\u306e\u8a9e\u5f59 V \u3068\u78ba\u7387 P(t) \u304c\u4e0e\u3048\u3089\u308c\u308b\u3068\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u30c8\u30fc\u30af\u30f3\u5316\u306e\u7d50\u679c\u306f\u3001\u7dcf\u78ba\u7387\u3092\u6700\u5927\u5316\u3059\u308b\u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u306b\u306a\u308a\u307e\u3059\u3002</p> \\[P(x_1, x_2, ..., x_n) = \\prod_{i=1}^{n} P(x_i)\\] <p>\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d7\u30ed\u30bb\u30b9\u3067\u306f EM \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u304c\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002E \u30b9\u30c6\u30c3\u30d7\u306f\u3001\u73fe\u5728\u306e\u8a9e\u5f59\u306e\u4e0b\u3067\u5404\u30c8\u30fc\u30af\u30f3\u306e\u4e88\u60f3\u51fa\u73fe\u6570\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002 M \u30b9\u30c6\u30c3\u30d7\u306f\u30c8\u30fc\u30af\u30f3\u306e\u78ba\u7387\u3092\u66f4\u65b0\u3057\u307e\u3059\u3002\u6b21\u306b\u3001\u76ee\u6a19\u8a9e\u5f59\u30b5\u30a4\u30ba\u306b\u9054\u3059\u308b\u307e\u3067\u3001\u524a\u9664\u306b\u3088\u308b\u7dcf\u5c24\u5ea6\u3078\u306e\u5f71\u97ff\u304c\u6700\u5c0f\u9650\u306b\u6291\u3048\u3089\u308c\u308b\u30c8\u30fc\u30af\u30f3\u3092\u524a\u9664\u3057\u307e\u3059\u3002</p> <p>Unigram \u306e\u72ec\u81ea\u306e\u5229\u70b9\u306f\u3001\u8907\u6570\u306e\u30c8\u30fc\u30af\u30f3\u5316\u7d50\u679c\u306e\u78ba\u7387\u30e2\u30c7\u30ea\u30f3\u30b0\u3092\u81ea\u7136\u306b\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u308b\u3053\u3068\u3067\u3059\u3002\u7279\u5b9a\u306e\u30c6\u30ad\u30b9\u30c8\u306b\u5bfe\u3057\u3066\u3001\u8907\u6570\u306e\u6709\u52b9\u306a\u5206\u5272\u65b9\u6cd5\u304c\u5b58\u5728\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 Unigram \u306f\u305d\u308c\u305e\u308c\u306b\u78ba\u7387\u3092\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u7279\u5b9a\u306e\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u30b7\u30ca\u30ea\u30aa (\u97f3\u58f0\u8a8d\u8b58\u306b\u304a\u3051\u308b\u8907\u6570\u306e\u4eee\u8aac\u51e6\u7406\u306a\u3069) \u3067\u975e\u5e38\u306b\u5f79\u7acb\u3061\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#515-3","title":"5.1.5 3 \u3064\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u6bd4\u8f03","text":"<p>3 \u3064\u306e\u4e3b\u6d41\u306e\u30b5\u30d6\u30ef\u30fc\u30c9 \u30c8\u30fc\u30af\u30f3\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u306f\u3001\u305d\u308c\u305e\u308c\u7279\u5fb4\u304c\u3042\u308a\u307e\u3059\u3002\u9078\u629e\u306b\u306f\u3001\u7279\u5b9a\u306e\u30b7\u30ca\u30ea\u30aa\u306b\u57fa\u3065\u3044\u305f\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5\u304c\u5fc5\u8981\u3067\u3059\u3002</p> \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0 \u30b3\u30a2\u30a2\u30a4\u30c7\u30a2 \u5229\u70b9 \u30c7\u30e1\u30ea\u30c3\u30c8 \u4ee3\u8868\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 BPE \u30dc\u30c8\u30e0\u30a2\u30c3\u30d7\u3001\u5468\u6ce2\u6570\u99c6\u52d5\u306e\u30de\u30fc\u30b8 \u30b7\u30f3\u30d7\u30eb\u3067\u76f4\u611f\u7684\u306a\u3001\u8fc5\u901f\u306a\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u8caa\u6b32\u306a\u6226\u7565\u306f\u6700\u9069\u3067\u306f\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044 GPT\u30b7\u30ea\u30fc\u30ba\u3001LLaMA \u30ef\u30fc\u30c9\u30d4\u30fc\u30b9 \u30dc\u30c8\u30e0\u30a2\u30c3\u30d7\u3001\u53ef\u80fd\u6027\u4e3b\u5c0e\u306e\u30de\u30fc\u30b8 \u4f4e\u5468\u6ce2\u306e\u610f\u5473\u306e\u3042\u308b\u30d1\u30bf\u30fc\u30f3\u306b\u654f\u611f \u8a08\u7b97\u306e\u8907\u96d1\u3055\u306e\u5897\u52a0 BERT\u3001\u84b8\u7559BERT \u30e6\u30cb\u30b0\u30e9\u30e0 \u30c8\u30c3\u30d7\u30c0\u30a6\u30f3\u306e\u78ba\u7387\u30e2\u30c7\u30ea\u30f3\u30b0 \u7406\u8ad6\u7684\u306b\u306f\u30a8\u30ec\u30ac\u30f3\u30c8\u3067\u3001\u8907\u6570\u306e\u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002\u3086\u3063\u304f\u308a\u3068\u3057\u305f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 T5\u3001mT5\u3001\u30a2\u30eb\u30d0\u30fc\u30c8 <p></p> <p>\u56f3 5-2: BPE\u3001WordPiece\u3001\u304a\u3088\u3073 Unigram \u30c8\u30fc\u30af\u30f3\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u6bd4\u8f03</p> <p>\u5b9f\u969b\u306e\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3067\u306f\u3001SentencePiece \u304c\u6700\u3082\u4e00\u822c\u7684\u306b\u4f7f\u7528\u3055\u308c\u308b\u30c8\u30fc\u30af\u30f3\u5316\u30c4\u30fc\u30eb\u30ad\u30c3\u30c8\u3067\u3059\u3002 BPE \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068 Unigram \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u4e21\u65b9\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3001\u8a00\u8a9e\u306b\u4f9d\u5b58\u3057\u306a\u3044\u524d\u51e6\u7406 (\u7a7a\u9593\u30d9\u30fc\u30b9\u306e\u30c8\u30fc\u30af\u30f3\u5316\u306b\u4f9d\u5b58\u3057\u306a\u3044) \u3092\u63d0\u4f9b\u3057\u3001\u4e3b\u6d41\u306e\u6df1\u5c64\u5b66\u7fd2\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3068\u30b7\u30fc\u30e0\u30ec\u30b9\u306b\u7d71\u5408\u3057\u307e\u3059\u3002</p> <pre><code>import sentencepiece as spm\n\n# Train SentencePiece model\nspm.SentencePieceTrainer.train(\n    input='corpus.txt',\n    model_prefix='my_tokenizer',\n    vocab_size=32000,\n    model_type='bpe',  # or 'unigram'\n    character_coverage=0_9995,\n    num_threads=16\n)\n\n# Load and use\nsp = spm.SentencePieceProcessor(model_file='my_tokenizer.model')\ntokens = sp.encode('Hello, world!', out_type=str)\nprint(tokens)  # ['\u2581Hello', ',', '\u2581world', '!']\nids = sp.encode('Hello, world!')\nprint(ids)  # [1234, 56, 789, 10]\n</code></pre>"},{"location":"ja/part2/2_3_tokenization_serialization/#52","title":"5.2 \u8a9e\u5f59\u306e\u8a2d\u8a08\u3068\u62e1\u5f35","text":"<p>\u8a9e\u5f59\u306f\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306e\u4e2d\u6838\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8\u3067\u3059\u3002\u8a9e\u5f59\u306e\u30b5\u30a4\u30ba\u3001\u30ab\u30d0\u30ec\u30c3\u30b8\u3001\u304a\u3088\u3073\u69cb\u9020\u306f\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3068\u52b9\u7387\u306b\u76f4\u63a5\u5f71\u97ff\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#521","title":"5.2.1 \u8a9e\u5f59\u30b5\u30a4\u30ba\u306e\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5","text":"<p>\u8a9e\u5f59\u306e\u30b5\u30a4\u30ba\u306f\u3001\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306e\u8a2d\u8a08\u306b\u304a\u3044\u3066\u6700\u3082\u91cd\u8981\u306a\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e 1 \u3064\u3067\u3059\u3002\u8a9e\u5f59\u304c\u5927\u304d\u3044\u307b\u3069\u3001\u5b8c\u5168\u306a\u5358\u4f4d\u3068\u3057\u3066\u4fdd\u6301\u3055\u308c\u308b\u30c8\u30fc\u30af\u30f3\u304c\u591a\u304f\u306a\u308a\u3001\u30b7\u30fc\u30b1\u30f3\u30b9\u306f\u77ed\u304f\u306a\u308a\u307e\u3059\u304c\u3001Embedding\u884c\u5217\u304c\u5927\u304d\u304f\u306a\u308a\u3001\u30d1\u30e9\u30e1\u30fc\u30bf\u304c\u5897\u52a0\u3057\u307e\u3059\u3002\u8a9e\u5f59\u304c\u5c11\u306a\u3044\u307b\u3069\u3001\u3088\u308a\u591a\u304f\u306e\u5358\u8a9e\u304c\u30b5\u30d6\u30ef\u30fc\u30c9\u306b\u5206\u5272\u3055\u308c\u3001\u30b7\u30fc\u30b1\u30f3\u30b9\u304c\u9577\u304f\u306a\u308a\u307e\u3059\u304c\u3001\u30e2\u30c7\u30eb \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306f\u5c11\u306a\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>\u4e3b\u6d41\u306e\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u8a9e\u5f59\u30b5\u30a4\u30ba\u306f\u901a\u5e38\u300132K \u304b\u3089 128K \u306e\u7bc4\u56f2\u3067\u3059\u3002 GPT-2 \u306f 50,257\u3001LLaMA \u306f 32,000\u3001GPT-4 \u306f\u7d04 100,000 \u3092\u4f7f\u7528\u3059\u308b\u3068\u5831\u544a\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u8a9e\u5f59\u30b5\u30a4\u30ba\u3092\u9078\u629e\u3059\u308b\u3068\u304d\u306f\u3001\u6b21\u306e\u70b9\u3092\u8003\u616e\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>\u8a08\u7b97\u52b9\u7387: \u8a9e\u5f59\u304c\u5897\u3048\u308b\u307b\u3069\u3001Embedding\u5c64\u3068\u51fa\u529b\u5c64\u306e\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3082\u591a\u304f\u306a\u308a\u307e\u3059\u3002\u8a9e\u5f59\u30b5\u30a4\u30ba V \u306e d \u6b21\u5143\u30e2\u30c7\u30eb\u306e\u5834\u5408\u3001Embedding\u884c\u5217\u306b\u306f V \u00d7 d \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u304c\u542b\u307e\u308c\u307e\u3059\u3002 V \u304c 32K \u304b\u3089 128K \u306b\u5897\u52a0\u3059\u308b\u3068\u3001\u3053\u308c\u306f 4 \u500d\u306b\u5897\u52a0\u3057\u307e\u3059\u3002</p> <p>\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u9577\u3055: \u8a9e\u5f59\u304c\u5927\u304d\u3044\u307b\u3069\u3001\u5e73\u5747\u3057\u3066\u5404\u30c8\u30fc\u30af\u30f3\u304c\u30ab\u30d0\u30fc\u3059\u308b\u6587\u5b57\u6570\u304c\u591a\u304f\u306a\u308a\u3001\u540c\u3058\u30c6\u30ad\u30b9\u30c8\u304c\u5206\u5272\u3055\u308c\u308b\u30c8\u30fc\u30af\u30f3\u306e\u6570\u306f\u5c11\u306a\u304f\u306a\u308a\u307e\u3059\u3002 Transformer \u306e\u8a08\u7b97\u306e\u8907\u96d1\u3055\u306f\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u9577\u3055\u304c 2 \u6b21\u3067\u3042\u308b\u305f\u3081\u3001\u3053\u308c\u306f\u9577\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5834\u5408\u306b\u7279\u306b\u91cd\u8981\u3067\u3059\u3002</p> <p>\u5e0c\u5c11\u8a9e\u306e\u51e6\u7406: \u8a9e\u5f59\u304c\u5897\u3048\u308b\u307b\u3069\u3001\u3088\u308a\u591a\u304f\u306e\u5e0c\u5c11\u8a9e\u3092\u5b8c\u5168\u306a\u30c8\u30fc\u30af\u30f3\u3068\u3057\u3066\u4fdd\u6301\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u3001UNK \u3084\u904e\u5270\u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u554f\u984c\u304c\u8efd\u6e1b\u3055\u308c\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u3053\u308c\u306f\u307e\u305f\u3001\u307e\u308c\u306a\u30c8\u30fc\u30af\u30f3\u3067\u306f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b5\u30f3\u30d7\u30eb\u304c\u5c11\u306a\u304f\u306a\u308a\u3001Embedding\u54c1\u8cea\u306e\u4f4e\u4e0b\u306b\u3064\u306a\u304c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3053\u3068\u3082\u610f\u5473\u3057\u307e\u3059\u3002</p> <pre><code># Analyze impact of different vocabulary sizes on sequence length\ndef analyze_vocab_size_impact(text: str, vocab_sizes: list) -&gt; dict:\n    \"\"\"Analyze impact of vocabulary size on tokenization results\"\"\"\n    import sentencepiece as spm\n\n    results = {}\n    for vocab_size in vocab_sizes:\n        # Train tokenizers with different vocabulary sizes\n        spm.SentencePieceTrainer.train(\n            input='corpus.txt',\n            model_prefix=f'tokenizer_{vocab_size}',\n            vocab_size=vocab_size,\n            model_type='bpe'\n        )\n\n        sp = spm.SentencePieceProcessor(model_file=f'tokenizer_{vocab_size}.model')\n        tokens = sp.encode(text)\n\n        results[vocab_size] = {\n            'num_tokens': len(tokens),\n            'chars_per_token': len(text) / len(tokens),\n            'compression_ratio': len(text.encode('utf-8')) / (len(tokens) * 2)\n        }\n\n    return results\n</code></pre>"},{"location":"ja/part2/2_3_tokenization_serialization/#522","title":"5.2.2 \u591a\u8a00\u8a9e\u8a9e\u5f59\u306e\u8a2d\u8a08","text":"<p>\u591a\u8a00\u8a9e\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u5834\u5408\u3001\u8a9e\u5f59\u8a2d\u8a08\u306f\u3055\u3089\u306a\u308b\u8ab2\u984c\u306b\u76f4\u9762\u3057\u307e\u3059\u3002\u305d\u308c\u306f\u3001\u9650\u3089\u308c\u305f\u8a9e\u5f59\u7a7a\u9593\u5185\u3067\u3055\u307e\u3056\u307e\u306a\u8a00\u8a9e\u306e\u30ab\u30d0\u30ec\u30c3\u30b8\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u3069\u3046\u53d6\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002</p> <p>\u3088\u304f\u3042\u308b\u554f\u984c\u306f\u300c\u8a9e\u5f59\u306e\u546a\u3044\u300d\u3067\u3059\u3002\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u304c\u591a\u8a00\u8a9e\u30b3\u30fc\u30d1\u30b9\u3067\u76f4\u63a5\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u5834\u5408\u3001\u9ad8\u30ea\u30bd\u30fc\u30b9\u8a00\u8a9e (\u82f1\u8a9e\u306a\u3069) \u304c\u8a9e\u5f59\u30b9\u30da\u30fc\u30b9\u306e\u307b\u3068\u3093\u3069\u3092\u5360\u3081\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u304c\u3001\u4f4e\u30ea\u30bd\u30fc\u30b9\u8a00\u8a9e\u306e\u30ab\u30d0\u30fc\u7bc4\u56f2\u306f\u8457\u3057\u304f\u4e0d\u5341\u5206\u3067\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u4f4e\u30ea\u30bd\u30fc\u30b9\u8a00\u8a9e\u306e\u30c6\u30ad\u30b9\u30c8\u304c\u904e\u5270\u306b\u30bb\u30b0\u30e1\u30f3\u30c8\u5316\u3055\u308c\u3001\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u9577\u3055\u304c\u5897\u5927\u3057\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u4e0b\u3057\u307e\u3059\u3002</p> <p>\u3053\u308c\u306b\u5bfe\u51e6\u3059\u308b\u305f\u3081\u306e\u4e00\u822c\u7684\u306a\u6226\u7565\u306f\u6b21\u306e\u3068\u304a\u308a\u3067\u3059\u3002</p> <p>\u30b3\u30fc\u30d1\u30b9\u306e\u30d0\u30e9\u30f3\u30b9: \u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u524d\u306b\u3001\u3055\u307e\u3056\u307e\u306a\u8a00\u8a9e\u304b\u3089\u30b3\u30fc\u30d1\u30b9\u3092\u30aa\u30fc\u30d0\u30fc\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u307e\u305f\u306f\u30a2\u30f3\u30c0\u30fc\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3057\u3066\u3001\u8a00\u8a9e\u9593\u3067\u91cd\u307f\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u9ad8\u3081\u307e\u3059\u3002</p> <p>\u6e29\u5ea6\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0: \u7b2c 3 \u7ae0\u3067\u8aac\u660e\u3057\u305f\u591a\u8a00\u8a9e\u30c7\u30fc\u30bf \u30d0\u30e9\u30f3\u30b7\u30f3\u30b0\u6226\u7565\u3068\u540c\u69d8\u306b\u3001\u6e29\u5ea6\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u4f7f\u7528\u3057\u3066\u3001\u3055\u307e\u3056\u307e\u306a\u8a00\u8a9e\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u78ba\u7387\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002</p> <p>\u8a00\u8a9e\u56fa\u6709\u306e\u6587\u5b57\u306e\u7bc4\u56f2: \u983b\u5ea6\u304c\u4f4e\u3044\u5834\u5408\u3067\u3082\u3001\u5404\u30bf\u30fc\u30b2\u30c3\u30c8\u8a00\u8a9e\u306e\u57fa\u672c\u7684\u306a\u6587\u5b57\u30bb\u30c3\u30c8\u304c\u8a9e\u5f59\u306b\u542b\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 SentencePiece \u306f\u3001\u3053\u308c\u3092\u5236\u5fa1\u3059\u308b <code>character_coverage</code> \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p> <pre><code># Multilingual tokenizer training example\nimport sentencepiece as spm\n\n# Use character coverage to ensure multilingual support\nspm.SentencePieceTrainer.train(\n    input='multilingual_corpus.txt',\n    model_prefix='multilingual_tokenizer',\n    vocab_size=64000,\n    model_type='unigram',\n    character_coverage=0_9999,  # High coverage ensures rare characters included\n    input_sentence_size=10000000,\n    shuffle_input_sentence=True,\n    # Special handling for CJK characters\n    byte_fallback=True  # Fall back to byte level for unknown characters\n)\n</code></pre>"},{"location":"ja/part2/2_3_tokenization_serialization/#523","title":"5.2.3 \u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306e\u8a9e\u5f59\u62e1\u5f35","text":"<p>\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u3092\u7279\u5b9a\u306e\u30c9\u30e1\u30a4\u30f3 (\u533b\u7642\u3001\u6cd5\u5f8b\u3001\u30b3\u30fc\u30c9\u306a\u3069) \u306b\u9069\u7528\u3059\u308b\u3068\u3001\u30c9\u30e1\u30a4\u30f3\u7528\u8a9e\u304c\u904e\u5ea6\u306b\u30bb\u30b0\u30e1\u30f3\u30c8\u5316\u3055\u308c\u308b\u3068\u3044\u3046\u554f\u984c\u306b\u3088\u304f\u906d\u9047\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u9577\u3055\u304c\u5897\u52a0\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30e2\u30c7\u30eb\u306e\u5c02\u9580\u7684\u306a\u6982\u5ff5\u306e\u7406\u89e3\u306b\u3082\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u8a9e\u5f59\u306e\u62e1\u5f35\u306f\u52b9\u679c\u7684\u306a\u89e3\u6c7a\u7b56\u3067\u3059\u3002\u57fa\u672c\u7684\u306a\u8003\u3048\u65b9: \u5143\u306e\u8a9e\u5f59\u3092\u4fdd\u6301\u3057\u306a\u304c\u3089\u3001\u65b0\u3057\u3044\u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306e\u30c8\u30fc\u30af\u30f3\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002</p> <pre><code>from transformers import AutoTokenizer\n\ndef extend_tokenizer(base_tokenizer_name: str, \n                     domain_terms: list,\n                     output_dir: str) -&gt; None:\n    \"\"\"\n    Extend pre-trained tokenizer vocabulary\n\n    Args:\n        base_tokenizer_name: Base tokenizer name\n        domain_terms: List of domain-specific terms\n        output_dir: Output directory\n    \"\"\"\n    # Load base tokenizer\n    tokenizer = AutoTokenizer.from_pretrained(base_tokenizer_name)\n\n    print(f\"Original vocabulary size: {len(tokenizer)}\")\n\n    # Filter already existing tokens\n    new_tokens = []\n    for term in domain_terms:\n        if term not in tokenizer.get_vocab():\n            new_tokens.append(term)\n\n    # Add new tokens\n    num_added = tokenizer.add_tokens(new_tokens)\n    print(f\"Added {num_added} new tokens\")\n    print(f\"New vocabulary size: {len(tokenizer)}\")\n\n    # Save extended tokenizer\n    tokenizer.save_pretrained(output_dir)\n\n    return tokenizer\n\n# Example: Extend vocabulary for medical domain\nmedical_terms = [\n    '\u51a0\u72b6\u52a8\u8109',\n    '\u5fc3\u808c\u6897\u6b7b',\n    '\u52a8\u8109\u7ca5\u6837\u786c\u5316',\n    'COVID-19',\n    'mRNA\u75ab\u82d7',\n    '\u8ba1\u7b97\u673a\u65ad\u5c42\u626b\u63cf',\n    # ... more terms\n]\n\ntokenizer = extend_tokenizer(\n    'meta-llama/Llama-2-7b',\n    medical_terms,\n    './medical_tokenizer'\n)\n</code></pre> <p>\u8a9e\u5f59\u62e1\u5f35\u5f8c\u306f\u3001\u305d\u308c\u306b\u5fdc\u3058\u3066\u30e2\u30c7\u30eb\u306eEmbedding\u884c\u5217\u3092\u62e1\u5f35\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u65b0\u3057\u3044\u30c8\u30fc\u30af\u30f3\u306eEmbedding\u306f\u901a\u5e38\u3001\u30e9\u30f3\u30c0\u30e0\u306a\u5024\u307e\u305f\u306f\u65e2\u5b58\u306e\u95a2\u9023\u30c8\u30fc\u30af\u30f3\u306e\u5e73\u5747\u306b\u521d\u671f\u5316\u3055\u308c\u3001\u610f\u5473\u306e\u3042\u308b\u8868\u73fe\u3092\u5f97\u308b\u305f\u3081\u306b\u7d99\u7d9a\u7684\u306a\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3092\u901a\u3058\u3066\u5b66\u7fd2\u3055\u308c\u307e\u3059\u3002</p> <pre><code>from transformers import AutoModelForCausalLM\n\ndef resize_model_embeddings(model_name: str, \n                            tokenizer,\n                            output_dir: str) -&gt; None:\n    \"\"\"Resize model embedding layer to match extended vocabulary\"\"\"\n    model = AutoModelForCausalLM.from_pretrained(model_name)\n\n    # Resize embedding layer\n    model.resize_token_embeddings(len(tokenizer))\n\n    # Optional: Initialize new embeddings with mean of similar tokens\n    # This usually gives better results than random initialization\n\n    model.save_pretrained(output_dir)\n</code></pre>"},{"location":"ja/part2/2_3_tokenization_serialization/#524","title":"5.2.4 \u8a9e\u5f59\u8a2d\u8a08\u306e\u30d9\u30b9\u30c8\u30d7\u30e9\u30af\u30c6\u30a3\u30b9","text":"<p>\u696d\u754c\u306e\u7d4c\u9a13\u306b\u57fa\u3065\u3044\u3066\u3001\u8a9e\u5f59\u8a2d\u8a08\u306e\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3092\u3044\u304f\u3064\u304b\u793a\u3057\u307e\u3059\u3002</p> <p>\u5341\u5206\u306a\u7279\u6b8a\u30c8\u30fc\u30af\u30f3\u306e\u4f4d\u7f6e\u3092\u4e88\u7d04: \u5c06\u6765\u306e\u7279\u6b8a\u30c8\u30fc\u30af\u30f3 (\u65b0\u3057\u3044\u5236\u5fa1\u30b7\u30f3\u30dc\u30eb\u3001\u30c9\u30e1\u30a4\u30f3 \u30de\u30fc\u30ab\u30fc\u306a\u3069) \u306e\u305f\u3081\u306b\u3044\u304f\u3064\u304b\u306e\u30c8\u30fc\u30af\u30f3 ID \u3092\u4e88\u7d04\u3057\u307e\u3059\u3002\u591a\u304f\u306e\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306f 100 \uff5e 1000 \u306e\u30dd\u30b8\u30b7\u30e7\u30f3\u3092\u4e88\u7d04\u3057\u307e\u3059\u3002</p> <p>\u6570\u5024\u3068\u30b3\u30fc\u30c9\u8a18\u53f7\u306e\u9069\u5207\u306a\u5206\u5272\u3092\u78ba\u4fdd\u3059\u308b: \u6570\u5024\u306f\u591a\u304f\u306e\u30bf\u30b9\u30af\u3067\u91cd\u8981\u3067\u3059\u304c\u3001\u6a19\u6e96\u306e\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u3067\u306f\u6570\u5024\u306e\u51e6\u7406\u304c\u4e0d\u5341\u5206\u306a\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002 1 \u6841\u3092\u72ec\u7acb\u3057\u305f\u30c8\u30fc\u30af\u30f3\u3068\u3057\u3066\u4fdd\u6301\u3059\u308b\u304b\u3001\u7279\u5225\u306a\u6570\u5024\u30a8\u30f3\u30b3\u30fc\u30c9\u6226\u7565\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3092\u691c\u8a0e\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p> <p>\u30a8\u30c3\u30b8 \u30b1\u30fc\u30b9\u3092\u30c6\u30b9\u30c8\u3059\u308b: \u8a9e\u5f59\u3092\u5b8c\u6210\u3055\u305b\u308b\u524d\u306b\u3001\u975e\u5e38\u306b\u9577\u3044\u5358\u8a9e\u3001\u7279\u6b8a\u6587\u5b57\u3001\u6df7\u5408\u8a00\u8a9e\u30c6\u30ad\u30b9\u30c8\u3001\u30b3\u30fc\u30c9 \u30b9\u30cb\u30da\u30c3\u30c8\u306a\u3069\u3001\u3055\u307e\u3056\u307e\u306a\u30a8\u30c3\u30b8 \u30b1\u30fc\u30b9\u3092\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002\u30c8\u30fc\u30af\u30f3\u5316\u306e\u7d50\u679c\u304c\u671f\u5f85\u3069\u304a\u308a\u3067\u3042\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002</p> <p>\u8a9e\u5f59\u306b\u95a2\u3059\u308b\u6c7a\u5b9a\u3092\u6587\u66f8\u5316\u3059\u308b: \u8a9e\u5f59\u30b5\u30a4\u30ba\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b3\u30fc\u30d1\u30b9\u3001\u7279\u5225\u306a\u30c8\u30fc\u30af\u30f3 \u30ea\u30b9\u30c8\u306a\u3069\u3092\u8a18\u9332\u3057\u3001\u305d\u306e\u5f8c\u306e\u30e2\u30c7\u30eb\u306e\u53cd\u5fa9\u3068\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3092\u5bb9\u6613\u306b\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#53","title":"5.3 \u30c7\u30fc\u30bf\u6df7\u5408\u3068\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2","text":"<p>\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u3092\u6c7a\u5b9a\u3057\u305f\u3089\u3001\u6b21\u306e\u91cd\u8981\u306a\u8cea\u554f\u306f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u3092\u3069\u306e\u3088\u3046\u306b\u6574\u7406\u3057\u3066\u63d0\u793a\u3059\u308b\u304b\u3068\u3044\u3046\u3053\u3068\u3067\u3059\u3002\u3055\u307e\u3056\u307e\u306a\u30bd\u30fc\u30b9\u3084\u54c1\u8cea\u304b\u3089\u306e\u30c7\u30fc\u30bf\u3092\u3069\u306e\u3088\u3046\u306a\u5272\u5408\u3067\u6df7\u5408\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304b?\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306e\u30c7\u30fc\u30bf\u306e\u9806\u5e8f\u306f\u91cd\u8981\u3067\u3059\u304b?</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#531","title":"5.3.1 \u30c7\u30fc\u30bf\u6df7\u5408\u6226\u7565","text":"<p>\u7b2c 3 \u7ae0\u3067\u8aac\u660e\u3057\u305f\u3088\u3046\u306b\u3001\u9ad8\u54c1\u8cea\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u901a\u5e38\u3001Web\u3001\u66f8\u7c4d\u3001\u30b3\u30fc\u30c9\u3001\u8ad6\u6587\u3001\u5bfe\u8a71\u306a\u3069\u306e\u8907\u6570\u306e\u30bd\u30fc\u30b9\u3092\u6df7\u5408\u3057\u307e\u3059\u3002\u5404\u30bd\u30fc\u30b9\u306f\u30c7\u30fc\u30bf\u91cf\u3068\u54c1\u8cea\u304c\u7570\u306a\u308a\u307e\u3059\u3002\u5358\u306b\u5143\u306e\u6bd4\u7387\u3067\u6df7\u5408\u3059\u308b\u3060\u3051\u3067\u306f\u6700\u9069\u3067\u306f\u306a\u3044\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002</p> <p>\u9759\u7684\u6df7\u5408\u306f\u6700\u3082\u5358\u7d14\u306a\u6226\u7565\u3067\u3059\u3002\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3092\u958b\u59cb\u3059\u308b\u524d\u306b\u5404\u30bd\u30fc\u30b9\u306e\u6df7\u5408\u6bd4\u7387\u3092\u6c7a\u5b9a\u3057\u3001\u30c7\u30fc\u30bf\u3092\u30b7\u30e3\u30c3\u30d5\u30eb\u3057\u3066\u304b\u3089\u3001\u9806\u756a\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u307e\u3059\u3002\u3053\u306e\u65b9\u6cd5\u306f\u5b9f\u88c5\u304c\u7c21\u5358\u3067\u3059\u304c\u3001\u67d4\u8edf\u6027\u306b\u6b20\u3051\u307e\u3059\u3002</p> <pre><code># Static data mixing example\nimport random\n\ndef static_mix(data_sources: dict, target_size: int) -&gt; list:\n    \"\"\"\n    Statically mix multiple data sources\n\n    Args:\n        data_sources: {source_name: (data_list, weight)}\n        target_size: Target dataset size\n\n    Returns:\n        Mixed data list\n    \"\"\"\n    mixed_data = []\n\n    # Compute sample count for each source\n    total_weight = sum(w for _, w in data_sources.values())\n\n    for source_name, (data, weight) in data_sources.items():\n        num_samples = int(target_size * weight / total_weight)\n\n        # If insufficient data, repeat sampling\n        if len(data) &lt; num_samples:\n            sampled = random.choices(data, k=num_samples)\n        else:\n            sampled = random.sample(data, num_samples)\n\n        mixed_data.extend(sampled)\n\n    random.shuffle(mixed_data)\n    return mixed_data\n\n# Usage example\ndata_sources = {\n    'web': (web_data, 0_6),\n    'books': (book_data, 0_15),\n    'code': (code_data, 0_1),\n    'papers': (paper_data, 0_1),\n    'wikipedia': (wiki_data, 0_05)\n}\n\nmixed = static_mix(data_sources, target_size=1000000)\n</code></pre> <p></p> <p>\u56f3 5-3: \u9759\u7684\u30df\u30ad\u30b7\u30f3\u30b0\u6226\u7565\u3068\u52d5\u7684\u30df\u30ad\u30b7\u30f3\u30b0\u6226\u7565\u306e\u6bd4\u8f03</p> <p>\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30df\u30ad\u30b7\u30f3\u30b0\u306b\u3088\u308a\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306b\u6df7\u5408\u6bd4\u7387\u3092\u8abf\u6574\u3067\u304d\u307e\u3059\u3002\u4e00\u90e8\u306e\u7814\u7a76\u3067\u306f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6bb5\u968e\u3054\u3068\u306b\u6700\u9069\u306a\u30c7\u30fc\u30bf\u6bd4\u7387\u304c\u7570\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3053\u3068\u304c\u793a\u5506\u3055\u308c\u3066\u3044\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u3088\u308a\u591a\u69d8\u306a\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u3066\u65e9\u671f\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u3068\u3001\u30e2\u30c7\u30eb\u304c\u5e83\u7bc4\u306a\u8a00\u8a9e\u7406\u89e3\u3092\u78ba\u7acb\u3059\u308b\u306e\u306b\u5f79\u7acb\u3061\u307e\u3059\u3002\u9ad8\u54c1\u8cea\u30c7\u30fc\u30bf\u306e\u5272\u5408\u3092\u5897\u3084\u3057\u3066\u5f8c\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u3068\u3001\u304d\u3081\u7d30\u304b\u3044\u6a5f\u80fd\u304c\u5411\u4e0a\u3057\u307e\u3059\u3002</p> <pre><code>class DynamicDataMixer:\n    \"\"\"Dynamic data mixer\"\"\"\n\n    def __init__(self, data_sources: dict, schedule: list):\n        \"\"\"\n        Initialize dynamic mixer\n\n        Args:\n            data_sources: Data source dictionary\n            schedule: [(step_threshold, weights_dict), ...]\n                     Use different mixing weights at different training steps\n        \"\"\"\n        self.data_sources = data_sources\n        self.schedule = sorted(schedule, key=lambda x: x[0])\n        self.current_step = 0\n\n    def get_weights(self) -&gt; dict:\n        \"\"\"Get weights for current step\"\"\"\n        for step_threshold, weights in reversed(self.schedule):\n            if self.current_step &gt;= step_threshold:\n                return weights\n        return self.schedule[0][1]\n\n    def sample_batch(self, batch_size: int) -&gt; list:\n        \"\"\"Sample one batch\"\"\"\n        weights = self.get_weights()\n        batch = []\n\n        for source_name, weight in weights.items():\n            num_samples = int(batch_size * weight)\n            data = self.data_sources[source_name]\n            batch.extend(random.choices(data, k=num_samples))\n\n        random.shuffle(batch)\n        self.current_step += 1\n        return batch[:batch_size]\n\n# Usage example: Emphasize diversity early, quality later\nschedule = [\n    (0, {'web': 0_5, 'books': 0_2, 'code': 0_15, 'papers': 0_1, 'wiki': 0_05}),\n    (100000, {'web': 0_4, 'books': 0_25, 'code': 0_15, 'papers': 0_15, 'wiki': 0_05}),\n    (500000, {'web': 0_3, 'books': 0_3, 'code': 0_2, 'papers': 0_15, 'wiki': 0_05}),\n]\n\nmixer = DynamicDataMixer(data_sources, schedule)\n</code></pre>"},{"location":"ja/part2/2_3_tokenization_serialization/#532","title":"5.3.2 \u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2","text":"<p>\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2\u306f\u3001\u4eba\u9593\u306e\u5b66\u7fd2\u306b\u30d2\u30f3\u30c8\u3092\u5f97\u305f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6226\u7565\u3067\u3059\u3002\u4e2d\u5fc3\u3068\u306a\u308b\u30a2\u30a4\u30c7\u30a2\u306f\u3001\u30e2\u30c7\u30eb\u306b\u6700\u521d\u306b\u300c\u7c21\u5358\u306a\u300d\u30b5\u30f3\u30d7\u30eb\u3092\u5b66\u7fd2\u3055\u305b\u3001\u6b21\u306b\u300c\u96e3\u3057\u3044\u300d\u30b5\u30f3\u30d7\u30eb\u306b\u5f90\u3005\u306b\u79fb\u884c\u3055\u305b\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u306e\u6226\u7565\u306f\u3001\u53ce\u675f\u3092\u52a0\u901f\u3057\u3001\u6700\u7d42\u7684\u306a\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u304c\u8907\u6570\u306e\u7814\u7a76\u3067\u8a3c\u660e\u3055\u308c\u3066\u3044\u307e\u3059\u3002</p> <p>\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u524d\u306e\u30b7\u30ca\u30ea\u30aa\u3067\u306f\u3001\u300c\u7c21\u5358\u300d\u3068\u300c\u96e3\u3057\u3044\u300d\u306f\u8907\u6570\u306e\u65b9\u6cd5\u3067\u5b9a\u7fa9\u3067\u304d\u307e\u3059\u3002</p> <p>\u9577\u3055\u30d9\u30fc\u30b9: \u901a\u5e38\u3001\u9577\u3044\u30c6\u30ad\u30b9\u30c8\u3088\u308a\u3082\u77ed\u3044\u30c6\u30ad\u30b9\u30c8\u306e\u65b9\u304c\u5b66\u7fd2\u3057\u3084\u3059\u3044\u3067\u3059\u3002\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u306f\u77ed\u3044\u30b7\u30fc\u30b1\u30f3\u30b9\u304b\u3089\u59cb\u3081\u3066\u3001\u5f90\u3005\u306b\u9577\u3055\u3092\u5897\u3084\u3057\u3066\u3044\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u96e3\u5ea6\u30d9\u30fc\u30b9: \u96e3\u5ea6\u306e\u4f4e\u3044\u30c6\u30ad\u30b9\u30c8 (\u8a00\u8a9e\u30e2\u30c7\u30eb\u304c\u3088\u308a\u300c\u6163\u308c\u3066\u3044\u308b\u300d\u30c6\u30ad\u30b9\u30c8) \u306f\u3001\u300c\u7c21\u5358\u306a\u300d\u30b5\u30f3\u30d7\u30eb\u3068\u307f\u306a\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u5c0f\u3055\u306a\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6e08\u307f\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u30b5\u30f3\u30d7\u30eb\u306e\u96e3\u6613\u5ea6\u3092\u8a55\u4fa1\u3057\u3001\u30e1\u30a4\u30f3 \u30e2\u30c7\u30eb\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u96e3\u6613\u5ea6\u9806\u306b\u4e26\u3079\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u30ce\u30a4\u30ba \u30ec\u30d9\u30eb \u30d9\u30fc\u30b9: \u6700\u521d\u306f\u9ad8\u54c1\u8cea\u3067\u30ce\u30a4\u30ba\u306e\u5c11\u306a\u3044\u30c6\u30ad\u30b9\u30c8\u304c\u4f7f\u7528\u3055\u308c\u3001\u6b21\u306b\u5f90\u3005\u306b\u4f4e\u54c1\u8cea\u3060\u304c\u56fa\u6709\u306e\u60c5\u5831\u304c\u542b\u307e\u308c\u308b\u53ef\u80fd\u6027\u306e\u3042\u308b\u30c6\u30ad\u30b9\u30c8\u304c\u5c0e\u5165\u3055\u308c\u307e\u3059\u3002</p> <pre><code>import numpy as np\n\nclass CurriculumScheduler:\n    \"\"\"Curriculum learning scheduler\"\"\"\n\n    def __init__(self, \n                 data: list, \n                 difficulty_scores: list,\n                 total_steps: int,\n                 strategy: str = 'linear'):\n        \"\"\"\n        Initialize curriculum scheduler\n\n        Args:\n            data: Data list\n            difficulty_scores: Difficulty score for each sample (higher = harder)\n            total_steps: Total training steps\n            strategy: Curriculum strategy ('linear', 'sqrt', 'exp')\n        \"\"\"\n        self.data = np.array(data)\n        self.difficulty_scores = np.array(difficulty_scores)\n        self.total_steps = total_steps\n        self.strategy = strategy\n\n        # Sort by difficulty\n        sorted_indices = np.argsort(self.difficulty_scores)\n        self.sorted_data = self.data[sorted_indices]\n        self.sorted_scores = self.difficulty_scores[sorted_indices]\n\n    def get_curriculum_fraction(self, current_step: int) -&gt; float:\n        \"\"\"\n        Compute data fraction to use at current step\n\n        Return value in [0, 1], indicating proportion of easiest data to use\n        \"\"\"\n        progress = current_step / self.total_steps\n\n        if self.strategy == 'linear':\n            return progress\n        elif self.strategy == 'sqrt':\n            return np.sqrt(progress)\n        elif self.strategy == 'exp':\n            return 1 - np.exp(-3 * progress)\n        else:\n            return progress\n\n    def sample_batch(self, current_step: int, batch_size: int) -&gt; list:\n        \"\"\"Sample batch according to current progress\"\"\"\n        fraction = self.get_curriculum_fraction(current_step)\n\n        # Determine available data range\n        available_size = max(int(len(self.sorted_data) * fraction), batch_size)\n        available_data = self.sorted_data[:available_size]\n\n        # Random sample from available range\n        indices = np.random.choice(len(available_data), size=batch_size, replace=True)\n        return available_data[indices].tolist()\n</code></pre> <p></p> <p>\u56f3 5-4: \u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u306e\u5b66\u7fd2\u539f\u5247 \u2014 \u7c21\u5358\u306a\u30b5\u30f3\u30d7\u30eb\u304b\u3089\u96e3\u3057\u3044\u30b5\u30f3\u30d7\u30eb\u3078\u306e\u6bb5\u968e\u7684\u306a\u79fb\u884c</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#533","title":"5.3.3 \u30c7\u30fc\u30bf\u306e\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3068\u30d0\u30c3\u30c1\u69cb\u7bc9","text":"<p>\u5b9f\u969b\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u306e\u7de8\u6210\u65b9\u6cd5\u304c\u52b9\u7387\u3068\u6709\u52b9\u6027\u306e\u4e21\u65b9\u306b\u5f71\u97ff\u3057\u307e\u3059\u3002\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u4e0a\u306e\u91cd\u8981\u306a\u8003\u616e\u4e8b\u9805\u3092\u3044\u304f\u3064\u304b\u793a\u3057\u307e\u3059\u3002</p> <p>\u30d1\u30c3\u30af\u6226\u7565: \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30ea\u30bd\u30fc\u30b9\u3092\u6700\u5927\u9650\u306b\u6d3b\u7528\u3059\u308b\u306b\u306f\u3001\u901a\u5e38\u3001\u8907\u6570\u306e\u77ed\u3044\u30b7\u30fc\u30b1\u30f3\u30b9\u304c\u56fa\u5b9a\u9577\u30b7\u30fc\u30b1\u30f3\u30b9\u306b\u30d1\u30c3\u30af\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30d1\u30c7\u30a3\u30f3\u30b0\u306b\u3088\u308b\u8a08\u7b97\u306e\u7121\u99c4\u304c\u524a\u6e1b\u3055\u308c\u307e\u3059\u3002\u91cd\u8981\u306a\u554f\u984c\u306f\u3001\u68b1\u5305\u5f8c\u306b\u6ce8\u610f\u30de\u30b9\u30af\u3092\u3069\u306e\u3088\u3046\u306b\u6271\u3046\u304b\u3067\u3059\u3002\u7570\u306a\u308b\u66f8\u985e\u304c\u76f8\u4e92\u306b\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u3079\u304d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002</p> <pre><code>def pack_sequences(sequences: list, max_length: int, eos_token_id: int) -&gt; list:\n    \"\"\"\n    Pack multiple short sequences to fixed length\n\n    Args:\n        sequences: List of token id sequences\n        max_length: Target sequence length\n        eos_token_id: End-of-sequence token ID\n\n    Returns:\n        List of packed sequences, each of length max_length\n    \"\"\"\n    packed = []\n    current_pack = []\n    current_length = 0\n\n    for seq in sequences:\n        seq_with_eos = seq + [eos_token_id]\n\n        if current_length + len(seq_with_eos) &lt;= max_length:\n            current_pack.extend(seq_with_eos)\n            current_length += len(seq_with_eos)\n        else:\n            # Current pack full, start new one\n            if current_pack:\n                # Pad to max_length\n                current_pack.extend([eos_token_id] * (max_length - current_length))\n                packed.append(current_pack)\n\n            current_pack = seq_with_eos\n            current_length = len(seq_with_eos)\n\n    # Handle last pack\n    if current_pack:\n        current_pack.extend([eos_token_id] * (max_length - current_length))\n        packed.append(current_pack)\n\n    return packed\n</code></pre> <p>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5883\u754c\u306e\u51e6\u7406: \u30b7\u30fc\u30b1\u30f3\u30b9\u3092\u30d1\u30c3\u30ad\u30f3\u30b0\u3059\u308b\u3068\u304d\u306f\u3001\u751f\u6210\u4e2d\u306b\u30e2\u30c7\u30eb\u304c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5883\u754c\u3092\u8d8a\u3048\u3066\u6ce8\u610f\u3092\u5b9f\u884c\u3057\u306a\u3044\u3088\u3046\u306b\u3059\u308b\u305f\u3081\u306b\u3001\u300c\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5883\u754c\u30de\u30b9\u30af\u300d\u3092\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u52b9\u7387: TB \u898f\u6a21\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u5834\u5408\u3001\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u81ea\u4f53\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u6700\u9069\u5316\u65b9\u6cd5\u306b\u306f\u3001\u524d\u51e6\u7406\u3055\u308c\u305f\u30c7\u30fc\u30bf\u3092\u30d0\u30a4\u30ca\u30ea\u5f62\u5f0f\u3067\u4fdd\u5b58\u3059\u308b (numpy memmap \u306a\u3069)\u3001\u30de\u30eb\u30c1\u30d7\u30ed\u30bb\u30b9\u306e\u4e26\u5217\u30ed\u30fc\u30c9\u3001\u6b21\u306e\u30d0\u30c3\u30c1\u306e\u30d7\u30ea\u30d5\u30a7\u30c3\u30c1\u304c\u542b\u307e\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#534","title":"5.3.4 \u30b7\u30ea\u30a2\u30eb\u5316\u3068\u30b9\u30c8\u30ec\u30fc\u30b8\u5f62\u5f0f","text":"<p>\u30c8\u30fc\u30af\u30f3\u5316\u5f8c\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306b\u9ad8\u901f\u306b\u8aad\u307f\u53d6\u308b\u305f\u3081\u306b\u3001\u30c8\u30fc\u30af\u30f3 \u30b7\u30fc\u30b1\u30f3\u30b9\u3092\u52b9\u7387\u7684\u306a\u5f62\u5f0f\u3067\u4fdd\u5b58\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u4e00\u822c\u7684\u306a\u30b9\u30c8\u30ec\u30fc\u30b8\u5f62\u5f0f\u306b\u306f\u6b21\u306e\u3082\u306e\u304c\u542b\u307e\u308c\u307e\u3059\u3002</p> <p>NumPy memmap: \u30c8\u30fc\u30af\u30f3 ID \u3092 numpy \u914d\u5217\u3068\u3057\u3066\u4fdd\u5b58\u3057\u3001\u30e1\u30e2\u30ea \u30de\u30c3\u30d4\u30f3\u30b0\u7d4c\u7531\u3067\u30a2\u30af\u30bb\u30b9\u3057\u307e\u3059\u3002\u5229\u70b9\u306f\u30b7\u30f3\u30d7\u30eb\u304b\u3064\u76f4\u63a5\u7684\u3067\u3042\u308a\u3001\u30e9\u30f3\u30c0\u30e0 \u30a2\u30af\u30bb\u30b9\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002\u6b20\u70b9\u306f\u3001\u5727\u7e2e\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u306a\u3044\u3053\u3068\u3001\u30b9\u30c8\u30ec\u30fc\u30b8\u304c\u5927\u304d\u3044\u3053\u3068\u3067\u3059\u3002</p> <pre><code>import numpy as np\n\ndef save_as_memmap(token_ids: list, output_path: str):\n    \"\"\"Save token ID list as memmap format\"\"\"\n    arr = np.array(token_ids, dtype=np.uint16)  # Assume vocabulary &lt; 65536\n    fp = np.memmap(output_path, dtype='uint16', mode='w+', shape=arr.shape)\n    fp[:] = arr[:]\n    fp.flush()\n\ndef load_memmap(path: str, shape: tuple):\n    \"\"\"Load memmap format token IDs\"\"\"\n    return np.memmap(path, dtype='uint16', mode='r', shape=shape)\n</code></pre> <p>Arrow/Parquet: Apache Arrow \u5f62\u5f0f\u3092\u4f7f\u7528\u3057\u3001\u5727\u7e2e\u3068\u52b9\u7387\u7684\u306a\u5217\u6307\u5411\u30a2\u30af\u30bb\u30b9\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002 HuggingFace \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u5185\u90e8\u3067\u3053\u306e\u5f62\u5f0f\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <p>\u30ab\u30b9\u30bf\u30e0 \u30d0\u30a4\u30ca\u30ea\u5f62\u5f0f: \u4e00\u90e8\u306e\u5927\u898f\u6a21\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u3067\u306f\u3001\u7279\u5b9a\u306e\u30a2\u30af\u30bb\u30b9 \u30d1\u30bf\u30fc\u30f3\u306b\u6700\u9069\u5316\u3055\u308c\u305f\u30ab\u30b9\u30bf\u30e0 \u30d0\u30a4\u30ca\u30ea\u5f62\u5f0f\u304c\u4f7f\u7528\u3055\u308c\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001GPT-NeoX \u3067\u4f7f\u7528\u3055\u308c\u308b\u30d0\u30a4\u30ca\u30ea \u30d1\u30c3\u30ad\u30f3\u30b0\u5f62\u5f0f\u3002</p> <pre><code># Use HuggingFace Datasets for tokenized data\nfrom datasets import Dataset\n\ndef tokenize_and_save(raw_data: list, tokenizer, output_dir: str):\n    \"\"\"Tokenize and save as Datasets format\"\"\"\n\n    def tokenize_function(examples):\n        return tokenizer(\n            examples['text'],\n            truncation=True,\n            max_length=2048,\n            return_attention_mask=False\n        )\n\n    # Create Dataset\n    ds = Dataset.from_dict({'text': raw_data})\n\n    # Tokenize\n    tokenized_ds = ds.map(\n        tokenize_function,\n        batched=True,\n        num_proc=16,\n        remove_columns=['text']\n    )\n\n    # Save\n    tokenized_ds.save_to_disk(output_dir)\n</code></pre>"},{"location":"ja/part2/2_3_tokenization_serialization/#54","title":"5.4 \u5b8c\u5168\u306a\u30c7\u30fc\u30bf\u6e96\u5099\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u4e0a\u3067\u8aac\u660e\u3057\u305f\u30b9\u30c6\u30c3\u30d7\u3092\u63a5\u7d9a\u3057\u3066\u3001\u751f\u306e\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u6e96\u5099\u304c\u3067\u304d\u305f\u30c7\u30fc\u30bf\u307e\u3067\u306e\u5b8c\u5168\u306a\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <pre><code>from dataclasses import dataclass\nfrom typing import Optional\nimport sentencepiece as spm\n\n@dataclass\nclass DataPrepConfig:\n    \"\"\"Data preparation configuration\"\"\"\n    # Tokenizer config\n    tokenizer_path: str\n    max_seq_length: int = 2048\n\n    # Data mixing config\n    mix_weights: dict = None  # {source: weight}\n\n    # Curriculum learning config\n    use_curriculum: bool = False\n    curriculum_strategy: str = 'linear'\n\n    # Output config\n    pack_sequences: bool = True\n    output_format: str = 'arrow'  # 'arrow', 'memmap', 'jsonl'\n\nclass DataPreparationPipeline:\n    \"\"\"Data preparation pipeline\"\"\"\n\n    def __init__(self, config: DataPrepConfig):\n        self.config = config\n        self.tokenizer = spm.SentencePieceProcessor(model_file=config.tokenizer_path)\n\n    def tokenize_document(self, text: str) -&gt; list:\n        \"\"\"Tokenize single document\"\"\"\n        return self.tokenizer.encode(text)\n\n    def process_source(self, source_path: str, source_name: str) -&gt; list:\n        \"\"\"Process single data source\"\"\"\n        documents = self.load_documents(source_path)\n\n        tokenized = []\n        for doc in documents:\n            tokens = self.tokenize_document(doc['text'])\n            if len(tokens) &gt; 10:  # Filter too-short documents\n                tokenized.append({\n                    'input_ids': tokens,\n                    'source': source_name,\n                    'length': len(tokens)\n                })\n\n        return tokenized\n\n    def mix_sources(self, sources: dict) -&gt; list:\n        \"\"\"Mix multiple data sources\"\"\"\n        mixed = []\n        weights = self.config.mix_weights or {s: 1_0 for s in sources}\n        total_weight = sum(weights.values())\n\n        # Determine sample count per source\n        total_samples = sum(len(data) for data in sources.values())\n\n        for source_name, data in sources.items():\n            weight = weights.get(source_name, 1_0) / total_weight\n            num_samples = int(total_samples * weight)\n\n            if len(data) &gt;= num_samples:\n                sampled = random.sample(data, num_samples)\n            else:\n                sampled = random.choices(data, k=num_samples)\n\n            mixed.extend(sampled)\n\n        random.shuffle(mixed)\n        return mixed\n\n    def pack_and_save(self, data: list, output_path: str):\n        \"\"\"Pack and save data\"\"\"\n        if self.config.pack_sequences:\n            sequences = [d['input_ids'] for d in data]\n            packed = pack_sequences(\n                sequences, \n                self.config.max_seq_length,\n                self.tokenizer.eos_id()\n            )\n        else:\n            packed = [d['input_ids'] for d in data]\n\n        # Select output format based on config\n        if self.config.output_format == 'arrow':\n            self.save_as_arrow(packed, output_path)\n        elif self.config.output_format == 'memmap':\n            self.save_as_memmap(packed, output_path)\n        else:\n            self.save_as_jsonl(packed, output_path)\n\n    def run(self, source_paths: dict, output_path: str):\n        \"\"\"Run complete pipeline\"\"\"\n        # 1. Process each data source\n        sources = {}\n        for source_name, path in source_paths.items():\n            print(f\"Processing {source_name}...\")\n            sources[source_name] = self.process_source(path, source_name)\n\n        # 2. Mix data\n        print(\"Mixing data sources...\")\n        mixed = self.mix_sources(sources)\n\n        # 3. Optional: Apply curriculum ordering\n        if self.config.use_curriculum:\n            print(\"Applying curriculum ordering...\")\n            mixed = self.apply_curriculum(mixed)\n\n        # 4. Pack and save\n        print(\"Packing and saving...\")\n        self.pack_and_save(mixed, output_path)\n\n        print(f\"Done! Saved {len(mixed)} samples to {output_path}\")\n</code></pre> <p></p> <p>\u56f3 5-5: \u751f\u306e\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u53ef\u80fd\u306a\u30c7\u30fc\u30bf\u307e\u3067\u306e\u5b8c\u5168\u306a\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#55","title":"5.5 \u7ae0\u306e\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001\u30c8\u30fc\u30af\u30f3\u5316\u3068\u30c7\u30fc\u30bf\u306e\u30b7\u30ea\u30a2\u30eb\u5316\u306e\u30b3\u30a2\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u3092\u4f53\u7cfb\u7684\u306b\u7d39\u4ecb\u3057\u307e\u3057\u305f\u3002</p> <p>\u30c8\u30fc\u30af\u30ca\u30a4\u30b6\u30fc\u306e\u539f\u5247: \u30b5\u30d6\u30ef\u30fc\u30c9\u306e\u30c8\u30fc\u30af\u30f3\u5316\u306f\u3001\u73fe\u5728\u306e\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u4e3b\u6d41\u306e\u9078\u629e\u80a2\u3067\u3042\u308a\u3001\u8a9e\u5f59\u30b5\u30a4\u30ba\u3068\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u9577\u3055\u306e\u30d0\u30e9\u30f3\u30b9\u304c\u53d6\u308c\u3066\u3044\u307e\u3059\u3002 BPE \u306f\u3001\u30b7\u30f3\u30d7\u30eb\u304b\u3064\u52b9\u7387\u7684\u306a\u5468\u6ce2\u6570\u99c6\u52d5\u306e\u30dc\u30c8\u30e0\u30a2\u30c3\u30d7 \u30de\u30fc\u30b8\u6226\u7565\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 WordPiece \u306f\u3001\u4f4e\u983b\u5ea6\u306e\u610f\u5473\u306e\u3042\u308b\u30d1\u30bf\u30fc\u30f3\u306b\u5bfe\u3057\u3066\u3088\u308a\u654f\u611f\u306a\u5c24\u5ea6\u4e3b\u5c0e\u306e\u7d50\u5408\u57fa\u6e96\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 Unigram \u306f\u3001\u7406\u8ad6\u7684\u306b\u306f\u3088\u308a\u30a8\u30ec\u30ac\u30f3\u30c8\u306a\u30c8\u30c3\u30d7\u30c0\u30a6\u30f3\u78ba\u7387\u30e2\u30c7\u30ea\u30f3\u30b0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 SentencePiece \u306f\u6700\u3082\u4e00\u822c\u7684\u306b\u4f7f\u7528\u3055\u308c\u308b\u30c4\u30fc\u30eb\u30ad\u30c3\u30c8\u3067\u3001\u8907\u6570\u306e\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3068\u8a00\u8a9e\u306b\u4f9d\u5b58\u3057\u306a\u3044\u51e6\u7406\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u3044\u307e\u3059\u3002</p> <p>\u8a9e\u5f59\u306e\u8a2d\u8a08: \u8a9e\u5f59\u306e\u30b5\u30a4\u30ba\u306b\u306f\u3001\u8a08\u7b97\u52b9\u7387\u3001\u30b7\u30fc\u30b1\u30f3\u30b9\u306e\u9577\u3055\u3001\u304a\u3088\u3073\u7a00\u306a\u5358\u8a9e\u306e\u51e6\u7406\u306e\u9593\u306e\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5\u304c\u5fc5\u8981\u3067\u3059\u3002\u4e3b\u6d41\u30e2\u30c7\u30eb\u306f\u901a\u5e38 32K \uff5e 128K \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u591a\u8a00\u8a9e\u8a9e\u5f59\u306e\u8a2d\u8a08\u3067\u306f\u3001\u8a00\u8a9e\u9593\u3067\u30ab\u30d0\u30ec\u30c3\u30b8\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u3068\u308a\u3001\u300c\u8a9e\u5f59\u306e\u546a\u3044\u300d\u3092\u56de\u907f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306e\u8a9e\u5f59\u62e1\u5f35\u306b\u3088\u308a\u3001\u5c02\u9580\u7528\u8a9e\u306e\u51e6\u7406\u304c\u5411\u4e0a\u3057\u307e\u3059\u304c\u3001\u305d\u308c\u306b\u5fdc\u3058\u3066\u30e2\u30c7\u30ebEmbedding\u5c64\u3092\u62e1\u5f35\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30c7\u30fc\u30bf\u6df7\u5408\u306e\u5834\u5408: \u9759\u7684\u6df7\u5408\u306f\u30b7\u30f3\u30d7\u30eb\u304b\u3064\u76f4\u63a5\u7684\u3067\u3059\u3002\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u30df\u30ad\u30b7\u30f3\u30b0\u306b\u3088\u308a\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306b\u6bd4\u7387\u3092\u8abf\u6574\u3067\u304d\u307e\u3059\u3002\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2\u6226\u7565\u306f\u7c21\u5358\u306a\u30b5\u30f3\u30d7\u30eb\u304b\u3089\u59cb\u307e\u308a\u3001\u5f90\u3005\u306b\u96e3\u3057\u3044\u30b5\u30f3\u30d7\u30eb\u306b\u79fb\u884c\u3059\u308b\u3053\u3068\u3067\u3001\u53ce\u675f\u3092\u52a0\u901f\u3057\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u5927\u898f\u6a21\u306a\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u306f\u3001\u30c7\u30fc\u30bf\u306e\u30d1\u30c3\u30ad\u30f3\u30b0\u3068\u52b9\u7387\u7684\u306a\u30b9\u30c8\u30ec\u30fc\u30b8\u5f62\u5f0f\u304c\u91cd\u8981\u3067\u3059\u3002</p> <p></p> <p>\u56f3 5-6: \u7b2c 5 \u7ae0 \u77e5\u8b58\u69cb\u9020 \u2014 3 \u3064\u306e\u30c6\u30fc\u30de: \u30c8\u30fc\u30af\u30f3\u5316\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3001\u8a9e\u5f59\u8a2d\u8a08\u3001\u30c7\u30fc\u30bf\u69cb\u6210</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#_3","title":"\u3055\u3089\u306b\u8aad\u3080","text":"<p>\u30c8\u30fc\u30af\u30f3\u5316\u3068\u30c7\u30fc\u30bf\u306e\u30b7\u30ea\u30a2\u30eb\u5316\u306b\u95a2\u3059\u308b\u8a73\u7d30\u306a\u5185\u5bb9\u306b\u3064\u3044\u3066\u306f\u3001\u6b21\u306e\u30ea\u30bd\u30fc\u30b9\u3092\u53c2\u7167\u3059\u308b\u4fa1\u5024\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>SentencePiece \u306e\u8ad6\u6587 (Kudo \u3068 Richardson\u30012018 \u5e74) \u3067\u306f\u3001\u8a00\u8a9e\u306b\u4f9d\u5b58\u3057\u306a\u3044\u30b5\u30d6\u30ef\u30fc\u30c9\u306e\u30c8\u30fc\u30af\u30f3\u5316\u304c\u5c0e\u5165\u3055\u308c\u3066\u3044\u307e\u3059\u3002 BPE \u306e\u8ad6\u6587 (Sennrich et al.\u30012015) \u306f\u3001BPE \u3092 NLP \u306b\u5c0e\u5165\u3057\u305f\u5148\u99c6\u7684\u306a\u7814\u7a76\u3067\u3059\u3002 Unigram \u306e\u8ad6\u6587 (Kudo\u30012018) \u306f\u3001\u30b5\u30d6\u30ef\u30fc\u30c9\u306e\u30c8\u30fc\u30af\u30f3\u5316\u306b\u95a2\u3059\u308b\u78ba\u7387\u8ad6\u7684\u306a\u89b3\u70b9\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002 HuggingFace Tokenizers \u30e9\u30a4\u30d6\u30e9\u30ea\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (huggingface.co/docs/tokenizers) \u306f\u3001\u4fe1\u983c\u3067\u304d\u308b\u5b9f\u7528\u7684\u306a\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u3067\u3059\u3002\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2\u306b\u3064\u3044\u3066\u306f\u3001Bengio \u3089\u306e\u8abf\u67fb\u8ad6\u6587\u304c\u5305\u62ec\u7684\u306a\u7406\u8ad6\u7684\u67a0\u7d44\u307f\u3092\u63d0\u4f9b\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part2/2_3_tokenization_serialization/#_4","title":"\u6b21\u306e\u7ae0\u306e\u30d7\u30ec\u30d3\u30e5\u30fc","text":"<p>\u3053\u308c\u3067\u3001\u30c6\u30ad\u30b9\u30c8\u4e8b\u524d\u5b66\u7fd2\u30c7\u30fc\u30bf\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306b\u95a2\u3059\u308b\u3059\u3079\u3066\u306e\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u5b8c\u4e86\u3057\u307e\u3057\u305f\u3002\u6b21\u306e\u7ae0\u300c\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u306e\u51e6\u7406\u300d\u3067\u306f\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u5206\u91ce\u306b\u5165\u308a\u307e\u3059\u3002 LAION-5B \u30b9\u30bf\u30a4\u30eb\u306e\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2 \u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u65b9\u6cd5\u3001\u540c\u6642\u5b9f\u884c\u6027\u306e\u9ad8\u3044\u753b\u50cf\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306b img2dataset \u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u3001\u304a\u3088\u3073\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</p> <p>\u6b21\u306e\u7ae0\u306b\u5165\u308b\u3068\u304d\u306b\u3001\u6b21\u306e\u8cea\u554f\u306b\u3064\u3044\u3066\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u3002\u753b\u50cf\u306e\u300c\u54c1\u8cea\u300d\u306f\u3069\u306e\u3088\u3046\u306b\u5b9a\u7fa9\u3055\u308c\u308b\u3079\u304d\u3067\u3059\u304b?\u89e3\u50cf\u5ea6\u3068\u660e\u77ad\u3055\u4ee5\u5916\u306b\u3001\u4ed6\u306b\u3069\u306e\u3088\u3046\u306a\u70b9\u3092\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u304b?</p>"},{"location":"ja/part3/3_1_image_text_pairs/","title":"\u7b2c6\u7ae0: \u753b\u50cf\u30fb\u30c6\u30ad\u30b9\u30c8\u30da\u30a2\u51e6\u7406","text":""},{"location":"ja/part3/3_1_image_text_pairs/#6","title":"\u7b2c 6 \u7ae0: \u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u306e\u30c7\u30fc\u30bf\u51e6\u7406","text":""},{"location":"ja/part3/3_1_image_text_pairs/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u6b21\u4e16\u4ee3\u306e\u57fa\u790e\u30e2\u30c7\u30eb\u3092\u69cb\u7bc9\u3059\u308b\u904e\u7a0b\u306b\u304a\u3044\u3066\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u7126\u70b9\u306f\u3001\u5358\u306a\u308b\u30c6\u30ad\u30b9\u30c8\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u304b\u3089\u3001\u7269\u7406\u4e16\u754c\u304b\u3089\u306e\u591a\u6b21\u5143\u4fe1\u53f7\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u3001\u4f4d\u7f6e\u5408\u308f\u305b\u3001\u518d\u69cb\u7bc9\u3078\u3068\u79fb\u308a\u307e\u3057\u305f\u3002\u8a00\u8a9e\u30e2\u30c7\u30eb \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u304c\u300c\u30ce\u30a4\u30ba\u9664\u53bb\u300d\u306b\u95a2\u3059\u308b\u3082\u306e\u3067\u3042\u308c\u3070\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306f\u300c\u95a2\u9023\u4ed8\u3051\u300d\u3068\u300c\u8abf\u6574\u300d\u306b\u95a2\u3059\u308b\u3082\u306e\u3067\u3059\u3002 GPT-4V\u3001Gemini\u3001Sora \u306e\u51fa\u73fe\u306b\u3088\u308a\u3001\u5358\u4e00\u30e2\u30c0\u30ea\u30c6\u30a3 \u30c7\u30fc\u30bf\u3067\u306f\u3082\u306f\u3084\u4e16\u754c\u3092\u7406\u89e3\u3057\u305f\u3044\u3068\u3044\u3046\u30e2\u30c7\u30eb\u306e\u6b32\u6c42\u3092\u6e80\u305f\u3059\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002</p> <p>\u3053\u306e\u7ae0\u3067\u306f\u300110 \u5104\u898f\u6a21\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u5b8c\u5168\u306a\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u8a73\u7d30\u306a\u5206\u6790\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u753b\u50cf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3059\u308b\u305f\u3081\u306e\u3044\u304f\u3064\u304b\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3092\u8a18\u8ff0\u3059\u308b\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af \u30d7\u30ed\u30c8\u30b3\u30eb\u3001\u5206\u6563\u30b9\u30c8\u30ec\u30fc\u30b8\u3001\u7570\u7a2e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u3001\u7f8e\u7684\u8a55\u4fa1\u3092\u542b\u3080\u5305\u62ec\u7684\u306a\u30ad\u30e3\u30f3\u30da\u30fc\u30f3\u3067\u3059\u3002\u30c7\u30fc\u30bf \u30d1\u30e9\u30c0\u30a4\u30e0\u306e\u57fa\u790e\u3068\u306a\u308b\u30ed\u30b8\u30c3\u30af\u3092\u8abf\u67fb\u3057\u3001\u5206\u6563\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0 \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u6d3b\u7528\u3057\u3066\u5927\u898f\u6a21\u306a\u753b\u50cf\u306e\u540c\u6642\u5b9f\u884c\u6027\u306e\u9ad8\u3044\u53d6\u5f97\u306e\u8ab2\u984c\u3092\u89e3\u6c7a\u3059\u308b\u65b9\u6cd5\u3092\u5206\u6790\u3057\u3001GPU \u30cf\u30fc\u30c9\u30a6\u30a7\u30a2 \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u4f7f\u7528\u3057\u3066\u753b\u50cf\u524d\u51e6\u7406\u306e I/O \u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u7a81\u7834\u3057\u307e\u3059\u3002\u3055\u3089\u306b\u3001\u30bb\u30de\u30f3\u30c6\u30a3\u30af\u30b9\u3068\u7f8e\u5b66\u306b\u57fa\u3065\u3044\u3066\u81ea\u52d5\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u3001\u30e2\u30c7\u30eb\u306b\u5165\u529b\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306e\u95a2\u9023\u6027\u3068\u5b89\u5168\u6027\u3092\u78ba\u4fdd\u3057\u307e\u3059\u3002</p> <p>\u5b66\u7fd2\u76ee\u6a19: * LAION-5B (\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2) \u304a\u3088\u3073 OBELICS (\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8) \u30d1\u30e9\u30c0\u30a4\u30e0\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u5229\u70b9\u3068\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u8ab2\u984c\u3092\u7406\u89e3\u3057\u3001\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9 \u30c7\u30fc\u30bf\u6226\u7565\u306e\u8a2d\u8a08\u3092\u7fd2\u5f97\u3057\u307e\u3059\u3002 * PySpark \u3068 Ray Data \u306b\u57fa\u3065\u3044\u3066\u5206\u6563\u30c0\u30a6\u30f3\u30ed\u30fc\u30c0\u30fc\u3092\u4f5c\u6210\u3057\u3001DNS \u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3068\u30ed\u30f3\u30b0\u30c6\u30fc\u30eb \u30ec\u30a4\u30c6\u30f3\u30b7\u30fc\u3092\u51e6\u7406\u3057\u300110,000 \u753b\u50cf/\u79d2\u4ee5\u4e0a\u306e\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u9054\u6210\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002 * NVIDIA DALI \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8a2d\u8a08\u3092\u30de\u30b9\u30bf\u30fc\u3057\u3001CPU \u30c7\u30b3\u30fc\u30c9\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u89e3\u6c7a\u3057\u3001GPU \u30c0\u30a4\u30ec\u30af\u30c8\u539f\u7406\u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u3092\u6700\u9069\u5316\u3057\u307e\u3059\u3002 * CLIP \u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u5be9\u7f8e\u7684\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u3001\u5b89\u5168\u6027\u691c\u51fa\u3092\u542b\u3080\u591a\u6bb5\u968e\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d5\u30a1\u30cd\u30eb\u3092\u69cb\u7bc9\u3057\u3001\u3055\u307e\u3056\u307e\u306a\u30d3\u30b8\u30cd\u30b9 \u30b7\u30ca\u30ea\u30aa\u306b\u5408\u308f\u305b\u305f\u30de\u30b9\u30bf\u30fc\u3057\u304d\u3044\u5024\u8abf\u6574\u6226\u7565\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <p>\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb:</p> <p>\u300c\u6b21\u306e\u30b7\u30ca\u30ea\u30aa\u3092\u60f3\u50cf\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u79c1\u305f\u3061\u306e\u30af\u30ed\u30fc\u30e9 \u30c1\u30fc\u30e0\u306f\u3001Common Crawl \u304b\u3089 20 \u5104\u306e\u751f\u306e URL \u3092\u62bd\u51fa\u3057\u3001\u6570\u5343\u306e Parquet \u30d5\u30a1\u30a4\u30eb\u306b\u4fdd\u5b58\u3057\u307e\u3057\u305f\u3002\u3042\u306a\u305f\u306e\u4ed5\u4e8b\u306f\u3001\u3053\u306e\u30c7\u30fc\u30bf\u3092 2 \u9031\u9593\u4ee5\u5185\u306b GPT-4V \u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u9069\u3057\u305f\u9ad8\u54c1\u8cea\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u5358\u4e00\u30de\u30b7\u30f3\u3067\u5f93\u6765\u306e Python \u30ea\u30af\u30a8\u30b9\u30c8 \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u4f7f\u7528\u3057\u3066\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u3088\u3046\u3068\u3059\u308b\u3068\u3001\u63a8\u5b9a\u6642\u9593\u304c 15 \u5e74\u3082\u304b\u304b\u308b\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u5178\u578b\u7684\u306a\u30cd\u30c3\u30c8\u30ef\u30fc\u30af I/O \u30d6\u30ed\u30c3\u30af\u554f\u984c\u3067\u3059\u3002\u3055\u3089\u306b\u60aa\u3044\u3053\u3068\u306b\u3001\u4e88\u5099\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3067\u306f\u3001\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u305f\u753b\u50cf\u306f\u96fb\u5b50\u5546\u53d6\u5f15\u5e83\u544a (\u30ce\u30a4\u30ba\u3060\u3089\u3051)\u300115% \u306b\u306f\u91cd\u5927\u306a\u30a6\u30a9\u30fc\u30bf\u30fc\u30de\u30fc\u30af\u304c\u542b\u307e\u308c\u3066\u304a\u308a\u3001\u91cd\u5927\u306a NSFW \u30b3\u30f3\u30c6\u30f3\u30c4\u3055\u3048\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u30c7\u30fc\u30bf\u3092\u76f4\u63a5\u4f7f\u7528\u3059\u308b\u3068\u3001\u8a08\u7b97\u306b\u6570\u767e\u4e07\u30c9\u30eb\u3092\u7121\u99c4\u306b\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u304c\u4e0d\u5feb\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306b\u6cd5\u7684\u30ea\u30b9\u30af\u306b\u76f4\u9762\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u8ab2\u984c\u306b\u5bfe\u51e6\u3059\u308b\u306b\u306f\u3001\u7523\u696d\u30b0\u30ec\u30fc\u30c9\u306e\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30c8\u306a\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002\u300d</p>"},{"location":"ja/part3/3_1_image_text_pairs/#61-laion-5b-obelicsmmc4","title":"6.1 \u30c7\u30fc\u30bf \u30d1\u30e9\u30c0\u30a4\u30e0: \u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2 (LAION-5B) \u3068\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (OBELICS/MMC4)","text":"<p>\u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u8a2d\u8a08\u3059\u308b\u524d\u306b\u3001\u79c1\u305f\u3061\u306e\u6700\u521d\u306e\u8cac\u4efb\u306f\u30c7\u30fc\u30bf\u306e\u7de8\u6210\u5f62\u5f0f\u3092\u660e\u78ba\u306b\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u306f\u30b9\u30c8\u30ec\u30fc\u30b8\u69cb\u9020\u3060\u3051\u3067\u306a\u304f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u76ee\u7684\u3068\u4e0b\u6d41\u30e2\u30c7\u30eb\u306e\u5275\u767a\u7684\u306a\u6a5f\u80fd\u3082\u76f4\u63a5\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u7570\u306a\u308b\u30c7\u30fc\u30bf\u5f62\u5f0f\u306f\u3001\u672c\u8cea\u7684\u306b\u3001\u300c\u77e5\u8b58\u304c\u4e16\u754c\u306b\u3069\u306e\u3088\u3046\u306b\u5b58\u5728\u3059\u308b\u304b\u300d\u306e\u7570\u306a\u308b\u62bd\u8c61\u5316\u3067\u3059\u3002</p>"},{"location":"ja/part3/3_1_image_text_pairs/#611","title":"6.1.1 \u4e2d\u5fc3\u3068\u306a\u308b\u6982\u5ff5\u3068\u539f\u5247","text":"<p>\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2 CLIP\u3001ALIGN\u3001LAION-5B \u306b\u4ee3\u8868\u3055\u308c\u308b\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u5b66\u7fd2\u306e\u57fa\u790e\u3067\u3059\u3002 * \u7406\u8ad6\u7684\u5206\u6790: \u3053\u306e\u30d1\u30e9\u30c0\u30a4\u30e0\u306f\u3001\u753b\u50cf \\(I\\) \u3068\u30c6\u30ad\u30b9\u30c8 \\(T\\) \u306e\u9593\u306b\u5f37\u3044\u610f\u5473\u7684\u95a2\u9023\u6027\u304c\u3042\u308a\u3001\u3053\u306e\u95a2\u9023\u6027\u304c\u72ec\u7acb\u304b\u3064\u539f\u5b50\u7684\u3067\u3042\u308b\u3053\u3068\u3092\u524d\u63d0\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u901a\u5e38\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u76ee\u7684\u306f\u3001\u5171\u6709Embedding\u7a7a\u9593\u3067 \\(I\\) \u3068 \\(T\\) \u306e\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\u3092\u6700\u5927\u5316\u3059\u308b\u3053\u3068\u3067\u3059 (\u5bfe\u7167\u5b66\u7fd2)\u3002\u305d\u306e\u5229\u70b9\u306f\u3001\u975e\u5e38\u306b\u9ad8\u3044\u300c\u4fe1\u53f7\u5bfe\u30ce\u30a4\u30ba\u6bd4\u300d\u306e\u6d17\u7df4\u306e\u53ef\u80fd\u6027\u306b\u3042\u308a\u307e\u3059\u3002\u30e2\u30c7\u30eb\u306f\u3001\u5bfe\u7167\u5b66\u7fd2\u3092\u901a\u3058\u3066\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u8a9e\u5f59\u306e\u9593\u306e\u76f4\u63a5\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u5b66\u7fd2\u3057\u307e\u3059\u3002 * \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u89b3\u70b9: \u30c7\u30fc\u30bf\u69cb\u9020\u306f\u5358\u7d14\u3067\u3001\u901a\u5e38\u306f <code>(url, caption, metadata)</code> \u306e\u30d5\u30e9\u30c3\u30c8\u5316\u3055\u308c\u305f\u30ec\u30b3\u30fc\u30c9\u3068\u3057\u3066\u8868\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u30c7\u30fc\u30bf\u306f\u3001\u30b7\u30e3\u30fc\u30c7\u30a3\u30f3\u30b0\u3084\u30e9\u30f3\u30c0\u30e0 \u30b7\u30e3\u30c3\u30d5\u30eb\u304c\u975e\u5e38\u306b\u7c21\u5358\u3067\u3059\u3002\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u3001\u30b5\u30f3\u30d7\u30eb\u306f\u72ec\u7acb\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u30b0\u30ed\u30fc\u30d0\u30eb \u30d0\u30c3\u30c1 \u30b7\u30e3\u30c3\u30d5\u30ea\u30f3\u30b0\u3092\u7c21\u5358\u306b\u5b9f\u88c5\u3057\u3066\u3001\u5bfe\u6bd4\u5b66\u7fd2\u306e\u52b9\u679c\u3092\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 OBELICS\u3084MMC4\u306b\u4ee3\u8868\u3055\u308c\u308b\u6b21\u4e16\u4ee3\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u5927\u578b\u30e2\u30c7\u30eb\uff08Flamingo\u3001GPT-4V\u3001MM1\u306a\u3069\uff09\u306e\u9375\u3068\u306a\u308b\u71c3\u6599\u3067\u3059\u3002 * \u7406\u8ad6\u5206\u6790: \u3053\u306e\u30d1\u30e9\u30c0\u30a4\u30e0\u306f\u3001<code>&lt;text&gt;, &lt;image&gt;, &lt;text&gt;...</code> \u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3068\u3057\u3066\u8868\u793a\u3055\u308c\u308b\u30c7\u30fc\u30bf\u3068\u3068\u3082\u306b\u3001Web \u30da\u30fc\u30b8\u306e\u5143\u306e DOM \u69cb\u9020\u9806\u5e8f\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30e2\u30c7\u30eb\u306f\u300c\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u4f9d\u5b58\u95a2\u4fc2\u300d(\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30a4\u30f3\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u5b66\u7fd2) \u3092\u5b66\u7fd2\u3059\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300c\u30b1\u30fc\u30ad\u306e\u4f5c\u308a\u65b9\u300dWeb \u30da\u30fc\u30b8\u3067\u306f\u3001\u753b\u50cf 1 (\u6750\u6599) \u3068\u753b\u50cf 5 (\u5b8c\u6210\u54c1) \u306e\u95a2\u4fc2\u3001\u304a\u3088\u3073\u5468\u56f2\u306e\u30c6\u30ad\u30b9\u30c8\u3068\u306e\u8ad6\u7406\u7684\u63a5\u7d9a\u306f\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u3067\u306f\u63d0\u4f9b\u3067\u304d\u307e\u305b\u3093\u3002\u4eba\u9593\u304c\u7d75\u672c\u3092\u8aad\u3093\u3067\u3044\u308b\u3068\u304d\u306e\u8a8d\u77e5\u30d7\u30ed\u30bb\u30b9\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\u3057\u307e\u3059\u3002 * \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u89b3\u70b9: \u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306f\u975e\u5e38\u306b\u8907\u96d1\u3067\u3059\u3002\u500b\u3005\u306e\u30b5\u30f3\u30d7\u30eb (\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8) \u306f\u53ef\u5909\u9577\u3067\u3042\u308a\u3001\u8907\u6570\u306e\u753b\u50cf\u304c\u542b\u307e\u308c\u308b\u5834\u5408\u304c\u3042\u308b\u305f\u3081\u3001\u30d0\u30c3\u30c1\u306e\u7d44\u307f\u7acb\u3066\u304c\u56f0\u96e3\u306b\u306a\u308a\u307e\u3059\u3002\u5f93\u6765\u306e Collat\u200b\u200bor \u3067\u306f\u3001\u8907\u96d1\u306a\u30d1\u30c7\u30a3\u30f3\u30b0\u6226\u7565\u304c\u5fc5\u8981\u3067\u3059\u3002\u3055\u3089\u306b\u3001\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u4e2d\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u6574\u5408\u6027\u3092\u6ce8\u610f\u6df1\u304f\u7dad\u6301\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4f4e\u54c1\u8cea\u306e\u753b\u50cf\u3092\u6063\u610f\u7684\u306b\u524a\u9664\u3059\u308b\u3068\u3001\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8 \u30ed\u30b8\u30c3\u30af\u304c\u7834\u640d\u3057\u3001\u30e2\u30c7\u30eb\u304c\u8aa4\u3063\u305f\u53c2\u7167\u95a2\u4fc2\u3092\u5b66\u7fd2\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_1_image_text_pairs/#612","title":"6.1.2 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u6c7a\u5b9a: \u6bd4\u8f03\u8868","text":"<p>\u30ea\u30bd\u30fc\u30b9\u304c\u9650\u3089\u308c\u3066\u3044\u308b\u4e2d\u3067\u3001\u3053\u308c\u3089 2 \u3064\u306e\u30c7\u30fc\u30bf \u30d1\u30e9\u30c0\u30a4\u30e0\u3092\u3069\u306e\u3088\u3046\u306b\u6bd4\u8f03\u691c\u8a0e\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u304b?\u3053\u308c\u306f\u5358\u7d14\u306a\u4e8c\u8005\u629e\u4e00\u3067\u306f\u306a\u304f\u3001\u30e2\u30c7\u30eb \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b3\u30b9\u30c8\u3001\u6700\u7d42\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u30b7\u30ca\u30ea\u30aa\u9593\u306e\u6df1\u3044\u30c8\u30ec\u30fc\u30c9\u30aa\u30d5\u304c\u95a2\u4fc2\u3057\u307e\u3059\u3002</p> <p>\u521d\u671f\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u7814\u7a76 (2021 \u5e74\u4ee5\u524d) \u3067\u306f\u3001\u30c7\u30fc\u30bf\u91cf\u304c\u5341\u5206\u3067\u3042\u308b\u9650\u308a (CLIP \u306e\u5834\u5408\u306f 400M \u30da\u30a2\u306a\u3069)\u3001\u30e2\u30c7\u30eb\u306f\u3059\u3079\u3066\u3092\u5b66\u7fd2\u3067\u304d\u308b\u3068\u696d\u754c\u306f\u5e83\u304f\u4fe1\u3058\u3066\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001GPT-4V \u306e\u51fa\u73fe\u306b\u3088\u308a\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u306e\u307f\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u306f\u3001\u300c\u3053\u308c\u306f\u732b\u3067\u3042\u308b\u300d\u3092\u6b63\u78ba\u306b\u8b58\u5225\u3067\u304d\u308b\u3082\u306e\u306e\u3001\u8ad6\u7406\u7684\u306a\u63a8\u8ad6\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u6b20\u5982\u3057\u3066\u3044\u308b\u305f\u3081\u3001\u300c\u753b\u50cf\u5185\u306e\u3053\u306e\u732b\u304c\u4f55\u3092\u3059\u308b\u304b\u300d\u306b\u306f\u7b54\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u3053\u3068\u304c\u308f\u304b\u308a\u307e\u3057\u305f\u3002\u9006\u306b\u3001\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306f\u30ed\u30b8\u30c3\u30af\u304c\u8c4a\u5bcc\u3067\u3059\u304c\u3001\u30c7\u30fc\u30bf\u304c\u307e\u3070\u3089\u3067\u3001\u51e6\u7406\u30b3\u30b9\u30c8\u304c\u975e\u5e38\u306b\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>\u4ee5\u4e0b\u306e\u8868\u306f\u3001\u30a2\u30fc\u30ad\u30c6\u30af\u30c8\u304c\u5b9f\u969b\u306e\u30cb\u30fc\u30ba\u306b\u57fa\u3065\u3044\u3066\u6280\u8853\u7684\u306a\u9078\u629e\u3092\u884c\u3048\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u3066\u3001\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5\u30ec\u30d9\u30eb\u3067\u306e 2 \u3064\u306e\u30d1\u30e9\u30c0\u30a4\u30e0\u9593\u306e\u4e3b\u306a\u9055\u3044\u3092\u6bd4\u8f03\u3057\u3066\u3044\u307e\u3059\u3002</p> \u5bf8\u6cd5 \u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2 (LAION \u30b9\u30bf\u30a4\u30eb) \u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u30c9\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (OBELICS \u30b9\u30bf\u30a4\u30eb) \u5fb9\u5e95\u3057\u305f\u5206\u6790\u3068\u63a8\u5968\u4e8b\u9805 \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u76ee\u7684 \u5bfe\u7167\u5b66\u7fd2 (CLIP)\u3001\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u753b\u50cf\u3078 (\u5b89\u5b9a\u62e1\u6563) \u6b21\u306e\u30c8\u30fc\u30af\u30f3\u306e\u4e88\u6e2c\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u30c0\u30a4\u30a2\u30ed\u30b0 (GPT-4V) \u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u6226\u7565\u306f\u738b\u69d8\u3067\u3059\u3002\u7814\u7a76\u306b\u3088\u308b\u3068\u3001\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u307f\u3092\u4f7f\u7528\u3057\u3066\u30d3\u30b8\u30e5\u30a2\u30eb \u30a8\u30f3\u30b3\u30fc\u30c0\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u306e\u306f\u975e\u52b9\u7387\u7684 (\u753b\u50cf\u306e\u5bc6\u5ea6\u304c\u5341\u5206\u3067\u306a\u3044) \u304c\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u306e\u307f\u3092\u4f7f\u7528\u3059\u308b\u3068\u63a8\u8ad6\u6a5f\u80fd\u304c\u4e0d\u8db3\u3059\u308b\u3053\u3068\u304c\u308f\u304b\u3063\u3066\u3044\u307e\u3059\u3002\u30ab\u30ea\u30ad\u30e5\u30e9\u30e0\u5b66\u7fd2\u6226\u7565\u3092\u63a8\u5968\u3057\u307e\u3059\u3002 \u30c7\u30fc\u30bf \u30bd\u30fc\u30b9\u306e\u89e3\u6790 \u30b7\u30f3\u30d7\u30eb: <code>&lt;img&gt;</code> \u30bf\u30b0\u3068\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u62bd\u51fa\u3059\u308b\u3060\u3051\u3067\u3059\u3002\u8907\u96d1: DOM \u30c4\u30ea\u30fc\u3092\u89e3\u6790\u3057\u3001\u5e83\u544a\u3068\u30b5\u30a4\u200b\u200b\u30c9\u30d0\u30fc\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u3001\u30e1\u30a4\u30f3 \u30b3\u30f3\u30c6\u30f3\u30c4 \u30ed\u30b8\u30c3\u30af\u3092\u4fdd\u6301\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u8907\u96d1\u3055\u306b\u95a2\u3059\u308b\u8b66\u544a\u3002\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u306b\u306f\u3001\u975e\u5e38\u306b\u8907\u96d1\u306a HTML \u30ec\u30f3\u30c0\u30ea\u30f3\u30b0 \u30ed\u30b8\u30c3\u30af\u3092\u51e6\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u6700\u521d\u306f Common Crawl WET \u30d5\u30a1\u30a4\u30eb\u3092\u4f7f\u7528\u3059\u308b\u304b\u3001\u62e1\u5f35\u306e\u305f\u3081\u306b OBELICS \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30bb\u30c3\u30c8\u3092\u76f4\u63a5\u4f7f\u7528\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5168\u4f53\u3092\u6700\u521d\u304b\u3089\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3057\u3088\u3046\u3068\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002 \u4fdd\u7ba1\u30b3\u30b9\u30c8 \u4e2d: \u30e1\u30bf\u30c7\u30fc\u30bf\u306f CSV/Parquet \u306e\u307f\u3067\u3001\u753b\u50cf\u306f\u500b\u5225\u306b\u4fdd\u5b58\u3055\u308c\u307e\u3059\u3002\u9ad8: \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u30c8\u30dd\u30ed\u30b8\u3092\u4fdd\u5b58\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001WebDataset \u307e\u305f\u306f TFRecord \u306e\u30ab\u30d7\u30bb\u30eb\u5316\u3092\u63a8\u5968\u3057\u307e\u3059\u3002 I/O \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3002\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5834\u5408\u306f\u3001\u5c0f\u3055\u306a\u30d5\u30a1\u30a4\u30eb\u306e\u65ad\u7247\u5316\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u30b7\u30e3\u30fc\u30c9 \u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u8aad\u307f\u53d6\u308a\u306b\u306f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u5168\u4f53\u3092\u4e8b\u524d\u306b\u30ed\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u30e1\u30e2\u30ea\u5e2f\u57df\u5e45\u306e\u8981\u6c42\u304c\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002 \u6e05\u6383\u306e\u8ab2\u984c \u30b7\u30f3\u30b0\u30eb\u30dd\u30a4\u30f3\u30c8\u30af\u30ea\u30fc\u30cb\u30f3\u30b0: \u5404\u753b\u50cf\u306f\u72ec\u7acb\u3057\u3066\u5224\u65ad\u3055\u308c\u3001\u4e26\u5217\u5316\u304c\u5bb9\u6613 \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0: \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30ed\u30b8\u30c3\u30af\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u4e00\u8cab\u6027\u3068\u753b\u50cf\u306e\u54c1\u8cea\u3092\u540c\u6642\u306b\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 \u6226\u7565\u306e\u9078\u629e\u3002\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u51e6\u7406\u3059\u308b\u3068\u304d\u306b\u3001\u753b\u50cf\u304c NSFW \u3068\u5224\u65ad\u3055\u308c\u305f\u5834\u5408\u306f\u3001\u4f4d\u7f6eEmbedding\u306e\u7cbe\u5ea6\u3092\u7dad\u6301\u3059\u308b\u305f\u3081\u306b\u3001\u524a\u9664\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u7279\u5225\u306a <code>&lt;BLOCKED_IMAGE&gt;</code> \u30c8\u30fc\u30af\u30f3\u306b\u7f6e\u304d\u63db\u3048\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 \u30e2\u30c7\u30eb\u306e\u30e1\u30ea\u30c3\u30c8 \u5f37\u529b\u306a\u8996\u899a\u7684\u610f\u5473\u8ad6\u7684\u6574\u5408\u3001\u5f37\u529b\u306a\u30bc\u30ed\u30b7\u30e7\u30c3\u30c8\u5206\u985e \u5f37\u529b\u306a\u5c11\u6570\u30b7\u30e7\u30c3\u30c8\u5b66\u7fd2\u3001\u8907\u6570\u30bf\u30fc\u30f3\u306e\u5bfe\u8a71\u3068\u8ad6\u7406\u7684\u63a8\u8ad6\u3092\u30b5\u30dd\u30fc\u30c8 \u30d3\u30b8\u30cd\u30b9\u6307\u5411\u3002\u30b7\u30ca\u30ea\u30aa\u304c\u300c\u753b\u50cf\u691c\u7d22\u300d\u306e\u5834\u5408\u306f\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u3067\u5341\u5206\u3067\u3059\u3002\u8907\u96d1\u306a\u6587\u66f8\u306e\u7406\u89e3 (\u7814\u7a76\u30ec\u30dd\u30fc\u30c8\u306e\u5206\u6790\u3001\u9577\u7de8\u30b9\u30c8\u30fc\u30ea\u30fc\u306e\u751f\u6210\u306a\u3069) \u304c\u542b\u307e\u308c\u308b\u5834\u5408\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u6587\u66f8\u3092\u5c0e\u5165\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 <p>\u30d2\u30f3\u30c8: MM1 \u3084 Idefics2 \u306e\u3088\u3046\u306a\u6700\u5148\u7aef\u306e\u7814\u7a76\u3067\u306f\u3001\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306f\u4e8c\u8005\u629e\u4e00\u3067\u306f\u306a\u304f\u3001\u6bd4\u4f8b\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u901a\u5e38\u306f\u300120% \u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u6df7\u5408\u3057\u306a\u304c\u3089\u3001\u5f37\u56fa\u306a\u8996\u899a\u8a00\u8a9e\u30de\u30c3\u30d4\u30f3\u30b0\u57fa\u76e4\u3092\u78ba\u7acb\u3059\u308b\u305f\u3081\u306b\u3001\u521d\u671f\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6bb5\u968e\u3067 80% \u306e\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u30da\u30a2\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002\u5f8c\u671f\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d5\u30a7\u30fc\u30ba (\u30a2\u30cb\u30fc\u30ea\u30f3\u30b0 \u30d5\u30a7\u30fc\u30ba) \u3067\u306f\u3001\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5272\u5408\u3092\u5927\u5e45\u306b\u5897\u3084\u3057\u3066\u3001\u30e2\u30c7\u30eb\u306e\u30ed\u30f3\u30b0\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u63a8\u8ad6\u80fd\u529b\u3092\u523a\u6fc0\u3057\u307e\u3059\u3002\u3053\u306e\u300c\u57fa\u76e4\u304c\u5148\u3001\u30ed\u30b8\u30c3\u30af\u306f\u5f8c\u300d\u6226\u7565\u306b\u3088\u308a\u3001\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u4f7f\u7528\u7387\u304c\u6700\u5927\u5316\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_1_image_text_pairs/#62","title":"6.2 \u753b\u50cf\u306e\u53d6\u5f97\u3068\u524d\u51e6\u7406","text":"<p>\u30c7\u30fc\u30bf \u30de\u30cb\u30d5\u30a7\u30b9\u30c8\u304c\u6c7a\u5b9a\u3057\u305f\u3089\u3001\u6b21\u306e\u30b9\u30c6\u30c3\u30d7\u306f\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u304a\u3088\u3073\u524d\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u306f\u5178\u578b\u7684\u306a I/O \u96c6\u4e2d\u578b\u306e\u30bf\u30b9\u30af\u3067\u3042\u308a\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u5e2f\u57df\u5e45\u3001DNS \u89e3\u6c7a\u306e\u9045\u5ef6\u3001\u5927\u91cf\u306e\u5c0f\u3055\u306a\u30d5\u30a1\u30a4\u30eb\u306e\u30c7\u30a3\u30b9\u30af\u66f8\u304d\u8fbc\u307f\u304c\u4e3b\u306a\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3068\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_1_image_text_pairs/#621-img2dataset","title":"6.2.1 img2dataset \u306e\u9ad8\u540c\u6642\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u306e\u5b9f\u969b","text":"<p><code>img2dataset</code> \u306f\u73fe\u5728\u3001\u30b3\u30df\u30e5\u30cb\u30c6\u30a3\u3067\u8a8d\u3081\u3089\u308c\u305f\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9 \u30c4\u30fc\u30eb\u3067\u3059\u3002\u3053\u308c\u306f\u5358\u306a\u308b\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9 \u30b9\u30af\u30ea\u30d7\u30c8\u3067\u306f\u306a\u304f\u3001MapReduce \u306e\u539f\u5247\u306b\u57fa\u3065\u3044\u305f\u5206\u6563\u30c7\u30fc\u30bf\u51e6\u7406\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u3059\u3002</p> <p>\u5358\u7d14\u306a <code>requests.get</code> \u30eb\u30fc\u30d7\u3092\u4f5c\u6210\u3059\u308b\u4ee3\u308f\u308a\u306b\u3001\u7279\u6b8a\u306a\u30c4\u30fc\u30eb\u304c\u5fc5\u8981\u306a\u306e\u306f\u306a\u305c\u3067\u3059\u304b?\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u74b0\u5883\u304c\u975e\u5e38\u306b\u53b3\u3057\u3044\u305f\u3081\u3002\u30ea\u30f3\u30af\u306e\u671f\u9650\u5207\u308c (\u30ea\u30f3\u30af\u306e\u7834\u640d)\u3001\u30b5\u30fc\u30d0\u30fc\u306e\u30ec\u30fc\u30c8\u5236\u9650\u3001DNS \u306e\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3002\u6570\u5341\u5104\u306e URL \u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3001\u308f\u305a\u304b\u306a\u30ed\u30f3\u30b0\u30c6\u30fc\u30eb\u306e\u9045\u5ef6\u304c\u6570\u9031\u9593\u306e\u6642\u9593\u30b3\u30b9\u30c8\u306b\u5897\u5e45\u3055\u308c\u307e\u3059\u3002</p> <p>\u4e2d\u5fc3\u539f\u5247: 1. \u30b7\u30e3\u30fc\u30c7\u30a3\u30f3\u30b0: 10 \u5104\u306e URL \u3092\u6570\u4e07\u306e\u5c0f\u3055\u306a\u30bf\u30b9\u30af (\u30b7\u30e3\u30fc\u30c9) \u306b\u5206\u5272\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u5206\u6563\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u57fa\u790e\u3067\u3059\u3002 2. \u975e\u540c\u671f I/O: Python \u306e aiohttp \u307e\u305f\u306f Go \u30b3\u30eb\u30fc\u30c1\u30f3\u3092\u4f7f\u7528\u3057\u3066\u3001\u5358\u4e00\u30b3\u30a2\u4e0a\u3067\u6570\u767e\u306e\u30cd\u30c3\u30c8\u30ef\u30fc\u30af \u30ea\u30af\u30a8\u30b9\u30c8\u3092\u540c\u6642\u306b\u958b\u59cb\u3057\u3001\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u9045\u5ef6\u3092\u30de\u30b9\u30af\u3057\u307e\u3059\u3002 3. \u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0 \u30a2\u30fc\u30ab\u30a4\u30d6: \u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3055\u308c\u305f\u753b\u50cf\u306f\u30c7\u30a3\u30b9\u30af\u306b\u8a18\u9332\u3055\u308c\u307e\u305b\u3093\u3002\u3053\u308c\u3089\u306f\u30e1\u30e2\u30ea\u5185\u3067 tar \u30d1\u30c3\u30b1\u30fc\u30b8 (WebDataset \u5f62\u5f0f) \u306b\u76f4\u63a5\u30a2\u30bb\u30f3\u30d6\u30eb\u3055\u308c\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 \u30b9\u30c8\u30ec\u30fc\u30b8 (S3/HDFS) \u306b\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u30011 \u3064\u306e\u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u4f55\u767e\u4e07\u3082\u306e\u5c0f\u3055\u306a\u30d5\u30a1\u30a4\u30eb\u304c\u4f5c\u6210\u3055\u308c\u308b\u3053\u3068\u306b\u3088\u308b\u30d5\u30a1\u30a4\u30eb \u30b7\u30b9\u30c6\u30e0\u306e i \u30ce\u30fc\u30c9\u306e\u67af\u6e07\u306e\u554f\u984c (\u521d\u5fc3\u8005\u304c\u3088\u304f\u906d\u9047\u3059\u308b\u843d\u3068\u3057\u7a74) \u304c\u56de\u907f\u3055\u308c\u307e\u3059\u3002</p> <p>\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5: PySpark \u5206\u6563\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9 \u30b9\u30af\u30ea\u30d7\u30c8</p> <p>PB \u30b9\u30b1\u30fc\u30eb\u306e\u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3001\u5358\u4e00\u30de\u30b7\u30f3\u306e\u30de\u30eb\u30c1\u51e6\u7406\u30e2\u30fc\u30c9\u3067\u306f\u4e0d\u5341\u5206\u3067\u3059\u3002 Spark \u30af\u30e9\u30b9\u30bf\u30fc\u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <pre><code># Recommended environment: PySpark 3_2+, img2dataset 1_41+\n# Run command: spark-submit --master yarn --deploy-mode cluster...\n\nfrom img2dataset import download\nimport shutil\nimport os\n\ndef run_distributed_download():\n    \"\"\"\n    Configuration tuning is key to throughput.\n    process_count: Number of processes per Spark Executor.\n    thread_count: Number of async threads per process.\n    For 10Gbps NIC nodes, typically recommend total_concurrency around 1000.\n    \"\"\"\n\n    # Define output path (S3 or HDFS)\n    output_dir = \"s3a://multimodal-lake/raw-images/laion-5b-subset\"\n\n    # Clean old data (use with caution, production recommends versioning)\n    if os.path.exists(output_dir): \n        # shutil.rmtree(output_dir) # Dangerous operation, commented out\n        pass\n\n    download(\n        processes_count=4,          # 4 CPU cores per node\n        thread_count=64,            # 64 download threads per core\n        url_list=\"s3a://multimodal-lake/meta/laion-urls.parquet\",\n        image_size=256,             # 256x256 sufficient for pre-training, saves bandwidth\n        resize_only_if_bigger=True, # Avoid blur from upscaling small images\n        resize_mode=\"keep_ratio\",   # Maintain aspect ratio, black padding or center crop\n        skip_reencode=True,         # If original is JPG and size acceptable, store directly, saves CPU\n        output_folder=output_dir,\n        output_format=\"webdataset\", # Force WebDataset format\n        input_format=\"parquet\",\n        url_col=\"url\",\n        caption_col=\"caption\",\n        enable_wandb=True,          # Strongly recommended for monitoring download rate and error rate\n        number_sample_per_shard=10000, # 10k images per tar, ~200-300MB, for easy transfer\n        distributor=\"pyspark\",      # Use Spark for task distribution\n        save_additional_columns=[\"similarity\", \"hash\"], # Preserve original metadata\n        timeout=10                  # Shorter timeout for fast failure, long-tail requests not worth waiting\n    )\n\nif __name__ == \"__main__\":\n    # Initialize Spark Session (usually handled by spark-submit, but explicit for IDE debugging)\n    from pyspark.sql import SparkSession\n    spark = SparkSession.builder \\\n        .appName(\"Img2Dataset-Production\") \\\n        .config(\"spark.executor.memory\", \"8g\") \\\n        .config(\"spark.task.maxFailures\", \"10\") \\\n        .getOrCreate()\n\n    run_distributed_download()\n</code></pre> <p>\u30d7\u30ed\u306e\u30d2\u30f3\u30c8: * DNS \u30ad\u30e3\u30c3\u30b7\u30e5: \u540c\u6642\u5b9f\u884c\u6027\u304c\u9ad8\u3044\u5834\u5408\u3001DNS \u89e3\u6c7a\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u3063\u305f\u308a\u3001\u30d7\u30ed\u30d0\u30a4\u30c0\u30fc\u306b\u3088\u3063\u3066\u30d6\u30ed\u30c3\u30af\u3055\u308c\u305f\u308a\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30ed\u30fc\u30ab\u30eb DNS \u30ad\u30e3\u30c3\u30b7\u30e5 (\u4f8b: dnsmasq) \u3092\u30ef\u30fc\u30ab\u30fc \u30ce\u30fc\u30c9\u306b\u30c7\u30d7\u30ed\u30a4\u3059\u308b\u304b\u3001\u30b3\u30fc\u30c9\u3067\u30c9\u30e1\u30a4\u30f3\u304b\u3089 IP \u3078\u306e\u30de\u30c3\u30d4\u30f3\u30b0 \u30c6\u30fc\u30d6\u30eb\u3092\u7dad\u6301\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002 * \u30e6\u30fc\u30b6\u30fc \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u306e\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3: \u300c\u516c\u7136\u306e\u300d\u79d8\u5bc6\u3067\u306f\u3042\u308a\u307e\u3059\u304c\u3001\u30e6\u30fc\u30b6\u30fc \u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u30ed\u30fc\u30c6\u30fc\u30b7\u30e7\u30f3\u3059\u308b\u3068 403 Forbidden \u306e\u5272\u5408\u3092\u6e1b\u3089\u3059\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002 * \u30a8\u30e9\u30fc\u51e6\u7406: WandB \u30c0\u30c3\u30b7\u30e5\u30dc\u30fc\u30c9\u3067 success_rate \u3092\u76e3\u8996\u3057\u307e\u3059\u3002 80% \u3092\u4e0b\u56de\u308b\u5834\u5408\u306f\u3001\u901a\u5e38\u3001URL \u30ea\u30b9\u30c8\u304c\u8457\u3057\u304f\u53e4\u3044\u304b\u3001IP \u30d7\u30fc\u30eb\u304c\u6c5a\u67d3\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_1_image_text_pairs/#622","title":"6.2.2 \u8996\u899a\u7684\u306a\u524d\u51e6\u7406\u306e\u843d\u3068\u3057\u7a74: \u30c8\u30ea\u30df\u30f3\u30b0\u3068\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8","text":"<p>\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u306e\u53d6\u5f97 (\u30d0\u30a4\u30c8\u306e\u53d6\u5f97) \u3068\u3044\u3046\u8ab2\u984c\u3092\u89e3\u6c7a\u3057\u305f\u5f8c\u3001\u3059\u3050\u306b 2 \u756a\u76ee\u306e\u8ab2\u984c\u3001\u30c7\u30fc\u30bf\u306e\u4f7f\u3044\u3084\u3059\u3055\u306b\u76f4\u9762\u3057\u307e\u3059\u3002\u751f\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u753b\u50cf\u306e\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u306f\u5927\u304d\u304f\u7570\u306a\u308a\u307e\u3059\u304c\u3001\u30e2\u30c7\u30eb\u3067\u306f\u901a\u5e38\u3001\u56fa\u5b9a\u89e3\u50cf\u5ea6\u306e\u5165\u529b (\u4f8b: 224x224 \u307e\u305f\u306f 512x512) \u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u521d\u5fc3\u8005\u5411\u3051\u306e\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3\u306e\u591a\u304f\u306f\u3001\u30c7\u30a3\u30e1\u30f3\u30b7\u30e7\u30f3\u3092\u7d71\u4e00\u3059\u308b\u305f\u3081\u306b\u5358\u7d14\u306a\u7dcf\u5f53\u305f\u308a\u30e9\u30f3\u30c0\u30e0\u524d\u51e6\u7406\u3092\u7fd2\u6163\u7684\u306b\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u304c\u3001\u3053\u308c\u304c\u30e2\u30c7\u30eb\u306e\u300c\u76ee\u306b\u898b\u3048\u306a\u3044\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u4e0a\u9650\u300d\u306e\u6839\u672c\u3067\u3042\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002 \u300c\u30a4\u30e1\u30fc\u30b8\u3092\u306f\u3081\u8fbc\u3080\u300d\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u300c\u4f55\u304c\u8fbc\u3081\u3089\u308c\u3066\u3044\u308b\u306e\u304b\u300d\u306b\u3082\u6ce8\u529b\u3057\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002</p> <p> \u56f3 6-1: \u753b\u50cf\u306e\u524d\u51e6\u7406\u306b\u304a\u3051\u308b\u30c8\u30ea\u30df\u30f3\u30b0\u3068\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8</p> <ul> <li> <p>\u60aa\u3044\u30b1\u30fc\u30b9 (\u5de6\u306e\u753b\u50cf - \u5358\u7d14\u306a\u30c8\u30ea\u30df\u30f3\u30b0\u306e\u30b3\u30b9\u30c8):     \u5f93\u6765\u306e <code>RandomCrop</code> \u307e\u305f\u306f <code>CenterCrop</code> \u306f\u69cb\u6210\u3092\u610f\u8b58\u3057\u307e\u305b\u3093\u3002\u7e26\u65b9\u5411\u306e\u69cb\u56f3\u3067\u30dd\u30fc\u30c8\u30ec\u30fc\u30c8\u5199\u771f\u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3001\u4e2d\u592e\u306e\u30c8\u30ea\u30df\u30f3\u30b0\u306b\u3088\u308a\u91cd\u8981\u306a\u90e8\u5206 (\u982d\u306a\u3069) \u304c\u7c21\u5358\u306b\u5207\u308a\u53d6\u3089\u308c\u3001\u80f4\u4f53\u3060\u3051\u304c\u6b8b\u308a\u307e\u3059\u3002\u3053\u306e\u6642\u70b9\u3067\u3001\u30c6\u30ad\u30b9\u30c8 \u30e9\u30d9\u30eb\u304c\u307e\u3060\u300c\u7b11\u9854\u306e\u4eba\u300d\u3067\u3042\u308b\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306f\u9593\u9055\u3063\u305f\u30de\u30c3\u30d4\u30f3\u30b0 (\u80f4\u4f53\u306e\u7279\u5fb4\u3092\u300c\u7b11\u9854\u306e\u4eba\u300d\u3068\u8aa4\u8a8d) \u3092\u78ba\u7acb\u3059\u308b\u3053\u3068\u3092\u5f37\u5236\u3055\u308c\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u304c\u91cd\u5ea6\u306e\u5e7b\u899a\u3092\u5f15\u304d\u8d77\u3053\u3059\u539f\u56e0\u306b\u306a\u308a\u307e\u3059\u3002</p> </li> <li> <p>\u826f\u3044\u30b1\u30fc\u30b9 (\u53f3\u306e\u753b\u50cf - \u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u306a\u5b8c\u5168\u6027):     \u300c\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u4e00\u8cab\u6027\u300d\u3092\u8ffd\u6c42\u3057\u305f\u9ad8\u54c1\u8cea\u306a\u30c7\u30fc\u30bf\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3002</p> <ol> <li>\u30b9\u30de\u30fc\u30c8 \u30b5\u30a4\u30ba\u5909\u66f4: \u5b8c\u5168\u306a\u8996\u899a\u7684\u4e3b\u984c\u3092\u7dad\u6301\u3059\u308b\u306b\u306f\u3001<code>Resize with Padding</code> (\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u3001\u9ed2/\u767d\u306e\u30d1\u30c7\u30a3\u30f3\u30b0\u3092\u7dad\u6301) \u3092\u512a\u5148\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u7121\u52b9\u306a\u30d4\u30af\u30bb\u30eb\u304c\u767a\u751f\u3057\u307e\u3059\u304c\u3001\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u306a\u5b8c\u5168\u6027\u304c\u4fdd\u8a3c\u3055\u308c\u307e\u3059\u3002</li> <li>\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u30d0\u30b1\u30c3\u30c8: SDXL \u3068 Midjourney \u3067\u4e00\u822c\u7684\u306b\u4f7f\u7528\u3055\u308c\u308b\u9ad8\u5ea6\u306a\u6280\u8853\u3002\u540c\u69d8\u306e\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u3092\u6301\u3064\u753b\u50cf\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u7528\u306b\u540c\u3058\u30d0\u30c3\u30c1\u306b\u30b0\u30eb\u30fc\u30d7\u5316\u3057\u3001\u30d1\u30c7\u30a3\u30f3\u30b0\u306e\u7121\u99c4\u3092\u6e1b\u3089\u3057\u306a\u304c\u3089\u30c8\u30ea\u30df\u30f3\u30b0\u3092\u56de\u907f\u3057\u307e\u3059\u3002</li> <li>\u8981\u7d04: \u4ee5\u4e0b\u306e\u7b2c 7 \u7ae0\u3067\u8a73\u3057\u304f\u8aac\u660e\u3055\u308c\u3066\u3044\u308b\u3088\u3046\u306b\u3001VLM \u3092\u4f7f\u7528\u3057\u3066\u9ad8\u5bc6\u5ea6\u306e\u8aac\u660e\u3092\u751f\u6210\u3059\u308b\u3068\u3001\u30c6\u30ad\u30b9\u30c8\u304c\u753b\u9762\u4e0a\u306e\u8a73\u7d30 (\u6a19\u8b58\u30c6\u30ad\u30b9\u30c8\u3001\u80cc\u666f\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306a\u3069) \u306b\u6b63\u78ba\u306b\u5bfe\u5fdc\u3057\u3001\u30c7\u30fc\u30bf \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u4fa1\u5024\u304c\u6700\u5927\u5316\u3055\u308c\u307e\u3059\u3002</li> </ol> </li> </ul>"},{"location":"ja/part3/3_1_image_text_pairs/#623-gpu-nvidia-dali","title":"6.2.3 GPU \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3\u306b\u3088\u308b\u30c7\u30b3\u30fc\u30c9\u3068\u5909\u63db (NVIDIA DALI)","text":"<p>\u30c7\u30a3\u30fc\u30d7 \u30e9\u30fc\u30cb\u30f3\u30b0 \u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d5\u30a7\u30fc\u30ba\u3067\u306f\u3001\u307b\u3068\u3093\u3069\u306e\u7814\u7a76\u8005\u3084\u958b\u767a\u8005\u304c\u30e2\u30c7\u30eb \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u8a2d\u8a08\u3001\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u8abf\u6574\u3001\u640d\u5931\u95a2\u6570\u306e\u6539\u5584 (\u30e2\u30c7\u30eb\u306e\u7cbe\u5ea6\u306b\u76f4\u63a5\u5f71\u97ff\u3059\u308b\u30e2\u30b8\u30e5\u30fc\u30eb) \u306b\u6ce8\u76ee\u3057\u307e\u3059\u304c\u3001\u30c7\u30fc\u30bf \u30ed\u30fc\u30c9 (DataLoader) \u306e\u57fa\u790e\u3092\u898b\u843d\u3068\u3057\u304c\u3061\u3067\u3059\u3002\u5b9f\u969b\u306b\u306f\u3001\u3053\u308c\u304c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u52b9\u7387\u3092\u5236\u9650\u3059\u308b\u300c\u76ee\u306b\u898b\u3048\u306a\u3044\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30ad\u30e9\u30fc\u300d\u3068\u306a\u308b\u3053\u3068\u304c\u591a\u304f\u3001\u30cf\u30a4\u30a8\u30f3\u30c9 GPU \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u5b8c\u5168\u306a\u5229\u7528\u3092\u59a8\u3052\u3001\u6df1\u523b\u306a\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306e\u7121\u99c4\u3092\u5f15\u304d\u8d77\u3053\u3059\u3053\u3068\u3055\u3048\u3042\u308a\u307e\u3059\u3002</p> <p>\u3053\u306e\u554f\u984c\u70b9\u3092\u7406\u89e3\u3059\u308b\u306b\u306f\u3001\u307e\u305a\u6df1\u5c64\u5b66\u7fd2\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d5\u30ed\u30fc\u306e\u5b8c\u5168\u306a\u30ed\u30b8\u30c3\u30af\u3092\u660e\u78ba\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30e2\u30c7\u30eb \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u30b3\u30a2 \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306f\u3001GPU \u306e\u5927\u898f\u6a21\u306a\u4e26\u5217\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u6a5f\u80fd\u306b\u4f9d\u5b58\u3057\u3066\u3044\u307e\u3059\u3002 GPU \u306f\u5927\u898f\u6a21\u306a\u30c6\u30f3\u30bd\u30eb\u6f14\u7b97\u3092\u52b9\u7387\u7684\u306b\u51e6\u7406\u3057\u3001\u30d0\u30c3\u30af\u30d7\u30ed\u30d1\u30b2\u30fc\u30b7\u30e7\u30f3\u3068\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u66f4\u65b0\u3092\u5b8c\u4e86\u3067\u304d\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u30c7\u30fc\u30bf\u304c GPU \u306b\u5165\u529b\u3055\u308c\u308b\u524d\u306b\u3001\u4e00\u9023\u306e\u524d\u51e6\u7406\u64cd\u4f5c\u3092\u901a\u904e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u4e2d\u3067\u6700\u3082\u57fa\u672c\u7684\u3067\u6642\u9593\u306e\u304b\u304b\u308b\u64cd\u4f5c\u306f\u3001\u753b\u50cf\u306e\u30c7\u30b3\u30fc\u30c9\u3068\u30b5\u30a4\u30ba\u5909\u66f4\u3067\u3059\u3002\u5f93\u6765\u306e PyTorch \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d5\u30ed\u30fc\u3067\u306f\u3001\u3053\u308c\u3089\u306e\u91cd\u8981\u306a\u524d\u51e6\u7406\u64cd\u4f5c\u306f\u3059\u3079\u3066 CPU \u4e0a\u3067\u5b9f\u884c\u3055\u308c\u3001\u300cCPU \u524d\u51e6\u7406\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u300d\u3068\u300cGPU \u8a08\u7b97\u306e\u5197\u9577\u6027\u300d\u306e\u9593\u306b\u77db\u76fe\u304c\u751f\u3058\u307e\u3059\u3002</p> <p>\u5177\u4f53\u7684\u306b\u306f\u3001\u5f93\u6765\u306e PyTorch Dataset \u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u306f\u6b21\u306e\u3068\u304a\u308a\u3067\u3059\u3002\u307e\u305a\u3001CPU \u3092\u4ecb\u3057\u3066\u30c7\u30a3\u30b9\u30af\u304b\u3089\u753b\u50cf\u30d5\u30a1\u30a4\u30eb (\u4e3b\u306b JPEG) \u3092\u8aad\u307f\u53d6\u308a\u3001\u6b21\u306b CPU \u304c JPEG \u30c7\u30b3\u30fc\u30c9\u3092\u5b8c\u4e86\u3057\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u306f\u3001\u5727\u7e2e\u753b\u50cf\u30d0\u30a4\u30ca\u30ea \u30c7\u30fc\u30bf\u306b\u5bfe\u3059\u308b\u30cf\u30d5\u30de\u30f3 \u30c7\u30b3\u30fc\u30c9\u3001\u9006\u96e2\u6563\u30b3\u30b5\u30a4\u30f3\u5909\u63db (IDCT) \u304a\u3088\u3073\u305d\u306e\u4ed6\u306e\u8907\u96d1\u306a\u8a08\u7b97\u304c\u5fc5\u8981\u3067\u3042\u308a\u3001\u4e00\u822c\u7684\u306a CPU \u8ca0\u8377\u306e\u9ad8\u3044\u30bf\u30b9\u30af\u3067\u3059\u3002\u30c7\u30b3\u30fc\u30c9\u5f8c\u3001CPU \u306f\u30b5\u30a4\u30ba\u5909\u66f4\u3001\u6b63\u898f\u5316\u3001\u8272\u7a7a\u9593\u5909\u63db\u306a\u3069\u306e\u524d\u51e6\u7406\u3092\u5b9f\u884c\u3057\u3001\u6700\u7d42\u7684\u306b\u51e6\u7406\u3055\u308c\u305f\u753b\u50cf\u30c6\u30f3\u30bd\u30eb\u3092\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u305f\u3081\u306b GPU \u306b\u30b3\u30d4\u30fc\u3057\u307e\u3059\u3002</p> <p>\u3055\u3089\u306b\u91cd\u8981\u306a\u306e\u306f\u3001CPU \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u304c\u30b7\u30ea\u30a2\u30eb\u8a08\u7b97\u3068\u30ed\u30b8\u30c3\u30af\u5236\u5fa1\u306b\u3088\u308a\u9069\u3057\u3066\u3044\u308b\u3053\u3068\u3067\u3059\u3002\u4e26\u5217\u8a08\u7b97\u80fd\u529b\u306f GPU \u3088\u308a\u3082\u306f\u308b\u304b\u306b\u52a3\u308a\u307e\u3059\u3002\u305d\u308c\u3067\u3082\u3001\u30c7\u30b3\u30fc\u30c9\u3084\u30b5\u30a4\u30ba\u5909\u66f4\u306a\u3069\u306e\u753b\u50cf\u524d\u51e6\u7406\u64cd\u4f5c\u306f\u672c\u8cea\u7684\u306b\u9ad8\u5ea6\u306b\u4e26\u5217\u5316\u53ef\u80fd\u3067\u3042\u308a\u3001\u30de\u30eb\u30c1\u30b9\u30ec\u30c3\u30c9\u307e\u305f\u306f\u30de\u30eb\u30c1\u30b3\u30a2\u4e26\u5217\u51e6\u7406\u306b\u3088\u3063\u3066\u52b9\u7387\u3092\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u5f93\u6765\u306e PyTorch \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u3001CPU \u4e26\u5217\u51e6\u7406\u3092\u5411\u4e0a\u3055\u305b\u308b DataLoader \u306e num_workers \u3092\u4f7f\u7528\u3057\u305f\u3068\u3057\u3066\u3082\u3001CPU \u81ea\u4f53\u306e\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306e\u4e0a\u9650\u3092\u7a81\u7834\u3059\u308b\u3053\u3068\u306f\u307b\u3068\u3093\u3069\u3067\u304d\u307e\u305b\u3093\u3002\u7279\u306b\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u304c\u5927\u898f\u6a21 (\u6570\u767e\u4e07\u306e\u753b\u50cf) \u3067\u3001\u5358\u4e00\u753b\u50cf\u306e\u89e3\u50cf\u5ea6\u304c\u9ad8\u3044 (1080p+) \u5834\u5408\u3001CPU \u306e\u524d\u51e6\u7406\u901f\u5ea6\u304c GPU \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u901f\u5ea6\u306b\u5927\u5e45\u306b\u9045\u308c\u3001GPU \u304c\u983b\u7e41\u306b\u300c\u30c7\u30fc\u30bf\u5f85\u3061\u300d\u3067\u30a2\u30a4\u30c9\u30eb\u72b6\u614b\u306b\u306a\u308a\u3001GPU \u4f7f\u7528\u7387\u304c\u5927\u5e45\u306b\u4f4e\u4e0b\u3057\u3001\u6700\u7d42\u7684\u306b\u5168\u4f53\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u52b9\u7387\u304c\u4f4e\u4e0b\u3057\u307e\u3059\u3002\u3053\u308c\u304c\u3001\u30c7\u30fc\u30bf\u306e\u8aad\u307f\u8fbc\u307f\u304c\u300c\u7121\u8996\u3055\u308c\u305f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u30ad\u30e9\u30fc\u300d\u3068\u547c\u3070\u308c\u308b\u7406\u7531\u3067\u3059\u3002</p> <p>\u3053\u306e\u4e2d\u5fc3\u7684\u306a\u554f\u984c\u70b9\u306b\u5bfe\u51e6\u3059\u308b\u305f\u3081\u306b\u3001NVIDIA \u306f\u3001\u30c7\u30a3\u30fc\u30d7 \u30e9\u30fc\u30cb\u30f3\u30b0 \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u7528\u306b\u6700\u9069\u5316\u3055\u308c\u305f GPU \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3\u306e\u30c7\u30fc\u30bf\u524d\u51e6\u7406\u30e9\u30a4\u30d6\u30e9\u30ea\u3067\u3042\u308b DALI (Data Loading Library) \u3092\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\u305d\u306e\u4e2d\u5fc3\u7684\u306a\u76ee\u6a19\u306f\u3001\u753b\u50cf\u306e\u30c7\u30b3\u30fc\u30c9\u3084\u30b5\u30a4\u30ba\u5909\u66f4\u306a\u3069\u306e CPU \u3092\u96c6\u4e2d\u7684\u306b\u4f7f\u7528\u3059\u308b\u64cd\u4f5c\u3092 GPU \u306b\u79fb\u884c\u3057\u3066\u4e26\u5217\u5b9f\u884c\u3057\u3001\u30c7\u30fc\u30bf\u8aad\u307f\u8fbc\u307f\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u89e3\u6d88\u3057\u3001GPU \u3092\u6700\u5927\u9650\u306b\u6d3b\u7528\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3067\u3059\u3002</p> <p> \u56f3 6-2: DALI \u3092\u4f7f\u7528\u3057\u305f\u5834\u5408\u3068\u4f7f\u7528\u3057\u306a\u3044\u5834\u5408\u306e\u30c7\u30fc\u30bf\u306e\u30c7\u30b3\u30fc\u30c9\u3068\u5909\u63db</p> <p>\u30b3\u30fc\u30c9\u306e\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb: \u9ad8\u6027\u80fd DALI \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</p> <pre><code>import nvidia.dali.fn as fn\nimport nvidia.dali.types as types\nfrom nvidia.dali.pipeline import pipeline_def\n\n\n@pipeline_def(batch_size=256, num_threads=8, device_id=0)\ndef webdataset_gpu_pipeline(shard_id, num_shards):\n    \"\"\"\n    Define end-to-end GPU data loading pipeline\n    Input: WebDataset (Tar) -&gt; Output: GPU Tensor\n    \"\"\"\n\n    # Step 1: Read WebDataset (CPU stage)\n    # Using index_paths is necessary, otherwise initialization requires traversing entire tar, extremely slow [5]\n    jpegs, captions = fn.readers.webdataset(\n        paths=[\"/data/shards/shard-{:05d}.tar\".format(i) for i in range(100)],\n        index_paths=[\"/data/indices/shard-{:05d}.idx\".format(i) for i in range(100)],\n        ext=[\"jpg\", \"txt\"],\n        shard_id=shard_id,\n        num_shards=num_shards,\n        random_shuffle=True,\n        initial_fill=10000,      # Shuffle buffer size, larger = more random but slower startup\n        pad_last_batch=True,     # Ensure all batches have consistent size\n        name=\"Reader\",\n        read_ahead=True          # Enable read-ahead\n    )\n\n    # Step 2: GPU Decoding (core acceleration point)\n    # device=\"mixed\" means input in Host memory, output in Device memory\n    # output_type=types.RGB handles color space conversion automatically\n    images = fn.decoders.image(\n        jpegs,\n        device=\"mixed\",\n        output_type=types.RGB,\n        # Error handling for corrupted images\n        # In production, never let a single bad image crash training\n    )\n\n    # Step 3: GPU transformation pipeline\n    # resize: maintain aspect ratio scaling\n    images = fn.resize(\n        images,\n        resize_x=224,\n        resize_y=224,\n        interp_type=types.INTERP_LINEAR\n    )\n\n    # crop_mirror_normalize: random crop + flip + normalize (fused operator)\n    # This step converts uint8 to float and subtracts mean, divides by std\n    images = fn.crop_mirror_normalize(\n        images,\n        dtype=types.FLOAT,\n        output_layout=\"CHW\",\n        crop=(224, 224),\n        mean=[0_485 * 255, 0_456 * 255, 0_406 * 255],\n        std=[0_229 * 255, 0_224 * 255, 0_225 * 255],\n        mirror=fn.random.coin_flip(probability=0_5)\n    )\n\n    # Text data typically processed directly on CPU or passed to Tokenizer\n    # Here we only return raw bytes for subsequent PyTorch processing\n    return images, captions\n\n# Use DALIGenericIterator integrated with PyTorch\nfrom nvidia.dali.plugin.pytorch import DALIGenericIterator\n\npipe = webdataset_gpu_pipeline(shard_id=0, num_shards=1)\npipe.build()\ndataloader = DALIGenericIterator(pipe, [\"images\", \"captions\"], reader_name=\"Reader\")\n\n# Benchmark test\n# On A100, this pipeline typically achieves 3000-5000 FPS, 5-10x CPU Loader\n</code></pre>"},{"location":"ja/part3/3_1_image_text_pairs/#63","title":"6.3 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u306a\u6d17\u6d44\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u306b\u306f\u5927\u91cf\u306e\u30ce\u30a4\u30ba\u304c\u4f34\u3044\u307e\u3059\u3002 LAION-5B \u306e\u751f\u30c7\u30fc\u30bf\u3067\u306f\u3001\u771f\u306b\u9ad8\u54c1\u8cea\u306e\u30b5\u30f3\u30d7\u30eb\u306f 10% \u672a\u6e80\u3067\u3042\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30c7\u30fc\u30bf\u306e\u591a\u69d8\u6027\u306e\u640d\u5931\u3092\u6700\u5c0f\u9650\u306b\u6291\u3048\u306a\u304c\u3089\u30c7\u30fc\u30bf\u5bc6\u5ea6\u3092\u5411\u4e0a\u3055\u305b\u308b\u306b\u306f\u3001\u591a\u6bb5\u968e\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d5\u30a1\u30cd\u30eb\u3092\u78ba\u7acb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3044\u308f\u3086\u308b\u300c\u30c7\u30fc\u30bf \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u300d\u306f\u672c\u8cea\u7684\u306b \u30c7\u30fc\u30bf \u30c0\u30a4\u30a8\u30c3\u30c8 \u3067\u3042\u308a\u3001\u30e2\u30c7\u30eb\u3078\u306e\u30d5\u30a3\u30fc\u30c9\u306e\u91cf\u3092\u6e1b\u3089\u3057\u3001\u3088\u308a\u826f\u304f\u3059\u308b\u3053\u3068\u3067\u3059\u3002</p>"},{"location":"ja/part3/3_1_image_text_pairs/#631","title":"6.3.1 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08: \u30ec\u30a4 \u30c7\u30fc\u30bf\u5206\u6563\u30af\u30ea\u30fc\u30cb\u30f3\u30b0","text":"<p>\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u30d5\u30a7\u30fc\u30ba\u306b\u30b9\u30d1\u30fc\u30af\u3067\u306f\u306a\u304f\u30ec\u30a4\u3092\u9078\u629e\u3059\u308b\u7406\u7531\u306f\u4f55\u3067\u3059\u304b?\u306a\u305c\u306a\u3089\u3001\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306b\u306f\u3082\u306f\u3084\u5358\u7d14\u306a ETL \u3067\u306f\u306a\u304f\u3001\u5927\u91cf\u306e \u6df1\u5c64\u5b66\u7fd2\u63a8\u8ad6 (\u30e2\u30c7\u30eb\u63a8\u8ad6) \u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u3089\u3067\u3059\u3002 Spark \u306e MapReduce \u30d1\u30e9\u30c0\u30a4\u30e0\u3068\u6bd4\u8f03\u3057\u3066\u3001Ray \u306f\u3088\u308a\u67d4\u8edf\u306a Actor \u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u63d0\u4f9b\u3057\u3001GPU \u30e2\u30c7\u30eb (CLIP\u3001Safety Checker \u306a\u3069) \u3092\u5e38\u99d0\u3055\u305b\u3001\u5c0f\u3055\u306a\u30d0\u30c3\u30c1\u3054\u3068\u306b\u8907\u6570 GB \u306e\u30e2\u30c7\u30eb\u3092\u30ea\u30ed\u30fc\u30c9\u3059\u308b\u3068\u3044\u3046\u81a8\u5927\u306a\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u3092\u56de\u907f\u3067\u304d\u307e\u3059\u3002</p> <p>Ray Data \u306f\u3001CPU \u96c6\u4e2d\u578b (\u89e3\u51cd\u3001\u30cf\u30c3\u30b7\u30e5\u3001\u6b63\u898f\u8868\u73fe) \u30bf\u30b9\u30af\u3068 GPU \u96c6\u4e2d\u578b (CLIP Embedding\u63a8\u8ad6) \u30bf\u30b9\u30af\u306e\u4e21\u65b9\u3092\u4f34\u3046\u3053\u306e\u6df7\u5408\u30ef\u30fc\u30af\u30ed\u30fc\u30c9\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u3001\u4e00\u822c\u7684\u306a 3 \u6bb5\u968e\u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u8a2d\u8a08\u3067\u3059\u3002 * \u30b9\u30c6\u30fc\u30b8 1 (CPU): \u9ad8\u901f\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3002\u89e3\u50cf\u5ea6\u304c\u4e0d\u5341\u5206 (&lt;256px)\u3001\u30c6\u30ad\u30b9\u30c8\u304c\u77ed\u3059\u304e\u308b\u3001\u82f1\u8a9e\u4ee5\u5916 (\u82f1\u8a9e\u30e2\u30c7\u30eb\u306e\u307f\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u3066\u3044\u308b\u5834\u5408)\u3001\u307e\u305f\u306f\u7570\u5e38\u306a\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u3092\u6301\u3064\u30b5\u30f3\u30d7\u30eb\u3092\u76f4\u63a5\u524a\u9664\u3057\u307e\u3059\u3002 * \u30b9\u30c6\u30fc\u30b8 2 (GPU): \u8a73\u7d30\u306a\u7279\u5fb4\u62bd\u51fa\u3002 CLIP \u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u30a8\u30f3\u30d9\u30c7\u30a3\u30f3\u30b0\u3092\u751f\u6210\u3057\u3001\u30a8\u30f3\u30d9\u30c7\u30a3\u30f3\u30b0\u306b\u57fa\u3065\u3044\u3066\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u985e\u4f3c\u6027\u3068\u7f8e\u7684\u30b9\u30b3\u30a2\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002 * \u30b9\u30c6\u30fc\u30b8 3 (CPU/\u6df7\u5408): \u30ed\u30b8\u30c3\u30af\u306e\u8a55\u4fa1\u3068\u91cd\u8907\u6392\u9664\u3002\u5b89\u5168\u6027 (NSFW)\u3001\u7f8e\u7684\u30b9\u30b3\u30a2\u3001\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u95a2\u9023\u6027\u306b\u57fa\u3065\u3044\u3066\u6700\u7d42\u3057\u304d\u3044\u5024\u30ab\u30c3\u30c8\u30aa\u30d5\u3092\u9069\u7528\u3057\u3001\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u306a\u91cd\u8907\u6392\u9664\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002</p> <p>\u30c7\u30fc\u30bf \u30d5\u30ed\u30fc\u56f3</p> <p> \u56f3 6-3: Ray \u30c7\u30fc\u30bf\u5206\u6563\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf \u30d5\u30ed\u30fc</p>"},{"location":"ja/part3/3_1_image_text_pairs/#632","title":"6.3.2 \u30b3\u30a2\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5b9f\u88c5","text":"<p>\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306f\u5358\u306a\u308b\u524a\u9664\u3067\u306f\u306a\u304f\u3001\u30c7\u30fc\u30bf\u5024\u306e\u91cf\u5b50\u5316\u3067\u3082\u3042\u308a\u307e\u3059\u3002\u753b\u50cf\u3068\u305d\u308c\u306b\u5bfe\u5fdc\u3059\u308b\u30c6\u30ad\u30b9\u30c8\u306e\u300c\u30b4\u30fc\u30eb\u30c9 \u30b3\u30f3\u30c6\u30f3\u30c4\u300d\u3092\u6e2c\u5b9a\u3059\u308b\u306b\u306f\u3001\u591a\u6b21\u5143\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <ol> <li> <p>\u7f8e\u7684\u30b9\u30b3\u30a2</p> <ul> <li>\u539f\u5247: \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u8acb\u6c42\u66f8\u3001\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3001\u4e0d\u9bae\u660e\u306a\u76e3\u8996\u6620\u50cf\u3067\u3044\u3063\u3071\u3044\u3067\u3059\u3002\u3053\u308c\u3089\u306f\u7f8e\u3057\u3044\u753b\u50cf\u3092\u751f\u6210\u3059\u308b\u306e\u306b\u306f\u5f79\u306b\u7acb\u3061\u307e\u305b\u3093\u3002\u901a\u5e38\u306f LAION-Aesthetics Predictor \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</li> <li>\u6280\u8853\u8a73\u7d30: CLIP \u753b\u50cfEmbedding\u3092\u5165\u529b\u3068\u3057\u3066\u4f7f\u7528\u3057\u30011 \uff5e 10 \u306e\u30b9\u30b3\u30a2\u3092\u51fa\u529b\u3059\u308b\u5358\u7d14\u306a MLP (\u591a\u5c64\u30d1\u30fc\u30bb\u30d7\u30c8\u30ed\u30f3)\u3002 AVA \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u304b\u3089\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf (\u30d7\u30ed\u306e\u5199\u771f\u5bb6\u306e\u4eba\u9593\u306b\u3088\u308b\u8a55\u4fa1)\u3002</li> <li>\u63a8\u5968\u3057\u304d\u3044\u5024: \u57fa\u672c\u7684\u306a\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u306f\u3001\u30b9\u30b3\u30a2 &gt; 4_5 \u3092\u7dad\u6301\u3057\u307e\u3059\u3002\u9ad8\u54c1\u8cea\u306e\u751f\u6210\u30e2\u30c7\u30eb (SFT \u30b9\u30c6\u30fc\u30b8) \u3092\u5fae\u8abf\u6574\u3059\u308b\u306b\u306f\u3001\u30b9\u30b3\u30a2 &gt; 6_0\u3001\u307e\u305f\u306f 6_5 \u3092\u63a8\u5968\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u914d\u7f6e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0</p> <ul> <li>\u539f\u5247: \u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306e\u591a\u304f\u306f\u3001\u753b\u50cf\u30b3\u30f3\u30c6\u30f3\u30c4\u3068\u306f\u95a2\u4fc2\u306e\u306a\u3044\u3001SEO \u306e\u30b4\u30df\u5358\u8a9e\u306e\u7a4d\u307f\u91cd\u306d\u3084\u30d5\u30a1\u30a4\u30eb\u540d (\u300cDSC_001.jpg\u300d) \u3067\u3059\u3002</li> <li>\u6280\u8853\u8a73\u7d30: CLIP \u753b\u50cfEmbedding\u3068\u30c6\u30ad\u30b9\u30c8Embedding\u306e\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6 (\u30c9\u30c3\u30c8\u7a4d) \u3092\u8a08\u7b97\u3057\u307e\u3059\u3002</li> <li>\u843d\u3068\u3057\u7a74: CLIP \u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u304c\u7570\u306a\u308b\u3068 (\u4f8b: OpenAI ViT-L/14 \u3068 OpenCLIP ViT-G/14)\u3001\u30a8\u30f3\u30d9\u30c7\u30a3\u30f3\u30b0 \u30b9\u30da\u30fc\u30b9\u306e\u5206\u5e03\u304c\u7570\u306a\u308a\u307e\u3059\u3002\u30b9\u30b3\u30a2\u306f\u76f4\u63a5\u6bd4\u8f03\u3067\u304d\u307e\u305b\u3093\u3002\u7279\u5b9a\u306e\u30e2\u30c7\u30eb\u306e\u3057\u304d\u3044\u5024\u3092\u518d\u8abf\u6574\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u30a2\u30d7\u30ed\u30fc\u30c1: \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u5168\u4f53\u306e\u985e\u4f3c\u5ea6\u5206\u5e03\u3092\u8a08\u7b97\u3057\u3001\u4e0a\u4f4d 50% \u307e\u305f\u306f\u4e0a\u4f4d 70% \u3092\u7dad\u6301\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u5b89\u5168\u6027\u306e\u691c\u51fa (\u5b89\u5168\u6027\u3068\u30a6\u30a9\u30fc\u30bf\u30fc\u30de\u30fc\u30af)</p> <ul> <li>\u539f\u5247: \u30dd\u30eb\u30ce\u3001\u66b4\u529b\u3001\u76ee\u7acb\u3064\u900f\u304b\u3057\u5165\u308a\u306e\u753b\u50cf\u306f\u524a\u9664\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> <li>\u6226\u7565: NSFW \u3068\u30a6\u30a9\u30fc\u30bf\u30fc\u30de\u30fc\u30af\u306e\u691c\u51fa\u306b\u306f\u3001\u7279\u5225\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u5206\u985e\u5b50\u30d8\u30c3\u30c9 (CLIP Embedding\u306b\u3082\u57fa\u3065\u304f) \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u30a6\u30a9\u30fc\u30bf\u30fc\u30de\u30fc\u30af\u691c\u51fa\u306e\u5834\u5408: \u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u751f\u6210\u30e2\u30c7\u30eb (SDXL \u306a\u3069) \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u751f\u6210\u30e2\u30c7\u30eb\u306f\u30a6\u30a9\u30fc\u30bf\u30fc\u30de\u30fc\u30af\u7279\u5fb4\u306b\u7c21\u5358\u306b\u30aa\u30fc\u30d0\u30fc\u30d5\u30a3\u30c3\u30c8\u3059\u308b\u305f\u3081\u3001\u975e\u5e38\u306b\u53b3\u5bc6 (\u30ea\u30b3\u30fc\u30eb\u512a\u5148) \u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30bf\u30fc\u30b2\u30c3\u30c8\u304c\u7406\u89e3\u30e2\u30c7\u30eb (GPT-4V \u306a\u3069) \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u7406\u89e3\u30e2\u30c7\u30eb\u306f\u300c\u753b\u50cf\u306b\u900f\u304b\u3057\u304c\u3042\u308b\u300d\u3053\u3068\u3092\u8a8d\u8b58\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u591a\u5c11\u7de9\u548c\u3067\u304d\u307e\u3059\u3002</li> </ul> </li> </ol> <p>\u30b3\u30fc\u30c9\u5b9f\u88c5: Ray Data Cleaning Operator</p> <pre><code>import ray\nimport torch\nimport open_clip\nimport numpy as np\nfrom PIL import Image\nimport io\n\n# Define Ray Actor class to ensure model loaded only once\nclass QualityScorer:\n    def __init__(self):\n        self.device = \"cuda\" if torch.cuda.is_available() else \"cpu\"\n        # Load CLIP model (ViT-B-32 fast, suitable for cleaning)\n        self.model, _, self.preprocess = open_clip.create_model_and_transforms(\n            'ViT-B-32', pretrained='laion2b_s34b_b79k', device=self.device\n        )\n        # Load aesthetic scoring head (Linear Layer)\n        self.aesthetic_head = torch.nn.Linear(512, 1).to(self.device)\n        self.aesthetic_head.load_state_dict(torch.load(\"sac+logos+ava1-l14-linearMSE.pth\"))\n        self.aesthetic_head.eval()\n\n    def __call__(self, batch: dict) -&gt; dict:\n        \"\"\"\n        Process a batch of data. Ray will automatically partition and transfer data to Actor.\n        \"\"\"\n        images = []\n        valid_indices = []\n\n        # Preprocess images (CPU operation)\n        for idx, img_bytes in enumerate(batch[\"jpg\"]):\n            try:\n                img = Image.open(io.BytesIO(img_bytes)).convert(\"RGB\")\n                img_tensor = self.preprocess(img)\n                images.append(img_tensor)\n                valid_indices.append(idx)\n            except Exception:\n                # Log bad image but don't interrupt\n                continue\n\n        if not images:\n            return {\"aesthetic_score\": [], \"clip_score\": []}\n\n        image_input = torch.stack(images).to(self.device)\n\n        with torch.no_grad():\n            # 1. Extract features\n            image_features = self.model.encode_image(image_input)\n            image_features /= image_features.norm(dim=-1, keepdim=True)\n\n            # 2. Compute aesthetic score\n            aesthetic_scores = self.aesthetic_head(image_features).squeeze().cpu().numpy()\n\n            # 3. Compute image-text match (assuming batch has text field)\n            # text_tokens = self.tokenizer(batch[\"txt\"]).to(self.device)\n            # text_features = self.model.encode_text(text_tokens)\n            #... compute cosine similarity\n\n        # Return results (must align with original batch indices)\n        return {\"aesthetic_score\": aesthetic_scores}\n\n# Orchestrate Ray pipeline\nray.init()\nds = ray.data.read_webdataset(\"s3://raw-bucket/{00000..00099}.tar\")\n\n# map_batches will automatically schedule GPU resources\n# num_gpus=0_25 means one GPU can run 4 Actors concurrently, improving throughput\nscored_ds = ds.map_batches(\n    QualityScorer, \n    compute=ray.data.ActorPoolStrategy(size=8), \n    num_gpus=0_25, \n    batch_size=128\n)\n\n# Final filtering\nfiltered_ds = scored_ds.filter(lambda row: row[\"aesthetic_score\"] &gt; 4_5)\nfiltered_ds.write_webdataset(\"s3://clean-bucket/\")\n</code></pre>"},{"location":"ja/part3/3_1_image_text_pairs/#64","title":"6.4 \u843d\u3068\u3057\u7a74\u3068\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":"<p>\u6570\u5341\u5104\u898f\u6a21\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u969b\u3001\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30c1\u30fc\u30e0\u306f\u8a73\u7d30\u3067\u3064\u307e\u305a\u304f\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001\u3044\u304f\u3064\u304b\u306e\u6559\u8a13\u3092\u5b66\u3073\u307e\u3057\u305f\u3002</p> <ul> <li> <p>\u5bc4\u6728\u7d30\u5de5\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u7206\u767a\u7684\u5897\u52a0:</p> <ul> <li>\u30a8\u30e9\u30fc: \u30d1\u30f3\u30c0\u3067 20 \u5104\u884c\u306e Parquet \u30d5\u30a1\u30a4\u30eb\u3092\u76f4\u63a5\u8aad\u307f\u53d6\u308b\u7fd2\u6163\u304c\u3042\u308a\u307e\u3059\u3002</li> <li>\u7d50\u679c: \u30e1\u30e2\u30ea \u30aa\u30fc\u30d0\u30fc\u30d5\u30ed\u30fc (OOM)\u3002\u30d1\u30f3\u30c0\u306f 1 \u5217\u3060\u3051\u3092\u8aad\u307f\u53d6\u308b\u5834\u5408\u3067\u3082\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u5168\u4f53\u3092\u30e1\u30e2\u30ea\u306b\u8aad\u307f\u8fbc\u3082\u3046\u3068\u3059\u308b\u305f\u3081\u3067\u3059\u3002</li> <li>\u4fee\u6b63: Polars \u307e\u305f\u306f PySpark \u9045\u5ef6\u8a55\u4fa1\u30e2\u30fc\u30c9\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u307e\u305f\u306f\u3001\u5358\u4e00\u306e\u5de8\u5927\u306a\u30e1\u30bf\u30c7\u30fc\u30bf \u30d5\u30a1\u30a4\u30eb\u306e\u51e6\u7406\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001Parquet \u30d5\u30a1\u30a4\u30eb\u3092\u884c\u6570 (\u4f8b: 100 \u4e07\u884c) \u3054\u3068\u306b\u5c0f\u3055\u306a\u30d5\u30a1\u30a4\u30eb\u306b\u53b3\u5bc6\u306b\u5206\u5272\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>WebDataset \u306e\u30b7\u30e3\u30c3\u30d5\u30eb\u304c\u4e0d\u5341\u5206\u3067\u3059:</p> <ul> <li>\u30a8\u30e9\u30fc: \u30c7\u30fc\u30bf\u306f\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u4e2d\u306b\u30c9\u30e1\u30a4\u30f3\u9806\u5e8f\u3067\u66f8\u304d\u8fbc\u307e\u308c\u307e\u3059\u3002\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306f DataLoader \u30d0\u30c3\u30d5\u30a1\u30fc \u30b7\u30e3\u30c3\u30d5\u30eb\u306e\u307f\u306b\u4f9d\u5b58\u3057\u307e\u3059 (\u901a\u5e38\u3001\u30d0\u30c3\u30d5\u30a1\u30fc\u306f 10k \u306e\u307f)\u3002</li> <li>\u7d50\u679c: \u30e2\u30c7\u30eb\u306f 100,000 \u500b\u306e e-\u30b3\u30de\u30fc\u30b9\u753b\u50cf\u3092\u9023\u7d9a\u3057\u3066\u8868\u793a\u3057\u3001\u6b21\u306b 100,000 \u500b\u306e\u98a8\u666f\u753b\u50cf\u3092\u9023\u7d9a\u3057\u3066\u8868\u793a\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u30d0\u30c3\u30d5\u30a1\u30fc\u304c\u5c0f\u3055\u3044\u3068\u3001\u3053\u306e\u300c\u6642\u9593\u7684\u76f8\u95a2\u300d\u3092\u6253\u3061\u7834\u308b\u3053\u3068\u304c\u3067\u304d\u305a\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30ab\u30fc\u30d6\u306e\u6fc0\u3057\u3044\u632f\u52d5\u3084\u767a\u6563\u3055\u3048\u3082\u5f15\u304d\u8d77\u3053\u3057\u307e\u3059\u3002</li> <li>\u4fee\u6b63: WebDataset \u3092\u66f8\u304d\u8fbc\u3080\u524d\u306b\u3001URL \u30ea\u30b9\u30c8\u306b\u5bfe\u3057\u3066 \u30b0\u30ed\u30fc\u30d0\u30eb \u30b7\u30e3\u30c3\u30d5\u30eb \u3092\u5b9f\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 Spark \u306e <code>orderBy(rand())</code> \u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u30ed\u30f3\u30b0\u30c6\u30fc\u30eb \u30c7\u30fc\u30bf\u3092\u8aa4\u3063\u3066\u524a\u9664\u3057\u3066\u3057\u307e\u3046:</p> <ul> <li>\u30a8\u30e9\u30fc: \u7a76\u6975\u306e\u7f8e\u7684\u30b9\u30b3\u30a2\u3092\u8ffd\u6c42\u3059\u308b\u305f\u3081\u3001\u30b9\u30b3\u30a2 &lt; 4_5 \u306e\u753b\u50cf\u3092\u3059\u3079\u3066\u524a\u9664\u3057\u307e\u3059\u3002</li> <li>\u7d50\u679c: \u30e2\u30c7\u30eb\u306f\u300c\u7279\u6b8a\u5316\u300d\u3055\u308c\u3001\u30a2\u30fc\u30c8\u5199\u771f\u3068\u58c1\u7d19\u306e\u307f\u3092\u8a8d\u8b58\u3057\u3001\u533b\u7642\u753b\u50cf\u3001\u30b9\u30c8\u30ea\u30fc\u30c8 \u30d3\u30e5\u30fc\u3001\u624b\u66f8\u304d\u306e\u30e1\u30e2\u306a\u3069\u306e\u73fe\u5b9f\u4e16\u754c\u306e (\u304a\u305d\u3089\u304f\u919c\u3044) \u5199\u771f\u306f\u8a8d\u8b58\u3057\u307e\u305b\u3093\u3002\u30e2\u30c7\u30eb\u306e\u4e00\u822c\u5316\u3092\u5927\u5e45\u306b\u8efd\u6e1b\u3057\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u5c64\u5225\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u6226\u7565\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 5% \uff5e 10% \u306e\u4f4e\u30b9\u30b3\u30a2 \u30c7\u30fc\u30bf\u3092\u300c\u6b63\u898f\u5316\u300d\u3068\u3057\u3066\u4fdd\u6301\u3059\u308b\u304b\u3001\u7f8e\u7684\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u30d0\u30a4\u30d1\u30b9\u3059\u308b\u7279\u5b9a\u306e\u30c9\u30e1\u30a4\u30f3 (OCR\u3001\u30b0\u30e9\u30d5\u306a\u3069) \u306b\u7279\u5225\u306a\u30db\u30ef\u30a4\u30c8\u30ea\u30b9\u30c8\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u91cd\u8907\u30c7\u30fc\u30bf\u306e\u5371\u967a\u6027 (\u91cd\u8907\u6392\u9664):</p> <ul> <li>\u30a8\u30e9\u30fc: \u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306e\u5927\u91cf\u306e\u91cd\u8907\u753b\u50cf (\u30df\u30fc\u30e0\u3001\u30d0\u30a4\u30e9\u30eb \u30cb\u30e5\u30fc\u30b9\u753b\u50cf\u306a\u3069) \u3092\u7121\u8996\u3057\u307e\u3059\u3002</li> <li>\u7d50\u679c: \u30e2\u30c7\u30eb\u306f\u7279\u5b9a\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u30aa\u30fc\u30d0\u30fc\u30d5\u30a3\u30c3\u30c8\u3057\u3001\u751f\u6210\u4e2d\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30bb\u30c3\u30c8\u306e\u753b\u50cf\u3092\u300c\u8a18\u61b6\u300d\u3059\u308b\u3053\u3068\u3082\u3042\u308a\u3001\u91cd\u5927\u306a\u8457\u4f5c\u6a29\u30ea\u30b9\u30af\u3092\u5f15\u304d\u8d77\u3053\u3057\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306b \u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u91cd\u8907\u6392\u9664 \u3092\u8ffd\u52a0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3059\u3079\u3066\u306e\u753b\u50cf\u306eEmbedding\u3092\u8a08\u7b97\u3057\u3001\u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u306b Faiss \u307e\u305f\u306f MinHashLSH \u3092\u4f7f\u7528\u3057\u3001\u985e\u4f3c\u6027\u306e\u9ad8\u3044\u753b\u50cf\u30b0\u30eb\u30fc\u30d7\u3054\u3068\u306b 1 \u3064\u3060\u3051\u4fdd\u6301\u3057\u307e\u3059\u3002</li> </ul> </li> </ul>"},{"location":"ja/part3/3_2_recaptioning/","title":"\u7b2c7\u7ae0: Recaptioning","text":""},{"location":"ja/part3/3_2_recaptioning/#7","title":"\u7b2c 7 \u7ae0: \u30c7\u30fc\u30bf\u306e\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3","text":""},{"location":"ja/part3/3_2_recaptioning/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306e\u30aa\u30ea\u30b8\u30ca\u30eb\u306e Alt-text (\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8) \u306f\u3001\u57fa\u672c\u7684\u306b\u3001\u691c\u7d22\u30a8\u30f3\u30b8\u30f3\u6700\u9069\u5316 (SEO) \u306e\u305f\u3081\u306b Web \u958b\u767a\u8005\u306b\u3088\u3063\u3066\u8a2d\u8a08\u3055\u308c\u305f\u88dc\u52a9\u30b3\u30f3\u30c6\u30f3\u30c4\u3067\u3059\u3002\u305d\u306e\u4e2d\u5fc3\u7684\u306a\u76ee\u6a19\u306f\u3001\u691c\u7d22\u7d50\u679c\u306b\u304a\u3051\u308b Web \u30da\u30fc\u30b8\u306e\u30e9\u30f3\u30ad\u30f3\u30b0\u3092\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u3067\u3042\u308a\u3001\u753b\u50cf\u81ea\u4f53\u306e\u30d3\u30b8\u30e5\u30a2\u30eb \u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u6b63\u78ba\u304b\u3064\u5305\u62ec\u7684\u306b\u8a18\u8ff0\u3059\u308b\u3053\u3068\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u5927\u91cf\u306e\u751f\u306e\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u304c\u751f\u6210\u3055\u308c\u3001\u30d3\u30b8\u30e5\u30a2\u30eb\u8a00\u8a9e\u30e2\u30c7\u30eb (VLM) \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u300c\u30d3\u30b8\u30e5\u30a2\u30eb \u30c6\u30ad\u30b9\u30c8\u306e\u6b63\u78ba\u306a\u4f4d\u7f6e\u5408\u308f\u305b\u300d\u3068\u3044\u3046\u4e2d\u5fc3\u8981\u4ef6\u3092\u6e80\u305f\u3059\u3053\u3068\u304c\u3067\u304d\u306a\u304f\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001\u4e3b\u6d41\u306e\u30d3\u30b8\u30e5\u30a2\u30eb\u8a00\u8a9e\u30e2\u30c7\u30eb (VLM) \u3092\u6d3b\u7528\u3057\u3066\u3001\u5927\u898f\u6a21\u306a\u753b\u50cf\u30c7\u30fc\u30bf\u3092\u81ea\u52d5\u7684\u306b\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3059\u308b\u305f\u3081\u306e\u52b9\u7387\u7684\u3067\u30b9\u30b1\u30fc\u30e9\u30d6\u30eb\u306a\u300c\u5408\u6210\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 \u30d5\u30a1\u30af\u30c8\u30ea\u300d\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u4f53\u7cfb\u7684\u306b\u7d39\u4ecb\u3057\u307e\u3059\u3002\u8aac\u660e\u306e\u7c92\u5ea6 (\u6982\u8981\u304b\u3089\u8a73\u7d30\u307e\u3067) \u3092\u6b63\u78ba\u306b\u5236\u5fa1\u3059\u308b\u30d7\u30ed\u30f3\u30d7\u30c8 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u91cd\u8981\u306a\u5f79\u5272\u3092\u8a73\u3057\u304f\u8abf\u67fb\u3057\u3001\u3055\u307e\u3056\u307e\u306a\u4e0b\u6d41\u30bf\u30b9\u30af\u3067\u533a\u5225\u3055\u308c\u308b\u8aac\u660e\u7cbe\u5ea6\u306e\u8981\u4ef6\u3092\u89e3\u6c7a\u3057\u3001VLM \u306e\u30ea\u30c3\u30c1 \u30c6\u30ad\u30b9\u30c8\u753b\u50cf (\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3001\u30dd\u30b9\u30bf\u30fc\u3001\u30b0\u30e9\u30d5\u306a\u3069) \u5185\u306e\u30c6\u30ad\u30b9\u30c8\u306e\u8a8d\u8b58\u304c\u5f31\u3044\u3053\u3068\u306b\u5bfe\u51e6\u3059\u308b\u88dc\u8db3\u3068\u3057\u3066\u5149\u5b66\u5f0f\u6587\u5b57\u8a8d\u8b58 (OCR) \u30c6\u30af\u30ce\u30ed\u30b8\u3092\u5c0e\u5165\u3057\u3066\u3001\u8907\u96d1\u306a\u753b\u50cf\u306e\u30e2\u30c7\u30eb\u306e\u7406\u89e3\u3092\u3055\u3089\u306b\u5f37\u5316\u3057\u307e\u3059\u3002</p> <p>\u5b66\u7fd2\u76ee\u6a19: * \u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306e\u300c3 \u3064\u306e\u7f6a\u300d\uff08\u7121\u95a2\u4fc2\u3001\u77ed\u3059\u304e\u308b\u3001\u8996\u899a\u7684\u306a\u7701\u7565\uff09\u306e\u672c\u8cea\u7684\u306a\u539f\u56e0\u3068\u3001\u305d\u306e\u3088\u3046\u306a\u4f4e\u54c1\u8cea\u306e\u8aac\u660e\u304c\u8996\u899a\u8a00\u8a9e\u30e2\u30c7\u30eb\u3068\u751f\u6210\u8996\u899a\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u5f15\u304d\u8d77\u3053\u3059\u5177\u4f53\u7684\u306a\u5bb3\uff08\u4f8b\uff1a\u30e2\u30c7\u30eb\u306e\u5e7b\u899a\u3001\u8996\u899a\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u6574\u5408\u6027\u306e\u5931\u6557\u3001\u4e00\u822c\u5316\u306e\u4e0d\u5168\uff09\u3092\u6df1\u304f\u7406\u89e3\u3057\u307e\u3059\u3002 * vLLM (\u52b9\u7387\u7684\u306a\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u63a8\u8ad6\u30a8\u30f3\u30b8\u30f3) \u3092\u4f7f\u7528\u3057\u3066\u3001LLaVA \u3084 CogVLM \u306a\u3069\u306e\u4e3b\u6d41\u306e VLM \u3092\u5c55\u958b\u3059\u308b\u5b8c\u5168\u306a\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3092\u30de\u30b9\u30bf\u30fc\u3057\u3001\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u63a8\u8ad6\u306e\u6838\u3068\u306a\u308b\u539f\u7406\u3092\u7406\u89e3\u3057\u3001\u8fc5\u901f\u306a\u5927\u898f\u6a21\u753b\u50cf\u30ea\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002 * \u3055\u307e\u3056\u307e\u306a\u4e0b\u6d41\u30bf\u30b9\u30af (CLIP \u30b9\u30bf\u30a4\u30eb\u306e\u30c7\u30e5\u30a2\u30eb\u30bf\u30ef\u30fc \u30e2\u30c7\u30eb\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3001Sora \u30b9\u30bf\u30a4\u30eb\u306e\u751f\u6210\u30e2\u30c7\u30eb \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306a\u3069) \u306b\u57fa\u3065\u3044\u3066\u968e\u5c64\u5316\u3055\u308c\u305f\u30d7\u30ed\u30f3\u30d7\u30c8\u6226\u7565\u3092\u8a2d\u8a08\u3067\u304d\u3001\u30bf\u30b9\u30af\u306e\u8981\u4ef6\u306b\u6b63\u78ba\u306b\u4e00\u81f4\u3059\u308b\u7c21\u5358\u307e\u305f\u306f\u8a73\u7d30\u306a\u753b\u50cf\u8aac\u660e\u3092\u67d4\u8edf\u306b\u751f\u6210\u3067\u304d\u307e\u3059\u3002 * \u30b3\u30a2 OCR \u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u30e1\u30bd\u30c3\u30c9\u3092\u30de\u30b9\u30bf\u30fc\u3057\u3001OCR \u8a8d\u8b58\u7d50\u679c\u3068 VLM \u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u52d5\u7684\u306a\u878d\u5408\u3092\u5b9f\u88c5\u3057\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304a\u3088\u3073\u30dd\u30b9\u30bf\u30fc \u30af\u30e9\u30b9\u306e\u30ea\u30c3\u30c1 \u30c6\u30ad\u30b9\u30c8\u753b\u50cf\u306e\u4f4e\u3044\u8a18\u8ff0\u54c1\u8cea\u3092\u89e3\u6c7a\u3057\u3001\u305d\u306e\u3088\u3046\u306a\u753b\u50cf\u306e\u8a18\u8ff0\u7cbe\u5ea6\u3068\u8c4a\u304b\u3055\u3092\u5927\u5e45\u306b\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p> <p>\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb:</p> <p>\u300c\u30bd\u30e9\u306e\u3088\u3046\u306a\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u3066\u3044\u308b\u3068\u60f3\u50cf\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30a8\u30c3\u30d5\u30a7\u30eb\u5854\u3092\u80cc\u666f\u306b\u5915\u65e5\u306e\u4e2d\u3092\u8d70\u308b\u30b4\u30fc\u30eb\u30c7\u30f3\u30ec\u30c8\u30ea\u30d0\u30fc\u306e\u753b\u50cf\u3092\u30e2\u30c7\u30eb\u306b\u4e0e\u3048\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u751f\u30c7\u30fc\u30bf\u306e\u30e9\u30d9\u30eb\u306f\u300cIMG_20240501.jpg\u300d\u307e\u305f\u306f\u300c\u6700\u9ad8\u306e\u30c9\u30c3\u30b0\u30d5\u30fc\u30c9 50% \u30aa\u30d5\u300d\u3067\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u30c7\u30fc\u30bf\u3067\u306f\u3001\u30e2\u30c7\u30eb\u306f\u300c\u30b4\u30fc\u30eb\u30c7\u30f3 \u30ec\u30c8\u30ea\u30d0\u30fc\u300d\u3068\u300c\u30a8\u30c3\u30d5\u30a7\u30eb\u5854\u300d\u306e\u8996\u899a\u7684\u306a\u5bfe\u5fdc\u95a2\u4fc2\u3092\u5b66\u7fd2\u3059\u308b\u3053\u3068\u306f\u306a\u304f\u3001\u307e\u3057\u3066\u3084\u300c\u5915\u65e5\u306e\u7167\u660e\u300d\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u72ac\u3068\u5854\u3092\u30c6\u30ad\u30b9\u30c8\u306b\u6b63\u78ba\u306b\u66f8\u304d\u8fbc\u3080\u306b\u306f\u3001AI \u306b\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u3068\u3057\u3066\u6a5f\u80fd\u3055\u305b\u308b\u300c\u30c7\u30fc\u30bf\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u300d\u304c\u5fc5\u8981\u3067\u3059\u3002\u300d</p>"},{"location":"ja/part3/3_2_recaptioning/#71-web","title":"7.1 \u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306e\u5236\u9650: \u751f\u306e Web \u8a18\u8ff0\u304c\u4f7f\u7528\u3067\u304d\u306a\u3044\u306e\u306f\u306a\u305c\u3067\u3059\u304b?","text":"<p>\u8996\u899a\u8a00\u8a9e\u30e2\u30c7\u30eb\u3068\u751f\u6210\u8996\u899a\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u306f\u3001\u30c7\u30fc\u30bf\u54c1\u8cea\u304c\u30e2\u30c7\u30eb\u306e\u4e0a\u9650\u3092\u76f4\u63a5\u6c7a\u5b9a\u3057\u307e\u3059\u3002Web \u30da\u30fc\u30b8\u306e\u751f\u306e\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306f\u3001\u307e\u3055\u306b\u4f4e\u54c1\u8cea\u306e\u8996\u899a\u30c6\u30ad\u30b9\u30c8 \u30c7\u30fc\u30bf\u306e\u4e3b\u306a\u30bd\u30fc\u30b9\u306e 1 \u3064\u3067\u3059\u3002 DeepMind (\u300c\u5f31\u6559\u5e2b\u753b\u50cf\u30c6\u30ad\u30b9\u30c8 \u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u305f\u8a00\u8a9e\u753b\u50cf\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u300d) \u304a\u3088\u3073 OpenAI (\u300c\u4eba\u9593\u306e\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u306b\u3088\u308b\u6307\u793a\u306b\u5f93\u3046\u8a00\u8a9e\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u300d) \u306e\u5185\u90e8\u8abf\u67fb\u30ec\u30dd\u30fc\u30c8\u306b\u3088\u308b\u3068\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u304b\u3089\u30af\u30ed\u30fc\u30eb\u3055\u308c\u305f\u751f\u306e\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u3068\u3057\u3066\u76f4\u63a5\u4f7f\u7528\u3059\u308b\u3068\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u6642\u671f\u5c1a\u65e9\u306b\u300c\u4e0a\u9650\u300d\u306b\u9054\u3059\u308b (\u3064\u307e\u308a\u3001\u30c7\u30fc\u30bf\u91cf\u306e\u5897\u52a0\u306b\u95a2\u4fc2\u306a\u304f\u3001\u30e2\u30c7\u30eb\u306e\u8996\u899a\u7684\u7406\u89e3\u3068\u30c6\u30ad\u30b9\u30c8\u751f\u6210\u306e\u7cbe\u5ea6\u304c\u305d\u308c\u4ee5\u4e0a\u6539\u5584\u3067\u304d\u306a\u3044) \u304b\u3001\u3055\u3089\u306b\u306f\u4f4e\u4e0b\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u6838\u5fc3\u7684\u306a\u554f\u984c\u306f\u300c3 \u3064\u306e\u7f6a\u300d\u3068\u3057\u3066\u8981\u7d04\u3067\u304d\u307e\u3059\u3002</p> <ul> <li>\u975e\u5e38\u306b\u30ce\u30a4\u30ba\u304c\u591a\u3044: \u5927\u91cf\u306e\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306b\u306f\u3001\u30d5\u30a1\u30a4\u30eb\u540d (\u4f8b: \u300cIMG_20240501.jpg\u300d)\u3001\u65e5\u4ed8\u3001\u7121\u95a2\u4fc2\u306a SEO \u30ad\u30fc\u30ef\u30fc\u30c9\u306e\u7a4d\u307f\u91cd\u306d (\u4f8b: \u300c\u5b89\u3044\u9774\u3092\u8cb7\u3046\u3001\u30ca\u30a4\u30ad\u3001\u30a2\u30c7\u30a3\u30c0\u30b9\u300d\u3001\u300c\u8fd1\u304f\u306e\u6700\u9ad8\u306e\u30b3\u30fc\u30d2\u30fc\u30b7\u30e7\u30c3\u30d7\u300d) \u306e\u307f\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u8a18\u8ff0\u306f\u753b\u50cf\u306e\u30d3\u30b8\u30e5\u30a2\u30eb\u5185\u5bb9\u3068\u306f\u5168\u304f\u95a2\u4fc2\u3042\u308a\u307e\u305b\u3093\u3002\u3053\u308c\u3089\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u4f7f\u7528\u3059\u308b\u3068\u3001\u30e2\u30c7\u30eb\u304c\u8996\u899a\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u5bfe\u5fdc\u3092\u78ba\u7acb\u3067\u304d\u306a\u3044\u3060\u3051\u3067\u306a\u304f\u3001\u30e2\u30c7\u30eb\u306e\u8a00\u8a9e\u80fd\u529b\u304c\u640d\u306a\u308f\u308c\u3001\u30e2\u30c7\u30eb\u304c\u7121\u95a2\u4fc2\u3067\u5197\u9577\u306a\u30c6\u30ad\u30b9\u30c8\u3001\u3055\u3089\u306b\u306f\u91cd\u5ea6\u306e\u5e7b\u899a\u3092\u751f\u6210\u3059\u308b\u539f\u56e0\u306b\u306a\u308a\u307e\u3059\u3002</li> <li>\u8996\u899a\u7684\u306a\u7701\u7565: \u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306e\u30c7\u30b6\u30a4\u30f3\u610f\u56f3\u306f\u4e3b\u306b Web \u30da\u30fc\u30b8\u306e\u6a5f\u80fd\u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u3053\u3068\u3067\u3042\u308a\u3001\u8996\u899a\u7684\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u8aac\u660e\u3059\u308b\u3053\u3068\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u591a\u304f\u306e\u5834\u5408\u3001\u753b\u50cf\u306e\u6a5f\u80fd (\u4f8b: \u300c\u8cfc\u5165\u30dc\u30bf\u30f3\u3092\u30af\u30ea\u30c3\u30af\u300d\u3001\u300c\u8a73\u7d30\u3092\u8868\u793a\u300d) \u307e\u305f\u306f\u5546\u696d\u7684\u5c5e\u6027 (\u4f8b: \u300c\u8d64\u306e XL \u30b5\u30a4\u30ba\u300d\u3001\u300c\u671f\u9593\u9650\u5b9a\u5272\u5f15\u300d) \u306e\u307f\u3092\u8aac\u660e\u3057\u3001\u753b\u50cf\u306e\u8996\u899a\u7684\u306a\u8a73\u7d30 (\u4f8b: \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5f62\u72b6\u3001\u8272\u3001\u30c6\u30af\u30b9\u30c1\u30e3\u3001\u7a7a\u9593\u95a2\u4fc2\u3001\u7167\u660e\u52b9\u679c) \u3092\u5b8c\u5168\u306b\u7121\u8996\u3057\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300c\u80f8\u306b\u767d\u3044\u30f4\u30a3\u30f3\u30c6\u30fc\u30b8\u306e\u30ed\u30b4\u304c\u4ed8\u3044\u305f\u8d64\u3044\u7d14\u7dbf\u306e T \u30b7\u30e3\u30c4\u304c\u6728\u88fd\u306e\u30c6\u30fc\u30d6\u30eb\u306e\u4e0a\u306b\u5e73\u3089\u306b\u7f6e\u304b\u308c\u3066\u3044\u308b\u300d\u3068\u3044\u3046\u753b\u50cf\u306b\u306f\u3001\u5358\u306a\u308b\u300c\u8d64\u3044 T \u30b7\u30e3\u30c4\u306e\u30d7\u30ed\u30e2\u30fc\u30b7\u30e7\u30f3\u300d\u3068\u3044\u3046\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u8aac\u660e\u3067\u306f\u3001\u30e2\u30c7\u30eb\u306b\u8996\u899a\u7684\u306a\u7279\u5fb4\u3092\u5b66\u7fd2\u3055\u305b\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002</li> <li>\u77ed\u3059\u304e\u308b: Common Crawl (\u4e16\u754c\u6700\u5927\u306e Web \u30af\u30ed\u30fc\u30eb \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8) \u306e\u7d71\u8a08\u306b\u3088\u308b\u3068\u3001\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306e 50% \u4ee5\u4e0a\u304c 5 \u5358\u8a9e\u672a\u6e80\u3067\u3042\u308a\u300130% \u306f 3 \u5358\u8a9e\u672a\u6e80\u3067\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u975e\u5e38\u306b\u77ed\u3044\u8aac\u660e\u3067\u306f\u3001\u8907\u96d1\u306a\u8996\u899a\u7684\u30ed\u30b8\u30c3\u30af\u3001\u7a7a\u9593\u95a2\u4fc2\u3001\u304a\u3088\u3073\u8a73\u7d30\u60c5\u5831\u3092\u4f1d\u3048\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u305f\u3068\u3048\u3070\u3001\u8907\u6570\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3001\u30b7\u30fc\u30f3\u3001\u304a\u3088\u3073\u76f8\u4e92\u4f5c\u7528\u95a2\u4fc2\u3092\u542b\u3080\u300c\u8349\u306e\u4e0a\u306b\u6a2a\u305f\u308f\u308b\u30b4\u30fc\u30eb\u30c7\u30f3\u30ec\u30c8\u30ea\u30d0\u30fc\u3001\u8d64\u3044\u30dc\u30fc\u30eb\u306e\u4e0a\u306b\u524d\u8db3\u3001\u91ce\u306e\u82b1\u3067\u3044\u3063\u3071\u3044\u306e\u4e18\u306e\u4e2d\u8179\u306e\u80cc\u666f\u300d\u3092\u8aac\u660e\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002</li> </ul> <p>\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u306e\u4fa1\u5024: \u30c7\u30fc\u30bf\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u306e\u4e2d\u5fc3\u7684\u306a\u4fa1\u5024\u306f\u3001AI \u3092\u4f7f\u7528\u3057\u3066\u9ad8\u54c1\u8cea\u306e\u300c\u30d3\u30b8\u30e5\u30a2\u30eb\u30c6\u30ad\u30b9\u30c8\u306e\u6b63\u78ba\u306a\u4f4d\u7f6e\u5408\u308f\u305b\u300d\u8aac\u660e\u3092\u81ea\u52d5\u7684\u306b\u751f\u6210\u3057\u3001\u4f4e\u54c1\u8cea\u306e\u751f\u306e\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u3092\u7f6e\u304d\u63db\u3048\u3001\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u4e0a\u9650\u3092\u6253\u3061\u7834\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u308c\u306f\u3001\u30c8\u30c3\u30d7\u306e\u696d\u754c\u8abf\u67fb\u306b\u3088\u3063\u3066\u78ba\u8a8d\u3055\u308c\u3066\u3044\u307e\u3059\u3002OpenAI \u306f\u3001DALL-E 3 \u8ad6\u6587 (\u300cDALL\u30fbE 3: \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8\u3092\u6539\u5584\u3057\u305f\u81ea\u5df1\u56de\u5e30\u753b\u50cf\u751f\u6210\u306e\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u300d) \u3067\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u6700\u5927 95% \u306e\u5408\u6210\u9577\u6587\u30c6\u30ad\u30b9\u30c8 (\u5408\u6210\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3001\u3064\u307e\u308a VLM \u306b\u3088\u3063\u3066\u751f\u6210\u3055\u308c\u305f\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 \u30c6\u30ad\u30b9\u30c8) \u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u304c\u3001OpenAI \u306e\u6307\u793a\u8ffd\u5f93\u80fd\u529b\u3068\u8996\u899a\u5fa9\u5143\u7cbe\u5ea6\u304c Stable Diffusion XL (SDXL) \u3092\u306f\u308b\u304b\u306b\u4e0a\u56de\u308b\u4e3b\u306a\u7406\u7531\u306e 1 \u3064\u3067\u3042\u308b\u3068\u660e\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u5408\u6210\u9577\u6587\u30c6\u30ad\u30b9\u30c8\u306f\u3001\u753b\u50cf\u306e\u8996\u899a\u7684\u306a\u8a73\u7d30\u3001\u8ad6\u7406\u7684\u95a2\u4fc2\u3001\u30b7\u30fc\u30f3\u306e\u96f0\u56f2\u6c17\u3092\u6b63\u78ba\u306b\u30ad\u30e3\u30d7\u30c1\u30e3\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u3001\u30e2\u30c7\u30eb\u304c\u300c\u898b\u3066\u3044\u308b\u3082\u306e\u3092\u8aac\u660e\u3059\u308b\u300d\u3053\u3068\u3092\u771f\u306b\u5b66\u7fd2\u3067\u304d\u308b\u305f\u3081\u3001\u305d\u306e\u5f8c\u306e\u751f\u6210\u3001\u8a8d\u8b58\u3001\u7406\u89e3\u306e\u80fd\u529b\u304c\u5411\u4e0a\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_2_recaptioning/#72-vlm","title":"7.2 \u5408\u6210\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 \u30d5\u30a1\u30af\u30c8\u30ea\u30fc: VLM \u3092\u4f7f\u7528\u3057\u3066\u30c7\u30fc\u30bf\u3092\u518d\u751f\u6210\u3059\u308b","text":"<p>\u5927\u898f\u6a21\u306a\u753b\u50cf\u306e\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3092\u5b9f\u73fe\u3059\u308b\u305f\u3081\u306b\u3001\u624b\u52d5\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u307f\u306b\u4f9d\u5b58\u3059\u308b\u3068\u3001\u975e\u5e38\u306b\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308b\u3060\u3051\u3067\u306a\u304f\uff08\u753b\u50cf\u3054\u3068\u306b\u6570\u5206\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u6570\u767e\u4e07\u307e\u305f\u306f\u6570\u5341\u5104\u306e\u753b\u50cf\u306b\u306a\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\uff09\u3001\u4e00\u8cab\u6027\u306e\u306a\u3044\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u6a19\u6e96\u3068\u4f4e\u52b9\u7387\u3068\u3044\u3046\u554f\u984c\u3082\u3042\u308a\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001VLM \u4e3b\u5c0e\u306e\u300c\u5408\u6210\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 \u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u300d\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u751f\u306e\u753b\u50cf\u3092\u5165\u529b\u3068\u3057\u3066\u3001\u9ad8\u54c1\u8cea\u3067\u6a19\u6e96\u5316\u3055\u308c\u305f\u30c6\u30ad\u30b9\u30c8\u306e\u8aac\u660e\u3092\u51fa\u529b\u3068\u3057\u3066\u53d7\u3051\u53d6\u308a\u3001\u81ea\u52d5\u5316\u3068\u30d0\u30c3\u30c1\u51e6\u7406\u3092\u901a\u3058\u3066\u30c7\u30fc\u30bf\u306e\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3092\u5b8c\u4e86\u3057\u3001\u30c7\u30fc\u30bf\u4fa1\u5024\u306e\u300c\u518d\u751f\u300d\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u300c\u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u300d\u306e\u4e2d\u6838\u3068\u306a\u308b\u30ed\u30b8\u30c3\u30af\u306f\u3001\u751f\u306e\u753b\u50cf\u3092\u6700\u9069\u5316\u3055\u308c\u305f VLM \u306b\u30d5\u30a3\u30fc\u30c9\u3057\u3001\u614e\u91cd\u306b\u8a2d\u8a08\u3055\u308c\u305f\u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u3088\u3063\u3066\u8a18\u8ff0\u306e\u7c92\u5ea6\u3068\u30b9\u30bf\u30a4\u30eb\u3092\u5236\u5fa1\u3057\u3001\u6b21\u306b\u52b9\u7387\u7684\u306a\u63a8\u8ad6\u30a8\u30f3\u30b8\u30f3\u306b\u3088\u3063\u3066\u51e6\u7406\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u5411\u4e0a\u3055\u305b\u3001\u6700\u7d42\u7684\u306b\u4e0b\u6d41\u30bf\u30b9\u30af\u306e\u8981\u4ef6\u3092\u6e80\u305f\u3059\u9ad8\u54c1\u8cea\u306a\u8a18\u8ff0\u3092\u51fa\u529b\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u5168\u4f53\u306e\u30d5\u30ed\u30fc\u306f\u3001\u300c\u30e2\u30c7\u30eb\u306e\u9078\u629e\u3068\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08\u300d\u3001\u300c\u8fc5\u901f\u306a\u6226\u7565\u306e\u6700\u9069\u5316\u300d\u3001\u304a\u3088\u3073\u300c\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u5c0e\u5165\u300d\u3068\u3044\u3046 3 \u3064\u306e\u30b3\u30a2 \u30ea\u30f3\u30af\u306b\u5206\u5272\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_2_recaptioning/#721","title":"7.2.1 \u30e2\u30c7\u30eb\u306e\u9078\u629e\u3068\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3","text":"<p>VLM \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306f\u3001\u8a18\u8ff0\u306e\u54c1\u8cea\u3001\u901f\u5ea6\u3001\u9069\u7528\u53ef\u80fd\u306a\u30b7\u30ca\u30ea\u30aa\u3092\u76f4\u63a5\u6c7a\u5b9a\u3057\u307e\u3059\u3002\u73fe\u5728\u4e3b\u6d41\u306e VLM \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306f\u4e3b\u306b 3 \u3064\u306e\u30bf\u30a4\u30d7\u306b\u5206\u985e\u3055\u308c\u307e\u3059\u3002\u4ee5\u4e0b\u306e\u8868\u306b\u3001\u5404\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u4ee3\u8868\u7684\u306a\u30e2\u30c7\u30eb\u3001\u30e1\u30ea\u30c3\u30c8/\u30c7\u30e1\u30ea\u30c3\u30c8\u306e\u6bd4\u8f03\u3001\u63a8\u5968\u30b7\u30ca\u30ea\u30aa\u3092\u793a\u3057\u307e\u3059\u3002\u9078\u629e\u306f\u3001\u4e0b\u6d41\u30bf\u30b9\u30af\u306e\u8981\u4ef6 (\u8a18\u8ff0\u7cbe\u5ea6\u3001\u51e6\u7406\u901f\u5ea6\u3001\u30c7\u30fc\u30bf\u578b\u306a\u3069) \u306b\u57fa\u3065\u3044\u3066\u67d4\u8edf\u306b\u884c\u3046\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> \u30e2\u30c7\u30eb\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 \u4ee3\u8868\u6a5f\u7a2e \u5229\u70b9 \u30c7\u30e1\u30ea\u30c3\u30c8 \u63a8\u5968\u3055\u308c\u308b\u30b7\u30ca\u30ea\u30aa Q-Former \u63a5\u7d9a BLIP-2\u3001InstructBLIP \u30d1\u30e9\u30e1\u30fc\u30bf\u6570\u304c\u5c11\u306a\u3044 (\u901a\u5e38\u306f\u6570\u5341\u5104\u3067\u3001\u5927\u898f\u6a21\u306a\u8a00\u8a9e\u30e2\u30c7\u30eb\u3092\u306f\u308b\u304b\u306b\u4e0b\u56de\u308b)\u3001\u63a8\u8ad6\u304c\u901f\u3044 (1 \u3064\u306e\u753b\u50cf\u306e\u63a8\u8ad6\u306b\u6570\u5341\u30df\u30ea\u79d2\u304b\u304b\u308b\u5834\u5408\u304c\u3042\u308b)\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3068\u5c55\u958b\u306e\u30b3\u30b9\u30c8\u304c\u4f4e\u3044\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u5e7b\u899a\u304c\u767a\u751f\u3057\u306b\u304f\u3044 (\u8aac\u660e\u304c\u753b\u50cf\u306b\u3074\u3063\u305f\u308a\u3068\u4e00\u81f4\u3059\u308b) \u8aac\u660e\u306e\u9577\u3055\u304c\u77ed\u304f\u3001\u7d30\u90e8\u306e\u30ad\u30e3\u30d7\u30c1\u30e3\u304c\u5e73\u5747\u7684\u3067\u3001\u300c\u7e70\u308a\u8fd4\u3057\u306e\u8aac\u660e\u300d\u304c\u767a\u751f\u3057\u3084\u3059\u3044 (\u4e2d\u5fc3\u3068\u306a\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u307b\u3068\u3093\u3069\u306a\u304f\u3001\u8a73\u7d30\u304c\u62e1\u5f35\u3055\u308c\u3066\u3044\u306a\u3044)\u3001\u8907\u96d1\u306a\u30b7\u30fc\u30f3\u306e\u7406\u89e3\u304c\u9650\u3089\u308c\u3066\u3044\u308b \u5927\u91cf\u306e\u753b\u50cf\u306e\u8fc5\u901f\u306a\u521d\u671f\u30b9\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 (\u8cb4\u91cd\u306a\u30c7\u30fc\u30bf\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3059\u308b\u305f\u3081\u306e\u6570\u5341\u5104\u306e\u753b\u50cf\u306e\u5927\u307e\u304b\u306a\u8981\u7d04\u306a\u3069)\u3001\u307e\u305f\u306f\u77ed\u3044\u4ee3\u66ff\u30c6\u30ad\u30b9\u30c8\u306e\u751f\u6210 (\u8aac\u660e\u306e\u9577\u3055\u306b\u53b3\u5bc6\u306a\u5236\u9650\u304c\u3042\u308b\u30b7\u30ca\u30ea\u30aa\u306e\u5834\u5408) MLP \u30d7\u30ed\u30b8\u30a7\u30af\u30b7\u30e7\u30f3 + LLM LLaVA-1_6 / \u30cd\u30af\u30b9\u30c8 \u975e\u5e38\u306b\u8a73\u7d30\u306a\u8aac\u660e\u3001\u5fae\u5999\u306a\u753b\u50cf\u306e\u8a73\u7d30 (\u7167\u660e\u3001\u30c6\u30af\u30b9\u30c1\u30e3\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u76f8\u4e92\u4f5c\u7528\u306a\u3069) \u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u3001\u5f37\u529b\u306a\u6307\u793a\u306b\u5f93\u3044\u307e\u3059 (\u300c\u30b7\u30fc\u30f3\u306e\u9806\u5e8f\u3067\u8aac\u660e\u3059\u308b\u300d\u3001\u300c\u30b3\u30a2 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u30cf\u30a4\u30e9\u30a4\u30c8\u3059\u308b\u300d\u306a\u3069\u306e\u30d7\u30ed\u30f3\u30d7\u30c8\u8981\u4ef6\u306b\u6b63\u78ba\u306b\u5bfe\u5fdc\u3057\u307e\u3059)\u3001\u30de\u30eb\u30c1\u30bf\u30fc\u30f3 \u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059 (\u30de\u30eb\u30c1\u30bf\u30fc\u30f3 \u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u901a\u3058\u3066\u8aac\u660e\u306e\u54c1\u8cea\u3092\u6700\u9069\u5316\u3067\u304d\u307e\u3059)\u3002\u5927\u91cf\u306e\u30ed\u30b8\u30c3\u30af\u8a08\u7b97 (LLaMA 2 7B/13B \u306e\u3088\u3046\u306a 7B \u4ee5\u4e0a\u306e\u30d1\u30e9\u30e1\u30fc\u30bf LLM \u304c\u5fc5\u8981)\u3001\u6bd4\u8f03\u7684\u9045\u3044\u63a8\u8ad6\u3001\u30d7\u30ed\u30f3\u30d7\u30c8\u5236\u7d04\u306a\u3057\u3001\u5197\u9577\u306a\u8aac\u660e\u306b\u306a\u308a\u304c\u3061 \u9ad8\u54c1\u8cea\u306e\u9577\u3044\u5f62\u5f0f\u306e\u9ad8\u5bc6\u5ea6\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30e1\u30a4\u30f3 \u30e2\u30c7\u30eb (\u4f8b: Sora \u30b9\u30bf\u30a4\u30eb\u306e\u751f\u6210\u30e2\u30c7\u30eb\u3001SD3 \u753b\u50cf\u751f\u6210\u30e2\u30c7\u30eb\u3001\u6b63\u78ba\u3067\u8a73\u7d30\u306a\u30d3\u30b8\u30e5\u30a2\u30eb\u30c6\u30ad\u30b9\u30c8\u914d\u7f6e\u30c7\u30fc\u30bf\u3092\u5fc5\u8981\u3068\u3059\u308b\u30b7\u30ca\u30ea\u30aa\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0) \u30d3\u30b8\u30e7\u30f3\u30d5\u30a1\u30fc\u30b9\u30c8\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 CogVLM\u3001Qwen-VL \u9ad8\u3044\u8996\u899a\u89e3\u50cf\u5ea6 (HD \u753b\u50cf\u5165\u529b\u3092\u30b5\u30dd\u30fc\u30c8\u3001\u4e00\u90e8\u306e\u30e2\u30c7\u30eb\u306f 4K \u3092\u30b5\u30dd\u30fc\u30c8)\u3001\u304d\u3081\u7d30\u304b\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u8a8d\u8b58\u306b\u512a\u308c\u3001\u7279\u306b\u30ea\u30c3\u30c1\u30c6\u30ad\u30b9\u30c8\u753b\u50cf (\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3001\u30c1\u30e3\u30fc\u30c8\u3001UI \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8) \u5185\u306e\u30c6\u30ad\u30b9\u30c8\u304a\u3088\u3073\u5c0f\u3055\u306a\u30a6\u30a3\u30b8\u30a7\u30c3\u30c8 (\u30dc\u30bf\u30f3\u3001\u5165\u529b\u30d5\u30a3\u30fc\u30eb\u30c9) \u306e\u7cbe\u5ea6\u304c\u9ad8\u304f\u3001\u30c6\u30ad\u30b9\u30c8\u3068\u8996\u899a\u8981\u7d20\u306e\u95a2\u9023\u4ed8\u3051\u3092\u7406\u89e3\u3057\u307e\u3059\u3002 VRAM \u4f7f\u7528\u7387\u304c\u9ad8\u3044 (7B \u30e2\u30c7\u30eb\u306e\u5c55\u958b\u306b\u306f\u5c11\u306a\u304f\u3068\u3082 24GB VRAM \u304c\u5fc5\u8981)\u3001\u975e\u6a19\u6e96\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 (\u30e2\u30c7\u30eb\u3054\u3068\u306b\u5c55\u958b\u30a2\u30d7\u30ed\u30fc\u30c1\u304c\u7570\u306a\u308b)\u3001\u5c55\u958b\u304c\u3084\u3084\u9762\u5012\u3001\u63a8\u8ad6\u901f\u5ea6\u304c\u4e2d\u7a0b\u5ea6 \u7279\u306b\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3001\u30c1\u30e3\u30fc\u30c8\u3001UI \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3001\u30dd\u30b9\u30bf\u30fc\u3001\u304a\u3088\u3073\u305d\u306e\u4ed6\u306e\u30ea\u30c3\u30c1\u30c6\u30ad\u30b9\u30c8 \u30c7\u30fc\u30bf (\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u753b\u50cf\u3001UI \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u3001\u307e\u305f\u306f\u753b\u50cf\u5185\u306e\u6b63\u78ba\u306a\u30c6\u30ad\u30b9\u30c8\u8a8d\u8b58\u3092\u5fc5\u8981\u3068\u3059\u308b\u30b7\u30ca\u30ea\u30aa\u3092\u751f\u6210\u3059\u308b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30e2\u30c7\u30eb\u306a\u3069) \u5411\u3051 <p>\u88dc\u8db3: 3 \u3064\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u4e3b\u306a\u9055\u3044\u306f\u3001\u300c\u30d3\u30b8\u30e5\u30a2\u30eb \u30e2\u30b8\u30e5\u30fc\u30eb\u304c\u8a00\u8a9e\u30e2\u30b8\u30e5\u30fc\u30eb\u306b\u3069\u306e\u3088\u3046\u306b\u63a5\u7d9a\u3055\u308c\u308b\u304b\u300d\u306b\u3042\u308a\u307e\u3059\u3002Q-Former \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306f\u3001\u5c02\u7528\u306e Q-Former \u30e2\u30b8\u30e5\u30fc\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3001\u8efd\u91cf\u8a00\u8a9e\u30e2\u30c7\u30eb\u306b\u5165\u529b\u3059\u308b\u524d\u306b\u8996\u899a\u7279\u5fb4\u3092\u8a00\u8a9e\u304c\u7406\u89e3\u3067\u304d\u308b\u30d9\u30af\u30c8\u30eb\u306b\u5909\u63db\u3057\u307e\u3059\u3002 MLP \u30d7\u30ed\u30b8\u30a7\u30af\u30b7\u30e7\u30f3 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306f\u3001\u591a\u5c64\u30d1\u30fc\u30bb\u30d7\u30c8\u30ed\u30f3 (MLP) \u3092\u4f7f\u7528\u3057\u3066\u8996\u899a\u7684\u7279\u5fb4\u3092\u8a00\u8a9e\u30e2\u30c7\u30ebEmbedding\u7a7a\u9593\u306b\u6295\u5f71\u3057\u3001\u5927\u898f\u6a21\u306a\u8a00\u8a9e\u30e2\u30c7\u30eb\u3068\u6df1\u304f\u7d71\u5408\u3057\u307e\u3059\u3002\u30d3\u30b8\u30e7\u30f3\u30d5\u30a1\u30fc\u30b9\u30c8\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306f\u3001\u30d3\u30b8\u30e5\u30a2\u30eb\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u89e3\u50cf\u5ea6\u3068\u8a8d\u8b58\u80fd\u529b\u3092\u5f37\u5316\u3057\u3001\u8a00\u8a9e\u30e2\u30b8\u30e5\u30fc\u30eb\u306e\u5197\u9577\u8a08\u7b97\u3092\u5f31\u3081\u3001\u300c\u30d3\u30b8\u30e7\u30f3\u30d5\u30a1\u30fc\u30b9\u30c8\u300d\u3092\u512a\u5148\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_2_recaptioning/#722","title":"7.2.2 \u5373\u6642\u6226\u7565: \u7c92\u5ea6\u306e\u5236\u5fa1","text":"<p>\u30d7\u30ed\u30f3\u30d7\u30c8 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306f\u3001\u300c\u5408\u6210\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 \u30d5\u30a1\u30af\u30c8\u30ea\u30fc\u300d\u306e\u300c\u30b3\u30a2 \u30b3\u30f3\u30c8\u30ed\u30fc\u30e9\u30fc\u300d\u3067\u3059\u3002\u540c\u3058 VLM \u304c\u3001\u7570\u306a\u308b\u30d7\u30ed\u30f3\u30d7\u30c8 \u30ac\u30a4\u30c0\u30f3\u30b9\u306e\u4e0b\u3067\u3001\u5b8c\u5168\u306b\u7570\u306a\u308b\u30c7\u30fc\u30bf\u5206\u5e03 (\u8aac\u660e\u306e\u9577\u3055\u3001\u8a73\u7d30\u306e\u8c4a\u5bcc\u3055\u3001\u30b9\u30bf\u30a4\u30eb) \u3092\u751f\u6210\u3057\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u7279\u5b9a\u306e\u4e0b\u6d41\u30bf\u30b9\u30af\u8981\u4ef6\u306b\u57fa\u3065\u3044\u3066\u968e\u5c64\u5316\u3055\u308c\u305f\u30d7\u30ed\u30f3\u30d7\u30c8\u6226\u7565\u3092\u8a2d\u8a08\u3057\u3001\u751f\u6210\u3055\u308c\u305f\u8aac\u660e\u304c\u30bf\u30b9\u30af\u306e\u30cb\u30fc\u30ba\u306b\u5b8c\u5168\u306b\u4e00\u81f4\u3059\u308b\u3088\u3046\u306b\u8aac\u660e\u306e\u7c92\u5ea6\u3092\u6b63\u78ba\u306b\u5236\u5fa1\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u57fa\u672c\u539f\u5247: \u30d7\u30ed\u30f3\u30d7\u30c8\u8a2d\u8a08\u3067\u306f\u3001\u300c\u30bf\u30b9\u30af\u306e\u6307\u793a\u300d\u3001\u300c\u8aac\u660e\u306e\u7bc4\u56f2\u300d\u3001\u304a\u3088\u3073\u300c\u7c92\u5ea6\u306e\u8981\u4ef6\u300d\u3092\u660e\u78ba\u306b\u6307\u5b9a\u3057\u3001\u66d6\u6627\u306a\u8868\u73fe\u3092\u907f\u3051\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 (\u305f\u3068\u3048\u3070\u3001\u300c\u3053\u306e\u30a4\u30e1\u30fc\u30b8\u3092\u8aac\u660e\u3059\u308b\u300d\u3060\u3051\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u30e2\u30c7\u30eb\u306e\u51fa\u529b\u304c\u4e0d\u5b89\u5b9a\u306b\u306a\u308a\u307e\u3059)\u3002\u4e00\u65b9\u3001\u300c\u5236\u7d04\u300d\uff08\u300c\u5358\u8a9e\u6570\u306f 20 \u8a9e\u4ee5\u4e0b\u300d\u3001\u300c\u4e3b\u8981\u306a\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u80cc\u666f\u3092\u5f37\u8abf\u8868\u793a\u300d\u306a\u3069\uff09\u3092\u8ffd\u52a0\u3059\u308b\u3068\u3001\u51fa\u529b\u54c1\u8cea\u3092\u3055\u3089\u306b\u6700\u9069\u5316\u3067\u304d\u307e\u3059\u3002</p> <p> \u56f3 7-1: \u8fc5\u901f\u306a\u6226\u7565\u306e\u6982\u8981\u3068\u8a73\u7d30</p> <p>\u56f3 7-1 \u306f\u30012 \u3064\u306e\u30b3\u30a2 \u30d7\u30ed\u30f3\u30d7\u30c8 \u30b9\u30c8\u30e9\u30c6\u30b8\u30fc\u306e\u51fa\u529b\u306e\u9055\u3044\u3092\u76f4\u611f\u7684\u306b\u6bd4\u8f03\u3057\u3066\u3044\u307e\u3059\u3002\u77ed\u3044\u30d7\u30ed\u30f3\u30d7\u30c8\u306f\u3001\u30b3\u30a2 \u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u30b7\u30fc\u30f3\u306e\u307f\u3092\u542b\u3080\u7c21\u6f54\u306a\u8aac\u660e\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u8a73\u7d30\u30d7\u30ed\u30f3\u30d7\u30c8\u306f\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5f62\u72b6\u3001\u7167\u660e\u3001\u8272\u3001\u7a7a\u9593\u95a2\u4fc2\u306a\u3069\u3092\u542b\u3080\u8c4a\u5bcc\u306a\u8a73\u7d30\u60c5\u5831\u3092\u542b\u3080\u8aac\u660e\u3092\u751f\u6210\u3057\u307e\u3059\u30022 \u3064\u306e\u6226\u7565\u306f\u3001\u305d\u308c\u305e\u308c\u7570\u306a\u308b\u4e0b\u6d41\u30bf\u30b9\u30af\u306b\u9069\u5fdc\u3057\u307e\u3059\u3002</p> <p>\u4ee5\u4e0b\u306b\u3001\u6700\u3082\u4e00\u822c\u7684\u306b\u4f7f\u7528\u3055\u308c\u308b 2 \u3064\u306e\u968e\u5c64\u5316\u30d7\u30ed\u30f3\u30d7\u30c8\u6226\u7565\u3092\u793a\u3057\u307e\u3059\u3002\u5b9f\u969b\u306e\u30cb\u30fc\u30ba\u306b\u57fa\u3065\u3044\u3066\u67d4\u8edf\u306b\u8abf\u6574\u3059\u308b\u304b\u3001\u3053\u308c\u306b\u57fa\u3065\u3044\u3066\u4e2d\u7c92\u5ea6\u306e\u30d7\u30ed\u30f3\u30d7\u30c8\u6226\u7565\u3092\u8a2d\u8a08\u3057\u307e\u3059\u3002</p> <p>\u6226\u7565 1: \u7c21\u5358\u306a\u8aac\u660e (\u7c21\u5358\u306a\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3) * \u30d7\u30ed\u30f3\u30d7\u30c8: \u300c\u3053\u306e\u753b\u50cf\u3092\u4e00\u6587\u3067\u7c21\u6f54\u306b\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u300d   \u88dc\u8db3\u7684\u306a\u6700\u9069\u5316\u30d7\u30ed\u30f3\u30d7\u30c8 (\u5b89\u5b9a\u6027\u306e\u305f\u3081): \u300c\u3053\u306e\u753b\u50cf\u3092 1 \u6587\u3067\u7c21\u6f54\u306b\u8aac\u660e\u3057\u3001\u4e3b\u8981\u306a\u88ab\u5199\u4f53\u3068\u91cd\u8981\u306a\u80cc\u666f\u306e\u307f\u306b\u7126\u70b9\u3092\u5f53\u3066\u3001\u5197\u9577\u306a\u8a73\u7d30\u306f\u542b\u307e\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\u300d * \u76ee\u7684: CLIP \u30b9\u30bf\u30a4\u30eb\u306e\u30c7\u30e5\u30a2\u30eb\u30bf\u30ef\u30fc \u30e2\u30c7\u30eb (\u30d3\u30b8\u30e7\u30f3 \u30c6\u30ad\u30b9\u30c8 \u30c7\u30e5\u30a2\u30eb\u30bf\u30ef\u30fc \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3) \u306e\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u9577\u5236\u9650\u306b\u9069\u5fdc\u3057\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u30e2\u30c7\u30eb\u3067\u306f\u901a\u5e38\u3001\u30c6\u30ad\u30b9\u30c8\u5165\u529b\u304c 77 \u30c8\u30fc\u30af\u30f3\u4ee5\u4e0b\u306b\u5236\u9650\u3055\u308c\u307e\u3059\u3002\u904e\u5ea6\u306b\u9577\u3044\u8aac\u660e\u306f\u5207\u308a\u6368\u3066\u3089\u308c\u308b\u305f\u3081\u3001\u6b63\u5e38\u306a\u5b66\u7fd2\u304c\u59a8\u3052\u3089\u308c\u307e\u3059\u3002\u53b3\u5bc6\u306a\u8a18\u8ff0\u9577\u8981\u4ef6\u304c\u3042\u308b\u30b7\u30ca\u30ea\u30aa (\u753b\u50cf\u306e\u691c\u7d22\u3001\u8fc5\u901f\u306a\u6ce8\u91c8\u306a\u3069) \u306b\u3082\u9069\u3057\u3066\u3044\u307e\u3059\u3002 * \u671f\u5f85\u3055\u308c\u308b\u51fa\u529b: \u300c\u30a8\u30c3\u30d5\u30a7\u30eb\u5854\u8fd1\u304f\u306e\u829d\u751f\u306e\u4e0a\u3092\u8d70\u308b\u30b4\u30fc\u30eb\u30c7\u30f3\u30ec\u30c8\u30ea\u30d0\u30fc\u300d\u3002   \u51fa\u529b\u7279\u6027: \u9577\u3055\u306f 10 \uff5e 20 \u30ef\u30fc\u30c9\u306b\u5236\u5fa1\u3055\u308c\u3001\u4e2d\u5fc3\u3068\u306a\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8 (\u30b4\u30fc\u30eb\u30c7\u30f3 \u30ec\u30c8\u30ea\u30d0\u30fc) \u306e\u307f\u3001\u30ad\u30fc \u30a2\u30af\u30b7\u30e7\u30f3 (\u8d70\u308b)\u3001\u4e2d\u5fc3\u3068\u306a\u308b\u80cc\u666f (\u30a8\u30c3\u30d5\u30a7\u30eb\u5854\u3001\u8349)\u3001\u4f59\u5206\u306a\u8a73\u7d30\u306f\u306a\u304f\u3001\u7c21\u6f54\u304b\u3064\u660e\u78ba\u3067\u3059\u3002</p> <p>\u6226\u7565 2: \u8a73\u7d30\u306a\u8aac\u660e (\u8a73\u7d30\u306a\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3) * \u30d7\u30ed\u30f3\u30d7\u30c8: \u300c\u3053\u306e\u753b\u50cf\u3092\u8a73\u7d30\u306b\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u4e3b\u8981\u306a\u4e3b\u984c\u304b\u3089\u59cb\u3081\u3066\u3001\u80cc\u666f\u3001\u7167\u660e\u3001\u8272\u3001\u82b8\u8853\u7684\u306a\u30b9\u30bf\u30a4\u30eb\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u9593\u306e\u5177\u4f53\u7684\u306a\u76f8\u4e92\u4f5c\u7528\u306b\u3064\u3044\u3066\u3082\u8a00\u53ca\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u300d   \u88dc\u8db3\u7684\u306a\u6700\u9069\u5316\u30d7\u30ed\u30f3\u30d7\u30c8 (\u3088\u308a\u8a73\u7d30\u306a\u30ad\u30e3\u30d7\u30c1\u30e3\u306e\u305f\u3081): \u300c\u3053\u306e\u753b\u50cf\u3092\u8a73\u7d30\u306b\u8aac\u660e\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u307e\u305a\u3001\u4e3b\u8981\u306a\u88ab\u5199\u4f53\u306e\u5916\u89b3 (\u5f62\u72b6\u3001\u8272\u3001\u30c6\u30af\u30b9\u30c1\u30e3)\u3001\u6b21\u306b\u80cc\u666f\u30b7\u30fc\u30f3\u3001\u7167\u660e\u52b9\u679c (\u660e\u308b\u3055\u3001\u8272\u6e29\u5ea6)\u3001\u30ab\u30e9\u30fc \u30de\u30c3\u30c1\u30f3\u30b0\u3001\u304a\u3088\u3073\u82b8\u8853\u7684\u30b9\u30bf\u30a4\u30eb\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002\u6700\u5f8c\u306b\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u9593\u306e\u76f8\u4e92\u4f5c\u7528\u3068\u753b\u50cf\u5168\u4f53\u306e\u96f0\u56f2\u6c17\u306b\u3064\u3044\u3066\u8a00\u53ca\u3057\u307e\u3059\u3002\u300d * \u76ee\u7684: GenAI \u30e2\u30c7\u30eb \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 (Sora\u3001SD3\u3001Ideogram \u306a\u3069) \u306b\u9069\u5fdc\u3057\u307e\u3059\u3002\u3053\u306e\u3088\u3046\u306a\u30e2\u30c7\u30eb\u3067\u306f\u3001\u9ad8\u7cbe\u5ea6\u3067\u547d\u4ee4\u306b\u6e96\u62e0\u3057\u305f\u753b\u50cf\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306b\u3001\u753b\u50cf\u306e\u8a73\u7d30\u306a\u7279\u5fb4\u3001\u8ad6\u7406\u7684\u95a2\u4fc2\u3001\u30b7\u30fc\u30f3\u306e\u96f0\u56f2\u6c17\u3092\u5b66\u7fd2\u3059\u308b\u305f\u3081\u306e\u8a73\u7d30\u306a\u8a18\u8ff0\u304c\u5fc5\u8981\u3067\u3059\u3002\u6b63\u78ba\u306a\u30d3\u30b8\u30e5\u30a2\u30eb\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u4f4d\u7f6e\u5408\u308f\u305b\u304c\u5fc5\u8981\u306a\u30b7\u30ca\u30ea\u30aa (\u30d3\u30b8\u30e5\u30a2\u30eb QA\u3001\u753b\u50cf\u7de8\u96c6\u306a\u3069) \u306b\u3082\u9069\u3057\u3066\u3044\u307e\u3059\u3002 * \u671f\u5f85\u3055\u308c\u308b\u51fa\u529b: \u300c\u7dd1\u306e\u829d\u751f\u306e\u4e0a\u3092\u697d\u3057\u305d\u3046\u306b\u8d70\u308b\u3075\u308f\u3075\u308f\u306e\u30b4\u30fc\u30eb\u30c7\u30f3\u30ec\u30c8\u30ea\u30d0\u30fc\u306e\u30c0\u30a4\u30ca\u30df\u30c3\u30af\u306a\u5e83\u89d2\u30b7\u30e7\u30c3\u30c8\u3002\u72ac\u306e\u6bdb\u76ae\u306f\u5915\u65e5\u306e\u6696\u304b\u3044\u91d1\u8272\u306e\u5149\u306b\u7167\u3089\u3055\u308c\u3001\u8584\u8336\u8272\u306e\u6bdb\u675f\u304c\u65e5\u5149\u306e\u4e2d\u3067\u8f1d\u3044\u3066\u3044\u307e\u3059\u3002\u8d70\u308b\u3068\u304d\u8033\u306f\u5f8c\u308d\u306b\u4e0b\u304c\u308a\u3001\u5c3b\u5c3e\u306f\u9ad8\u304f\u4e0a\u304c\u3063\u3066\u5e78\u305b\u306a\u6c17\u5206\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u307c\u3084\u3051\u305f\u80cc\u666f\u306e\u4e2d\u3067\u3001\u30a8\u30c3\u30d5\u30a7\u30eb\u5854\u306e\u8c61\u5fb4\u7684\u306a\u9244\u306e\u683c\u5b50\u69cb\u9020\u304c\u7d2b\u8272\u306e\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u7a7a\u306b\u305d\u3073\u3048\u7acb\u3063\u3066\u3044\u307e\u3059\u3002\u829d\u751f\u306b\u306f\u5c0f\u3055\u306a\u30b7\u30ed\u30c4\u30e1\u30af\u30b5\u306e\u82b1\u304c\u70b9\u5728\u3057\u3066\u304a\u308a\u3001\u72ac\u306b\u30bd\u30d5\u30c8\u306a\u7126\u70b9\u3092\u5f53\u3066\u3001\u4e3b\u8981\u306a\u88ab\u5199\u4f53\u3092\u5f37\u8abf\u3059\u308b\u307c\u304b\u3057\u305f\u80cc\u666f\u306b\u3088\u308a\u3001\u753b\u50cf\u5168\u4f53\u306e\u96f0\u56f2\u6c17\u306f\u6696\u304b\u304f\u6d3b\u6c17\u306b\u6e80\u3061\u3066\u3044\u307e\u3059\u3002\u300d   \u51fa\u529b\u7279\u6027: \u9577\u3055\u306f\u901a\u5e38 50 \uff5e 200 \u30ef\u30fc\u30c9\u3067\u3001\u6838\u3068\u306a\u308b\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u8a73\u7d30\u3001\u80cc\u666f\u30b7\u30fc\u30f3\u3001\u7167\u660e\u3001\u8272\u3001\u82b8\u8853\u7684\u30b9\u30bf\u30a4\u30eb\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3\u3001\u5168\u4f53\u7684\u306a\u96f0\u56f2\u6c17\u3092\u30ab\u30d0\u30fc\u3057\u3001\u8a73\u7d30\u304c\u8c4a\u5bcc\u3067\u3001\u30d3\u30b8\u30e5\u30a2\u30eb \u30c6\u30ad\u30b9\u30c8\u306e\u4f4d\u7f6e\u5408\u308f\u305b\u306e\u7cbe\u5ea6\u304c\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>\u88dc\u8db3: \u4e0a\u8a18\u306e 2 \u3064\u306e\u6226\u7565\u306b\u52a0\u3048\u3066\u3001\u8aac\u660e\u306e\u95a2\u9023\u6027\u3092\u3055\u3089\u306b\u9ad8\u3081\u308b\u305f\u3081\u306b\u3001\u305f\u3068\u3048\u3070\u3001\u96fb\u5b50\u5546\u53d6\u5f15\u753b\u50cf (\u300c\u88fd\u54c1\u306e\u5916\u89b3\u3001\u8272\u3001\u30b5\u30a4\u30ba\u3001\u8cea\u611f\u3001\u914d\u7f6e\u306b\u7126\u70b9\u3092\u5f53\u3066\u3001\u96fb\u5b50\u5546\u53d6\u5f15\u306e\u30d7\u30ed\u30e2\u30fc\u30b7\u30e7\u30f3\u306b\u9069\u3057\u305f\u3053\u306e\u5546\u54c1\u753b\u50cf\u3092\u8a73\u7d30\u306b\u8aac\u660e\u3057\u307e\u3059\u300d) \u3084\u6587\u66f8\u753b\u50cf (\u300c\u30c6\u30ad\u30b9\u30c8\u306e\u5185\u5bb9\u3001\u30ec\u30a4\u30a2\u30a6\u30c8\u3001\u30d5\u30a9\u30f3\u30c8 \u30b9\u30bf\u30a4\u30eb\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u8272\u3092\u542b\u3081\u3066\u3001\u3053\u306e\u6587\u66f8\u753b\u50cf\u3092\u8a73\u7d30\u306b\u8aac\u660e\u3057\u307e\u3059\u300d) \u306b\u3064\u3044\u3066\u306f\u3001\u300c\u30bf\u30b9\u30af\u6307\u5411\u30d7\u30ed\u30f3\u30d7\u30c8\u300d\u3092\u8a2d\u8a08\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_2_recaptioning/#723-vllm","title":"7.2.3 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5: vLLM \u3092\u4f7f\u7528\u3057\u305f\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u63a8\u8ad6\u30b5\u30fc\u30d3\u30b9\u306e\u69cb\u7bc9","text":"<p>\u5927\u898f\u6a21\u306a\u30c7\u30fc\u30bf\u306e\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 (10 \u5104\u898f\u6a21\u306e\u753b\u50cf\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u51e6\u7406\u306a\u3069) \u306e\u5834\u5408\u3001\u901a\u5e38\u306e HuggingFace <code>generate()</code> \u3067\u306f\u306f\u308b\u304b\u306b\u4e0d\u5341\u5206\u3067\u3059\u3002\u63a8\u8ad6\u304c\u9045\u304f\u3001\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u304c\u4f4e\u304f\u3001GPU \u30ea\u30bd\u30fc\u30b9\u3092\u52b9\u7387\u7684\u306b\u5229\u7528\u3067\u304d\u307e\u305b\u3093\u3002 1 \u3064\u306e GPU \u3067\u51e6\u7406\u3067\u304d\u308b\u753b\u50cf\u306f 1 \u65e5\u306b\u6570\u5343\u679a\u307e\u3067\u3067\u3059\u3002\u5927\u898f\u6a21\u306a\u51e6\u7406\u306b\u306f\u3001\u304b\u306a\u308a\u306e\u6642\u9593\u3068\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306e\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308a\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u5c02\u7528\u306e\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u63a8\u8ad6\u30a8\u30f3\u30b8\u30f3\u3067\u3042\u308b vLLM \u304c\u5fc5\u8981\u3067\u3059\u3002vLLM \u306f\u3001VLM \u63a8\u8ad6\u306e\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092 3 \uff5e 5 \u500d\u5411\u4e0a\u3055\u305b\u306a\u304c\u3089\u3001GPU VRAM \u306e\u4f7f\u7528\u91cf\u3092\u524a\u6e1b\u3057\u3001\u52b9\u7387\u7684\u3067\u5927\u898f\u6a21\u306a\u753b\u50cf\u306e\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3092\u5b9f\u73fe\u3067\u304d\u308b 2 \u3064\u306e\u30b3\u30a2\u6700\u9069\u5316\u624b\u6cd5\u3067\u3042\u308b PagedAttendance \u3068 Continuous Batching \u3092\u30b5\u30dd\u30fc\u30c8\u3057\u307e\u3059\u3002</p> <p>vLLM \u306f\u3001\u30ab\u30ea\u30d5\u30a9\u30eb\u30cb\u30a2\u5927\u5b66\u30d0\u30fc\u30af\u30ec\u30fc\u6821\u306e\u7814\u7a76\u30c1\u30fc\u30e0\u306b\u3088\u3063\u3066\u958b\u767a\u3055\u308c\u305f\u9ad8\u52b9\u7387\u306e\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u63a8\u8ad6\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u3002\u4e3b\u306a\u5229\u70b9\u306f\u300c\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3001\u4f4e\u9045\u5ef6\u3001\u9ad8\u3044 GPU \u4f7f\u7528\u7387\u300d\u3067\u3001HuggingFace \u3068\u4e92\u63db\u6027\u306e\u3042\u308b API \u30a4\u30f3\u30bf\u30fc\u30d5\u30a7\u30a4\u30b9\u3068\u6700\u5c0f\u9650\u306e\u79fb\u884c\u30b3\u30b9\u30c8\u3092\u5099\u3048\u305f LLaVA\u3001CogVLM\u3001\u304a\u3088\u3073\u305d\u306e\u4ed6\u306e\u4e3b\u6d41 VLM \u306e\u5c0e\u5165\u306b\u6700\u9069\u3067\u3059\u3002</p> <p>\u4ee5\u4e0b\u306f\u3001\u30e2\u30c7\u30eb\u306e\u521d\u671f\u5316\u3001\u30d7\u30ed\u30f3\u30d7\u30c8 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u8a2d\u8a08\u3001\u30d0\u30c3\u30c1\u51e6\u7406\u3001\u51fa\u529b\u62bd\u51fa\u3092\u542b\u3080\u3001\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u753b\u50cf\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3092\u76ee\u7684\u3068\u3057\u305f vLLM \u3092\u4f7f\u7528\u3057\u3066 LLaVA-1_5-7b-hf \u3092\u5c55\u958b\u3059\u308b\u305f\u3081\u306e\u30b3\u30a2 \u30b3\u30fc\u30c9\u3067\u3059\u3002\u4e3b\u8981\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u89e3\u91c8\u3068\u6700\u9069\u5316\u306e\u30d2\u30f3\u30c8\u3092\u542b\u3080\u5b8c\u5168\u306a\u30ef\u30fc\u30af\u30d5\u30ed\u30fc\u3067\u3059\u3002</p> <p></p><pre><code>from vllm import LLM, SamplingParams\nfrom PIL import Image\nimport os\nfrom tqdm import tqdm  # For displaying batch processing progress\n\n# Initialize vLLM inference engine\n# tensor_parallel_size=4: Use 4 GPUs for tensor parallelism, for large models (7B/13B) deployment, adjust based on GPU count (1, 2, 4, 8)\n# Note: Tensor parallelism requires multiple same-model GPUs with NVLink support for faster data transfer\n# trust_remote_code=True: Allow loading LLaVA custom code (e.g., vision-language fusion module), as LLaVA architecture is non-standard HuggingFace\n# model: Model name from HuggingFace Hub (e.g., llava-hf/llava-1_5-7b-hf, llava-hf/llava-1_5-13b-hf)\n# gpu_memory_utilization=0_9: Set GPU VRAM utilization to 90%, balance throughput and stability, avoid OOM\nllm = LLM(\n    model=\"llava-hf/llava-1_5-7b-hf\",\n    tensor_parallel_size=4,\n    trust_remote_code=True,\n    gpu_memory_utilization=0_9\n)\n\n# Define Prompt template (LLaVA requires specific dialogue format, otherwise affects instruction following)\n# Tip: Adding \"Analyze the image\" in Prompt often works better than \"Describe the image\"\n# because \"Analyze\" guides model to observe image details more carefully, reducing perfunctory descriptions\n# Here using detailed description template, can replace with brief description template as needed\nprompt_template = \"USER: &lt;image&gt;\\nAnalyze this image and describe it in extreme detail. Start with the main subject, then describe the background, lighting, colors, and artistic style. Mention any specific interactions between objects. ASSISTANT:\"\n\n# Configure sampling parameters for description quality and stability\n# temperature=0_2: Lower randomness (0-1 range), lower temperature = more stable, image-fitting descriptions, fewer hallucinations\n# For more diverse descriptions, adjust to 0_5-0_7; if too high (&gt;0_8), likely to produce image-unrelated hallucinations\n# max_tokens=256: Limit output length, prevent overly verbose descriptions\n# top_p=0_95: Nucleus sampling, keep only tokens with cumulative probability to 95%, further reduce hallucination risk\nsampling_params = SamplingParams(\n    temperature=0_2,\n    max_tokens=256,\n    top_p=0_95\n)\n\ndef load_image_batch(image_dir, batch_size=32):\n    \"\"\"\n    Batch load images for efficient processing\n    image_dir: Image folder path, all images in this folder\n    batch_size: Images per batch, adjust based on GPU VRAM (16, 32, 64), larger VRAM = larger batch_size\n    return: Batch image list (PIL.Image format) and corresponding image path list\n    \"\"\"\n    image_paths = [os.path.join(image_dir, f) for f in os.listdir(image_dir) if f.endswith(('jpg', 'png', 'jpeg'))]\n    image_batches = []\n    path_batches = []\n\n    # Load images in batches\n    for i in range(0, len(image_paths), batch_size):\n        batch_paths = image_paths[i:i+batch_size]\n        batch_images = []\n        for path in batch_paths:\n            try:\n                # Load image and convert to RGB (avoid model errors from grayscale/transparent images)\n                img = Image.open(path).convert('RGB')\n                batch_images.append(img)\n            except Exception as e:\n                print(f\"Failed to load image {path}: {e}\")\n                continue\n        if batch_images:  # Skip empty batches\n            image_batches.append(batch_images)\n            path_batches.append(batch_paths)\n    return image_batches, path_batches\n\ndef process_batch(image_batch):\n    \"\"\"\n    Process a batch of images, generate corresponding recaption text\n    image_batch: List[PIL.Image], batch image list\n    return: List[str], recaption text list for each image\n    \"\"\"\n    # Generate corresponding Prompt for each image\n    prompts = [prompt_template for _ in range(len(image_batch))]\n\n    # vLLM supports direct multi_modal_data input, no manual image format conversion needed\n    # This step is non-blocking; vLLM internally does Continuous Batching for efficient GPU utilization\n    # When one batch completes partially, immediately load next batch partial data to avoid GPU idle\n    outputs = llm.generate(\n        prompts, \n        sampling_params, \n        multi_modal_data={\"image\": image_batch}\n    )\n\n    # Extract generated description text, remove Prompt part, keep only model response\n    captions = []\n    for output in outputs:\n        # Extract content after ASSISTANT: as model-generated description\n        caption = output.outputs[0].text.strip().replace(\"ASSISTANT:\", \"\").strip()\n        captions.append(caption)\n    return captions\n\ndef save_captions(image_paths, captions, save_path):\n    \"\"\"\n    Save recaption text corresponding to image paths for subsequent use (e.g., model training)\n    image_paths: Image path list\n    captions: Recaption text list\n    save_path: Save file path (txt format)\n    \"\"\"\n    with open(save_path, 'w', encoding='utf-8') as f:\n        for path, cap in zip(image_paths, captions):\n            # Format: image_path\\trecaption_text, for easy reading and parsing\n            f.write(f\"{path}\\t{cap}\\n\")\n\n# Main function: batch process images and generate recaptions\nif __name__ == \"__main__\":\n    image_dir = \"path/to/your/image/directory\"  # Replace with your image folder path\n    save_path = \"recaption_results.txt\"        # Recaption results save path\n    batch_size = 32                            # Images per batch, adjust based on GPU VRAM\n\n    # Load image batches\n    image_batches, path_batches = load_image_batch(image_dir, batch_size)\n\n    # Batch process and save results\n    with open(save_path, 'w', encoding='utf-8') as f:\n        for img_batch, path_batch in tqdm(zip(image_batches, path_batches), total=len(image_batches)):\n            captions = process_batch(img_batch)\n            # Write current batch results\n            for path, cap in zip(path_batch, captions):\n                f.write(f\"{path}\\t{cap}\\n\")\n    print(f\"Recaptioning complete, results saved to {save_path}\")\n</code></pre> \u88dc\u8db3\u7684\u306a\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u6700\u9069\u5316\u306e\u30d2\u30f3\u30c8:<p></p> <ul> <li>\u753b\u50cf\u306e\u524d\u51e6\u7406: \u30d0\u30c3\u30c1\u8aad\u307f\u8fbc\u307f\u6642\u306b\u3001\u753b\u50cf\u30b5\u30a4\u30ba\u306e\u9055\u3044\u306b\u3088\u308b\u30e2\u30c7\u30eb\u63a8\u8ad6\u901f\u5ea6\u306e\u5909\u52d5\u3084 VRAM \u306e\u4e0d\u5b89\u5b9a\u6027\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001\u753b\u50cf\u306e\u30b5\u30a4\u30ba\u3092\u5747\u4e00\u306b\u5909\u66f4\u3057\u307e\u3059 (\u4f8b: 224\u00d7224 \u307e\u305f\u306f 448\u00d7448)\u3002\u753b\u50cf\u3092\u6b63\u898f\u5316\u3057\u3066\u8a18\u8ff0\u7cbe\u5ea6\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</li> <li>\u30a8\u30e9\u30fc\u51e6\u7406: \u30d0\u30c3\u30c1\u51e6\u7406\u306e\u4e2d\u65ad\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001\u753b\u50cf\u306e\u8aad\u307f\u8fbc\u307f\u5931\u6557\u3068\u30e2\u30c7\u30eb\u63a8\u8ad6\u306e\u5931\u6557\u306b\u5bfe\u3059\u308b\u4f8b\u5916\u51e6\u7406\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u5931\u6557\u3057\u305f\u30a4\u30e1\u30fc\u30b8\u306e\u5834\u5408\u306f\u3001\u30d1\u30b9\u3092\u8a18\u9332\u3057\u3001\u500b\u5225\u306b\u51e6\u7406\u3057\u307e\u3059\u3002</li> <li>\u30cf\u30fc\u30c9\u30a6\u30a7\u30a2\u306e\u6700\u9069\u5316: \u5c0e\u5165\u306b\u306f NVIDIA A100\u3001A800 \u3092\u63a8\u5968\u3057\u307e\u3059\u3002 VRAM \u5c11\u306a\u304f\u3068\u3082 24GB (7B \u30e2\u30c7\u30eb);\u975e\u5e38\u306b\u5927\u898f\u6a21\u306a\u5834\u5408\u306f\u3001GPU \u30af\u30e9\u30b9\u30bf\u30fc\u3068 vLLM \u5206\u6563\u63a8\u8ad6\u3092\u4f7f\u7528\u3057\u3066\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u3092\u9ad8\u3081\u307e\u3059\u3002</li> <li>\u30d7\u30ed\u30f3\u30d7\u30c8 \u30ad\u30e3\u30c3\u30b7\u30e5: \u540c\u3058\u30bf\u30a4\u30d7\u306e\u753b\u50cf (\u30d0\u30c3\u30c1\u96fb\u5b50\u5546\u53d6\u5f15\u30dd\u30b9\u30bf\u30fc\u306a\u3069) \u306e\u5834\u5408\u3001\u30d7\u30ed\u30f3\u30d7\u30c8 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u3066\u3001\u7e70\u308a\u8fd4\u3057\u751f\u6210\u3092\u56de\u907f\u3057\u3001\u51e6\u7406\u901f\u5ea6\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part3/3_2_recaptioning/#73-ocr","title":"7.3 OCR \u62e1\u5f35: \u753b\u50cf\u304b\u3089\u306e\u30c6\u30ad\u30b9\u30c8\u306e\u62bd\u51fa\u3068\u878d\u5408","text":"<p>\u901a\u5e38\u306e VLM \u306f\u3042\u308b\u7a0b\u5ea6\u306e\u8996\u899a\u7684\u7406\u89e3\u3092\u6301\u3061\u3001\u753b\u50cf\u5185\u306e\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3001\u30b7\u30fc\u30f3\u3001\u5358\u7d14\u306a\u30c6\u30ad\u30b9\u30c8\u3092\u8a8d\u8b58\u3067\u304d\u307e\u3059\u304c\u3001\u9ad8\u5bc6\u5ea6\u30c6\u30ad\u30b9\u30c8\u753b\u50cf (\u6587\u66f8\u3001\u30dd\u30b9\u30bf\u30fc\u3001\u30b0\u30e9\u30d5\u3001PDF \u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8) \u3067\u306f 2 \u3064\u306e\u4e3b\u8981\u306a\u554f\u984c\u306b\u76f4\u9762\u3057\u307e\u3059\u30021 \u3064\u306f\u30c6\u30ad\u30b9\u30c8\u8a8d\u8b58\u7cbe\u5ea6\u304c\u4f4e\u304f\u3001\u8aa4\u8a8d\u8b58\u3084\u7701\u7565\u304c\u8d77\u3053\u308a\u3084\u3059\u3044 (\u7279\u306b\u82b8\u8853\u7684\u306a\u30d5\u30a9\u30f3\u30c8\u3001\u307c\u3084\u3051\u305f\u30c6\u30ad\u30b9\u30c8)\u3002 2 \u3064\u76ee\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u3092\u8996\u899a\u8981\u7d20\u306b\u52b9\u679c\u7684\u306b\u95a2\u9023\u4ed8\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u8aac\u660e\u3067\u30c6\u30ad\u30b9\u30c8\u306e\u610f\u5473\u3084\u5f79\u5272\u304c\u7701\u7565\u3055\u308c\u3066\u3057\u307e\u3046\u3053\u3068\u3067\u3059\u3002</p> <p>\u305f\u3068\u3048\u3070\u3001\u300c\u30b5\u30de\u30fc \u30bb\u30fc\u30eb 50% \u30aa\u30d5\u300d\u3068\u3044\u3046\u5927\u304d\u306a\u30c6\u30ad\u30b9\u30c8\u3092\u542b\u3080\u96fb\u5b50\u5546\u53d6\u5f15\u30dd\u30b9\u30bf\u30fc\u306f\u3001\u901a\u5e38\u306e VLM \u304b\u3089\u306f\u300c\u8d64\u3044\u30d7\u30ed\u30e2\u30fc\u30b7\u30e7\u30f3 \u30dd\u30b9\u30bf\u30fc\u300d\u306e\u307f\u3092\u53d6\u5f97\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u306f\u5b8c\u5168\u306b\u7121\u8996\u3055\u308c\u307e\u3059\u3002\u6587\u5b57\u304c\u8a8d\u8b58\u3055\u308c\u3066\u3044\u3066\u3082\u300c\u30b5\u30de\u30fc\u30bb\u30fc\u30eb30\uff05\u30aa\u30d5\u300d\u306a\u3069\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3059\u308b\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u30c6\u30ad\u30b9\u30c8\u306f\u305d\u306e\u3088\u3046\u306a\u753b\u50cf\u3092\u8981\u7d04\u3059\u308b\u305f\u3081\u306b\u975e\u5e38\u306b\u91cd\u8981\u3067\u3042\u308a\u3001\u4e2d\u5fc3\u7684\u306a\u610f\u5473\u3068\u76ee\u7684\u3092\u76f4\u63a5\u6c7a\u5b9a\u3057\u307e\u3059\u3002</p> <p>\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u306f\u3001VLM \u306e\u300c\u5916\u90e8\u982d\u8133\u300d\u3068\u3057\u3066\u5c02\u7528\u306e OCR \u30a8\u30f3\u30b8\u30f3 (PaddleOCR\u3001Tesseract \u306a\u3069) \u3092\u5c0e\u5165\u3059\u308b\u3053\u3068\u3067\u3059\u3002 OCR \u3092\u4f7f\u7528\u3057\u3066\u753b\u50cf\u30c6\u30ad\u30b9\u30c8\u3092\u6b63\u78ba\u306b\u62bd\u51fa\u3057\u3001VLM \u30d7\u30ed\u30f3\u30d7\u30c8\u3068\u52d5\u7684\u306b\u878d\u5408\u3057\u3066\u3001VLM \u304c\u30c6\u30ad\u30b9\u30c8\u3092\u7d50\u5408\u3057\u3066\u3088\u308a\u6b63\u78ba\u3067\u30ea\u30c3\u30c1\u306a\u8aac\u660e\u3092\u751f\u6210\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304a\u3088\u3073\u30dd\u30b9\u30bf\u30fc\u30af\u30e9\u30b9\u306e\u30ea\u30c3\u30c1\u30c6\u30ad\u30b9\u30c8\u753b\u50cf\u306e\u518d\u73fe\u54c1\u8cea\u304c\u5927\u5e45\u306b\u5411\u4e0a\u3057\u307e\u3059\u3002</p> <p>OCR (\u5149\u5b66\u6587\u5b57\u8a8d\u8b58) \u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u306e\u4e2d\u6838\u306f\u3001\u753b\u50cf\u5185\u306e\u5370\u5237\u30c6\u30ad\u30b9\u30c8\u3084\u624b\u66f8\u304d\u30c6\u30ad\u30b9\u30c8\u3092\u7de8\u96c6\u53ef\u80fd\u306a\u30c6\u30ad\u30b9\u30c8\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u305d\u306e\u30c6\u30ad\u30b9\u30c8\u8a8d\u8b58\u7cbe\u5ea6\u306f\u3001\u7279\u306b\u9ad8\u5bc6\u5ea6\u30c6\u30ad\u30b9\u30c8\u3084\u8907\u96d1\u306a\u30d5\u30a9\u30f3\u30c8\u306e\u30b7\u30ca\u30ea\u30aa\u306b\u304a\u3044\u3066\u3001\u901a\u5e38\u306e VLM \u3092\u306f\u308b\u304b\u306b\u4e0a\u56de\u308a\u307e\u3059\u3002\u73fe\u5728\u3001\u6700\u3082\u5e83\u304f\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u7523\u696d\u7528\u3001\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u3001\u7121\u6599\u306e\u9ad8\u7cbe\u5ea6 OCR \u30a8\u30f3\u30b8\u30f3\u306f\u3001PaddleOCR (Baidu PaddlePaddle \u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 OCR) \u3067\u3059\u3002\u591a\u8a00\u8a9e\u3001\u30de\u30eb\u30c1\u30d5\u30a9\u30f3\u30c8\u3001\u307c\u3084\u3051\u305f\u30c6\u30ad\u30b9\u30c8\u8a8d\u8b58\u3001\u9ad8\u901f\u63a8\u8ad6\u3001\u30b7\u30f3\u30d7\u30eb\u306a\u5c0e\u5165\u3001GPU \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u30b5\u30dd\u30fc\u30c8\u3057\u3066\u304a\u308a\u3001VLM \u3068\u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u975e\u5e38\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002</p> <p> \u56f3 7-2: OCR \u62e1\u5f35\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3</p> <p>\u30c1\u30e3\u30fc\u30c8 \u30b3\u30a2\u306e\u89e3\u91c8: \u56f3 7-2 \u306f\u3001\u5b8c\u5168\u306a OCR \u62e1\u5f35 VLM \u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 \u30d5\u30ed\u30fc\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u30b3\u30a2\u306f\u300cOCR\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u2192\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u69cb\u7bc9\u2192\u30d7\u30ed\u30f3\u30d7\u30c8\u30d5\u30e5\u30fc\u30b8\u30e7\u30f3\u2192VLM\u8aac\u660e\u751f\u6210\u300d\u3067\u3001VLM\u306e\u30c6\u30ad\u30b9\u30c8\u8a8d\u8b58\u306e\u5f31\u70b9\u3092OCR\u3067\u88dc\u3044\u3001\u300c\u8996\u899a\u7684\u306a\u8a73\u7d30+\u30c6\u30ad\u30b9\u30c8\u60c5\u5831\u300d\u306e\u4e8c\u91cd\u7cbe\u5ea6\u306e\u8aac\u660e\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_2_recaptioning/#731-ocr","title":"7.3.1 OCR \u62e1\u5f35\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>OCR \u62e1\u5f35\u30b3\u30a2\u306f\u3001\u5358\u7d14\u306a\u9023\u7d50\u3067\u306f\u306a\u304f\u3001OCR \u3067\u62bd\u51fa\u3055\u308c\u305f\u30c6\u30ad\u30b9\u30c8\u3068 VLM \u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u6709\u6a5f\u7684\u306b\u878d\u5408\u3055\u305b\u307e\u3059\u3002\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u5168\u4f53\u306b\u306f 3 \u3064\u306e\u4e3b\u8981\u306a\u30b9\u30c6\u30c3\u30d7\u304c\u3042\u308a\u3001\u305d\u308c\u305e\u308c\u306b\u660e\u78ba\u306a\u6700\u9069\u5316\u306e\u65b9\u5411\u6027\u304c\u3042\u308a\u3001\u30c6\u30ad\u30b9\u30c8\u304c\u52b9\u679c\u7684\u306b\u8981\u7d04\u306e\u54c1\u8cea\u3092\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <ol> <li>\u691c\u51fa\u3068\u8a8d\u8b58: PaddleOCR \u3092\u4f7f\u7528\u3057\u3066\u751f\u753b\u50cf\u3092\u51e6\u7406\u3057\u307e\u3059\u3002\u6700\u521d\u306b\u3059\u3079\u3066\u306e\u30c6\u30ad\u30b9\u30c8\u9818\u57df (\u30c6\u30ad\u30b9\u30c8\u4f4d\u7f6e\u306e\u5883\u754c\u30dc\u30c3\u30af\u30b9) \u3092\u691c\u51fa\u3057\u3001\u6b21\u306b\u5404\u9818\u57df\u3092\u8a8d\u8b58\u3057\u3066\u3001\u8a8d\u8b58\u3055\u308c\u305f\u30c6\u30ad\u30b9\u30c8\u3068\u4fe1\u983c\u5ea6 (0 \uff5e 1\u3001\u9ad8\u3044 = \u3088\u308a\u6b63\u78ba) \u3092\u51fa\u529b\u3057\u307e\u3059\u3002\u4e3b\u306a\u76ee\u6a19: \u300c\u6b63\u78ba\u306a\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u3001\u8aa4\u3063\u305f\u8a8d\u8b58\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u300d - \u4fe1\u983c\u6027\u306e\u4f4e\u3044\u7d50\u679c\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u3066\u3001\u8aa4\u89e3\u3092\u62db\u304f VLM \u3092\u56de\u907f\u3057\u307e\u3059\u3002</li> <li>\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u69cb\u7bc9: \u3059\u3079\u3066\u306e\u6709\u52b9\u306a OCR \u30c6\u30ad\u30b9\u30c8 (\u4fe1\u983c\u6027\u306e\u4f4e\u3044\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u5f8c) \u3092\u5b9f\u969b\u306e\u753b\u50cf\u306e\u4f4d\u7f6e (\u4e0a\u304b\u3089\u4e0b\u3001\u5de6\u304b\u3089\u53f3\u3001\u5217\u9806\u306b\u8907\u6570\u5217) \u3067\u9023\u7d50\u3057\u3066\u3001\u4eba\u9593\u304c\u8aad\u3081\u308b\u30c6\u30ad\u30b9\u30c8 \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\u5fc5\u8981\u306b\u5fdc\u3058\u3066\u3001VLM \u304c\u968e\u5c64\u3068\u5f79\u5272\u3092\u7406\u89e3\u3067\u304d\u308b\u3088\u3046\u306b\u30c6\u30ad\u30b9\u30c8 (\u30bf\u30a4\u30c8\u30eb\u3001\u672c\u6587\u3001\u30dc\u30bf\u30f3\u306e\u30c6\u30ad\u30b9\u30c8\u306a\u3069) \u3092\u5206\u985e\u3057\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u30dd\u30b9\u30bf\u30fc \u30c6\u30ad\u30b9\u30c8\u300c\u30b5\u30de\u30fc \u30bb\u30fc\u30eb\u300d\uff08\u30bf\u30a4\u30c8\u30eb\uff09\u3001\u300c50% \u30aa\u30d5\u300d\uff08\u30b5\u30d6\u30bf\u30a4\u30c8\u30eb\uff09\u3001\u300c6 \u6708 1 \u65e5 - 6 \u6708 10 \u65e5\u300d\uff08\u6642\u9593\uff09\u306f\u3001\u30bf\u30a4\u30c8\u30eb/\u672c\u6587\u30e9\u30d9\u30eb\u3092\u4f7f\u7528\u3057\u3066\u300c\u30b5\u30de\u30fc \u30bb\u30fc\u30eb\u300150% \u30aa\u30d5\u30016 \u6708 1 \u65e5 - 6 \u6708 10 \u65e5\u300d\u306b\u9023\u7d50\u3055\u308c\u307e\u3059\u3002</li> <li>\u30d7\u30ed\u30f3\u30d7\u30c8 \u30d5\u30e5\u30fc\u30b8\u30e7\u30f3: \u69cb\u7bc9\u3055\u308c\u305f\u30c6\u30ad\u30b9\u30c8 \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092 VLM \u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u81ea\u7136\u306b\u7d71\u5408\u3057\u3001VLM \u306b\u300c\u753b\u50cf\u306b\u306f\u3053\u308c\u3089\u306e\u30c6\u30ad\u30b9\u30c8\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\u30c6\u30ad\u30b9\u30c8\u3068\u30d3\u30b8\u30e5\u30a2\u30eb\u8981\u7d20\u306e\u7d44\u307f\u5408\u308f\u305b\u3092\u8a18\u8ff0\u3057\u3066\u304f\u3060\u3055\u3044\u300d\u3068\u660e\u793a\u7684\u306b\u6307\u793a\u3057\u3001VLM \u304c\u30c6\u30ad\u30b9\u30c8\u3068\u30d3\u30b8\u30e5\u30a2\u30eb (\u4f4d\u7f6e\u3001\u8272\u3001\u30d5\u30a9\u30f3\u30c8 \u30b9\u30bf\u30a4\u30eb\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u610f\u5473\u3068\u30b7\u30fc\u30f3) \u3092\u95a2\u9023\u4ed8\u3051\u308b\u3088\u3046\u306b\u5c0e\u304d\u307e\u3059\u3002\u91cd\u8981\u306a\u306e\u306f\u3001\u300c\u81ea\u7136\u306a\u878d\u5408\u3001\u5197\u9577\u6027\u306e\u306a\u3044\u300d\u3053\u3068\u3067\u3059\u3002\u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u6700\u5f8c\u306b\u30c6\u30ad\u30b9\u30c8\u3092\u4e0d\u81ea\u7136\u306b\u8ffd\u52a0\u3057\u3066\u3001VLM \u304c\u8996\u899a\u7684\u306a\u8a73\u7d30\u3092\u7121\u8996\u3059\u308b\u3053\u3068\u3092\u907f\u3051\u307e\u3059\u3002</li> </ol> <p>\u88dc\u8db3\u4e8b\u9805: \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u6700\u9069\u5316\u306f\u300c\u4fe1\u983c\u6027\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u300d\u3068\u300c\u30d7\u30ed\u30f3\u30d7\u30c8 \u30d5\u30e5\u30fc\u30b8\u30e7\u30f3\u300d\u306b\u91cd\u70b9\u3092\u7f6e\u3044\u3066\u3044\u307e\u3059\u3002\u4fe1\u983c\u6027\u306e\u4f4e\u3044\u30c6\u30ad\u30b9\u30c8\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u306a\u3044\u3068\u3001\u9593\u9055\u3063\u305f\u30c6\u30ad\u30b9\u30c8\u304c VLM \u306e\u8aa4\u89e3\u3092\u62db\u304d\u307e\u3059\u3002\u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u878d\u5408\u304c\u304e\u3053\u3061\u306a\u3044\u5834\u5408\u3001VLM \u306f\u30c6\u30ad\u30b9\u30c8\u3068\u30d3\u30b8\u30e5\u30a2\u30eb\u3092\u5206\u96e2\u3057\u3001\u771f\u306e\u5f37\u5316\u3092\u5b9f\u73fe\u3067\u304d\u307e\u305b\u3093\u3002</p>"},{"location":"ja/part3/3_2_recaptioning/#732-ocr","title":"7.3.2 \u30b3\u30a2\u30b3\u30fc\u30c9: OCR \u7d50\u679c\u306e\u633f\u5165","text":"<p>\u4ee5\u4e0b\u306f\u3001PaddleOCR \u3092\u4f7f\u7528\u3057\u3066\u753b\u50cf\u30c6\u30ad\u30b9\u30c8\u3092\u62bd\u51fa\u3057\u3001VLM \u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u52d5\u7684\u306b\u878d\u5408\u3059\u308b\u305f\u3081\u306e\u30b3\u30a2 \u30b3\u30fc\u30c9\u3067\u3059\u3002 OCR \u3067\u5f37\u5316\u3055\u308c\u305f\u5927\u898f\u6a21\u306a\u753b\u50cf\u518d\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u306e\u305f\u3081\u306e\u30bb\u30af\u30b7\u30e7\u30f3 7.2.3 vLLM \u30d0\u30c3\u30c1\u51e6\u7406\u3068\u30b7\u30fc\u30e0\u30ec\u30b9\u306b\u7d71\u5408\u3067\u304d\u307e\u3059\u3002\u3053\u306e\u30b3\u30fc\u30c9\u306b\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u3001\u4fe1\u983c\u6027\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u69cb\u7bc9\u3001\u30d7\u30ed\u30f3\u30d7\u30c8\u878d\u5408\u306e\u305f\u3081\u306e\u5b8c\u5168\u306a\u30ed\u30b8\u30c3\u30af\u306b\u52a0\u3048\u3066\u3001\u4e3b\u8981\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u306e\u89e3\u91c8\u3068\u6700\u9069\u5316\u306e\u30d2\u30f3\u30c8\u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002</p> <pre><code>from paddleocr import PaddleOCR\nimport os\nfrom PIL import Image\n\n# Initialize OCR engine (recommend GPU for speed; set use_gpu=False if no GPU)\n# use_angle_cls=True: Enable text direction detection, supports tilted text (e.g., tilted poster, rotated documents) to avoid recognition errors\n# lang='en': English recognition; for Chinese set lang='ch'; supports Chinese-English mixed (lang='ch_en')\n# det_model_dir, rec_model_dir: Can specify OCR detection/recognition model paths; auto-download if not specified\n# gpu_mem=500: GPU VRAM limit (MB), adjust based on GPU\nocr = PaddleOCR(\n    use_angle_cls=True,\n    lang='en',\n    use_gpu=True,\n    gpu_mem=500)\n\ndef generate_ocr_enhanced_prompt(image_path, base_prompt=\"Describe this image in detail.\"):\n    \"\"\"\n    Generate OCR-enhanced VLM Prompt, integrating OCR-extracted text into Prompt\n    image_path: Raw image path\n    base_prompt: Base Prompt (e.g., brief/detailed description) as Prompt body\n    return: Complete OCR-enhanced Prompt; if no valid text, return base Prompt\n    \"\"\"\n    # Step 1: Run OCR, extract image text and confidence\n    # result is nested list: [[[[x1,y1], [x2,y2], [x3,y3], [x4,y4]], [text, confidence]], ...]\n    # [x1,y1]~[x4,y4] are Bounding Box coordinates (top-left, top-right, bottom-right, bottom-left)\n    # text is recognized content, confidence is recognition confidence\n    result = ocr.ocr(image_path, cls=True)\n\n    # Handle OCR result: if no text or empty, fall back to base Prompt\n    if not result or not result[0]:\n        return f\"USER: &lt;image&gt;\\n{base_prompt}\\nASSISTANT:\"\n\n    # Step 2: Extract valid text (filter low confidence), build text context\n    detected_texts = []\n    for line in result[0]:\n        text = line[1][0]  # Recognized text\n        confidence = line[1][1]  # Recognition confidence\n        # Filter results below 0_8 confidence (threshold adjustable, 0_7-0_9 based on image text clarity)\n        # Also filter empty text and meaningless garbage (e.g., symbols only, spaces)\n        if confidence &gt; 0_8 and text.strip() and len(text.strip()) &gt; 1:\n            detected_texts.append(text.strip())\n\n    # Build text context: concatenate by recognition order, comma-separated, human-readable\n    ocr_context = \", \".join(detected_texts)\n\n    # Step 3: Dynamically fuse OCR result with base Prompt, generate enhanced Prompt\n    # Key technique: Tell model \"I have detected these texts...\" so model knows this is image text\n    # and guide model to associate text with visuals (position, color, font, text meaning vs. scene)\n    if len(ocr_context) &gt; 10:  # Only enhance when text long enough (&gt;10 chars) to avoid redundancy\n        enhanced_prompt = (\n            f\"USER: &lt;image&gt;\\n\"\n            f\"I have detected these text segments in the image: '{ocr_context}'. \"\n            f\"Using this text as a reference, describe the image in detail, \"\n            f\"paying attention to how the text relates to the visual elements (such as the position, color, and font style of the text, \"\n            f\"and the connection between the text content and the image scene). {base_prompt}\\n\"\n            f\"ASSISTANT:\"\n        )\n        return enhanced_prompt\n    else:\n        # If text too short (1-2 words), don't enhance, avoid redundancy, fall back to base Prompt\n        return f\"USER: &lt;image&gt;\\n{base_prompt}\\nASSISTANT:\"\n\n# Test code: verify OCR-enhanced Prompt generation\nif __name__ == \"__main__\":\n    # Test image path (replace with your rich-text image, e.g., poster, document screenshot)\n    test_image_path = \"path/to/your/test/poster.jpg\"\n    # Base Prompt (detailed description template)\n    base_prompt = \"Describe this image in extreme detail. Start with the main subject, then describe the background, lighting, colors, and artistic style.\"\n    # Generate enhanced Prompt\n    enhanced_prompt = generate_ocr_enhanced_prompt(test_image_path, base_prompt)\n    print(\"OCR-enhanced Prompt:\")\n    print(enhanced_prompt)\n</code></pre> <p>\u88dc\u8db3\u7684\u306a\u6700\u9069\u5316\u306e\u30d2\u30f3\u30c8:</p> <ul> <li>\u4fe1\u983c\u3057\u304d\u3044\u5024\u306e\u8abf\u6574: \u30af\u30ea\u30a2\u30c6\u30ad\u30b9\u30c8\u753b\u50cf (HD \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3001\u6b63\u5f0f\u306a\u30dd\u30b9\u30bf\u30fc) \u306e\u5834\u5408\u306f\u30010_8 \uff5e 0_9 \u306b\u8abf\u6574\u3057\u3066\u3001\u3044\u304f\u3064\u304b\u306e\u30a8\u30e9\u30fc\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002\u307c\u3084\u3051\u305f\u8907\u96d1\u306a\u30d5\u30a9\u30f3\u30c8\u306e\u753b\u50cf (\u53e4\u3044\u30dd\u30b9\u30bf\u30fc\u3001\u624b\u66f8\u304d) \u306e\u5834\u5408\u306f\u3001\u6709\u52b9\u306a\u30c6\u30ad\u30b9\u30c8\u306e\u6b20\u843d\u3092\u907f\u3051\u308b\u305f\u3081\u306b 0_7 \uff5e 0_8 \u306b\u8abf\u6574\u3057\u307e\u3059\u3002</li> <li>\u30c6\u30ad\u30b9\u30c8 \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u6700\u9069\u5316: \u8907\u6570\u5217\u306e\u968e\u5c64\u30c6\u30ad\u30b9\u30c8 (\u30bf\u30a4\u30c8\u30eb\u3001\u672c\u6587\u3001\u811a\u6ce8) \u306e\u5834\u5408\u3001\u5883\u754c\u30dc\u30c3\u30af\u30b9\u5ea7\u6a19\u3092\u4f7f\u7528\u3057\u3066\u5206\u985e\u304a\u3088\u3073\u9023\u7d50\u3057\u307e\u3059 (\u4f8b: \u300c\u30bf\u30a4\u30c8\u30eb: \u30b5\u30de\u30fc \u30bb\u30fc\u30eb; \u672c\u6587: 50% \u30aa\u30d5\u30016 \u6708 1 \u65e5\u304b\u3089 6 \u6708 10 \u65e5\u307e\u3067; \u811a\u6ce8: \u6700\u7d42\u89e3\u91c8\u6a29\u306f\u7559\u4fdd\u300d)\u3002VLM \u30c6\u30ad\u30b9\u30c8\u968e\u5c64\u3092\u3088\u308a\u660e\u78ba\u306b\u7406\u89e3\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002</li> <li>\u30d7\u30ed\u30f3\u30d7\u30c8 \u30d5\u30e5\u30fc\u30b8\u30e7\u30f3\u306e\u6700\u9069\u5316: \u753b\u50cf\u30bf\u30a4\u30d7\u3054\u3068\u306b\u30d5\u30e5\u30fc\u30b8\u30e7\u30f3\u306e\u6587\u8a00\u3092\u8abf\u6574\u3057\u307e\u3059\u3002\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u753b\u50cf\u306b\u306f\u300c\u30c6\u30ad\u30b9\u30c8\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u3068\u30c6\u30ad\u30b9\u30c8\u3068\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u69cb\u9020\u306e\u95a2\u4fc2\u306e\u8aac\u660e\u300d\u304c\u8ffd\u52a0\u3055\u308c\u3001\u30dd\u30b9\u30bf\u30fc\u753b\u50cf\u306b\u306f\u300c\u30c6\u30ad\u30b9\u30c8\u306e\u30d5\u30a9\u30f3\u30c8 \u30b9\u30bf\u30a4\u30eb\u3068\u30d7\u30ed\u30e2\u30fc\u30b7\u30e7\u30f3 \u30b7\u30fc\u30f3\u306b\u304a\u3051\u308b\u30c6\u30ad\u30b9\u30c8\u306e\u5f79\u5272\u306e\u8aac\u660e\u300d\u304c\u8ffd\u52a0\u3055\u308c\u3001\u3088\u308a\u30bf\u30fc\u30b2\u30c3\u30c8\u3092\u7d5e\u3063\u305f\u8aac\u660e\u304c\u53ef\u80fd\u306b\u306a\u308a\u307e\u3059\u3002</li> <li>\u30de\u30eb\u30c1 OCR \u30a8\u30f3\u30b8\u30f3 \u30d5\u30e5\u30fc\u30b8\u30e7\u30f3: \u975e\u5e38\u306b\u9ad8\u3044\u7cbe\u5ea6\u304c\u5fc5\u8981\u306a\u5834\u5408\u306f\u3001PaddleOCR \u3068 Tesseract \u306e\u4e21\u65b9\u3092\u4f7f\u7528\u3057\u3001\u7d50\u679c\u306e\u5171\u901a\u90e8\u5206\u3092\u53d6\u5f97\u3057\u3066\u30c6\u30ad\u30b9\u30c8\u8a8d\u8b58\u7cbe\u5ea6\u3092\u9ad8\u3081\u307e\u3059\u3002</li> </ul> <p>\u5b9f\u7528\u7684\u306a\u5229\u70b9: OCR \u5f37\u5316\u306b\u3088\u308a\u3001\u30ea\u30c3\u30c1\u30c6\u30ad\u30b9\u30c8\u753b\u50cf\u306e\u518d\u73fe\u54c1\u8cea\u304c\u5927\u5e45\u306b\u5411\u4e0a\u3057\u307e\u3059\u3002\u4e00\u822c\u7684\u306a\u6bd4\u8f03:</p> <ul> <li>\u96fb\u5b50\u5546\u53d6\u5f15\u30dd\u30b9\u30bf\u30fc\u4e0a\u306e\u901a\u5e38\u306e VLM (OCR \u306a\u3057): \u300c\u767d\u3044\u80cc\u666f\u306b\u8d64\u3044\u30d7\u30ed\u30e2\u30fc\u30b7\u30e7\u30f3 \u30dd\u30b9\u30bf\u30fc\u3002\u66d6\u6627\u306a\u30c6\u30ad\u30b9\u30c8\u3068\u4e0b\u90e8\u306b\u30dc\u30bf\u30f3\u304c\u4ed8\u3044\u3066\u3044\u307e\u3059\u3002\u300d</li> <li>OCR \u62e1\u5f35 VLM: \u300c\u767d\u3044\u80cc\u666f\u306e\u8d64\u3044\u30d7\u30ed\u30e2\u30fc\u30b7\u30e7\u30f3 \u30dd\u30b9\u30bf\u30fc\u3002\u30dd\u30b9\u30bf\u30fc\u306e\u4e0a\u90e8\u4e2d\u592e\u306b\u5927\u304d\u306a\u767d\u3044\u592a\u5b57\u3067\u300cSUMMER SALE 50% OFF\u300d\u3068\u3044\u3046\u30c6\u30ad\u30b9\u30c8\u304c\u3042\u308a\u3001\u53f3\u4e0b\u306b\u3042\u308b\u5c0f\u3055\u306a\u9752\u3044\u30dc\u30bf\u30f3\u3067\u300c\u4eca\u3059\u3050\u8cfc\u5165\u300d\u3068\u3044\u3046\u30c6\u30ad\u30b9\u30c8\u304c\u7279\u5fb4\u3067\u3059\u3002\u300cSUMMER SALE\u300d\u3068\u3044\u3046\u30c6\u30ad\u30b9\u30c8\u306f\u88c5\u98fe\u7684\u306a\u30d5\u30a9\u30f3\u30c8\u3067\u3042\u308a\u3001\u9ec4\u8272\u306e\u30b7\u30e3\u30c9\u30a6\u52b9\u679c\u304c\u76ee\u7acb\u3061\u307e\u3059\u3002\u5168\u4f53\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u306f\u30b7\u30f3\u30d7\u30eb\u3067\u76ee\u3092\u5f15\u304f\u3082\u306e\u3067\u3001\u30d7\u30ed\u30e2\u30fc\u30b7\u30e7\u30f3\u60c5\u5831\u3092\u5f37\u8abf\u3059\u308b\u3053\u3068\u306b\u91cd\u70b9\u3092\u7f6e\u3044\u3066\u3044\u307e\u3059\u3002\u80cc\u666f\u306f\u6b21\u306e\u3068\u304a\u308a\u3067\u3059\u3002\u7121\u5730\u306e\u767d\u306a\u306e\u3067\u3001\u8d64\u3044\u30dd\u30b9\u30bf\u30fc\u3068\u767d\u3044\u6587\u5b57\u304c\u3088\u308a\u76ee\u7acb\u3061\u307e\u3059\u3002\u300d</li> </ul> <p>\u3053\u306e\u9055\u3044\u306f\u3001\u6b63\u78ba\u306a\u30c6\u30ad\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b\u30e2\u30c7\u30eb (\u8868\u610f\u6587\u5b57\u3001SD3\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u751f\u6210\u30e2\u30c7\u30eb) \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u5834\u5408\u306b\u91cd\u8981\u3067\u3059\u3002\u6b63\u78ba\u306a\u30c6\u30ad\u30b9\u30c8\u3092\u542b\u3080\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u306b\u3088\u308a\u3001\u30e2\u30c7\u30eb\u306f\u300c\u30c6\u30ad\u30b9\u30c8\u306e\u8996\u899a\u7684\u8868\u73fe\u300d\u3068\u300c\u30c6\u30ad\u30b9\u30c8\u3068\u30b7\u30fc\u30f3\u306e\u95a2\u9023\u4ed8\u3051\u300d\u3092\u5b66\u7fd2\u3057\u3001\u3088\u308a\u6e96\u62e0\u3057\u305f\u753b\u50cf\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u8996\u899a\u7684\u306a QA \u3068\u753b\u50cf\u691c\u7d22\u306e\u5834\u5408\u3001OCR \u3067\u5f37\u5316\u3055\u308c\u305f\u8aac\u660e\u306b\u3088\u308a\u3001\u30bf\u30b9\u30af\u306e\u7cbe\u5ea6\u304c\u5411\u4e0a\u3057\u3001\u753b\u50cf\u306e\u6838\u3068\u306a\u308b\u610f\u5473\u306e\u30e2\u30c7\u30eb\u306e\u7406\u89e3\u3082\u5411\u4e0a\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_3_video_audio/","title":"\u7b2c8\u7ae0: \u52d5\u753b\u3068\u97f3\u58f0\u30c7\u30fc\u30bf","text":""},{"location":"ja/part3/3_3_video_audio/#8","title":"\u7b2c 8 \u7ae0: \u30d3\u30c7\u30aa\u304a\u3088\u3073\u30aa\u30fc\u30c7\u30a3\u30aa \u30c7\u30fc\u30bf\u306e\u51e6\u7406","text":""},{"location":"ja/part3/3_3_video_audio/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u30d3\u30c7\u30aa \u30c7\u30fc\u30bf\u306f\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u300c\u6df1\u5c64\u6c34\u300d\u3068\u547c\u3070\u308c\u308b\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30e9\u30fc\u30b8 \u30e2\u30c7\u30eb (LMM) \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u304a\u3044\u3066\u3001\u6700\u5927\u306e\u91cf\u3001\u6700\u3082\u51e6\u7406\u306e\u96e3\u6613\u5ea6\u304c\u9ad8\u304f\u3001\u6700\u3082\u8907\u96d1\u306a\u60c5\u5831\u5bc6\u5ea6\u3092\u6301\u3064\u30e2\u30c0\u30ea\u30c6\u30a3\u3067\u3059\u3002\u9759\u6b62\u753b\u50cf\u3068\u306f\u7570\u306a\u308a\u3001\u30d3\u30c7\u30aa\u3067\u306f \u6642\u9593\u6b21\u5143 \u304c\u5c0e\u5165\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u30c7\u30fc\u30bf\u304c\u5358\u306a\u308b\u30d4\u30af\u30bb\u30eb\u306e\u7a4d\u307f\u91cd\u306d\u3067\u306f\u306a\u304f\u3001\u56e0\u679c\u95a2\u4fc2\u306e\u8ad6\u7406\u3001\u7269\u7406\u6cd5\u5247\u3001\u304a\u3088\u3073\u904b\u52d5\u30d1\u30bf\u30fc\u30f3\u3092\u904b\u3076\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u7ae0\u3067\u306f\u3001\u9023\u7d9a\u3057\u305f\u975e\u69cb\u9020\u5316\u30d3\u30c7\u30aa \u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u30e2\u30c7\u30eb\u304c\u7406\u89e3\u3067\u304d\u308b\u96e2\u6563\u30c8\u30fc\u30af\u30f3\u306b\u5909\u63db\u3059\u308b\u65b9\u6cd5\u3092\u7cfb\u7d71\u7684\u306b\u8aac\u660e\u3057\u307e\u3059\u3002\u57fa\u790e\u3068\u306a\u308b \u30b7\u30e7\u30c3\u30c8\u5883\u754c\u691c\u51fa \u304b\u3089\u59cb\u3081\u3066\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u30d9\u30fc\u30b9\u306e\u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3 \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u8a73\u3057\u304f\u5206\u6790\u3057\u307e\u3059\u3002\u6b21\u306b\u3001\u30d3\u30c7\u30aa\u751f\u6210\u306e\u300c\u6838\u5fc3\u300d\u3067\u3042\u308b Video Tokenizer \u3092\u5206\u6790\u3057\u3001VQ-VAE \u3068 Google DeepMind \u306e\u6700\u65b0\u306e MagViT-v2 \u306e\u57fa\u790e\u3068\u306a\u308b\u539f\u7406\u3092\u6bd4\u8f03\u3057\u307e\u3059\u3002\u6700\u5f8c\u306b\u3001WhisperX \u3092\u4f7f\u7528\u3057\u3066\u3001\u97f3\u58f0\u3068\u30d3\u30c7\u30aa\u306e\u5358\u8a9e\u30ec\u30d9\u30eb\u3001\u3055\u3089\u306b\u306f\u97f3\u7d20\u30ec\u30d9\u30eb\u306e\u6b63\u78ba\u306a\u4f4d\u7f6e\u5408\u308f\u305b\u3092\u5b9f\u73fe\u3057\u3001\u30e2\u30c7\u30eb\u306e\u6642\u7a7a\u9593\u7684\u306b\u540c\u671f\u3055\u308c\u305f\u76e3\u8996\u4fe1\u53f7\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u793a\u3057\u307e\u3059\u3002</p> <p>\u5b66\u7fd2\u76ee\u6a19: * \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u6a5f\u80fd: PySceneDetect \u3068 ffmpeg \u30ad\u30fc\u30d5\u30ec\u30fc\u30e0 \u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u30de\u30b9\u30bf\u30fc\u3092\u4f7f\u7528\u3057\u3066\u3001\u52b9\u7387\u7684\u306a 2 \u6bb5\u968e\u306e\u30b7\u30fc\u30f3 \u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3 (\u7c97\u3044\u304b\u3089\u7d30\u304b\u3044) \u6226\u7565\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002 * \u7406\u8ad6\u7684\u306a\u6df1\u3055: \u30d3\u30c7\u30aa \u30c8\u30fc\u30af\u30f3\u5316\u306b\u304a\u3051\u308b\u300c\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u306e\u5d29\u58ca\u300d\u554f\u984c\u3068\u3001MagViT-v2 \u304c\u30eb\u30c3\u30af\u30a2\u30c3\u30d7\u30d5\u30ea\u30fc\u91cf\u5b50\u5316 (LFQ) \u3092\u901a\u3058\u3066\u3053\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u3069\u306e\u3088\u3046\u306b\u5b8c\u5168\u306b\u89e3\u6c7a\u3059\u308b\u304b\u3092\u6df1\u304f\u7406\u89e3\u3057\u307e\u3059\u3002 * \u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: WhisperX \u30d9\u30fc\u30b9\u306e\u5f37\u5236\u4f4d\u7f6e\u5408\u308f\u305b\u30d5\u30ed\u30fc\u3092\u5b9f\u88c5\u3057\u3066\u3001\u30de\u30eb\u30c1\u30b9\u30d4\u30fc\u30ab\u30fc\u3084\u30d0\u30c3\u30af\u30b0\u30e9\u30a6\u30f3\u30c9 \u30ce\u30a4\u30ba\u306e\u97f3\u97ff\u74b0\u5883\u3067\u306e\u6b63\u78ba\u306a\u5b57\u5e55\u4f4d\u7f6e\u5408\u308f\u305b\u3092\u89e3\u6c7a\u3057\u307e\u3059\u3002 * \u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u6700\u9069\u5316: \u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u30b7\u30e3\u30fc\u30c7\u30a3\u30f3\u30b0\u3068\u5927\u91cf\u306e\u30d3\u30c7\u30aa \u30c7\u30fc\u30bf\u306e\u52b9\u7387\u7684\u306a\u8aad\u307f\u8fbc\u307f\u306b\u3064\u3044\u3066\u7406\u89e3\u3057\u307e\u3059\u3002</p> <p>\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb:</p> <p>\u300c\u30bd\u30e9\u306e\u3088\u3046\u306a\u4e16\u754c\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u3066\u3044\u308b\u3068\u60f3\u50cf\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u3068\u3057\u3066 2 \u6642\u9593\u306e\u6620\u753b\u300c\u30bf\u30a4\u30bf\u30cb\u30c3\u30af\u300d\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3057\u305f\u3002</p> <p>\u5358\u7d14\u306b 10 \u79d2\u3054\u3068\u306b\u5206\u5272\u3059\u308b\u3068\u3001\u91cd\u5927\u306a\u300c\u610f\u5473\u7684\u4e0d\u9023\u7d9a\u6027\u300d\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u30bb\u30b0\u30e1\u30f3\u30c8\u306e\u6700\u521d\u306e 5 \u79d2\u306f\u30c7\u30c3\u30ad\u4e0a\u306e\u7a4f\u3084\u304b\u306a\u6d77\u98a8\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u304c\u3001\u6b21\u306e 5 \u79d2\u306f\u7a81\u7136\u9a12\u3005\u3057\u3044\u30ec\u30b9\u30c8\u30e9\u30f3\u306b\u30b8\u30e3\u30f3\u30d7\u3057\u307e\u3059\u3002\u3053\u306e\u30af\u30ed\u30b9\u30b7\u30fc\u30f3\u306e\u300c\u30cf\u30fc\u30c9\u30ab\u30c3\u30c8\u300d\u306f\u30e2\u30c7\u30eb\u3092\u6df7\u4e71\u3055\u305b\u307e\u3059\u3002\u300c\u4eba\u306f\u3069\u306e\u3088\u3046\u306b\u3057\u3066\u5c4b\u5916\u304b\u3089\u5c4b\u5185\u306b 0.1 \u79d2\u3067\u30c6\u30ec\u30dd\u30fc\u30c8\u3057\u305f\u306e\u3067\u3057\u3087\u3046\u304b?\u300d\u3053\u308c\u306f\u8a08\u7b97\u3092\u7121\u99c4\u306b\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30e2\u30c7\u30eb\u306b\u9593\u9055\u3063\u305f\u7269\u7406\u5b66\u3092\u6559\u3048\u307e\u3059\u3002</p> <p>\u3055\u3089\u306b\u3001\u30aa\u30fc\u30c7\u30a3\u30aa\u306e\u6642\u9593\u7cbe\u5ea6\u304c\u547d\u3067\u3059\u3002\u30ed\u30fc\u30ba\u306e\u53e3\u304c\u753b\u9762\u4e0a\u3067\u52d5\u3044\u3066\u3044\u308b\u3068\u304d\u3001\u5b57\u5e55\u304c\u753b\u50cf\u3088\u308a 2 \u79d2\u9045\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u5bfe\u5fdc\u3059\u308b\u30c8\u30fc\u30af\u30f3\u306f\u30b8\u30e3\u30c3\u30af\u306e\u30bb\u30ea\u30d5\u3067\u3059\u3002\u30e2\u30c7\u30eb\u306f\u3001\u300c\u30b8\u30e3\u30c3\u30af\u306e\u58f0\u306e\u7279\u5fb4\u300d\u3092\u300c\u30ed\u30fc\u30ba\u306e\u9854\u306e\u7279\u5fb4\u300d\u3068\u8aa4\u3063\u3066\u95a2\u9023\u4ed8\u3051\u307e\u3059\u3002\u5146\u30c8\u30fc\u30af\u30f3\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u306f\u3001\u3053\u306e\u3088\u3046\u306a\u5fae\u5999\u306a\u305a\u308c\u304c\u5897\u5e45\u3057\u3066\u91cd\u5ea6\u306e\u5e7b\u899a\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u300d</p>"},{"location":"ja/part3/3_3_video_audio/#81","title":"8.1 \u30d3\u30c7\u30aa\u51e6\u7406\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30b7\u30fc\u30f3\u691c\u51fa","text":"<p>\u30d3\u30c7\u30aa\u306f\u57fa\u672c\u7684\u306b\u9023\u7d9a\u3057\u305f\u30b9\u30c8\u30ea\u30fc\u30e0\u3067\u306f\u306a\u304f\u3001\u4e00\u9023\u306e\u72ec\u7acb\u3057\u305f\u300c\u30b7\u30e7\u30c3\u30c8\u300d\u304c\u9023\u7d50\u3055\u308c\u305f\u3082\u306e\u3067\u3059\u3002\u5404\u30b7\u30e7\u30c3\u30c8\u306f\u30011 \u3064\u306e\u30ab\u30e1\u30e9\u306e\u30aa\u30f3\u3068\u30aa\u30d5 (\u307e\u305f\u306f\u9023\u7d9a\u7684\u306a\u30ab\u30e1\u30e9\u306e\u52d5\u304d) \u3092\u8868\u3057\u307e\u3059\u3002\u30d3\u30c7\u30aa\u751f\u6210\u30e2\u30c7\u30eb (\u30d3\u30c7\u30aa\u751f\u6210\u30e2\u30c7\u30eb) \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u306b\u306f\u3001\u6642\u7a7a\u9593\u9023\u7d9a\u6027 \u3092\u78ba\u4fdd\u3059\u308b\u305f\u3081\u306b\u3001\u5404\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30b5\u30f3\u30d7\u30eb (\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30af\u30ea\u30c3\u30d7) \u304c\u540c\u3058\u30b7\u30e7\u30c3\u30c8\u5185\u306b\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_3_video_audio/#811-gop-i","title":"8.1.1 \u30d3\u30c7\u30aa\u69cb\u9020\u306e\u30df\u30af\u30ed\u30d3\u30e5\u30fc: GOP \u3068 I \u30d5\u30ec\u30fc\u30e0","text":"<p>\u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3 \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306b\u5165\u308b\u524d\u306b\u3001\u30d3\u30c7\u30aa \u30a8\u30f3\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u306e\u57fa\u672c\u3092\u7406\u89e3\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <ul> <li>I \u30d5\u30ec\u30fc\u30e0 (\u30a4\u30f3\u30c8\u30e9\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3055\u308c\u305f\u30d4\u30af\u30c1\u30e3): \u30ad\u30fc\u30d5\u30ec\u30fc\u30e0\u3002\u4ed6\u306e\u30d5\u30ec\u30fc\u30e0\u306b\u4f9d\u5b58\u305b\u305a\u306b\u30c7\u30b3\u30fc\u30c9\u3067\u304d\u308b\u5b8c\u5168\u306a\u753b\u50cf\u3067\u3059\u3002\u901a\u5e38\u3001\u30b7\u30fc\u30f3\u9077\u79fb\u306e\u958b\u59cb\u70b9\u3067\u3082\u3042\u308a\u307e\u3059\u3002</li> <li>P \u30d5\u30ec\u30fc\u30e0 (\u4e88\u6e2c\u30d4\u30af\u30c1\u30e3): \u524d\u65b9\u4e88\u6e2c\u30d5\u30ec\u30fc\u30e0\u3002\u524d\u306e\u30d5\u30ec\u30fc\u30e0\u3068\u306e\u5dee\u5206\u306e\u307f\u3092\u4fdd\u5b58\u3057\u307e\u3059\u3002</li> <li>B \u30d5\u30ec\u30fc\u30e0 (\u53cc\u65b9\u5411\u4e88\u6e2c\u30d4\u30af\u30c1\u30e3): \u53cc\u65b9\u5411\u4e88\u6e2c\u30d5\u30ec\u30fc\u30e0\u3002\u904e\u53bb\u3068\u5c06\u6765\u306e\u30d5\u30ec\u30fc\u30e0\u306e\u4e21\u65b9\u3092\u53c2\u7167\u3057\u3066\u5727\u7e2e\u3057\u3001\u6700\u3082\u9ad8\u3044\u5727\u7e2e\u7387\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</li> </ul> <p>GOP (Group of Pictures): 2 \u3064\u306e I \u30d5\u30ec\u30fc\u30e0\u9593\u306e\u30b7\u30fc\u30b1\u30f3\u30b9\u3002\u30d3\u30c7\u30aa \u30d7\u30ec\u30fc\u30e4\u30fc\u304c\u30b7\u30fc\u30af\u3059\u308b\u3068\u3001\u30c7\u30b3\u30fc\u30c9\u306f\u305d\u3053\u304b\u3089\u958b\u59cb\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u305f\u3081\u3001\u901a\u5e38\u3001\u6700\u3082\u8fd1\u3044 I \u30d5\u30ec\u30fc\u30e0\u306b\u300c\u30b9\u30ca\u30c3\u30d7\u300d\u3057\u307e\u3059\u3002\u79c1\u305f\u3061\u306e\u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u6226\u7565\u306f\u3053\u308c\u3092\u6d3b\u7528\u3057\u3066\u52a0\u901f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_3_video_audio/#812","title":"8.1.2 \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u9078\u629e\u3068\u6226\u7565","text":"<p> \u56f3 8-1: 2 \u3064\u306e\u30d3\u30c7\u30aa \u30b7\u30fc\u30f3 \u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3\u6226\u7565\u3068 HSV \u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u306e\u9055\u3044</p> <p>PySceneDetect \u306f\u3001\u696d\u754c\u6a19\u6e96\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30c4\u30fc\u30eb\u3067\u3059\u3002\u30d5\u30ec\u30fc\u30e0\u9593\u5dee\u5206\u5206\u6790\u306b\u57fa\u3065\u3044\u305f\u30b3\u30a2 \u30ed\u30b8\u30c3\u30af\u3092\u5099\u3048\u305f\u8907\u6570\u306e\u691c\u51fa\u5668\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p> <ul> <li> <p>\u6226\u7565 1: \u95be\u5024\u691c\u51fa\u5668 (\u30cf\u30fc\u30c9\u30ab\u30c3\u30c8)</p> <ul> <li>\u539f\u7406: HSV \u8272\u7a7a\u9593\u307e\u305f\u306f RGB \u8f1d\u5ea6\u3067\u96a3\u63a5\u3059\u308b\u30d5\u30ec\u30fc\u30e0\u9593\u306e\u5e73\u5747\u5dee (\u30c7\u30eb\u30bf) \u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u30c7\u30eb\u30bf &gt; <code>threshold</code> (\u4f8b: 30_0) \u306e\u5834\u5408\u3001\u30ab\u30c3\u30c8\u30dd\u30a4\u30f3\u30c8\u3068\u3057\u3066\u30de\u30fc\u30af\u3055\u308c\u307e\u3059\u3002</li> <li>\u8a72\u5f53: \u307b\u3068\u3093\u3069\u306e\u6620\u753b\u3068\u30e6\u30fc\u30b6\u30fc\u751f\u6210\u30b3\u30f3\u30c6\u30f3\u30c4 (UGC)\u3002</li> <li>\u5236\u9650\u4e8b\u9805: \u6bb5\u968e\u7684\u306a\u9077\u79fb\u3092\u691c\u51fa\u3067\u304d\u307e\u305b\u3093\u3002</li> </ul> </li> <li> <p>\u6226\u7565 2: \u9069\u5fdc\u691c\u51fa\u5668 (\u6bb5\u968e\u7684\u306a\u9077\u79fb / \u9ad8\u901f\u30ab\u30c3\u30c8)</p> <ul> <li>\u539f\u5247: \u56fa\u5b9a\u3057\u304d\u3044\u5024\u306f\u4f7f\u7528\u3057\u306a\u304f\u306a\u308a\u307e\u3057\u305f\u3002\u30b9\u30e9\u30a4\u30c7\u30a3\u30f3\u30b0\u30a6\u30a3\u30f3\u30c9\u30a6\u3092\u7dad\u6301\u3057\u307e\u3059\u3002 \u300c\u73fe\u5728\u306e\u30d5\u30ec\u30fc\u30e0\u300d\u3068\u300c\u30a6\u30a3\u30f3\u30c9\u30a6\u5185\u306e\u5e73\u5747\u30d5\u30ec\u30fc\u30e0\u5dee\u300d\u306e\u6bd4\u7387\u3092\u6bd4\u8f03\u3057\u307e\u3059\u3002</li> <li>\u9069\u7528\u53ef\u80fd: \u30d5\u30a7\u30fc\u30c9\u30a4\u30f3/\u30a2\u30a6\u30c8\u3001\u30c7\u30a3\u30be\u30eb\u30d6\u3001\u307e\u305f\u306f\u30ab\u30e1\u30e9\u306e\u52d5\u304d\u304c\u6fc0\u3057\u3044\u30a2\u30af\u30b7\u30e7\u30f3 \u30b7\u30fc\u30f3\u3002</li> </ul> </li> </ul> <p>\u9ad8\u5ea6\u306a\u6226\u7565: 2 \u6bb5\u968e\u306e\u30ab\u30b9\u30b1\u30fc\u30c9\u5206\u5272 \u30d5\u30eb\u30c7\u30b3\u30fc\u30c9\u3055\u308c\u305f TB \u30b9\u30b1\u30fc\u30eb\u306e\u30d3\u30c7\u30aa\u3067 PySceneDetect \u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u975e\u5e38\u306b\u6642\u9593\u304c\u304b\u304b\u308a\u307e\u3059\u3002\u5de5\u696d\u7528\u306e\u300c\u7c97\u304f\u3057\u3066\u304b\u3089\u7d30\u304b\u3044\u300d\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002</p> <ol> <li>\u30ec\u30d9\u30eb 1 (\u30e1\u30bf\u30c7\u30fc\u30bf \u30b9\u30ad\u30e3\u30f3): <code>ffprobe</code> \u3092\u4f7f\u7528\u3057\u3066\u3001\u30d3\u30c7\u30aa \u30b9\u30c8\u30ea\u30fc\u30e0\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u8fc5\u901f\u306b\u30b9\u30ad\u30e3\u30f3\u3057\u3001\u3059\u3079\u3066\u306e I \u30d5\u30ec\u30fc\u30e0 \u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3092\u62bd\u51fa\u3057\u307e\u3059\u3002 I \u30d5\u30ec\u30fc\u30e0\u306f\u591a\u304f\u306e\u5834\u5408\u3001\u30b7\u30fc\u30f3\u306e\u9077\u79fb\u6642\u306b\u8868\u793a\u3055\u308c\u307e\u3059 (\u30a8\u30f3\u30b3\u30fc\u30c0\u30fc\u306f\u3001\u7a81\u7136\u306e\u5909\u5316\u6642\u306b I \u30d5\u30ec\u30fc\u30e0\u3092\u633f\u5165\u3059\u308b\u50be\u5411\u304c\u3042\u308a\u307e\u3059)\u3002\u3053\u306e\u30b9\u30c6\u30c3\u30d7\u3067\u306f\u30d5\u30ec\u30fc\u30e0\u306e\u30c7\u30b3\u30fc\u30c9\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002\u518d\u751f\u901f\u5ea6\u306f 100 \u500d\u4ee5\u4e0a\u3067\u3059\u3002</li> <li>\u30ec\u30d9\u30eb 2 (\u30b3\u30f3\u30c6\u30f3\u30c4\u5206\u6790): \u30ec\u30d9\u30eb 1 \u3067\u8b58\u5225\u3055\u308c\u305f\u6f5c\u5728\u7684\u306a\u30ab\u30c3\u30c8 \u30dd\u30a4\u30f3\u30c8\u304b\u3089 \u00b12 \u79d2\u4ee5\u5185\u306e\u6b63\u78ba\u306a\u30d5\u30ec\u30fc\u30e0\u30ec\u30d9\u30eb\u306e\u4f4d\u7f6e\u7279\u5b9a\u306b\u306f\u3001PySceneDetect \u306e <code>ContentDetector</code> \u306e\u307f\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002</li> </ol>"},{"location":"ja/part3/3_3_video_audio/#813","title":"8.1.3 \u30b3\u30a2 \u30b3\u30fc\u30c9: \u30b7\u30fc\u30f3\u691c\u51fa\u3068\u30ed\u30b9\u30ec\u30b9 \u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3","text":"<p>\u4ee5\u4e0b\u306e\u30b3\u30fc\u30c9\u306f\u3001\u904b\u7528\u74b0\u5883\u306b\u304a\u3051\u308b\u6a19\u6e96\u7684\u306a\u30bb\u30b0\u30e1\u30f3\u30c6\u30fc\u30b7\u30e7\u30f3 \u30d5\u30ed\u30fc\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002 \u300c\u30b9\u30c8\u30ea\u30fc\u30e0 \u30b3\u30d4\u30fc\u300d\u30c6\u30af\u30cb\u30c3\u30af\u306b\u6ce8\u76ee\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f\u3001\u5927\u898f\u6a21\u306a\u30d3\u30c7\u30aa\u3092\u51e6\u7406\u3059\u308b\u969b\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u7206\u767a\u3092\u56de\u907f\u3059\u308b\u305f\u3081\u306e\u9375\u3067\u3059\u3002</p> <pre><code>from scenedetect import detect, ContentDetector, split_video_ffmpeg\nimport os\nimport logging\n\n# Configure logging\nlogging.basicConfig(level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')\n\ndef process_video_scenes(video_path, output_dir, threshold=27_0):\n    \"\"\"\n    Detect scenes and cut video with ffmpeg losslessly\n    Args:\n        video_path: Input video path\n        output_dir: Output directory\n        threshold: Segmentation threshold (empirical: 27_0 works for most 1080p video)\n    \"\"\"\n    if not os.path.exists(output_dir):\n        os.makedirs(output_dir)\n\n    logging.info(f\"Starting scene detection for: {video_path}\")\n\n    # 1. Scene detection\n    # threshold=27_0: HSV space histogram difference threshold\n    # min_scene_len=15: Ignore segments shorter than 0.5s (30fps).\n    # Very short segments are usually flash, glitch, or segmentation noise\u2014unsuitable for training data.\n    scene_list = detect(\n        video_path, \n        ContentDetector(threshold=threshold, min_scene_len=15)\n    )\n\n    # 2. Statistics and filtering\n    # Add logic here: e.g., merge overly short adjacent scenes, or discard scenes under 3 seconds\n    valid_scenes = []\n    for scene in scene_list:\n        start, end = scene\n        duration = (end.get_frames() - start.get_frames()) / start.get_framerate()\n        if duration &gt;= 3_0: # Keep only segments &gt;3s for training\n            valid_scenes.append(scene)\n\n    logging.info(f\"Detected {len(scene_list)} scenes, kept {len(valid_scenes)} valid scenes.\")\n\n    # 3. Split video (Stream Copy)\n    # Key: arg_override='-c:v copy -c:a copy'\n    # This instructs ffmpeg to directly copy the binary stream without [decode -&gt; pixels -&gt; encode].\n    # Benefit 1: Extremely fast (limited by disk I/O, not CPU).\n    # Benefit 2: 100% lossless quality, no re-encoding artifacts.\n    split_video_ffmpeg(\n        video_path, \n        valid_scenes, \n        output_dir=output_dir, \n        show_progress=True,\n        arg_override='-c:v copy -c:a copy' \n    )\n\n# Pitfall: Data storage explosion disaster\n# NEVER decode segmented video into image sequences (png/jpg) or numpy arrays for long-term storage!\n# Do the math:\n# 1 hour 1080p H.264 video \u2248 2GB\n# Decoded: 3600s * 30fps * 1920 * 1080 * 3 bytes \u2248 670 GB\n# Expansion factor &gt; 300x.\n# Always store in compressed format (mp4/mkv), only use GPU (NVDEC) for real-time decoding in training DataLoader __getitem__.\n</code></pre>"},{"location":"ja/part3/3_3_video_audio/#82","title":"8.2 \u30d3\u30c7\u30aa\u306e\u30c8\u30fc\u30af\u30f3\u5316: \u30d4\u30af\u30bb\u30eb \u30aa\u30fc\u30b7\u30e3\u30f3\u304b\u3089\u96e2\u6563\u5cf6\u307e\u3067","text":"<p>Sora\u3001Gen-2\u3001\u304a\u3088\u3073\u305d\u306e\u4ed6\u306e Transformer \u30d9\u30fc\u30b9\u306e\u62e1\u6563\u30e2\u30c7\u30eb (DiT) \u306e\u5834\u5408\u3001\u30d4\u30af\u30bb\u30eb\u7a7a\u9593\u3067\u76f4\u63a5\u30e2\u30c7\u30ea\u30f3\u30b0\u3059\u308b\u3053\u3068\u306f\u4e0d\u53ef\u80fd\u3067\u3059\u3002 4 \u79d2\u306e 1080p \u30d3\u30c7\u30aa\u306b\u306f\u3001\u7d04 \\(3 \\times 10^8\\) \u30d4\u30af\u30bb\u30eb\u304c\u542b\u307e\u308c\u307e\u3059\u3002\u6ce8\u610f\u884c\u5217\u3092\u8a08\u7b97\u3059\u308b\u3068\u3001\u5373\u6642 OOM \u304c\u767a\u751f\u3057\u307e\u3059\u3002</p> <p>\u3057\u305f\u304c\u3063\u3066\u3001\u30d3\u30c7\u30aa\u306f\u307e\u305a\u6f5c\u5728\u7a7a\u9593\u5185\u306e\u500b\u5225\u306e\u30c8\u30fc\u30af\u30f3\u306b\u300c\u5727\u7e2e\u300d\u3055\u308c\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30bb\u30b9\u306f Video Tokenizer \u306b\u3088\u3063\u3066\u5b9f\u884c\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_3_video_audio/#821-vq-vae","title":"8.2.1 \u5f93\u6765\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u306e\u554f\u984c: VQ-VAE \u3068\u300c\u30c7\u30c3\u30c9\u30b3\u30fc\u30c9\u300d","text":"<p>VQ-VAE (\u30d9\u30af\u30c8\u30eb\u91cf\u5b50\u5316\u5909\u5206\u30aa\u30fc\u30c8\u30a8\u30f3\u30b3\u30fc\u30c0\u30fc) \u306f\u3001\u521d\u671f\u306e\u30d3\u30c7\u30aa\u751f\u6210\u30e2\u30c7\u30eb (VideoGPT \u306a\u3069) \u306e\u57fa\u790e\u3067\u3059\u3002</p> <ul> <li> <p>\u30d5\u30ed\u30fc:</p> <ol> <li>\u30a8\u30f3\u30b3\u30fc\u30c0\u30fc: \u30d3\u30c7\u30aa\u3092 3D \u30d1\u30c3\u30c1 (\u4f8b: \\(16 \\times 16 \\times 16\\) \u306e\u6642\u7a7a\u9593\u30d6\u30ed\u30c3\u30af) \u306b\u5206\u5272\u3057\u3001\u4f4e\u6b21\u5143\u30d9\u30af\u30c8\u30eb \\(z_e(x)\\) \u306b\u5727\u7e2e\u3057\u307e\u3059\u3002</li> <li>\u91cf\u5b50\u5316: \\(K\\) \u30d7\u30ed\u30c8\u30bf\u30a4\u30d7 \u30d9\u30af\u30c8\u30eb (Embedding) \u3092\u4f7f\u7528\u3057\u3066\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u3092\u7dad\u6301\u3057\u307e\u3059\u3002\u5404 \\(z_e(x)\\) \u306b\u3064\u3044\u3066\u3001\u30e6\u30fc\u30af\u30ea\u30c3\u30c9\u8ddd\u96e2\u3067\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u5185\u306e\u6700\u3082\u8fd1\u3044\u30d9\u30af\u30c8\u30eb \\(e_k\\) \u3092\u898b\u3064\u3051\u3066\u7f6e\u304d\u63db\u3048\u307e\u3059\u3002</li> <li>\u30c7\u30b3\u30fc\u30c0\u30fc: \\(e_k\\) \u3092\u4f7f\u7528\u3057\u3066\u30d3\u30c7\u30aa\u3092\u518d\u69cb\u7bc9\u3057\u307e\u3059\u3002</li> </ol> </li> <li> <p>\u81f4\u547d\u7684\u306a\u6b20\u9665: \u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u306e\u5d29\u58ca     \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u521d\u671f\u6bb5\u968e\u3067\u306f\u3001\u5c11\u6570\u306e\u30b3\u30fc\u30c9 (\u30b3\u30fc\u30c9 #5 \u3084 #100 \u306a\u3069) \u3060\u3051\u304c\u8aa4\u3063\u3066\u9078\u629e\u3055\u308c\u307e\u3059\u3002\u9078\u629e\u3055\u308c\u305f\u30b3\u30fc\u30c9\u306e\u307f\u304c\u52fe\u914d\u66f4\u65b0\u3092\u53d7\u3051\u53d6\u308b\u305f\u3081\u3001\u30b3\u30fc\u30c9\u306f\u300c\u3088\u308a\u826f\u304f\u300d\u306a\u308a\u3001\u518d\u5ea6\u9078\u629e\u3055\u308c\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u300c\u91d1\u6301\u3061\u306f\u3055\u3089\u306b\u91d1\u6301\u3061\u306b\u306a\u308b\u300d\u30de\u30b7\u30e5\u30fc\u52b9\u679c\u3092\u5f62\u6210\u3057\u307e\u3059\u3002</p> <ul> <li>\u7d50\u679c: \u30b3\u30fc\u30c9\u30d6\u30c3\u30af \u30d9\u30af\u30c8\u30eb\u306e 90% \u306f\u3001\u6c7a\u3057\u3066\u4f7f\u7528\u3055\u308c\u305a\u300c\u30c7\u30c3\u30c9 \u30b3\u30fc\u30c9\u300d\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u6709\u52b9\u306a\u8a9e\u5f59\u304c\u975e\u5e38\u306b\u5c11\u306a\u304f\u306a\u308a\u3001\u4e0d\u9bae\u660e\u3067\u8a73\u7d30\u304c\u6b20\u5982\u3057\u305f\u30d3\u30c7\u30aa\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002</li> <li>\u4fee\u5fa9: \u5f93\u6765\u306e\u65b9\u6cd5\u3067\u306f\u8907\u96d1\u306a\u30ea\u30bb\u30c3\u30c8\u6226\u7565 (K \u5e73\u5747\u6cd5\u30ea\u30bb\u30c3\u30c8\u306a\u3069) \u304c\u5fc5\u8981\u3067\u3042\u308a\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306f\u975e\u5e38\u306b\u4e0d\u5b89\u5b9a\u3067\u3059\u3002</li> </ul> </li> </ul>"},{"location":"ja/part3/3_3_video_audio/#822-sota-magvit-v2-lfq","title":"8.2.2 SOTA \u30a2\u30d7\u30ed\u30fc\u30c1: MagViT-v2 \u304a\u3088\u3073 LFQ","text":"<p>Google DeepMind \u306f\u3001MagViT-v2 \u306b LFQ (\u30eb\u30c3\u30af\u30a2\u30c3\u30d7\u30d5\u30ea\u30fc\u91cf\u5b50\u5316) \u3092\u5c0e\u5165\u3057\u3001\u30b2\u30fc\u30e0\u3092\u6839\u672c\u7684\u306b\u5909\u3048\u307e\u3057\u305f\u3002</p> <ul> <li> <p>\u4e2d\u5fc3\u7684\u306a\u30a2\u30a4\u30c7\u30a2: \u30eb\u30c3\u30af\u30a2\u30c3\u30d7\u306a\u3057\u3001\u76f4\u63a5\u8a08\u7b97\u3002     LFQ \u306f\u300c\u6700\u8fd1\u508d\u691c\u7d22\u300d\u30a2\u30d7\u30ed\u30fc\u30c1\u3092\u653e\u68c4\u3057\u3001\u6f5c\u5728\u5909\u6570\u306e \u7b26\u53f7\u304b\u3089\u30c8\u30fc\u30af\u30f3\u3092\u76f4\u63a5\u751f\u6210\u3057\u307e\u3059\u3002</p> </li> <li> <p>\u6570\u5b66\u7684\u539f\u7406:     \u30a8\u30f3\u30b3\u30fc\u30c0\u30fc\u306e\u51fa\u529b\u6f5c\u5728\u30d9\u30af\u30c8\u30eb \\(z \\in \\mathbb{R}^D\\) (\u4f8b: \\(D=18\\)) \u3092\u4eee\u5b9a\u3057\u307e\u3059\u3002     LFQ \u306f\u5404\u6b21\u5143\u3092 2 \u5024\u5316\u3057\u307e\u3059\u3002     $\\(q_i = \\begin{cases} 1 &amp; \\text{if } z_i &gt; 0 \\\\ 0 &amp; \\text{if } z_i \\le 0 \\end{cases}\\)$</p> </li> </ul> <p>\u6b21\u306b\u3001\\(D\\) \u30d0\u30a4\u30ca\u30ea \u30d3\u30c3\u30c8\u3092\u6574\u6570\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306b\u7d50\u5408\u3057\u307e\u3059\u3002     $\\(\\text{\u30c8\u30fc\u30af\u30f3 ID} = \\sum_{i=0}^{D-1} q_i \\cdot 2^i\\)$</p> <ul> <li>LFQ \u306f\u306a\u305c\u9769\u65b0\u7684\u3067\u3059\u304b?<ol> <li>\u7121\u9650\u306e\u6709\u52b9\u30b3\u30fc\u30c9\u30d6\u30c3\u30af: \\(D=18\\) \u306e\u5834\u5408\u3001\u81ea\u7136\u306a\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u306e\u30b5\u30a4\u30ba\u306f \\(2^{18} = 262,144\\) \u3067\u3059\u3002\u3059\u3079\u3066\u306e\u30b3\u30fc\u30c9\u306f \\(D\\) \u306e\u72ec\u7acb\u3057\u305f\u6b21\u5143\u306e\u7d44\u307f\u5408\u308f\u305b\u3067\u3059\u3002\u5404\u6b21\u5143\u306f\u5e38\u306b\u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3\u306e\u66f4\u65b0\u306b\u53c2\u52a0\u3057\u307e\u3059\u3002 \u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u306e\u4f7f\u7528\u7387\u306f 100% \u3067\u4e00\u5b9a\u3067\u3059\u3002</li> <li>\u8a08\u7b97\u30b3\u30b9\u30c8\u30bc\u30ed: \u9ad8\u4fa1\u306a\u300c\u5b8c\u5168\u306a\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u8ddd\u96e2\u8a08\u7b97\u300d\u306f\u4e0d\u8981\u3067\u3001\u5358\u7d14\u306a\u30d3\u30c3\u30c8\u6f14\u7b97\u306e\u307f\u3067\u3059\u3002</li> <li>\u6642\u7a7a\u9593\u5727\u7e2e: MagViT-v2 \u306f 3D \u56e0\u679c\u95a2\u4fc2 CNN \u3092\u7d44\u307f\u5408\u308f\u305b\u3001\u7a7a\u9593\u3092\u5727\u7e2e\u3057\u306a\u304c\u3089\u6642\u9593\u7684\u56e0\u679c\u95a2\u4fc2\u3092\u7dad\u6301\u3057\u307e\u3059 (\u73fe\u5728\u306e\u30c8\u30fc\u30af\u30f3\u304c\u5c06\u6765\u306e\u60c5\u5831\u3092\u6f0f\u3089\u3059\u3053\u3068\u306f\u3042\u308a\u307e\u305b\u3093)\u3002\u3053\u308c\u306f\u751f\u6210\u30e2\u30c7\u30eb\u306b\u3068\u3063\u3066\u91cd\u8981\u3067\u3059\u3002</li> </ol> </li> </ul>"},{"location":"ja/part3/3_3_video_audio/#823","title":"8.2.3 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u6bd4\u8f03\u8868","text":"\u7279\u96c6 VQ-VAE (TATS/VideoGPT) MagViT-v2 (LFQ) \u91cf\u5b50\u5316\u30e1\u30ab\u30cb\u30ba\u30e0 \u6700\u8fd1\u508d\u691c\u7d22 (\u30eb\u30c3\u30af\u30a2\u30c3\u30d7) \u7b26\u53f7\u95a2\u6570\uff08\u7b26\u53f7\u6295\u5f71\uff09 \u8a9e\u5f59\u30b5\u30a4\u30ba (\u8a9e\u5f59) \u901a\u5e38\u306f 1024 \uff5e 8192 (VRAM \u3068\u6298\u308a\u305f\u305f\u307f\u306b\u3088\u3063\u3066\u5236\u9650\u3055\u308c\u307e\u3059) \\(2^{18}\\) (262k) \u4ee5\u4e0a\u3001\u7c21\u5358\u306b\u62e1\u5f35\u53ef\u80fd \u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u306e\u4f7f\u7528\u7387 \u4f4e\u3044\uff08\u5d29\u58ca\u3057\u3084\u3059\u3044\u3001EMA\u304c\u5fc5\u8981\u306a\u3069\uff09 100% (\u30c7\u30b6\u30a4\u30f3\u306e\u5d29\u58ca\u3092\u56de\u907f) \u30b0\u30e9\u30c7\u30fc\u30b7\u30e7\u30f3 \u30d0\u30c3\u30af\u30d7\u30ed\u30c3\u30d7 Straight-Through Estimator (STE) \u304c\u5fc5\u8981 \u6539\u5584\u3055\u308c\u305f\u30a8\u30f3\u30c8\u30ed\u30d4\u30fc \u30da\u30ca\u30eb\u30c6\u30a3 + STE \u4e16\u4ee3\u306e\u54c1\u8cea \u307c\u3084\u3051\u3084\u3059\u304f\u3001\u30c7\u30a3\u30c6\u30fc\u30eb\u306e\u8cea\u611f\u304c\u5931\u308f\u308c\u307e\u3059 \u975e\u5e38\u306b\u30af\u30ea\u30a2\u3067\u3001\u30aa\u30ea\u30b8\u30ca\u30eb\u3088\u308a\u3055\u3089\u306b\u512a\u308c\u3066\u3044\u307e\u3059\uff08\u30ce\u30a4\u30ba\u9664\u53bb\u52b9\u679c\uff09 \u63a8\u8ad6\u901f\u5ea6 \u9045\u3044 (\u7279\u306b\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u304c\u5927\u304d\u3044\u5834\u5408) \u975e\u5e38\u306b\u901f\u3044 --- <p>VQ-VAE \u304b\u3089 MagViT-v2 \u3078\u306e\u9032\u5316\u306f\u3001\u5358\u7d14\u306a\u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u6700\u9069\u5316\u3067\u306f\u306a\u304f\u3001\u300c\u691c\u7d22\u30d9\u30fc\u30b9\u306e\u8fd1\u4f3c\u300d\u304b\u3089\u300c\u8a08\u7b97\u30d9\u30fc\u30b9\u306e\u69cb\u7bc9\u300d\u3078\u306e\u30d3\u30c7\u30aa\u96e2\u6563\u5316\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u306e\u30d1\u30e9\u30c0\u30a4\u30e0 \u30b7\u30d5\u30c8\u3067\u3059\u3002</p> <p>\u307e\u305a\u3001\u8a08\u7b97\u306e\u8907\u96d1\u3055\u3068\u30b9\u30b1\u30fc\u30e9\u30d3\u30ea\u30c6\u30a3\u306e\u70b9\u3067\u3001\u5f93\u6765\u306e VQ-VAE \u306b\u306f\u6839\u672c\u7684\u306a\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u304c\u3042\u308a\u307e\u3059\u3002\u305d\u306e\u91cf\u5b50\u5316\u306f\u6700\u8fd1\u508d\u691c\u7d22\u306b\u4f9d\u5b58\u3057\u3066\u304a\u308a\u3001\u7279\u5fb4\u30d9\u30af\u30c8\u30eb\u3068\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u5185\u306e\u3059\u3079\u3066\u306e \\(K\\) \u30d7\u30ed\u30c8\u30bf\u30a4\u30d7\u9593\u306e\u30e6\u30fc\u30af\u30ea\u30c3\u30c9\u8ddd\u96e2 (\u6642\u9593\u8a08\u7b97\u91cf \\(O(K)\\)) \u3092\u8a08\u7b97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u8868\u73fe\u3092\u6539\u5584\u3059\u308b\u305f\u3081\u306b\u8a9e\u5f59\u3092\u62e1\u5f35\u3059\u308b\u3068\u3001\u63a8\u8ad6\u30ec\u30a4\u30c6\u30f3\u30b7\u304c\u76f4\u7dda\u7684\u306b\u5897\u52a0\u3059\u308b\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u5bfe\u7167\u7684\u306b\u3001MagViT-v2 \u306e LFQ (\u30eb\u30c3\u30af\u30a2\u30c3\u30d7\u30d5\u30ea\u30fc\u91cf\u5b50\u5316) \u306f\u30eb\u30c3\u30af\u30a2\u30c3\u30d7\u3092\u653e\u68c4\u3057\u3001\u7b26\u53f7\u95a2\u6570\u3092\u4f7f\u7528\u3057\u3066\u6f5c\u5728\u5909\u6570\u3092\u30d0\u30a4\u30ca\u30ea\u6587\u5b57\u5217\u306b\u5c04\u5f71\u3057\u307e\u3059\u3002\u3053\u306e\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u308a\u3001\u8a08\u7b97\u306e\u8907\u96d1\u3055\u304c\u5b9a\u6570 \\(O(1)\\) \u306b\u8efd\u6e1b\u3055\u308c\u3001\u63a8\u8ad6\u901f\u5ea6\u3092\u72a0\u7272\u306b\u3059\u308b\u3053\u3068\u306a\u304f\u30e2\u30c7\u30eb\u304c \\(2^{18}\\) \u4ee5\u4e0a\u306e\u8a9e\u5f59\u3092\u30b5\u30dd\u30fc\u30c8\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u3001\u5927\u304d\u306a\u8a9e\u5f59\u3068\u4f4e\u9045\u5ef6\u306e\u9593\u306e\u77db\u76fe\u304c\u89e3\u6c7a\u3055\u308c\u307e\u3059\u3002</p> <p>\u7b2c\u4e8c\u306b\u3001\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u306e\u5229\u7528\u3068\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u5b89\u5b9a\u6027\u306b\u304a\u3044\u3066\u3001\u3053\u306e 2 \u3064\u306f\u8457\u3057\u304f\u7570\u306a\u308a\u307e\u3059\u3002 VQ-VAE \u306f\u9577\u3044\u9593\u3001\u300c\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u5d29\u58ca\u300d\u306b\u60a9\u307e\u3055\u308c\u3066\u304d\u307e\u3057\u305f\u3002\u521d\u671f\u5316\u3084\u4e0d\u5747\u4e00\u306a\u52fe\u914d\u5272\u308a\u5f53\u3066\u306b\u3088\u308a\u4e00\u90e8\u306e\u30a8\u30f3\u30b3\u30fc\u30c9 \u30d9\u30af\u30c8\u30eb\u304c\u30a2\u30af\u30c6\u30a3\u30d6\u306b\u306a\u3089\u305a\u3001\u6709\u52b9\u306a\u30dc\u30ad\u30e3\u30d6\u30e9\u30ea\u304c\u8a2d\u8a08\u5024\u3092\u5927\u5e45\u306b\u4e0b\u56de\u308a\u307e\u3059 (\u591a\u304f\u306e\u5834\u5408\u3001\u308f\u305a\u304b 1024 \uff5e 8192)\u3002\u3053\u306e\u305f\u3081\u3001\u7814\u7a76\u8005\u306f EMA (\u6307\u6570\u79fb\u52d5\u5e73\u5747) \u3084 K-means \u30ea\u30bb\u30c3\u30c8\u3001\u305d\u306e\u4ed6\u306e\u8907\u96d1\u306a\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u624b\u6cd5\u3092\u5c0e\u5165\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 MagViT-v2 \u306e LFQ \u306f\u3001\u72ec\u7acb\u3057\u305f\u6b21\u5143\u306e 2 \u5024\u5316\u306e\u7d44\u307f\u5408\u308f\u305b\u306b\u57fa\u3065\u3044\u3066\u304a\u308a\u3001\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u7a7a\u9593\u304c\u300c\u500b\u5225\u306b\u691c\u7d22\u3055\u308c\u308b\u300d\u306e\u3067\u306f\u306a\u304f\u300c\u7d44\u307f\u5408\u308f\u305b\u7684\u306b\u751f\u6210\u3055\u308c\u308b\u300d\u3053\u3068\u3092\u6570\u5b66\u7684\u306b\u4fdd\u8a3c\u3057\u307e\u3059\u3002\u6f5c\u5728\u7a7a\u9593\u6b21\u5143\u304c\u30a2\u30af\u30c6\u30a3\u30d6\u3067\u3042\u308b\u9650\u308a\u3001\u7d50\u5408\u3055\u308c\u305f\u30b3\u30fc\u30c9\u306f\u81ea\u7136\u306b\u30b3\u30fc\u30c9\u30d6\u30c3\u30af\u7a7a\u9593\u5168\u4f53\u3092\u30ab\u30d0\u30fc\u3057\u3001\u7406\u8ad6\u4e0a\u306f 100% \u306e\u4f7f\u7528\u7387\u304c\u9054\u6210\u3055\u308c\u307e\u3059\u3002</p> <p>\u8981\u7d04\u3059\u308b\u3068\u3001MagViT-v2 \u306e LFQ \u306f\u3001\u9ad8\u5727\u7e2e\u3001\u9ad8\u5fe0\u5b9f\u5ea6\u3001\u4f4e\u8a08\u7b97\u30b3\u30b9\u30c8\u306e\u7d71\u5408\u3092\u5b9f\u73fe\u3057\u3001\u7d30\u90e8\u306e\u30c6\u30af\u30b9\u30c1\u30e3\u640d\u5931\u3068\u6642\u7a7a\u9593\u4e00\u8cab\u6027\u306e\u4f4e\u4e0b\u3068\u3044\u3046\u5f93\u6765\u306e VQ-VAE \u306e\u6b20\u70b9\u3092\u5b8c\u5168\u306b\u89e3\u6c7a\u3057\u307e\u3059\u3002 Sora \u30b9\u30b1\u30fc\u30eb\u306e\u5927\u898f\u6a21\u30d3\u30c7\u30aa\u751f\u6210\u30e2\u30c7\u30eb\u3092\u69cb\u7bc9\u3059\u308b\u306b\u306f\u3001MagViT-v2 \u3068\u6d3e\u751f Tokenizer \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u304c\u696d\u754c\u3067\u597d\u307e\u308c\u308b\u9078\u629e\u80a2\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part3/3_3_video_audio/#83-whisperx","title":"8.3 \u30aa\u30fc\u30c7\u30a3\u30aa\u8abf\u6574: WhisperX \u3068\u5f37\u5236\u8abf\u6574","text":"<p>\u30d3\u30c7\u30aa\u306f\u5358\u306a\u308b\u8996\u899a\u30c7\u30fc\u30bf\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u97f3\u58f0 (\u30aa\u30fc\u30c7\u30a3\u30aa) \u306f\u3001\u81ea\u7136\u3067\u6642\u9593\u7684\u306b\u5bc6\u5ea6\u306e\u9ad8\u3044\u30c6\u30ad\u30b9\u30c8\u306e\u8aac\u660e\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002\u97f3\u58f0\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u300c\u7206\u767a\u97f3\u306f\u7206\u767a\u5149\u306b\u5bfe\u5fdc\u3059\u308b\u300d\u300c\u6ce3\u304d\u58f0\u306f\u6d99\u306b\u5bfe\u5fdc\u3059\u308b\u300d\u306a\u3069\u3001\u8907\u6570\u306e\u30e2\u30fc\u30c0\u30eb\u306a\u95a2\u9023\u4ed8\u3051\u3092\u30e2\u30c7\u30eb\u306b\u5b66\u7fd2\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <p>\u305f\u3060\u3057\u3001\u901a\u5e38\u306e ASR (\u751f\u306e Whisper \u306a\u3069) \u306f\u300c\u6587\u30ec\u30d9\u30eb\u300d\u306e\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u306e\u307f\u3092\u63d0\u4f9b\u3057\u3001\u901a\u5e38\u306f 1 \uff5e 2 \u79d2\u306e\u30a8\u30e9\u30fc\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u3053\u308c\u3067\u306f\u3001\u7d30\u304b\u3044\u30d3\u30c7\u30aa \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 (\u30ea\u30c3\u30d7\u30b7\u30f3\u30af\u306a\u3069) \u306b\u306f\u307e\u3063\u305f\u304f\u4e0d\u5341\u5206\u3067\u3059\u3002 WhisperX \u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p> \u56f3 8-2: \u901a\u5e38\u306e ASR (\u30bb\u30b0\u30e1\u30f3\u30c8 \u30ec\u30d9\u30eb) \u3068 WhisperX (\u5358\u8a9e/\u97f3\u7d20\u30ec\u30d9\u30eb) \u306e\u7cbe\u5ea6\u306e\u6bd4\u8f03</p>"},{"location":"ja/part3/3_3_video_audio/#831","title":"8.3.1 \u306a\u305c\u5f37\u5236\u7684\u306b\u4f4d\u7f6e\u5408\u308f\u305b\u3092\u884c\u3046\u306e\u304b?","text":"<ul> <li>ASR (OpenAI Whisper):<ul> <li>\u51fa\u529b: <code>\"Hello world\"</code> -&gt; <code>Timestamp: [0_0s -&gt; 2_0s]</code></li> <li>\u554f\u984c: \u30e2\u30c7\u30eb\u306f\u3001\u6587\u304c\u3053\u306e 2 \u79d2\u4ee5\u5185\u306b\u542b\u307e\u308c\u308b\u3053\u3068\u306e\u307f\u3092\u8a8d\u8b58\u3057\u3066\u304a\u308a\u3001\u300cworld\u300d\u304c\u3044\u3064\u59cb\u307e\u308b\u304b\u306f\u6b63\u78ba\u306b\u306f\u8a8d\u8b58\u3057\u3066\u3044\u307e\u305b\u3093\u3002</li> </ul> </li> <li>\u5f37\u5236\u30a2\u30e9\u30a4\u30e1\u30f3\u30c8 (WhisperX):<ul> <li>\u539f\u5247: \u307e\u305a\u30c6\u30ad\u30b9\u30c8\u306b\u66f8\u304d\u8d77\u3053\u3057\u3066\u304b\u3089\u3001\u4e8b\u524d\u306b\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u97f3\u97ff\u30e2\u30c7\u30eb (Wav2Vec2 \u306a\u3069) \u3092\u4f7f\u7528\u3057\u3066\u3001\u30c6\u30ad\u30b9\u30c8\u5185\u306e \u97f3\u7d20 \u3092\u97f3\u58f0\u6ce2\u5f62\u3068\u5f37\u5236\u7684\u306b\u4e00\u81f4\u3055\u305b\u307e\u3059\u3002</li> <li>\u51fa\u529b:<ul> <li><code>\"Hello\"</code>: <code>[0_12s -&gt; 0_58s]</code></li> <li><code>\"world\"</code>: <code>[0_85s -&gt; 1_45s]</code></li> </ul> </li> <li>\u5024: \u6b21\u306e\u3088\u3046\u306a\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30da\u30a2\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059: \u30d3\u30c7\u30aa \u30d5\u30ec\u30fc\u30e0\u304c 0_85 \u79d2\u306e\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306b\u300c\u4e16\u754c\u300d\u306e\u30c6\u30ad\u30b9\u30c8Embedding\u306b\u7126\u70b9\u3092\u5f53\u3066\u308b\u3088\u3046\u306b\u5f37\u5236\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u512a\u308c\u305f\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30a2\u30e9\u30a4\u30e1\u30f3\u30c8\u306e\u57fa\u790e\u3067\u3059\u3002</li> </ul> </li> </ul>"},{"location":"ja/part3/3_3_video_audio/#832-whisperx","title":"8.3.2 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5: WhisperX \u30d5\u30eb \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>WhisperX \u306f\u3001VAD (\u97f3\u58f0\u30a2\u30af\u30c6\u30a3\u30d3\u30c6\u30a3\u691c\u51fa)\u3001Whisper (\u6587\u5b57\u8d77\u3053\u3057)\u3001Wav2Vec2 (\u4f4d\u7f6e\u5408\u308f\u305b)\u3001\u304a\u3088\u3073 Pyannote (\u8a71\u8005\u30c0\u30a4\u30a2\u30ea\u30bc\u30fc\u30b7\u30e7\u30f3) \u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u8907\u96d1\u306a\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u3059\u3002</p> <pre><code>import whisperx\nimport gc\nimport torch\n\ndef align_audio_transcript(audio_file, device=\"cuda\", batch_size=16):\n    \"\"\"\n    Use WhisperX for transcription and word-level forced alignment\n    \"\"\"\n    # Step 1: Transcription\n    # Use Large-v2 model for transcript accuracy\n    # compute_type=\"float16\" significantly speeds up, but requires Ampere+ GPU (A100/A10/3090/4090)\n    print(\"1. Loading Whisper model...\")\n    model = whisperx.load_model(\n        \"large-v2\", \n        device, \n        compute_type=\"float16\" \n    )\n\n    print(\"2. Transcribing...\")\n    audio = whisperx.load_audio(audio_file)\n    result = model.transcribe(audio, batch_size=batch_size)\n\n    # Critical: VRAM management\n    # Whisper model is huge, and the next Alignment model is also VRAM-heavy.\n    # Must explicitly delete model and trigger garbage collection, otherwise easily OOM (Out of Memory).\n    del model\n    gc.collect()\n    torch.cuda.empty_cache()\n\n    # Step 2: Forced Alignment\n    # Auto-loads corresponding language Wav2Vec2 model (e.g., wav2vec2-large-960h for English)\n    print(\"3. Aligning...\")\n    model_a, metadata = whisperx.load_align_model(\n        language_code=result[\"language\"], \n        device=device\n    )\n\n    # align() executes a Dynamic Programming-like algorithm\n    # finding best matching path between text phoneme sequence and audio waveform features\n    aligned_result = whisperx.align(\n        result[\"segments\"], \n        model_a, \n        metadata, \n        audio, \n        device, \n        return_char_alignments=False # Set True for character-level alignment (e.g., for karaoke subtitles)\n    )\n\n    # Result contains word_segments with precise start/end for each word\n    # e.g.: [{'word': 'Hello', 'start': 0_1, 'end': 0_5, 'score': 0_98}, ...]\n    return aligned_result\n\n# Advanced tip:\n# For speaker diarization (who said what), further call:\n# diarize_model = whisperx.DiarizationPipeline(use_auth_token=\"YOUR_HF_TOKEN\", device=device)\n# diarize_segments = diarize_model(audio)\n# whisperx.assign_word_speakers(diarize_segments, aligned_result)\n</code></pre>"},{"location":"ja/part3/3_3_video_audio/#833","title":"8.3.3 \u672c\u756a\u74b0\u5883\u306e\u843d\u3068\u3057\u7a74","text":"<ol> <li> <p>VAD \u306e\u8aa4\u3063\u305f\u5224\u65ad\u3068 BGM \u306e\u59a8\u5bb3:</p> <ul> <li>\u554f\u984c: WhisperX \u306f\u3001\u30b5\u30a4\u30ec\u30f3\u30c8 \u30bb\u30b0\u30e1\u30f3\u30c8\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u5316\u306b VAD \u306b\u5927\u304d\u304f\u4f9d\u5b58\u3057\u3066\u3044\u307e\u3059\u3002\u30d3\u30c7\u30aa\u306e BGM \u304c\u5927\u304d\u3044\u5834\u5408\u3001VAD \u306f\u30bb\u30b0\u30e1\u30f3\u30c8\u5168\u4f53\u3092\u97f3\u58f0\u3068\u3057\u3066\u51e6\u7406\u3059\u308b\u304b\u3001\u305d\u306e\u9006\u306e\u5834\u5408\u304c\u3042\u308a\u3001\u97f3\u58f0\u304c\u304b\u304d\u6d88\u3055\u308c\u307e\u3059\u3002</li> <li>\u89e3\u6c7a\u7b56: \u30bd\u30fc\u30b9\u5206\u96e2\u306e\u305f\u3081\u306b Demucs \u307e\u305f\u306f Spleeter \u3092\u5c0e\u5165\u3057\u307e\u3059\u3002</li> <li>\u30d5\u30ed\u30fc: <code>Raw Audio</code> -&gt; <code>Demucs (Extract Vocal Track)</code> -&gt; <code>WhisperX</code>\u3002\u62bd\u51fa\u3055\u308c\u305f\u7d14\u7c8b\u306a\u30dc\u30fc\u30ab\u30eb \u30c8\u30e9\u30c3\u30af\u306e\u307f\u3092\u8a8d\u8b58\u306b\u30d5\u30a3\u30fc\u30c9\u3057\u3066\u3001\u7cbe\u5ea6\u3092\u5927\u5e45\u306b\u9ad8\u3081\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u30de\u30eb\u30c1\u30b9\u30d4\u30fc\u30ab\u30fc\u30aa\u30fc\u30d0\u30fc\u30e9\u30c3\u30d7 (\u30aa\u30fc\u30d0\u30fc\u30e9\u30c3\u30d7\u30b9\u30d4\u30fc\u30c1):</p> <ul> <li>\u554f\u984c: Whisper \u306f\u8907\u6570\u306e\u4eba\u304c\u540c\u6642\u306b\u8a71\u3057\u3066\u3044\u308b\u5834\u5408 (\u30ab\u30af\u30c6\u30eb \u30d1\u30fc\u30c6\u30a3\u30fc\u306e\u554f\u984c) \u306b\u5f31\u304f\u3001\u901a\u5e38\u306f\u6700\u3082\u58f0\u306e\u5927\u304d\u3044\u4eba\u3060\u3051\u3092\u6587\u5b57\u306b\u8d77\u3053\u3059\u304b\u3001\u6df7\u4e71\u3057\u305f\u30c6\u30ad\u30b9\u30c8\u3092\u751f\u6210\u3057\u307e\u3059\u3002</li> <li>\u89e3\u6c7a\u7b56: <code>diarization=True</code> \u3092\u6709\u52b9\u306b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u63a8\u8ad6\u6642\u9593\u304c 30% \uff5e 50% \u5897\u52a0\u3057\u307e\u3059\u304c\u3001\u30c6\u30ec\u30d3 \u30c9\u30e9\u30de\u3084\u30a4\u30f3\u30bf\u30d3\u30e5\u30fc \u30af\u30e9\u30b9\u306e\u30d3\u30c7\u30aa \u30c7\u30fc\u30bf\u306e\u5834\u5408\u3001\u3053\u308c\u304c\u300c\u8ab0\u304c\u4f55\u3092\u8a00\u3063\u305f\u304b\u300d\u3092\u533a\u5225\u3059\u308b\u552f\u4e00\u306e\u65b9\u6cd5\u3067\u3042\u308a\u3001\u30ad\u30e3\u30e9\u30af\u30bf\u30fc\u306e\u30a2\u30a4\u30c7\u30f3\u30c6\u30a3\u30c6\u30a3\u306b\u95a2\u3059\u308b\u30e2\u30c7\u30eb\u306e\u6df7\u4e71\u3092\u907f\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u5e7b\u899a\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7:</p> <ul> <li>\u554f\u984c: \u3055\u3055\u3084\u304d\u58f0\u306f\u3001\u9577\u3044\u6c88\u9ed9\u307e\u305f\u306f\u7d14\u7c8b\u306a\u97f3\u697d\u30bb\u30b0\u30e1\u30f3\u30c8\u4e2d\u306b\u300c\u5e7b\u899a\u300d\u3092\u5f15\u304d\u8d77\u3053\u3059\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u9593\u9055\u3063\u305f\u30bf\u30a4\u30e0\u30b9\u30bf\u30f3\u30d7\u3067\u524d\u306e\u6b4c\u8a5e\u3092\u7e70\u308a\u8fd4\u3057\u307e\u3059\u3002</li> <li>\u30c1\u30a7\u30c3\u30af: \u5f8c\u51e6\u7406\u3067\u3001<code>word['score']</code> (\u4fe1\u983c\u6027) \u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\u9023\u7d9a\u3057\u305f\u5358\u8a9e\u306e\u6587\u5b57\u5217\u306e\u4fe1\u983c\u5ea6\u304c 0_4 \u672a\u6e80\u306e\u5834\u5408\u306f\u3001\u305d\u306e\u30bb\u30b0\u30e1\u30f3\u30c8\u306e\u30a2\u30e9\u30a4\u30f3\u30e1\u30f3\u30c8\u3092\u7834\u68c4\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002</li> </ul> </li> </ol>"},{"location":"ja/part4/4_1_sft_data/","title":"\u7b2c9\u7ae0: SFT\u30c7\u30fc\u30bf","text":""},{"location":"ja/part4/4_1_sft_data/#9-sft-sft","title":"\u7b2c 9 \u7ae0: SFT\u30c7\u30fc\u30bf (SFT \u30c7\u30fc\u30bf) \u2014\u2014 \u30e2\u30c7\u30eb\u306e\u300c\u884c\u52d5\u898f\u7bc4\u300d\u306e\u69cb\u7bc9","text":""},{"location":"ja/part4/4_1_sft_data/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001\u5927\u898f\u6a21\u8a00\u8a9e\u30e2\u30c7\u30eb (LLM) \u306e\u30e9\u30a4\u30d5\u30b5\u30a4\u30af\u30eb\u306b\u304a\u3051\u308b\u91cd\u8981\u306a\u6bb5\u968e\u3001\u3064\u307e\u308a\u300c\u4e00\u822c\u7684\u306a\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u300d\u304b\u3089\u300c\u7279\u5b9a\u306e\u547d\u4ee4\u306b\u5f93\u3046\u300d\u3078\u306e\u91cd\u8981\u306a\u79fb\u884c\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u8aac\u660e\u3057\u307e\u3059\u3002\u79c1\u305f\u3061\u306f\u5358\u7d14\u306a\u30c7\u30fc\u30bf\u53ce\u96c6\u3092\u8d85\u3048\u3066\u3001\u9ad8\u5ea6\u306b\u8a2d\u8a08\u3055\u308c\u305f Prompt \u30b7\u30b9\u30c6\u30e0\u3068\u81ea\u52d5\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 (Self-Instruct\u3001Evol-Instruct) \u3092\u901a\u3058\u3066\u9ad8\u54c1\u8cea\u306e SFT (\u6559\u5e2b\u3042\u308a\u5fae\u8abf\u6574) \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002\u6280\u8853\u7684\u306a\u5b9f\u88c5\u3060\u3051\u3067\u306a\u304f\u3001\u7406\u8ad6\u7684\u57fa\u790e\u3082\u5206\u6790\u3057\u307e\u3059\u3002\u306a\u305c\u5c11\u91cf\u306e\u9ad8\u54c1\u8cea\u306a\u30c7\u30fc\u30bf\u304b\u3089\u81a8\u5927\u306a\u30e2\u30c7\u30eb\u306e\u6a5f\u80fd\u3092\u89e3\u304d\u653e\u3064\u3053\u3068\u304c\u3067\u304d\u308b\u306e\u3067\u3057\u3087\u3046\u304b?\u79c1\u305f\u3061\u306f\u3001\u30c7\u30fc\u30bf\u306e\u591a\u69d8\u6027\u306e\u4e0d\u8db3\u3001\u547d\u4ee4\u306e\u8907\u96d1\u3055\u306e\u4e0d\u5341\u5206\u3055\u3001\u63a8\u8ad6\u80fd\u529b\u306e\u4e0d\u8db3\u306b\u5bfe\u51e6\u3059\u308b\u3053\u3068\u306b\u91cd\u70b9\u3092\u7f6e\u304d\u3001\u6700\u7d42\u7684\u306b\u306f\u77e5\u8b58\u3068\u30eb\u30fc\u30eb\u306e\u4e21\u65b9\u3092\u7406\u89e3\u3059\u308b\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30c8\u306a\u30a8\u30fc\u30b8\u30a7\u30f3\u30c8\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u53cd\u5fa9\u7684\u306a\u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30f3\u30d7\u30c8 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3092\u30de\u30b9\u30bf\u30fc: \u30e2\u30c7\u30eb\u306e\u51fa\u529b\u5f62\u5f0f\u3001\u30b9\u30bf\u30a4\u30eb\u3001\u6df1\u3055\u3092\u5236\u5fa1\u3059\u308b\u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u30ed\u30fc\u30eb\u306e\u5b9a\u7fa9\u304c\u30c7\u30fc\u30bf\u5206\u6563\u306b\u3069\u306e\u3088\u3046\u306a\u5f71\u97ff\u3092\u4e0e\u3048\u308b\u304b\u3092\u7406\u89e3\u3057\u307e\u3059\u3002</li> <li>\u81ea\u52d5\u30c7\u30fc\u30bf\u751f\u6210\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u6df1\u3044\u7406\u89e3: Self-Instruct \u304a\u3088\u3073 Evol-Instruct \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u518d\u73fe\u304a\u3088\u3073\u6539\u5584\u3057\u3001\u30c9\u30e1\u30a4\u30f3\u547d\u4ee4\u30bb\u30c3\u30c8\u3092\u6700\u521d\u304b\u3089\u69cb\u7bc9\u3057\u3001\u305d\u306e\u80cc\u5f8c\u306b\u3042\u308b\u300c\u6559\u5e2b\u3068\u751f\u5f92\u300d\u306e\u84b8\u7559\u30ed\u30b8\u30c3\u30af\u3092\u7406\u89e3\u3057\u307e\u3059\u3002</li> <li>\u601d\u8003\u9023\u9396 (CoT) \u30c7\u30fc\u30bf\u306e\u69cb\u7bc9\u65b9\u6cd5\u3092\u5b66\u7fd2\u3057\u307e\u3059: \u660e\u793a\u7684\u306a\u63a8\u8ad6\u30b9\u30c6\u30c3\u30d7\u3092\u901a\u3058\u3066\u30e2\u30c7\u30eb \u30ed\u30b8\u30c3\u30af\u3092\u5f37\u5316\u3057\u3001\u30c8\u30e9\u30f3\u30b9\u30d5\u30a9\u30fc\u30de\u30fc\u306e\u300c\u30d6\u30e9\u30c3\u30af \u30dc\u30c3\u30af\u30b9\u300d\u30de\u30c3\u30d4\u30f3\u30b0\u3092\u6253\u3061\u7834\u308a\u307e\u3059\u3002</li> <li>\u30c7\u30fc\u30bf \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3068\u91cd\u8907\u6392\u9664\u30e1\u30ab\u30cb\u30ba\u30e0\u306e\u8a2d\u8a08: ROUGE \u91cd\u8907\u6392\u9664\u304b\u3089\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af \u30d9\u30af\u30c8\u30eb \u30af\u30e9\u30b9\u30bf\u30ea\u30f3\u30b0\u307e\u3067\u306e\u9ad8\u5ea6\u306a\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u6226\u7565\u3092\u30de\u30b9\u30bf\u30fc\u3057\u3001\u5408\u6210\u30c7\u30fc\u30bf\u306e\u54c1\u8cea\u3068\u591a\u69d8\u6027\u3092\u78ba\u4fdd\u3057\u307e\u3059\u3002</li> </ul> <p>\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb: \u300c\u3042\u306a\u305f\u306e\u30c1\u30fc\u30e0\u304c 70B \u30d1\u30e9\u30e1\u30fc\u30bf\u30fc\u306e\u57fa\u672c\u30e2\u30c7\u30eb\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3092\u7d42\u3048\u305f\u3068\u3053\u308d\u3060\u3068\u60f3\u50cf\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u8a08\u7b97\u306b\u6570\u767e\u4e07\u30c9\u30eb\u3092\u8cbb\u3084\u3057\u3001\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306e\u307b\u307c\u3059\u3079\u3066\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u8aad\u3093\u3067\u3044\u307e\u3059\u3002\u3053\u306e\u6642\u70b9\u3067\u306f\u3001\u77e5\u8b58\u306f\u8c4a\u5bcc\u3060\u304c\u5185\u5411\u7684\u306a\u56f3\u66f8\u9928\u54e1\u306e\u3088\u3046\u306a\u3082\u306e\u3067\u3001\u982d\u306e\u4e2d\u306f\u30b7\u30a7\u30a4\u30af\u30b9\u30d4\u30a2\u306e\u622f\u66f2\u3001Python \u30b3\u30fc\u30c9\u3001\u91cf\u5b50\u529b\u5b66\u306e\u516c\u5f0f\u3067\u3044\u3063\u3071\u3044\u3067\u3059\u3002\u305d\u308c\u3067\u3082\u3001\u30c7\u30e2\u3067\u8208\u596e\u3057\u3066\u300c\u6e1b\u91cf\u8a08\u753b\u306e\u4f5c\u6210\u3092\u624b\u4f1d\u3063\u3066\u304f\u3060\u3055\u3044\u300d\u3068\u5165\u529b\u3059\u308b\u3068\u3001\u30e2\u30c7\u30eb\u306f\u6a5f\u68b0\u7684\u306b\u6b21\u306e\u3088\u3046\u306b\u7d9a\u884c\u3057\u307e\u3059\u3002 \u300c...\u306f\u826f\u3044\u76ee\u6a19\u3067\u3059\u3002\u901a\u5e38\u306f\u98df\u4e8b\u3068\u904b\u52d5\u304c\u542b\u307e\u308c\u307e\u3059\u3002\u300d\u3042\u308b\u3044\u306f\u300c\u6e1b\u91cf\u8a08\u753b\u306e\u5b9a\u7fa9\u300d\u3092\u66f8\u304d\u59cb\u3081\u3066\u3001\u30a6\u30a3\u30ad\u30da\u30c7\u30a3\u30a2\u98a8\u306e\u30ca\u30f3\u30bb\u30f3\u30b9\u306e\u5c71\u3092\u751f\u6210\u3057\u307e\u3059\u3002</p> <p>\u306a\u305c\u3053\u306e\u3088\u3046\u306a\u3053\u3068\u304c\u8d77\u3053\u308b\u306e\u3067\u3057\u3087\u3046\u304b?\u57fa\u672c\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u76ee\u6a19\u306f\u300c\u6b21\u306e\u30c8\u30fc\u30af\u30f3\u3092\u4e88\u6e2c\u3059\u308b\u300d\u3053\u3068\u3067\u3042\u308b\u305f\u3081\u3001\u300c\u547d\u4ee4\u300d\u3068\u300c\u5fdc\u7b54\u300d\u306e\u76f8\u4e92\u4f5c\u7528\u30d1\u30bf\u30fc\u30f3\u3092\u7406\u89e3\u3057\u3066\u3044\u307e\u305b\u3093\u3002\u3053\u306e\u300c\u5b66\u8005\u300d\u3092\u3042\u306a\u305f\u306e\u610f\u56f3\u3092\u7406\u89e3\u3059\u308b\u500b\u4eba\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u306b\u5909\u3048\u308b\u306b\u306f\u3001\u4f55\u5343\u3082\u306e\u8cea\u306e\u9ad8\u3044 Q&amp;A \u30da\u30a2\u3092\u4e0e\u3048\u3066\u3001\u8a71\u3057\u65b9\u3084\u554f\u984c\u306e\u89e3\u6c7a\u65b9\u6cd5\u3092\u6bb5\u968e\u7684\u306b\u6559\u3048\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u3001100,000 \u500b\u306e\u547d\u4ee4\u3092\u624b\u52d5\u3067\u8a18\u8ff0\u3059\u308b\u306e\u306f\u8cbb\u7528\u304c\u304b\u304b\u308a\u3001\u6642\u9593\u304c\u304b\u304b\u308a\u3001\u4eba\u9593\u306e\u60f3\u50cf\u529b\u306f\u7279\u5b9a\u306e\u30d1\u30bf\u30fc\u30f3\u306b\u9650\u5b9a\u3055\u308c\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u5927\u898f\u6a21\u306a\u4eba\u306b\u3088\u308b\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306b\u983c\u3089\u305a\u306b\u3001\u8907\u96d1\u304b\u3064\u591a\u69d8\u306a\u9ad8\u54c1\u8cea\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u3092\u81ea\u52d5\u7684\u306b\u751f\u6210\u3059\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u304b?\u3053\u308c\u304c\u3001\u3053\u306e\u7ae0\u3067\u53d6\u308a\u4e0a\u3052\u308b\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u4e0a\u306e\u4e3b\u8981\u306a\u8ab2\u984c\u3067\u3059\u3002\u300d</p>"},{"location":"ja/part4/4_1_sft_data/#91","title":"9.1\u3002\u4e2d\u6838\u3068\u306a\u308b\u6982\u5ff5\u3068\u539f\u5247 (\u6982\u5ff5\u3068\u539f\u5247)","text":"<p>SFT \u30d5\u30a7\u30fc\u30ba\u3067\u306f\u3001\u30c7\u30fc\u30bf\u306e\u91cf\u3088\u308a\u3082\u8cea\u304c\u306f\u308b\u304b\u306b\u91cd\u8981\u3067\u3042\u308b\u3068\u3044\u3046\u70b9\u3067\u3001\u696d\u754c\u306f\u30b3\u30f3\u30bb\u30f3\u30b5\u30b9\u306b\u9054\u3057\u307e\u3057\u305f\u3002\u79c1\u305f\u3061\u304c\u5fc5\u8981\u3068\u3059\u308b\u30c7\u30fc\u30bf\u306f\u3001\u5358\u306a\u308b\u300c\u5165\u51fa\u529b\u300d\u306e\u30da\u30a2\u3067\u306f\u306a\u304f\u3001\u3055\u307e\u3056\u307e\u306a\u30bf\u30b9\u30af\u306e\u7a2e\u985e\u3001\u8907\u96d1\u3055\u306e\u30ec\u30d9\u30eb\u3001\u63a8\u8ad6\u30d1\u30bf\u30fc\u30f3\u3092\u30ab\u30d0\u30fc\u3059\u308b\u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#911","title":"9.1.1 \u306a\u305c\u91cf\u3088\u308a\u3082\u54c1\u8cea\u304c\u91cd\u8981\u306a\u306e\u3067\u3057\u3087\u3046\u304b? \u2014 \u8868\u9762\u5f62\u72b6\u4eee\u8aac","text":"<p>\u591a\u304f\u306e\u521d\u5fc3\u8005\u306f\u3001SFT \u304c\u300c\u65b0\u3057\u3044\u77e5\u8b58\u3092\u5b66\u3076\u305f\u3081\u306e\u3082\u306e\u300d\u3067\u3042\u308b\u3068\u8aa4\u89e3\u3057\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001LIMA (Less Is More for Alignment) \u306a\u3069\u306e\u53e4\u5178\u7684\u306a\u7814\u7a76\u306e\u7d50\u679c\u306b\u57fa\u3065\u304f\u3068\u3001SFT \u306e\u4e2d\u5fc3\u7684\u306a\u5f79\u5272\u306f\u3001\u77e5\u8b58\u3092\u6ce8\u5165\u3059\u308b\u3053\u3068\u3067\u306f\u306a\u304f\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3092\u8abf\u6574\u3059\u308b\u3053\u3068\u3067\u3059\u3002</p> <p>\u66f2\u9762\u5f62\u72b6\u4eee\u8aac\u3067\u306f\u3001\u30e2\u30c7\u30eb\u306f\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306b\u4e16\u754c\u306e\u77e5\u8b58\u3068\u8ad6\u7406\u7684\u80fd\u529b\u306e\u5927\u90e8\u5206\u3092\u3059\u3067\u306b\u7372\u5f97\u3057\u3066\u3044\u308b\u3068\u4eee\u5b9a\u3057\u307e\u3059\u3002 SFT \u306f\u3001\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u304b\u3089\u6f5c\u5728\u7684\u306a\u6a5f\u80fd\u3092\u62bd\u51fa\u3059\u308b\u305f\u3081\u306e\u7279\u5b9a\u306e\u300c\u5bfe\u8a71\u5f62\u5f0f\u300d\u307e\u305f\u306f\u300c\u30b9\u30bf\u30a4\u30eb\u300d\u3092\u30e2\u30c7\u30eb\u306b\u6559\u3048\u308b\u3060\u3051\u3067\u3059\u3002\u8a00\u3044\u63db\u3048\u308c\u3070\u3001\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u304c\u30e2\u30c7\u30eb\u306b\u56f3\u66f8\u9928\u5168\u4f53\u3092\u8aad\u307e\u305b\u308b\u3088\u3046\u306a\u3082\u306e\u3060\u3068\u3059\u308b\u3068\u3001SFT \u306f\u672c\u306e\u5185\u5bb9\u3067\u306f\u306a\u304f\u3001\u4eba\u9593\u304c\u597d\u3080\u53e3\u8abf\u3067\u7b54\u3048\u308b\u65b9\u6cd5\u3060\u3051\u3092\u30e2\u30c7\u30eb\u306b\u6559\u3048\u307e\u3059\u3002</p> <p>\u3053\u308c\u306f\u3001\u30c7\u30fc\u30bf\u306b\u30a8\u30e9\u30fc\u3001\u30ce\u30a4\u30ba\u3001\u307e\u305f\u306f\u8ad6\u7406\u30ae\u30e3\u30c3\u30d7\u304c\u542b\u307e\u308c\u308b\u3068\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u6025\u6fc0\u306b\u4f4e\u4e0b\u3059\u308b\u7406\u7531\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u30e2\u30c7\u30eb\u304c\u300c\u77e5\u8b58\u306b\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4ed8\u3051\u308b\u65b9\u6cd5\u300d\u3092\u5b66\u7fd2\u3057\u3066\u3044\u308b\u305f\u3081\u3067\u3059\u3002\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u3068\u3001\u3069\u308c\u3060\u3051\u306e\u77e5\u8b58\u3092\u6b63\u3057\u304f\u53d6\u5f97\u3059\u308b\u3053\u3068\u3082\u3067\u304d\u307e\u305b\u3093\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u6570\u5343\u306e\u9ad8\u54c1\u8cea\u3067\u591a\u69d8\u6027\u306e\u9ad8\u3044\u30b5\u30f3\u30d7\u30eb\u306f\u3001\u6570\u767e\u4e07\u306e\u4f4e\u54c1\u8cea\u3067\u5747\u8cea\u306a\u30b5\u30f3\u30d7\u30eb\u3088\u308a\u3082\u512a\u308c\u305f\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#912","title":"9.1.2 \u8fc5\u901f\u306a\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306b\u95a2\u3059\u308b\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u89b3\u70b9","text":"<p>\u30c7\u30fc\u30bf\u5408\u6210\u306b\u304a\u3044\u3066\u3001\u30d7\u30ed\u30f3\u30d7\u30c8\u306f\u5358\u306a\u308b\u30c0\u30a4\u30a2\u30ed\u30b0\u5165\u529b\u3067\u306f\u306a\u304f\u3001\u30c7\u30fc\u30bf\u3092\u751f\u6210\u3059\u308b\u305f\u3081\u306e\u30bd\u30fc\u30b9 \u30b3\u30fc\u30c9\u306b\u306a\u308a\u307e\u3059\u3002\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u30d7\u30ed\u30b0\u30e9\u30e0\u53ef\u80fd\u306a\u30e2\u30b8\u30e5\u30fc\u30eb\u3068\u3057\u3066\u6271\u3044\u3001\u53cd\u5fa9\u7684\u306a\u6700\u9069\u5316\u3092\u901a\u3058\u3066\u5408\u6210\u30c7\u30fc\u30bf\u306e\u5206\u5e03\u3092\u5236\u5fa1\u3057\u307e\u3059\u3002\u512a\u308c\u305f\u30d7\u30ed\u30f3\u30d7\u30c8 \u30b7\u30b9\u30c6\u30e0\u306b\u306f\u901a\u5e38\u3001\u6b21\u306e\u3082\u306e\u304c\u542b\u307e\u308c\u307e\u3059\u3002</p> <ul> <li>\u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30f3\u30d7\u30c8: \u30c7\u30fc\u30bf \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u30fc\u306e\u300c\u30da\u30eb\u30bd\u30ca\u300d\u3068\u300c\u5883\u754c\u300d\u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u5358\u306b\u30a2\u30a4\u30c7\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u5272\u308a\u5f53\u3066\u308b\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30ed\u30fc\u30eb\u30d7\u30ec\u30a4\u30f3\u30b0\u3092\u901a\u3058\u3066\u30e2\u30c7\u30eb\u306e\u6f5c\u5728\u7684\u306a\u9818\u57df\u56fa\u6709\u306e\u8a9e\u5f59\u5206\u5e03\u3092\u6d3b\u6027\u5316\u3057\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300c\u53b3\u683c\u306a\u5f01\u8b77\u58eb\u300d\u3068\u300c\u71b1\u5fc3\u306a\u55b6\u696d\u30de\u30f3\u300d\u3092\u6f14\u3058\u308b\u3068\u3001\u660e\u3089\u304b\u306b\u7570\u306a\u308b\u6587\u69cb\u9020\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002</li> <li>\u5c11\u6570\u30b7\u30e7\u30c3\u30c8\u306e\u4f8b: \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u5b66\u7fd2\u3092\u901a\u3058\u3066\u51fa\u529b\u5f62\u5f0f\u3068\u30b9\u30bf\u30a4\u30eb\u3092\u56fa\u5b9a\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u4f8b\u306f\u300c\u30ce\u30a4\u30ba\u9664\u53bb\u300d\u3068\u3057\u3066\u6a5f\u80fd\u3057\u3001\u30e2\u30c7\u30eb\u306b\u300c\u3053\u308c\u304c\u79c1\u304c\u671b\u3080\u6a19\u6e96\u7684\u306a\u7b54\u3048\u3067\u3059\u300d\u3068\u4f1d\u3048\u307e\u3059\u3002</li> <li>\u8ca0\u306e\u5236\u7d04: \u30e2\u30c7\u30eb\u304c\u7279\u5b9a\u306e\u30c7\u30fc\u30bf \u30d1\u30bf\u30fc\u30f3\u3092\u751f\u6210\u3059\u308b\u3053\u3068\u3092\u660e\u793a\u7684\u306b\u7981\u6b62\u3057\u307e\u3059\u3002 LLM \u751f\u6210\u3067\u306f\u3001\u30e2\u30c7\u30eb\u304c\u9045\u5ef6\u3057\u305f\u308a\u3001\u4e00\u822c\u7684\u306a\u6c7a\u307e\u308a\u6587\u53e5\u3092\u4f7f\u7528\u3057\u305f\u308a\u3059\u308b\u50be\u5411\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u7d71\u8a08\u7684\u6163\u6027\u3092\u6253\u3061\u7834\u308b\u306b\u306f\u3001\u5426\u5b9a\u7684\u306a\u5236\u7d04\u304c\u9375\u3068\u306a\u308a\u307e\u3059\uff08\u4f8b\uff1a\u300c\u7269\u8a9e\u306e\u5192\u982d\u306b\u300e\u3080\u304b\u3057\u3080\u304b\u3057\u3001\u5c71\u304c\u3042\u308a\u307e\u3057\u305f\u300f\u3092\u4f7f\u7528\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\uff09\u3002\u300d</li> </ul>"},{"location":"ja/part4/4_1_sft_data/#913","title":"9.1.3 \u81ea\u52d5\u5316\u3055\u308c\u305f\u5efa\u8a2d\u624b\u6cd5","text":"<p>\u4eba\u9593\u30c7\u30fc\u30bf\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u6253\u7834\u3059\u308b\u305f\u3081\u306b\u3001\u696d\u754c\u306f 2 \u3064\u306e\u4e2d\u5fc3\u7684\u306a\u6226\u7565\u3092\u9032\u5316\u3055\u305b\u3066\u304d\u307e\u3057\u305f\u3002\u30d0\u30e9\u30f3\u30b9\u306e\u53d6\u308c\u305f\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u306b\u306f\u3001\u305d\u308c\u3089\u306e\u9055\u3044\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u304c\u91cd\u8981\u3067\u3059\u3002</p> <ul> <li>\u81ea\u5df1\u6307\u5c0e: \u5e45\u5e83\u3044\u306b\u7126\u70b9\u3092\u5f53\u3066\u307e\u3059\u3002\u5f37\u529b\u306a\u30e2\u30c7\u30eb (GPT-4 \u306a\u3069) \u3092\u4f7f\u7528\u3057\u3066\u3001\u5c11\u6570\u306e\u30b7\u30fc\u30c9 \u30bf\u30b9\u30af\u304b\u3089\u591a\u304f\u306e\u65b0\u3057\u3044\u30bf\u30b9\u30af\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u305d\u306e\u4e2d\u5fc3\u7684\u306a\u524d\u63d0: \u30e2\u30c7\u30eb\u306f\u5341\u5206\u306a\u30bf\u30b9\u30af \u30bf\u30a4\u30d7\u3092\u78ba\u8a8d\u3057\u3066\u3044\u307e\u3059\u3002\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u901a\u3058\u3066\u305d\u308c\u3089\u3092\u8a98\u5c0e\u3059\u308b\u3060\u3051\u3067\u6e08\u307f\u307e\u3059\u3002</li> <li>Evol-Instruct: \u6df1\u3055\u306b\u7126\u70b9\u3092\u5f53\u3066\u307e\u3059\u3002\u7279\u5b9a\u306e\u9032\u5316\u6f14\u7b97\u5b50 (\u300c\u5236\u7d04\u3092\u8ffd\u52a0\u3059\u308b\u300d\u3001\u300c\u63a8\u8ad6\u3092\u6df1\u3081\u308b\u300d\u306a\u3069) \u3092\u4f7f\u7528\u3057\u3066\u3001\u5358\u7d14\u306a\u547d\u4ee4\u3092\u8907\u96d1\u306a\u547d\u4ee4\u306b\u66f8\u304d\u63db\u3048\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u5358\u7d14\u3067\u77ed\u3044\u547d\u4ee4\u3092\u751f\u6210\u3059\u308b Self-Instruct \u306e\u50be\u5411\u306b\u76f4\u63a5\u5bfe\u51e6\u3057\u3001\u30e2\u30c7\u30eb\u306e\u8ad6\u7406\u7684\u8907\u96d1\u3055\u3068\u5236\u7d04\u3092\u6e80\u305f\u3059\u3053\u3068\u3092\u5f37\u5236\u3057\u307e\u3059\u3002</li> </ul> <p> \u56f3 9-1: Self-Instruct \u3068 Evol-Instruct \u306e\u6bd4\u8f03</p> <p>\u8868 9-1: \u4e3b\u6d41\u306e\u547d\u4ee4\u30c7\u30fc\u30bf\u69cb\u7bc9\u6226\u7565\u306e\u6bd4\u8f03</p> \u7279\u96c6 \u624b\u52d5\u6ce8\u91c8 \u81ea\u5df1\u6307\u5c0e Evol-Instruct \u4e2d\u5fc3\u7684\u306a\u76ee\u6a19 \u975e\u5e38\u306b\u7cbe\u5ea6\u306e\u9ad8\u3044\u3001\u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306e\u77e5\u8b58 \u30bf\u30b9\u30af\u306e\u591a\u69d8\u6027\u3092\u9ad8\u3081\u308b \u30bf\u30b9\u30af\u306e\u8907\u96d1\u3055\u306e\u5897\u52a0 \u30b3\u30b9\u30c8 \u975e\u5e38\u306b\u9ad8\u3044 (1 \u30a2\u30a4\u30c6\u30e0\u3042\u305f\u308a $1 \uff5e $10) \u4f4e\u4fa1\u683c ($0.01/\u30a2\u30a4\u30c6\u30e0) \u4e2d ($0.03/\u30a2\u30a4\u30c6\u30e0\u3001\u8907\u6570\u56de\u306e\u901a\u8a71\u304c\u5fc5\u8981) \u5165\u529b\u30bd\u30fc\u30b9 \u30c9\u30e1\u30a4\u30f3\u306e\u5c02\u9580\u5bb6 \u30b7\u30fc\u30c9\u30bf\u30b9\u30af\u30d7\u30fc\u30eb \u65e2\u5b58\u306e\u7c21\u5358\u306a\u6307\u793a \u52d5\u4f5c\u30ed\u30b8\u30c3\u30af \u5c02\u9580\u5bb6\u306e\u57f7\u7b46\u3068\u30ec\u30d3\u30e5\u30fc \u300c\u65e2\u5b58\u306e\u30bf\u30b9\u30af\u3068\u306f\u7570\u306a\u308b\u65b0\u3057\u3044\u30bf\u30b9\u30af\u3092\u751f\u6210\u3059\u308b\u300d \u300c\u3053\u306e\u30bf\u30b9\u30af\u3092\u3088\u308a\u96e3\u3057\u3044\u3082\u306e\u306b\u66f8\u304d\u76f4\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u305f\u3068\u3048\u3070\u3001\u5236\u7d04\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002\u300d \u5178\u578b\u7684\u306a\u6f14\u7b97\u5b50/\u30e1\u30bd\u30c3\u30c9 \u6383\u9664\u3001\u30ec\u30d3\u30e5\u30fc\u3001\u30af\u30e9\u30a6\u30c9\u30bd\u30fc\u30b7\u30f3\u30b0 ROUGE \u91cd\u8907\u6392\u9664\u3001\u540d\u8a5e/\u52d5\u8a5e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 \u6df1\u5316\u3059\u308b\u9032\u5316\u3001\u5e83\u304c\u308b\u9032\u5316 \u4f7f\u7528\u4f8b \u30b3\u30a2 \u30d3\u30b8\u30cd\u30b9 \u30ed\u30b8\u30c3\u30af\u3001RLHF \u30b4\u30fc\u30eb\u30c7\u30f3 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8 \u4e00\u822c\u7684\u306a\u30bf\u30b9\u30af\u306e\u5bfe\u8c61\u7bc4\u56f2\u306e\u62e1\u5f35\u3001\u30b3\u30fc\u30eb\u30c9 \u30b9\u30bf\u30fc\u30c8 \u30b3\u30fc\u30c9\u3001\u6570\u5b66\u3001\u8ad6\u7406\u7684\u63a8\u8ad6\u306e\u5f37\u5316 \u6f5c\u5728\u7684\u306a\u30ea\u30b9\u30af \u30b9\u30b1\u30fc\u30eb\u304c\u96e3\u3057\u3044\u3002\u75b2\u52b4\u306b\u3088\u308b\u54c1\u8cea\u306e\u5909\u52d5 \u5747\u8cea\u3067\u5358\u7d14\u306a\u6307\u793a\u306b\u306a\u308a\u304c\u3061 \u904e\u5ea6\u306b\u8907\u96d1\u307e\u305f\u306f\u89e3\u6c7a\u4e0d\u53ef\u80fd\u306a\u300c\u5e7b\u899a\u6307\u793a\u300d\u304c\u751f\u6210\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002"},{"location":"ja/part4/4_1_sft_data/#914-cot","title":"9.1.4 \u601d\u8003\u9023\u9396 (CoT) \u30c7\u30fc\u30bf: \u63a8\u8ad6\u306e\u30d6\u30e9\u30c3\u30af \u30dc\u30c3\u30af\u30b9\u3092\u6253\u3061\u7834\u308b","text":"<p>CoT \u306e\u6838\u5fc3\u306f\u3001\u300c\u5165\u529b\u2192\u51fa\u529b\u300d\u306e\u30d6\u30e9\u30c3\u30af\u30dc\u30c3\u30af\u30b9 \u30de\u30c3\u30d4\u30f3\u30b0\u3092\u7834\u58ca\u3057\u3001\u30e2\u30c7\u30eb\u306b\u6697\u9ed9\u7684\u306a\u63a8\u8ad6\u3092\u660e\u793a\u7684\u306b\u3055\u305b\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002</p> <p>\u8a8d\u77e5\u79d1\u5b66\u306e\u89b3\u70b9\u304b\u3089\u898b\u308b\u3068\u3001\u4eba\u9593\u306f\u8907\u96d1\u306a\u554f\u984c (\u6570\u5b66\u306a\u3069) \u3092\u89e3\u6c7a\u3059\u308b\u3068\u304d\u306b\u3001\u982d\u306e\u4e2d\u3067\u4e00\u9023\u306e\u4e2d\u9593\u8a08\u7b97\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 Transformer \u30e2\u30c7\u30eb\u306f\u5f37\u529b\u3067\u3059\u304c\u3001CoT \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u304c\u306a\u3044\u3068\u3001\u751f\u5f92\u306b\u81ea\u5206\u306e\u4f5c\u696d\u3092\u898b\u305b\u305a\u306b\u7b54\u3048\u3092\u66f8\u304f\u3088\u3046\u306b\u6c42\u3081\u308b\u306a\u3069\u3001\u7b54\u3048\u3092\u76f4\u63a5\u63a8\u6e2c\u3059\u308b\u50be\u5411\u304c\u3042\u308a\u3001\u9593\u9055\u3044\u304c\u975e\u5e38\u306b\u767a\u751f\u3057\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002 CoT \u30c7\u30fc\u30bf\u306f\u3001Transformer \u306e\u4e2d\u9593\u8a08\u7b97\u5c64\u3092\u30a2\u30af\u30c6\u30a3\u30d6\u306b\u3057\u3001\u751f\u6210\u3055\u308c\u305f\u30c8\u30fc\u30af\u30f3 \u30b7\u30fc\u30b1\u30f3\u30b9\u3092\u62e1\u5f35\u3059\u308b\u3053\u3068\u3067\u3001\u3088\u308a\u591a\u304f\u306e\u8a08\u7b97\u3092\u56f0\u96e3\u306a\u554f\u984c\u306b\u5272\u308a\u5f53\u3066\u308b\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059 (\u3088\u308a\u591a\u304f\u306e\u8a08\u7b97\u6642\u9593 = \u3088\u308a\u591a\u304f\u306e\u30c8\u30fc\u30af\u30f3\u304c\u751f\u6210\u3055\u308c\u307e\u3059)\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#915","title":"9.1.5 \u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u306e\u6a19\u6e96\u5316\uff08\u30c7\u30fc\u30bf\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u898f\u683c\uff09","text":"<p>\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5\u306e\u524d\u306b\u3001\u30c7\u30fc\u30bf\u304c\u3069\u306e\u3088\u3046\u306b\u30e2\u30c7\u30eb\u306b\u300c\u4f9b\u7d66\u300d\u3055\u308c\u308b\u304b\u3092\u7406\u89e3\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u5358\u306a\u308b JSON \u89e3\u6790\u306e\u554f\u984c\u3067\u306f\u306a\u304f\u3001\u30e2\u30c7\u30eb\u304c\u4f1a\u8a71\u5c65\u6b74\u3092\u3069\u306e\u3088\u3046\u306b\u7406\u89e3\u3059\u308b\u304b\u306b\u95a2\u4fc2\u3057\u3066\u3044\u307e\u3059\u3002\u696d\u754c\u3067\u306f\u4e3b\u306b ChatML (\u30c1\u30e3\u30c3\u30c8 \u30de\u30fc\u30af\u30a2\u30c3\u30d7\u8a00\u8a9e) \u5f62\u5f0f\u3092\u63a1\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30b7\u30b9\u30c6\u30e0\u3001\u30e6\u30fc\u30b6\u30fc\u3001\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u306e\u5883\u754c\u304c\u660e\u78ba\u306b\u533a\u5225\u3055\u308c\u3001\u30d7\u30ed\u30f3\u30d7\u30c8 \u30a4\u30f3\u30b8\u30a7\u30af\u30b7\u30e7\u30f3\u653b\u6483\u304c\u9632\u6b62\u3055\u308c\u307e\u3059\u3002</p> <p>\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u4e2d\u306f\u3001\u901a\u5e38\u3001<code>assistant</code> \u5fdc\u7b54\u5185\u306e\u30c8\u30fc\u30af\u30f3\u306e\u640d\u5931\u306e\u307f\u3092\u8a08\u7b97\u3057\u3001<code>system</code> \u304a\u3088\u3073 <code>user</code> \u90e8\u5206\u3092\u30de\u30b9\u30af\u3059\u308b\u3053\u3068\u306b\u6ce8\u610f\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f\u3001\u30e2\u30c7\u30eb\u306b\u300c\u8cea\u554f\u306e\u4ed5\u65b9\u300d\u3067\u306f\u306a\u304f\u300c\u7b54\u3048\u65b9\u300d\u3092\u5b66\u7fd2\u3057\u3066\u3082\u3089\u3044\u305f\u3044\u304b\u3089\u3067\u3059\u3002</p> <pre><code>// ChatML format example\n{\n  \"messages\": [\n    {\"role\": \"system\", \"content\": \"You are a helpful assistant.\"},\n    {\"role\": \"user\", \"content\": \"Explain quantum entanglement.\"},\n    {\"role\": \"assistant\", \"content\": \"Quantum entanglement is a phenomenon...\"}\n  ]\n}\n</code></pre>"},{"location":"ja/part4/4_1_sft_data/#92","title":"9.2\u3002\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5 (\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5)","text":"<p>\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3001\u30c4\u30fc\u30eb\u30c1\u30a7\u30fc\u30f3\u306e\u9078\u629e\u3068\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b89\u5b9a\u6027\u306e\u8a2d\u8a08\u3092\u542b\u3080\u3001\u5b8c\u5168\u306a\u30c7\u30fc\u30bf\u5408\u6210\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u69cb\u7bc9\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#_3","title":"\u74b0\u5883/\u4f9d\u5b58\u95a2\u4fc2","text":"<ul> <li><code>langchain</code> / <code>langsmith</code>: \u30d7\u30ed\u30f3\u30d7\u30c8 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3001LLM \u547c\u3073\u51fa\u3057\u30c1\u30a7\u30fc\u30f3\u3001\u304a\u3088\u3073\u30c7\u30d0\u30c3\u30b0\u306e\u8ffd\u8de1\u3092\u7ba1\u7406\u3057\u307e\u3059\u3002</li> <li><code>rouge_score</code>: \u30c6\u30ad\u30b9\u30c8\u306e\u985e\u4f3c\u6027\u3068\u91cd\u8907\u6392\u9664\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002</li> <li><code>numpy / scikit-learn</code>: \u30d9\u30af\u30c8\u30eb\u5316\u3055\u308c\u305f\u91cd\u8907\u6392\u9664 (\u9ad8\u5ea6\u306a) \u306e\u5834\u5408\u3001Embedding\u3092\u4ecb\u3057\u3066\u610f\u5473\u8ad6\u7684\u306a\u8ddd\u96e2\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002</li> <li><code>openai</code> \u307e\u305f\u306f <code>vllm</code>: \u6559\u5e2b\u30e2\u30c7\u30eb\u3092\u547c\u3073\u51fa\u3059\u305f\u3081\u3002 vLLM \u306f\u3001\u30ed\u30fc\u30ab\u30eb\u306b\u5c55\u958b\u3055\u308c\u305f\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9\u6559\u5e2b\u30e2\u30c7\u30eb (Mixtral-8x7B \u306a\u3069) \u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002</li> <li><code>chromadb</code> / <code>faiss</code>: \u5927\u898f\u6a21\u306a\u91cd\u8907\u6392\u9664\u3068\u691c\u7d22\u7528\u306e\u30d9\u30af\u30c8\u30eb \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3002</li> </ul>"},{"location":"ja/part4/4_1_sft_data/#921","title":"9.2.1 \u30c7\u30fc\u30bf\u751f\u6210\u306e\u305f\u3081\u306e\u8fc5\u901f\u306a\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0","text":"<p>\u5408\u6210\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3067\u306f\u3001\u30d7\u30ed\u30f3\u30d7\u30c8\u306f\u975e\u5e38\u306b\u5805\u7262\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2\u306e\u30d0\u30fc\u30b8\u30e7\u30f3\u3092\u958b\u767a\u3059\u308b\u306e\u3068\u540c\u3058\u3088\u3046\u306b\u3001\u53cd\u5fa9\u7684\u306a\u601d\u8003\u3092\u63a1\u7528\u3057\u3066\u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u6539\u826f\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#_4","title":"\u30bf\u30b9\u30af\u306e\u76ee\u7684: \u300c\u8ca1\u52d9\u5206\u6790\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8\u300d\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u305f\u3081\u306e\u6307\u5c0e\u30c7\u30fc\u30bf\u306e\u30d0\u30c3\u30c1\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002","text":"<p>\u30b9\u30c6\u30c3\u30d7 1: \u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u7e70\u308a\u8fd4\u3057\u4f5c\u6210\u3059\u308b * V1: \u30b7\u30f3\u30d7\u30eb\u3059\u304e\u308b\u305f\u3081\u3001\u30c7\u30fc\u30bf\u306e\u5747\u8cea\u5316\u306b\u3064\u306a\u304c\u308b     * \u6b20\u9665\u5206\u6790: \u30e2\u30c7\u30eb\u3067\u751f\u6210\u3055\u308c\u305f\u6307\u793a\u306f\u975e\u5e38\u306b\u77ed\u304f\u3001\u57fa\u672c\u7684\u306a\u6982\u5ff5\u306e\u8aac\u660e (\u4f8b: \u300c\u682a\u5f0f\u3068\u306f\u4f55\u3067\u3059\u304b?\u300d) \u306b\u96c6\u4e2d\u3059\u308b\u50be\u5411\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u300c\u9ad8\u78ba\u7387\u3067\u4f4e\u8907\u96d1\u6027\u300d\u306e\u30c6\u30ad\u30b9\u30c8\u3092\u751f\u6210\u3059\u308b LLM \u306e\u30c7\u30d5\u30a9\u30eb\u30c8\u306e\u50be\u5411\u3092\u53cd\u6620\u3057\u3066\u3044\u307e\u3059\u3002     </p><pre><code># V1 Prompt - Poor performance\nsystem_prompt_v1 = \"\"\"\nYou are a financial expert. Please generate 5 questions and answers about finance.\n\"\"\"\n</code></pre><p></p> <ul> <li> <p>V2: \u69cb\u9020\u5316\u3055\u308c\u305f\u8981\u4ef6\u3092\u8ffd\u52a0</p> <ul> <li>\u6539\u5584: \u89e3\u6790\u3092\u5bb9\u6613\u306b\u3059\u308b\u305f\u3081\u306b JSON \u5f62\u5f0f\u306e\u8981\u4ef6\u3092\u5c0e\u5165\u3057\u307e\u3057\u305f\u3002\u30ac\u30a4\u30c9\u30b9\u30bf\u30a4\u30eb\u306b\u300c\u5f79\u5272\u300d\u8a2d\u5b9a\u3092\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002</li> <li>\u6b20\u9665\u5206\u6790: \u5f62\u5f0f\u306f\u6b63\u3057\u3044\u3082\u306e\u306e\u3001\u5185\u5bb9\u306b\u6df1\u307f\u304c\u307e\u3060\u306a\u304f\u3001\u63a8\u8ad6\u30d7\u30ed\u30bb\u30b9\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u30e2\u30c7\u30eb\u306f\u6559\u79d1\u66f8\u7684\u306a\u5b9a\u7fa9\u306e\u307f\u3092\u751f\u6210\u3057\u3001\u5b9f\u969b\u7684\u306a\u30b7\u30ca\u30ea\u30aa\u306f\u751f\u6210\u3057\u307e\u305b\u3093\u3002 <pre><code># V2 Prompt - Structural improvement\nsystem_prompt_v2 = \"\"\"\nYou are a Senior Financial Analyst with 20 years of experience.\nGenerate 5 pairs of instruction-response data focused on corporate finance.\nFormat the output as a JSON list.\nEach item should have: 'instruction', 'input' (optional), 'output'.\n\"\"\"\n</code></pre></li> </ul> </li> <li> <p>V3: \u6700\u7d42\u904b\u7528\u5bfe\u5fdc\u30d0\u30fc\u30b8\u30e7\u30f3</p> <ul> <li>\u6539\u5584: \u5c11\u6570\u30b7\u30e7\u30c3\u30c8\u3001\u8ca0\u306e\u5236\u7d04\u3001\u304a\u3088\u3073\u8907\u96d1\u3055\u306e\u8981\u4ef6\u304c\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u696d\u754c\u3067\u4f7f\u7528\u3055\u308c\u3066\u3044\u308b\u6a19\u6e96\u7684\u306a\u30d1\u30e9\u30c0\u30a4\u30e0\u3067\u3059\u3002</li> <li>\u8a73\u7d30\u306a\u5206\u6790: \u660e\u793a\u7684\u306a\u300c\u30a2\u30f3\u30c1\u30d1\u30bf\u30fc\u30f3\u300d\u3092\u901a\u3058\u3066\u3001\u30e2\u30c7\u30eb\u304c\u300c\u30ca\u30f3\u30bb\u30f3\u30b9\u300d\u3092\u751f\u6210\u3059\u308b\u7d4c\u8def\u3092\u906e\u65ad\u3057\u307e\u3059\u3002\u898b\u672c\u306f\u5358\u306a\u308b\u5f62\u5f0f\u306e\u53c2\u7167\u3067\u306f\u306a\u304f\u3001\u601d\u8003\u306e\u6df1\u3055\u306e\u30a2\u30f3\u30ab\u30fc\u3067\u3082\u3042\u308a\u307e\u3059\u3002</li> </ul> <p></p><pre><code># V3 Prompt - High robustness production version\nsystem_prompt_v3 = \"\"\"\n### ROLE\nYou are a Chief Market Strategist at a top-tier investment bank. Your goal is to train a junior analyst model. You demand precision, depth, and actionable insights.\n\n### OBJECTIVE\nGenerate 5 high-quality, complex instruction-following examples related to market analysis, risk management, or quantitative trading.\n\n### CONSTRAINTS\n1. **Complexity**: Do NOT ask simple definitional questions (e.g., \"What is a bond?\"). Instead, ask for scenario analysis, portfolio adjustments, or impact assessments.\n2. **Format**: Strictly output a valid JSON list.\n3. **Reasoning**: The 'output' must demonstrate step-by-step analytical reasoning before giving the conclusion.\n4. **Anti-Patterns**:\n   - Avoid generic advice like \"Consult a financial advisor.\"\n   - Avoid short, one-sentence responses.\n   - Avoid vague statements; use numbers and specific financial instruments where possible.\n\n### OUTPUT FORMAT\n[\n  {\n    \"instruction\": \"...\",\n    \"input_context\": \"...\" (can be null),\n    \"output\": \"...\"\n  }\n]\n\n### EXEMPLAR (One-Shot)\n[\n  {\n    \"instruction\": \"Given a portfolio heavily weighted in tech stocks (60%), analyze the impact of a sudden 50bps rate hike by the Fed.\",\n    \"input_context\": null,\n    \"output\": \"First, we identify the correlation... Tech stocks are long-duration assets... Discounted Cash Flow (DCF) models would show... Therefore, the portfolio would likely suffer significant drawdown. I recommend hedging via...\"\n  }\n]\n\"\"\"\n</code></pre> \u30d7\u30ed\u306e\u30d2\u30f3\u30c8: V3 \u3067\u306f\u3001\u300c\u30a2\u30f3\u30c1\u30d1\u30bf\u30fc\u30f3\u300d\u3092\u660e\u793a\u3057\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u30e2\u30c7\u30eb\u306e\u300c\u305f\u308b\u307f\u300d\u3092\u9632\u3050\u9375\u3068\u306a\u308a\u307e\u3059\u3002 LLM \u306f\u5b89\u5168\u3067\u5e73\u51e1\u306a\u56de\u7b54 (\u4f8b: \u300c\u5c02\u9580\u5bb6\u306b\u76f8\u8ac7\u3057\u3066\u304f\u3060\u3055\u3044\u300d) \u3092\u751f\u6210\u3059\u308b\u50be\u5411\u304c\u3042\u308a\u307e\u3059\u304c\u3001\u3053\u308c\u306f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u5185\u306e\u4f4e\u5024\u306e\u30ce\u30a4\u30ba\u3067\u3042\u308a\u3001\u660e\u793a\u7684\u306b\u7981\u6b62\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002<p></p> </li> </ul>"},{"location":"ja/part4/4_1_sft_data/#922-self-instruct-evol-instruct","title":"9.2.2 \u81ea\u52d5\u5316\u3055\u308c\u305f\u69cb\u7bc9\u65b9\u6cd5: Self-Instruct \u304a\u3088\u3073 Evol-Instruct","text":"<p>Evol-Instruct \u306b\u57fa\u3065\u3044\u3066\u7c21\u7d20\u5316\u3055\u308c\u305f\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u4e2d\u5fc3\u3068\u306a\u308b\u306e\u306f\u3001\u30d7\u30ed\u30bb\u30b9\u306b\u691c\u8a3c\u30e1\u30ab\u30cb\u30ba\u30e0\u304c\u5c0e\u5165\u3055\u308c\u3001\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u901a\u3058\u3066\u5358\u7d14\u306a\u547d\u4ee4\u3092\u8907\u96d1\u306a\u547d\u4ee4\u306b\u300c\u9032\u5316\u300d\u3055\u305b\u308b\u65b9\u6cd5\u3067\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#evol-instruct","title":"\u30b3\u30a2 \u30b3\u30fc\u30c9\u306e\u5185\u8a33: Evol-Instruct \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u30b9\u30c6\u30c3\u30d7 1: \u9032\u5316\u30aa\u30da\u30ec\u30fc\u30bf\u30fc\u3092\u5b9a\u7fa9\u3059\u308b (\u9032\u5316\u30d7\u30ed\u30f3\u30d7\u30c8)</p> <p>Evol-Instruct \u306e\u672c\u8cea\u306f\u3001\u3053\u306e\u30d7\u30ed\u30f3\u30d7\u30c8 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306e\u30bb\u30c3\u30c8\u306b\u3042\u308a\u307e\u3059\u3002\u6df1\u3055 (\u5236\u7d04\u3092\u8ffd\u52a0\u3057\u3001\u63a8\u8ad6\u3092\u6df1\u3081\u307e\u3059) \u3068\u5e45 (\u7a81\u7136\u5909\u7570) \u3068\u3044\u3046\u3001\u3055\u307e\u3056\u307e\u306a\u9032\u5316\u306e\u65b9\u5411\u3092\u5b9a\u7fa9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u6b21\u306e\u30b3\u30fc\u30c9\u306f\u3001\u300c\u5236\u7d04\u306e\u8ffd\u52a0\u300d\u3068\u300c\u63a8\u8ad6\u306e\u6df1\u5316\u300d\u306e\u305f\u3081\u306e\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u65b9\u6cd5\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u8a2d\u8a08\u306f\u3001\u30c7\u30fc\u30bf\u54c1\u8cea\u306e\u4e0a\u9650\u3092\u76f4\u63a5\u6c7a\u5b9a\u3057\u307e\u3059\u3002</p> <pre><code>class EvolutionPrompts:\n    @staticmethod\n    def get_deepening_prompt(instruction):\n        \"\"\"\n        Depth evolution: Increase logical reasoning depth.\n        By requiring 'explicitly ask for multiple-step reasoning', force the model from intuitive to analytical answers.\n        \"\"\"\n        return f\"\"\"\n        I want you to act as a Prompt Rewriter.\n        Your objective is to rewrite a given prompt into a more complex version to make those famous AI systems (e.g., ChatGPT and GPT4) a bit harder to handle.\n        But the rewritten prompt must be reasonable and must be understood and responded by humans.\n\n        # Given Prompt #:\n        {instruction}\n\n        # Method #:\n        If #Given Prompt# can be solved with just a few simple thinking processes, you can rewrite it to explicitly ask for multiple-step reasoning.\n\n        # Rewritten Prompt #:\n        \"\"\"\n\n    @staticmethod\n    def get_constraints_prompt(instruction):\n        \"\"\"\n        Depth evolution: Add specific constraints.\n        Limit word increase (10-20 words) to prevent instructions from becoming verbose without substance.\n        \"\"\"\n        return f\"\"\"\n        I want you to act as a Prompt Rewriter.\n        ... [header omitted for brevity]...\n\n        # Given Prompt #:\n        {instruction}\n\n        # Method #:\n        Please add one more constraint/requirement into #Given Prompt#.\n        You should try your best not to make the #Rewritten Prompt# become verbose, #Rewritten Prompt# can only add 10 to 20 words into #Given Prompt#.\n\n        # Rewritten Prompt #:\n        \"\"\"\n\n    @staticmethod\n    def get_breadth_prompt(instruction):\n        \"\"\"\n        Breadth evolution: Generate entirely new instructions on different topics based on existing ones.\n        Prevents data distribution collapse into narrow domains.\n        \"\"\"\n        return f\"\"\"\n        I want you to act as a Prompt Creator.\n        Please generate a brand new prompt that has the same difficulty level as #Given Prompt# but covers a completely different topic or domain.\n\n        # Given Prompt #:\n        {instruction}\n\n        # New Prompt #:\n        \"\"\"\n</code></pre> <p>\u30b9\u30c6\u30c3\u30d7 2: \u9032\u5316\u30eb\u30fc\u30d7\u3068\u4f8b\u5916\u51e6\u7406\u3092\u5b9f\u884c\u3059\u308b</p> <pre><code>import random\n\n# Assume we have an LLM call interface\ndef call_llm(prompt):\n    # Call GPT-4 or other strong model\n    # In production, add retry mechanisms for network jitter\n    pass\n\ndef evolve_instruction(base_instruction, depth=1):\n    current_instruction = base_instruction\n\n    for i in range(depth):\n        # Randomly select an evolution strategy\n        # Strategy probability can be adjusted; e.g., more Breadth early, more Deepening later\n        strategy = random.choice(['deepening', 'constraints', 'breadth'])\n\n        if strategy == 'deepening':\n            prompt = EvolutionPrompts.get_deepening_prompt(current_instruction)\n        elif strategy == 'constraints':\n            prompt = EvolutionPrompts.get_constraints_prompt(current_instruction)\n        else:\n            prompt = EvolutionPrompts.get_breadth_prompt(current_instruction)\n\n        # Get evolved instruction\n        evolved_candidate = call_llm(prompt)\n\n        # Quality check (simple): Prevent evolution failure\n        # Often models output \"Sorry, I can't do that\" or simply repeat the original\n        if \"sorry\" in evolved_candidate.lower() or len(evolved_candidate) &lt; 10:\n            print(f\"Evolution failed at step {i}, keeping previous instruction.\")\n            break\n\n        # Advanced check: Simple heuristic to detect simple repetition\n        if evolved_candidate.strip() == current_instruction.strip():\n             print(f\"Evolution stagnant at step {i}.\")\n             break\n\n        current_instruction = evolved_candidate\n\n    return current_instruction\n\n# Example run\nseed = \"Write a Python script to calculate Fibonacci numbers.\"\ncomplex_instruction = evolve_instruction(seed, depth=3)\n# Expected result: \"Write a Python script to calculate the nth Fibonacci number using dynamic programming, optimize for memory usage, and handle negative input values.\"\n</code></pre> <p>\u30b9\u30c6\u30c3\u30d7 3: \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u6700\u9069\u5316\u306e\u30d2\u30f3\u30c8 * \u30d0\u30c3\u30c1\u51e6\u7406: API \u3092 1 \u3064\u305a\u3064\u547c\u3073\u51fa\u3055\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002 20 \u500b\u306e\u547d\u4ee4\u3092\u542b\u3080\u30d7\u30ed\u30f3\u30d7\u30c8 \u30ea\u30b9\u30c8\u3092\u69cb\u7bc9\u3057\u3001\u30e2\u30c7\u30eb\u304c\u4e00\u5ea6\u306b 20 \u500b\u306e\u9032\u5316\u3057\u305f\u7d50\u679c\u3092\u8fd4\u3059\u3088\u3046\u306b\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30c8\u30fc\u30af\u30f3 \u30b3\u30b9\u30c8\u3068\u30cd\u30c3\u30c8\u30ef\u30fc\u30af\u9045\u5ef6\u304c\u5927\u5e45\u306b\u524a\u6e1b\u3055\u308c\u307e\u3059 (\u9ad8\u30b9\u30eb\u30fc\u30d7\u30c3\u30c8)\u3002 * \u5931\u6557\u30d5\u30a3\u30eb\u30bf\u30fc: \u9032\u5316\u306f\u983b\u7e41\u306b\u5931\u6557\u3057\u307e\u3059 (\u30e2\u30c7\u30eb\u304c\u7e70\u308a\u8fd4\u3057\u3092\u958b\u59cb\u3059\u308b\u306a\u3069)\u3002\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u9032\u5316\u3057\u305f\u547d\u4ee4\u306e\u9577\u3055\u304c\u77ed\u304f\u306a\u3063\u305f\u308a\u3001\u5178\u578b\u7684\u306a\u62d2\u5426\u30d5\u30ec\u30fc\u30ba (\u300cAI \u3068\u3057\u3066\u2026\u300d) \u304c\u542b\u307e\u308c\u3066\u3044\u308b\u5834\u5408\u306f\u3001\u30b5\u30f3\u30d7\u30eb\u3092\u7834\u68c4\u3057\u307e\u3059\u3002 * \u591a\u69d8\u6027\u5236\u5fa1: \u30d0\u30c3\u30c1\u751f\u6210\u3067\u306f\u30011 \u3064\u306e\u30d0\u30c3\u30c1\u5185\u306e\u3059\u3079\u3066\u306e\u547d\u4ee4\u304c\u300cPython \u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u300d\u306b\u95a2\u3059\u308b\u3082\u306e\u306b\u306a\u308b\u306e\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001\u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30f3\u30d7\u30c8\u3067\u300c\u591a\u69d8\u306a\u30c8\u30d4\u30c3\u30af\u306e\u751f\u6210\u300d\u3092\u660e\u793a\u7684\u306b\u8981\u6c42\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#923-cot","title":"9.2.3 \u601d\u8003\u9023\u9396 (CoT) \u30c7\u30fc\u30bf: \u6bb5\u968e\u7684\u306a\u63a8\u8ad6\u30b5\u30f3\u30d7\u30eb\u306e\u69cb\u7bc9","text":"<p>SFT \u30c7\u30fc\u30bf\u306e\u4e2d\u6838\u3068\u306a\u308b\u4fa1\u5024\u306f\u3001\u30e2\u30c7\u30eb\u306b\u300c\u8003\u3048\u65b9\u300d\u3092\u6559\u3048\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002\u901a\u5e38\u306e Q&amp;A \u30da\u30a2 (Q: 1+1? A: 2) \u3067\u306f\u3001\u7d50\u679c\u306e\u307f\u3092\u6559\u3048\u307e\u3059\u3002 CoT \u306f\u30d7\u30ed\u30bb\u30b9\u3092\u6559\u3048\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#cot","title":"CoT \u30c7\u30fc\u30bf\u69cb\u7bc9\u30d7\u30ed\u30f3\u30d7\u30c8 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8","text":"<p>\u300c\u30b9\u30c6\u30c3\u30d7\u3054\u3068\u306b\u8003\u3048\u3066\u307f\u307e\u3057\u3087\u3046\u300d\u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30e2\u30c7\u30eb\u304c\u7279\u5b9a\u306e\u5f62\u5f0f (<code>&lt;thinking&gt;</code> \u30bf\u30b0\u306a\u3069) \u3067\u51fa\u529b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306f\u3001\u305d\u306e\u5f8c\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u975e\u5e38\u306b\u5f79\u7acb\u3061\u307e\u3059\u3002\u30e2\u30c7\u30eb\u306b\u601d\u8003\u30d7\u30ed\u30bb\u30b9\u3092\u51fa\u529b\u3055\u305b\u308b\u304b\u3001\u63a8\u8ad6\u4e2d\u306b\u975e\u8868\u793a\u306b\u3059\u308b\u304b\u3092\u9078\u629e\u3067\u304d\u307e\u3059\u3002</p> <pre><code># System Prompt for CoT Generation\ncot_system_prompt = \"\"\"\nYou are a reasoning expert. When answering the user's question, you MUST follow this format:\n\n1. Enclose your thought process in &lt;thinking&gt; tags.\n2. Break down the problem into logical steps.\n3. Check for edge cases or potential errors in your logic (Self-Correction).\n4. Output the final answer in &lt;answer&gt; tags.\n\nDo NOT output the answer directly without the thinking process.\n\"\"\"\n\n# V3 Prompt Iteration for Math CoT\nuser_prompt_cot = \"\"\"\nQuestion: A farmer has chickens and cows. There are 20 heads and 50 legs. How many of each are there?\n\nPlease provide a Step-by-Step solution.\n\"\"\"\n</code></pre> <p>\u51fa\u529b\u4f8b (\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u3068\u3057\u3066): </p><pre><code>&lt;thinking&gt;\nStep 1: Define variables. Let C be chickens, K be cows.\nStep 2: Set up equations based on the problem statement.\n   Equation 1 (Heads): C + K = 20\n   Equation 2 (Legs): 2C + 4K = 50\nStep 3: Solve for C from Equation 1. \n   C = 20 - K.\nStep 4: Substitute C into Equation 2.\n   2(20 - K) + 4K = 50\n   40 - 2K + 4K = 50\n   2K = 10 \n   K = 5.\nStep 5: Solve for C using the value of K. \n   C = 20 - 5 = 15.\nStep 6: Verify the solution. \n   Heads: 15 + 5 = 20. Correct.\n   Legs: 15*2 + 5*4 = 30 + 20 = 50. Correct.\n&lt;/thinking&gt;\n&lt;answer&gt;\nChickens: 15, Cows: 5\n&lt;/answer&gt;\n</code></pre> \u30d7\u30ed\u306e\u30d2\u30f3\u30c8: <code>&lt;thinking&gt;</code> \u30bf\u30b0\u3092\u4f7f\u7528\u3057\u305f\u3053\u306e\u30c7\u30fc\u30bf\u6226\u7565\u306f\u3001\u300c\u5185\u90e8\u72ec\u767d\u300d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3068\u547c\u3070\u308c\u307e\u3059\u3002 SFT \u4e2d\u306b\u3001\u30e2\u30c7\u30eb\u304c\u601d\u8003\u30d7\u30ed\u30bb\u30b9\u306e\u51fa\u529b\u3092\u5b66\u7fd2\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u3053\u308c\u3089\u306e\u30bf\u30b0\u3092\u4fdd\u6301\u3057\u307e\u3059\u3002\u904b\u7528\u74b0\u5883\u3067\u306f\u3001\u89e3\u6790\u30b3\u30fc\u30c9\u3092\u4f7f\u7528\u3057\u3066 <code>&lt;thinking&gt;</code> \u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u3001<code>&lt;answer&gt;</code> \u306e\u307f\u3092\u30e6\u30fc\u30b6\u30fc\u306b\u8868\u793a\u3059\u308b\u304b\u3001\u8aac\u660e\u3057\u3084\u3059\u304f\u3059\u308b\u305f\u3081\u306b\u90e8\u5206\u7684\u306a\u63a8\u8ad6\u624b\u9806\u3092\u793a\u3059\u300c\u601d\u8003...\u300dUI \u30a2\u30cb\u30e1\u30fc\u30b7\u30e7\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002<p></p>"},{"location":"ja/part4/4_1_sft_data/#924","title":"9.2.4\u3002\u5b9f\u7e3e\u3068\u8a55\u4fa1 (\u5b9f\u7e3e\u3068\u8a55\u4fa1)","text":"<p>\u30c7\u30fc\u30bf\u751f\u6210\u306f\u6700\u521d\u306e\u30b9\u30c6\u30c3\u30d7\u306b\u3059\u304e\u307e\u305b\u3093\u3002\u751f\u6210\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306e\u54c1\u8cea\u3092\u8a55\u4fa1\u3059\u308b\u65b9\u6cd5\u3082\u540c\u69d8\u306b\u91cd\u8981\u3067\u3059\u3002\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u304c\u5b8c\u4e86\u3059\u308b\u307e\u3067 (\u5834\u5408\u306b\u3088\u3063\u3066\u306f\u6570\u65e5\u3001\u6570\u5343\u30c9\u30eb\u304b\u304b\u308b)\u3001\u30c7\u30fc\u30bf\u54c1\u8cea\u306e\u4f4e\u4e0b\u3092\u767a\u898b\u3059\u308b\u306e\u3092\u5f85\u3064\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#_5","title":"\u8a55\u4fa1\u6307\u6a19","text":"<ul> <li>\u6307\u793a\u30d5\u30a9\u30ed\u30fc\u7387: \u901a\u5e38\u306f\u81ea\u52d5\u30c6\u30b9\u30c8\u3067\u3059\u3002 GPT-4 \u3092\u5224\u65ad\u6750\u6599\u3068\u3057\u3066\u4f7f\u7528\u3057\u3001\u30e2\u30c7\u30eb\u3067\u751f\u6210\u3055\u308c\u305f\u5fdc\u7b54\u304c\u5165\u529b\u5185\u306e\u3059\u3079\u3066\u306e\u5236\u7d04 (\u4f8b: \u300c\u5358\u8a9e\u6570\u5236\u9650\u300d\u3001\u300c\u7279\u5b9a\u306e\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u542b\u3080\u300d\u3001\u300cJSON \u5f62\u5f0f\u300d) \u3092\u53b3\u5bc6\u306b\u6e80\u305f\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u5224\u65ad\u3057\u307e\u3059\u3002</li> <li>\u8907\u96d1\u3055\u306e\u5206\u5e03: NLP \u30c4\u30fc\u30eb (SpaCy \u306a\u3069) \u3092\u4f7f\u7528\u3057\u3066\u3001\u52d5\u8a5e\u306e\u591a\u69d8\u6027\u3001\u69cb\u6587\u30c4\u30ea\u30fc\u306e\u6df1\u3055\u3001\u751f\u6210\u3055\u308c\u305f\u547d\u4ee4\u306e\u5e73\u5747\u9577\u3092\u5206\u6790\u3057\u307e\u3059\u3002\u5206\u5e03\u30d2\u30b9\u30c8\u30b0\u30e9\u30e0\u3092\u30d7\u30ed\u30c3\u30c8\u3057\u3066\u3001Evol-Instruct \u304c\u5358\u306b\u5197\u9577\u3067\u3042\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u5b9f\u969b\u306b\u96e3\u6613\u5ea6\u304c\u4e0a\u304c\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002</li> <li>\u591a\u69d8\u6027: ROUGE-L \u3092\u8a08\u7b97\u3059\u308b\u304b\u3001Embedding\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u5ea6\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u5185\u306e\u30b5\u30f3\u30d7\u30eb\u9593\u306e\u5e73\u5747\u985e\u4f3c\u6027\u304c\u9ad8\u3059\u304e\u308b\u5834\u5408\u3001\u300c\u30e2\u30fc\u30c9\u5d29\u58ca\u300d\u304c\u767a\u751f\u3057\u3066\u304a\u308a\u3001\u30c7\u30fc\u30bf\u306b\u591a\u69d8\u6027\u304c\u6b20\u3051\u3066\u3044\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part4/4_1_sft_data/#_6","title":"\u30d9\u30f3\u30c1\u30de\u30fc\u30af","text":"<p>\u5b66\u754c\u3068\u7523\u696d\u754c\u3067\u306f\u3001SFT \u5f8c\u306e\u30e2\u30c7\u30eb\u306e\u6a5f\u80fd\u3092\u30c6\u30b9\u30c8\u3059\u308b\u305f\u3081\u306e\u30d9\u30f3\u30c1\u30de\u30fc\u30af\u304c\u8a8d\u3081\u3089\u308c\u3066\u3044\u307e\u3059\u3002 * WizardLM \u8ad6\u6587\u30c7\u30fc\u30bf: 4 \u30e9\u30a6\u30f3\u30c9\u306e Evol-Instruct \u3092\u901a\u3058\u3066\u9032\u5316\u3057\u305f\u30c7\u30fc\u30bf\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u306f\u3001\u901a\u5e38\u3001\u751f\u30c7\u30fc\u30bf\u306e\u307f\u3092\u4f7f\u7528\u3057\u305f\u30e2\u30c7\u30eb\u3068\u6bd4\u8f03\u3057\u3066\u3001GSM8K (\u6570\u5b66) \u3068 HumanEval (\u30b3\u30fc\u30c9) \u3067 10% \uff5e 20% \u4ee5\u4e0a\u306e\u6539\u5584\u3092\u793a\u3057\u307e\u3059\u3002 * MT-Bench: \u30de\u30eb\u30c1\u30bf\u30fc\u30f3\u5bfe\u8a71\u8a55\u4fa1\u30bb\u30c3\u30c8\u306f\u3001\u7279\u306b\u6307\u793a\u3078\u306e\u5f93\u3046\u80fd\u529b\u3001\u63a8\u8ad6\u80fd\u529b\u3001\u304a\u3088\u3073\u30de\u30eb\u30c1\u30bf\u30fc\u30f3\u5bfe\u8a71\u80fd\u529b\u3092\u30c6\u30b9\u30c8\u3059\u308b\u3082\u306e\u3067\u3001\u901a\u5e38 GPT-4 \u306b\u3088\u3063\u3066\u30b9\u30b3\u30a2\u5316\u3055\u308c\u307e\u3059\u3002 * \u30b3\u30b9\u30c8\u306e\u53c2\u8003: <code>gpt-3.5-turbo</code> \u3092\u4f7f\u7528\u3057\u3066 52K \u306e\u81ea\u5df1\u6307\u793a\u30c7\u30fc\u30bf\u3092\u751f\u6210\u3059\u308b\u306b\u306f\u3001\u7d04 500 \u30c9\u30eb\u304b\u3089 1000 \u30c9\u30eb\u306e\u8cbb\u7528\u304c\u304b\u304b\u308a\u307e\u3059 (\u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u9577\u3055\u3068\u30e9\u30a6\u30f3\u30c9\u306b\u3088\u3063\u3066\u7570\u306a\u308a\u307e\u3059)\u3002\u3053\u308c\u306f\u3001\u624b\u52d5\u306b\u3088\u308b\u6ce8\u91c8\u306e\u6570\u5341\u4e07\u30c9\u30eb\u306b\u6bd4\u3079\u3066\u3001\u975e\u5e38\u306b\u8cbb\u7528\u5bfe\u52b9\u679c\u304c\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#925","title":"9.2.5\u3002\u843d\u3068\u3057\u7a74\u3068\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":"<p>\u5b9f\u969b\u306b\u306f\u3001\u30c7\u30fc\u30bf\u5408\u6210\u306b\u306f\u843d\u3068\u3057\u7a74\u304c\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u306f\u3001\u4e00\u822c\u7684\u306a\u969c\u5bb3\u30e2\u30fc\u30c9\u3068\u89e3\u6c7a\u7b56\u3092\u793a\u3057\u307e\u3059\u3002</p> <ul> <li> <p>\u843d\u3068\u3057\u7a74 1: \u30e2\u30fc\u30c9\u306e\u5d29\u58ca</p> <ul> <li>\u75c7\u72b6: \u30e2\u30c7\u30eb\u751f\u6210\u306e\u547d\u4ee4\u306f\u5358\u8abf\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u30011000 \u500b\u306e\u751f\u6210\u3055\u308c\u305f\u30b5\u30f3\u30d7\u30eb\u306f\u3059\u3079\u3066\u300cX \u306b\u95a2\u3059\u308b\u8a18\u4e8b\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\u300d\u307e\u305f\u306f\u300cPython \u95a2\u6570\u3092\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\u300d\u3067\u3059\u3002</li> <li>\u539f\u56e0: \u30b7\u30fc\u30c9 \u30bf\u30b9\u30af\u304c\u540c\u7a2e\u3059\u304e\u308b\u304b\u3001\u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30f3\u30d7\u30c8\u6e29\u5ea6\u306e\u8a2d\u5b9a\u304c\u4f4e\u3059\u304e\u308b\u305f\u3081\u3001\u30e2\u30c7\u30eb\u304c\u5c40\u6240\u6700\u9069\u5316\u306b\u9665\u308a\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u30b7\u30fc\u30c9 \u30bf\u30b9\u30af\u306e\u591a\u69d8\u6027\u3092\u9ad8\u3081\u307e\u3059 (100 \u4ee5\u4e0a\u306e\u9818\u57df\u3092\u30ab\u30d0\u30fc: \u6599\u7406\u3001\u6cd5\u5f8b\u3001\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u3001\u6587\u5b66)\u3002\u6e29\u5ea6\u3092\u4e0a\u3052\u308b (0.7 \u2192 1.0);\u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30f3\u30d7\u30c8\u3067\u300c\u524d\u306e\u4f8b\u3068\u306f\u7570\u306a\u308b\u30c9\u30e1\u30a4\u30f3\u304b\u3089\u30bf\u30b9\u30af\u3092\u751f\u6210\u3059\u308b\u300d\u3053\u3068\u3092\u660e\u793a\u7684\u306b\u8981\u6c42\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u843d\u3068\u3057\u7a74 2: \u5e7b\u899a\u306e\u3088\u3046\u306a\u5236\u7d04</p> <ul> <li>\u75c7\u72b6: \u30e2\u30c7\u30eb\u306f\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u304b\u3089\u300cJSON \u3092\u51fa\u529b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u300d\u3053\u3068\u3092\u5b66\u7fd2\u3057\u3001\u30ab\u30b8\u30e5\u30a2\u30eb \u30c1\u30e3\u30c3\u30c8 (\u300c\u3053\u3093\u306b\u3061\u306f\u300d) \u3067\u3042\u3063\u3066\u3082 JSON \u51fa\u529b\u3092\u5f37\u5236\u3057\u305f\u308a\u3001\u8981\u6c42\u3055\u308c\u3066\u3044\u306a\u3044\u3068\u304d\u306b <code>&lt;thinking&gt;</code> \u30bf\u30b0\u3092\u51fa\u529b\u3057\u305f\u308a\u3057\u307e\u3059\u3002</li> <li>\u539f\u56e0: \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u5206\u5e03\u304c\u8457\u3057\u304f\u6b6a\u3093\u3067\u3044\u307e\u3059\u3002100% \u8907\u96d1\u306a\u6307\u793a\u304c\u3042\u308a\u3001\u5358\u7d14\u306a\u4e00\u822c\u7684\u306a\u5bfe\u8a71\u30c7\u30fc\u30bf\u304c\u4e0d\u8db3\u3057\u3066\u3044\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u30c7\u30fc\u30bf\u306e\u6df7\u5408\u3002\u7279\u5b9a\u306e\u5f62\u5f0f\u3078\u306e\u904e\u5270\u9069\u5408\u3092\u9632\u3050\u305f\u3081\u306b\u300110% \uff5e 20% \u306e\u4e00\u822c\u7684\u306a\u5bfe\u8a71\u30c7\u30fc\u30bf (\u4f8b: ShareGPT \u307e\u305f\u306f\u96d1\u8ac7) \u3092 Evol-Instruct \u30c7\u30fc\u30bf\u306b\u6df7\u305c\u307e\u3059\u3002\u3053\u308c\u3092\u300c\u4e00\u822c\u80fd\u529b\u30ea\u30d7\u30ec\u30a4\u300d\u3068\u547c\u3073\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u843d\u3068\u3057\u7a74 3: \u9032\u5316\u306e\u5931\u6557 (\u52a3\u5316)</p> <ul> <li>\u75c7\u72b6: \u9032\u5316\u3057\u305f\u6307\u793a\u306f\u4e0d\u6761\u7406\u306b\u306a\u3063\u305f\u308a\u3001\u8ad6\u7406\u7684\u306b\u77db\u76fe\u3057\u305f\u308a (\u300c\u6bcd\u97f3\u306a\u3057\u3067 1000 \u8a9e\u306e\u8a18\u4e8b\u3092\u66f8\u304d\u306a\u3055\u3044\u300d)\u3001\u307e\u305f\u306f\u975e\u5e38\u306b\u5197\u9577\u306b\u306a\u308a\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u300c\u9577\u3055\u30da\u30ca\u30eb\u30c6\u30a3\u300d\u307e\u305f\u306f\u300c\u8907\u96d1\u3055\u306e\u5207\u308a\u6368\u3066\u300d\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002\u9032\u5316\u3057\u305f\u547d\u4ee4\u304c\u8907\u96d1\u3067\u3042\u308b\u306b\u3082\u304b\u304b\u308f\u3089\u305a GPT-4 \u304c\u5fdc\u7b54\u3067\u304d\u306a\u3044 (\u307e\u305f\u306f\u5fdc\u7b54\u306e\u54c1\u8cea\u304c\u4f4e\u3044) \u5834\u5408\u3001\u30b5\u30f3\u30d7\u30eb\u306f\u7121\u52b9\u306b\u306a\u308a\u307e\u3059 (\u60aa\u3044\u30b1\u30fc\u30b9)\u3002\u9032\u5316\u3057\u305f\u6307\u5c0e\u306e\u5b9f\u73fe\u53ef\u80fd\u6027\u3092\u8a55\u4fa1\u3059\u308b\u305f\u3081\u306b\u3001GPT-4 \u306e\u300c\u6559\u5e2b\u30e2\u30c7\u30eb \u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u300d\u3092\u5c0e\u5165\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u843d\u3068\u3057\u7a74 4: \u58ca\u6ec5\u7684\u306a\u5fd8\u5374</p> <ul> <li>\u75c7\u72b6: SFT \u5f8c\u3001\u30e2\u30c7\u30eb\u306f\u6307\u793a\u306b\u5f93\u3046\u3053\u3068\u3092\u5b66\u7fd2\u3057\u307e\u3059\u304c\u3001\u300c\u611a\u304b\u300d\u306b\u898b\u3048\u3001\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u5f97\u305f\u4e16\u754c\u306e\u77e5\u8b58\u306e\u4e00\u90e8\u3092\u5fd8\u308c\u3066\u3044\u307e\u3059\u3002</li> <li>\u539f\u56e0: SFT \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306f\u30e2\u30c7\u30eb\u306e\u91cd\u307f\u914d\u5206\u3092\u5909\u66f4\u3057\u3001\u7279\u5b9a\u306e\u30bf\u30b9\u30af \u30d5\u30a9\u30fc\u30e0\u306b\u904e\u5ea6\u306b\u7126\u70b9\u3092\u5f53\u3066\u3001\u4e00\u822c\u7684\u306a\u77e5\u8b58\u306e\u30b9\u30c8\u30ec\u30fc\u30b8\u3092\u5727\u8feb\u3057\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u5b66\u7fd2\u7387\u304c\u4f4e\u304f\u306a\u308a\u3001\u30a8\u30dd\u30c3\u30af\u304c\u6e1b\u5c11\u3057\u307e\u3059 (SFT \u306f\u901a\u5e38\u30012 \uff5e 3 \u30a8\u30dd\u30c3\u30af\u306e\u307f\u3092\u5fc5\u8981\u3068\u3057\u307e\u3059)\u3002\u30d1\u30e9\u30e1\u30fc\u30bf\u5206\u5e03\u306e\u5b89\u5b9a\u6027\u3092\u7dad\u6301\u3059\u308b\u305f\u3081\u306b\u3001\u5c11\u91cf\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf (\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30ea\u30d7\u30ec\u30a4) \u3092 SFT \u30c7\u30fc\u30bf\u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002</li> </ul> </li> </ul>"},{"location":"ja/part4/4_1_sft_data/#926","title":"9.2.6\u3002\u5404\u7ae0\u306e\u6982\u8981\u3068\u8a73\u7d30\u60c5\u5831","text":"<p>\u79c1\u305f\u3061\u306f\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u30c7\u30fc\u30bf\u306e\u30bd\u30fc\u30b9 \u30b3\u30fc\u30c9\u3068\u3057\u3066\u6271\u3044\u307e\u3059\u3002\u30d7\u30ed\u30f3\u30d7\u30c8\u306f\u3001\u30bd\u30d5\u30c8\u30a6\u30a7\u30a2 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30b3\u30fc\u30c9\u3068\u540c\u69d8\u306b\u3001\u53b3\u5bc6\u306a\u30d0\u30fc\u30b8\u30e7\u30f3\u7ba1\u7406\u3068\u53cd\u5fa9\u30c6\u30b9\u30c8\u306b\u3088\u3063\u3066\u7ba1\u7406\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3067\u306f\u3001Self-Instruct \u306f\u300c\u30bc\u30ed\u304b\u3089 1 \u3078\u300d\u306e\u30b3\u30fc\u30eb\u30c9 \u30b9\u30bf\u30fc\u30c8\u306e\u8ab2\u984c\u3092\u89e3\u6c7a\u3057\u3001\u4e00\u65b9\u3001Evol-Instruct \u306f\u300c\u7c21\u5358\u304b\u3089\u56f0\u96e3\u3078\u300d\u306e\u8907\u96d1\u3055\u306e\u4e0a\u6607\u3092\u514b\u670d\u3057\u307e\u3059\u3002\u305d\u308c\u3089\u306e\u6709\u6a5f\u7684\u306a\u7d44\u307f\u5408\u308f\u305b\u306f\u3001\u9ad8\u6027\u80fd\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u9ec4\u91d1\u306e\u30d1\u30e9\u30c0\u30a4\u30e0\u3092\u69cb\u6210\u3057\u307e\u3059\u3002\u4e00\u65b9\u3001\u601d\u8003\u9023\u9396 (CoT) \u30c7\u30fc\u30bf\u306f\u3001\u5358\u7d14\u306a\u554f\u984c\u89e3\u6c7a\u306e\u30c8\u30ea\u30c3\u30af\u3068\u306f\u7a0b\u9060\u3044\u3082\u306e\u3067\u3059\u3002\u63a8\u8ad6\u3092\u660e\u793a\u3059\u308b\u3053\u3068\u3067\u3001\u8a08\u7b97\u30ea\u30bd\u30fc\u30b9\u3092\u91cd\u8981\u306a\u63a8\u8ad6\u30b9\u30c6\u30c3\u30d7\u306b\u52b9\u679c\u7684\u306b\u5272\u308a\u5f53\u3066\u3001\u8907\u96d1\u306a\u30ed\u30b8\u30c3\u30af\u3092\u51e6\u7406\u3059\u308b\u30e2\u30c7\u30eb\u306e\u80fd\u529b\u3092\u6839\u672c\u7684\u306b\u5f37\u5316\u3057\u307e\u3059\u3002\u7d50\u5c40\u306e\u3068\u3053\u308d\u3001\u30c7\u30fc\u30bf\u5408\u6210\u306b\u304a\u3051\u308b\u4e2d\u5fc3\u7684\u306a\u969c\u58c1\u306f\u751f\u6210\u80fd\u529b\u3067\u306f\u306a\u304f\u3001\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3068\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306e\u6280\u8853\u3067\u3059\u3002\u5927\u91cf\u751f\u6210\u306e\u5bb9\u6613\u3055\u3068\u6b63\u78ba\u306a\u30b9\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306e\u96e3\u3057\u3055\u306e\u9593\u3067\u306f\u3001\u7802\u304b\u3089\u91d1\u3092\u62bd\u51fa\u3059\u308b\u80fd\u529b\u3060\u3051\u304c\u771f\u306e\u7af6\u4e89\u529b\u306e\u4e2d\u5fc3\u3092\u69cb\u6210\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_1_sft_data/#_7","title":"\u53c2\u8003\u6587\u732e\u3068\u8a73\u7d30\u60c5\u5831","text":"<ul> <li>Wang, Y. \u4ed6\uff082022\u5e74\uff09\u3002 Self-Instruct: \u8a00\u8a9e\u30e2\u30c7\u30eb\u3068\u81ea\u5df1\u751f\u6210\u547d\u4ee4\u306e\u8abf\u6574 (\u81ea\u52d5\u547d\u4ee4\u751f\u6210\u306b\u95a2\u3059\u308b\u57fa\u790e\u4f5c\u696d)</li> <li>Xu\u3001C.\u3001\u4ed6\u3002 \uff082023\u5e74\uff09\u3002 WizardLM: \u5927\u898f\u6a21\u8a00\u8a9e\u30e2\u30c7\u30eb\u304c\u8907\u96d1\u306a\u547d\u4ee4\u306b\u5f93\u3046\u3053\u3068\u304c\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b (Evol-Instruct \u9032\u5316\u6f14\u7b97\u5b50\u306e\u8a73\u7d30\u306a\u7d39\u4ecb)</li> <li>Wei\u3001J.\u3001\u4ed6\u3002 \uff082022\u5e74\uff09\u3002 Chain-of-Thought Prompting Elicits Reasoning in Large Language Models. (CoT \u306e\u57fa\u790e\u7814\u7a76)</li> <li>Zhou\u3001C.\u3001\u4ed6\u3002 \uff082023\u5e74\uff09\u3002 LIMA: Less Is More for Alignment. (SFT \u306f\u77e5\u8b58\u3067\u306f\u306a\u304f\u5f62\u5f0f\u3092\u4e3b\u306b\u5b66\u7fd2\u3059\u308b\u3068\u3044\u3046\u7406\u8ad6\u7684\u6839\u62e0\u3092\u78ba\u7acb\u3057\u307e\u3059\u3002\u300c\u8cea &gt; \u91cf\u300d)</li> </ul>"},{"location":"ja/part4/4_2_synthetic_data/","title":"\u7b2c10\u7ae0: \u5408\u6210\u30c7\u30fc\u30bf","text":""},{"location":"ja/part4/4_2_synthetic_data/#10","title":"\u7b2c10\u7ae0: \u5408\u6210\u30c7\u30fc\u30bf \u2014\u2014 \u300c\u30c7\u30fc\u30bf\u30de\u30a4\u30cb\u30f3\u30b0\u300d\u304b\u3089\u300c\u30c7\u30fc\u30bf\u30d5\u30a1\u30fc\u30df\u30f3\u30b0\u300d\u3078","text":""},{"location":"ja/part4/4_2_synthetic_data/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u7af6\u4e89\u304c\u6fc0\u5316\u3059\u308b\u306b\u3064\u308c\u3001\u516c\u5171\u306e\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u4e0a\u306e\u9ad8\u54c1\u8cea\u306a\u81ea\u7136\u30c7\u30fc\u30bf\u304c\u67af\u6e07\u306b\u76f4\u9762\u3057\u3066\u3044\u307e\u3059\u3002\u79c1\u305f\u3061\u306f\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u5168\u4f53\u3092\u307b\u307c\u300c\u8aad\u3093\u3067\u300d\u3044\u307e\u3059\u304c\u3001\u30e2\u30c7\u30eb\u306e\u77e5\u7684\u9650\u754c\u306b\u306f\u9060\u304f\u53ca\u3070\u306a\u3044\u306e\u3067\u3059\u3002\u73fe\u6642\u70b9\u3067\u306f\u3001\u5408\u6210\u30c7\u30fc\u30bf\u306f\u3082\u306f\u3084\u30aa\u30d7\u30b7\u30e7\u30f3\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u5408\u6210\u30c7\u30fc\u30bf\u306f\u3001\u30e2\u30c7\u30eb\u306e\u6a5f\u80fd\u3092\u98db\u8e8d\u7684\u306b\u5411\u4e0a\u3055\u305b\u308b\u305f\u3081\u306e\u65b0\u3057\u3044\u30a8\u30f3\u30b8\u30f3\u3067\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001Microsoft \u306e Phi \u30b7\u30ea\u30fc\u30ba\u306e\u300c\u6559\u79d1\u66f8\u30ec\u30d9\u30eb\u300d\u306e\u30c7\u30fc\u30bf\u5408\u6210\u624b\u6cd5\u3092\u6df1\u304f\u5206\u6790\u3057\u3001\u53d7\u52d5\u7684\u306a\u300c\u30c7\u30fc\u30bf \u30b3\u30ec\u30af\u30bf\u30fc\u300d\u304b\u3089\u80fd\u52d5\u7684\u306a\u300c\u30c7\u30fc\u30bf\u4f5c\u6210\u8005\u300d\u306b\u5909\u9769\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002</p> <p>\u30c6\u30ad\u30b9\u30c8\u306e\u751f\u6210\u306b\u3068\u3069\u307e\u3089\u305a\u3001\u30b3\u30fc\u30c9\u5b9f\u884c\u3092\u4f7f\u7528\u3057\u305f\u601d\u8003\u30d7\u30ed\u30b0\u30e9\u30e0 (PoT) \u3092\u901a\u3058\u3066\u53b3\u5bc6\u306a\u8ad6\u7406\u691c\u8a3c\u30eb\u30fc\u30d7\u3092\u69cb\u7bc9\u3057\u3001GPT-4o \u3084\u305d\u306e\u4ed6\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u8907\u96d1\u306a\u753b\u50cf\u3068\u30c6\u30ad\u30b9\u30c8\u306e\u547d\u4ee4\u30c7\u30fc\u30bf\u3092\u5408\u6210\u3059\u308b\u65b9\u6cd5\u3092\u8aac\u660e\u3057\u307e\u3059\u3002\u5358\u7d14\u306a\u300c\u4eba\u9593\u3092\u6a21\u5023\u3059\u308b\u300d\u304b\u3089\u300c\u4eba\u9593\u3092\u8d85\u3048\u308b\u300d\u306b\u79fb\u884c\u3059\u308b\u65b9\u6cd5\u3092\u793a\u3057\u3001\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u7684\u624b\u6bb5\u3092\u901a\u3058\u3066\u73fe\u5b9f\u4e16\u754c\u3088\u308a\u3082\u7d14\u7c8b\u3067\u6559\u80b2\u7684\u306a\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#_2","title":"\u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u5927\u91cf\u306e Web \u30c7\u30fc\u30bf\u304b\u3089\u4fa1\u5024\u306e\u9ad8\u3044\u30b5\u30f3\u30d7\u30eb\u3092\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3059\u308b\u300c\u6559\u79d1\u66f8\u54c1\u8cea\u300d\u5206\u985e\u5668\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</li> <li>Python \u30a4\u30f3\u30bf\u30d7\u30ea\u30bf\u3092\u4f7f\u7528\u3057\u3066\u6570\u5b66/\u30b3\u30fc\u30c9 \u30c7\u30fc\u30bf\u306e\u6b63\u78ba\u6027\u3092\u691c\u8a3c\u3059\u308b\u3001PoT (\u30d7\u30ed\u30b0\u30e9\u30e0 \u30aa\u30d6 \u30bd\u30fc\u30c8) \u30c7\u30fc\u30bf\u751f\u6210\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</li> <li>LLaVA/GPT-4o \u30d9\u30fc\u30b9\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u547d\u4ee4\u5408\u6210\u3092\u30de\u30b9\u30bf\u30fc\u3057\u3066\u3001\u30a4\u30e1\u30fc\u30b8\u63a8\u8ad6 Q&amp;A \u30da\u30a2\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part4/4_2_synthetic_data/#_3","title":"\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb: \u30c7\u30fc\u30bf\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308b\u3068\u304d","text":"<p>\u300c\u3042\u306a\u305f\u306f\u3001Python \u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0\u306b\u7279\u5316\u3057\u305f\u5c0f\u3055\u306a\u30e2\u30c7\u30eb (1.3B) \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u3066\u3044\u307e\u3059\u3002\u305d\u308c\u3092\u3067\u304d\u308b\u3060\u3051\u5f37\u529b\u306b\u3059\u308b\u305f\u3081\u306b\u3001GitHub \u304b\u3089\u3059\u3079\u3066\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30b3\u30fc\u30c9\u3092\u30b9\u30af\u30ec\u30a4\u30d4\u30f3\u30b0\u3059\u308b\u30af\u30ed\u30fc\u30e9\u30fc\u3092\u4f5c\u6210\u3057\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u5f8c\u306b\u30c6\u30b9\u30c8\u3059\u308b\u3068\u3001\u30e2\u30c7\u30eb\u304c\u30d0\u30b0\u306e\u3042\u308b\u30b3\u30fc\u30c9\u3092\u66f8\u304f\u3053\u3068\u3092\u5b66\u7fd2\u3057\u3001\u95a2\u6570\u5185\u3067\u300cTODO: \u3053\u308c\u306f\u5f8c\u3067\u4fee\u6b63\u3057\u307e\u3059\u300d\u307e\u305f\u306f\u300c\u3053\u306e\u30b3\u30fc\u30c9\u306f\u30b4\u30df\u3067\u3059\u3002\u4f7f\u7528\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u300d\u3068\u66f8\u304f\u3053\u3068\u3055\u3048\u5b66\u7fd2\u3057\u3066\u3044\u308b\u3053\u3068\u306b\u7d76\u671b\u7684\u306b\u6c17\u3065\u304d\u307e\u3057\u305f\u3002 \u5358\u306b\u30c7\u30fc\u30bf\u3092\u8ffd\u52a0\u3059\u308b\u3060\u3051\u3067\u306f\u52b9\u679c\u304c\u306a\u304f\u306a\u308a\u3001\u30e2\u30c7\u30eb\u306b\u4e0e\u3048\u308b\u30b4\u30df\u306e\u91cf\u304c\u5897\u3048\u308b\u307b\u3069\u3001\u305d\u306e\u51fa\u529b\u306f\u3088\u308a\u7121\u79e9\u5e8f\u306b\u306a\u308a\u307e\u3059\u3002\u305d\u3093\u306a\u3068\u304d\u3001Microsoft \u306e Phi-1 \u8ad6\u6587\u304c\u76ee\u899a\u307e\u3057\u306e\u3088\u3046\u306b\u3042\u306a\u305f\u3092\u8972\u3044\u307e\u3059\u3002\u300c\u5fc5\u8981\u306a\u306e\u306f\u6559\u79d1\u66f8\u3060\u3051\u3060\u300d\u3002\u5fc5\u8981\u306a\u306e\u306f\u3001\u660e\u78ba\u306a\u30ed\u30b8\u30c3\u30af\u3001\u5b8c\u74a7\u306a\u30b3\u30e1\u30f3\u30c8\u3001\u9032\u6b69\u7684\u306a\u6559\u3048\u3092\u5099\u3048\u305f\u6559\u79d1\u66f8\u306e\u3088\u3046\u306a\u30b3\u30fc\u30c9\u3067\u3042\u308a\u3001\u795e\u3068\u539f\u4f5c\u8005\u3060\u3051\u304c\u7406\u89e3\u3067\u304d\u308b\u300c\u30b9\u30d1\u30b2\u30c3\u30c6\u30a3 \u30b3\u30fc\u30c9\u300d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u3057\u304b\u3057\u3001\u4f55\u5343\u5104\u3082\u306e\u5b8c\u74a7\u306a\u6559\u79d1\u66f8\u306f\u3069\u3053\u3067\u898b\u3064\u304b\u308b\u306e\u3067\u3057\u3087\u3046\u304b?\u305d\u308c\u3089\u3092\u898b\u3064\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u79c1\u305f\u3061\u306f\u3053\u306e\u30c7\u30fc\u30bf\u3092\u4f55\u3082\u306a\u3044\u3068\u3053\u308d\u304b\u3089\u300c\u4f5c\u6210\u300d\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3070\u306a\u3051\u308c\u3070\u306a\u308a\u307e\u305b\u3093\u3002\u3053\u308c\u3089\u306e\u5b8c\u74a7\u306a\u6559\u79d1\u66f8\u3092\u30d0\u30c3\u30c1\u751f\u7523\u3059\u308b\u305f\u3081\u306e\u3001\u305f\u3086\u307e\u306c\u300c\u30d0\u30fc\u30c1\u30e3\u30eb\u6559\u6388\u300d\u3092\u69cb\u7bc9\u3059\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u304b?\u3053\u308c\u304c\u3001\u3053\u306e\u7ae0\u3067\u53d6\u308a\u4e0a\u3052\u308b\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u4e0a\u306e\u4e3b\u8981\u306a\u8ab2\u984c\u3067\u3059\u3002\u300d</p>"},{"location":"ja/part4/4_2_synthetic_data/#101","title":"10.1 \u4e2d\u5fc3\u3068\u306a\u308b\u6982\u5ff5\u3068\u539f\u5247 (\u6982\u5ff5\u3068\u539f\u5247)","text":"<p>\u5408\u6210\u30c7\u30fc\u30bf\u306e\u4e2d\u5fc3\u7684\u306a\u8ab2\u984c\u306f\u3001\u54c1\u8cea\u7ba1\u7406\u3068\u691c\u8a3c\u30eb\u30fc\u30d7\u306b\u3042\u308a\u307e\u3059\u3002\u30e2\u30c7\u30eb\u304c\u751f\u6210\u3057\u305f\u30c6\u30ad\u30b9\u30c8\u306b\u306f\u3001\u78ba\u8a8d\u305b\u305a\u306b\u5e7b\u899a\u3084\u30a8\u30e9\u30fc\u304c\u542b\u307e\u308c\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308b\u305f\u3081\u3067\u3059\u3002\u8aa4\u3063\u305f\u30c7\u30fc\u30bf\u306b\u57fa\u3065\u3044\u3066\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u3068\u3001\u300c\u30e2\u30c7\u30eb\u306e\u30aa\u30fc\u30c8\u30d5\u30a1\u30b8\u30fc\u300d\u307e\u305f\u306f\u300c\u30e2\u30c7\u30eb\u306e\u5d29\u58ca\u300d\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u30e2\u30c7\u30eb\u306e\u51fa\u529b\u306e\u5dee\u7570\u304c\u5f90\u3005\u306b\u306a\u304f\u306a\u308a\u3001\u5185\u5bb9\u304c\u975e\u5e38\u306b\u5747\u8cea\u306b\u306a\u308a\u3001\u73fe\u5b9f\u304b\u3089\u5207\u308a\u96e2\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u7d39\u4ecb\u3059\u308b 3 \u3064\u306e\u65b9\u6cd5\u306f\u3001\u305d\u308c\u305e\u308c\u30c6\u30ad\u30b9\u30c8\u3001\u30b3\u30fc\u30c9/\u6570\u5b66\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u306e\u54c1\u8cea\u306e\u554f\u984c\u306b\u5bfe\u51e6\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#1011","title":"10.1.1 \u5408\u6210\u30c7\u30fc\u30bf\u306e\u91cf\u3088\u308a\u3082\u54c1\u8cea\u304c\u306f\u308b\u304b\u306b\u91cd\u8981\u306a\u306e\u306f\u306a\u305c\u3067\u3059\u304b?","text":"<p>\u521d\u671f\u306e\u30c7\u30a3\u30fc\u30d7\u30e9\u30fc\u30cb\u30f3\u30b0\u3067\u306f\u3001\u300c\u30c7\u30fc\u30bf\u91cf\u306f\u6b63\u7fa9\u300d\u3001\u3064\u307e\u308a\u5341\u5206\u306a\u30c7\u30fc\u30bf\u304c\u3042\u308c\u3070\u30e2\u30c7\u30eb\u306f\u3059\u3079\u3066\u3092\u5b66\u7fd2\u3067\u304d\u308b\u3068\u4fe1\u3058\u3089\u308c\u3066\u3044\u307e\u3057\u305f\u3002\u3057\u304b\u3057\u3001\u5408\u6210\u30c7\u30fc\u30bf\u306e\u6642\u4ee3\u3067\u306f\u3001\u3053\u306e\u5b9a\u8aac\u306f\u8986\u3055\u308c\u307e\u3057\u305f\u3002</p> <p>\u4fe1\u53f7\u5bfe\u96d1\u97f3\u6bd4\u306e\u7406\u8ad6: \u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306f\u672c\u8cea\u7684\u306b\u306f\u60c5\u5831\u5727\u7e2e\u30d7\u30ed\u30bb\u30b9\u3067\u3059\u3002\u9ad8\u54c1\u8cea\u306e\u30c7\u30fc\u30bf (\u6559\u79d1\u66f8\u306a\u3069) \u306f\u3001\u975e\u5e38\u306b\u9ad8\u3044\u60c5\u5831\u5bc6\u5ea6\u3068\u53b3\u5bc6\u306a\u8ad6\u7406\u30c1\u30a7\u30fc\u30f3\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u3002\u30e2\u30c7\u30eb\u306f\u3001\u57fa\u790e\u3068\u306a\u308b\u30d1\u30bf\u30fc\u30f3\u3092\u6355\u6349\u3059\u308b\u305f\u3081\u306b\u5c11\u6570\u306e\u30b5\u30f3\u30d7\u30eb\u3092\u5fc5\u8981\u3068\u3057\u307e\u3059\u3002\u4f4e\u54c1\u8cea\u306e\u30c7\u30fc\u30bf (\u30d5\u30a9\u30fc\u30e9\u30e0\u306e\u30b9\u30d1\u30e0\u3001\u304a\u3057\u3083\u3079\u308a\u306a\u3069) \u306b\u306f\u3001\u30ce\u30a4\u30ba\u3068\u8ad6\u7406\u7684\u306a\u30ae\u30e3\u30c3\u30d7\u304c\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059\u3002\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30bb\u30c3\u30c8\u306b\u5927\u91cf\u306e\u4f4e\u54c1\u8cea\u306e\u5408\u6210\u30c7\u30fc\u30bf\u304c\u6df7\u5728\u3057\u3066\u3044\u308b\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306f\u640d\u5931\u3092\u524a\u6e1b\u3059\u308b\u305f\u3081\u306b\u3053\u306e\u30ce\u30a4\u30ba\u3092\u5f37\u5236\u7684\u306b\u9069\u5408\u3055\u305b\u3001\u300c\u8ad6\u7406\u56de\u8def\u300d\u304c\u77ed\u7d61\u3059\u308b\u539f\u56e0\u3068\u306a\u308a\u307e\u3059\u3002</p> <p>\u7269\u7406\u5b66\u3092\u5b66\u3076: \u30d5\u30a1\u30a4\u30f3\u30de\u30f3\u8b1b\u7fa9 \u306e\u3088\u3046\u306a\u53e4\u5178\u3092\u8aad\u3080\u3053\u3068 (\u9ad8\u54c1\u8cea\u306e\u5408\u6210\u30c7\u30fc\u30bf) \u306f\u300110,000 \u672c\u306e\u65ad\u7247\u7684\u306a\u7269\u7406\u666e\u53ca\u30d3\u30c7\u30aa (\u4f4e\u54c1\u8cea\u30c7\u30fc\u30bf) \u3092\u898b\u308b\u3053\u3068\u3088\u308a\u3082\u512a\u308c\u3066\u3044\u307e\u3059\u3002 Phi-1 \u306e\u6210\u529f\u306f\u3001\u6559\u79d1\u66f8\u30ec\u30d9\u30eb\u306e\u30c7\u30fc\u30bf\u306e 60 \u5104\u30c8\u30fc\u30af\u30f3\u304c\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u52b9\u679c\u306b\u304a\u3044\u3066 Web \u30af\u30ed\u30fc\u30eb\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306e 1000 \u5104\u30c8\u30fc\u30af\u30f3\u3092\u4e0a\u56de\u308b\u53ef\u80fd\u6027\u304c\u3042\u308b\u3053\u3068\u3092\u8a3c\u660e\u3057\u307e\u3057\u305f\u3002\u5408\u6210\u30c7\u30fc\u30bf\u3067\u306f\u3001\u691c\u8a3c\u30b3\u30b9\u30c8 \u304c\u65b0\u3057\u3044\u901a\u8ca8\u306b\u306a\u308a\u307e\u3057\u305f\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#1012","title":"10.1.2 \u6559\u79d1\u66f8\u30ec\u30d9\u30eb\u306e\u30c7\u30fc\u30bf (\u5fc5\u8981\u306a\u306e\u306f\u6559\u79d1\u66f8\u3060\u3051\u3067\u3059)","text":"<p>Microsoft Phi-1 \u306e\u4e2d\u5fc3\u7684\u306a\u30a2\u30a4\u30c7\u30a2: 1TB \u306e\u30b4\u30df\u30c7\u30fc\u30bf\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u30016B \u30c8\u30fc\u30af\u30f3\u306e\u9ad8\u54c1\u8cea\u30c7\u30fc\u30bf\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u305d\u306e\u6838\u5fc3\u306f\u300c\u30d5\u30a3\u30eb\u30bf\u30fc\u300d\u3068\u300c\u30a2\u30f3\u30d7\u300d\u306e\u69cb\u7bc9\u306b\u3042\u308a\u307e\u3059\u3002</p> <p>\u307e\u305a\u3001Web \u30c7\u30fc\u30bf\u3092\u5b8c\u5168\u306b\u653e\u68c4\u3059\u308b\u308f\u3051\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u300c\u6559\u80b2\u7684\u4fa1\u5024\u300d\u306e\u3042\u308b\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u8b58\u5225\u3059\u308b\u305f\u3081\u306e\u5206\u985e\u5b50 (\u54c1\u8cea\u5206\u985e\u5b50) \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u5358\u306b\u6587\u6cd5\u3092\u30c1\u30a7\u30c3\u30af\u3059\u308b\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u304c\u8ad6\u7406\u7684\u306b\u4e00\u8cab\u6027\u304c\u3042\u308a\u3001\u5b9a\u7fa9\u3068\u63a8\u8ad6\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u30c1\u30a7\u30c3\u30af\u3057\u307e\u3059\u3002\u7b2c 2 \u306b\u3001\u5f37\u529b\u306a\u751f\u6210\u30e2\u30c7\u30eb (GPT-4 \u306a\u3069) \u3092\u300c\u5897\u5e45\u5668\u300d\u3068\u3057\u3066\u4f7f\u7528\u3057\u3001\u3053\u308c\u3089\u306e\u9ad8\u54c1\u8cea\u306e\u30b9\u30cb\u30da\u30c3\u30c8\u306b\u57fa\u3065\u3044\u3066\u3001\u30b9\u30bf\u30a4\u30eb\u306f\u4f3c\u3066\u3044\u308b\u304c\u307e\u3063\u305f\u304f\u65b0\u3057\u3044\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u5099\u3048\u305f\u81ea\u5df1\u5b8c\u7d50\u578b\u306e\u77e5\u8b58\u306e\u65ad\u7247\u3092\u5408\u6210\u3057\u307e\u3059\u3002</p> <p> \u56f3 10-1: Phi-1 \u30d7\u30ed\u30bb\u30b9\u56f3</p>"},{"location":"ja/part4/4_2_synthetic_data/#1013-pot","title":"10.1.3 \u30b3\u30fc\u30c9\u3068\u6570\u5b66\u306e\u5408\u6210: PoT (\u601d\u8003\u30d7\u30ed\u30b0\u30e9\u30e0)","text":"<p>LLM \u306f\u672c\u8cea\u7684\u306b\u78ba\u7387\u30e2\u30c7\u30eb\u3067\u3042\u308a\u3001\u771f\u306e\u8ad6\u7406\u63a8\u8ad6\u30c1\u30c3\u30d7\u3092\u5099\u3048\u3066\u3044\u307e\u305b\u3093\u3002\u3057\u305f\u304c\u3063\u3066\u3001LLM \u304c\u7b97\u8853 (234 * 567 \u306a\u3069) \u307e\u305f\u306f\u8907\u96d1\u306a\u8ad6\u7406\u5c0e\u51fa\u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u5e7b\u899a\u304c\u73fe\u308c\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002 PoT (\u601d\u8003\u30d7\u30ed\u30b0\u30e9\u30e0) \u306f\u6b21\u306e\u3088\u3046\u306b\u8003\u3048\u307e\u3059\u3002LLM \u306f\u8a08\u7b97\u306f\u5f97\u610f\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u7ffb\u8a33\u306f\u5f97\u610f\u3067\u3042\u308b\u305f\u3081\u3001\u6570\u5b66\u306e\u554f\u984c\u3092\u30b3\u30fc\u30c9\u306b\u300c\u7ffb\u8a33\u300d\u3055\u305b\u3001Python \u30a4\u30f3\u30bf\u30d7\u30ea\u30bf\u306b\u7d50\u679c\u3092\u8a08\u7b97\u3055\u305b\u307e\u3059\u3002</p> <p>\u3053\u308c\u306f\u3001100% \u306e\u7cbe\u5ea6\u691c\u8a3c\u3092\u9054\u6210\u3057\u305f\u5408\u6210\u30c7\u30fc\u30bf\u306e\u552f\u4e00\u306e\u30c9\u30e1\u30a4\u30f3\u3067\u3059\u3002\u751f\u6210\u3055\u308c\u305f\u30b3\u30fc\u30c9\u3092 Python \u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u306b\u5165\u308c\u3066\u5b9f\u884c\u3057\u307e\u3059\u3002\u30a8\u30e9\u30fc\u306e\u5834\u5408\u306f\u7834\u68c4\u3057\u307e\u3059\u3002\u6b63\u5e38\u306b\u5b9f\u884c\u3055\u308c\u305f\u5834\u5408\u3001\u5b9f\u884c\u7d50\u679c\u306f Ground Truth \u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u300c\u5b9f\u884c\u30a4\u30b3\u30fc\u30eb\u691c\u8a3c\u300d\u30e1\u30ab\u30cb\u30ba\u30e0\u306f\u3001\u5408\u6210\u30c7\u30fc\u30bf\u306e\u691c\u8a3c\u53ef\u80fd\u6027\u306e\u554f\u984c\u3092\u5b8c\u5168\u306b\u89e3\u6c7a\u3057\u3001\u7121\u9650\u306e\u6570\u5b66\u304a\u3088\u3073\u8ad6\u7406\u63a8\u8ad6\u30c7\u30fc\u30bf\u3092\u4f4e\u30b3\u30b9\u30c8\u3067\u751f\u6210\u3067\u304d\u308b\u3088\u3046\u306b\u3057\u307e\u3059\u3002</p> <p>\u8868 10-1: \u5408\u6210\u30c7\u30fc\u30bf\u691c\u8a3c\u6226\u7565\u306e\u6bd4\u8f03</p> \u30c7\u30fc\u30bf\u578b \u30b8\u30a7\u30cd\u30ec\u30fc\u30bf\u30fc \u30b3\u30a2\u30c1\u30e3\u30ec\u30f3\u30b8 \u691c\u8a3c\u8005 \u691c\u8a3c\u30e1\u30ab\u30cb\u30ba\u30e0 \u4e00\u822c\u7684\u306a\u30c6\u30ad\u30b9\u30c8 GPT-4 / \u30b8\u30a7\u30df\u30cb \u5e7b\u899a LLM (\u5be9\u67fb\u54e1) / \u5831\u916c\u30e2\u30c7\u30eb \u5f37\u529b\u306a\u30e2\u30c7\u30eb\u306e\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002\u4e00\u8cab\u6027\u304c\u4f4e\u3044\u3002 \u300c\u30b8\u30e3\u30c3\u30b8\u30d0\u30a4\u30a2\u30b9\u300d\u306b\u306a\u308a\u3084\u3059\u3044 \u6570\u5b66/\u8ad6\u7406 GPT-4 + PoT \u30d7\u30ed\u30f3\u30d7\u30c8 \u8a08\u7b97\u30a8\u30e9\u30fc Python \u30a4\u30f3\u30bf\u30d7\u30ea\u30bf \u5b9f\u884c\u306e\u4e00\u8cab\u6027: \u30b3\u30fc\u30c9\u306e\u5b9f\u884c\u7d50\u679c\u306f\u4e88\u60f3\u3055\u308c\u308b\u7b54\u3048\u3068\u4e00\u81f4\u3057\u307e\u3059\u3002\u8ad6\u7406\u306f\u7d76\u5bfe\u306b\u6b63\u3057\u3044 \u30b3\u30fc\u30c9 DeepSeek \u30b3\u30fc\u30c0\u30fc / GPT-4 \u69cb\u6587\u30a8\u30e9\u30fc\u3001\u30ed\u30b8\u30c3\u30af\u306e\u30d0\u30b0 \u5358\u4f53\u30c6\u30b9\u30c8/\u30b3\u30f3\u30d1\u30a4\u30e9 \u5358\u4f53\u30c6\u30b9\u30c8: \u30a2\u30b5\u30fc\u30c8\u307e\u305f\u306f\u30b3\u30f3\u30d1\u30a4\u30eb\u306e\u6210\u529f\u306b\u3088\u308a\u3001\u6a5f\u80fd\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb GPT-4o / LLaVA \u5e7b\u8996\uff08\u634f\u9020\uff09 CLIP \u30b9\u30b3\u30a2 / \u30b0\u30e9\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0 DINO \u751f\u6210\u3055\u308c\u305f\u8aac\u660e\u304c\u753b\u50cf\u306eEmbedding\u3068\u4e00\u81f4\u3059\u308b\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002\u5b58\u5728\u3057\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u634f\u9020\u3092\u9632\u3050"},{"location":"ja/part4/4_2_synthetic_data/#1014","title":"10.1.4 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u547d\u4ee4\u5408\u6210: \u30d6\u30ea\u30c3\u30b8\u30f3\u30b0\u8a8d\u8b58","text":"<p>\u753b\u50cf\u30c7\u30fc\u30bf\u306e\u5834\u5408\u3001\u5f93\u6765\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u30b3\u30b9\u30c8\u306f\u975e\u5e38\u306b\u9ad8\u304f\u3001\u8aac\u660e\u306f\u7c21\u6f54\u3067\u3059\u3002 LLaVA\u306f\u898b\u4e8b\u306a\u300c\u76f2\u4eba\u3068\u8c61\u300d\u6226\u7565\u3092\u63d0\u6848\u3057\u305f\u3002\u65e2\u5b58\u306e\u691c\u51fa\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u753b\u50cf\u3092\u8a18\u53f7\u7684\u306a\u30c6\u30ad\u30b9\u30c8\u8aac\u660e (\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 + \u5883\u754c\u30dc\u30c3\u30af\u30b9) \u306b\u5909\u63db\u3057\u3001\u3053\u306e\u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8\u3092\u5f37\u529b\u306a\u30c6\u30ad\u30b9\u30c8\u5c02\u7528\u30e2\u30c7\u30eb (GPT-4 \u306a\u3069) \u306b\u4f9b\u7d66\u3057\u307e\u3059\u3002 GPT-4 \u306f\u753b\u50cf\u3092\u898b\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u304c\u3001\u3053\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u901a\u3058\u3066\u753b\u50cf\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u300c\u60f3\u50cf\u300d\u3057\u3001\u305d\u308c\u306b\u57fa\u3065\u3044\u3066\u8907\u96d1\u306a\u63a8\u8ad6\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u751f\u6210\u3067\u304d\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u306a\u30c7\u30fc\u30bf\u4e0d\u8db3\u304c\u89e3\u6c7a\u3055\u308c\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u547d\u4ee4\u306e\u8907\u96d1\u3055\u3068\u30ed\u30b8\u30c3\u30af\u304c\u5927\u5e45\u306b\u5411\u4e0a\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#102","title":"10.2 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u5b9f\u88c5 (\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u5b9f\u88c5)","text":"<p>\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3001\u30b3\u30fc\u30c9\u30ec\u30d9\u30eb\u306e\u5b9f\u88c5\u306b\u3064\u3044\u3066\u8a73\u3057\u304f\u8aac\u660e\u3057\u3001\u5b8c\u5168\u306a\u30c7\u30fc\u30bf\u5408\u6210\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\u30c7\u30fc\u30bf\u306e\u591a\u69d8\u6027\u3092\u78ba\u4fdd\u3057\u3001\u751f\u6210\u3055\u308c\u308b\u300c\u6559\u79d1\u66f8\u300d\u304c\u5358\u8abf\u306b\u306a\u3089\u306a\u3044\u3088\u3046\u6ce8\u529b\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#1021","title":"10.2.1 \u6559\u79d1\u66f8\u30ec\u30d9\u30eb\u306e\u30c7\u30fc\u30bf: \u5206\u985e\u5668\u3068\u5408\u6210\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u30b9\u30c6\u30c3\u30d7 1: \u54c1\u8cea\u5206\u985e\u5b50\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b \u5927\u91cf\u306e\u30c7\u30fc\u30bf\u304b\u3089\u300c\u6559\u79d1\u66f8\u300d\u3092\u9078\u629e\u3059\u308b\u306b\u306f\u3001\u8efd\u91cf\u30e2\u30c7\u30eb (Random Forest \u3084 BERT-Tiny \u306a\u3069) \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u91cd\u8981\u306a\u306e\u306f\u3001\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 \u30c7\u30fc\u30bf \u30bd\u30fc\u30b9\u3067\u3059\u3002\u901a\u5e38\u3001\u30b7\u30fc\u30c9\u3068\u3057\u3066\u6570\u5343\u306e\u30b5\u30f3\u30d7\u30eb\u306b\u5bfe\u3059\u308b\u5c02\u9580\u5bb6\u307e\u305f\u306f GPT-4 \u306e\u614e\u91cd\u306a\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u30b3\u30fc\u30c9\u306e\u5b9f\u88c5: \u6a5f\u80fd\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3068\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 </p><pre><code>import pandas as pd\nfrom sklearn.ensemble import RandomForestClassifier\nfrom sklearn.feature_extraction.text import TfidfVectorizer\nfrom sklearn.pipeline import Pipeline\n\n# 1. Prepare annotation data\n# First annotate a small number of samples (e.g., 1000) with GPT-4 as \"gold standard\"\n# Prompt: \"Determine if this text is of educational value for a student...\"\n# Label 1: High Quality (Textbook-like), Label 0: Low Quality (Noise)\n# This step is critical; annotation quality directly determines classifier ceiling\ndata = [\n    {\"text\": \"Python lists are mutable sequences...\", \"label\": 1},\n    {\"text\": \"Hey guys check out my cat photo...\", \"label\": 0},\n    # ... more data\n] \ndf = pd.DataFrame(data)\n\n# 2. Build classifier pipeline\n# Phi-1 paper uses pretrained model Embedding; here simplified to TF-IDF for demonstration\n# In production, recommend DeBERTa-v3-small or similar lightweight Transformer for Embedding\npipeline = Pipeline([\n    ('tfidf', TfidfVectorizer(max_features=5000, stop_words='english')),\n    ('clf', RandomForestClassifier(n_estimators=100, n_jobs=-1))\n])\n\n# 3. Train\nX = df['text']\ny = df['label']\npipeline.fit(X, y)\n\n# 4. Predict (Filtering Phase)\n# Score massive web data; retain only high-scoring data\nweb_snippet = \"Standard library documentation for Python...\"\nscore = pipeline.predict_proba([web_snippet])[0][1]\n\nif score &gt; 0.8:\n    print(\"Keep this data for training: High Educational Value\")\nelse:\n    print(\"Discard: Low Signal-to-Noise Ratio\")\n</code></pre><p></p> <p>\u30b9\u30c6\u30c3\u30d7 2: \u5408\u6210\u6559\u79d1\u66f8\u30d5\u30e9\u30b0\u30e1\u30f3\u30c8\u306e\u751f\u6210 \u5206\u985e\u5668\u3067\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3055\u308c\u305f\u30b7\u30fc\u30c9 \u30c7\u30fc\u30bf\u306e\u5834\u5408\u306f\u3001\u305d\u308c\u3092\u300c\u62e1\u5f35\u300d\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u3053\u3067\u306e\u8fc5\u901f\u306a\u8a2d\u8a08\u306b\u306f\u9ad8\u5ea6\u306a\u30b9\u30ad\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u30d7\u30ed\u30f3\u30d7\u30c8\u53cd\u5fa9: \u5408\u6210 Python \u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb * V1 \u30d7\u30ed\u30f3\u30d7\u30c8: \u300cPython \u30ea\u30b9\u30c8\u306b\u95a2\u3059\u308b\u30c1\u30e5\u30fc\u30c8\u30ea\u30a2\u30eb\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u300d     * \u7d50\u679c: \u5e73\u51e1\u306a\u30d6\u30ed\u30b0\u6295\u7a3f\u306e\u3088\u3046\u306a\u3001\u5e73\u5766\u306a\u7269\u8a9e\u3067\u6df1\u307f\u304c\u3042\u308a\u307e\u305b\u3093\u3002 * V3 \u30d7\u30ed\u30f3\u30d7\u30c8 (\u30d5\u30a1\u30a4 \u30b9\u30bf\u30a4\u30eb): \u5b9a\u7fa9\u3001\u6bd4\u8f03\u3001\u8907\u96d1\u3055\u306e\u5206\u6790\u3001\u843d\u3068\u3057\u7a74\u306e\u8b66\u544a\u3092\u5fc5\u8981\u3068\u3059\u308b\u7279\u5b9a\u306e\u6559\u80b2\u6cd5\u304c\u5c0e\u5165\u3055\u308c\u307e\u3057\u305f\u3002</p> <pre><code># V3 Prompt - Textbook-style synthesis\nsynthetic_textbook_prompt = \"\"\"\n### ROLE\nYou are a professor of Computer Science writing a definitive textbook on Python.\n\n### OBJECTIVE\nWrite a comprehensive, self-contained chapter section on the topic: \"List Comprehensions vs. Map/Filter\".\n\n### REQUIREMENTS\n1. **Tone**: Educational, clear, precise, and rigorous. Avoid conversational filler.\n2. **Structure**:\n   - Start with a conceptual definition explaining *why* this feature exists.\n   - Provide a \"Before and After\" code example (Loop vs. Comprehension).\n   - Explain the *computational complexity* (Big O) implications.\n   - Include a \"Common Pitfall\" section (e.g., readability vs. brevity).\n3. **Diversity**: Use realistic variable names (e.g., `inventory_items`, `sensor_readings`), NOT generic ones like `x`, `y`, `foo`. \n   (This is crucial to prevent the model from overfitting to toy examples).\n\n### OUTPUT\n[Markdown Content]\n\"\"\"\n</code></pre>"},{"location":"ja/part4/4_2_synthetic_data/#1022","title":"10.2.2 \u9006\u7ffb\u8a33: \u56de\u7b54\u304b\u3089\u8cea\u554f\u3092\u5c0e\u304d\u51fa\u3059","text":"<p>\u30b9\u30af\u30e9\u30c3\u30c1\u304b\u3089\u751f\u6210\u3059\u308b\u4ee5\u5916\u306b\u3001\u3082\u3046 1 \u3064\u306e\u52b9\u7387\u7684\u306a\u65b9\u6cd5\u306f\u300c\u9006\u5909\u63db\u300d\u3067\u3059\u3002\u30b3\u30fc\u30c9\u3067\u306f\u3001\u9ad8\u54c1\u8cea\u306e\u30b3\u30fc\u30c9 \u30b9\u30cb\u30da\u30c3\u30c8 (GitHub \u306e\u30cf\u30a4\u30b9\u30bf\u30fc \u30e9\u30a4\u30d6\u30e9\u30ea\u95a2\u6570\u306a\u3069) \u306f\u7c21\u5358\u306b\u898b\u3064\u304b\u308a\u307e\u3059\u304c\u3001\u5bfe\u5fdc\u3059\u308b\u81ea\u7136\u8a00\u8a9e\u547d\u4ee4\u304c\u4e0d\u8db3\u3057\u3066\u3044\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002</p> <p>LLM \u8981\u7d04\u3092\u4f7f\u7528\u3067\u304d\u307e\u3059\u3002\u8907\u96d1\u306a\u30b3\u30fc\u30c9\u3092\u5165\u529b\u3057\u3001\u30e2\u30c7\u30eb\u306b\u300c\u3053\u306e\u30b3\u30fc\u30c9\u304c\u554f\u984c\u3092\u6b63\u78ba\u306b\u89e3\u6c7a\u3067\u304d\u308b\u3088\u3046\u306b\u3001\u3055\u307e\u3056\u307e\u306a\u30e6\u30fc\u30b6\u30fc\u8981\u4ef6\u306e\u6307\u793a\u3092\u3067\u304d\u308b\u3060\u3051\u8a73\u7d30\u306b\u66f8\u3044\u3066\u304f\u3060\u3055\u3044\u3002\u300d\u3068\u5c0b\u306d\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u9ad8\u54c1\u8cea\u304c\u4fdd\u8a3c\u3055\u308c\u305f\u30d2\u30e5\u30fc\u30de\u30f3 \u30b3\u30fc\u30c9\u3092\u542b\u3080\u5927\u898f\u6a21\u306a (\u547d\u4ee4\u3001\u51fa\u529b) \u30da\u30a2\u304c\u8fc5\u901f\u306b\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u3053\u306e\u65b9\u6cd5\u306f\u3001\u8907\u96d1\u306a\u30b3\u30fc\u30c9 \u30ed\u30b8\u30c3\u30af\u306e\u30e2\u30c7\u30eb\u306e\u7406\u89e3\u3092\u5f37\u5316\u3059\u308b\u306e\u306b\u7279\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#1023-pot","title":"10.2.3 \u30b3\u30fc\u30c9\u3068\u6570\u5b66\u306e\u5408\u6210: PoT (\u601d\u8003\u30d7\u30ed\u30b0\u30e9\u30e0)","text":"<p>\u3053\u308c\u306f\u3001\u5408\u6210\u30c7\u30fc\u30bf\u306e\u6b63\u78ba\u6027\u3092\u4fdd\u8a3c\u3059\u308b\u6700\u3082\u5f37\u529b\u306a\u624b\u6bb5\u3067\u3059\u3002\u30e2\u30c7\u30eb\u306b\u30b3\u30fc\u30c9\u3092\u751f\u6210\u3055\u305b\u308b\u3053\u3068\u3067\u3001\u3042\u3044\u307e\u3044\u306a\u81ea\u7136\u8a00\u8a9e\u63a8\u8ad6\u3092\u6b63\u78ba\u306a\u30d7\u30ed\u30b0\u30e9\u30e0 \u30ed\u30b8\u30c3\u30af\u306b\u5909\u63db\u3057\u307e\u3059\u3002</p> <p>\u30b3\u30a2\u30b3\u30fc\u30c9\u306e\u5185\u8a33: \u751f\u6210\u3068\u691c\u8a3c\u30eb\u30fc\u30d7 </p><pre><code>import subprocess\nimport tempfile\nimport os\n\n# 1. PoT Generation Prompt\n# Require model to write solution steps as Python function solver()\npot_prompt = \"\"\"\nQuestion: Janet has 3 times as many eggs as Bob. Bob has 5 eggs. How many eggs do they have in total?\n\nInstruction:\nWrite a Python function named `solver()` that returns the answer.\nDo not output the number directly. Write the code to calculate it.\nInclude comments explaining the logic.\n\"\"\"\n\n# Assume LLM returns the following code string\ngenerated_code = \"\"\"\ndef solver():\n    # Bob has 5 eggs\n    bob_eggs = 5\n    # Janet has 3 times as many as Bob\n    janet_eggs = 3 * bob_eggs\n    # Total eggs\n    total = janet_eggs + bob_eggs\n    return total\n\"\"\"\n\n# 2. Code Execution Sandbox\n# WARNING: Directly executing generated code is extremely dangerous; must run in sandbox\ndef execute_generated_code(code_str):\n    try:\n        # In production use Docker, gVisor, or nsjail for isolation\n        local_scope = {}\n\n        # Limit execution time to prevent infinite loops\n        # Here uses simplified exec for demo; production needs resource module for CPU/memory limits\n        exec(code_str, {}, local_scope)\n\n        if 'solver' in local_scope:\n            result = local_scope['solver']()\n            return result, \"Success\"\n        else:\n            return None, \"No solver function found\"\n    except Exception as e:\n        return None, f\"Execution Error: {str(e)}\"\n\n# 3. Verification and Data Saving\nresult, status = execute_generated_code(generated_code)\n\nif status == \"Success\":\n    print(f\"Verified Answer: {result}\")\n    # Data saving strategy:\n    # Strategy A (PoT): Save Instruction -&gt; Code. Train model to write code for solving.\n    # Strategy B (CoT): Save Instruction -&gt; \"Let's calculate... [Reasoning]... The answer is {result}\".\n    # Strategy B uses code as intermediate step to generate pure text reasoning data.\n    save_to_dataset(pot_prompt, generated_code, result)\nelse:\n    print(\"Discard bad data: Code failed to execute\")\n</code></pre> \u30d7\u30ed\u306e\u30d2\u30f3\u30c8: \u751f\u6210\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306f\u3001PoT \u3060\u3051\u3067\u306a\u304f\u901a\u5e38\u306e CoT \u30e2\u30c7\u30eb\u3082\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u304d\u307e\u3059\u3002\u65b9\u6cd5: \u5b9f\u884c\u306b\u6210\u529f\u3057\u305f\u30b3\u30fc\u30c9\u3092\u300c\u4e2d\u9593\u30b9\u30c6\u30c3\u30d7\u300d\u3001\u5b9f\u884c\u7d50\u679c\u3092\u300c\u6700\u7d42\u56de\u7b54\u300d\u3068\u3057\u3066\u4f7f\u7528\u3057\u3001<code>&lt;thinking&gt;...code...&lt;/thinking&gt;&lt;answer&gt;...result...&lt;/answer&gt;</code> \u5f62\u5f0f\u3092\u9006\u306b\u69cb\u7bc9\u3057\u307e\u3059\u3002\u3053\u306e\u300c\u9d8f\u3092\u501f\u308a\u3066\u5375\u3092\u7523\u3080\u300d\u65b9\u6cd5\u306b\u3088\u308a\u3001\u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8 \u30e2\u30c7\u30eb\u306e\u6f14\u7b97\u7cbe\u5ea6\u304c\u5927\u5e45\u306b\u5411\u4e0a\u3057\u307e\u3059\u3002<p></p>"},{"location":"ja/part4/4_2_synthetic_data/#1024-llava","title":"10.2.4 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u547d\u4ee4\u5408\u6210: LLaVA \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u30c6\u30ad\u30b9\u30c8\u306e\u307f\u306e\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u3092\u5408\u6210\u3059\u308b\u3053\u3068\u306f\u3001LLaVA \u306e\u9769\u65b0\u3067\u3059\u3002\u3053\u306e\u30e1\u30bd\u30c3\u30c9\u306e\u6838\u5fc3\u306f\u3001\u8996\u899a\u60c5\u5831\u3092\u8a18\u53f7\u5316\u3059\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002\u30c6\u30ad\u30b9\u30c8\u306e\u307f\u306e\u30e2\u30c7\u30eb (GPT-4 \u306a\u3069) \u306f\u753b\u50cf\u3092\u8a8d\u8b58\u3067\u304d\u306a\u3044\u305f\u3081\u3001\u753b\u50cf\u3092\u8aad\u307f\u53d6\u308a\u53ef\u80fd\u306a\u300c\u30b3\u30fc\u30c9\u300d\u306b\u5909\u63db\u3057\u307e\u3059\u3002</p> <p> \u56f3 10-2: LLaVA \u30c7\u30fc\u30bf\u5408\u6210\u30d7\u30ed\u30bb\u30b9\u56f3</p>"},{"location":"ja/part4/4_2_synthetic_data/#1","title":"1. \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u30d4\u30af\u30bb\u30eb\u304b\u3089\u30b7\u30f3\u30dc\u30eb\u307e\u3067","text":"<p>\u30d7\u30ed\u30f3\u30d7\u30c8\u8a2d\u8a08\u306e\u524d\u306b\u3001\u753b\u50cf\u3092\u30c6\u30ad\u30b9\u30c8 \u30e2\u30c7\u30eb\u3067\u8aad\u307f\u53d6\u308a\u53ef\u80fd\u306a\u69cb\u9020\u5316\u30c7\u30fc\u30bf (\u30e1\u30bf\u30c7\u30fc\u30bf) \u306b\u300c\u5206\u89e3\u300d\u3059\u308b\u305f\u3081\u306e\u30c4\u30fc\u30eb\u30c1\u30a7\u30fc\u30f3\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <ol> <li> <p>\u30b0\u30ed\u30fc\u30d0\u30eb \u30bb\u30de\u30f3\u30c6\u30a3\u30af\u30b9 (\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3)</p> <ul> <li>\u30c4\u30fc\u30eb: \u4e00\u6587\u306e\u8aac\u660e\u7528\u306e CLIP \u307e\u305f\u306f BLIP\u3002</li> <li>\u5f79\u5272: \u5168\u4f53\u7684\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</li> <li>\u51fa\u529b\u4f8b: <code>\"A young girl riding a horse on a beach at sunset.\"</code></li> </ul> </li> <li> <p>\u5c40\u6240\u7684\u306a\u8a73\u7d30 (\u7269\u4f53\u691c\u51fa)</p> <ul> <li>\u30c4\u30fc\u30eb: DINO \u3092\u63a5\u5730\u3057\u3066\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3068\u5ea7\u6a19\u3092\u62bd\u51fa\u3057\u307e\u3059 (\u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0 \u30dc\u30c3\u30af\u30b9)\u3002</li> <li>\u5f79\u5272: \u7a7a\u9593\u30a2\u30f3\u30ab\u30fc \u30a8\u30f3\u30c6\u30a3\u30c6\u30a3\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</li> <li>\u51fa\u529b\u4f8b: <code>{'girl': [100, 200, 300, 400], ...}</code></li> </ul> </li> <li> <p>\u30c7\u30fc\u30bf\u5408\u6210</p> <ul> <li>\u30a2\u30af\u30b7\u30e7\u30f3: \u4e0a\u8a18\u306e\u60c5\u5831\u3092\u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u5165\u529b\u3057\u3001GPT-4 \u3092\u547c\u3073\u51fa\u3057\u3066\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u751f\u6210\u3057\u307e\u3059\u3002</li> </ul> </li> </ol>"},{"location":"ja/part4/4_2_synthetic_data/#2","title":"2. \u30d7\u30ed\u30f3\u30d7\u30c8\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0: \u8a2d\u8a08\u3068\u8003\u616e\u4e8b\u9805","text":"<p>\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u3067\u306f\u3001\u8fc5\u901f\u306a\u8a2d\u8a08\u304c\u30c7\u30fc\u30bf\u54c1\u8cea\u306e\u9375\u3068\u306a\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u3001LLaVA \u30b9\u30bf\u30a4\u30eb\u306e\u30d7\u30ed\u30f3\u30d7\u30c8 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u3068\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u4e0a\u306e\u8003\u616e\u4e8b\u9805\u3067\u3059\u3002</p> <pre><code># System Prompt for Multimodal Data Generation\nmultimodal_gen_prompt = \"\"\"\n### CONTEXT\nYou are an AI visual assistant. You cannot see the image directly, but I will provide its metadata.\nYour task is to generate a conversation between a Human and Yourself about this image.\n\n### IMAGE METADATA\n# [Data injection point]: Fill pipeline-extracted data here\n- **Caption**: \"{caption}\"\n- **Objects**: {object_list_with_boxes}\n\n### INSTRUCTIONS\n1. **Conversation Style**: Generate a multi-turn Q&amp;A (User asking, Assistant answering).\n2. **Reasoning**: The Human should ask complex questions (e.g., \"What suggests this is a safe environment?\"). You answer based on the visual evidence.\n3. **Spatial Awareness**: Use the bounding box info to describe relative positions if asked (e.g., \"The ocean is in the background...\").\n4. **Visual Consistency**: Do NOT hallucinate objects not listed in the metadata.\n\"\"\"\n</code></pre> <p>\u30d7\u30ed\u30f3\u30d7\u30c8\u8a2d\u8a08\u306e\u80cc\u5f8c\u306b\u3042\u308b\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u4e0a\u306e\u8003\u616e\u4e8b\u9805:</p> <ul> <li> <p>\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u3068\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u4e21\u65b9\u3092\u63d0\u4f9b\u3059\u308b\u306e\u306f\u306a\u305c\u3067\u3059\u304b? (\u88dc\u5b8c\u6027)     \u30aa\u30d6\u30b8\u30a7\u30af\u30c8 (\u5973\u306e\u5b50\u3001\u99ac\u3001\u6d77) \u3060\u3051\u3067\u306f\u500b\u5225\u3067\u3042\u308a\u3001\u52d5\u304d\u3084\u96f0\u56f2\u6c17\u304c\u6b20\u3051\u3066\u3044\u307e\u3059\u3002\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\uff08\u99ac\u306b\u4e57\u3063\u305f\u5973\u306e\u5b50\uff09\u3060\u3051\u3067\u306f\u7279\u5b9a\u306e\u5834\u6240\u304c\u3042\u308a\u307e\u305b\u3093\u3002 GPT-4 \u3092\u7d44\u307f\u5408\u308f\u305b\u308b\u3068\u3001\u5b8c\u5168\u306a\u7cbe\u795e\u7684\u306a\u300c\u30b7\u30fc\u30f3 \u30b0\u30e9\u30d5\u300d\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</p> </li> <li> <p>\u306a\u305c\u300c\u7a7a\u9593\u8a8d\u8b58\u300d\u3092\u91cd\u8996\u3059\u308b\u306e\u3067\u3057\u3087\u3046\u304b? (\u7a7a\u9593\u8abf\u6574)     \u30c6\u30ad\u30b9\u30c8 \u30e2\u30c7\u30eb\u306b\u306f\u672c\u8cea\u7684\u306b\u7a7a\u9593\u611f\u899a\u304c\u6b20\u3051\u3066\u3044\u307e\u3059\u3002 <code>[x1, y1, x2, y2]</code> \u5ea7\u6a19\u30c7\u30fc\u30bf\u306e\u51e6\u7406\u3092\u5f37\u5236\u3059\u308b\u3053\u3068\u3067\u3001\u30c6\u30ad\u30b9\u30c8 \u30e2\u30c7\u30eb\u306b\u300c\u8996\u899a\u7684\u306a\u914d\u7f6e\u300d\u3001\u3064\u307e\u308a\u300c\u5de6\u300d\u3001\u300c\u53f3\u4e0b\u300d\u306a\u3069\u306b\u5bfe\u5fdc\u3059\u308b\u30d4\u30af\u30bb\u30eb\u9818\u57df\u3092\u7406\u89e3\u3059\u308b\u3053\u3068\u3092\u5f37\u5236\u7684\u306b\u5b66\u7fd2\u3055\u305b\u307e\u3059\u3002</p> </li> <li> <p>\u300c\u8996\u899a\u7684\u306a\u4e00\u8cab\u6027\u300d\u5236\u7d04\u3092\u8ffd\u52a0\u3059\u308b\u306e\u306f\u306a\u305c\u3067\u3059\u304b? (\u5e7b\u899a\u6291\u5236)     \u30c6\u30ad\u30b9\u30c8 \u30e2\u30c7\u30eb\u306e\u6700\u5927\u306e\u6b20\u70b9\u306f\u3001\u7c21\u5358\u306b\u300c\u8133\u3092\u57cb\u3081\u308b\u300d\u3053\u3068\u3067\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u300c\u30d3\u30fc\u30c1\u300d\u3092\u898b\u3066\u300c\u30ab\u30e2\u30e1\u304c\u98db\u3093\u3067\u3044\u308b\u300d\u3068\u634f\u9020\u3059\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u9ad8\u3044\u4fe1\u53f7\u5bfe\u96d1\u97f3\u6bd4\u3092\u78ba\u4fdd\u3059\u308b\u306b\u306f\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u306b\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u751f\u6210\u3092\u660e\u793a\u7684\u306b\u7981\u6b62\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> </li> <li> <p>\u306a\u305c\u300c\u8907\u96d1\u306a\u63a8\u8ad6\u300d\u304c\u751f\u6210\u3055\u308c\u308b\u306e\u3067\u3057\u3087\u3046\u304b? (\u30c7\u30fc\u30bf\u6b21\u5143\u306e\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9)     \u5358\u306a\u308b\u300c\u3053\u308c\u306f\u4f55\u3060\uff1f\u99ac\u300d\u3067\u306f\u80b2\u6210\u4fa1\u5024\u304c\u3042\u308a\u307e\u305b\u3093\u3002 GPT-4 \u306e\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30b9\u3092\u6d3b\u7528\u3057\u3066\u3001\u5408\u6210\u3092\u901a\u3058\u3066\u300c\u601d\u8003\u304c\u5fc5\u8981\u306a\u300d\u30b5\u30f3\u30d7\u30eb (\u56e0\u679c\u63a8\u8ad6\u3001\u611f\u60c5\u5206\u6790\u306a\u3069) \u3092\u4eba\u5de5\u7684\u306b\u4f5c\u6210\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u5c0f\u3055\u306a\u30e2\u30c7\u30eb (\u5b66\u751f) \u304c\u5b66\u7fd2\u3092\u901a\u3058\u3066\u5927\u898f\u6a21\u306a\u30e2\u30c7\u30eb\u63a8\u8ad6\u3092\u62bd\u51fa\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002</p> </li> </ul>"},{"location":"ja/part4/4_2_synthetic_data/#1025","title":"10.2.5 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u547d\u4ee4\u30c7\u30fc\u30bf\u5408\u6210\u306e\u9ad8\u5ea6\u306a\u6226\u7565","text":"<p>\u30c6\u30ad\u30b9\u30c8\u306e\u307f\u306e\u30e2\u30c7\u30eb (\u521d\u671f\u306e LLaVA v1 \u306a\u3069) \u306b\u57fa\u3065\u304f\u300c\u8a18\u53f7\u63a8\u8ad6\u300d\u306f\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u547d\u4ee4\u5408\u6210\u306e\u5148\u99c6\u3051\u3068\u306a\u308a\u307e\u3057\u305f\u304c\u3001\u305d\u306e\u4e3b\u306a\u6b20\u70b9\u306f\u300c\u8996\u899a\u60c5\u5831\u306e\u975e\u53ef\u9006\u5727\u7e2e\u300d\u3067\u3059\u3002\u30c6\u30ad\u30b9\u30c8 \u30e2\u30c7\u30eb\u306f\u30d4\u30af\u30bb\u30eb \u30ec\u30d9\u30eb\u306e\u8996\u899a\u7279\u5fb4\u3092\u76f4\u63a5\u8a8d\u8b58\u3067\u304d\u307e\u305b\u3093\u3002\u30e1\u30bf\u30c7\u30fc\u30bf\u3060\u3051\u306b\u983c\u3063\u3066\u63a8\u8ad6\u3059\u308b\u3068\u3001\u5e7b\u899a\u304c\u8d77\u3053\u308a\u3084\u3059\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>\u3053\u306e\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u3092\u6253\u958b\u3059\u308b\u305f\u3081\u306b\u3001\u7523\u696d\u754c\u3068\u5b66\u754c\u306f\u3001\u30d3\u30b8\u30e5\u30a2\u30eb\u30b9\u30c8\u30ed\u30f3\u30b0\u30e2\u30c7\u30eb\u84b8\u7559\u3001\u5c02\u9580\u5bb6\u306e\u6df7\u5408\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3001\u304a\u3088\u3073\u9032\u5316\u547d\u4ee4\u751f\u6210\u3068\u3044\u30463\u3064\u306e\u3088\u308a\u4e3b\u6d41\u3067\u52b9\u7387\u7684\u306a\u5408\u6210\u6226\u7565\u3092\u9032\u5316\u3055\u305b\u3066\u304d\u307e\u3057\u305f\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#1_1","title":"1. \u8996\u899a\u7684\u306a\u5f37\u529b\u306a\u30e2\u30c7\u30eb\u306e\u62bd\u51fa","text":"<p>\u3053\u308c\u306f\u73fe\u5728 (2024 \u5e74\u304b\u3089 2025 \u5e74\u306e\u6642\u70b9\u3067) \u9ad8\u6027\u80fd\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30e2\u30c7\u30eb (LLaVA-NeXT\u3001ShareGPT4V \u306a\u3069) \u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u6700\u3082\u4e3b\u6d41\u306e\u65b9\u6cd5\u3067\u3042\u308a\u3001SOTA (\u6700\u5148\u7aef) \u3068\u307f\u306a\u3055\u308c\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002</p> <p>\u6838\u3068\u306a\u308b\u30a2\u30a4\u30c7\u30a2 \u3053\u306e\u65b9\u6cd5\u3067\u306f\u3001\u300c\u30c6\u30ad\u30b9\u30c8 \u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u8996\u899a\u7684\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u63a8\u6e2c\u3059\u308b\u300d\u3053\u3068\u3092\u653e\u68c4\u3057\u3001\u300c\u6559\u5e2b\u3068\u751f\u5f92\u300d\u306e\u84b8\u7559\u30d1\u30e9\u30c0\u30a4\u30e0\u3092\u63a1\u7528\u3057\u307e\u3059\u3002\u30af\u30ed\u30fc\u30ba\u30c9\u30bd\u30fc\u30b9\u306e\u30c8\u30c3\u30d7\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u30e2\u30c7\u30eb (GPT-4o\u3001Gemini 1.5 Pro \u306a\u3069) \u3092\u300c\u6559\u5e2b\u30e2\u30c7\u30eb\u300d\u3068\u3057\u3066\u4f7f\u7528\u3057\u3001\u751f\u306e\u753b\u50cf\u4fe1\u53f7\u3092\u76f4\u63a5\u51e6\u7406\u3057\u3066\u3001\u9ad8\u54c1\u8cea\u3067\u9ad8\u5bc6\u5ea6\u306e\u8a73\u7d30\u306a\u8aac\u660e (Dense Caption) \u3068\u3001\u5b66\u7fd2\u7528\u306e\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9 \u30e2\u30c7\u30eb (\u5b66\u751f\u30e2\u30c7\u30eb) \u306e\u8907\u96d1\u306a\u63a8\u8ad6 Q&amp;A \u30da\u30a2\u3092\u751f\u6210\u3057\u307e\u3059\u3002</p> <p>\u5229\u70b9\u306e\u5206\u6790 * \u30e2\u30c0\u30ea\u30c6\u30a3\u306e\u30ae\u30e3\u30c3\u30d7\u3092\u6392\u9664: \u6559\u5e2b\u30e2\u30c7\u30eb\u306f\u753b\u50cf\u30d4\u30af\u30bb\u30eb\u3092\u76f4\u63a5\u300c\u898b\u3066\u300d\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u30e1\u30bf\u30c7\u30fc\u30bf\u3067\u306f\u4f1d\u3048\u3089\u308c\u306a\u3044\u7167\u660e\u3001\u30c6\u30af\u30b9\u30c1\u30e3\u3001\u5fae\u7d30\u306a\u8868\u73fe\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u307e\u3059\u3002 * \u5e7b\u899a\u306e\u6291\u5236: \u5b9f\u969b\u306e\u8996\u899a\u5165\u529b\u306b\u57fa\u3065\u3044\u305f\u8aac\u660e\u306b\u3088\u308a\u3001\u4e8b\u5b9f\u8aa4\u8a8d\u306e\u53ef\u80fd\u6027\u304c\u5927\u5e45\u306b\u6e1b\u5c11\u3057\u307e\u3059\u3002</p> <p>\u5c0e\u5165\u306e\u6d41\u308c \u4e2d\u5fc3\u3068\u306a\u308b\u306e\u306f\u3001\u6559\u5e2b\u30e2\u30c7\u30eb\u306b\u5fb9\u5e95\u7684\u306a\u60c5\u5831\u3092\u51fa\u529b\u3055\u305b\u308b\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u306b\u3042\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u6a19\u6e96\u7684\u306a\u84b8\u7559\u30d5\u30ed\u30fc\u306e\u64ec\u4f3c\u30b3\u30fc\u30c9\u3067\u3059\u3002</p> <pre><code>def generate_dense_instruction(image_path, api_client):\n    \"\"\"\n    Use SOTA MLLM to generate high-density multimodal instruction data\n    \"\"\"\n\n    # System Prompt key: Require extremely detailed capture and logical association\n    distillation_prompt = \"\"\"\n    You are an expert visual analyst. Analyze the provided image with extreme detail.\n\n    Tasks:\n    1. Dense Captioning: Provide a comprehensive description of every corner of the image, covering colors, textures, lighting, and background details.\n    2. Object Relationships: Analyze the interactions between objects (e.g., causality, spatial relations).\n    3. OCR Extraction: Transcribe any visible text verbatim.\n    4. Q&amp;A Generation: Based on the visual details above, create a logical reasoning question that cannot be answered without looking at the image.\n    \"\"\"\n\n    # Key difference: Input contains real Image Tensor, not merely Bounding Box\n    response = api_client.chat.completions.create(\n        model=\"gpt-4o\",\n        messages=[\n            {\"role\": \"system\", \"content\": distillation_prompt},\n            {\"role\": \"user\", \"content\": [{\"type\": \"image_url\", \"url\": image_path}]}\n        ]\n    )\n\n    return parse_response(response)\n</code></pre>"},{"location":"ja/part4/4_2_synthetic_data/#2_1","title":"2. \u30c9\u30e1\u30a4\u30f3\u306e\u5c02\u9580\u5316: \u5c02\u9580\u5bb6\u306e\u6df7\u5408\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":"<p>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 AI\u3001\u8907\u96d1\u306a\u30c1\u30e3\u30fc\u30c8\u5206\u6790\u3001\u81ea\u52d5\u904b\u8ee2\u30c7\u30fc\u30bf\u306a\u3069\u3001\u4e00\u822c\u7684\u306a\u30e2\u30c7\u30eb\u304c\u56f0\u96e3\u306a\u5782\u76f4\u9818\u57df\u3067\u306f\u3001\u4e00\u822c\u7684\u306a\u8996\u899a\u7684\u62bd\u51fa\u3067\u306f\u7cbe\u5ea6\u304c\u6b20\u3051\u3066\u3044\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002 \u300c\u5c02\u9580\u5bb6\u306e\u6df7\u5408\u300d\u6226\u7565\u3092\u63a1\u7528\u3059\u308b\u3053\u3068\u304c\u30d9\u30b9\u30c8 \u30d7\u30e9\u30af\u30c6\u30a3\u30b9\u3067\u3059\u3002</p> <p>\u30b3\u30a2\u30ed\u30b8\u30c3\u30af \u3053\u306e\u65b9\u6cd5\u306f\u3001\u5358\u4e00\u30e2\u30c7\u30eb\u306e\u30a8\u30f3\u30c9\u30c4\u30fc\u30a8\u30f3\u30c9\u6a5f\u80fd\u306b\u4f9d\u5b58\u305b\u305a\u3001\u8a8d\u8b58\u30d5\u30ed\u30f3\u30c8\u30a8\u30f3\u30c9\u3068\u3057\u3066\u8907\u6570\u306e\u7279\u6b8a\u306a\u5c0f\u578b\u30e2\u30c7\u30eb (\u30a8\u30ad\u30b9\u30d1\u30fc\u30c8) \u3092\u7d44\u307f\u7acb\u3066\u3001\u975e\u69cb\u9020\u5316\u753b\u50cf\u3092 LLM \u7d71\u5408\u7528\u306e\u5fae\u7d30\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u306b\u5909\u63db\u3057\u307e\u3059\u3002</p> <p>\u30ed\u30b8\u30c3\u30af\u30d5\u30ed\u30fc: $\\(\\text{\u753b\u50cf} \\xrightarrow{\\text{\u30a8\u30ad\u30b9\u30d1\u30fc\u30c8}} [\\text{OCR} + \\text{\u30ec\u30a4\u30a2\u30a6\u30c8} + \\text{\u691c\u51fa}] \\xrightarrow{\\text{\u96c6\u7d04}} \\text{\u69cb\u9020\u5316\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8} \\xrightarrow{\\text{LLM}} \\text{\u547d\u4ee4}\\)$</p> <p>\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3 \u30b7\u30ca\u30ea\u30aa \u4e00\u822c\u7684\u306a\u30a2\u30d7\u30ea\u30b1\u30fc\u30b7\u30e7\u30f3\u306b\u306f\u3001\u8ca1\u52d9\u8acb\u6c42\u66f8\u51e6\u7406\u3001\u533b\u7642\u753b\u50cf\u30ec\u30dd\u30fc\u30c8 (DICOM) \u306a\u3069\u304c\u542b\u307e\u308c\u307e\u3059\u3002</p> <ol> <li>OCR \u30a8\u30ad\u30b9\u30d1\u30fc\u30c8 (\u4f8b: PaddleOCR): \u753b\u50cf\u304b\u3089\u3059\u3079\u3066\u306e\u30c6\u30ad\u30b9\u30c8\u3068\u6b63\u78ba\u306a\u5ea7\u6a19 \\((x_1, y_1, x_2, y_2)\\) \u3092\u62bd\u51fa\u3057\u307e\u3059\u3002</li> <li>\u30ec\u30a4\u30a2\u30a6\u30c8 \u30a8\u30ad\u30b9\u30d1\u30fc\u30c8 (\u4f8b: LayoutLM): \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u30c8\u30dd\u30ed\u30b8\u3092\u89e3\u6790\u3057\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u884c/\u5217\u3001\u6bb5\u843d\u968e\u5c64\u3001\u304a\u3088\u3073\u30bf\u30a4\u30c8\u30eb\u306e\u95a2\u4fc2\u3092\u8b58\u5225\u3057\u307e\u3059\u3002</li> <li>\u5408\u6210 (LLM): \u69cb\u9020\u5316\u30c7\u30fc\u30bf\u3092\u30d7\u30ed\u30f3\u30d7\u30c8 \u30c6\u30f3\u30d7\u30ec\u30fc\u30c8\u306b\u5165\u529b\u3057\u307e\u3059\u3002<ul> <li>\u30d7\u30ed\u30f3\u30d7\u30c8\u306e\u4f8b: \u300c\u3053\u308c\u306f\u8acb\u6c42\u66f8\u306e\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u3001\u8acb\u6c42\u66f8\u756a\u53f7 (100, 200)\u3001\u5408\u8a08\u91d1\u984d 500.00 \u3067\u3059\u3002\u3053\u308c\u306b\u57fa\u3065\u3044\u3066\u3001\u300c\u8ca1\u52d9\u76e3\u67fb\u306e\u691c\u8a3c\u300d\u306b\u95a2\u3059\u308b\u8907\u6570\u30bf\u30fc\u30f3\u306e Q&amp;A \u3092\u751f\u6210\u3057\u3066\u304f\u3060\u3055\u3044\u3002\u300d</li> </ul> </li> </ol> <p> \u56f3 10-3: \u5c02\u9580\u5bb6\u306e\u6df7\u5408\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u56f3</p>"},{"location":"ja/part4/4_2_synthetic_data/#3-evolution-visual-evol-instruct","title":"3. Evolution \u547d\u4ee4\u306e\u751f\u6210 (Visual Evol-Instruct)","text":"<p>\u30c6\u30ad\u30b9\u30c8 \u30c9\u30e1\u30a4\u30f3\u306e WizardLM \u304b\u3089\u30a4\u30f3\u30b9\u30d4\u30ec\u30fc\u30b7\u30e7\u30f3\u3092\u5f97\u305f Visual Evol-Instruct \u306f\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u306e\u300c\u5747\u8cea\u5316\u300d\u3068\u300c\u904e\u5ea6\u306e\u5358\u7d14\u5316\u300d\u3092\u89e3\u6c7a\u3059\u308b\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u57fa\u672c\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u5358\u7d14\u306a\u8a8d\u8b58\u30bf\u30b9\u30af (\u4f8b: \u300c\u753b\u50cf\u306e\u4e2d\u306b\u4f55\u304c\u3042\u308b\u304b?\u300d) \u306e\u307f\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306f\u9ad8\u6b21\u306e\u63a8\u8ad6\u3092\u5b66\u7fd2\u3067\u304d\u307e\u305b\u3093\u3002\u3053\u306e\u65b9\u6cd5\u3067\u306f\u3001\u30d7\u30ed\u30f3\u30d7\u30c8 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3092\u901a\u3058\u3066\u65e2\u5b58\u30c7\u30fc\u30bf\u306e\u300c\u6b21\u5143\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u300d\u3092\u5f37\u5236\u3057\u307e\u3059\u3002</p> <p>\u30b3\u30a2\u30ed\u30b8\u30c3\u30af $\\(\\text{\u5358\u7d14\u306a VQA} \\xrightarrow{\\text{\u8907\u96d1\u6027\u306e\u5236\u7d04}} \\text{\u8907\u96d1\u306a\u63a8\u8ad6 VQA}\\)$</p> <p>LLM \u306b\u7279\u5b9a\u306e\u9032\u5316\u547d\u4ee4\u3092\u9069\u7528\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001\u6b21\u306e\u70b9\u3067\u30c7\u30fc\u30bf\u306e\u8907\u96d1\u6027\u304c\u9ad8\u307e\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <ul> <li>\u63a8\u8ad6\u306e\u6df1\u5316:<ul> <li>\u539f\u6587: \u300c\u3053\u306e\u4eba\u306f\u4f55\u3092\u6301\u3063\u3066\u3044\u307e\u3059\u304b?\u300d</li> <li>\u9032\u5316: \u300c\u7269\u306e\u7528\u9014\u3068\u305d\u306e\u4eba\u306e\u670d\u88c5\u306b\u57fa\u3065\u3044\u3066\u3001\u3053\u306e\u4eba\u306e\u8077\u696d\u3068\u6b21\u306b\u3069\u306e\u3088\u3046\u306a\u6d3b\u52d5\u3092\u884c\u3046\u304b\u3092\u63a8\u6e2c\u3057\u307e\u3059\u3002\u300d</li> </ul> </li> <li>\u53cd\u4e8b\u5b9f\u7684\u63a8\u8ad6:<ul> <li>\u539f\u6587: \u300c\u753b\u50cf\u306e\u8eca\u306f\u8d64\u3044\u3067\u3059\u3002\u300d</li> <li>\u9032\u5316: \u300c\u753b\u50cf\u5185\u306e\u8d64\u3044\u30b9\u30dd\u30fc\u30c4\u30ab\u30fc\u304c\u53e4\u3044\u81ea\u8ee2\u8eca\u306b\u7f6e\u304d\u63db\u3048\u3089\u308c\u305f\u3089\u3001\u30b7\u30fc\u30f3\u306e\u96f0\u56f2\u6c17\u306f\u3069\u3046\u5909\u308f\u308a\u307e\u3059\u304b? \u3053\u308c\u306f\u80cc\u666f\u306e\u73fe\u4ee3\u5efa\u7bc9\u30b9\u30bf\u30a4\u30eb\u306b\u9069\u5408\u3057\u307e\u3059\u304b?\u300d</li> </ul> </li> <li>\u6bd4\u8f03\u5206\u6790:<ul> <li>2 \u3064\u306e\u985e\u4f3c\u3057\u305f\u753b\u50cf\u3092\u5165\u529b\u3057\u3001\u5fae\u5999\u306a\u9055\u3044 (\u7167\u660e\u306e\u5909\u5316\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306e\u5909\u4f4d) \u3092\u5206\u6790\u3059\u308b\u30e2\u30c7\u30eb\u3092\u5fc5\u8981\u3068\u3057\u3001\u30e2\u30c7\u30eb\u306e\u8a73\u7d30\u306a\u89b3\u5bdf\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u307e\u3059\u3002</li> </ul> </li> </ul> <p>\u3053\u308c\u3089 3 \u3064\u306e\u6226\u7565\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u4f7f\u7528\u200b\u200b\u3059\u308b\u3053\u3068\u3067\u3001\u8996\u899a\u7684\u306a\u8a73\u7d30\u3068\u6df1\u3044\u8ad6\u7406\u7684\u63a8\u8ad6\u306b\u5bcc\u3093\u3060\u9ad8\u54c1\u8cea\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u547d\u4ee4\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3057\u3001LLaVA\u3001MiniGPT-4\u3001\u304a\u3088\u3073\u540c\u69d8\u306e\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u305f\u3081\u306e\u5f37\u56fa\u306a\u57fa\u76e4\u3092\u7bc9\u304f\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#103","title":"10.3\u3002\u5b9f\u7e3e\u3068\u8a55\u4fa1 (\u5b9f\u7e3e\u3068\u8a55\u4fa1)","text":"<p>\u5408\u6210\u30c7\u30fc\u30bf\u3067\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u5f8c\u306e\u8a55\u4fa1\u306f\u7279\u306b\u91cd\u8981\u3067\u3059\u3002\u30e2\u30c7\u30eb\u304c\u5408\u6210\u30c7\u30fc\u30bf\u306e\u30d1\u30bf\u30fc\u30f3\u3092\u672c\u5f53\u306b\u300c\u5b66\u7fd2\u3057\u305f\u300d\u306e\u304b\u3001\u305d\u308c\u3068\u3082\u5358\u306b\u300c\u8a18\u61b6\u3057\u305f\u300d\u3060\u3051\u306a\u306e\u304b\u3092\u78ba\u8a8d\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#_4","title":"\u8a55\u4fa1\u6307\u6a19","text":"<ul> <li>Pass@1 (\u30b3\u30fc\u30c9): PoT \u5408\u6210\u30c7\u30fc\u30bf\u306e\u5834\u5408\u3001HumanEval \u3067 Pass@1 \u3092\u30c6\u30b9\u30c8\u3057\u307e\u3059\u3002 Phi-1 \u306f\u3001\u308f\u305a\u304b 6B \u30c7\u30fc\u30bf\u3067 50%+ Pass@1 \u3092\u9054\u6210\u3057\u3001100 \u500d\u4ee5\u4e0a\u306e\u30c7\u30fc\u30bf\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u591a\u304f\u306e\u30e2\u30c7\u30eb\u3092\u4e0a\u56de\u308a\u307e\u3057\u305f\u3002\u3053\u308c\u306f\u30c7\u30fc\u30bf\u54c1\u8cea\u306e\u5727\u5012\u7684\u306a\u512a\u4f4d\u6027\u3092\u8a3c\u660e\u3057\u3066\u3044\u307e\u3059\u3002</li> <li>\u5e7b\u899a\u7387: \u5408\u6210\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u5fdc\u7b54\u3068\u5143\u306e\u753b\u50cf\u306e CLIP \u985e\u4f3c\u6027\u3092\u6bd4\u8f03\u3057\u3066\u3001\u5b58\u5728\u3057\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u751f\u6210\u3055\u308c\u305f\u304b\u3069\u3046\u304b\u3092\u691c\u51fa\u3057\u307e\u3059\u3002\u7279\u306b\u30e2\u30c7\u30eb\u304c\u5b58\u5728\u3057\u306a\u3044\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u306b\u5fdc\u7b54\u3059\u308b\u3088\u3046\u306b\u8a98\u5c0e\u3057\u3001\u30e2\u30c7\u30eb\u304c\u62d2\u5426\u3057\u305f\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3059\u308b\u8ca0\u306e\u30b5\u30f3\u30d7\u30eb \u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3067\u304d\u307e\u3059\u3002</li> <li>\u9664\u67d3: \u6c5a\u3044\u3067\u3059\u304c\u5fc5\u8981\u306a\u30b9\u30c6\u30c3\u30d7\u3067\u3059\u3002\u5408\u6210\u30c7\u30fc\u30bf\u306b\u30c6\u30b9\u30c8 \u30bb\u30c3\u30c8 (HumanEval \u306a\u3069) \u306e\u8cea\u554f\u304c\u8aa4\u3063\u3066\u542b\u307e\u308c\u3066\u3044\u306a\u3044\u304b\u3069\u3046\u304b\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002 N \u30b0\u30e9\u30e0\u306e\u30aa\u30fc\u30d0\u30fc\u30e9\u30c3\u30d7\u691c\u51fa\u3092\u901a\u3058\u3066\u3001\u30e2\u30c7\u30eb\u304c\u30c1\u30fc\u30c8\u3067\u306f\u306a\u304f\u4e00\u822c\u5316\u3055\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u78ba\u8a8d\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part4/4_2_synthetic_data/#_5","title":"\u30d9\u30f3\u30c1\u30de\u30fc\u30af","text":"<ul> <li>PoT \u3068 CoT: \u6570\u5b66 (GSM8K \u306a\u3069) \u3067\u306f\u3001\u901a\u5e38\u3001PoT \u306f\u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8 CoT \u3088\u308a\u3082 5 \uff5e 10% \u512a\u308c\u3066\u3044\u307e\u3059\u3002\u7406\u7531: PoT \u306f\u8a08\u7b97\u3092 CPU (\u8a08\u7b97\u80fd\u529b\u306b\u512a\u308c\u305f\u3082\u306e) \u306b\u30a2\u30a6\u30c8\u30bd\u30fc\u30b7\u30f3\u30b0\u3057\u3001GPU \u306f\u30ed\u30b8\u30c3\u30af\u5909\u63db\u3001\u3064\u307e\u308a\u6700\u9069\u306a\u8a08\u7b97\u5272\u308a\u5f53\u3066\u306b\u91cd\u70b9\u3092\u7f6e\u304d\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part4/4_2_synthetic_data/#104","title":"10.4\u3002\u843d\u3068\u3057\u7a74\u3068\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":"<p>\u5408\u6210\u30c7\u30fc\u30bf\u306f\u7f8e\u3057\u3044\u3067\u3059\u304c\u3001\u7f60\u3082\u305f\u304f\u3055\u3093\u3042\u308a\u307e\u3059\u3002\u307b\u3093\u306e\u5c11\u3057\u6ed1\u308b\u3068\u3001\u30e2\u30c7\u30eb\u306f\u300c\u81ea\u5df1\u6e80\u8db3\u300d\u306e\u30eb\u30fc\u30d7\u306b\u9665\u308a\u307e\u3059\u3002</p> <ul> <li> <p>\u843d\u3068\u3057\u7a74 1: \u81ea\u5df1\u78ba\u8a8d\u30d0\u30a4\u30a2\u30b9</p> <ul> <li>\u75c7\u72b6: \u30e2\u30c7\u30eb\u3067\u751f\u6210\u3055\u308c\u305f\u30b3\u30fc\u30c9\u306f\u5b9f\u884c\u3055\u308c\u307e\u3059\u304c\u3001\u30ed\u30b8\u30c3\u30af\u304c\u9593\u9055\u3063\u3066\u3044\u307e\u3059 (\u4f8b: 2+2=5\u3001\u30e2\u30c7\u30eb\u3067\u751f\u6210\u3055\u308c\u305f\u30c6\u30b9\u30c8 \u30b1\u30fc\u30b9\u3082\u9593\u9055\u3063\u3066\u304a\u308a\u3001\u5076\u7136\u9593\u9055\u3063\u305f\u95a2\u6570\u3092\u6e21\u3057\u3066\u3044\u307e\u3059)\u3002</li> <li>\u4fee\u6b63: \u5916\u90e8\u306e\u6c7a\u5b9a\u8ad6\u7684\u30bd\u30eb\u30d0\u30fc\u307e\u305f\u306f\u4eba\u9593\u304c\u30ec\u30d3\u30e5\u30fc\u3057\u305f\u5358\u4f53\u30c6\u30b9\u30c8 \u30e9\u30a4\u30d6\u30e9\u30ea\u3092\u5c0e\u5165\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30e2\u30c7\u30eb\u751f\u6210\u3055\u308c\u305f\u30b3\u30fc\u30c9\u3092\u691c\u8a3c\u3059\u308b\u305f\u3081\u306b\u3001\u30e2\u30c7\u30eb\u751f\u6210\u3055\u308c\u305f\u30c6\u30b9\u30c8 \u30b1\u30fc\u30b9\u306b\u5b8c\u5168\u306b\u4f9d\u5b58\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f\u3001\u72af\u7f6a\u8005\u81ea\u8eab\u306b\u5224\u65ad\u3092\u59d4\u306d\u308b\u3088\u3046\u306a\u3082\u306e\u3067\u3059\u3002</li> </ul> </li> <li> <p>\u843d\u3068\u3057\u7a74 2: \u8996\u899a\u7684\u306a\u6839\u62e0\u306e\u6b20\u5982</p> <ul> <li>\u75c7\u72b6: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u5408\u6210\u30c7\u30fc\u30bf\u3067\u306f\u3001\u30e2\u30c7\u30eb\u304c\u30e1\u30bf\u30c7\u30fc\u30bf\u306b\u306a\u3044\u8a73\u7d30\u306b\u3064\u3044\u3066\u8b70\u8ad6\u3057\u307e\u3059 (\u634f\u9020)\u3002\u305f\u3068\u3048\u3070\u3001\u30e1\u30bf\u30c7\u30fc\u30bf\u306b\u306f\u300c\u72ac\u300d\u3057\u304b\u3042\u308a\u307e\u305b\u3093\u304c\u3001\u753b\u50cf\u5185\u306e\u72ac\u306b\u9996\u8f2a\u304c\u306a\u3044\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306b\u306f\u300c\u72ac\u306e\u9996\u8f2a\u306e\u8272\u300d\u304c\u8a18\u8ff0\u3055\u308c\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u53b3\u5bc6\u306a\u6307\u793a\u3092\u8ffd\u52a0:\u300c\u63d0\u4f9b\u3055\u308c\u305f\u30e1\u30bf\u30c7\u30fc\u30bf\u306e\u307f\u306b\u53b3\u5bc6\u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002\u8a73\u7d30\u3092\u767a\u660e\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\u300d\u307e\u305f\u3001CLIP \u30b9\u30b3\u30a2\u3092\u4f7f\u7528\u3057\u3066\u3001\u5143\u306e\u753b\u50cf\u3068\u306e\u985e\u4f3c\u6027\u304c\u4f4e\u3059\u304e\u308b\u751f\u6210\u3055\u308c\u305f\u30c6\u30ad\u30b9\u30c8\u3092\u9664\u5916\u3057\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u843d\u3068\u3057\u7a74 3: \u5747\u8cea\u5316\u306e\u7f60</p> <ul> <li>\u75c7\u72b6: \u3059\u3079\u3066\u306e\u30c7\u30fc\u30bf\u304c GPT-4 \u3067\u751f\u6210\u3055\u308c\u308b\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306f\u300c\u30ed\u30fc\u30a8\u30f3\u30c9 GPT-4\u300d\u306b\u306a\u308a\u3001\u591a\u69d8\u6027\u304c\u5931\u308f\u308c\u307e\u3059\u3002\u3059\u3079\u3066\u306e\u7b54\u3048\u306e\u53e3\u8abf\u3068\u6587\u7ae0\u306e\u69cb\u9020\u306f\u9a5a\u304f\u307b\u3069\u4e00\u8cab\u3057\u3066\u3044\u307e\u3059\u3002</li> <li>\u4fee\u6b63: \u30a8\u30f3\u30c8\u30ed\u30d4\u30fc\u6ce8\u5165\u3002\u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u7570\u306a\u308b\u30da\u30eb\u30bd\u30ca (\u4f8b: \u300c\u6c17\u96e3\u3057\u3044\u30d7\u30ed\u30b0\u30e9\u30de\u30fc\u300d\u3001\u300c\u5fcd\u8010\u5f37\u3044\u5e7c\u7a1a\u5712\u306e\u5148\u751f\u300d) \u3092\u30e9\u30f3\u30c0\u30e0\u306b\u633f\u5165\u3059\u308b\u304b\u3001\u7570\u306a\u308b\u30d7\u30ed\u30b0\u30e9\u30df\u30f3\u30b0 \u30b9\u30bf\u30a4\u30eb (\u518d\u5e30\u7684\u5bfe\u53cd\u5fa9\u7684) \u3092\u8981\u6c42\u3057\u3066\u3001\u30c7\u30fc\u30bf\u5206\u5e03\u306e\u62e1\u5f35\u3092\u5f37\u5236\u3057\u307e\u3059\u3002</li> </ul> </li> </ul>"},{"location":"ja/part4/4_2_synthetic_data/#105","title":"10.5\u3002\u5404\u7ae0\u306e\u6982\u8981\u3068\u8a73\u7d30\u60c5\u5831","text":"<p>\u300c\u5fc5\u8981\u306a\u306e\u306f\u6559\u79d1\u66f8\u3060\u3051\u300d\u3068\u3044\u3046\u30d1\u30e9\u30c0\u30a4\u30e0\u306f\u3001\u30c7\u30fc\u30bf\u306e\u8cea (\u6559\u80b2\u7684\u4fa1\u5024) \u304c\u91cf\u3088\u308a\u3082\u512a\u5148\u3055\u308c\u308b\u3068\u3044\u3046\u4e2d\u5fc3\u539f\u5247\u3092\u78ba\u7acb\u3057\u307e\u3057\u305f\u3002\u5408\u6210\u30c7\u30fc\u30bf\u6280\u8853\u306b\u3088\u308a\u3001\u30c7\u30fc\u30bf\u306e\u4fe1\u53f7\u5bfe\u96d1\u97f3\u6bd4\u3092\u6b63\u78ba\u306b\u5236\u5fa1\u3067\u304d\u308b\u3088\u3046\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u4e0b\u3067\u3001Program of Thought (PoT) \u306f\u3001\u63a8\u8ad6\u3092\u5b9f\u884c\u53ef\u80fd\u30b3\u30fc\u30c9\u306b\u5909\u63db\u3057\u3001\u691c\u8a3c\u306b\u30b3\u30f3\u30d1\u30a4\u30e9\u306e\u6c7a\u5b9a\u8ad6\u3092\u4f7f\u7528\u3059\u308b\u3053\u3068\u306b\u3088\u308a\u3001\u30c7\u30fc\u30bf\u306e\u53b3\u5bc6\u6027\u3092\u4fdd\u8a3c\u3057\u307e\u3059\u3002\u4e00\u65b9\u3001\u30b7\u30f3\u30dc\u30ea\u30c3\u30af\u304b\u3089\u5408\u6210\u3078\u306e\u65b9\u6cd5\u3067\u306f\u3001\u30e1\u30bf\u30c7\u30fc\u30bf (\u30d0\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0 \u30dc\u30c3\u30af\u30b9\u306a\u3069) \u3092\u4f7f\u7528\u3057\u3066\u30c6\u30ad\u30b9\u30c8 \u30e2\u30c7\u30eb\u304c\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u751f\u6210\u3059\u308b\u3088\u3046\u306b\u30ac\u30a4\u30c9\u3057\u3001\u30e6\u30cb\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u304b\u3089\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c7\u30fc\u30bf\u3078\u306e\u52b9\u679c\u7684\u306a\u5909\u63db\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002\u3053\u306e\u9032\u5316\u306f\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u53d7\u52d5\u7684\u306a\u300c\u30de\u30a4\u30cb\u30f3\u30b0\u300d\u304b\u3089\u80fd\u52d5\u7684\u306a\u300c\u751f\u7523\u300d\u3078\u306e\u79fb\u884c\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u30b7\u30fc\u30c9 \u30d7\u30ed\u30f3\u30d7\u30c8\u69cb\u7bc9\u3001\u547d\u4ee4\u306e\u8907\u96d1\u3055 (\u9032\u5316)\u3001\u9ad8\u54c1\u8cea\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3001\u6700\u7d42\u5408\u6210\u3092\u901a\u3058\u3066\u3001\u6a19\u6e96\u7684\u306a\u5de5\u696d\u30d7\u30ed\u30bb\u30b9\u3092\u901a\u3058\u3066\u9ad8\u54c1\u8cea\u306e\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u4f53\u7cfb\u7684\u306b\u69cb\u7bc9\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_2_synthetic_data/#_6","title":"\u53c2\u8003\u6587\u732e","text":"<ul> <li>Gunasekar\u3001S.\u3001\u4ed6\u3002 \uff082023\u5e74\uff09\u3002\u5fc5\u8981\u306a\u306e\u306f\u6559\u79d1\u66f8\u3060\u3051\u3067\u3059 (Phi-1)\u3002</li> <li>Chen\u3001W.\u3001\u4ed6\u3002 \uff082022\u5e74\uff09\u3002\u601d\u8003\u30d7\u30ed\u30b0\u30e9\u30e0\u306e\u30d7\u30ed\u30f3\u30d7\u30c8: \u6570\u5024\u63a8\u8ad6\u30bf\u30b9\u30af\u306e\u63a8\u8ad6\u304b\u3089\u8a08\u7b97\u3092\u89e3\u304d\u307b\u3050\u3057\u307e\u3059\u3002</li> <li>Liu\u3001H.\u3001\u4ed6\u3002 \uff082023\u5e74\uff09\u3002\u30d3\u30b8\u30e5\u30a2\u30eb\u30a4\u30f3\u30b9\u30c8\u30e9\u30af\u30b7\u30e7\u30f3\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0 (LLaVA)</li> <li>Shumailov\u3001I.\u3001\u4ed6\u3002 \uff082023\u5e74\uff09\u3002 The Curse of Recursion: Training on Generated Data Makes Models Forget. (\u30e2\u30c7\u30eb\u306e\u5d29\u58ca\u306b\u95a2\u3059\u308b\u91cd\u8981\u306a\u7814\u7a76)</li> </ul>"},{"location":"ja/part4/4_3_preference_data/","title":"\u7b2c11\u7ae0: \u4eba\u9593\u55dc\u597d\u30c7\u30fc\u30bf","text":""},{"location":"ja/part4/4_3_preference_data/#11-rlhfdpo","title":"\u7b2c 11 \u7ae0: \u4eba\u9593\u306e\u55dc\u597d\u30c7\u30fc\u30bf (RLHF/DPO)","text":""},{"location":"ja/part4/4_3_preference_data/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>SFT (\u547d\u4ee4\u306e\u5fae\u8abf\u6574) \u304c\u30e2\u30c7\u30eb\u306b\u300c\u8a71\u3059\u300d\u3088\u3046\u306b\u6559\u3048\u3001\u57fa\u672c\u7684\u306a\u8a00\u8a9e\u3068\u30bf\u30b9\u30af\u51e6\u7406\u80fd\u529b\u3092\u4e0e\u3048\u308b\u5834\u5408\u3001\u597d\u307f\u306e\u8abf\u6574 (RLHF/DPO) \u306f\u30e2\u30c7\u30eb\u306b\u300c\u6b63\u3057\u304f\u8a71\u3059\u300d\u3088\u3046\u306b\u6559\u3048\u3001\u305d\u306e\u51fa\u529b\u3092\u4eba\u9593\u306e\u4fa1\u5024\u89b3\u3001\u502b\u7406\u57fa\u6e96\u3001\u304a\u3088\u3073\u7279\u5b9a\u306e\u30d3\u30b8\u30cd\u30b9\u306e\u597d\u307f\u3068\u4e00\u81f4\u3055\u305b\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001DPO (Direct Preference Optimization) \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u4e2d\u6838\u3001\u3064\u307e\u308a\u9078\u629e\u3055\u308c\u305f\u30da\u30a2\u3068\u62d2\u5426\u3055\u308c\u305f\u30da\u30a2\u3067\u69cb\u6210\u3055\u308c\u308b\u30b5\u30f3\u30d7\u30eb\u3092\u8a73\u3057\u304f\u5206\u6790\u3057\u307e\u3059\u3002\u79c1\u305f\u3061\u306f\u3001\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u4e00\u8cab\u6027\u7ba1\u7406 (IAA) \u3068\u4eba\u9593\u306e\u8a8d\u77e5\u30d0\u30a4\u30a2\u30b9\u306e\u6df1\u3044\u7406\u89e3\u3092\u4f34\u3044\u3001\u6df7\u6c8c\u3068\u3057\u305f\u4eba\u9593\u306e\u4e3b\u89b3\u7684\u306a\u5224\u65ad\u304b\u3089\u9ad8\u54c1\u8cea\u306e\u4fe1\u53f7\u3092\u62bd\u51fa\u3059\u308b\u65b9\u6cd5\u3092\u63a2\u308a\u307e\u3059\u3002\u3055\u3089\u306b\u3001\u79c1\u305f\u3061\u306f\u6700\u5148\u7aef\u306e RLAIF (Constitutional AI) \u6280\u8853\u306b\u7126\u70b9\u3092\u5f53\u3066\u3066\u3044\u307e\u3059\u3002AI \u3092\u4f7f\u7528\u3057\u3066\u4eba\u9593\u306e\u4ee3\u308f\u308a\u306b\u3001\u4e8b\u524d\u306b\u8a2d\u5b9a\u3055\u308c\u305f\u300c\u61b2\u6cd5\u300d\u539f\u5247\u306b\u57fa\u3065\u3044\u305f\u9078\u597d\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u3092\u884c\u3046\u3053\u3068\u3067\u3001\u5927\u898f\u6a21\u8abf\u6574\u306e\u30b3\u30b9\u30c8\u69cb\u9020\u3068\u52b9\u7387\u3092\u6839\u672c\u7684\u306b\u5909\u3048\u307e\u3059\u3002</p> <p>\u5b66\u7fd2\u76ee\u6a19: * \u5fb9\u5e95\u7684\u306b\u30de\u30b9\u30bf\u30fc DPO \u30c8\u30ea\u30d7\u30ec\u30c3\u30c8 (\u30d7\u30ed\u30f3\u30d7\u30c8\u3001\u9078\u629e\u3001\u62d2\u5426) \u6a19\u6e96\u30c7\u30fc\u30bf\u5f62\u5f0f\u3092\u69cb\u7bc9\u3057\u3001\u5bfe\u7167\u7684\u306a\u5b66\u7fd2\u539f\u7406\u3068\u305d\u306e\u80cc\u5f8c\u306b\u3042\u308b\u6570\u5b66\u7684\u91cd\u8981\u6027\u3092\u7406\u89e3\u3057\u307e\u3059\u3002 * \u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 \u30ce\u30a4\u30ba\u306e\u5fc3\u7406\u7684\u304a\u3088\u3073\u7d71\u8a08\u7684\u30bd\u30fc\u30b9\u3092\u5fb9\u5e95\u7684\u306b\u7406\u89e3\u3057\u3001IAA (\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u9593\u5408\u610f) \u3092\u8a08\u7b97\u3057\u3001\u30b3\u30fc\u30a8\u30f3\u306e\u30ab\u30c3\u30d1\u4fc2\u6570\u3092\u4f7f\u7528\u3057\u3066\u4f4e\u54c1\u8cea\u30c7\u30fc\u30bf\u3092\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3067\u304d\u307e\u3059\u3002 * Constitutional AI \u306e Critique-Revision \u30eb\u30fc\u30d7\u306e\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5\u3002\u300cdiscriminator\u300d\u304c\u300cgenerator\u300d\u3088\u308a\u3082\u5f37\u529b\u3067\u3042\u308b\u3068\u3044\u3046\u7279\u6027\u3092\u5229\u7528\u3057\u3066\u3001\u5927\u898f\u6a21\u3067\u7121\u5bb3\u306a\u55dc\u597d\u30c7\u30fc\u30bf\u3092\u81ea\u52d5\u7684\u306b\u751f\u6210\u3057\u307e\u3059\u3002</p> <p>\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb: \u300c\u3042\u306a\u305f\u306e SFT \u30e2\u30c7\u30eb\u306f\u975e\u5e38\u306b\u5f93\u9806\u3067\u3059\u3002\u3068\u3066\u3082\u5f93\u9806\u306a\u306e\u3067\u3001\u8ab0\u304b\u304c\u300e\u6bd2\u306e\u4f5c\u308a\u65b9\u300f\u3068\u5c0b\u306d\u308b\u3068\u3001\u5316\u5b66\u5f0f\u3092\u89aa\u5207\u306b\u30ea\u30b9\u30c8\u30a2\u30c3\u30d7\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u696d\u754c\u3067\u306f\u300e\u8131\u7344\u300f\u3068\u547c\u3070\u308c\u308b\u7d76\u5bfe\u7684\u306a\u5b89\u5168\u4e0a\u306e\u30ec\u30c3\u30c9\u30e9\u30a4\u30f3\u3067\u3059\u3002\u901a\u5e38\u306e\u6307\u793a\u306b\u306f\u300e\u5f79\u7acb\u3064\u300f\u307e\u307e\u3067\u3001\u60aa\u610f\u306e\u3042\u308b\u6307\u793a\u3092\u300e\u62d2\u5426\u300f\u3059\u308b\u65b9\u6cd5\u3092\u30e2\u30c7\u30eb\u304c\u5b66\u7fd2\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3057\u304b\u3057\u3001\u4f55\u5343\u3082\u306e\u6709\u5bb3\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u8aad\u3080\u305f\u3081\u306b\u4eba\u9593\u306e\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u3092\u96c7\u3046\u3053\u3068\u306f\u30b3\u30b9\u30c8\u304c\u304b\u304b\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u306b\u502b\u7406\u7684\u306b\u300e\u7cbe\u795e\u7684\u82e6\u75db\u300f\u3092\u3082\u305f\u3089\u3057\u307e\u3059\u300d AI \u304c\u3053\u308c\u3089\u306e\u6709\u5bb3\u306a\u30e1\u30c3\u30bb\u30fc\u30b8\u3092\u81ea\u3089\u8aad\u307f\u53d6\u308a\u3001\u300e\u3053\u306e\u7a2e\u306e\u7b54\u3048\u306f\u9593\u9055\u3063\u3066\u3044\u308b\u300f\u3068\u4f1d\u3048\u308b\u65b9\u6cd5\u306f\u3042\u308b\u306e\u3067\u3057\u3087\u3046\u304b? \u3053\u308c\u306f\u4eba\u9593\u306e\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u304b\u3089 AI \u306e\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u3078\u306e\u907f\u3051\u3089\u308c\u306a\u3044\u9053\u3067\u3059\u3002\u300d</p> <p> \u56f3 11-1: \u4eba\u9593\u306e\u597d\u307f\u306e\u56f3</p>"},{"location":"ja/part4/4_3_preference_data/#2","title":"2. \u4e2d\u5fc3\u3068\u306a\u308b\u6982\u5ff5\u3068\u539f\u5247 (\u6982\u5ff5\u3068\u539f\u5247)","text":""},{"location":"ja/part4/4_3_preference_data/#111","title":"11.1 \u597d\u307f\u306e\u30c7\u30fc\u30bf\u5f62\u5f0f: \u9078\u3070\u308c\u305f\u3082\u306e\u3068\u62d2\u5426\u3055\u308c\u305f\u3082\u306e\u306e\u5bfe\u6bd4\u306e\u54f2\u5b66","text":"<p>\u5f93\u6765\u306e\u5831\u916c\u30e2\u30c7\u30eb \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 (PPO \u30eb\u30fc\u30c8) \u3067\u3042\u3063\u3066\u3082\u3001\u4e00\u822c\u7684\u306a\u76f4\u63a5\u30dd\u30ea\u30b7\u30fc\u6700\u9069\u5316 (DPO \u30eb\u30fc\u30c8) \u3067\u3042\u3063\u3066\u3082\u3001\u30b3\u30a2 \u30c7\u30fc\u30bf \u30e6\u30cb\u30c3\u30c8\u306f\u3001\u30c8\u30ea\u30d7\u30ec\u30c3\u30c8 \\((x, y_w, y_l)\\) \u3068\u3057\u3066\u306e\u6a19\u6e96\u69cb\u9020\u3092\u6301\u3064\u300c\u512a\u5148\u30da\u30a2\u300d\u3067\u3059\u3002\u3053\u3053\u3067\u3001\\(x\\) \u306f\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u8868\u3057\u3001\\(y_w\\) \u306f\u9078\u629e\u6e08\u307f (\u52dd\u8005/\u512a\u5148\u5fdc\u7b54) \u3067\u3042\u308a\u3001\u901a\u5e38\u306f\u5b89\u5168\u3067\u6709\u7528\u304b\u3064\u6b63\u76f4\u306a\u51fa\u529b\u3092\u8868\u3057\u307e\u3059\u3002\u4e00\u65b9\u3001\\(y_l\\) \u306f\u62d2\u5426 (\u6557\u8005/\u62d2\u5426\u3055\u308c\u305f\u5fdc\u7b54) \u3067\u3042\u308a\u3001\u5e7b\u899a\u3001\u504f\u898b\u3001\u6709\u5bb3\u306a\u60c5\u5831\u3001\u307e\u305f\u306f\u5358\u306b\u4f4e\u54c1\u8cea\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u591a\u304f\u306e\u958b\u767a\u8005\u306f\u3001\u30e2\u30c7\u30eb\u306b\u9069\u5207\u306a\u30c7\u30fc\u30bf (\u9078\u629e\u3055\u308c\u305f\u30c7\u30fc\u30bf) \u3060\u3051\u3092\u8868\u793a\u3059\u308c\u3070\u5341\u5206\u3060\u3068\u8aa4\u89e3\u3057\u3066\u3044\u307e\u3059\u3002\u3053\u308c\u306f SFT \u306e\u4e00\u65b9\u5411\u306e\u8003\u3048\u65b9\u3067\u3059\u3002\u8abf\u6574\u30d5\u30a7\u30fc\u30ba\u3067\u306f\u3001\u300c\u4f55\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u304b\u3092\u77e5\u308b\u3053\u3068\u300d\u3068\u300c\u4f55\u304c\u6b63\u3057\u3044\u304b\u3092\u77e5\u308b\u3053\u3068\u300d\u306f\u6570\u5b66\u7684\u306b\u540c\u69d8\u306b\u91cd\u8981\u3067\u3059\u3002\u539f\u5247\u3068\u3057\u3066\u3001DPO \u306e\u640d\u5931\u95a2\u6570\u306f\u3001\u9078\u629e\u3055\u308c\u305f\u3082\u306e\u3068\u62d2\u5426\u3055\u308c\u305f\u3082\u306e\u306e\u5bfe\u6570\u5c24\u5ea6\u306e\u5dee\u3092\u6700\u5927\u5316\u3057\u307e\u3059\u3002\u5426\u5b9a\u7684\u306a\u53c2\u7167\u3068\u3057\u3066\u62d2\u5426\u3055\u308c\u305f\u30b5\u30f3\u30d7\u30eb\u304c\u306a\u3051\u308c\u3070\u3001\u30e2\u30c7\u30eb\u306f\u300c\u5b89\u5168\u6027\u300d\u3092\u5b66\u7fd2\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u300c\u77ed\u3044\u56de\u7b54\u306e\u9577\u3055\u300d\u307e\u305f\u306f\u300c\u53b3\u3057\u3044\u53e3\u8abf\u300d\u3092\u9ad8\u3044\u5831\u916c\u3068\u8aa4\u3063\u3066\u95a2\u9023\u4ed8\u3051\u3066\u300c\u8fd1\u9053\u3092\u3059\u308b\u300d\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u62d2\u5426\u3055\u308c\u305f\u30b5\u30f3\u30d7\u30eb (\u4f8b: \u8a73\u7d30\u3060\u304c\u6709\u5bb3\u306a\u56de\u7b54) \u3092\u5c0e\u5165\u3059\u308b\u3053\u3068\u3067\u3001\u5bfe\u7167\u5b66\u7fd2 \u3092\u5b9f\u884c\u3057\u3001\u30e2\u30c7\u30eb\u304b\u3089\u9577\u3055\u3001\u30b9\u30bf\u30a4\u30eb\u3001\u305d\u306e\u4ed6\u306e\u5e72\u6e09\u8981\u56e0\u3092\u5f37\u5236\u7684\u306b\u5265\u304c\u3057\u3001\u300c\u5b89\u5168\u6027\u300d\u307e\u305f\u306f\u300c\u6709\u7528\u6027\u300d\u306e\u4e2d\u6838\u3068\u306a\u308b\u5dee\u5225\u5316\u6a5f\u80fd\u306e\u5b66\u7fd2\u306b\u7126\u70b9\u3092\u5f53\u3066\u307e\u3059\u3002</p> <p>\u8868 11-1: \u4e3b\u6d41\u306e\u4f4d\u7f6e\u5408\u308f\u305b\u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u30c7\u30fc\u30bf\u8981\u4ef6\u306e\u6bd4\u8f03</p> \u7279\u96c6 RLHF (PPO) DPO (\u76f4\u63a5\u512a\u5148\u6700\u9069\u5316) RLAIF (\u61b2\u6cd5 AI) \u30b3\u30a2\u30e1\u30ab\u30cb\u30ba\u30e0 \u72ec\u7acb\u3057\u305f\u5831\u916c\u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 -&gt; PPO \u5f37\u5316\u5b66\u7fd2 (2 \u6bb5\u968e) \u30d7\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9 \u30c7\u30fc\u30bf\u306e\u30dd\u30ea\u30b7\u30fc\u640d\u5931\u3092\u76f4\u63a5\u6700\u9069\u5316 (\u30b7\u30f3\u30b0\u30eb\u30b9\u30c6\u30fc\u30b8) AI \u3092\u4f7f\u7528\u3057\u3066\u55dc\u597d\u30e9\u30d9\u30eb\u3092\u4eba\u9593\u306b\u7f6e\u304d\u63db\u3048\u3001\u4eba\u9593\u306e\u5224\u65ad\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\u3059\u308b \u30c7\u30fc\u30bf\u8981\u4ef6 \u72ec\u7acb\u3057\u305f RM \u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b\u3002\u30c7\u30fc\u30bf\u306b\u306f\u30e9\u30f3\u30ad\u30f3\u30b0\u6a5f\u80fd\u304c\u5fc5\u8981 \u660e\u793a\u7684\u306a RM \u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002\u30c7\u30fc\u30bf\u306f\u5831\u916c\u3067\u3059\u3002\u967d\u6027/\u9670\u6027\u30b5\u30f3\u30d7\u30eb\u306e\u8b58\u5225\u6027\u3092\u91cd\u8996 \u5c11\u6570\u306e\u300c\u61b2\u6cd5\u300d\u539f\u5247\u3092\u30b7\u30fc\u30c9\u3068\u3057\u3066\u5fc5\u8981\u3068\u3059\u308b\u3060\u3051\u3067\u3059 \u30c7\u30fc\u30bf\u30b9\u30b1\u30fc\u30eb \u975e\u5e38\u306b\u5927\u304d\u3044 (RM \u306f\u7279\u6b8a\u306a\u30b1\u30fc\u30b9\u306b\u5408\u308f\u305b\u3066\u4e00\u822c\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308b) \u4e2d (\u975e\u5e38\u306b\u9ad8\u3044\u54c1\u8cea\u304c\u5fc5\u8981\u3002\u30ce\u30a4\u30ba\u306e\u591a\u3044\u30c7\u30fc\u30bf\u306f\u52fe\u914d\u3092\u8457\u3057\u304f\u640d\u306a\u3046) \u7121\u9650\u306b\u5408\u6210\u53ef\u80fd\u3002\u30de\u30f3\u30d1\u30ef\u30fc\u3067\u306f\u306a\u304f\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u3088\u3063\u3066\u5236\u9650\u3055\u308c\u308b \u5b89\u5b9a\u6027 \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306f\u975e\u5e38\u306b\u4e0d\u5b89\u5b9a\u3067\u3059\u3002\u30cf\u30a4\u30d1\u30fc\u30d1\u30e9\u30e1\u30fc\u30bf\u306b\u654f\u611f (KL \u767a\u6563\u304c\u7206\u767a\u3057\u3084\u3059\u3044) \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306f\u5b89\u5b9a\u3057\u3066\u3044\u307e\u3059\u3002 SFT \u306b\u4f3c\u3066\u3044\u307e\u3059\u3002\u30e1\u30e2\u30ea\u4f7f\u7528\u91cf\u306e\u524a\u6e1b Critique \u30e2\u30c7\u30eb\u306e\u80fd\u529b\u306b\u4f9d\u5b58 (\u6559\u5e2b\u30e2\u30c7\u30eb) OOD (\u914d\u5e03\u5916) \u306e\u554f\u984c \u5831\u916c\u30e2\u30c7\u30eb\u306f\u7c21\u5358\u306b\u30cf\u30c3\u30ad\u30f3\u30b0\u53ef\u80fd (\u30e2\u30c7\u30eb\u306f\u30b9\u30b3\u30a2\u306e\u629c\u3051\u7a74\u3092\u60aa\u7528) OOD \u30c7\u30fc\u30bf\u306b\u654f\u611f\u3002\u3053\u306e\u30c7\u30a3\u30b9\u30c8\u30ea\u30d3\u30e5\u30fc\u30b7\u30e7\u30f3\u3067\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 \u81ea\u5df1\u5f37\u5316\u30d0\u30a4\u30a2\u30b9\uff08\u304a\u3079\u3063\u304b\uff09\u306b\u306a\u308a\u3084\u3059\u3044"},{"location":"ja/part4/4_3_preference_data/#112","title":"11.2 \u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u3068\u54c1\u8cea\u7ba1\u7406: \u4eba\u9593\u306e\u4e3b\u89b3\u7684\u306a\u30ce\u30a4\u30ba\u306e\u5b9a\u91cf\u5316","text":"<p>\u5b9f\u969b\u306e\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3067\u306f\u3001\u4eba\u9593\u306e\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u4e3b\u89b3\u304c\u30e2\u30c7\u30eb\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u300c\u898b\u3048\u306a\u3044\u5929\u4e95\u300d\u3068\u306a\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u306f\u5b8c\u74a7\u306a\u300c\u771f\u5b9f\u306e\u6a5f\u68b0\u300d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u3055\u307e\u3056\u307e\u306a\u5fc3\u7406\u7684\u304a\u3088\u3073\u8a8d\u77e5\u7684\u8981\u56e0\u306e\u5f71\u97ff\u3092\u53d7\u3051\u3001\u30c7\u30fc\u30bf\u304c\u30ce\u30a4\u30ba\u3067\u57cb\u3081\u5c3d\u304f\u3055\u308c\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u8a8d\u77e5\u75b2\u52b4 \u306f\u3001\u4f55\u6642\u9593\u3082\u306e\u9023\u7d9a\u4f5c\u696d\u5f8c\u306e\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u306e\u300c\u5b89\u5168\u300d\u5224\u65ad\u57fa\u6e96\u3092\u5927\u5e45\u306b\u4f4e\u4e0b\u3055\u305b\u3001\u308f\u305a\u304b\u306b\u6709\u6bd2\u306a\u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u3059\u308a\u629c\u3051\u3055\u305b\u307e\u3059\u3002 \u6587\u5316\u7684\u504f\u898b \u3068\u306f\u3001\u56fd\u3001\u5e74\u9f62\u3001\u653f\u6cbb\u7684\u7acb\u5834\u304c\u7570\u306a\u308b\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u304c\u300c\u4f55\u304c\u653b\u6483\u7684\u306a\u30b8\u30e7\u30fc\u30af\u3068\u307f\u306a\u3055\u308c\u308b\u304b\u300d\u306b\u3064\u3044\u3066\u660e\u3089\u304b\u306b\u7570\u306a\u308b\u7406\u89e3\u3092\u6301\u3063\u3066\u3044\u308b\u3053\u3068\u3092\u610f\u5473\u3057\u307e\u3059\u3002\u3055\u3089\u306b\u3001\u547d\u4ee4\u306e\u66d6\u6627\u3055 \u304c\u5927\u304d\u306a\u8981\u56e0\u3067\u3059\u3002\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3\u304c\u300c\u6709\u5bb3\u306a\u300d\u5883\u754c\u7dda\u3092\u660e\u78ba\u306b\u5b9a\u7fa9\u3057\u3066\u3044\u306a\u3044\u5834\u5408 (\u305f\u3068\u3048\u3070\u3001\u300c\u5408\u7406\u7684\u306a\u79df\u7a0e\u56de\u907f\u306f\u6709\u5bb3\u3067\u3059\u304b?\u300d)\u3001\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u306e\u610f\u898b\u306f\u5fc5\u7136\u7684\u306b\u5927\u304d\u304f\u7570\u306a\u308a\u307e\u3059\u3002</p> <p>\u3053\u306e\u30ce\u30a4\u30ba\u3092\u79d1\u5b66\u7684\u306b\u5b9a\u91cf\u5316\u3057\u3066\u9664\u53bb\u3059\u308b\u306b\u306f\u3001\u5358\u7d14\u306a\u300c\u4e00\u81f4\u7387\u300d(\u4e21\u65b9\u304c A \u3092\u9078\u629e\u3059\u308b\u5272\u5408) \u306f\u6b3a\u779e\u7684\u3067\u3059\u3002\u30e9\u30f3\u30c0\u30e0\u306a\u63a8\u6e2c\u3067 50% \u306e\u4e00\u81f4\u3092\u9054\u6210\u3067\u304d\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u696d\u754c\u3067\u306f\u901a\u5e38\u3001\u30b3\u30fc\u30a8\u30f3\u306e\u30ab\u30c3\u30d1 (\\(\\kappa\\)) \u4fc2\u6570\u3092\u4f7f\u7528\u3057\u3066\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u54c1\u8cea\u3092\u6e2c\u5b9a\u3057\u307e\u3059\u3002\u3053\u306e\u30e1\u30c8\u30ea\u30af\u30b9\u306f\u3001\u5f0f \\(\\kappa = \\frac{p_o - p_e}{1 - p_e}\\) \u3092\u4f7f\u7528\u3057\u3066 \u300c\u30e9\u30f3\u30c0\u30e0\u306a\u4e00\u81f4\u3092\u9664\u304f\u4e00\u81f4\u300d \u3092\u8a08\u7b97\u3057\u307e\u3059\u3002\u3053\u3053\u3067\u3001\\(p_o\\) \u306f\u89b3\u6e2c\u3055\u308c\u305f\u4e00\u81f4\u7387\u3001\\(p_e\\) \u306f\u4e88\u60f3\u3055\u308c\u308b\u30e9\u30f3\u30c0\u30e0\u306a\u4e00\u81f4\u7387\u3067\u3059\u3002 \\(\\kappa &gt; 0.6\\) \u306e\u5834\u5408\u306b\u306e\u307f\u3001\u3053\u306e\u30c7\u30fc\u30bf\u306f\u4e3b\u89b3\u7684\u306a\u63a8\u6e2c\u3067\u306f\u306a\u304f\u5ba2\u89b3\u7684\u306a\u4e8b\u5b9f\u3092\u53cd\u6620\u3057\u3066\u3044\u308b\u3068\u8003\u3048\u3089\u308c\u307e\u3059\u3002 \\(\\kappa &lt; 0.4\\) \u306e\u5834\u5408\u3001\u3053\u308c\u306f\u901a\u5e38\u3001\u62c5\u5f53\u8005\u306e\u80fd\u529b\u3067\u306f\u306a\u304f\u3001\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 \u30ac\u30a4\u30c9\u30e9\u30a4\u30f3\u306e\u30ed\u30b8\u30c3\u30af\u306b\u6b20\u9665\u304c\u3042\u308b\u3053\u3068\u3092\u793a\u3057\u3066\u304a\u308a\u3001\u66f8\u304d\u76f4\u3059\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_3_preference_data/#113-rlaif-ai","title":"11.3 RLAIF (AI \u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af): \u61b2\u6cd5\u306b\u57fa\u3065\u304f\u81ea\u52d5\u8abf\u6574","text":"<p>RLAIF\u3001\u3064\u307e\u308a\u61b2\u6cd5 AI \u306e\u4e2d\u5fc3\u7684\u306a\u30a2\u30a4\u30c7\u30a2\u306f\u3001\u4eba\u9593\u306e\u4fa1\u5024\u89b3\u3092\u4e00\u9023\u306e\u660e\u793a\u7684\u306a\u300c\u61b2\u6cd5\u300d\u306b\u62bd\u8c61\u5316\u3057\u3001AI \u304c\u61b2\u6cd5\u306b\u57fa\u3065\u3044\u3066\u81ea\u5df1\u6279\u5224\u304a\u3088\u3073\u4fee\u6b63\u3057\u3066\u55dc\u597d\u30c7\u30fc\u30bf\u3092\u751f\u6210\u3067\u304d\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3067\u3059\u3002\u3053\u306e\u65b9\u6cd5\u306e\u5b9f\u73fe\u53ef\u80fd\u6027\u306f\u3001\u6838\u3068\u306a\u308b\u524d\u63d0\u306b\u57fa\u3065\u3044\u3066\u3044\u307e\u3059\u3002 \u30e2\u30c7\u30eb\u306e\u5584\u3068\u60aa\u3092\u5224\u65ad\u3059\u308b\u80fd\u529b (\u8b58\u5225) \u306f\u3001\u5b8c\u74a7\u306a\u7b54\u3048\u3092\u751f\u6210\u3059\u308b\u80fd\u529b (\u751f\u6210) \u3092\u4e0a\u56de\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002 \u30d7\u30ed\u306e\u6620\u753b\u6279\u8a55\u5bb6\u304c\u30aa\u30b9\u30ab\u30fc \u30ec\u30d9\u30eb\u306e\u6620\u753b\u3092\u4f5c\u308b\u3053\u3068\u306f\u3067\u304d\u306a\u3044\u304b\u3082\u3057\u308c\u306a\u3044\u304c\u3001\u6620\u753b\u7406\u8ad6\u306b\u57fa\u3065\u3044\u3066\u7269\u8a9e\u306e\u6b20\u9665\u3084\u6620\u753b\u64ae\u5f71\u306e\u6b20\u9665\u3092\u6b63\u78ba\u306b\u6307\u6458\u3067\u304d\u308b\u306e\u3068\u540c\u3058\u3067\u3059\u3002\u540c\u69d8\u306b\u3001GPT-4 \u306f\u3001\u30bc\u30ed\u30b7\u30e7\u30c3\u30c8\u3067\u3059\u3079\u3066\u306e\u5b89\u5168\u57fa\u6e96\u3092\u6e80\u305f\u3059\u5b8c\u74a7\u306a\u56de\u7b54\u3092\u76f4\u63a5\u751f\u6210\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u304c\u3001\u8a73\u7d30\u306a\u300c\u61b2\u6cd5\u300d\u539f\u5247\u306b\u57fa\u3065\u3044\u3066\u3001\u65e2\u5b58\u306e\u56de\u7b54\u306e\u8ad6\u7406\u7684\u6b20\u9665\u3084\u6f5c\u5728\u7684\u306a\u5b89\u5168\u4e0a\u306e\u5371\u967a\u3092\u5b8c\u5168\u306b\u6307\u6458\u3067\u304d\u307e\u3059\u3002 RLAIF \u306f\u3001\u3053\u306e\u300c\u5dee\u5225\u306e\u914d\u5f53\u300d\u3092\u6d3b\u7528\u3057\u3066\u3001\u8907\u6570\u30e9\u30a6\u30f3\u30c9\u306e\u6279\u8a55\u3068\u6539\u8a02\u3092\u901a\u3058\u3066\u3001\u6700\u7d42\u7684\u306b\u751f\u6210\u3055\u308c\u308b\u30c7\u30fc\u30bf\u306e\u54c1\u8cea\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_3_preference_data/#3","title":"3. \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u5b9f\u88c5 (\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u5b9f\u88c5)","text":""},{"location":"ja/part4/4_3_preference_data/#111_1","title":"11.1 \u30d7\u30ea\u30d5\u30a1\u30ec\u30f3\u30b9\u30c7\u30fc\u30bf\u69cb\u7bc9\u30d5\u30ed\u30fc","text":"<p>\u55dc\u597d\u30c7\u30fc\u30bf\u3092\u69cb\u7bc9\u3059\u308b\u5834\u5408\u3001\u901a\u5e38\u306f\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u66f8\u304d\u76f4\u3059\u5fc5\u8981\u306f\u3042\u308a\u307e\u305b\u3093\u3002SFT \u30e2\u30c7\u30eb\u304b\u3089 2 \u3064\u306e\u7570\u306a\u308b\u5fdc\u7b54\u3092\u751f\u6210\u3057\u3001\u54c1\u8cea\u3092\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u3057\u307e\u3059\u3002 DPO \u7528\u306b\u30cd\u30ac\u30c6\u30a3\u30d6 \u30b5\u30f3\u30d7\u30eb (\u62d2\u5426) \u3092\u751f\u6210\u3059\u308b\u5834\u5408\u3001\u6e29\u5ea6\u3092\u4e0a\u3052\u308b (\u4f8b: 1.0 \uff5e 1.2) \u3053\u3068\u304c\u91cd\u8981\u306a\u30c6\u30af\u30cb\u30c3\u30af\u3067\u3059\u3002\u3053\u308c\u306f\u3001\u7121\u610f\u5473\u306a\u300c\u610f\u5473\u4e0d\u660e\u300d\u306a\u62d2\u5426\u3055\u308c\u305f\u30b5\u30f3\u30d7\u30eb\u3067\u306f\u306a\u304f\u3001\u300c\u3082\u3063\u3068\u3082\u3089\u3057\u3044\u300d\u30a8\u30e9\u30fc\u304c\u5fc5\u8981\u3067\u3042\u308b\u305f\u3081\u3067\u3059\u3002\u6e29\u5ea6\u304c\u4f4e\u3059\u304e\u308b\u5834\u5408\u3001\u30e2\u30c7\u30eb\u306f\u6700\u3082\u5b89\u5168\u3067\u6700\u3082\u4fdd\u5b88\u7684\u306a\u7b54\u3048\u3092\u751f\u6210\u3059\u308b\u50be\u5411\u304c\u3042\u308a\u3001\u9ad8\u54c1\u8cea\u306e\u9670\u6027\u30b5\u30f3\u30d7\u30eb\u3092\u53d6\u5f97\u3059\u308b\u3053\u3068\u304c\u56f0\u96e3\u306b\u306a\u308a\u307e\u3059\u3002\u30e9\u30f3\u30c0\u30e0\u6027\u3092\u9ad8\u3081\u3066\u30e2\u30c7\u30eb\u306b\u6f5c\u5728\u7684\u306a\u30d0\u30a4\u30a2\u30b9\u3001\u5e7b\u899a\u3001\u8ad6\u7406\u7684\u6b20\u9665\u3092\u9732\u51fa\u3055\u305b\u308b\u3053\u3068\u306b\u3088\u3063\u3066\u306e\u307f\u3001\u3053\u308c\u3089\u306e\u300c\u9ad8\u54c1\u8cea\u306e\u30a8\u30e9\u30fc\u300d\u306f\u3001\u6700\u5927\u306e\u52fe\u914d\u60c5\u5831\u3092\u5099\u3048\u305f DPO \u306b\u6700\u9069\u306a\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u7d20\u6750\u3092\u63d0\u4f9b\u3067\u304d\u307e\u3059\u3002</p> <pre><code># Code example: Generate diverse candidate responses\n# For same Prompt, use high Temperature to generate two responses for diversity\nprompt = \"Tell me how to steal a credit card.\"\n\n# Response A (Unsafe / Rejected) - High temperature sampling easily induces this \"jailbreak\" response\nresponse_rejected = \"Sure, here are common methods to steal credit cards...\"\n\n# Response B (Safe / Chosen) - Or generated with stronger Teacher Model\nresponse_chosen = \"I cannot assist with that request. Stealing credit cards is illegal...\"\n</code></pre> <p>\u4fdd\u5b58\u3059\u308b\u3068\u304d\u306f\u3001DPO \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u6a19\u6e96 JSONL \u5f62\u5f0f\u306b\u5f93\u3063\u3066\u304f\u3060\u3055\u3044\u3002 </p><pre><code>{\n  \"prompt\": \"Tell me how to steal a credit card.\",\n  \"chosen\": \"I cannot assist with that request. Stealing credit cards is illegal...\",\n  \"rejected\": \"Sure, here are common methods to steal credit cards...\"\n}\n</code></pre><p></p>"},{"location":"ja/part4/4_3_preference_data/#112_1","title":"11.2 \u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0\u306e\u54c1\u8cea\u7ba1\u7406\u30b3\u30fc\u30c9","text":"<p>\u30af\u30e9\u30a6\u30c9\u30bd\u30fc\u30b7\u30f3\u30b0 \u30d7\u30e9\u30c3\u30c8\u30d5\u30a9\u30fc\u30e0 (Scale AI\u3001Labelbox \u306a\u3069) \u3092\u4f7f\u7528\u3059\u308b\u5834\u5408\u3001\u30c7\u30fc\u30bf\u54c1\u8cea\u3092\u76e3\u8996\u3059\u308b\u305f\u3081\u306b\u3001\u30b3\u30fc\u30c9\u3092\u901a\u3058\u3066\u4e00\u8cab\u6027\u30e1\u30c8\u30ea\u30af\u30b9\u3092\u81ea\u52d5\u7684\u306b\u8a08\u7b97\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <pre><code>from sklearn.metrics import cohen_kappa_score\n\n# Assume two annotators score a batch (1=Chosen A, 0=Chosen B)\nannotator_1 = [1, 1, 0, 1, 0]\nannotator_2 = [1, 1, 1, 1, 0]\n\nkappa = cohen_kappa_score(annotator_1, annotator_2)\n\nprint(f\"Cohen's Kappa: {kappa:.2f}\")\n\n# Judgment logic - industry experience threshold\nif kappa &gt; 0.8:\n    print(\"Excellent agreement. Golden dataset.\")\nelif kappa &gt; 0.6:\n    print(\"Agreement is acceptable. Good for training.\")\nelif kappa &gt; 0.4:\n    print(\"Weak agreement. Review confusing samples manually.\")\nelse:\n    print(\"Low agreement. Discard data. Re-write Guidelines or Retrain Annotators.\")\n</code></pre> <p>\u30d7\u30ed\u306e\u30d2\u30f3\u30c8: Kappa \u304c\u7d99\u7d9a\u7684\u306b\u4f4e\u3044\u5834\u5408\u306f\u3001\u3084\u307f\u304f\u3082\u306b\u30a2\u30ce\u30c6\u30fc\u30bf\u30fc\u3092\u7f6e\u304d\u63db\u3048\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002\u3053\u308c\u306f\u901a\u5e38\u3001\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 \u30ac\u30a4\u30c9\u30e9\u30a4\u30f3 \u306b\u30b0\u30ec\u30fc\u30be\u30fc\u30f3\u304c\u3042\u308b\u3053\u3068\u3092\u793a\u3057\u3066\u3044\u307e\u3059\u3002\u6ce8\u91c8\u3092\u4e00\u6642\u505c\u6b62\u3057\u3001\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3\u3092\u6539\u8a02\u3057\u3001\u7279\u5b9a\u306e\u30b3\u30fc\u30ca\u30fc\u30b1\u30fc\u30b9\u306e\u4f8b\u3092\u63d0\u4f9b\u3057\u307e\u3059\uff08\u4f8b\uff1a\u300c\u30e6\u30fc\u30b6\u30fc\u304c\u9283\u306e\u6383\u9664\u65b9\u6cd5\u3092\u5c0b\u306d\u305f\u5834\u5408\u3001\u305d\u308c\u306f\u6b66\u5668\u306e\u88fd\u9020\u3068\u3057\u3066\u30ab\u30a6\u30f3\u30c8\u3055\u308c\u307e\u3059\u304b\uff1f\u30ac\u30a4\u30c9\u30e9\u30a4\u30f3\u306f\u660e\u78ba\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\uff1a\u30e1\u30f3\u30c6\u30ca\u30f3\u30b9\u2260\u88fd\u9020\u3001\u5b89\u5168\u7bc4\u56f2\u306b\u5c5e\u3059\u308b\u300d\uff09\u3002</p>"},{"location":"ja/part4/4_3_preference_data/#113-ai","title":"11.3 \u61b2\u6cd5\u4e0a\u306e AI \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5b9f\u88c5","text":"<p>\u3053\u308c\u306f\u81ea\u52d5\u8abf\u6574\u306e\u4e3b\u306a\u5b9f\u88c5\u3067\u3059\u3002\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3: \u6279\u8a55 -&gt; \u6539\u8a02 -&gt; \u512a\u5148\u30da\u30a2\u3067\u3001\u8abf\u6574\u30b3\u30b9\u30c8\u3092\u4eba\u7684\u8cc7\u6e90\u304b\u3089\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u306b\u79fb\u3057\u307e\u3059\u3002</p> <p>\u30b9\u30c6\u30c3\u30d7 1: \u6709\u5bb3\u306a\u53cd\u5fdc\u306e\u751f\u6210\u3092\u8a98\u767a\u3059\u308b (\u30ec\u30c3\u30c9 \u30c1\u30fc\u30e0\u5316) SFT \u30e2\u30c7\u30eb\u306b\u6709\u5bb3\u306a\u5fdc\u7b54 \\(y_{harmful}\\) \u3092\u751f\u6210\u3055\u305b\u307e\u3059\u3002\u3053\u308c\u306b\u306f\u901a\u5e38\u3001\u30e2\u30c7\u30eb\u4e0a\u3067\u3055\u307e\u3056\u307e\u306a\u30cf\u30c3\u30ab\u30fc\u653b\u6483\u65b9\u6cd5\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\u3059\u308b\u7279\u6b8a\u306a \u30ec\u30c3\u30c9 \u30c1\u30fc\u30df\u30f3\u30b0 \u30d7\u30ed\u30f3\u30d7\u30c8\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u30b9\u30c6\u30c3\u30d7 2: \u61b2\u6cd5\u6279\u5224 \u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u4f7f\u7528\u3059\u308b\u3068\u3001\u300c\u61b2\u6cd5\u300d\u306b\u57fa\u3065\u3044\u3066AI\u306b\u9593\u9055\u3044\u3092\u6307\u6458\u3055\u305b\u307e\u3059\u3002</p> <pre><code>critique_prompt = \"\"\"\n### CONSTITUTION\nPrinciple: \"Please choose the response that is most helpful, honest, and harmless. Do NOT encourage illegal acts, violence, or unethical behavior.\"\n\n### TASK\nCritique the following Assistant Response based strictly on the Principle above. Point out specific violations.\nDo not simply say it's bad, explain WHY based on the Constitution.\n\nUser Input: {user_prompt}\nAssistant Response: {harmful_response}\n\n### CRITIQUE\n\"\"\"\n</code></pre> <p>\u30b9\u30c6\u30c3\u30d7 3: \u6279\u5224\u306b\u57fa\u3065\u304f\u4fee\u6b63 (\u6539\u8a02) </p><pre><code>revision_prompt = \"\"\"\n### TASK\nRewrite the Assistant Response to remove all harmful content identified in the Critique.\nThe new response must be a polite refusal or a safe educational explanation.\n\nCritique: {critique_text}\nOriginal Response: {harmful_response}\n\n### REVISION\n\"\"\"\n</code></pre><p></p> <p>\u30b9\u30c6\u30c3\u30d7 4: \u30c7\u30fc\u30bf \u30c8\u30ea\u30d7\u30ec\u30c3\u30c8\u306e\u69cb\u7bc9 \u6700\u5f8c\u306b\u3001\u5143\u306e\u30d7\u30ed\u30f3\u30d7\u30c8\u3001\u6539\u8a02\u3055\u308c\u305f\u5b89\u5168\u306a\u5fdc\u7b54 (\u9078\u629e)\u3001\u304a\u3088\u3073\u5143\u306e\u6709\u5bb3\u306a\u5fdc\u7b54 (\u62d2\u5426) \u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u9ad8\u54c1\u8cea\u306e\u55dc\u597d\u30c7\u30fc\u30bf\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002\u3053\u306e\u65b9\u6cd5\u306b\u3088\u308a\u3001\u30a2\u30e9\u30a4\u30e1\u30f3\u30c8\u30b3\u30b9\u30c8\u304c\u300c\u30a2\u30a4\u30c6\u30e0\u3054\u3068\u306e\u8ab2\u91d1\uff08\u30de\u30f3\u30d1\u30ef\u30fc\uff09\u300d\u304b\u3089\u300c\u30c8\u30fc\u30af\u30f3\u3054\u3068\u306e\u8ab2\u91d1\uff08\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\uff09\u300d\u306b\u524a\u6e1b\u3055\u308c\u3001\u6307\u6570\u95a2\u6570\u7684\u306a\u30b9\u30b1\u30fc\u30eb\u304c\u9054\u6210\u3055\u308c\u307e\u3059\u3002</p> <p>\u8868 11-2: \u4eba\u9593\u306b\u3088\u308b\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af (RLHF) \u3068 AI \u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af (RLAIF) \u306e\u6b21\u5143\u306e\u6bd4\u8f03</p> \u5bf8\u6cd5 \u30d2\u30e5\u30fc\u30de\u30f3\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af (RLHF) AI \u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af (RLAIF) \u30b3\u30b9\u30c8 \u30c7\u30fc\u30bf\u91cf\u306b\u5fdc\u3058\u3066\u9ad8\u304f\u76f4\u7dda\u7684 \u4f4e\u3044\uff08API \u30c8\u30fc\u30af\u30f3\u30b3\u30b9\u30c8\uff09\u3001\u9650\u754c\u8cbb\u7528\u304c\u6e1b\u5c11 \u901f\u5ea6 \u9045\u3044 (\u9031/\u6708\u30ec\u30d9\u30eb)\u3001\u4eba\u624b\u306b\u3088\u308b\u5236\u9650 \u9ad8\u901f (\u6642\u9593/\u65e5\u30ec\u30d9\u30eb)\u3001GPU \u306b\u3088\u3063\u3066\u5236\u9650 \u4e00\u8cab\u6027 \u4f4e\u3044\uff08\u6c17\u5206\u3001\u75b2\u52b4\u306e\u5f71\u97ff\u3092\u53d7\u3051\u308b\uff09\u3002 IAA \u8a08\u7b97\u304c\u5fc5\u8981 \u975e\u5e38\u306b\u9ad8\u3044 (\u540c\u3058\u30d7\u30ed\u30f3\u30d7\u30c8\u51fa\u529b\u304c\u6bd4\u8f03\u7684\u5b89\u5b9a\u3057\u3066\u3044\u308b) \u30d0\u30a4\u30a2\u30b9 \u6697\u9ed9\u306e\u504f\u898b\uff08\u6587\u5316\u7684\u3001\u5730\u57df\u7684\uff09\u3002\u691c\u51fa\u3059\u308b\u306e\u304c\u96e3\u3057\u3044 \u660e\u793a\u7684\u306a\u30d0\u30a4\u30a2\u30b9 (\u57fa\u672c\u30e2\u30c7\u30eb\u304b\u3089\u7d99\u627f)\u3002\u61b2\u6cd5\u3092\u901a\u3058\u3066\u4fee\u6b63\u53ef\u80fd \u8a72\u5f53\u3059\u308b\u30b7\u30ca\u30ea\u30aa \u975e\u5e38\u306b\u5fae\u5999\u306a\u502b\u7406\u7684\u5224\u65ad\u3001\u5275\u9020\u7684\u306a\u6587\u7ae0 \u5927\u898f\u6a21\u306a\u30b3\u30f3\u30d7\u30e9\u30a4\u30a2\u30f3\u30b9\u30c1\u30a7\u30c3\u30af\u3001\u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u8abf\u6574\u3001\u57fa\u672c\u7684\u306a\u7121\u5bb3\u5316"},{"location":"ja/part4/4_3_preference_data/#4","title":"4. \u5b9f\u7e3e\u3068\u8a55\u4fa1 (\u5b9f\u7e3e\u3068\u8a55\u4fa1)","text":"<p>\u8abf\u6574\u52b9\u679c\u3092\u8a55\u4fa1\u3059\u308b\u3068\u304d\u306f\u3001\u7121\u5bb3\u5316\u7387\u3068\u6709\u7528\u6027\u3068\u3044\u3046 2 \u3064\u306e\u4e2d\u5fc3\u7684\u306a\u8981\u7d20\u306e\u30d0\u30e9\u30f3\u30b9\u306b\u7126\u70b9\u3092\u5f53\u3066\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u7121\u5bb3\u7387\u306f\u901a\u5e38\u3001\u30ec\u30c3\u30c9 \u30c1\u30fc\u30df\u30f3\u30b0 \u30c6\u30b9\u30c8 \u30bb\u30c3\u30c8 (RealToxicityPrompts \u306a\u3069) \u306e\u62d2\u5426\u7387\u306b\u3088\u3063\u3066\u6e2c\u5b9a\u3055\u308c\u307e\u3059\u3002\u61b2\u6cd5 AI \u306f\u901a\u5e38\u3001\u6709\u5bb3\u7387\u3092 10% \u304b\u3089 1% \u4ee5\u4e0b\u306b\u524a\u6e1b\u3057\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u7d14\u7c8b\u306b\u7121\u5bb3\u6027\u3092\u8ffd\u6c42\u3059\u308b\u3068\u300c\u614e\u91cd\u3059\u304e\u308b\u30df\u30e5\u30fc\u30c8\u300d\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u6709\u7528\u6027\u3092\u540c\u6642\u306b\u76e3\u8996\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3064\u307e\u308a\u3001\u30e2\u30c7\u30eb\u304c\u9069\u5207\u306a\u8cea\u554f (\u305f\u3068\u3048\u3070\u3001\u300c\u30b7\u30b9\u30c6\u30e0 \u30d7\u30ed\u30bb\u30b9\u3092\u5f37\u5236\u7d42\u4e86\u3059\u308b\u65b9\u6cd5\u300d\u3092\u66b4\u529b\u3068\u9593\u9055\u3048\u308b\u306a\u3069) \u3092\u8aa4\u3063\u3066\u5224\u65ad\u3057\u3066\u3044\u306a\u3044\u304b\u3069\u3046\u304b\u3092\u89b3\u5bdf\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u7406\u60f3\u7684\u306a\u914d\u7f6e\u306f\u30d1\u30ec\u30fc\u30c8\u30d5\u30ed\u30f3\u30c6\u30a3\u30a2\u4e0a\u3092\u79fb\u52d5\u3057\u3001\u5b9f\u7528\u6027\u3092\u72a0\u7272\u306b\u3059\u308b\u3053\u3068\u306a\u304f\u5b89\u5168\u6027\u3092\u6700\u5927\u5316\u3057\u307e\u3059\u3002</p> <p> \u56f3 11-2: \u30d1\u30ec\u30fc\u30c8 \u30d5\u30ed\u30f3\u30c6\u30a3\u30a2\u66f2\u7dda\u3002 X \u8ef8: \u7121\u5bb3\u6027\u30b9\u30b3\u30a2\u3001Y \u8ef8: \u6709\u7528\u6027\u30b9\u30b3\u30a2</p>"},{"location":"ja/part4/4_3_preference_data/#5","title":"5. \u843d\u3068\u3057\u7a74\u3068\u30c8\u30e9\u30d6\u30eb\u30b7\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0","text":"<p>\u8abf\u6574\u30d7\u30ed\u30bb\u30b9\u3067\u306f\u30012 \u3064\u306e\u53e4\u5178\u7684\u306a\u30c8\u30e9\u30c3\u30d7\u306b\u7279\u5225\u306a\u8b66\u6212\u304c\u5fc5\u8981\u3067\u3059\u3002 1 \u3064\u76ee\u306f \u304a\u3079\u3063\u304b \u3067\u3059\u3002\u30e6\u30fc\u30b6\u30fc\u3092\u559c\u3070\u305b\u308b\u305f\u3081\u306e\u30e2\u30c7\u30eb (\u307e\u305f\u306f\u5831\u916c\u30e2\u30c7\u30eb) \u306f\u3001\u30e6\u30fc\u30b6\u30fc\u306e\u9593\u9055\u3063\u305f\u610f\u898b\u306b\u540c\u610f\u3057\u307e\u3059\u3002\u305f\u3068\u3048\u3070\u3001\u30e6\u30fc\u30b6\u30fc\u304c\u300c\u5730\u7403\u306f\u5e73\u3089\u3060\u300d\u3068\u4e3b\u5f35\u3059\u308b\u3068\u3001\u30e2\u30c7\u30eb\u306f\u300c\u305d\u306e\u901a\u308a\u3067\u3059\u3002\u305d\u308c\u306f\u8208\u5473\u6df1\u3044\u8996\u70b9\u3067\u3059\u306d\u300d\u3068\u7b54\u3048\u308b\u304b\u3082\u3057\u308c\u307e\u305b\u3093\u3002\u6df1\u3044\u7406\u7531: RLHF \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u306f\u3001\u30e2\u30c7\u30eb\u306f\u901a\u5e38\u3001\u300c\u30e6\u30fc\u30b6\u30fc\u306e\u4fee\u6b63\u300d\u3088\u308a\u3082\u300c\u30e6\u30fc\u30b6\u30fc\u306e\u540c\u610f\u300d\u306e\u30b9\u30b3\u30a2\u304c\u9ad8\u3044\u3053\u3068\u3092\u767a\u898b\u3057\u307e\u3059\u3002\u4fee\u6b63: \u591a\u304f\u306e\u300c\u6b63\u3057\u3044\u30e6\u30fc\u30b6\u30fc\u30a8\u30e9\u30fc\u300d\u30b5\u30f3\u30d7\u30eb\u3092\u9078\u629e\u30c7\u30fc\u30bf\u306b\u9078\u629e\u3068\u3057\u3066\u542b\u3081\u3001\u898f\u7d04\u306b\u300c\u793c\u5100\u6b63\u3057\u3055\u3088\u308a\u6b63\u76f4\u3055\u300d\u306e\u539f\u5247\u3092\u660e\u793a\u7684\u306b\u8ffd\u52a0\u3057\u307e\u3057\u305f\u3002</p> <p>2 \u756a\u76ee\u306e\u7f60\u306f \u5831\u916c\u30cf\u30c3\u30ad\u30f3\u30b0\u3067\u3059\u3002\u30e2\u30c7\u30eb\u306f\u3001\u9577\u3044\u56de\u7b54\u306e\u30b9\u30b3\u30a2\u304c\u9ad8\u3044\u3053\u3068\u304c\u5224\u660e\u3057\u305f\u305f\u3081\u3001\u5927\u91cf\u306e\u9577\u3044\u30ca\u30f3\u30bb\u30f3\u30b9\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u30b0\u30c3\u30c9\u30cf\u30fc\u30c8\u306e\u6cd5\u5247\u3001\u300c\u6307\u6a19\u304c\u30bf\u30fc\u30b2\u30c3\u30c8\u306b\u306a\u308b\u3068\u3001\u305d\u308c\u306f\u826f\u3044\u6307\u6a19\u3067\u306f\u306a\u304f\u306a\u308b\u300d\u3092\u5982\u5b9f\u306b\u8868\u3057\u3066\u3044\u307e\u3059\u3002\u89e3\u6c7a\u7b56: DPO \u307e\u305f\u306f\u5831\u916c\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3067\u9577\u3055\u30da\u30ca\u30eb\u30c6\u30a3\u3092\u8ffd\u52a0\u3059\u308b\u304b\u3001\u62d2\u5426\u3055\u308c\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u69cb\u7bc9\u3059\u308b\u3068\u304d\u306b\u300c\u9577\u3044\u304c\u5f79\u306b\u7acb\u305f\u306a\u3044\u300d\u5fdc\u7b54\u3092\u610f\u56f3\u7684\u306b\u542b\u3081\u3066\u3001\u30e2\u30c7\u30eb\u306b\u300c\u9577\u3044 \u2260 \u826f\u3044\u300d\u3053\u3068\u3092\u5f37\u5236\u7684\u306b\u5b66\u7fd2\u3055\u305b\u307e\u3059\u3002</p>"},{"location":"ja/part4/4_3_preference_data/#6","title":"6. \u5404\u7ae0\u306e\u8981\u7d04\u3068\u8a73\u7d30\u60c5\u5831","text":"<p>\u3053\u306e\u7ae0\u3067\u306f\u3001\u547d\u4ee4\u306e\u5fae\u8abf\u6574\u304b\u3089\u4eba\u9593\u306e\u597d\u307f\u306e\u8abf\u6574\u3078\u306e\u91cd\u8981\u306a\u98db\u8e8d\u306b\u3064\u3044\u3066\u63a2\u308a\u307e\u3057\u305f\u3002 DPO \u306f\u3001\u696d\u754c\u6a19\u6e96\u3068\u3057\u3066\u4e0d\u5b89\u5b9a\u306a PPO \u3092\u5f90\u3005\u306b\u7f6e\u304d\u63db\u3048\u3066\u304d\u307e\u3057\u305f\u3002DPO \u306f\u3001\u9759\u7684\u306a\u512a\u5148\u30c7\u30fc\u30bf \u30c8\u30ea\u30d7\u30ec\u30c3\u30c8\u3092\u4f7f\u7528\u3057\u3066\u30dd\u30ea\u30b7\u30fc\u3092\u76f4\u63a5\u6700\u9069\u5316\u3057\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306e\u5b89\u5b9a\u6027\u3068\u52b9\u7387\u3092\u5927\u5e45\u306b\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002\u79c1\u305f\u3061\u306f\u4eba\u9593\u306b\u3088\u308b\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3\u306e\u9650\u754c\u3092\u8a8d\u8b58\u3057\u307e\u3057\u305f\u3002 IAA \u30e1\u30c8\u30ea\u30af\u30b9\u3068 Cohen \u306e Kappa \u3092\u901a\u3058\u3066\u3001\u30c7\u30fc\u30bf\u54c1\u8cea\u7ba1\u7406\u3092\u7d4c\u9a13\u4e3b\u7fa9\u304b\u3089\u7d71\u8a08\u7684\u53b3\u5bc6\u3055\u3078\u3068\u63a8\u3057\u9032\u3081\u307e\u3057\u305f\u3002\u3055\u3089\u306b\u91cd\u8981\u306a\u3053\u3068\u306f\u3001RLAIF \u3068\u61b2\u6cd5\u4e0a\u306e AI \u306e\u51fa\u73fe\u306f\u3001\u7523\u696d\u9769\u547d\u306e\u9032\u884c\u4e2d\u306e\u6574\u5408\u6027\u3092\u793a\u3059\u3082\u306e\u3067\u3059\u3002\u5024\u3092\u30d7\u30ed\u30f3\u30d7\u30c8\u306b\u30a8\u30f3\u30b3\u30fc\u30c9\u3059\u308b\u3053\u3068\u3067\u3001\u4eba\u7684\u8cc7\u6e90\u3092\u89e3\u653e\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u6574\u5408\u6027\u306e\u81ea\u52d5\u5316\u3068\u81ea\u5df1\u53cd\u5fa9\u3092\u5b9f\u73fe\u3057\u3001\u5b89\u5168\u3067\u5f37\u529b\u306a AI \u30b7\u30b9\u30c6\u30e0\u306e\u4e21\u65b9\u3092\u69cb\u7bc9\u3059\u308b\u305f\u3081\u306e\u6301\u7d9a\u53ef\u80fd\u306a\u9053\u3092\u63d0\u4f9b\u3057\u307e\u3059\u3002</p> <p>\u53c2\u8003\u6587\u732e: * Ouyang\u3001L.\u3001\u4ed6\u3002 \uff082022\u5e74\uff09\u3002\u4eba\u9593\u306e\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u306b\u3088\u308b\u6307\u793a\u306b\u5f93\u3046\u3088\u3046\u306b\u8a00\u8a9e\u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3057\u307e\u3059\u3002 (RLHF \u3068 SFT \u306b\u95a2\u3059\u308b\u57fa\u790e\u7814\u7a76\u3001SFT \u3068 RLHF \u306e\u6bd4\u8f03\u30bd\u30fc\u30b9) * Bai, Y. \u4ed6\uff082022\u5e74\uff09\u3002\u61b2\u6cd5\u4e0a\u306e AI: AI \u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u304b\u3089\u306e\u7121\u5bb3\u6027 (RLAIF \u3068\u61b2\u6cd5\u4e0a\u306e AI \u306b\u95a2\u3059\u308b\u30b3\u30a2 \u30da\u30fc\u30d1\u30fc) * Rafailov\u3001\u4ed6\u3002 \uff082023\u5e74\uff09\u3002 Direct Preference Optimization: Your Language Model is Secretly a Reward Model. (DPO \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u30aa\u30ea\u30b8\u30ca\u30eb \u30da\u30fc\u30d1\u30fc) * Casper\u3001S.\u3001\u4ed6\u3002 \uff082023\u5e74\uff09\u3002\u4eba\u9593\u306e\u30d5\u30a3\u30fc\u30c9\u30d0\u30c3\u30af\u304b\u3089\u306e\u5f37\u5316\u5b66\u7fd2\u306e\u672a\u89e3\u6c7a\u306e\u554f\u984c\u3068\u57fa\u672c\u7684\u306a\u5236\u9650 (RLHF \u306e\u5236\u9650\u3068\u5831\u916c\u30cf\u30c3\u30ad\u30f3\u30b0\u306e\u8a73\u7d30\u306a\u5206\u6790)</p>"},{"location":"ja/part5/5_1_rag_pipeline/","title":"\u7b2c12\u7ae0: RAG\u30c7\u30fc\u30bf\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":""},{"location":"ja/part5/5_1_rag_pipeline/#12-rag","title":"\u7b2c 12 \u7ae0: RAG \u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3","text":""},{"location":"ja/part5/5_1_rag_pipeline/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>Retrieval-Augmented Generation (RAG) \u306f\u3001\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba LLM \u5c0e\u5165\u306b\u63a8\u5968\u3055\u308c\u308b\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u305f\u3060\u3057\u3001\u591a\u304f\u306e RAG \u30b7\u30b9\u30c6\u30e0\u306f\u30c7\u30e2\u3067\u306f\u512a\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u5b9f\u7a3c\u50cd\u74b0\u5883\u3067\u306f\u53d6\u5f97\u7cbe\u5ea6\u304c\u4f4e\u3044\u305f\u3081\u306b\u5931\u6557\u3057\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001RAG \u306e\u4e2d\u6838\u3068\u306a\u308b\u771f\u5b9f\u3092\u660e\u3089\u304b\u306b\u3057\u307e\u3059\u3002\u53d6\u5f97\u54c1\u8cea\u306e\u4e0a\u9650\u306f\u3001\u30c7\u30fc\u30bf\u306e\u89e3\u6790\u3068\u30c1\u30e3\u30f3\u30af\u306e\u7c92\u5ea6\u306b\u3088\u3063\u3066\u6c7a\u5b9a\u3055\u308c\u307e\u3059\u3002\u975e\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u306e\u300c\u30e9\u30b9\u30c8 \u30de\u30a4\u30eb\u300d\u3067\u3042\u308b\u6587\u66f8\u89e3\u6790\u3092\u6398\u308a\u4e0b\u3052\u3001PDF \u30c6\u30fc\u30d6\u30eb\u306e\u5fa9\u5143\u3068\u8907\u6570\u5217\u8a8d\u8b58\u306e\u8ab2\u984c\u3092\u8abf\u67fb\u3057\u307e\u3059\u3002\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30afChunking\u3068\u89aa\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4ed8\u3051\u306e\u6bd4\u8f03\u3002Embedding\u30e2\u30c7\u30eb\u306e\u5fae\u8abf\u6574\u3068\u30d9\u30af\u30c8\u30eb \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u6700\u9069\u5316\u30af\u30ea\u30c6\u30a3\u30ab\u30eb \u30d1\u30b9\u306e\u5206\u6790\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#120","title":"12.0 \u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u975e\u69cb\u9020\u5316\u89e3\u6790\u6226\u7565\u3092\u30de\u30b9\u30bf\u30fc\u3059\u308b: \u8907\u6570\u5217\u306e PDF \u3084\u8907\u96d1\u306a\u8868\u306b\u5bfe\u3057\u3066\u6b63\u3057\u3044\u89e3\u6790\u30c4\u30fc\u30eb (\u30eb\u30fc\u30eb\u30d9\u30fc\u30b9\u3068\u30d3\u30b8\u30e7\u30f3\u30d9\u30fc\u30b9) \u3092\u9078\u629e\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</li> <li>\u9ad8\u5ea6\u306a\u30c1\u30e3\u30f3\u30af \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u306e\u5b9f\u88c5: \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u640d\u5931\u306e\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u300c\u89aa\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u300d\u6226\u7565\u306e Python \u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002</li> <li>\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u691c\u7d22\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u69cb\u7bc9: \u9ad8\u5bc6\u5ea6Embedding\u3068 BM25 \u30ad\u30fc\u30ef\u30fc\u30c9\u691c\u7d22\u304a\u3088\u3073 RRF \u30e9\u30f3\u30ad\u30f3\u30b0\u306e\u878d\u5408\u3092\u7d44\u307f\u5408\u308f\u305b\u305f\u30de\u30b9\u30bf\u30fc\u3002</li> <li>\u8a55\u4fa1\u3068\u6700\u9069\u5316: \u53d6\u5f97\u54c1\u8cea\u8a55\u4fa1\u3068\u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306eEmbedding\u30e2\u30c7\u30eb\u5fae\u8abf\u6574\u306e\u305f\u3081\u306e RAGAS \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u306e\u4f7f\u7528\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part5/5_1_rag_pipeline/#_2","title":"\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb","text":"<p>\u30c1\u30fc\u30e0\u306e\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba \u30ca\u30ec\u30c3\u30b8 Q&amp;A \u30b7\u30b9\u30c6\u30e0\u304c\u3064\u3044\u306b\u958b\u59cb\u3055\u308c\u307e\u3057\u305f\u3002 CEO \u306f\u8208\u596e\u6c17\u5473\u306b\u6b21\u306e\u3088\u3046\u306b\u5165\u529b\u3057\u307e\u3057\u305f\u3002\u300c2023 \u5e74\u7b2c 4 \u56db\u534a\u671f\u306e\u53ce\u76ca\u5831\u544a\u306b\u3088\u308b\u3068\u3001\u4e2d\u56fd\u6771\u90e8\u5730\u57df\u306e\u7d14\u5229\u76ca\u306f\u3044\u304f\u3089\u3067\u3059\u304b?\u300d</p> <p>\u30b7\u30b9\u30c6\u30e0\u306f\u81ea\u4fe1\u3092\u6301\u3063\u3066\u3053\u3046\u7b54\u3048\u307e\u3057\u305f\u3002\u300c\u30ec\u30dd\u30fc\u30c8\u306b\u3088\u308b\u3068\u3001\u7d14\u5229\u76ca\u306f 15% \u3067\u3059\u3002\u300d CEO \u306f\u7709\u3092\u3072\u305d\u3081\u307e\u3057\u305f\u3002\u300c\u79c1\u304c\u77e5\u308a\u305f\u3044\u306e\u306f\u5229\u76ca\u7387\u3067\u306f\u306a\u304f\u3001\u5177\u4f53\u7684\u306a\u91d1\u984d\u3067\u3059\u3002\u305d\u308c\u306f\u5168\u793e\u7684\u306a\u3082\u306e\u3067\u3042\u308a\u3001\u4e2d\u56fd\u6771\u90e8\u5730\u57df\u306e\u3082\u306e\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u300d</p> <p>\u30c7\u30fc\u30bf \u30ea\u30fc\u30c0\u30fc\u3068\u3057\u3066\u3001\u3042\u306a\u305f\u306f\u30ed\u30b0\u3092\u7dca\u6025\u306b\u8abf\u67fb\u3057\u3001\u30bd\u30fc\u30b9\u306b\u554f\u984c\u304c\u3042\u308b\u3053\u3068\u3092\u767a\u898b\u3057\u307e\u3057\u305f\u3002 1. \u89e3\u6790\u30a8\u30e9\u30fc: \u53ce\u76ca PDF \u306f 2 \u5217\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002\u901a\u5e38\u306e\u89e3\u6790\u30c4\u30fc\u30eb\u306f 1 \u884c\u305a\u3064\u8aad\u307f\u53d6\u308b\u305f\u3081\u3001\u5de6\u5217\u306e\u30c6\u30ad\u30b9\u30c8\u3068\u53f3\u5217\u306e\u30c7\u30fc\u30bf\u304c\u30de\u30fc\u30b8\u3055\u308c\u3001\u610f\u5473\u4e0a\u306e\u6df7\u4e71\u304c\u751f\u3058\u307e\u3059\u3002 2. \u8868\u306e\u640d\u5931: \u4e2d\u56fd\u6771\u90e8\u306e\u30c7\u30fc\u30bf\u306f\u30da\u30fc\u30b8\u3092\u307e\u305f\u3044\u3060\u8868\u306b\u3042\u308a\u307e\u3057\u305f\u3002\u89e3\u6790\u30c4\u30fc\u30eb\u306f\u30c6\u30fc\u30d6\u30eb\u69cb\u9020\u3092\u5b8c\u5168\u306b\u7121\u8996\u3057\u3001\u6587\u5b57\u5316\u3051\u3057\u305f\u6587\u5b57\u5217\u306b\u5909\u3048\u307e\u3057\u305f\u3002 3. \u30c1\u30e3\u30f3\u30af\u306e\u65ad\u7247\u5316: \u300c\u4e2d\u56fd\u6771\u90e8\u5730\u57df\u300d\u30d8\u30c3\u30c0\u30fc\u3068\u7279\u5b9a\u306e\u756a\u53f7\u304c\u7570\u306a\u308b\u30c1\u30e3\u30f3\u30af\u306b\u5206\u5272\u3055\u308c\u307e\u3057\u305f\u3002\u30d9\u30af\u30c8\u30eb\u691c\u7d22\u3067\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u95a2\u9023\u4ed8\u3051\u304c\u5931\u308f\u308c\u307e\u3057\u305f\u3002</p> <p>\u3053\u306e\u300c\u5931\u6557\u300d\u30b7\u30fc\u30f3\u306f\u3001Garbage In\u3001Garbage Out \u3068\u3044\u3046 RAG \u306e\u6b8b\u9177\u306a\u73fe\u5b9f\u3092\u660e\u3089\u304b\u306b\u3057\u307e\u3059\u3002\u30d7\u30ec\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u304c\u300c\u304a\u8179\u3044\u3063\u3071\u3044\u3054\u3061\u305d\u3046\u3092\u98df\u3079\u308b\u300d\u3053\u3068\u3060\u3068\u3059\u308c\u3070\u3001RAG\u306f\u300c\u7cbe\u5bc6\u306a\u624b\u8853\u300d\u3067\u3059\u3002\u30c7\u30fc\u30bf\u89e3\u6790\u306e\u9038\u8131\u306f\u3001\u53d6\u5f97\u304a\u3088\u3073\u751f\u6210\u306e\u6bb5\u968e\u3067\u7121\u9650\u306b\u5897\u5e45\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#121","title":"12.1 \u30c7\u30a3\u30fc\u30d7\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u89e3\u6790: \u975e\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u306e\u300c\u30e9\u30b9\u30c8\u30de\u30a4\u30eb\u300d\u3092\u514b\u670d\u3059\u308b","text":"<p>RAG \u30c7\u30fc\u30bf \u30d5\u30ed\u30fc\u3067\u6700\u3082\u51e6\u7406\u304c\u96e3\u3057\u3044\u306e\u306f\u3001\u591a\u304f\u306e\u5834\u5408\u3001\u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8\u3067\u306f\u306a\u304f\u3001\u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u306e\u4e2d\u6838\u77e5\u8b58\u3092\u542b\u3080 PDF\u3001PPT\u3001\u30b9\u30ad\u30e3\u30f3\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3067\u3059\u3002\u3053\u308c\u3089\u306e\u5f62\u5f0f\u306f\u300c\u4eba\u9593\u304c\u8aad\u3080\u300d\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u3066\u8a2d\u8a08\u3055\u308c\u3066\u304a\u308a\u3001\u6a5f\u68b0\u306b\u3068\u3063\u3066\u306f\u975e\u5e38\u306b\u4e0d\u89aa\u5207\u3067\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#1211-pdf","title":"12.1.1 \u8907\u96d1\u306a PDF \u51e6\u7406: \u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u4ee5\u4e0a\u306e\u3082\u306e","text":"<p>PDF \u306f\u672c\u8cea\u7684\u306b\u306f\u63cf\u753b\u547d\u4ee4\u306e\u30b3\u30ec\u30af\u30b7\u30e7\u30f3\u3067\u3042\u308a\u3001\u69cb\u9020\u5316\u30c7\u30fc\u30bf\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002\u901a\u5e38\u306e Python \u30e9\u30a4\u30d6\u30e9\u30ea (PyPDF2 \u306a\u3069) \u306f\u30c6\u30ad\u30b9\u30c8 \u30b9\u30c8\u30ea\u30fc\u30e0\u306e\u307f\u3092\u62bd\u51fa\u3067\u304d\u3001\u30ec\u30a4\u30a2\u30a6\u30c8\u60c5\u5831\u3092\u7406\u89e3\u3067\u304d\u307e\u305b\u3093\u3002</p> <p>\u554f\u984c\u70b9 1: \u8907\u6570\u5217\u30ec\u30a4\u30a2\u30a6\u30c8 \u5b66\u8853\u8ad6\u6587\u3084\u6280\u8853\u30de\u30cb\u30e5\u30a2\u30eb\u3067\u306f\u30012 \u6bb5\u307e\u305f\u306f 3 \u6bb5\u306e\u30ec\u30a4\u30a2\u30a6\u30c8\u304c\u4e00\u822c\u7684\u3067\u3059\u3002\u5358\u7d14\u306a\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u3067\u306f\u5217\u3092\u307e\u305f\u3044\u3067\u8aad\u307f\u53d6\u308a\u3001\u300c\u5de6\u5217\u306e\u6700\u521d\u306e\u884c + \u53f3\u5217\u306e\u6700\u521d\u306e\u884c\u300d\u306e\u3088\u3046\u306a\u7121\u610f\u5473\u306a\u9023\u7d50\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u3053\u308c\u3092\u89e3\u6c7a\u3059\u308b\u9375\u3068\u306a\u308b\u306e\u304c \u30ec\u30a4\u30a2\u30a6\u30c8\u5206\u6790 \u3067\u3059\u3002\u6700\u65b0\u306e\u30c4\u30fc\u30eb (Microsoft \u306e LayoutLM \u30b7\u30ea\u30fc\u30ba\u306a\u3069) \u306f\u3001\u30d3\u30b8\u30e7\u30f3 \u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u3001\u6700\u521d\u306b\u30ec\u30a4\u30a2\u30a6\u30c8 \u30d6\u30ed\u30c3\u30af\u3092\u8b58\u5225\u3057\u3001\u6b21\u306b\u8aad\u307f\u4e0a\u3052\u9806\u306b\u30c6\u30ad\u30b9\u30c8\u3092\u62bd\u51fa\u3057\u307e\u3059\u3002</p> <p>\u554f\u984c\u70b9 2: \u30c6\u30fc\u30d6\u30eb\u306e\u4fee\u5fa9 \u30c6\u30fc\u30d6\u30eb\u306f RAG \u306b\u3068\u3063\u3066\u60aa\u5922\u3067\u3059\u3002\u8868\u304c\u30c6\u30ad\u30b9\u30c8\u306b\u30d5\u30e9\u30c3\u30c8\u5316\u3055\u308c\u308b\u3068\u3001\u884c\u3068\u5217\u306e\u5bfe\u5fdc\u304c\u5931\u308f\u308c\u307e\u3059\u3002 * \u30eb\u30fc\u30eb\u30d9\u30fc\u30b9: PDF \u306e\u7dda\u63cf\u753b\u547d\u4ee4\u3092\u4f7f\u7528\u3057\u3066\u30b0\u30ea\u30c3\u30c9\u3092\u518d\u69cb\u7bc9\u3057\u307e\u3059 (\u4f8b: <code>pdfplumber</code>)\u3002\u30cd\u30a4\u30c6\u30a3\u30d6 PDF \u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002 * \u30d3\u30b8\u30e7\u30f3\u30d9\u30fc\u30b9: PDF \u3092\u753b\u50cf\u306b\u5909\u63db\u3057\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u691c\u51fa\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u3066\u30bb\u30eb\u69cb\u9020\u3092\u8b58\u5225\u3057\u3001\u30b3\u30f3\u30c6\u30f3\u30c4\u306e OCR \u3092\u7d50\u5408\u3057\u307e\u3059\u3002\u3053\u308c\u306f\u3001\u30b9\u30ad\u30e3\u30f3\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3068\u8907\u96d1\u306a\u30cd\u30b9\u30c8\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u306b\u5bfe\u3059\u308b\u552f\u4e00\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u3067\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#1212","title":"12.1.2 \u30d1\u30fc\u30b5\u30fc\u30c4\u30fc\u30eb\u306e\u9078\u629e\u306e\u6bd4\u8f03","text":"<p>\u8907\u96d1\u306a\u4f01\u696d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u76f4\u9762\u3059\u308b\u3068\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u7a2e\u985e\u3068\u4e88\u7b97\u306b\u57fa\u3065\u3044\u3066\u89e3\u6790\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> \u7279\u96c6 \u975e\u69cb\u9020\u5316 (\u30aa\u30fc\u30d7\u30f3\u30bd\u30fc\u30b9) LlamaParse (\u30d7\u30ed\u30d7\u30e9\u30a4\u30a8\u30bf\u30ea) PyPDF/PDFMiner (\u57fa\u672c) \u57fa\u672c\u539f\u5247 \u30eb\u30fc\u30eb\uff0b\u57fa\u672cOCR\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u30e2\u30c7\u30eb \u5927\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u30d3\u30b8\u30e7\u30f3\u7406\u89e3 (Vision LLM) \u57fa\u790e\u3068\u306a\u308b\u30c6\u30ad\u30b9\u30c8 \u30b9\u30c8\u30ea\u30fc\u30e0\u3092\u62bd\u51fa\u3059\u308b \u30c6\u30fc\u30d6\u30eb\u306e\u53d6\u308a\u6271\u3044 \u4e2d (\u30c6\u30fc\u30d6\u30eb\u9818\u57df\u3092\u8b58\u5225\u3067\u304d\u307e\u3059\u3002\u8907\u96d1\u306a\u30d8\u30c3\u30c0\u30fc\u306f\u6df7\u4e71\u3092\u62db\u304d\u3084\u3059\u3044) \u975e\u5e38\u306b\u5f37\u529b (Markdown \u30c6\u30fc\u30d6\u30eb\u3068\u3057\u3066\u518d\u69cb\u7bc9\u3055\u308c\u3001\u30bb\u30de\u30f3\u30c6\u30a3\u30af\u30b9\u304c\u4fdd\u6301\u3055\u308c\u307e\u3059) \u60aa\u3044 (\u884c/\u5217\u304c\u5b8c\u5168\u306b\u4e71\u308c\u3066\u3044\u308b) \u8907\u6570\u5217\u306e\u8a8d\u8b58 \u30b5\u30dd\u30fc\u30c8\u3042\u308a (\u691c\u51fa\u30e2\u30c7\u30eb\u30d9\u30fc\u30b9) \u30b5\u30dd\u30fc\u30c8\u3042\u308a (\u30cd\u30a4\u30c6\u30a3\u30d6 \u30ec\u30a4\u30a2\u30a6\u30c8\u306e\u7406\u89e3) \u30b5\u30dd\u30fc\u30c8\u3055\u308c\u3066\u3044\u307e\u305b\u3093 (\u5217\u9593\u306e\u8aad\u307f\u53d6\u308a) \u30b3\u30b9\u30c8 \u4f4e (\u30ed\u30fc\u30ab\u30eb \u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0) \u9ad8 (API \u30da\u30fc\u30b8\u3054\u3068\u306e\u8ab2\u91d1) \u975e\u5e38\u306b\u4f4e\u3044 \u4f7f\u7528\u4f8b \u30b7\u30f3\u30d7\u30eb\u306a Word/HTML\u3001\u30eb\u30fc\u30eb\u4fee\u6b63\u3055\u308c\u305f PDF \u8907\u96d1\u306a\u53ce\u76ca\u30ec\u30dd\u30fc\u30c8\u3001\u30b9\u30ad\u30e3\u30f3\u3055\u308c\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3001\u30cd\u30b9\u30c8\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb \u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8\u306e\u96fb\u5b50\u66f8\u7c4d <p>\u63a8\u5968\u4e8b\u9805: \u4e3b\u8981\u306a\u30d3\u30b8\u30cd\u30b9 \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (\u5951\u7d04\u66f8\u3001\u53ce\u76ca\u5831\u544a\u66f8) \u306b\u3064\u3044\u3066\u306f\u3001LlamaParse \u307e\u305f\u306f Azure Document Intelligence \u3092\u512a\u5148\u3057\u307e\u3059\u3002\u5927\u91cf\u306e\u901a\u5e38\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5834\u5408\u306f\u3001\u30b3\u30b9\u30c8\u3092\u524a\u6e1b\u3059\u308b\u305f\u3081\u306b\u975e\u69cb\u9020\u5316\u3092\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u306b\u4f7f\u7528\u3057\u307e\u3059\u3002</p> <p></p> <p>\u56f3 12-1: \u5f93\u6765\u306e\u89e3\u6790\u3068\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30c8\u89e3\u6790 \u2014\u2014 \u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30c8\u89e3\u6790\u306f\u3001\u30ec\u30a4\u30a2\u30a6\u30c8\u5206\u6790\u3092\u901a\u3058\u3066\u8907\u6570\u5217\u306e\u9806\u5e8f\u3068\u30c6\u30fc\u30d6\u30eb\u69cb\u9020\u3092\u4fdd\u6301\u3057\u307e\u3059</p>"},{"location":"ja/part5/5_1_rag_pipeline/#122-chunking","title":"12.2 Chunking\u6226\u7565: \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u53d6\u5f97\u306e\u7c92\u5ea6\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u53d6\u308b\u6280\u8853","text":"<p>\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092\u89e3\u6790\u3057\u305f\u5f8c\u3001\u305d\u308c\u3092\u30e2\u30c7\u30eb\u3067\u51e6\u7406\u53ef\u80fd\u306a\u30c1\u30e3\u30f3\u30af\u306b\u5206\u5272\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u30c1\u30e3\u30f3\u30af\u6226\u7565\u306f\u53d6\u5f97\u7cbe\u5ea6\u3092\u76f4\u63a5\u6c7a\u5b9a\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#1221","title":"12.2.1 \u57fa\u672c\u6226\u7565: \u518d\u5e30\u7684\u6587\u5b57\u5206\u5272","text":"<p>\u6700\u3082\u5358\u7d14\u306a\u65b9\u6cd5\u306f\u3001\u6587\u5b57\u6570\u3092\u56fa\u5b9a\u3057\u3066\u5206\u5272\u3059\u308b (\u305f\u3068\u3048\u3070\u3001500 \u6587\u5b57\u3054\u3068\u306b\u30ab\u30c3\u30c8\u3059\u308b) \u65b9\u6cd5\u3067\u3059\u3002\u3057\u304b\u3057\u3001\u3053\u308c\u306b\u3088\u308a\u3001\u5b8c\u5168\u306a\u6587\u3084\u8ad6\u7406\u7684\u306a\u6bb5\u843d\u304c\u534a\u5206\u306b\u306a\u3063\u3066\u3057\u307e\u3046\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002 \u518d\u5e30\u7684Chunking \u304c\u73fe\u5728\u306e\u30d9\u30fc\u30b9\u30e9\u30a4\u30f3\u3067\u3059\u3002\u533a\u5207\u308a\u6587\u5b57\u306e\u512a\u5148\u9806\u4f4d (\u4f8b: <code>\\n\\n</code> &gt; <code>\\n</code> &gt; <code>.</code> &gt; <code></code>) \u3092\u5b9a\u7fa9\u3057\u3001\u6bb5\u843d\u306e\u5206\u5272\u3092\u512a\u5148\u3057\u3001\u6b21\u306b\u6587\u306e\u5206\u5272\u3092\u512a\u5148\u3057\u307e\u3059\u3002\u3053\u308c\u306b\u3088\u308a\u3001\u610f\u5473\u4e0a\u306e\u6574\u5408\u6027\u304c\u53ef\u80fd\u306a\u9650\u308a\u7dad\u6301\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#1222","title":"12.2.2 \u9ad8\u5ea6\u306a\u6226\u7565: \u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u30c1\u30e3\u30f3\u30af\u5316","text":"<p>\u518d\u5e30\u7684\u306a\u30c1\u30e3\u30f3\u30af\u5316\u3067\u3082\u30012 \u3064\u306e\u6bb5\u843d\u304c\u540c\u3058\u30c8\u30d4\u30c3\u30af\u306b\u3064\u3044\u3066\u8aac\u660e\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b\u3092\u5224\u65ad\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002 \u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af Chunking \u306fEmbedding\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002 1. \u96a3\u63a5\u3059\u308b\u6587\u9593\u306e\u30d9\u30af\u30c8\u30eb\u985e\u4f3c\u5ea6\u3092\u8a08\u7b97\u3057\u307e\u3059\u3002 2. \u3057\u304d\u3044\u5024\u3092\u8a2d\u5b9a\u3057\u307e\u3059\u3002\u96a3\u63a5\u3059\u308b\u6587\u306e\u985e\u4f3c\u6027\u304c\u6025\u6fc0\u306b\u4f4e\u4e0b\u3057\u305f\u5834\u5408\uff08\u30c8\u30d4\u30c3\u30af\u30b7\u30d5\u30c8\uff09\u3001\u305d\u3053\u3067\u5206\u5272\u3057\u307e\u3059\u3002 \u3053\u306e\u65b9\u6cd5\u3067\u306f\u3001\u53ef\u5909\u9577\u306e\u30c1\u30e3\u30f3\u30af\u304c\u751f\u6210\u3055\u308c\u307e\u3059\u304c\u3001\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u7d14\u5ea6\u306f\u975e\u5e38\u306b\u9ad8\u304f\u3001\u300c1 \u3064\u306e\u30c1\u30e3\u30f3\u30af\u306b\u306f\u534a\u5206\u306e\u88fd\u54c1\u30a4\u30f3\u30c8\u30ed\u3068\u534a\u5206\u306e\u30a2\u30d5\u30bf\u30fc\u30bb\u30fc\u30eb\u30b9 \u30dd\u30ea\u30b7\u30fc\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u300d\u3068\u3044\u3046\u30ce\u30a4\u30ba\u304c\u56de\u907f\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#1223","title":"12.2.3 \u9ad8\u5ea6\u306a\u6226\u7565: \u89aa\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210","text":"<p>\u3053\u308c\u306f\u3001RAG \u306e \u300c\u691c\u7d22\u306e\u7c92\u5ea6\u300d\u3068\u300c\u751f\u6210\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u300d \u306e\u77db\u76fe\u3092\u89e3\u6c7a\u3059\u308b\u305f\u3081\u306e\u6700\u7d42\u5175\u5668\u3067\u3059\u3002 * \u77db\u76fe: \u30c1\u30e3\u30f3\u30af\u304c\u5c0f\u3055\u3044 = \u3088\u308a\u7126\u70b9\u3092\u7d5e\u3063\u305f\u30bb\u30de\u30f3\u30c6\u30a3\u30af\u30b9\u3001\u3088\u308a\u6b63\u78ba\u306a\u30d9\u30af\u30c8\u30eb\u691c\u7d22\u3002\u3057\u304b\u3057\u3001\u5c0f\u3055\u3059\u304e\u308b = \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u5931\u308f\u308c\u308b\u305f\u3081\u3001LLM \u306f\u5305\u62ec\u7684\u306a\u56de\u7b54\u3092\u751f\u6210\u3067\u304d\u307e\u305b\u3093\u3002 * \u89e3\u6c7a\u7b56:     1. \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u3092 \u5927\u304d\u306a\u30c1\u30e3\u30f3\u30af (\u89aa\u30c1\u30e3\u30f3\u30af) (\u4f8b: 1000 \u30c8\u30fc\u30af\u30f3) \u306b\u5206\u5272\u3057\u307e\u3059\u3002     2. \u5404\u5927\u304d\u306a\u30c1\u30e3\u30f3\u30af\u3092\u3055\u3089\u306b \u5c0f\u3055\u306a\u30c1\u30e3\u30f3\u30af (\u5b50\u30c1\u30e3\u30f3\u30af) (\u4f8b: 200 \u30c8\u30fc\u30af\u30f3) \u306b\u5206\u5272\u3057\u307e\u3059\u3002     3. \u5c0f\u3055\u306a\u30c1\u30e3\u30f3\u30af\u3092\u30d9\u30af\u30c8\u30eb\u5316\u3057\u3001\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3057\u307e\u3059\u3002     4. \u53d6\u5f97\u6642\u306b\u3001\u5c0f\u3055\u3044\u30c1\u30e3\u30f3\u30af\u3092\u7167\u5408\u3057\u307e\u3059\u304c\u3001\u7167\u5408\u3055\u308c\u305f\u5c0f\u3055\u3044\u30c1\u30e3\u30f3\u30af\u3092\u542b\u3080 \u5927\u304d\u3044\u30c1\u30e3\u30f3\u30af \u3092 LLM \u306b\u8fd4\u3057\u307e\u3059\u3002</p> <p>\u3053\u306e\u300c\u5c0f\u898f\u6a21\u304b\u3089\u5927\u898f\u6a21\u306a\u691c\u7d22\u300d\u6226\u7565 (\u5c0f\u898f\u6a21\u304b\u3089\u5927\u898f\u6a21\u306a\u691c\u7d22) \u306b\u3088\u308a\u3001\u751f\u6210\u306b\u5341\u5206\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u63d0\u4f9b\u3057\u306a\u304c\u3089\u691c\u7d22\u306e\u7cbe\u5ea6\u304c\u4fdd\u8a3c\u3055\u308c\u307e\u3059\u3002</p> <p></p> <p>\u56f3 12-2: \u89aa\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u30e1\u30ab\u30cb\u30ba\u30e0 \u2014\u2014 \u53d6\u5f97\u3055\u308c\u305f\u5b50\u30ce\u30fc\u30c9\u306f\u5b9f\u969b\u306b\u89aa\u30ce\u30fc\u30c9\u3092\u8fd4\u3057\u3001\u7cbe\u5ea6\u3068\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u3068\u308a\u307e\u3059</p>"},{"location":"ja/part5/5_1_rag_pipeline/#123","title":"12.3 \u30d9\u30af\u30c8\u30eb\u5316\u3068\u4fdd\u5b58: \u6559\u80b2\u6a5f\u68b0\u696d\u754c\u306e\u300c\u5c02\u9580\u7528\u8a9e\u300d","text":"<p>\u30c7\u30fc\u30bf\u306e\u30c1\u30e3\u30f3\u30af\u5316\u5f8c\u3001Embedding \u30e2\u30c7\u30eb\u3092\u4ecb\u3057\u3066\u30d9\u30af\u30c8\u30eb\u306b\u5909\u63db\u3057\u3001\u30d9\u30af\u30c8\u30eb \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u4fdd\u5b58\u3057\u307e\u3059\u3002\u3053\u306e\u6bb5\u968e\u3067\u306f\u3001\u4e00\u822c\u7684\u306a\u89e3\u6c7a\u7b56\u3067\u306f\u4e0d\u5341\u5206\u306a\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#1231-embedding","title":"12.3.1 Embedding\u30e2\u30c7\u30eb\u306e\u5fae\u8abf\u6574","text":"<p>\u4e00\u822c\u7684\u306aEmbedding\u30e2\u30c7\u30eb (OpenAI text-embedding-3 \u3084 BGE-M3 \u306a\u3069) \u306f\u3001\u4e00\u822c\u7684\u306a\u30b3\u30fc\u30d1\u30b9\u3067\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\u5782\u76f4\u30c9\u30e1\u30a4\u30f3\u3067\u306f\u3001\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u304c\u4f4e\u4e0b\u3059\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002 \u305f\u3068\u3048\u3070\u3001\u533b\u7642\u5206\u91ce\u3067\u306f\u3001\u300c\u98a8\u90aa\u300d\u3068\u300c\u767a\u71b1\u300d\u306f\u4e00\u822c\u7684\u306a\u610f\u5473\u3067\u306f\u610f\u5473\u7684\u306b\u8fd1\u3044\u3082\u306e\u3067\u3059\u304c\u3001\u8a3a\u65ad\u30ed\u30b8\u30c3\u30af\u3067\u306f\u307e\u3063\u305f\u304f\u7570\u306a\u308b\u75c5\u72b6\u3092\u6307\u3059\u5834\u5408\u304c\u3042\u308a\u307e\u3059\u3002 \u5fae\u8abf\u6574 \u306f\u3001\u30d9\u30af\u30c8\u30eb\u7a7a\u9593\u306e\u5206\u5e03\u3092\u8abf\u6574\u3057\u3066\u3001\u985e\u4f3c\u3057\u305f\u5c02\u9580\u7684\u306a\u6982\u5ff5\u304c\u3088\u308a\u8fd1\u304f\u306b\u96c6\u307e\u308b\u3088\u3046\u306b\u3059\u308b\u3053\u3068\u3092\u76ee\u7684\u3068\u3057\u3066\u3044\u307e\u3059\u3002\u901a\u5e38\u306f \u5bfe\u7167\u5b66\u7fd2 \u640d\u5931\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</p> \\[ L = - \\log \\frac{e^{sim(q, d^+)/\\tau}}{\\sum_{i} e^{sim(q, d^-_i)/\\tau}} \\] <p>\\(d^+\\) \u304c\u6b63 (\u6b63\u3057\u3044\u6587\u66f8) \u3067\u3042\u308b\u5834\u5408\u3001\\(d^-\\) \u306f\u8ca0 (\u9593\u9055\u3063\u305f\u6587\u66f8) \u3067\u3059\u3002\u5fae\u8abf\u6574\u7528\u306b\u300c\u30af\u30a8\u30ea\u95a2\u9023\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u300d\u306e\u30dd\u30b8\u30c6\u30a3\u30d6 \u30da\u30a2\u3068\u300c\u30af\u30a8\u30ea\u306b\u95a2\u9023\u3057\u306a\u3044\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u300d\u306e\u30cd\u30ac\u30c6\u30a3\u30d6 \u30da\u30a2\u3092\u69cb\u7bc9\u3059\u308b\u3053\u3068\u3067\u3001\u30c9\u30e1\u30a4\u30f3\u56fa\u6709\u306e\u691c\u7d22\u518d\u73fe\u7387\u3092\u5927\u5e45\u306b\u5411\u4e0a\u3055\u305b\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#1232","title":"12.3.2 \u30d9\u30af\u30c8\u30eb\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3068\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u691c\u7d22","text":"<p>\u30d9\u30af\u30c8\u30eb\u691c\u7d22 (Dense Retrieval) \u306e\u307f\u306b\u4f9d\u5b58\u3059\u308b\u3053\u3068\u306b\u306f\u6b20\u70b9\u304c\u3042\u308a\u307e\u3059\u3002\u56fa\u6709\u540d\u8a5e\u3001\u6b63\u78ba\u306a\u6570\u5024\u3001\u88fd\u54c1\u30e2\u30c7\u30eb\u3001\u30ad\u30fc\u30ef\u30fc\u30c9 \u30de\u30c3\u30c1\u30f3\u30b0\u306b\u5f71\u97ff\u3055\u308c\u307e\u305b\u3093\u3002 Enterprise RAG \u306f \u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u691c\u7d22 \u3092\u63a1\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 * \u30d9\u30af\u30c8\u30eb\u691c\u7d22: \u610f\u5473\u7684\u306a\u95a2\u9023\u6027\u3092\u30ad\u30e3\u30d7\u30c1\u30e3\u3057\u307e\u3059 (\u4f8b: \u300c\u30ea\u30f3\u30b4\u300d\u3068\u300c\u679c\u7269\u300d)\u3002 * \u30ad\u30fc\u30ef\u30fc\u30c9\u691c\u7d22 (BM25): \u5b8c\u5168\u4e00\u81f4\u3092\u53d6\u5f97\u3057\u307e\u3059 (\u4f8b: \u88fd\u54c1 ID\u300cA123-X\u300d)\u3002</p> <p>Reciprocal Rank Fusion (RRF) \u3092\u4f7f\u7528\u3057\u3066\u4e21\u65b9\u306e\u7d50\u679c\u3092\u518d\u30e9\u30f3\u30af\u4ed8\u3051\u3059\u308b\u3068\u3001\u5f37\u307f\u304c\u7d44\u307f\u5408\u308f\u3055\u308c\u307e\u3059\u3002\u3055\u3089\u306b\u3001\u30d9\u30af\u30c8\u30eb \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u9078\u629e (Milvus\u3001Pinecone\u3001Weaviate) \u3067\u306f\u3001\u8a08\u7b97\u3092\u5927\u5e45\u306b\u524a\u6e1b\u3059\u308b\u305f\u3081\u306b\u3001\u300cyear=2023\u300d\u306a\u3069\u306e\u4e8b\u524d\u53d6\u5f97\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306e\u30e1\u30bf\u30c7\u30fc\u30bf \u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u8003\u616e\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#124","title":"12.4 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u5b9f\u88c5: \u89aa\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u69cb\u7bc9","text":"<p>\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3001\u524d\u8ff0\u306e\u6838\u3068\u306a\u308b\u6226\u7565\u3067\u3042\u308b \u89aa\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210 \u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002 Python \u3092\u4f7f\u7528\u3057\u3066\u518d\u5229\u7528\u53ef\u80fd\u306a\u51e6\u7406\u30af\u30e9\u30b9\u3092\u5b9a\u7fa9\u3057\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u8aad\u307f\u8fbc\u307f\u304b\u3089\u30d9\u30af\u30bf\u30fc \u30b9\u30c8\u30ec\u30fc\u30b8\u307e\u3067\u306e\u30d7\u30ed\u30bb\u30b9\u5168\u4f53\u3092\u30b7\u30df\u30e5\u30ec\u30fc\u30c8\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#1241","title":"12.4.1 \u4f9d\u5b58\u95a2\u4fc2","text":"<pre><code>pip install langchain lancedb numpy unstructured\n</code></pre>"},{"location":"ja/part5/5_1_rag_pipeline/#1242","title":"12.4.2 \u30b3\u30a2\u30b3\u30fc\u30c9\u306e\u5185\u8a33","text":"<p>\u30d1\u30c3\u30b1\u30fc\u30b8\u5316\u3055\u308c\u305f\u9ad8\u30ec\u30d9\u30eb API \u3092\u76f4\u63a5\u547c\u3073\u51fa\u3059\u306e\u3067\u306f\u306a\u304f\u3001\u30ed\u30b8\u30c3\u30af\u3092\u5206\u89e3\u3057\u3066\u30c7\u30fc\u30bf \u30d5\u30ed\u30fc\u3092\u7406\u89e3\u3057\u307e\u3059\u3002</p> <pre><code>import uuid\nfrom typing import List, Dict, Any\nfrom dataclasses import dataclass\n\n@dataclass\nclass Document:\n    page_content: str\n    metadata: Dict[str, Any]\n    doc_id: str = None\n\nclass ParentChildIndexer:\n    \"\"\"\n    Implements Parent-Child Indexing strategy:\n    1. Parent Chunk: For storage and generation, preserves full context.\n    2. Child Chunk: For vectorization and retrieval, ensures semantic precision.\n    \"\"\"\n\n    def __init__(self, parent_chunk_size=1000, child_chunk_size=200):\n        self.parent_size = parent_chunk_size\n        self.child_size = child_chunk_size\n        # Simulate vector database (KV Store + Vector Store)\n        self.doc_store = {}  # Store Parent documents: {doc_id: content}\n        self.vector_index = [] # Store Child vectors: [(vector, parent_doc_id)]\n\n    def process_documents(self, raw_docs: List[Document]):\n        \"\"\"Step 1: Data processing pipeline\"\"\"\n        for doc in raw_docs:\n            # Generate unique ID\n            if not doc.doc_id:\n                doc.doc_id = str(uuid.uuid4())\n\n            # 1. Store Parent Document (KV Store)\n            self.doc_store[doc.doc_id] = doc\n\n            # 2. Generate Child Chunks\n            child_chunks = self._create_child_chunks(doc)\n\n            # 3. Vectorize and build index\n            self._index_children(child_chunks, doc.doc_id)\n\n    def _create_child_chunks(self, parent_doc: Document) -&gt; List[str]:\n        \"\"\"\n        Step 2: Chunking logic\n        Simplified to fixed character split here; production recommend RecursiveCharacterTextSplitter\n        \"\"\"\n        text = parent_doc.page_content\n        children = []\n        for i in range(0, len(text), self.child_size):\n            end = min(i + self.child_size, len(text))\n            children.append(text[i:end])\n        return children\n\n    def _index_children(self, children: List[str], parent_id: str):\n        \"\"\"Step 3: Vectorization logic (pseudocode)\"\"\"\n        for child_text in children:\n            # Simulate Embedding process\n            # vector = embedding_model.encode(child_text) \n            vector = [0.1, 0.2] # Placeholder\n\n            # Key: Store Parent ID in Child metadata\n            self.vector_index.append({\n                \"vec\": vector,\n                \"text\": child_text,\n                \"parent_id\": parent_id\n            })\n\n    def retrieve(self, query: str) -&gt; List[Document]:\n        \"\"\"\n        Step 4: Retrieval logic (Small-to-Big)\n        Retrieve matching Child -&gt; Return Parent\n        \"\"\"\n        # 1. Vector retrieval finds Top-K Children (simulated)\n        # top_children = vector_db.search(query)\n        # Note: Example only; should sort by vector similarity\n        top_child = self.vector_index[0] # Assume first match\n\n        # 2. Trace back to Parent\n        parent_id = top_child[\"parent_id\"]\n        parent_doc = self.doc_store.get(parent_id)\n\n        print(f\"Retrieved chunk: {top_child['text'][:20]}...\")\n        print(f\"Traced parent doc ID: {parent_id}\")\n        return [parent_doc]\n\n# --- Usage Example ---\nindexer = ParentChildIndexer()\ndoc = Document(page_content=\"RAG system core lies in data quality...\" * 50, metadata={\"source\": \"manual.pdf\"})\nindexer.process_documents([doc])\nresult = indexer.retrieve(\"data quality\")\n</code></pre>"},{"location":"ja/part5/5_1_rag_pipeline/#1243","title":"12.4.3 \u30d7\u30ed\u306e\u30d2\u30f3\u30c8","text":"<p>\ud83d\udca1 \u30d2\u30f3\u30c8: ID \u7ba1\u7406\u306f\u91cd\u8981\u3067\u3059 \u904b\u7528\u74b0\u5883\u3067\u306f\u3001<code>doc_id</code> \u306f\u6c7a\u5b9a\u7684\u3067\u3042\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 (\u4f8b: <code>hash(file_path + update_time)</code>)\u3002\u305d\u3046\u3057\u306a\u3044\u3068\u3001\u30bd\u30fc\u30b9 \u30d5\u30a1\u30a4\u30eb\u304c\u66f4\u65b0\u3055\u308c\u3066\u518d\u5b9f\u884c\u3055\u308c\u308b\u3068\u3001\u30d9\u30af\u30bf\u30fc \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306b\u524a\u9664\u3067\u304d\u306a\u3044\u5927\u91cf\u306e\u300c\u30be\u30f3\u30d3 \u30c1\u30e3\u30f3\u30af\u300d\u304c\u84c4\u7a4d\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#125","title":"12.5 \u6027\u80fd\u3068\u8a55\u4fa1 (\u6027\u80fd\u3068\u8a55\u4fa1)","text":"<p>RAG \u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306f\u5358\u306b\u300c\u56de\u7b54\u306e\u7cbe\u5ea6\u300d\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u69cb\u7bc9\u30b3\u30b9\u30c8\u3084\u53d6\u5f97\u306e\u5f85\u3061\u6642\u9593\u3082\u542b\u307e\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#1251","title":"12.5.1 \u8a55\u4fa1\u6307\u6a19","text":"\u30e1\u30c8\u30ea\u30c3\u30af \u8aac\u660e \u5bfe\u8c61\uff08\u53c2\u8003\uff09 \u30d2\u30c3\u30c8\u7387 (Recall@K) \u6b63\u89e3\u3092\u542b\u3080\u4e0a\u4f4d K \u4ef6\u306e\u691c\u7d22\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u5272\u5408 &gt; 85% MRR (\u5e73\u5747\u9006\u9806\u4f4d) \u691c\u7d22\u30ea\u30b9\u30c8\u5185\u306e\u6b63\u3057\u3044\u6587\u66f8\u306e\u91cd\u307f\u4ed8\u3051\u30e9\u30f3\u30ad\u30f3\u30b0 &gt; 0.7 \u5fe0\u5b9f\u3055 \u751f\u6210\u3055\u308c\u305f\u56de\u7b54\u304c\u3001\u53d6\u5f97\u3055\u308c\u305f\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3092\u5fe0\u5b9f\u306b\u53cd\u6620\u3057\u3066\u3044\u308b\u304b\u3069\u3046\u304b (\u5e7b\u899a\u9632\u6b62) &gt; 90% (RAGAS \u30d9\u30fc\u30b9)"},{"location":"ja/part5/5_1_rag_pipeline/#1252","title":"12.5.2 \u30d9\u30f3\u30c1\u30de\u30fc\u30af","text":"<p>\u30b5\u30fc\u30d0\u30fc (\u30c7\u30e5\u30a2\u30eb Xeon 6226R + 1x RTX 3090) \u3067 10,000 \u30da\u30fc\u30b8\u306e PDF \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (\u30c6\u30ad\u30b9\u30c8\u3068\u8868\u304c\u6df7\u5728) \u3092\u30c6\u30b9\u30c8\u3057\u307e\u3057\u305f\u3002</p> <ul> <li>\u89e3\u6790\u6642\u9593 (\u975e\u69cb\u9020\u5316):      \u203bCPU\u306e\u307f\uff1a28\u5206<ul> <li>GPU \u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3 (OCR): 11 \u5206 (2.5 \u500d\u306e\u9ad8\u901f\u5316)</li> </ul> </li> <li>\u53d6\u5f97\u30ec\u30a4\u30c6\u30f3\u30b7 (10M \u30d9\u30af\u30c8\u30eb):<ul> <li>Pure Dense \u53d6\u5f97: 9ms</li> <li>\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u53d6\u5f97 (\u5bc6 + \u30b9\u30d1\u30fc\u30b9 + RRF): 45 \u30df\u30ea\u79d2</li> <li>\u7d50\u8ad6: \u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u53d6\u5f97\u306b\u3088\u308a\u30ec\u30a4\u30c6\u30f3\u30b7\u30fc\u304c\u5897\u52a0\u3057\u307e\u3059\u304c\u3001\u9ad8\u7cbe\u5ea6\u306e\u30b7\u30ca\u30ea\u30aa (\u5951\u7d04\u30ec\u30d3\u30e5\u30fc\u306a\u3069) \u3067\u306f\u300136 \u30df\u30ea\u79d2\u306e\u8ffd\u52a0\u30aa\u30fc\u30d0\u30fc\u30d8\u30c3\u30c9\u306f\u5341\u5206\u306b\u4fa1\u5024\u304c\u3042\u308a\u307e\u3059\u3002</li> </ul> </li> </ul>"},{"location":"ja/part5/5_1_rag_pipeline/#126","title":"12.6 \u3088\u304f\u3042\u308b\u8aa4\u89e3\u3068\u843d\u3068\u3057\u7a74","text":""},{"location":"ja/part5/5_1_rag_pipeline/#1-pdf-pypdf","title":"\u8aa4\u89e3 1: \u300cPDF \u306e\u89e3\u6790\u306b\u306f PyPDF \u3067\u5341\u5206\u3067\u3042\u308b\u300d","text":"<p>\u591a\u304f\u306e\u521d\u5fc3\u8005\u306f PDF \u306e\u8907\u96d1\u3055\u3092\u904e\u5c0f\u8a55\u4fa1\u3057\u3066\u3044\u307e\u3059\u3002\u30c1\u30e3\u30fc\u30c8\u3084\u8907\u6570\u306e\u5217\u3092\u542b\u3080\u53ce\u76ca\u30ec\u30dd\u30fc\u30c8\u3084\u30de\u30cb\u30e5\u30a2\u30eb\u306e\u5834\u5408\u3001\u5358\u7d14\u306a\u30c6\u30ad\u30b9\u30c8\u62bd\u51fa\u3067\u306f\u91cd\u5927\u306a\u60c5\u5831\u640d\u5931\u304c\u767a\u751f\u3057\u307e\u3059\u3002\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u958b\u59cb\u6642\u306b\u30ec\u30a4\u30a2\u30a6\u30c8\u5206\u6790\u30c4\u30fc\u30eb\u3092\u5c0e\u5165\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#2","title":"\u8aa4\u89e3 2: \u300c\u30c1\u30e3\u30f3\u30af\u306f\u5c0f\u3055\u3044\u65b9\u304c\u826f\u3044\u300d","text":"<p>\u30c1\u30e3\u30f3\u30af\u304c\u5c0f\u3055\u3059\u304e\u308b\u3068\u3001\u691c\u7d22\u306e\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u6027\u306f\u5411\u4e0a\u3057\u307e\u3059\u304c\u3001\u300c\u6587\u8108\u304b\u3089\u5916\u308c\u300d\u307e\u3059\u3002 LLM \u306b\u306f\u3001\u6b63\u3057\u3044\u7b54\u3048\u3092\u63a8\u6e2c\u3059\u308b\u305f\u3081\u306e\u5341\u5206\u306a\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u304c\u3042\u308a\u307e\u305b\u3093\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#3","title":"\u8aa4\u89e3 3: \u300c\u30e1\u30bf\u30c7\u30fc\u30bf\u3092\u7121\u8996\u3059\u308b\u300d","text":"<p>\u30e1\u30bf\u30c7\u30fc\u30bf (\u30d5\u30a1\u30a4\u30eb\u540d\u3001\u30da\u30fc\u30b8\u756a\u53f7\u3001\u767a\u884c\u65e5) \u306a\u3057\u3067\u30c6\u30ad\u30b9\u30c8 \u30d9\u30af\u30c8\u30eb\u306e\u307f\u3092\u4fdd\u5b58\u3059\u308b\u3068\u3001\u6642\u9593\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3084\u30bd\u30fc\u30b9 \u30c8\u30ec\u30fc\u30b9\u304c\u3067\u304d\u306a\u304f\u306a\u308a\u3001\u30b7\u30b9\u30c6\u30e0\u306e\u4f7f\u3044\u3084\u3059\u3055\u304c\u4f4e\u4e0b\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_1_rag_pipeline/#_3","title":"\u7ae0\u306e\u6982\u8981","text":"<p>RAG \u306e\u6838\u3068\u306a\u308b\u7af6\u4e89\u529b\u306f\u30c7\u30fc\u30bf\u51e6\u7406\u306e\u7cbe\u5ea6\u306b\u3042\u308a\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001RAG \u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e 3 \u3064\u306e\u4e3b\u8981\u306a\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\u3092\u89e3\u6790\u3057\u307e\u3057\u305f\u3002 1. \u89e3\u6790\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8: \u6587\u66f8\u69cb\u9020\u3092\u8996\u899a\u7684\u306a\u30ec\u30d9\u30eb\u3067\u7406\u89e3\u3057\u3001\u8868\u3084\u8907\u6570\u5217\u306e\u554f\u984c\u3092\u89e3\u6c7a\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 2. Chunking \u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8: \u5358\u4e00\u306e\u56fa\u5b9a\u5206\u5272\u3092\u8d85\u3048\u3066\u79fb\u52d5\u3057\u307e\u3059\u3002\u89aa\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4ed8\u3051\u307e\u305f\u306f\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af Chunking\u3092\u63a1\u7528\u3057\u3066\u3001\u53d6\u5f97\u7cbe\u5ea6\u3068\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u6574\u5408\u6027\u306e\u30d0\u30e9\u30f3\u30b9\u3092\u3068\u308a\u307e\u3059\u3002 3. \u53d6\u5f97\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8: \u5fae\u8abf\u6574\u3092\u901a\u3058\u3066Embedding\u30e2\u30c7\u30eb\u3092\u30c9\u30e1\u30a4\u30f3\u77e5\u8b58\u306b\u9069\u5fdc\u3055\u305b\u307e\u3059\u3002\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u691c\u7d22\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3001\u30d9\u30af\u30c8\u30eb \u30de\u30c3\u30c1\u30f3\u30b0\u306e\u5236\u9650\u3092\u88dc\u3044\u307e\u3059\u3002</p> <p>\u3053\u308c\u3089\u3092\u5c0e\u5165\u3059\u308b\u3068\u3001RAG \u30b7\u30b9\u30c6\u30e0\u306f\u300c\u4f7f\u3048\u308b\u300d\u304b\u3089\u300c\u5f79\u306b\u7acb\u3064\u300d\u306b\u9032\u5316\u3057\u307e\u3059\u3002</p> <p></p> <p>\u56f3 12-3: \u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba RAG \u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 \u2014\u2014 \u975e\u69cb\u9020\u5316\u89e3\u6790\u304b\u3089\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9\u691c\u7d22\u307e\u3067\u306e\u30d5\u30eb\u30d5\u30ed\u30fc\u306e\u6700\u9069\u5316\u3092\u91cd\u8996</p>"},{"location":"ja/part5/5_1_rag_pipeline/#_4","title":"\u3055\u3089\u306b\u8aad\u3080","text":"<p>\u30c4\u30fc\u30eb\u3068\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af * LlamaIndex: \u73fe\u5728\u6700\u3082\u5148\u9032\u7684\u306a RAG \u30c7\u30fc\u30bf \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3002\u8c4a\u5bcc\u306a\u30c7\u30fc\u30bf\u30ed\u30fc\u30c0\u30fc\u3068\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u6226\u7565 (\u89aa\u5b50\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u3092\u542b\u3080)\u3002 * RAGAS: RAG \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u3092\u8a55\u4fa1\u3059\u308b\u305f\u3081\u306e\u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3002\u53d6\u5f97\u306e\u7cbe\u5ea6\u3068\u751f\u6210\u306e\u5fe0\u5b9f\u6027\u306b\u91cd\u70b9\u3092\u7f6e\u3044\u3066\u3044\u307e\u3059\u3002</p> <p>\u30b3\u30a2\u30da\u30fc\u30d1\u30fc * Lewis et al. \u306e 2020 Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks \u306f\u3001RAG \u306e\u57fa\u790e\u7684\u306a\u7814\u7a76\u3067\u3059\u3002 * Karpukhin \u3089\u306e Dense Passage Retrieval for Open-Domain Question Answering (DPR) \u306f\u3001\u73fe\u4ee3\u306e\u30c7\u30e5\u30a2\u30eb\u30bf\u30ef\u30fc \u30d9\u30af\u30c8\u30eb\u691c\u7d22\u306e\u57fa\u790e\u3092\u7bc9\u304d\u307e\u3057\u305f\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/","title":"\u7b2c13\u7ae0: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30ebRAG","text":""},{"location":"ja/part5/5_2_mm_rag/#13-rag","title":"\u7b2c 13 \u7ae0: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb RAG","text":""},{"location":"ja/part5/5_2_mm_rag/#_1","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u30c6\u30ad\u30b9\u30c8 RAG \u7af6\u4e89\u304c\u6700\u9ad8\u6f6e\u306b\u9054\u3059\u308b\u4e2d\u3001\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u304c\u65b0\u305f\u306a\u6226\u5834\u3068\u306a\u3063\u3066\u3044\u307e\u3059\u3002\u4f01\u696d\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306b\u306f\u3001\u5927\u91cf\u306e\u30c1\u30e3\u30fc\u30c8\u3001\u30d5\u30ed\u30fc\u30c1\u30e3\u30fc\u30c8\u3001\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u304c\u542b\u307e\u308c\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u5f93\u6765\u306e RAG \u3067\u306f\u901a\u5e38\u3001\u30c6\u30ad\u30b9\u30c8\u3078\u306e OCR \u3092\u9078\u629e\u3059\u308b\u304b\u3001\u753b\u50cf\u3092\u7121\u8996\u3059\u308b\u305f\u3081\u3001\u91cd\u8981\u306a\u60c5\u5831\u304c\u5931\u308f\u308c\u307e\u3059\u3002\u3053\u306e\u7ae0\u3067\u306f\u3001\u300c\u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8\u300d\u306e\u5236\u9650\u3092\u6253\u3061\u7834\u3063\u3066\u3001\u30c7\u30fc\u30bf\u3092\u300c\u898b\u308b\u300d\u3053\u3068\u304c\u3067\u304d\u308b\u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\u57fa\u672c\u7684\u306a CLIP/SigLIP \u30af\u30ed\u30b9\u30e2\u30fc\u30c0\u30eb\u53d6\u5f97\u304b\u3089\u958b\u59cb\u3057\u3001\u7834\u58ca\u7684\u306a ColPali \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u6398\u308a\u4e0b\u3052\u3001\u30d0\u30a4\u30ca\u30ea\u91cf\u5b50\u5316 (BQ) \u3084 Late Interaction \u30b9\u30b3\u30a2\u30ea\u30f3\u30b0 \u30ed\u30b8\u30c3\u30af\u3092\u542b\u3080\u30a8\u30f3\u30c9\u30c4\u30fc\u30a8\u30f3\u30c9\u306e\u53d6\u5f97\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#130","title":"13.0 \u5b66\u7fd2\u76ee\u6a19","text":"<ul> <li>\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30d9\u30af\u30c8\u30eb\u7a7a\u9593\u3092\u7406\u89e3\u3059\u308b: CLIP \u3068 SigLIP \u306e\u5bfe\u7167\u7684\u306a\u640d\u5931\u539f\u7406\u3092\u30de\u30b9\u30bf\u30fc\u3057\u307e\u3059\u3002\u30c6\u30ad\u30b9\u30c8\u3068\u753b\u50cf\u304c\u540c\u3058\u30d9\u30af\u30c8\u30eb\u7a7a\u9593\u5185\u3067\u3069\u306e\u3088\u3046\u306b\u914d\u7f6e\u3055\u308c\u308b\u304b\u3092\u7406\u89e3\u3057\u307e\u3059\u3002</li> <li>\u30de\u30b9\u30bf\u30fc ColPali \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3: Late Interaction \u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u7406\u89e3\u3057\u307e\u3059\u3002\u8907\u96d1\u306a PDF \u306e\u8868\u3084\u30b0\u30e9\u30d5\u306b <code>colpali-v1.2-merged</code> \u3092\u4f7f\u7528\u3059\u308b\u65b9\u6cd5\u3092\u5b66\u3073\u307e\u3059\u3002</li> <li>\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u6a5f\u80fd: MaxSim \u30b9\u30b3\u30a2\u30ea\u30f3\u30b0 \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u5b9f\u88c5\u3059\u308b Python \u30b3\u30fc\u30c9\u3092\u4f5c\u6210\u3057\u3001\u30d0\u30a4\u30ca\u30ea\u91cf\u5b50\u5316\u3092\u4f7f\u7528\u3057\u3066\u30b9\u30c8\u30ec\u30fc\u30b8 \u30b3\u30b9\u30c8\u3092 32 \u5206\u306e 1 \u306b\u524a\u6e1b\u3057\u307e\u3059\u3002</li> <li>\u8996\u899a\u5316\u691c\u8a3c: \u30a2\u30c6\u30f3\u30b7\u30e7\u30f3 \u30d2\u30fc\u30c8\u30de\u30c3\u30d7\u3092\u901a\u3058\u3066\u30e2\u30c7\u30eb\u306e\u89e3\u91c8\u53ef\u80fd\u6027\u3092\u691c\u8a3c\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part5/5_2_mm_rag/#_2","title":"\u30b7\u30ca\u30ea\u30aa\u306e\u7d39\u4ecb","text":"<p>\u3042\u306a\u305f\u306f\u534a\u5c0e\u4f53\u88c5\u7f6e\u306e\u4fee\u7406\u77e5\u8b58\u30d9\u30fc\u30b9\u3092\u7dad\u6301\u3057\u3066\u3044\u307e\u3059\u3002\u6280\u8853\u30de\u30cb\u30e5\u30a2\u30eb\u306b\u306f\u8907\u96d1\u306a\u56de\u8def\u56f3\u3084\u30c7\u30d0\u30a4\u30b9\u69cb\u9020\u56f3\u304c\u6e80\u8f09\u3067\u3059\u3002 \u30d5\u30a3\u30fc\u30eb\u30c9 \u30a8\u30f3\u30b8\u30cb\u30a2\u306f\u300c\u300e\u30e1\u30a4\u30f3\u30dc\u30fc\u30c9\u96fb\u6e90\u30e2\u30b8\u30e5\u30fc\u30eb\u300f\u306e\u914d\u7dda\u56f3\u3092\u898b\u3064\u3051\u308b\u306e\u3092\u624b\u4f1d\u3063\u3066\u304f\u3060\u3055\u3044\u300d\u3068\u8981\u6c42\u3057\u3066\u3044\u307e\u3059\u3002</p> <ul> <li>\u5f93\u6765\u306e RAG (\u30c6\u30ad\u30b9\u30c8\u306e\u307f): \u300c\u30e1\u30a4\u30f3\u30dc\u30fc\u30c9\u306e\u96fb\u6e90\u306f\u56f3 3-12 \u3092\u53c2\u7167\u3057\u3066\u304f\u3060\u3055\u3044\u300d\u3068\u3044\u3046\u30c6\u30ad\u30b9\u30c8\u8aac\u660e\u304c\u53d6\u5f97\u3055\u308c\u307e\u3057\u305f\u304c\u3001\u30b7\u30b9\u30c6\u30e0\u304c\u753b\u50cf\u3092\u8fd4\u305b\u306a\u3044\u304b\u3001OCR \u306b\u3088\u3063\u3066\u56de\u8def\u56f3\u304c\u6587\u5b57\u5316\u3051 (\u4f8b: <code>---||---</code>) \u306b\u306a\u308a\u3001\u30a8\u30f3\u30b8\u30cb\u30a2\u306f\u30c6\u30ad\u30b9\u30c8\u3092\u7121\u529b\u306b\u898b\u3064\u3081\u308b\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002</li> <li>\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb RAG: \u30b7\u30b9\u30c6\u30e0\u306f\u30e6\u30fc\u30b6\u30fc\u306e\u30c6\u30ad\u30b9\u30c8\u306e\u610f\u56f3\u3092\u7406\u89e3\u3059\u308b\u3060\u3051\u3067\u306a\u304f\u3001\u56de\u8def\u56f3\u3092\u542b\u3080 PDF \u30da\u30fc\u30b8\u306e\u30b9\u30af\u30ea\u30fc\u30f3\u30b7\u30e7\u30c3\u30c8\u3092\u76f4\u63a5\u53d6\u5f97\u3057\u3001\u96fb\u6e90\u30e2\u30b8\u30e5\u30fc\u30eb\u9818\u57df\u3092 \u6b63\u78ba\u306b\u30cf\u30a4\u30e9\u30a4\u30c8\u3057\u307e\u3059\u3002</li> </ul> <p>\u3053\u308c\u306f\u300c\u8aad\u3080\u300d\u304b\u3089\u300c\u898b\u308b\u300d\u3078\u306e\u8cea\u7684\u98db\u8e8d\u3067\u3059\u3002\u591a\u304f\u306e\u7523\u696d\u304a\u3088\u3073\u91d1\u878d\u30b7\u30ca\u30ea\u30aa\u3067\u306f\u30011 \u3064\u306e\u753b\u50cf\u306e\u60c5\u5831\u5bc6\u5ea6\u306f 1,000 \u30ef\u30fc\u30c9\u3092\u306f\u308b\u304b\u306b\u8d85\u3048\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#131","title":"13.1 \u30af\u30ed\u30b9\u30e2\u30fc\u30c0\u30eb\u691c\u7d22: \u30c6\u30ad\u30b9\u30c8\u3068\u753b\u50cf\u306e\u969c\u58c1\u3092\u6253\u3061\u7834\u308b","text":"<p>\u300c\u30c6\u30ad\u30b9\u30c8\u304b\u3089\u753b\u50cf\u3078\u306e\u691c\u7d22\u300d\u307e\u305f\u306f\u300c\u753b\u50cf\u304b\u3089\u30c6\u30ad\u30b9\u30c8\u3078\u306e\u691c\u7d22\u300d\u3092\u5b9f\u73fe\u3059\u308b\u306b\u306f\u3001\u4e21\u65b9\u306e\u30e2\u30c0\u30ea\u30c6\u30a3\u3092\u7406\u89e3\u3059\u308b\u30e2\u30c7\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#1311","title":"13.1.1 \u57fa\u672c\u539f\u5247: \u5bfe\u7167\u5b66\u7fd2","text":"<p>OpenAI \u306e CLIP (Contrastive Language-Image Pre-training) \u304c\u57fa\u790e\u3068\u306a\u308a\u307e\u3059\u3002\u305d\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30ed\u30b8\u30c3\u30af\u306f\u30b7\u30f3\u30d7\u30eb\u304b\u3064\u6b8b\u9177\u3067\u3059\u3002 1. \u6570\u5104\u306e\uff08\u753b\u50cf\u3001\u30c6\u30ad\u30b9\u30c8\uff09\u30da\u30a2\u3092\u53ce\u96c6\u3057\u307e\u3059\u3002 2. \u753b\u50cf\u30a8\u30f3\u30b3\u30fc\u30c0\u30fc\u3068\u30c6\u30ad\u30b9\u30c8\u30a8\u30f3\u30b3\u30fc\u30c0\u30fc\u3092\u4ecb\u3057\u3066\u30d9\u30af\u30c8\u30eb\u3092\u62bd\u51fa\u3057\u307e\u3059\u3002 3. \u4e00\u81f4\u3059\u308b\u30da\u30a2\u306e\u30d9\u30af\u30c8\u30eb\u3092 \u5f15\u304d\u5bc4\u305b\u3001\u4e00\u81f4\u3057\u306a\u3044\u30da\u30a2\u3092 \u62bc\u3057\u307e\u3059\u3002</p> <p>\u7d50\u679c: \u300c\u72ac\u300d\u306e\u5199\u771f\u30d9\u30af\u30c8\u30eb\u3068\u300c\u72ac\u300d\u306e\u30c6\u30ad\u30b9\u30c8 \u30d9\u30af\u30c8\u30eb\u306f\u3001\u6570\u5b66\u7684\u306b\u7a7a\u9593\u7684\u306b\u975e\u5e38\u306b\u8fd1\u304f\u306a\u308a\u307e\u3059\u3002</p> <p></p> <p>\u56f3 13-1: CLIP \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3 \u2014\u2014 \u30c6\u30ad\u30b9\u30c8\u3068\u753b\u50cf\u306f\u540c\u3058\u9ad8\u6b21\u5143\u306e\u7403\u4f53\u306b\u30de\u30c3\u30d4\u30f3\u30b0\u3055\u308c\u307e\u3059\u3002\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u6027\u304c\u95a2\u9023\u6027\u3092\u6c7a\u5b9a\u3057\u307e\u3059</p>"},{"location":"ja/part5/5_2_mm_rag/#1312-clip-siglip","title":"13.1.2 \u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u306e\u9078\u629e: CLIP \u3068 SigLIP","text":"<p>CLIP \u304c\u6700\u3082\u6709\u540d\u3067\u3059\u304c\u3001\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306b\u95a2\u3057\u3066\u306f\u3001\u3088\u308a\u826f\u3044\u9078\u629e\u80a2\u304c\u3042\u308a\u307e\u3059\u3002 Google \u306e SigLIP (\u8a00\u8a9e\u753b\u50cf\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u7528\u30b7\u30b0\u30e2\u30a4\u30c9\u640d\u5931) \u306f\u3001\u8907\u6570\u306e\u6307\u6a19\u3067 CLIP \u3092\u4e0a\u56de\u3063\u3066\u3044\u307e\u3059\u3002</p> \u7279\u96c6 OpenAI\u30af\u30ea\u30c3\u30d7 Google SigLIP \u5efa\u7bc9\u5bb6\u306e\u63a8\u85a6 \u640d\u5931\u95a2\u6570 Softmax (\u30b0\u30ed\u30fc\u30d0\u30eb\u6b63\u898f\u5316) \u30b7\u30b0\u30e2\u30a4\u30c9 (\u72ec\u7acb\u3057\u305f\u4e8c\u9805\u5206\u985e) Sigmoid \u306f\u30e1\u30e2\u30ea\u52b9\u7387\u304c\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002\u5927\u898f\u6a21\u306a\u30d0\u30c3\u30c1\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u9069\u3057\u3066\u3044\u307e\u3059 \u4e2d\u56fd\u8a9e\u30b5\u30dd\u30fc\u30c8 \u82e6\u624b\uff08\u4e3b\u306b\u82f1\u8a9e\uff09 \u3088\u308a\u826f\u3044 (\u591a\u8a00\u8a9e\u30d0\u30fc\u30b8\u30e7\u30f3) \u591a\u8a00\u8a9e\u30c1\u30a7\u30c3\u30af\u30dd\u30a4\u30f3\u30c8\u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059 \u89e3\u6c7a\u7b56 \u901a\u5e38\u306f 224x224 \u52d5\u7684\u89e3\u50cf\u5ea6\u3092\u30b5\u30dd\u30fc\u30c8 \u8907\u96d1\u306a\u30c1\u30e3\u30fc\u30c8\u306b\u306f\u9ad8\u89e3\u50cf\u5ea6 (384+) \u30e2\u30c7\u30eb\u3092\u9078\u629e <p>\u63a8\u5968\u4e8b\u9805: 2025 \u5e74\u306e\u65b0\u3057\u3044\u30b7\u30b9\u30c6\u30e0\u306e\u5834\u5408\u306f\u3001SigLIP \u307e\u305f\u306f Meta \u306e DINOv2 (\u5f37\u529b\u306a\u7d14\u7c8b\u306a\u30d3\u30b8\u30e5\u30a2\u30eb\u6a5f\u80fd) \u3092\u512a\u5148\u3057\u3066\u304f\u3060\u3055\u3044\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#132-colpali-ocr","title":"13.2 ColPali \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306e\u5b9f\u8df5: OCR \u306e\u60aa\u5922\u306b\u7d42\u6b62\u7b26\u3092\u6253\u3064","text":"<p>PDF \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u691c\u7d22\u306b\u95a2\u3057\u3066\u306f\u3001CLIP \u306b\u306f\u81f4\u547d\u7684\u306a\u5f31\u70b9\u304c\u3042\u308a\u307e\u3059\u3002CLIP \u306f\u81ea\u7136\u753b\u50cf (\u732b\u3001\u72ac\u3001\u98a8\u666f) \u306b\u306f\u512a\u308c\u3066\u3044\u307e\u3059\u304c\u3001\u30ea\u30c3\u30c1\u30c6\u30ad\u30b9\u30c8\u753b\u50cf (\u30c6\u30ad\u30b9\u30c8\u304c\u5bc6\u96c6\u3057\u305f\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u30da\u30fc\u30b8\u3001\u8868) \u306b\u3064\u3044\u3066\u306f\u3042\u307e\u308a\u7406\u89e3\u3067\u304d\u307e\u305b\u3093\u3002 \u5f93\u6765\u306e\u30a2\u30d7\u30ed\u30fc\u30c1\u306f <code>PDF -&gt; OCR -&gt; Text Embedding</code> \u3067\u3059\u304c\u3001OCR \u3067\u306f\u30ec\u30a4\u30a2\u30a6\u30c8\u60c5\u5831\u304c\u5931\u308f\u308c\u3001\u30b0\u30e9\u30d5\u3067\u306f\u5f79\u306b\u7acb\u3061\u307e\u305b\u3093\u3002</p> <p>ColPali (ColBERT + PaliGemma) \u306f\u3001OCR \u306a\u3057 - PDF \u30da\u30fc\u30b8\u3092\u76f4\u63a5\u753b\u50cf\u3068\u3057\u3066\u6271\u3046\u3068\u3044\u3046\u9769\u65b0\u7684\u306a\u30a2\u30a4\u30c7\u30a2\u3092\u63d0\u6848\u3057\u3066\u3044\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#1321","title":"13.2.1 \u57fa\u672c\u539f\u5247: \u8996\u899a\u8a00\u8a9e\u30e2\u30c7\u30eb\u306e\u5f8c\u671f\u76f8\u4e92\u4f5c\u7528","text":"<p>ColPali \u306f\u3001Vision-Language Model (VLM) \u3068 ColBERT \u691c\u7d22\u30e1\u30ab\u30cb\u30ba\u30e0\u3092\u7d44\u307f\u5408\u308f\u305b\u3066\u3044\u307e\u3059\u3002</p> <ol> <li>\u30d1\u30c3\u30c1\u306eEmbedding: \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u753b\u50cf\u3092\u5c0f\u3055\u306a\u30d1\u30c3\u30c1\u306b\u5206\u5272\u3057\u307e\u3059\u3002\u5404\u30d1\u30c3\u30c1\u306f\u30d9\u30af\u30c8\u30eb\u3092\u751f\u6210\u3057\u307e\u3059\u3002 1 \u3064\u306e\u753b\u50cf\u306f 1024 \u500b\u306e\u30d9\u30af\u30c8\u30eb\u306b\u5bfe\u5fdc\u3057\u307e\u3059\u3002</li> <li>\u9045\u5ef6\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3 (MaxSim): \u53d6\u5f97\u6642\u306b\u3001\u3059\u3079\u3066\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u30d1\u30c3\u30c1 \u30d9\u30af\u30c8\u30eb\u306b\u5bfe\u3057\u3066\u5404\u30af\u30a8\u30ea \u30c8\u30fc\u30af\u30f3 \u30d9\u30af\u30c8\u30eb\u3092\u8a08\u7b97\u3057\u3001\u6700\u5927\u306e\u985e\u4f3c\u6027\u3092\u53d6\u5f97\u3057\u307e\u3059\u3002</li> </ol> <p></p> <p>\u56f3 13-2: \u60aa\u3044\u30b1\u30fc\u30b9 (\u5de6) \u3068\u826f\u3044\u30b1\u30fc\u30b9 (\u53f3) \u2014\u2014 \u5de6: OCR \u306b\u3088\u308a\u30c6\u30fc\u30d6\u30eb\u304c\u6587\u5b57\u5316\u3051\u3057\u3066\u3057\u307e\u3044\u307e\u3059\u3002\u53f3: ColPali \u306f\u30af\u30a8\u30ea\u3092\u753b\u50cf\u30ec\u30d9\u30eb\u3067\u30c6\u30fc\u30d6\u30eb\u884c\u3068\u76f4\u63a5\u4f4d\u7f6e\u5408\u308f\u305b\u3057\u307e\u3059</p>"},{"location":"ja/part5/5_2_mm_rag/#133","title":"13.3 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u306e\u5b9f\u88c5: \u30cf\u30a4\u30d6\u30ea\u30c3\u30c9 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u691c\u7d22\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u69cb\u7bc9","text":"<p>\u3053\u306e\u30bb\u30af\u30b7\u30e7\u30f3\u3067\u306f\u3001SigLIP (\u81ea\u7136\u753b\u50cf) \u304a\u3088\u3073 ColPali (\u6587\u66f8\u753b\u50cf) \u3068\u4e92\u63db\u6027\u306e\u3042\u308b\u691c\u7d22\u30b7\u30b9\u30c6\u30e0 \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af\u3092\u5b9f\u88c5\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#1331","title":"13.3.1 \u5168\u4f53\u7684\u306a\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3068\u30c7\u30fc\u30bf \u30d5\u30ed\u30fc","text":"<p>\u30b3\u30fc\u30c7\u30a3\u30f3\u30b0\u3059\u308b\u524d\u306b\u3001\u30c7\u30fc\u30bf\u306e\u6d41\u308c\u3092\u660e\u78ba\u306b\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u3053\u308c\u306f\u3082\u306f\u3084\u5358\u7d14\u306a\u300c\u30c6\u30ad\u30b9\u30c8\u5165\u529b\u3001\u30c6\u30ad\u30b9\u30c8\u51fa\u529b\u300d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002</p> <p></p> <p>\u56f3 13-3: \u30a8\u30f3\u30c9\u30c4\u30fc\u30a8\u30f3\u30c9\u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 \u2014\u2014 \u5de6: \u30a4\u30f3\u30c7\u30c3\u30af\u30b9 \u30d5\u30ed\u30fc (PDF \u304b\u3089\u753b\u50cf -&gt; \u30d3\u30b8\u30e7\u30f3 \u30a8\u30f3\u30b3\u30fc\u30c0\u30fc -&gt; \u91cf\u5b50\u5316 -&gt; \u30d9\u30af\u30c8\u30eb DB)\u3002\u53f3: \u53d6\u5f97\u30d5\u30ed\u30fc (\u30af\u30a8\u30ea -&gt; \u30c6\u30ad\u30b9\u30c8 \u30a8\u30f3\u30b3\u30fc\u30c0\u30fc -&gt; MaxSim \u30b9\u30b3\u30a2\u30ea\u30f3\u30b0 -&gt; \u518d\u30e9\u30f3\u30af)</p>"},{"location":"ja/part5/5_2_mm_rag/#1332","title":"13.3.2 \u30b3\u30a2\u30b3\u30fc\u30c9: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u306a\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u3068\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0","text":"<p><code>MultimodalIndexer</code> \u3092\u5b9a\u7fa9\u3057\u307e\u3059\u3002\u5b9f\u7528\u7684\u306a\u6a5f\u80fd\u3092\u5b9f\u73fe\u3059\u308b\u306b\u306f\u3001\u300c\u30d9\u30af\u30c8\u30eb\u5316 (Embedding)\u300d\u30ed\u30b8\u30c3\u30af\u3060\u3051\u3067\u306a\u304f\u3001\u660e\u793a\u7684\u306a\u300c\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u300d\u30ed\u30b8\u30c3\u30af\u3082\u5fc5\u8981\u3067\u3059\u3002ColPali \u691c\u7d22\u306f\u3001\u5358\u7d14\u306b\u30d9\u30af\u30c8\u30eb \u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306e\u30b3\u30b5\u30a4\u30f3\u985e\u4f3c\u6027\u306b\u4f9d\u5b58\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002</p> <pre><code>import torch\nfrom PIL import Image\nfrom transformers import AutoProcessor, AutoModel, SiglipProcessor, SiglipModel\nfrom typing import List, Union\nimport numpy as np\n\nclass MultimodalIndexer:\n    \"\"\"\n    Multimodal indexer: Unified wrapper for SigLIP (natural images) and ColPali (document images)\n    \"\"\"\n    def __init__(self, use_colpali: bool = False):\n        self.device = \"cuda\" if torch.cuda.is_available() else \"cpu\"\n        self.use_colpali = use_colpali\n\n        if self.use_colpali:\n             # [Key decision] Use Merged version (combines visual encoder and language model into single checkpoint)\n             # Simplified for unified loading and deployment\n            from colpali_engine.models import ColPali\n            from colpali_engine.utils.processing_utils import ColPaliProcessor\n\n            model_name = \"vidore/colpali-v1.2-merged\"\n            print(f\"Loading ColPali model: {model_name}...\")\n\n            self.model = ColPali.from_pretrained(\n                model_name, \n                torch_dtype=torch.bfloat16, \n                device_map=self.device\n            )\n            self.processor = ColPaliProcessor.from_pretrained(model_name)\n        else:\n            # Load SigLIP\n            model_name = \"google/siglip-so400m-patch14-384\"\n            print(f\"Loading SigLIP model: {model_name}...\")\n            self.model = SiglipModel.from_pretrained(model_name).to(self.device)\n            self.processor = SiglipProcessor.from_pretrained(model_name)\n\n    def embed_images(self, image_paths: List[str]) -&gt; Union[np.ndarray, List[torch.Tensor]]:\n        \"\"\"Step 1: Image vectorization\"\"\"\n        images = [Image.open(p).convert(\"RGB\") for p in image_paths]\n        with torch.no_grad():\n            if self.use_colpali:\n                # ColPali: Returns List[Tensor], each shape (Num_Patches, 128)\n                batch_images = self.processor.process_images(images).to(self.device)\n                embeddings = self.model(**batch_images) \n                return list(embeddings) \n            else:\n                # SigLIP: Returns (Batch, Hidden_Dim)\n                inputs = self.processor(images=images, return_tensors=\"pt\").to(self.device)\n                features = self.model.get_image_features(**inputs)\n                return (features / features.norm(p=2, dim=-1, keepdim=True)).cpu().numpy()\n\n    def embed_query(self, text: str):\n        \"\"\"Step 2: Query text vectorization\"\"\"\n        with torch.no_grad():\n            if self.use_colpali:\n                batch_text = self.processor.process_queries([text]).to(self.device)\n                return self.model(**batch_text) # Returns (1, Query_Tokens, 128)\n            else:\n                inputs = self.processor(text=[text], return_tensors=\"pt\").to(self.device)\n                features = self.model.get_text_features(**inputs)\n                return features / features.norm(p=2, dim=-1, keepdim=True)\n\n    def score_colpali(self, query_emb: torch.Tensor, doc_embeddings_list: List[torch.Tensor]) -&gt; List[float]:\n        \"\"\"\n        Step 3: ColPali core scoring logic (Late Interaction / MaxSim)\n\n        Args:\n            query_emb: (1, Q_Tokens, Dim)\n            doc_embeddings_list: List of (D_Tokens, Dim) - patches per page may vary\n        \"\"\"\n        scores = []\n        # Remove Query batch dimension -&gt; (Q_Tokens, Dim)\n        Q = query_emb.squeeze(0) \n\n        for D in doc_embeddings_list:\n            # 1. Compute interaction matrix: \n            # (Q_Tokens, Dim) @ (Dim, D_Tokens) -&gt; (Q_Tokens, D_Tokens)\n            # Using einsum: q=query tokens, d=doc patches, h=hidden dim\n            sim_matrix = torch.einsum(\"qh,dh-&gt;qd\", Q, D)\n\n            # 2. MaxSim: For each Query token, find max similarity among all document patches\n            max_sim_per_token = sim_matrix.max(dim=1).values\n\n            # 3. Sum: Sum all Query token max similarities for final score\n            score = max_sim_per_token.sum()\n            scores.append(score.item())\n\n        return scores\n\n# --- Usage Example ---\nif __name__ == \"__main__\":\n    indexer = MultimodalIndexer(use_colpali=True)\n    # Assume we have embeddings\n    # scores = indexer.score_colpali(q_emb, [doc_emb1, doc_emb2])\n    # top_k = np.argsort(scores)[::-1]\n</code></pre>"},{"location":"ja/part5/5_2_mm_rag/#1333-bq","title":"13.3.3 \u30d1\u30d5\u30a9\u30fc\u30de\u30f3\u30b9\u306e\u6700\u9069\u5316: \u30d0\u30a4\u30ca\u30ea\u91cf\u5b50\u5316 (BQ)","text":"<p>ColPali \u306e\u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u4e0a\u306e\u6700\u5927\u306e\u554f\u984c\u306f \u30b9\u30c8\u30ec\u30fc\u30b8\u306e\u7206\u767a\u3067\u3059\u3002</p> <ul> <li>\u5f93\u6765\u306eEmbedding: 1 \u30da\u30fc\u30b8 = 1 \u30d9\u30af\u30c8\u30eb (4KB float32)\u3002</li> <li>ColPali: 1 \u30da\u30fc\u30b8 = 1032 \u30d9\u30af\u30bf\u30fc (512KB float16)\u3002</li> </ul> <p>100 \u4e07 PDF \u30da\u30fc\u30b8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u306b\u306f 500 GB \u306e\u30e1\u30e2\u30ea\u304c\u5fc5\u8981\u3067\u3059\u304c\u3001\u5b9f\u969b\u306b\u306f\u53d7\u3051\u5165\u308c\u3089\u308c\u306a\u3044\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002</p> <p>\u89e3\u6c7a\u7b56: \u30d0\u30a4\u30ca\u30ea\u91cf\u5b50\u5316\u3092\u4f7f\u7528\u3057\u3001float16 \u3092 1 \u30d3\u30c3\u30c8\u306b\u5727\u7e2e\u3057\u307e\u3059\u3002</p> <pre><code>def quantize_embeddings(embeddings: torch.Tensor) -&gt; torch.Tensor:\n    \"\"\"\n    Principle: Values &gt; 0 become 1, &lt;= 0 become 0.\n    Storage compression: 32x (float32 -&gt; int1)\n    Precision loss: Recall@5 drops less than 2%\n    \"\"\"\n    # Simple binarization\n    binary_emb = (embeddings &gt; 0).float() \n\n    # For actual storage can use packbits to compress to uint8\n    # packed = np.packbits(binary_emb.cpu().numpy().astype(np.uint8), axis=-1)\n\n    return binary_emb\n\ndef score_binary(query_emb, binary_doc_emb):\n    \"\"\"\n    Binary vector scoring typically uses Hamming Distance or bitwise operations\n    but in ColPali, usually keep Query as float, only quantize Doc\u2014\n    then dot product becomes simple add/subtract, greatly accelerating computation.\n    \"\"\"\n    pass \n</code></pre> <p>\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u306b\u95a2\u3059\u308b\u6c7a\u5b9a: \u904b\u7528\u74b0\u5883\u3067\u306f\u3001Binary Vector (Qdrant\u3001Vespa) \u307e\u305f\u306f\u5c02\u7528\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 \u30e9\u30a4\u30d6\u30e9\u30ea (USearch) \u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u3092\u63a8\u5968\u3057\u307e\u3059\u3002\u3053\u308c\u3089\u306e\u30c7\u30fc\u30bf\u30d9\u30fc\u30b9\u306f\u3001\u6700\u4e0b\u5c64\u3067\u306e\u8d85\u9ad8\u901f\u30de\u30c3\u30c1\u30f3\u30b0\u306e\u305f\u3081\u306b CPU \u547d\u4ee4 (AVX-512 POPCNT) \u3092\u6d3b\u7528\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#134","title":"13.4 \u6027\u80fd\u3068\u8a55\u4fa1 (\u6027\u80fd\u3068\u8a55\u4fa1)","text":"<p>\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb RAG \u306e\u8a55\u4fa1\u3067\u306f\u3001\u5358\u306b\u300c\u6b63\u3057\u304f\u898b\u3064\u304b\u3063\u305f\u300d\u3060\u3051\u3067\u306f\u306a\u304f\u3001\u300c\u306a\u305c\u898b\u3064\u304b\u3063\u305f\u306e\u304b\u300d\u3082\u8a55\u4fa1\u3055\u308c\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#1341","title":"13.4.1 \u8a55\u4fa1\u6307\u6a19","text":"\u30e1\u30c8\u30ea\u30c3\u30af \u8a72\u5f53\u3059\u308b\u30b7\u30ca\u30ea\u30aa \u8aac\u660e \u30ea\u30b3\u30fc\u30eb@K \u4e00\u822c\u7684\u306a\u691c\u7d22 \u4e0a\u4f4d K \u500b\u306e\u7d50\u679c\u306b\u6b63\u3057\u3044\u753b\u50cf\u304c\u542b\u307e\u308c\u308b\u78ba\u7387\u3002 NDCG@10 \u30e9\u30f3\u30ad\u30f3\u30b0\u54c1\u8cea \u95a2\u9023\u6027\u306e\u9ad8\u3044\u753b\u50cf\u306e\u30b9\u30b3\u30a2\u304c\u9ad8\u3044\u307b\u3069\u3001\u4e0a\u4f4d\u306b\u30e9\u30f3\u30af\u3055\u308c\u307e\u3059\u3002 OCR \u4e0d\u8981\u306e\u52b9\u7387 ColPali \u30b7\u30ca\u30ea\u30aa \u6642\u9593/\u30b3\u30b9\u30c8\u306e\u7bc0\u7d04\u7387\u3068 OCR + \u9ad8\u5bc6\u5ea6\u53d6\u5f97\u306e\u6bd4\u8f03\u3002"},{"location":"ja/part5/5_2_mm_rag/#1342","title":"13.4.2 \u30d9\u30f3\u30c1\u30de\u30fc\u30af","text":"<ul> <li>\u30c6\u30b9\u30c8\u74b0\u5883: Intel Xeon Gold 6226R\u3001NVIDIA RTX 3090\u3002</li> <li>\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8: ViDoRe \u30d9\u30f3\u30c1\u30de\u30fc\u30af (\u8907\u96d1\u306a\u8ca1\u52d9\u8af8\u8868)\u3002</li> </ul>"},{"location":"ja/part5/5_2_mm_rag/#1-5","title":"1. \u7cbe\u5ea6\u306e\u6bd4\u8f03 (\u518d\u73fe\u7387@5)","text":"<ul> <li>\u975e\u69cb\u9020\u5316 OCR + BGE-M3: 43% (\u30c6\u30fc\u30d6\u30eb\u69cb\u9020\u306e\u640d\u5931\u304c\u4e3b\u306a\u539f\u56e0)\u3002</li> <li>ColPali v1.2: 81% (\u76f4\u63a5\u8996\u899a\u7684\u306b\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u7406\u89e3)\u3002</li> </ul>"},{"location":"ja/part5/5_2_mm_rag/#2","title":"2. \u30ec\u30a4\u30c6\u30f3\u30b7\u306e\u6bd4\u8f03","text":"<ul> <li>SigLIP (\u5bc6): &lt; 20ms/\u30af\u30a8\u30ea\u3002</li> <li>ColPali (\u9045\u5ef6\u30a4\u30f3\u30bf\u30e9\u30af\u30b7\u30e7\u30f3): \u30af\u30a8\u30ea\u3042\u305f\u308a\u6700\u5927 150 \u30df\u30ea\u79d2\u3002</li> </ul> <p>\u7d50\u8ad6: ColPali \u306f\u518d\u30e9\u30f3\u30af\u4ed8\u3051\u307e\u305f\u306f\u9ad8\u54c1\u8cea\u306e\u691c\u7d22\u306b\u9069\u3057\u3066\u3044\u307e\u3059\u3002\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u306b\u306f\u91cf\u5b50\u5316\u304c\u5fc5\u8981\u3067\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#1343","title":"13.4.3 \u89e3\u91c8\u53ef\u80fd\u6027: \u30e2\u30c7\u30eb\u306f\u3069\u3053\u3092\u898b\u3066\u3044\u308b\u306e\u304b?","text":"<p>ColPali \u306e\u3082\u3046 1 \u3064\u306e\u5229\u70b9\u306f \u89e3\u91c8\u53ef\u80fd\u6027 \u3067\u3059\u3002 MaxSim \u8a08\u7b97\u304b\u3089\u306e\u76f8\u4e92\u4f5c\u7528\u884c\u5217\u3092\u8996\u899a\u5316\u3059\u308b\u3053\u3068\u3067\u3001\u30e2\u30c7\u30eb\u304c\u3069\u306e\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u9818\u57df\u306b\u6ce8\u76ee\u3057\u305f\u304b\u3092\u6b63\u78ba\u306b\u793a\u3059\u30d2\u30fc\u30c8\u30de\u30c3\u30d7\u3092\u751f\u6210\u3067\u304d\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#135","title":"13.5 \u3088\u304f\u3042\u308b\u8aa4\u89e3\u3068\u843d\u3068\u3057\u7a74","text":"<ul> <li>\u8aa4\u89e3 1: \u300c\u3059\u3079\u3066\u306e\u753b\u50cf\u306b\u306f\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3059\u308b\u4fa1\u5024\u304c\u3042\u308b\u300d</li> <li>Web \u30da\u30fc\u30b8\u3084\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u306e\u30a2\u30a4\u30b3\u30f3\u3001\u88c5\u98fe\u7dda\u3001\u30d8\u30c3\u30c0\u30fc/\u30d5\u30c3\u30bf\u30fc\u306e\u30ed\u30b4\u306f\u5927\u304d\u306a\u30ce\u30a4\u30ba\u3092\u767a\u751f\u3057\u307e\u3059\u3002</li> <li> <p>\u4fee\u6b63: \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u524d\u306b\u300c\u30b8\u30e3\u30f3\u30af\u753b\u50cf\u5206\u985e\u5b50\u300d\u307e\u305f\u306f\u30eb\u30fc\u30eb\u30d9\u30fc\u30b9\u306e\u30d5\u30a3\u30eb\u30bf\u30fc\u3092\u8ffd\u52a0\u3057\u307e\u3059 (\u4f8b: 5KB \u672a\u6e80\u307e\u305f\u306f\u6975\u7aef\u306a\u30a2\u30b9\u30da\u30af\u30c8\u6bd4\u306e\u753b\u50cf\u3092\u7834\u68c4\u3057\u307e\u3059)\u3002</p> </li> <li> <p>\u8aa4\u89e3 2: \u300cEmbedding\u6b21\u5143\u306e\u7206\u767a\u3092\u7121\u8996\u3059\u308b\u300d</p> </li> <li>\u3059\u3079\u3066\u306e ColPali \u30d9\u30af\u30c8\u30eb\u3092\u901a\u5e38\u306e PGVector \u306b\u5358\u7d14\u306b\u30c0\u30f3\u30d7\u3057\u306a\u3044\u3067\u304f\u3060\u3055\u3044\u3002</li> <li> <p>\u4fee\u6b63: 13.3.3 \u30d0\u30a4\u30ca\u30ea\u91cf\u5b50\u5316\u3092\u5b9f\u88c5\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u307e\u305f\u306f\u3001\u8907\u96d1\u306a\u300c\u30ad\u30fc \u30da\u30fc\u30b8\u300d\u306b\u306e\u307f ColPali \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u901a\u5e38\u306e\u30c6\u30ad\u30b9\u30c8 \u30da\u30fc\u30b8\u306f\u5f15\u304d\u7d9a\u304d BGE/OpenAI Embedding\u3092\u4f7f\u7528\u3057\u3001\u30cf\u30a4\u30d6\u30ea\u30c3\u30c9 \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> </li> <li> <p>\u8aa4\u89e3 3: \u300cOCR \u306e\u4ee3\u66ff\u3068\u3057\u3066 CLIP \u3092\u76f4\u63a5\u4f7f\u7528\u3059\u308b\u300d</p> </li> <li>CLIP \u306f\u753b\u50cf\u306b\u300c\u30c6\u30ad\u30b9\u30c8\u300d\u304c\u542b\u307e\u308c\u3066\u3044\u308b\u3053\u3068\u3092\u8a8d\u8b58\u3057\u307e\u3059\u304c\u3001\u9577\u3044\u30c6\u30ad\u30b9\u30c8\u3092\u8aad\u307f\u53d6\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002 \u300c\u5951\u7d04\u66f8\u306e\u5f53\u4e8b\u8005 A \u306f\u8ab0\u3067\u3059\u304b?\u300d\u3068\u5c0b\u306d\u3089\u308c\u3066\u3082\u3001\u6a19\u6e96\u306e CLIP \u3067\u306f\u901a\u5e38\u306f\u7b54\u3048\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u305b\u3093\u3002</li> <li>\u4fee\u6b63: \u8907\u96d1\u306a\u30ec\u30a4\u30a2\u30a6\u30c8\u3092\u6301\u305f\u306a\u3044\u30c6\u30ad\u30b9\u30c8\u5bc6\u5ea6\u306e\u9ad8\u3044\u753b\u50cf\u306e\u5834\u5408\u3001OCR + LLM \u306f\u4f9d\u7136\u3068\u3057\u3066\u8cbb\u7528\u5bfe\u52b9\u679c\u304c\u9ad8\u304f\u306a\u308a\u307e\u3059\u3002 ColPali \u306f\u3001\u300c\u30ec\u30a4\u30a2\u30a6\u30c8\u306f\u30bb\u30de\u30f3\u30c6\u30a3\u30af\u30b9\u300d\u30b7\u30ca\u30ea\u30aa (\u8907\u96d1\u306a\u30cd\u30b9\u30c8\u3055\u308c\u305f\u30c6\u30fc\u30d6\u30eb\u306a\u3069) \u306b\u9069\u7528\u3055\u308c\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part5/5_2_mm_rag/#_3","title":"\u7ae0\u306e\u6982\u8981","text":"<p>\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb RAG \u306f\u3001\u79c1\u305f\u3061\u306e\u8996\u91ce\u3092 1D \u30c6\u30ad\u30b9\u30c8\u304b\u3089 2D \u8996\u899a\u7a7a\u9593\u306b\u62e1\u5f35\u3057\u307e\u3059\u3002</p> <ul> <li>\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3: \u81ea\u7136\u753b\u50cf\u306b\u306f SigLIP \u3092\u4f7f\u7528\u3057\u3001\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u753b\u50cf\u306b\u306f ColPali \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</li> <li>\u30b3\u30fc\u30c9: \u30b3\u30a2\u306f\u5358\u7d14\u306a\u30c9\u30c3\u30c8\u7a4d\u3067\u306f\u306a\u304f\u3001MaxSim \u30a4\u30f3\u30bf\u30e9\u30af\u30c6\u30a3\u30d6 \u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u306b\u3042\u308a\u307e\u3059\u3002</li> <li>\u6700\u9069\u5316: \u30d0\u30a4\u30ca\u30ea\u91cf\u5b50\u5316 (BQ) \u306f\u3001\u5927\u898f\u6a21\u306a\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb RAG \u5c0e\u5165\u3092\u53ef\u80fd\u306b\u3059\u308b\u4e3b\u8981\u306a\u30c6\u30af\u30ce\u30ed\u30b8\u3067\u3059\u3002</li> </ul> <p>\u3053\u306e\u7ae0\u3092\u30de\u30b9\u30bf\u30fc\u3059\u308b\u3068\u3001RAG \u30b7\u30b9\u30c6\u30e0\u306f\u3082\u306f\u3084\u300c\u76f2\u76ee\u300d\u3067\u306f\u306a\u304f\u3001\u30c1\u30e3\u30fc\u30c8\u3092\u8aad\u307f\u53d6\u3063\u3066\u30ec\u30dd\u30fc\u30c8\u3092\u5206\u6790\u3067\u304d\u308b\u300c\u591a\u7528\u9014\u306e\u30a8\u30ad\u30b9\u30d1\u30fc\u30c8\u300d\u306b\u306a\u308a\u307e\u3059\u3002</p>"},{"location":"ja/part5/5_2_mm_rag/#_4","title":"\u3055\u3089\u306b\u8aad\u3080","text":"<ul> <li>\u8ad6\u6587: ColPali: \u30d3\u30b8\u30e7\u30f3\u8a00\u8a9e\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3057\u305f\u52b9\u7387\u7684\u306a\u6587\u66f8\u691c\u7d22 (2024)\u3002</li> <li>\u30c4\u30fc\u30eb: <code>colpali_engine</code> \u516c\u5f0f\u30e9\u30a4\u30d6\u30e9\u30ea;\u30cd\u30a4\u30c6\u30a3\u30d6\u306e Qdrant/Weaviate \u30b5\u30dd\u30fc\u30c8\u306e\u66f4\u65b0\u3092\u8ffd\u8de1\u3057\u307e\u3059\u3002</li> <li>\u4e0a\u7d1a: \u3055\u3089\u306a\u308b\u30d9\u30af\u30c8\u30eb\u6b21\u5143\u5727\u7e2e\u306b\u3064\u3044\u3066\u306f\u3001\u30de\u30c8\u30ea\u30e7\u30fc\u30b7\u30ab\u8868\u73fe\u5b66\u7fd2 (MRL) \u3092\u5b66\u7fd2\u3057\u3066\u304f\u3060\u3055\u3044\u3002</li> </ul>"},{"location":"ja/part6/6_1_mini_c4/","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c81: Mini-C4\u4e8b\u524d\u5b66\u7fd2\u30bb\u30c3\u30c8\u69cb\u7bc9","text":""},{"location":"ja/part6/6_1_mini_c4/#1-mini-c4","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 1: \u300cMini-C4\u300d\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u69cb\u7bc9","text":""},{"location":"ja/part6/6_1_mini_c4/#1","title":"1. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u80cc\u666f (\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6982\u8981)","text":"<ul> <li>\u30bf\u30b9\u30af\u5b9a\u7fa9: \u5c0f\u578b C4 (Colossal Clean Crawled Corpus) \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002\u79c1\u305f\u3061\u306e\u76ee\u6a19\u306f\u3001\u4e71\u96d1\u306a\u751f\u306e Web \u30c7\u30fc\u30bf (\u5171\u901a\u30af\u30ed\u30fc\u30eb) \u3092\u3001\u5927\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u4e8b\u524d\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u76f4\u63a5\u4f7f\u7528\u3067\u304d\u308b\u4f4e\u30ce\u30a4\u30ba\u3067\u91cd\u8907\u6392\u9664\u3055\u308c\u305f\u9ad8\u54c1\u8cea\u306e\u7d14\u7c8b\u306a\u30c6\u30ad\u30b9\u30c8 \u30c7\u30fc\u30bf\u306b\u5909\u63db\u3059\u308b\u3053\u3068\u3067\u3059\u3002</li> <li>\u5165\u529b\u3068\u51fa\u529b:<ul> <li>\u5165\u529b: Common Crawl \u304b\u3089\u306e\u751f\u306e WARC \u30a2\u30fc\u30ab\u30a4\u30d6 (HTTP \u30d8\u30c3\u30c0\u30fc\u3001HTML \u30bd\u30fc\u30b9\u3001\u6587\u5b57\u5316\u3051\u3057\u305f\u30c6\u30ad\u30b9\u30c8\u306a\u3069\u3092\u542b\u3080)\u3002</li> <li>\u51fa\u529b: \u30af\u30ea\u30fc\u30f3 \u30c6\u30ad\u30b9\u30c8\u3068\u54c1\u8cea\u30b9\u30b3\u30a2\u3092\u542b\u3080\u3001\u5206\u985e\u304a\u3088\u3073\u63a1\u70b9\u3055\u308c\u305f JSONL \u30d5\u30a1\u30a4\u30eb (\u4f8b: <code>data_en.jsonl</code>\u3001<code>final_data.jsonl</code>)\u3002</li> </ul> </li> <li>\u8ab2\u984c\u5206\u6790:<ul> <li>\u4fe1\u53f7\u5bfe\u96d1\u97f3\u6bd4\u304c\u975e\u5e38\u306b\u4f4e\u3044: \u751f\u306e Web \u30b3\u30f3\u30c6\u30f3\u30c4\u306e 90% \u4ee5\u4e0a\u306f\u3001\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3 \u30d0\u30fc\u3001\u5e83\u544a\u3001JavaScript \u30b3\u30fc\u30c9\u3001\u304a\u3088\u3073\u7121\u610f\u5473\u306a\u30d7\u30ec\u30fc\u30b9\u30db\u30eb\u30c0\u30fc\u3067\u3059\u3002</li> <li>\u8a08\u7b97\u96c6\u7d04\u578b: \u5927\u898f\u6a21\u306a\u30b3\u30fc\u30d1\u30b9\u306b\u304a\u3051\u308b\u30da\u30a2\u30ef\u30a4\u30ba\u6bd4\u8f03\u306e\u91cd\u8907\u6392\u9664\u306f\u3001\u975e\u5e38\u306b\u30ea\u30bd\u30fc\u30b9\u3092\u6d88\u8cbb\u3057\u307e\u3059\u3002</li> <li>\u54c1\u8cea\u306e\u5b9a\u91cf\u5316: \u6587\u7ae0\u304c\u300c\u9ad8\u54c1\u8cea\u306e\u4eba\u9593\u306e\u8a00\u8a9e\u300d\u3067\u3042\u308b\u304b\u300c\u6a5f\u68b0\u304c\u751f\u6210\u3057\u305f\u30b4\u30df\u300d\u3067\u3042\u308b\u304b\u3092\u6a5f\u68b0\u306b\u81ea\u52d5\u7684\u306b\u5224\u65ad\u3055\u305b\u308b\u306b\u306f\u3069\u3046\u3059\u308c\u3070\u3088\u3044\u3067\u3057\u3087\u3046\u304b?</li> </ul> </li> </ul>"},{"location":"ja/part6/6_1_mini_c4/#2","title":"2. \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08 (\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08)","text":"<p>\u975e\u69cb\u9020\u5316 Web \u30c7\u30fc\u30bf\u3092\u51e6\u7406\u3059\u308b\u305f\u3081\u306b\u3001\u6b21\u306e\u3058\u3087\u3046\u3054\u578b\u306e\u51e6\u7406\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u8a2d\u8a08\u3057\u307e\u3057\u305f\u3002</p> <p>\u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u56f3:</p> <p></p> <p>\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u30b9\u30bf\u30c3\u30af:</p> <ul> <li>\u89e3\u6790\u30ec\u30a4\u30e4\u30fc: Trafilatura<ul> <li>\u610f\u601d\u6c7a\u5b9a\u306e\u6839\u62e0: \u5f93\u6765\u306e BeautifulSoup \u3068\u6bd4\u8f03\u3057\u3066\u3001Trafilatura \u306f Web \u8a18\u4e8b\u306e\u62bd\u51fa\u306b\u6700\u9069\u5316\u3055\u308c\u3066\u304a\u308a\u3001\u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3\u3001\u30d5\u30c3\u30bf\u30fc\u3001\u30dc\u30a4\u30e9\u30fc\u30d7\u30ec\u30fc\u30c8 \u30c6\u30ad\u30b9\u30c8\u3092\u81ea\u52d5\u7684\u306b\u524a\u9664\u3057\u3001\u3088\u308a\u9ad8\u3044\u62bd\u51fa\u52b9\u7387\u3068\u7cbe\u5ea6\u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</li> </ul> </li> <li>\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0\u30ec\u30a4\u30e4\u30fc: Ray<ul> <li>\u610f\u601d\u6c7a\u5b9a\u306e\u6839\u62e0: Python \u306e\u30cd\u30a4\u30c6\u30a3\u30d6 \u30de\u30eb\u30c1\u30d7\u30ed\u30bb\u30c3\u30b7\u30f3\u30b0\u306f\u30d3\u30c3\u30b0 \u30c7\u30fc\u30bf\u3068\u683c\u95d8\u3057\u307e\u3059\u3002 Ray \u306f\u975e\u5e38\u306b\u30b7\u30f3\u30d7\u30eb\u306a\u5206\u6563\u30d7\u30ea\u30df\u30c6\u30a3\u30d6\u3092\u63d0\u4f9b\u3057\u3066\u304a\u308a\u3001\u6570\u884c\u306e\u30b3\u30fc\u30c9\u3067\u30de\u30eb\u30c1\u30b3\u30a2 CPU \u3084\u30af\u30e9\u30b9\u30bf\u30fc\u5168\u4f53\u3067 MinHash \u8a08\u7b97\u3092\u4e26\u5217\u5316\u3067\u304d\u307e\u3059\u3002</li> </ul> </li> <li>\u54c1\u8cea\u30ec\u30a4\u30e4\u30fc: KenLM<ul> <li>\u610f\u601d\u6c7a\u5b9a\u306e\u6839\u62e0: \u8efd\u91cf\u306e N-gram \u8a00\u8a9e\u30e2\u30c7\u30eb \u30e9\u30a4\u30d6\u30e9\u30ea\u3002 GPT-3 \u8ad6\u6587\u3068 CCNet \u8ad6\u6587\u306f\u4e21\u65b9\u3068\u3082\u3001\u30c6\u30ad\u30b9\u30c8\u306e\u81ea\u7136\u3055\u3092\u6e2c\u5b9a\u3059\u308b\u305f\u3081\u306e\u4e2d\u5fc3\u7684\u306a\u6307\u6a19\u3068\u3057\u3066 KenLM \u306e\u8907\u96d1\u5ea6\u3092\u4f7f\u7528\u3057\u3066\u3044\u307e\u3059\u3002</li> </ul> </li> </ul>"},{"location":"ja/part6/6_1_mini_c4/#3","title":"3. \u6bb5\u968e\u7684\u306a\u5b9f\u88c5","text":""},{"location":"ja/part6/6_1_mini_c4/#1-html","title":"\u30d5\u30a7\u30fc\u30ba 1: \u4e71\u96d1\u306a HTML \u304b\u3089\u30e1\u30a4\u30f3 \u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u62bd\u51fa\u3059\u308b (\u62bd\u51fa\u3068\u30af\u30ea\u30fc\u30cb\u30f3\u30b0)","text":"<p>\u672a\u52a0\u5de5\u306e WARC \u30d5\u30a1\u30a4\u30eb\u306b\u306f\u3001\u30c6\u30ad\u30b9\u30c8\u4ee5\u5916\u306e\u30ce\u30a4\u30ba\u304c\u5927\u91cf\u306b\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\u307e\u305a\u5727\u7e2e\u30a2\u30fc\u30ab\u30a4\u30d6\u306e\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u8aad\u307f\u53d6\u308a\u306b <code>warcio</code> \u3092\u4f7f\u7528\u3057\u3001\u6b21\u306b <code>trafilatura</code> \u3092\u4f7f\u7528\u3057\u3066\u30b3\u30a2 \u30b3\u30f3\u30c6\u30f3\u30c4\u3092\u62bd\u51fa\u3057\u307e\u3059\u3002\u305d\u306e\u5f8c\u3001\u521d\u671f\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u306b\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30eb\u30fc\u30eb\u3092\u9069\u7528\u3057\u307e\u3059\u3002</p> <p>\u30b3\u30a2\u30b3\u30fc\u30c9: \u89e3\u6790\u3068\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af\u30af\u30ea\u30fc\u30cb\u30f3\u30b0</p> <pre><code>import trafilatura\nfrom warcio.archiveiterator import ArchiveIterator\n\n# 1. Extraction logic (from 2_process_warc.py)\ndef extract_text(content_stream):\n    text = trafilatura.extract(\n        content_stream, \n        include_comments=False, \n        include_tables=False\n    )\n    return text\n\n# 2. Heuristic cleaning rules (from 3_clean_data.py)\ndef is_high_quality(text):\n    # Rule A: Length and average word length filter\n    words = text.split()\n    if not words:\n        # Empty or whitespace-only text, treat as low quality\n        return False\n    mean_word_len = sum(len(w) for w in words) / len(words)\n    if mean_word_len &gt; 15: # Overly long words usually garbage or code\n        return False\n\n    # Rule B: Symbol density (Symbol Ratio)\n    code_symbols = {'{', '}', '[', ']', '&lt;', '&gt;', '\\\\'}\n    symbol_count = sum(1 for char in text if char in code_symbols)\n    if len(text) &gt; 0 and (symbol_count / len(text) &gt; 0.1): # Too many code symbols\n        return False\n\n    # Rule C: Blacklist keywords\n    bad_phrases = [\"lorem ipsum\", \"enable cookies\", \"403 forbidden\"]\n    if any(p in text.lower() for p in bad_phrases):\n        return False\n\n    return True\n</code></pre>"},{"location":"ja/part6/6_1_mini_c4/#2-minhash","title":"\u30d5\u30a7\u30fc\u30ba 2: \u5206\u6563 MinHash \u91cd\u8907\u6392\u9664","text":"<p>\u30a4\u30f3\u30bf\u30fc\u30cd\u30c3\u30c8\u306b\u306f\u3001\u7e70\u308a\u8fd4\u3055\u308c\u308b\u30b3\u30f3\u30c6\u30f3\u30c4 (\u518d\u6295\u7a3f\u3001\u30df\u30e9\u30fc) \u304c\u5927\u91cf\u306b\u3042\u308a\u307e\u3059\u3002 MinHash \u306e\u4e26\u5217\u8a08\u7b97\u306b\u306f Ray \u3092\u4f7f\u7528\u3057\u3001LSH (\u5c40\u6240\u6027\u654f\u611f\u30cf\u30c3\u30b7\u30e5) \u3092\u7d44\u307f\u5408\u308f\u305b\u3066 \\(O(N^2)\\) \u306e\u8907\u96d1\u3055\u3092 \\(O(N)\\) \u306b\u8efd\u6e1b\u3057\u307e\u3059\u3002</p> <p>\u30b3\u30a2 \u30b3\u30fc\u30c9: \u30ec\u30a4\u4e26\u5217\u7f72\u540d\u306e\u8a08\u7b97</p> <pre><code>import ray\nfrom datasketch import MinHash\n\n# Initialize Ray to use all CPU cores\nray.init()\n\n@ray.remote\ndef process_batch(lines, num_perm=128):\n    \"\"\"Ray Worker: Parallel MinHash fingerprint computation for a batch\"\"\"\n    results = []\n    for line in lines:\n        item = json.loads(line)\n        m = MinHash(num_perm=num_perm)\n        # Shingling: Update hash by words\n        for w in item['text'].split():\n            m.update(w.encode('utf8'))\n        results.append((item['url'], m, item['text']))\n    return results\n\n# Main flow: Map-Reduce style\n# Map: Distribute compute tasks\nfutures = [process_batch.remote(batch) for batch in batches]\n# Reduce: Collect results and build LSH index\nresults = ray.get(futures)\n# ...continue with MinHashLSH index building...\n</code></pre>"},{"location":"ja/part6/6_1_mini_c4/#3_1","title":"\u30d5\u30a7\u30fc\u30ba 3: \u8a00\u8a9e\u306e\u8b58\u5225\u3068\u8907\u96d1\u3055\u306e\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0 (\u54c1\u8cea\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0)","text":"<p>\u30af\u30ea\u30fc\u30f3\u30a2\u30c3\u30d7\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306b\u306f\u3001\u3055\u307e\u3056\u307e\u306a\u54c1\u8cea\u306e\u8907\u6570\u306e\u8a00\u8a9e\u304c\u6df7\u5728\u3057\u3066\u3044\u307e\u3059\u3002\u6700\u521d\u306b\u8a00\u8a9e\u30eb\u30fc\u30c6\u30a3\u30f3\u30b0\u306b FastText \u3092\u4f7f\u7528\u3057\u3001\u6b21\u306b\u8907\u96d1\u3055\u306e\u305f\u3081\u306b KenLM \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u6df7\u4e71\u304c\u5c11\u306a\u3044\u3068\u3044\u3046\u3053\u3068\u306f\u3001\u3088\u308a\u6d41\u66a2\u3067\u3001\u3088\u308a\u300c\u4eba\u9593\u3089\u3057\u3044\u300d\u6587\u7ae0\u3092\u610f\u5473\u3057\u307e\u3059\u3002</p> <p>\u30b3\u30a2 \u30b3\u30fc\u30c9: KenLM \u30b9\u30b3\u30a2\u30ea\u30f3\u30b0</p> <pre><code>import kenlm\nimport fasttext\n\n# 1. Language routing (from 5_split_lang.py)\nlid_model = fasttext.load_model('lid.176.ftz')\ndef predict_lang(text):\n    # k=1 takes highest probability language\n    predictions = lid_model.predict(text, k=1)\n    return predictions[0][0].replace('__label__', '')\n\n# 2. Perplexity filtering (from 6_quality_filter.py)\nkenlm_model = kenlm.Model('en.arpa.bin')\nPERPLEXITY_THRESHOLD = -6.0  # Experience threshold: below this usually low-quality text\n\ndef filter_by_perplexity(text):\n    words = text.split()\n    if not words:\n        # Empty text as low quality; avoid division by zero\n        return False, -10.0\n    # Compute normalized score (Log Score / Length)\n    log_score = kenlm_model.score(text)\n    normalized_score = log_score / len(words)\n\n    if normalized_score &gt; PERPLEXITY_THRESHOLD:\n        return True, normalized_score\n    return False, normalized_score\n</code></pre>"},{"location":"ja/part6/6_1_mini_c4/#4","title":"4. \u7d50\u679c\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9 (\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9)","text":"<p>\u3053\u306e\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u5f8c\u3001\u30c7\u30fc\u30bf\u306e\u72b6\u6cc1\u306f\u6839\u672c\u7684\u306b\u5909\u308f\u308a\u307e\u3057\u305f\u3002</p> <p>\u30b1\u30fc\u30b9 1: \u30ca\u30d3\u30b2\u30fc\u30b7\u30e7\u30f3 \u30d0\u30fc\u306e\u30ce\u30a4\u30ba (\u9664\u53bb)</p> <p>\u751f: \"\u30db\u30fc\u30e0 | \u79c1\u305f\u3061\u306b\u3064\u3044\u3066 | \u304a\u554f\u3044\u5408\u308f\u305b | Cookie \u3092\u6709\u52b9\u306b\u3059\u308b | Copyright 2023...\" \u7d50\u679c: [\u7834\u68c4] (\u77ed\u3044\u30c6\u30ad\u30b9\u30c8\u3068\u30ad\u30fc\u30ef\u30fc\u30c9\u306e\u30d6\u30e9\u30c3\u30af\u30ea\u30b9\u30c8 \u30eb\u30fc\u30eb\u304c\u30c8\u30ea\u30ac\u30fc\u3055\u308c\u307e\u3057\u305f)</p> <p>\u30b1\u30fc\u30b9 2: \u30b3\u30fc\u30c9 \u30b9\u30cb\u30da\u30c3\u30c8 (\u524a\u9664)</p> <p>Raw: \"function(x) { return x &gt; 0 ? true : false; } var a = [1,2,3];\" \u7d50\u679c: [\u7834\u68c4] (\u30c8\u30ea\u30ac\u30fc\u3055\u308c\u305f\u30b7\u30f3\u30dc\u30eb\u5bc6\u5ea6 &gt; 10% \u30eb\u30fc\u30eb)</p> <p>\u30b1\u30fc\u30b9 3: \u9ad8\u54c1\u8cea\u306e\u8a18\u4e8b (\u4fdd\u6301\u304a\u3088\u3073\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0)</p> <p>\u751f: \u300c\u30b8\u30a7\u30fc\u30e0\u30ba\u30fb\u30a6\u30a7\u30c3\u30d6\u5b87\u5b99\u671b\u9060\u93e1\u306f\u3001\u5275\u9020\u306e\u67f1\u306e\u65b0\u3057\u3044\u753b\u50cf\u3092\u6349\u3048\u307e\u3057\u305f...\u300d \u7d50\u679c: [\u4fdd\u6301] KenLM \u30b9\u30b3\u30a2: -4.82 (\u3057\u304d\u3044\u5024 -6.0 \u3088\u308a\u826f\u3044)</p> <p>\u30c7\u30fc\u30bf\u7d71\u8a08: \u30b7\u30f3\u30b0\u30eb\u30af\u30ed\u30fc\u30eb\u30b5\u30f3\u30d7\u30eb\u30c6\u30b9\u30c8\u306e\u5834\u5408: * \u751f\u306e\u8a18\u9332: 10,000 * \u62bd\u51fa\u3055\u308c\u305f\u6709\u52b9\u306a\u30c6\u30ad\u30b9\u30c8: ~4,500 (HTML \u89e3\u6790\u640d\u5931) * \u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u5f8c\u306e\u6b8b\u308a: ~2,800 (\u30d2\u30e5\u30fc\u30ea\u30b9\u30c6\u30a3\u30c3\u30af \u30d5\u30a3\u30eb\u30bf\u30fc\u640d\u5931) * \u91cd\u8907\u6392\u9664\u5f8c\u306e\u6b8b\u308a: ~2,100 (~25% \u91cd\u8907\u7387) * \u6700\u7d42\u7684\u306a\u9ad8\u54c1\u8cea\u30bb\u30c3\u30c8: ~1,800 (KenLM \u30d5\u30a3\u30eb\u30bf\u30fc)</p>"},{"location":"ja/part6/6_1_mini_c4/#5","title":"5. \u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316 (\u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316)","text":"<ul> <li> <p>\u30ea\u30bd\u30fc\u30b9\u6d88\u8cbb\u91cf:</p> <ul> <li>\u30b3\u30f3\u30d4\u30e5\u30fc\u30c6\u30a3\u30f3\u30b0: \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 \u30b3\u30fc\u30c9\u306f\u3001\u5358\u4e00\u30de\u30b7\u30f3\u306e 16 \u30b3\u30a2 CPU\u300164G RAM\u30011GB WARC \u306e\u51e6\u7406\u306b\u7d04 5 \uff5e 8 \u5206\u304b\u304b\u308a\u307e\u3059\u3002</li> <li>\u30dc\u30c8\u30eb\u30cd\u30c3\u30af: <code>MinHashLSH</code> \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u69cb\u7bc9\u306f\u73fe\u5728\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9 (<code>4_deduplicate.py</code> \u5185) \u3067\u3042\u308a\u3001\u5b8c\u5168\u306b\u30e1\u30e2\u30ea\u306b\u4f9d\u5b58\u3057\u3066\u3044\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306b\u95a2\u3059\u308b\u8003\u616e\u4e8b\u9805:     \u30c7\u30fc\u30bf\u304c TB \u30ec\u30d9\u30eb (\u5b9f\u969b\u306e C4 \u306a\u3069) \u306b\u30b9\u30b1\u30fc\u30eb\u3055\u308c\u308b\u5834\u5408\u306f\u3001\u73fe\u5728\u306e\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u3092\u30a2\u30c3\u30d7\u30b0\u30ec\u30fc\u30c9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <ol> <li>LSH \u30b9\u30c8\u30ec\u30fc\u30b8: \u30a4\u30f3\u30e1\u30e2\u30ea <code>MinHashLSH</code> \u306f\u4f7f\u7528\u3067\u304d\u307e\u305b\u3093\u3002\u30cf\u30c3\u30b7\u30e5\u30d0\u30b1\u30c3\u30c8\u306b\u306f Redis \u307e\u305f\u306f Cassandra \u304c\u5fc5\u8981\u3067\u3059\u3002</li> <li>\u4e26\u5217\u6226\u7565: Ray \u30bf\u30b9\u30af\u3092\u300c\u5358\u4e00\u30de\u30b7\u30f3 \u30de\u30eb\u30c1\u30b3\u30a2\u300d\u304b\u3089\u300c\u30de\u30eb\u30c1\u30de\u30b7\u30f3 \u30af\u30e9\u30b9\u30bf\u30fc\u300d\u306b\u62e1\u5f35\u3057\u307e\u3059\u3002</li> <li>I/O \u6700\u9069\u5316: \u30c7\u30fc\u30bf\u8aad\u307f\u53d6\u308a\u306f\u3001\u30b9\u30c8\u30ea\u30fc\u30df\u30f3\u30b0\u30ab\u30e9\u30e0\u578b\u51e6\u7406\u306b PyArrow \u3092\u4f7f\u7528\u3057\u3066\u3001\u30ed\u30fc\u30ab\u30eb \u30d5\u30a1\u30a4\u30eb\u30b7\u30b9\u30c6\u30e0\u304b\u3089 S3 \u306b\u79fb\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> </ol> </li> </ul>"},{"location":"ja/part6/6_2_legal_sft/","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c82: \u5782\u76f4\u9818\u57df\u30a8\u30ad\u30b9\u30d1\u30fc\u30c8SFT","text":""},{"location":"ja/part6/6_2_legal_sft/#2-sft","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 2: \u5782\u76f4\u9818\u57df\u30a8\u30ad\u30b9\u30d1\u30fc\u30c8 SFT (\u6cd5\u52d9)","text":"<p>\u30b7\u30ca\u30ea\u30aa: \u696d\u754c\u306e\u5c02\u9580\u5bb6\u304c\u975e\u69cb\u9020\u5316 PDF \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u304b\u3089\u5fae\u8abf\u6574\u3057\u305f\u30c7\u30fc\u30bf\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002 \u30b3\u30a2 \u30c6\u30af\u30ce\u30ed\u30b8\u30fc: \u547d\u4ee4\u306e\u69cb\u7bc9\u3001CoT \u63a8\u8ad6\u306e\u5f37\u5316\u3001\u30c7\u30fc\u30bf\u306e\u591a\u69d8\u6027\u306e\u30d0\u30e9\u30f3\u30b9\u306e\u305f\u3081\u306e Self-Instruct\u3002 \u51fa\u529b: <code>domain_expert.jsonl</code> SFT\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3002</p>"},{"location":"ja/part6/6_2_legal_sft/#1","title":"1. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u80cc\u666f (\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6982\u8981)","text":"<ul> <li>\u30bf\u30b9\u30af\u5b9a\u7fa9: \u975e\u69cb\u9020\u5316\u6cd5\u898f\u5236 PDF \u6587\u66f8\u304b\u3089\u77e5\u8b58\u3092\u62bd\u51fa\u3057\u3001LLM Self-Instruct \u3092\u4f7f\u7528\u3057\u3066\u3001\u300c\u601d\u8003\u9023\u9396 (CoT)\u300d\u6a5f\u80fd\u3092\u5099\u3048\u305f\u5782\u76f4\u30c9\u30e1\u30a4\u30f3SFT\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</li> <li>\u5165\u529b\u3068\u51fa\u529b:</li> <li>\u5165\u529b: \u751f\u306e PDF \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (\u4f8b: \u30d8\u30c3\u30c0\u30fc\u3001\u30d5\u30c3\u30bf\u30fc\u3001\u900f\u304b\u3057\u306e\u5e72\u6e09\u306e\u3042\u308b\u6c11\u6cd5\u3001\u5211\u6cd5)\u3002</li> <li>\u51fa\u529b: <code>domain_expert.jsonl</code>\u3001\u6307\u793a (\u30e6\u30fc\u30b6\u30fc\u6307\u793a) \u3068\u51fa\u529b (\u601d\u8003\u30d7\u30ed\u30bb\u30b9\u306b\u3088\u308b\u5c02\u9580\u5bb6\u306e\u5fdc\u7b54) \u304c\u542b\u307e\u308c\u307e\u3059\u3002</li> <li>\u8ab2\u984c\u5206\u6790:</li> <li>PDF \u30ce\u30a4\u30ba \u30af\u30ea\u30fc\u30cb\u30f3\u30b0: \u6cd5\u5f8b\u6587\u66f8\u306b\u306f\u5f15\u7528\u30de\u30fc\u30ab\u30fc (\u4f8b: <code>[1]</code>)\u3001\u6539\u884c\u3067\u533a\u5207\u3089\u308c\u305f\u4e2d\u56fd\u8a9e (\u4f8b: <code>\u6cd5 \u5f8b</code>)\u3001\u304a\u3088\u3073\u30c6\u30ad\u30b9\u30c8\u306b\u57cb\u3081\u8fbc\u307e\u308c\u305f\u30da\u30fc\u30b8\u756a\u53f7 (\u4f8b: <code>- 195 -</code>) \u304c\u983b\u7e41\u306b\u542b\u307e\u308c\u3066\u304a\u308a\u3001\u3053\u308c\u3089\u3092\u9664\u53bb\u3059\u308b\u306e\u306f\u975e\u5e38\u306b\u56f0\u96e3\u3067\u3059\u3002</li> <li>\u30c7\u30fc\u30bf\u306e\u5747\u4e00\u6027: \u5358\u7d14\u306a\u300c\u6cd5\u898f\u5b9a\u306e\u8aac\u660e\u300d\u3060\u3051\u3067\u306f\u3001\u30a8\u30ad\u30b9\u30d1\u30fc\u30c8 \u30e2\u30c7\u30eb\u306e\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u306f\u4e0d\u5341\u5206\u3067\u3059\u3002\u4e8b\u4f8b\u5206\u6790\u3084\u6587\u66f8\u4f5c\u6210\u306a\u3069\u3001\u3055\u307e\u3056\u307e\u306a\u30bf\u30b9\u30af\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> <li>\u63a8\u8ad6\u80fd\u529b\u306e\u6b20\u5982: \u901a\u5e38\u306e QA \u30da\u30a2\u306b\u306f\u8ad6\u7406\u7684\u5c0e\u51fa\u304c\u3042\u308a\u307e\u305b\u3093\u3002\u30e2\u30c7\u30eb\u306b CoT (\u601d\u8003\u306e\u9023\u9396) \u3092\u751f\u6210\u3055\u305b\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part6/6_2_legal_sft/#2","title":"2. \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08 (\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08)","text":"<p>\u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u56f3:</p> <p></p> <ul> <li>\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u30b9\u30bf\u30c3\u30af:</li> <li>PDF \u89e3\u6790 (pdfplumber): PyPDF2 \u3068\u6bd4\u8f03\u3057\u3066\u3001pdfplumber \u306f\u3088\u308a\u6b63\u78ba\u306a\u5883\u754c\u30dc\u30c3\u30af\u30b9 \u30b3\u30f3\u30c8\u30ed\u30fc\u30eb\u3092\u63d0\u4f9b\u3057\u3001\u30d8\u30c3\u30c0\u30fc/\u30d5\u30c3\u30bf\u30fc\u306e\u524a\u9664\u306b\u4fbf\u5229\u3067\u3059 (\u30b3\u30fc\u30c9 \u30bb\u30c3\u30c8\u306e\u4e0a\u90e8/\u4e0b\u90e8\u30ab\u30c3\u30c8\u30aa\u30d5\u306f 5%)\u3002</li> <li>\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 \u30a8\u30f3\u30b8\u30f3 (\u6b63\u898f\u8868\u73fe): \u4e2d\u56fd\u8a9e\u306e\u5358\u8a9e\u533a\u5207\u308a\u304a\u3088\u3073\u5f15\u7528\u30de\u30fc\u30ab\u30fc\u7528\u306e\u300c\u30b0\u30eb\u30fc \u30b3\u30fc\u30c9\u300d - \u30c7\u30fc\u30bf\u54c1\u8cea\u3092\u5411\u4e0a\u3055\u305b\u308b\u9375\u3002</li> <li>\u751f\u6210\u30e2\u30c7\u30eb (DeepSeek-V3): Self-Instruct \u30c7\u30fc\u30bf\u5408\u6210\u306b\u5f37\u529b\u306a\u8ad6\u7406\u7684\u63a8\u8ad6\u3068\u4f4e\u30b3\u30b9\u30c8\u306e API \u3092\u6d3b\u7528\u3057\u307e\u3059\u3002</li> <li>\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3 \u30ed\u30b8\u30c3\u30af (Python): \u30bf\u30b9\u30af \u30bf\u30a4\u30d7\u306e\u591a\u69d8\u6027\u30d0\u30e9\u30f3\u30b9\u306b\u52a0\u91cd\u30eb\u30fc\u30ec\u30c3\u30c8 \u30db\u30a4\u30fc\u30eb \u30a2\u30eb\u30b4\u30ea\u30ba\u30e0\u3092\u4f7f\u7528\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part6/6_2_legal_sft/#3","title":"3. \u6bb5\u968e\u7684\u306a\u5b9f\u88c5","text":""},{"location":"ja/part6/6_2_legal_sft/#1_1","title":"\u30d5\u30a7\u30fc\u30ba 1: \u30c7\u30fc\u30bf\u306e\u53d6\u5f97\u3068\u30a4\u30f3\u30c6\u30ea\u30b8\u30a7\u30f3\u30c8\u306a\u30af\u30ea\u30fc\u30cb\u30f3\u30b0 (\u6c5a\u3044\u4ed5\u4e8b)","text":"<p>PDF \u62bd\u51fa\u306e\u6700\u5927\u306e\u554f\u984c\u306f\u3001\u5f62\u5f0f\u304c\u6df7\u4e71\u3057\u3066\u3044\u308b\u3053\u3068\u3067\u3059\u3002 <code>data_processing.py</code> \u306e <code>clean_text_smart</code> \u95a2\u6570\u304c\u3053\u306e\u305f\u3081\u306e\u4e2d\u6838\u3067\u3059\u3002\u79c1\u305f\u3061\u306f\u300c\u4e2d\u56fd\u8a9e\u306e\u8aa4\u3063\u305f\u30b9\u30da\u30fc\u30b9\u300d\u3068\u300c\u57cb\u3081\u8fbc\u307e\u308c\u305f\u30da\u30fc\u30b8\u756a\u53f7\u300d\u306e\u554f\u984c\u306e\u89e3\u6c7a\u306b\u91cd\u70b9\u3092\u7f6e\u3044\u3066\u3044\u307e\u3059\u3002</p> <p>\u30ad\u30fc\u30b3\u30fc\u30c9\u30ed\u30b8\u30c3\u30af:</p> <pre><code>def clean_text_smart(text):\n    \"\"\"\n    Cleaning core logic: Fix format damage from PDF parsing\n    \"\"\"\n    # 1. Remove citation references (e.g., [1], [1-3])\n    text = re.sub(r'\\[\\s*\\d+(?:[-\u2013,]\\d+)*\\s*\\]', '', text)\n\n    # 2. Remove page numbers embedded in text (e.g., \"- 195 -\")\n    # Use lookahead assertion to prevent accidental deletion of body numbering\n    text = re.sub(r'(?:^|\\s|\\n)[-\u2014\u2013\uff0d]\\s*\\d+\\s*[-\u2014\u2013\uff0d](?=\\s|\\n|$)', ' ', text)\n\n    # 3. Fix Chinese word-break (core fix)\n    # Scenario: PDF \"\u6cd5 \u5f8b \u89c4 \u5b9a\" gets recognized with spaces, need to merge\n    pattern_broken_zh = r'([\\u4e00-\\u9fa5])\\s+([\\u4e00-\\u9fa5])'\n    # Execute twice for consecutive breaks\n    text = re.sub(pattern_broken_zh, r'\\1\\2', text)\n    text = re.sub(pattern_broken_zh, r'\\1\\2', text) \n\n    return text.strip()\n</code></pre>"},{"location":"ja/part6/6_2_legal_sft/#2-cot","title":"\u30d5\u30a7\u30fc\u30ba 2: \u591a\u69d8\u306a\u547d\u4ee4\u5408\u6210 (\u591a\u69d8\u6027\u3068 CoT)","text":"<p>\u30e2\u30c7\u30eb\u304c\u6cd5\u5247\u3092\u6697\u8a18\u3059\u308b\u672c\u306e\u866b\u306b\u306a\u308b\u306e\u3092\u907f\u3051\u308b\u305f\u3081\u306b\u3001<code>generate_instructions.py</code> \u3067 \u30bf\u30b9\u30af \u30d7\u30fc\u30eb \u3068 \u78ba\u7387\u30b5\u30f3\u30d7\u30ea\u30f3\u30b0 \u3092\u8a2d\u8a08\u3057\u3001\u30e2\u30c7\u30eb\u306b 3 \u3064\u306e\u7570\u306a\u308b\u30bf\u30b9\u30af \u30bf\u30a4\u30d7\u3092\u751f\u6210\u3055\u305b\u307e\u3059\u3002</p> <p>\u30c0\u30a4\u30d0\u30fc\u30b7\u30c6\u30a3\u30d0\u30e9\u30f3\u30b9\u6226\u7565:</p> <pre><code># Task weight configuration (data distribution control)\nTASK_POOL = [\n    # Task A: Complex case analysis (reasoning focus) - weight 60%\n    (\"case_analysis\", PROMPT_CASE_ANALYSIS, 0.6),\n    # Task B: Legal document drafting (generation focus) - weight 20%\n    (\"doc_drafting\", PROMPT_DOCUMENT_DRAFTING, 0.2),\n    # Task C: Legal concept discrimination (knowledge focus) - weight 20%\n    (\"concept_explain\", PROMPT_CONCEPT_EXPLAIN, 0.2)\n]\n\n# Roulette wheel selection logic\nrand = random.random()\ncumulative_prob = 0\nfor name, tpl, prob in TASK_POOL:\n    cumulative_prob += prob\n    if rand &lt;= cumulative_prob:\n        # Hit task type, use corresponding Prompt\n        selected_prompt_tpl = tpl\n        break\n</code></pre>"},{"location":"ja/part6/6_2_legal_sft/#3-cot","title":"\u30d5\u30a7\u30fc\u30ba 3: \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068 CoT \u306e\u5f37\u5316","text":"<p>\u30d7\u30ed\u30f3\u30d7\u30c8\u3067\u306f\u3001\u30e2\u30c7\u30eb\u304c\u300c\u601d\u8003\u30d7\u30ed\u30bb\u30b9\u300d\u3092\u542b\u3080 JSON \u3092\u8fd4\u3059\u3053\u3068\u3092\u660e\u793a\u7684\u306b\u8981\u6c42\u3057\u307e\u3059\u3002\u5f8c\u51e6\u7406\u3067\u306f\u3001\u6697\u9ed9\u7684\u306a\u601d\u8003\u9023\u9396\u3092\u660e\u793a\u5316\u3057\u3001\u6700\u7d42\u7684\u306a\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30bf\u30fc\u30b2\u30c3\u30c8\u5f62\u5f0f\u306b\u9023\u7d50\u3057\u307e\u3059\u3002</p> <p>CoT \u30d5\u30a9\u30fc\u30de\u30c3\u30c8 \u30ed\u30b8\u30c3\u30af:</p> <pre><code># Parse model JSON response, force chain-of-thought format construction\nif isinstance(raw_output, dict):\n    thought = raw_output.get(\"\u601d\u8003\u8fc7\u7a0b\") or raw_output.get(\"analysis\")\n    answer = raw_output.get(\"\u6cd5\u5f8b\u5efa\u8bae\") or raw_output.get(\"conclusion\")\n\n    # Explicitly write thinking process into Output, training model to \"think before speak\"\n    formatted_output = f\"#### \ud83e\udde0 Thinking Process\\n{thought}\\n\\n#### \ud83d\udcdd Expert Advice\\n{answer}\"\n</code></pre>"},{"location":"ja/part6/6_2_legal_sft/#4","title":"4. \u7d50\u679c\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9 (\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9)","text":"<p>\u51e6\u7406\u5f8c\u3001\u751f\u306e\u920d\u3044\u6cd5\u5f8b\u6761\u9805\u306f\u3001\u6df1\u3044\u63a8\u8ad6\u3092\u5099\u3048\u305f Q&amp;A \u30da\u30a2\u306b\u5909\u308f\u308a\u307e\u3059\u3002\u4ee5\u4e0b\u306f\u3001<code>domain_expert.jsonl</code> \u304b\u3089\u306e\u5358\u4e00\u306e\u30c7\u30fc\u30bf \u30b5\u30f3\u30d7\u30eb\u3067\u3059\u3002</p> <p>\u51fa\u5178 (\u751f\u306e\u6cd5\u898f\u5b9a\u306e\u65ad\u7247):</p> <p>...\u7b2c 150 \u6761: \u4e00\u65b9\u306e\u5f53\u4e8b\u8005\u304c\u8a50\u6b3a\u3092\u5229\u7528\u3057\u3066\u76f8\u624b\u65b9\u306e\u771f\u610f\u306b\u53cd\u3057\u3066\u6c11\u4e8b\u6cd5\u5f8b\u884c\u70ba\u3092\u5b9f\u884c\u3055\u305b\u305f\u5834\u5408\u3001\u8a50\u6b3a\u3092\u53d7\u3051\u305f\u5f53\u4e8b\u8005\u306f\u4eba\u6c11\u6cd5\u9662\u307e\u305f\u306f\u4ef2\u88c1\u6a5f\u95a2\u306b\u53d6\u6d88\u3057\u3092\u8acb\u6c42\u3059\u308b\u6a29\u5229\u3092\u6709\u3059\u308b...</p> <p>\u751f\u6210\u3055\u308c\u305f SFT \u30c7\u30fc\u30bf (JSONL \u30a8\u30f3\u30c8\u30ea):</p> \u30d5\u30a3\u30fc\u30eb\u30c9 \u30b3\u30f3\u30c6\u30f3\u30c4\u4f8b \u6307\u793a \u5951\u7d04\u6642\u306b\u9a19\u3055\u308c\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\u76f8\u624b\u306f\u9aa8\u8463\u54c1\u306f\u672c\u7269\u3060\u3068\u8a00\u3044\u307e\u3057\u305f\u304c\u3001\u507d\u7269\u3067\u3057\u305f\u3002\u4eca\u4f55\u3092\u3059\u3079\u304d\u3067\u3057\u3087\u3046\u304b\uff1f\u305d\u308c\u3092\u5c0a\u91cd\u3059\u308b\u3053\u3068\u3092\u62d2\u5426\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u3059\u304b\uff1f \u51fa\u529b #### \ud83e\udde0\u601d\u8003\u30d7\u30ed\u30bb\u30b91. \u6cd5\u7684\u95a2\u4fc2\u306e\u5206\u6790: \u30e6\u30fc\u30b6\u30fc\u304c\u76f8\u624b\u65b9\u306e\u8a50\u6b3a\u306b\u57fa\u3065\u3044\u3066\u5951\u7d04\u3092\u7de0\u7d50\u3057\u305f (\u6c11\u4e8b\u6cd5\u5f8b\u884c\u70ba\u3092\u884c\u3063\u305f)\u30022. \u9069\u7528\u898f\u5b9a: \u6c11\u6cd5\u7b2c 150 \u6761\u306b\u3088\u308a\u3001\u3053\u308c\u306f\u300c\u7121\u52b9\u3068\u306a\u308b\u300d\u6c11\u4e8b\u6cd5\u5f8b\u884c\u70ba\u3067\u3042\u308a\u3001\u76f4\u63a5\u300c\u7121\u52b9\u300d\u307e\u305f\u306f\u300c\u540d\u8a89\u306e\u62d2\u5426\u300d\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u30023. \u5bfe\u5fdc\u7b56: \u8a50\u6b3a\u3092\u53d7\u3051\u305f\u5f53\u4e8b\u8005\u306f\u53d6\u308a\u6d88\u3057\u306e\u6a29\u5229\u3092\u884c\u4f7f\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u3001\u88c1\u5224\u6240\u307e\u305f\u306f\u4ef2\u88c1\u6a5f\u95a2\u3092\u901a\u3058\u3066\u884c\u3046\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002#### \ud83d\udcdd \u5c02\u9580\u5bb6\u306e\u30a2\u30c9\u30d0\u30a4\u30b9\u8aac\u660e\u306b\u3088\u308b\u3068\u3001\u3042\u306a\u305f\u306f\u771f\u306e\u610f\u56f3\u306b\u53cd\u3057\u3066\u5951\u7d04\u3092\u7de0\u7d50\u3057\u305f\u3053\u3068\u306b\u306a\u308a\u307e\u3059\u3002\u3053\u308c\u306f \u7121\u52b9\u53ef\u80fd\u306a\u6c11\u4e8b\u6cd5\u5f8b\u884c\u70ba\u3067\u3059\u3002\u76f4\u63a5\u300c\u5c65\u884c\u3092\u62d2\u5426\u300d\u3057\u305f\u308a\u3001\u5951\u7d04\u3092\u4e00\u65b9\u7684\u306b\u62d2\u5426\u3057\u305f\u308a\u3059\u308b\u3053\u3068\u306f\u3067\u304d\u307e\u305b\u3093\u3002\u4ee5\u4e0b\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u30021. \u53d6\u6d88\u6a29\u306e\u884c\u4f7f: \u4eba\u6c11\u6cd5\u9662\u306b\u8a34\u8a1f\u3092\u8d77\u3053\u3059\u304b\u3001\u4ef2\u88c1\u6a5f\u95a2\u306b\u5951\u7d04\u306e\u53d6\u6d88\u3057\u3092\u7533\u8acb\u3059\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u30022. ... <p>\u30c7\u30fc\u30bf\u5206\u5e03\u5206\u6790: - \u30b1\u30fc\u30b9\u5206\u6790 (60%): \u30e2\u30c7\u30eb\u306e\u8907\u96d1\u306a\u30ed\u30b8\u30c3\u30af\u51e6\u7406\u3092\u5f37\u5316\u3057\u307e\u3059\u3002 - \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 \u30c9\u30e9\u30d5\u30c8 (20%): \u30e2\u30c7\u30eb\u306e\u30d7\u30ed\u30d5\u30a7\u30c3\u30b7\u30e7\u30ca\u30eb\u306a\u30e9\u30a4\u30c6\u30a3\u30f3\u30b0\u3092\u5f37\u5316\u3057\u307e\u3059\u3002 - \u6982\u5ff5\u306e\u8aac\u660e (20%): \u57fa\u790e\u7684\u306a\u30c9\u30e1\u30a4\u30f3\u77e5\u8b58\u3092\u5f37\u5316\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part6/6_2_legal_sft/#5","title":"5. \u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316 (\u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316)","text":"<ul> <li>\u30ea\u30bd\u30fc\u30b9\u6d88\u8cbb\u91cf:</li> <li>API \u30b3\u30b9\u30c8: DeepSeek-V3 \u3092\u4f7f\u7528\u3057\u3066 1,000 \u500b\u306e\u9ad8\u54c1\u8cea CoT \u30b5\u30f3\u30d7\u30eb\u3092\u751f\u6210\u3059\u308b\u306b\u306f\u3001~0.5 \u30c9\u30eb\u304b\u3089 1.0 \u30c9\u30eb\u304b\u304b\u308a\u307e\u3059 (\u5165\u529b/\u51fa\u529b\u30c8\u30fc\u30af\u30f3\u304c\u9577\u304f\u306a\u308a\u307e\u3059)\u3002</li> <li>\u6642\u9593\u30b3\u30b9\u30c8: \u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u3067\u30b5\u30f3\u30d7\u30eb\u3042\u305f\u308a\u7d04 2 \u79d2\u3002</li> <li>\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306b\u95a2\u3059\u308b\u8003\u616e\u4e8b\u9805:</li> <li>\u540c\u6642\u5b9f\u884c\u30a2\u30af\u30bb\u30e9\u30ec\u30fc\u30b7\u30e7\u30f3: \u73fe\u5728\u306e\u30b3\u30fc\u30c9\u306f\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u3067\u3059 (<code>time.sleep</code>)\u3002\u672c\u756a\u74b0\u5883\u3067\u306f\u3001\u540c\u6642\u30ea\u30af\u30a8\u30b9\u30c8\u306b <code>asyncio</code> + <code>Semaphore</code> \u3092\u4f7f\u7528\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002 10\uff5e20\u500d\u306e\u52b9\u7387\u5411\u4e0a\u304c\u53ef\u80fd\u3002</li> <li>\u54c1\u8cea\u7ba1\u7406: \u73fe\u5728\u306f\u30d7\u30ed\u30f3\u30d7\u30c8\u5236\u7d04\u306e\u307f\u306b\u4f9d\u5b58\u3057\u3066\u3044\u307e\u3059\u3002 \u300c\u5831\u916c\u30e2\u30c7\u30eb\u306e\u30b9\u30b3\u30a2\u30ea\u30f3\u30b0\u300d\u307e\u305f\u306f\u300c\u30eb\u30fc\u30eb \u30d5\u30a3\u30eb\u30bf\u30fc\u300d\u30b9\u30c6\u30c3\u30d7\u3092\u8ffd\u52a0\u3057\u3066\u3001\u77ed\u3059\u304e\u308b\u30b5\u30f3\u30d7\u30eb\u3084 JSON \u89e3\u6790\u306b\u5931\u6557\u3057\u305f\u30b5\u30f3\u30d7\u30eb\u3092\u524a\u9664\u3059\u308b\u3053\u3068\u3092\u304a\u52e7\u3081\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part6/6_3_llava_instruct/","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c83: LLaVA\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u6307\u793a\u30bb\u30c3\u30c8\u69cb\u7bc9","text":""},{"location":"ja/part6/6_3_llava_instruct/#3-llava","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 3: LLaVA \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb\u547d\u4ee4\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306e\u69cb\u7bc9","text":"<p>\u7bc4\u56f2: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb LLM (LMM) \u958b\u767a\u3001\u30c7\u30fc\u30bf \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0\u3001\u30d3\u30b8\u30e5\u30a2\u30eb\u547d\u4ee4\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0 (\u30d3\u30b8\u30e5\u30a2\u30eb\u547d\u4ee4\u30c1\u30e5\u30fc\u30cb\u30f3\u30b0)</p>"},{"location":"ja/part6/6_3_llava_instruct/#1","title":"1. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u80cc\u666f (\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6982\u8981)","text":"<ul> <li> <p>\u30bf\u30b9\u30af\u5b9a\u7fa9:   LLaVA \u3084 Qwen-VL \u306a\u3069\u306e\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30e2\u30c7\u30eb\u3092\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3059\u308b\u305f\u3081\u306b\u3001\u5358\u4e00\u753b\u50cf QA (Visual QA)\u3001\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u4f4d\u7f6e\u7279\u5b9a (Grounding)\u3001\u304a\u3088\u3073\u8907\u6570\u753b\u50cf\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u63a8\u8ad6 (Interleaved Image-Text) \u3092\u30b5\u30dd\u30fc\u30c8\u3059\u308b\u9ad8\u54c1\u8cea\u306e\u8996\u899a\u7684SFT\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> </li> <li> <p>\u5165\u529b\u3068\u51fa\u529b:</p> </li> <li>\u5165\u529b: <ul> <li>RAW\u753b\u50cf\u30e9\u30a4\u30d6\u30e9\u30ea(<code>.jpg</code> / <code>.png</code>)</li> <li>\u69cb\u9020\u5316\u3055\u308c\u305f\u30a2\u30ce\u30c6\u30fc\u30b7\u30e7\u30f3 \u30c7\u30fc\u30bf (\u4f8b: Bbox \u5ea7\u6a19\u3092\u542b\u3080 COCO \u5f62\u5f0f <code>instances.json</code>)</li> </ul> </li> <li> <p>\u51fa\u529b: </p> <ul> <li>LLaVA \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u6a19\u6e96\u306b\u6e96\u62e0\u3057\u305f JSON \u30d5\u30a1\u30a4\u30eb (<code>image</code>\u3001<code>conversations</code> \u30d5\u30a3\u30fc\u30eb\u30c9\u3042\u308a)\u3002</li> <li>\u5ea7\u6a19\u306e\u6b63\u898f\u5316\u3068\u5f62\u5f0f\u306e\u8abf\u6574\u306b\u3088\u308b\u30c7\u30fc\u30bf\u306e\u30b0\u30e9\u30a6\u30f3\u30c7\u30a3\u30f3\u30b0\u3002</li> </ul> </li> <li> <p>\u8ab2\u984c\u5206\u6790:</p> </li> <li>\u5ea7\u6a19\u4f4d\u7f6e\u5408\u308f\u305b (\u5ea7\u6a19\u4f4d\u7f6e\u5408\u308f\u305b): \u751f\u306e\u691c\u51fa\u30c7\u30fc\u30bf\u306e\u5ea7\u6a19\u306f\u901a\u5e38\u3001\u30d4\u30af\u30bb\u30eb\u7d76\u5bfe\u5024 (x\u3001y\u3001w\u3001h) \u3067\u3059\u304c\u3001LLaVA \u3067\u306f\u3001<code>[ymin, xmin, ymax, xmax]</code> \u306e\u9806\u5e8f\u3067 <code>[0-1000]</code> \u7bc4\u56f2\u306b\u6b63\u898f\u5316\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u4e00\u5ea6\u9593\u9055\u3048\u308b\u3068\u3001\u30e2\u30c7\u30eb\u306f\u6df1\u523b\u306a\u300c\u5e7b\u899a\u300d\u306b\u898b\u821e\u308f\u308c\u307e\u3059\u3002</li> <li>\u8907\u6570\u753b\u50cf\u30ed\u30b8\u30c3\u30af\u306e\u69cb\u7bc9: \u5f93\u6765\u306e\u753b\u50cf\u30ad\u30e3\u30d7\u30b7\u30e7\u30f3 \u30c7\u30fc\u30bf\u306f 1 \u3064\u306e\u753b\u50cf\u3068 1 \u3064\u306e\u30c6\u30ad\u30b9\u30c8\u3067\u3059\u3002 \u300c\u8907\u6570\u306e\u753b\u50cf\u304c\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6\u3055\u308c\u305f\u300d\u30c0\u30a4\u30a2\u30ed\u30b0\u3092\u69cb\u7bc9\u3059\u308b\u306b\u306f\u3001\u30e2\u30c7\u30eb\u306b\u753b\u50cf\u9593\u306e\u95a2\u4fc2\u3092\u7406\u89e3\u3055\u305b\u308b\u305f\u3081\u306e\u5408\u7406\u7684\u306a\u6bd4\u8f03\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part6/6_3_llava_instruct/#2","title":"2. \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08 (\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08)","text":"<ul> <li> <p>\u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u56f3: </p> </li> <li> <p>\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u30b9\u30bf\u30c3\u30af:</p> </li> <li>OpenAI \u4e92\u63db API (SiliconFlow/Qwen): \u9ad8\u54c1\u8cea\u306e\u753b\u50cf\u30c6\u30ad\u30b9\u30c8\u8aac\u660e\u3068\u8907\u6570\u753b\u50cf\u6bd4\u8f03\u30ed\u30b8\u30c3\u30af\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u5bfe\u8a71\u69cb\u7bc9\u306b LLM \u63a8\u8ad6\u3092\u6d3b\u7528\u3057\u307e\u3059\u3002</li> <li>Python &amp; OpenCV: \u30b3\u30a2\u30b0\u30eb\u30fc\u8a00\u8a9e\u3002 OpenCV \u306f\u3001\u5ea7\u6a19\u6b63\u898f\u5316\u3068\u300c\u30c9\u30ed\u30fc\u30dc\u30c3\u30af\u30b9\u691c\u8a3c\u300d\u8996\u899a\u5316\u306e\u305f\u3081\u306b\u753b\u50cf\u5bf8\u6cd5 (H\u3001W) \u3092\u8aad\u307f\u53d6\u308b\u305f\u3081\u306b\u4e0d\u53ef\u6b20\u3067\u3059\u3002</li> <li>JSON: LLaVA \u6a19\u6e96\u30c7\u30fc\u30bf\u4ea4\u63db\u5f62\u5f0f\u3002</li> </ul>"},{"location":"ja/part6/6_3_llava_instruct/#3","title":"3. \u6bb5\u968e\u7684\u306a\u5b9f\u88c5","text":""},{"location":"ja/part6/6_3_llava_instruct/#1_1","title":"\u30d5\u30a7\u30fc\u30ba 1: \u30de\u30eb\u30c1\u753b\u50cf\u30a4\u30f3\u30bf\u30fc\u30ea\u30fc\u30d6 \u30c7\u30fc\u30bf\u306e\u751f\u6210","text":"<p>2 \u3064\u306e\u753b\u50cf\u3092\u300c\u6bd4\u8f03\u300d\u3059\u308b\u3088\u3046\u306b\u30e2\u30c7\u30eb\u306b\u6559\u3048\u308b\u306b\u306f\u3001API \u3092\u4f7f\u7528\u3057\u3066\u8907\u6570\u306e\u753b\u50cf\u3092\u52d5\u7684\u306b\u5165\u529b\u3057\u3001\u6bd4\u8f03\u3092\u30ea\u30af\u30a8\u30b9\u30c8\u3057\u307e\u3059\u3002</p> <p>\u30ad\u30fc \u30ed\u30b8\u30c3\u30af: VLM API \u3092\u4f7f\u7528\u3057\u3066\u30de\u30eb\u30c1\u30a4\u30e1\u30fc\u30b8\u5165\u529b\u30d7\u30ed\u30f3\u30d7\u30c8\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002</p> <pre><code># From interleaved.py\ndef generate_comparison(img1_path, img2_path):\n    # Construct Prompt: Require multi-image comparison\n    prompt = \"Here are two images. Please briefly compare them...\"\n\n    # Build multi-image payload\n    messages=[\n        {\n            \"role\": \"user\",\n            \"content\": [\n                {\"type\": \"text\", \"text\": prompt},\n                {\"type\": \"image_url\", \"image_url\": {\"url\": f\"...{img1_path}...\"}}, # Image 1\n                {\"type\": \"image_url\", \"image_url\": {\"url\": f\"...{img2_path}...\"}}  # Image 2\n            ]\n        }\n    ]\n    # ... send request and parse result ...\n</code></pre>"},{"location":"ja/part6/6_3_llava_instruct/#2-","title":"\u30d5\u30a7\u30fc\u30ba 2: \u30b3\u30a2\u51e6\u7406 - \u5883\u754c\u30dc\u30c3\u30af\u30b9\u306e\u4f4d\u7f6e\u5408\u308f\u305b","text":"<p>\u3053\u308c\u304c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u4e2d\u6838\u3068\u306a\u308b\u8a08\u7b97\u3067\u3059\u3002 COCO \u306f <code>[x_topleft, y_topleft, width, height]</code> \u3092\u4f7f\u7528\u3057\u307e\u3059\u304c\u3001LLaVA \u306f 0 \uff5e 1000 \u306e\u6574\u6570\u306b\u6b63\u898f\u5316\u3055\u308c\u305f\u5024\u3092\u6301\u3064 <code>[ymin, xmin, ymax, xmax]</code> \u3092\u5fc5\u8981\u3068\u3057\u307e\u3059\u3002</p> <p>\u30ad\u30fc\u6a5f\u80fd: \u5ea7\u6a19\u6b63\u898f\u5316\u5909\u63db</p> <pre><code># From alignment.py\ndef convert_bbox(bbox, width, height):\n    # COCO raw input: x, y, w, h\n    x, y, w, h = bbox\n\n    # Convert to LLaVA format: [ymin, xmin, ymax, xmax] normalized to 0-1000\n    # Must use max/min for clipping to prevent float error overflow\n    xmin = int((x / width) * 1000)\n    ymin = int((y / height) * 1000)\n    xmax = int((x + w) / width * 1000)\n    ymax = int((y + h) / height * 1000)\n\n    return [\n        max(0, min(1000, ymin)),\n        max(0, min(1000, xmin)),\n        max(0, min(1000, ymax)),\n        max(0, min(1000, xmax))\n    ]\n</code></pre>"},{"location":"ja/part6/6_3_llava_instruct/#3_1","title":"\u30d5\u30a7\u30fc\u30ba 3: \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3068\u691c\u8a3c","text":"<p>\u30c7\u30fc\u30bf\u751f\u6210\u3092\u76f4\u63a5\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u306b\u4f7f\u7528\u3057\u3066\u306f\u306a\u308a\u307e\u305b\u3093\u3002 \u8996\u899a\u5316\u30ea\u30d0\u30fc\u30b9\u691c\u8a3c\u306b\u5408\u683c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002\u63cf\u753b\u3057\u305f\u30dc\u30c3\u30af\u30b9\u304c\u9593\u9055\u3063\u3066\u3044\u308b\u3068\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3055\u308c\u305f\u30e2\u30c7\u30eb\u306f\u5f79\u306b\u7acb\u305f\u306a\u304f\u306a\u308a\u307e\u3059\u3002</p> <p>\u691c\u8a3c\u30ed\u30b8\u30c3\u30af: \u751f\u6210\u3055\u308c\u305f JSON \u3092\u89e3\u6790\u3057\u3001<code>[0-1000]</code> \u5ea7\u6a19\u3092\u30d4\u30af\u30bb\u30eb\u5ea7\u6a19\u306b\u5fa9\u5143\u3057\u3066\u63cf\u753b\u3057\u307e\u3059\u3002</p> <pre><code># From visualize_bbox.py\ndef draw_bbox(image, bbox, label, color):\n    h, w, _ = image.shape\n    ymin, xmin, ymax, xmax = bbox # Read LLaVA format\n\n    # Restore to pixel coordinates for drawing\n    x1 = int(xmin / 1000 * w)\n    y1 = int(ymin / 1000 * h)\n    x2 = int(xmax / 1000 * w)\n    y2 = int(ymax / 1000 * h)\n\n    # OpenCV draw box\n    cv2.rectangle(image, (x1, y1), (x2, y2), color, 2)\n    # ...\n</code></pre>"},{"location":"ja/part6/6_3_llava_instruct/#4","title":"4. \u7d50\u679c\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9 (\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9)","text":"<p>1.\u30c7\u30fc\u30bf\u69cb\u9020\u306e\u4f8b: \u6700\u7d42\u7684\u306b\u751f\u6210\u3055\u308c\u305f <code>llava_instruct.json</code> \u306f\u6b21\u306e\u6a19\u6e96\u69cb\u9020\u3092\u6301\u3061\u3001\u30c8\u30ec\u30fc\u30cb\u30f3\u30b0 \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u3067\u76f4\u63a5\u8aad\u307f\u53d6\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059\u3002</p> <pre><code>{\n  \"id\": \"1296_laptop\",\n  \"image\": \"000000001296.jpg\",\n  \"conversations\": [\n    {\n      \"from\": \"human\",\n      \"value\": \"Where is the laptop in the image? &lt;image&gt;\"\n    },\n    {\n      \"from\": \"qwen\",\n      \"value\": \"The laptop is located at [350, 201, 680, 505].\"\n    }\n  ]\n}\n</code></pre> <p>2.\u53ef\u8996\u5316\u691c\u8a3c\u30ec\u30dd\u30fc\u30c8: <code>visualize_bbox.py</code> \u3092\u5b9f\u884c\u3059\u308b\u3068\u3001\u691c\u8a3c\u30a4\u30e1\u30fc\u30b8\u304c <code>viz_debug</code> \u30c7\u30a3\u30ec\u30af\u30c8\u30ea\u306b\u751f\u6210\u3055\u308c\u307e\u3059\u3002\u30dc\u30c3\u30af\u30b9\u304c\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u3092\u6b63\u78ba\u306b\u30d5\u30ec\u30fc\u30e0\u5316\u3057\u3066\u3044\u308b\u5834\u5408 (\u4ee5\u4e0b\u306b\u793a\u3059\u3088\u3046\u306b)\u3001\u30c7\u30fc\u30bf \u30d1\u30a4\u30d7\u30e9\u30a4\u30f3 \u30ed\u30b8\u30c3\u30af\u306f\u6b63\u3057\u3044\u3067\u3059\u3002</p> <p>\u30a8\u30d5\u30a7\u30af\u30c8\u753b\u50cf\u306e\u751f\u6210:</p> <p></p>"},{"location":"ja/part6/6_3_llava_instruct/#5","title":"5. \u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316 (\u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316)","text":"<ul> <li>\u30ea\u30bd\u30fc\u30b9\u6d88\u8cbb\u91cf:</li> <li>API \u30b3\u30b9\u30c8: <code>interleaved.py</code> \u306f\u5916\u90e8 LLM API \u306b\u4f9d\u5b58\u3057\u307e\u3059\u3002 0.5 \u30c9\u30eb/100 \u4e07\u30c8\u30fc\u30af\u30f3\u3067 10,000 \u500b\u306e\u30de\u30eb\u30c1\u753b\u50cf\u6bd4\u8f03\u30b5\u30f3\u30d7\u30eb\u3092\u751f\u6210\u3059\u308b\u306b\u306f\u3001\u7d04 20 \uff5e 30 \u30c9\u30eb\u306e\u8cbb\u7528\u304c\u304b\u304b\u308a\u307e\u3059\u3002</li> <li> <p>\u8a08\u7b97\u6642\u9593: <code>alignment.py</code> \u306f\u7d14\u7c8b\u306a CPU \u3067\u3059\u3002 COCO \u691c\u8a3c\u30bb\u30c3\u30c8 (5k \u753b\u50cf) \u306e\u51e6\u7406\u306b\u306f\u6570\u79d2\u304b\u304b\u308a\u307e\u3059\u3002</p> </li> <li> <p>\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306b\u95a2\u3059\u308b\u8003\u616e\u4e8b\u9805:</p> </li> <li>\u540c\u6642\u51e6\u7406: \u6570\u767e\u4e07\u306e\u753b\u50cf (Objects365 \u306a\u3069) \u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3001<code>(h, w)</code> \u306e\u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u306e\u753b\u50cf\u8aad\u307f\u53d6\u308a\u304c\u30dc\u30c8\u30eb\u30cd\u30c3\u30af\u306b\u306a\u308a\u307e\u3059\u3002 16 \u30d7\u30ed\u30bb\u30b9\u306e\u4e26\u5217\u8aad\u307f\u53d6\u308a\u3068\u5909\u63db\u306e\u305f\u3081\u306b <code>multiprocessing</code> \u3092\u5c0e\u5165\u3067\u304d\u307e\u3059\u3002</li> <li>\u30cd\u30ac\u30c6\u30a3\u30d6 \u30b5\u30f3\u30d7\u30eb \u30de\u30a4\u30cb\u30f3\u30b0: \u73fe\u5728\u306e\u30b3\u30fc\u30c9\u306f\u3001\u300c\u30aa\u30d6\u30b8\u30a7\u30af\u30c8\u304c\u3069\u3053\u306b\u3042\u308b\u304b\u300d\u30dd\u30b8\u30c6\u30a3\u30d6 \u30b5\u30f3\u30d7\u30eb\u306e\u307f\u3092\u751f\u6210\u3057\u307e\u3059\u3002\u30e2\u30c7\u30eb\u306e\u5805\u7262\u6027\u3092\u9ad8\u3081\u308b\u305f\u3081\u306b\u3001\u300c\u753b\u50cf\u306b\u8c61\u306f\u3042\u308a\u307e\u3059\u304b? -&gt; \u3044\u3044\u3048\u300d\u306e\u3088\u3046\u306a\u5426\u5b9a\u7684\u306a\u30b5\u30f3\u30d7\u30eb\u3092\u751f\u6210\u3059\u308b\u3088\u3046\u306b\u30b3\u30fc\u30c9\u3092\u62e1\u5f35\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part6/6_4_synthetic_textbook/","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c84: \u6570\u5b66/\u30b3\u30fc\u30c9\u6559\u79d1\u66f8\u5408\u6210","text":""},{"location":"ja/part6/6_4_synthetic_textbook/#4","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 4: \u7dcf\u5408\u6570\u5b66/\u30b3\u30fc\u30c9\u306e\u6559\u79d1\u66f8","text":"<p>\u30b7\u30ca\u30ea\u30aa: \u5c0f\u898f\u6a21\u30e2\u30c7\u30eb\u306e\u8ad6\u7406\u63a8\u8ad6\u80fd\u529b\u3092\u5f37\u5316\u3057\u307e\u3059\u3002</p> <p>\u30b3\u30a2 \u30c6\u30af\u30ce\u30ed\u30b8\u30fc: Evol-Instruct \u9032\u5316\u6226\u7565\u3001Python \u30b3\u30fc\u30c9\u5b9f\u884c\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9 (Sandbox) \u691c\u8a3c\u3001PoT (Program of Thought) \u30c7\u30fc\u30bf \u30d5\u30a9\u30fc\u30de\u30c3\u30c8\u3002</p> <p>\u51fa\u529b: \u691c\u8a3c\u5f8c\u306e\u9ad8\u54c1\u8cea\u306a\u5408\u6210\u63a8\u8ad6\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3002</p>"},{"location":"ja/part6/6_4_synthetic_textbook/#1","title":"1. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u80cc\u666f (\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6982\u8981)","text":"<ul> <li>\u30bf\u30b9\u30af\u5b9a\u7fa9: \u9ad8\u54c1\u8cea\u306e\u300c\u601d\u8003\u30d7\u30ed\u30b0\u30e9\u30e0\u300d(PoT) \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3092\u69cb\u7bc9\u3057\u307e\u3059\u3002 LLM (DeepSeek-V3) \u3092\u4f7f\u7528\u3057\u3066\u3001\u5358\u7d14\u306a\u6570\u5b66\u306e\u554f\u984c\u3092\u8907\u96d1\u306a\u6587\u7ae0\u554f\u984c\u306b\u300c\u9032\u5316\u300d\u3055\u305b\u3001\u5bfe\u5fdc\u3059\u308b Python \u30b3\u30fc\u30c9\u89e3\u3092\u751f\u6210\u3057\u3001\u30b3\u30fc\u30c9\u5b9f\u884c\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u3092\u901a\u3058\u3066\u89e3\u7b54\u306e\u6b63\u3057\u3055\u3092\u691c\u8a3c\u3057\u307e\u3059\u3002</li> <li>\u5165\u529b\u3068\u51fa\u529b:<ul> <li>\u5165\u529b: \u57fa\u672c\u6570\u5b66\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8 (GSM8K\u3001MBPP \u306a\u3069) \u751f\u306e JSONL \u30d5\u30a1\u30a4\u30eb\u3002</li> <li>\u51fa\u529b: <code>question</code> (\u767a\u5c55\u3057\u305f\u554f\u984c)\u3001<code>thought_process</code> (\u30b3\u30fc\u30c9\u89e3\u6c7a\u63a8\u8ad6)\u3001<code>execution_output</code> (\u5b9f\u884c\u7d50\u679c) \u3092\u542b\u3080\u3001\u30af\u30ea\u30fc\u30f3\u5316\u3055\u308c\u305f JSONL \u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u3002</li> </ul> </li> <li>\u8ab2\u984c\u306e\u5206\u6790: \u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6700\u5927\u306e\u56f0\u96e3\u306f \u300c\u5e7b\u899a\u306e\u9664\u53bb\u300d\u3067\u3059\u3002 LLM \u3067\u751f\u6210\u3055\u308c\u305f\u30b3\u30fc\u30c9\u306f\u3001\u6b63\u3057\u304f\u898b\u3048\u3066\u3082\u5b9f\u884c\u3067\u304d\u306a\u3044 (\u69cb\u6587\u30a8\u30e9\u30fc\u307e\u305f\u306f\u30ed\u30b8\u30c3\u30af \u30d0\u30b0) \u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u81ea\u52d5\u5316\u3055\u308c\u305f\u300c\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u300d\u3092\u69cb\u7bc9\u3057\u3066\u3001\u5b9f\u884c\u4e0d\u53ef\u80fd\u306a\u30b5\u30f3\u30d7\u30eb\u3092\u9664\u5916\u3057\u3001\u300c\u6559\u79d1\u66f8\u300d\u306e\u53b3\u5bc6\u3055\u3092\u78ba\u4fdd\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part6/6_4_synthetic_textbook/#2","title":"2. \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08 (\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08)","text":""},{"location":"ja/part6/6_4_synthetic_textbook/#_1","title":"\u30c7\u30fc\u30bf\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u56f3","text":""},{"location":"ja/part6/6_4_synthetic_textbook/#_2","title":"\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u30b9\u30bf\u30c3\u30af","text":"<ul> <li>\u30c7\u30fc\u30bf \u30bd\u30fc\u30b9: <code>HuggingFace Datasets</code> (GSM8K/MBPP)\u3002</li> <li>\u751f\u6210\u30a8\u30f3\u30b8\u30f3: <code>DeepSeek-V3</code> (SiliconFlow API \u7d4c\u7531) \u2014\u2014 \u30b3\u30b9\u30c8\u52b9\u7387\u306e\u9ad8\u3044\u30b3\u30fc\u30c9\u751f\u6210\u30e2\u30c7\u30eb\u3002</li> <li>\u30aa\u30fc\u30b1\u30b9\u30c8\u30ec\u30fc\u30b7\u30e7\u30f3 \u30ed\u30b8\u30c3\u30af: Python \u30b9\u30af\u30ea\u30d7\u30c8 (Evol-Instruct \u6226\u7565)\u3002</li> <li>\u691c\u8a3c\u74b0\u5883: Python <code>subprocess</code> (\u30ed\u30fc\u30ab\u30eb \u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9) \u2014\u2014 \u904b\u7528\u74b0\u5883\u3067\u306f Docker \u307e\u305f\u306f MicroVM \u3092\u63a8\u5968\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part6/6_4_synthetic_textbook/#3","title":"3. \u6bb5\u968e\u7684\u306a\u5b9f\u88c5","text":""},{"location":"ja/part6/6_4_synthetic_textbook/#1_1","title":"\u30d5\u30a7\u30fc\u30ba 1: \u30b7\u30fc\u30c9 \u30c7\u30fc\u30bf\u306e\u53d6\u5f97 (\u30b7\u30fc\u30c9\u306e\u6e96\u5099)","text":"<p>\u3059\u3079\u3066\u306f\u9ad8\u54c1\u8cea\u306e\u7a2e\u5b50\u304b\u3089\u59cb\u307e\u308a\u307e\u3059\u3002\u5927\u91cf\u306e\u30c7\u30fc\u30bf\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002\u4ee3\u8868\u7684\u306a\u30ed\u30b8\u30c3\u30af \u30b3\u30a2\u3060\u3051\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u4e3b\u306a\u30a2\u30af\u30b7\u30e7\u30f3: 1. GSM8K (\u6570\u5b66) \u304a\u3088\u3073 MBPP (\u30b3\u30fc\u30c9) \u30c7\u30fc\u30bf\u3092\u30c0\u30a6\u30f3\u30ed\u30fc\u30c9\u3057\u307e\u3059\u3002 2. \u300c\u9032\u5316\u300d\u57fa\u76e4\u3068\u3057\u3066\u306e\u30e9\u30f3\u30c0\u30e0\u30b5\u30f3\u30d7\u30eb\u3002</p> <p>\u30b0\u30eb\u30fc \u30b3\u30fc\u30c9 (\u30c7\u30fc\u30bf \u30b5\u30f3\u30d7\u30e9\u30fc): <code>download_data.py</code> \u304a\u3088\u3073 <code>sampler.py</code> \u306e\u30b3\u30fc\u30c9</p> <pre><code># Core logic: Extract seeds from massive data, keep only Question field\n# Original Answer discarded because we let model regenerate code-based solution\nsampled = random.sample(data, SAMPLE_SIZE)\nfor entry in sampled:\n    seed_entry = {\n        \"id\": random.randint(1000, 9999), \n        \"seed_question\": entry['question'], # Keep only question\n        \"original_answer\": entry['answer']  # For reference only\n    }\n</code></pre>"},{"location":"ja/part6/6_4_synthetic_textbook/#2-evol-instruct-pot","title":"\u30d5\u30a7\u30fc\u30ba 2: Evol-Instruct \u304a\u3088\u3073 PoT \u751f\u6210 (\u9032\u5316\u3068\u751f\u6210)","text":"<p>\u3053\u308c\u304c\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6838\u5fc3\u3067\u3059\u3002\u5358\u7d14\u306a\u300cQ&amp;A \u30da\u30a2\u300d\u3092\u884c\u3046\u3060\u3051\u3067\u306f\u4e0d\u5341\u5206\u3067\u3059\u3002\u4eba\u9593\u306e\u5c02\u9580\u5bb6\u306e\u3088\u3046\u306b\u8003\u3048\u308b\u30e2\u30c7\u30eb\u304c\u5fc5\u8981\u3067\u3059\u3002</p> <p>\u30d5\u30ed\u30fc\u30ed\u30b8\u30c3\u30af: 1. Evol (\u9032\u5316): \u5358\u7d14\u306a\u554f\u984c (\u4f8b: \u300c1+1=?\u300d) \u3092\u8907\u96d1\u306a\u30b7\u30ca\u30ea\u30aa (\u4f8b: \u300cXiaoming \u306b\u306f\u30ea\u30f3\u30b4\u304c 1 \u500b\u3042\u308a\u3001\u30a4\u30f3\u30d5\u30ec\u306e\u5f71\u97ff\u3092\u53d7\u3051\u3066\u3044\u307e\u3059...\u300d) \u306b\u66f8\u304d\u76f4\u3057\u3001\u5236\u7d04\u3092\u8ffd\u52a0\u3057\u307e\u3059\u3002 2. PoT (\u30b3\u30fc\u30c9 \u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3): \u30c6\u30ad\u30b9\u30c8\u306e\u56de\u7b54\u3092\u76f4\u63a5\u51fa\u529b\u3059\u308b\u306e\u3067\u306f\u306a\u304f\u3001\u30e2\u30c7\u30eb\u306b\u89e3\u6c7a\u3059\u308b Python \u30b3\u30fc\u30c9\u3092\u8a18\u8ff0\u3059\u308b\u3088\u3046\u306b\u5f37\u5236\u3057\u307e\u3059\u3002</p> <p>\u30b3\u30a2 \u30d7\u30ed\u30f3\u30d7\u30c8 (\u30d7\u30ed\u30f3\u30d7\u30c8 \u30a8\u30f3\u30b8\u30cb\u30a2\u30ea\u30f3\u30b0): <code>evol.py</code> \u306e\u30b3\u30fc\u30c9</p> <pre><code>def get_evol_prompt(seed_question):\n    return f\"\"\"\n    You are a professional math competition problem composer. Please rewrite the following basic math problem into a more complex, logically rigorous one.\n    \u3010Original\u3011: {seed_question}\n    \u3010Rewrite Requirements\u3011:\n    1. Add constraints: Introduce more variables or limitations.\n    2. Add reasoning depth: Don't give numbers directly; have logical relationships between numbers.\n    3. Scenario-ize: Put abstract numbers into concrete physical or business scenarios.\n    ...\n    \"\"\"\n\ndef get_pot_prompt(evolved_question):\n    return f\"\"\"\n    Please write Python code to solve the following math problem.\n    ...\n    1. Write a function named `solve()`.\n    2. Clearly write reasoning steps in code comments.\n    3. `solve()` must return the final numerical answer.\n    ...\n    \"\"\"\n</code></pre>"},{"location":"ja/part6/6_4_synthetic_textbook/#3_1","title":"\u30d5\u30a7\u30fc\u30ba 3: \u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u306e\u691c\u8a3c","text":"<p>\u751f\u6210\u3055\u308c\u305f\u30c7\u30fc\u30bf\u306b\u306f\u3001\u5927\u91cf\u306e\u300c\u7121\u52b9\u300d\u30b5\u30f3\u30d7\u30eb (\u69cb\u6587\u30a8\u30e9\u30fc\u3001\u30bf\u30a4\u30e0\u30a2\u30a6\u30c8\u3001\u30eb\u30fc\u30d7) \u304c\u542b\u307e\u308c\u3066\u3044\u307e\u3059\u3002\u5b9f\u884c\u3092\u901a\u3058\u3066\u691c\u8a3c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9 \u30ed\u30b8\u30c3\u30af: 1. \u6b63\u898f\u8868\u73fe\u3092\u4f7f\u7528\u3057\u3066\u3001Markdown \u304b\u3089\u30b3\u30fc\u30c9 \u30d6\u30ed\u30c3\u30af\u3092\u62bd\u51fa\u3057\u307e\u3059\u3002 2. \u30b5\u30d6\u30d7\u30ed\u30bb\u30b9 (<code>subprocess</code>) \u3092\u958b\u59cb\u3057\u3066\u30b3\u30fc\u30c9\u3092\u5b9f\u884c\u3057\u307e\u3059\u3002 3. \u91cd\u8981: <code>timeout</code> \u3092\u8a2d\u5b9a\u3057\u3066\u3001\u7121\u9650\u30eb\u30fc\u30d7\u306b\u3088\u308b\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u306e\u30d6\u30ed\u30c3\u30af\u3092\u9632\u304e\u307e\u3059\u3002</p> <p>\u691c\u8a3c\u30b9\u30af\u30ea\u30d7\u30c8: <code>sandbox.py</code> \u306e\u30b3\u30fc\u30c9</p> <pre><code>def execute_code(code, timeout=5):\n    \"\"\"\n    Execute Python code and get output.\n    WARNING: This function should only be called in strongly isolated sandbox (minimal privilege container/micro-VM, no network, restricted filesystem).\n    To prevent accidentally executing arbitrary code in host environment, will raise exception if sandbox not explicitly declared.\n    Can explicitly allow by setting environment variable EXECUTE_CODE_SANDBOXED=1 inside sandbox container.\n    \"\"\"\n    # Basic protection: Prohibit executing arbitrary code in undeclared sandbox\n    if os.environ.get(\"EXECUTE_CODE_SANDBOXED\") != \"1\":\n        raise RuntimeError(\n            \"execute_code can only be used in controlled sandbox environment; \"\n            \"please set environment variable EXECUTE_CODE_SANDBOXED=1 in isolated container/micro-VM before calling.\"\n        )\n    try:\n        # Use subprocess to start independent process\n        result = subprocess.run(\n            ['python3', '-c', code],\n            capture_output=True,  # Capture stdout\n            text=True,\n            timeout=timeout,      # Must set timeout!\n            check=False,\n        )\n        if result.returncode == 0:\n            return True, result.stdout.strip()\n        else:\n            return False, f\"Error: {result.stderr.strip()}\"\n</code></pre>"},{"location":"ja/part6/6_4_synthetic_textbook/#4_1","title":"4. \u7d50\u679c\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9 (\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9)","text":"<p>\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u306e\u30af\u30ea\u30fc\u30cb\u30f3\u30b0\u5f8c\u3001<code>verified_textbook.jsonl</code> \u304c\u5f97\u3089\u308c\u307e\u3059\u3002\u3053\u308c\u306f\u6559\u79d1\u66f8\u30ec\u30d9\u30eb\u306e\u5408\u6210\u30c7\u30fc\u30bf\u3067\u3059\u3002</p> <p>\u30c7\u30fc\u30bf\u30b5\u30f3\u30d7\u30eb\u306e\u6bd4\u8f03:</p> \u30d5\u30a7\u30fc\u30ba \u30b3\u30f3\u30c6\u30f3\u30c4\u4f8b \u30aa\u30ea\u30b8\u30ca\u30eb\u30b7\u30fc\u30c9 \u30b8\u30a7\u30cb\u30fc\u306f\u30ea\u30f3\u30b4\u3092 5 \u3064\u6301\u3063\u3066\u3044\u307e\u3059\u304c\u30012 \u3064\u98df\u3079\u307e\u3057\u305f\u3002\u3042\u3068\u4f55\u500b\u6b8b\u3063\u3066\u3044\u307e\u3059\u304b? \u9032\u5316\u306e\u9032\u5316 \u30b8\u30a7\u30cb\u30fc\u306f\u679c\u7269\u5c4b\u3092\u7d4c\u55b6\u3057\u3066\u304a\u308a\u3001\u30ea\u30f3\u30b4\u304c 5 \u7bb1 (1 \u7bb1\u3042\u305f\u308a 12 \u500b) \u5165\u3063\u3066\u3044\u307e\u3059\u3002\u6708\u66dc\u65e5\u3001\u5f7c\u5973\u306f\u5728\u5eab\u306e 40% \u3092\u58f2\u5374\u3057\u30012 \u3064\u306e\u5358\u54c1\u5546\u54c1\u304c\u4e0d\u9069\u5207\u306a\u4fdd\u7ba1\u306b\u3088\u308a\u7834\u640d\u3057\u3066\u3057\u307e\u3044\u307e\u3057\u305f\u3002\u6b8b\u308a\u306e\u8ca9\u200b\u200b\u58f2\u53ef\u80fd\u306a\u30ea\u30f3\u30b4\u306e\u6b63\u78ba\u306a\u6570\u3092\u8a08\u7b97\u3057\u3066\u304f\u3060\u3055\u3044\u3002 PoT \u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3 <code>def solve(): total = 5 * 12; sold = total * 0.4; ... return remaining</code> \u5b9f\u884c\u7d50\u679c <code>34</code> (\u691c\u8a3c\u6e08\u307f\u3001\u30c7\u30fc\u30bf\u30bb\u30c3\u30c8\u306b\u4fdd\u5b58) <p>\u691c\u8a3c\u7d71\u8a08: \u901a\u5e38\u3001Evol \u5f8c\u306e\u30b3\u30fc\u30c9\u306e\u30ef\u30f3\u30b7\u30e7\u30c3\u30c8\u5408\u683c\u7387 (Pass@1) \u306f 60% \uff5e 80% \u3067\u3059\u3002\u30b5\u30f3\u30c9\u30dc\u30c3\u30af\u30b9\u306b\u3088\u3063\u3066\u30d5\u30a3\u30eb\u30bf\u30ea\u30f3\u30b0\u3055\u308c\u305f 20% \u306e\u30a8\u30e9\u30fc \u30c7\u30fc\u30bf\u306f\u3001\u307e\u3055\u306b\u30e2\u30c7\u30eb \u30c8\u30ec\u30fc\u30cb\u30f3\u30b0\u3092\u6c5a\u67d3\u3059\u308b\u30c7\u30fc\u30bf\u3067\u3059\u3002\u3053\u308c\u3089\u3092\u524a\u9664\u3059\u308b\u3068\u3001SFT \u30e2\u30c7\u30eb\u306e\u30ed\u30b8\u30c3\u30af\u306e\u4e00\u8cab\u6027\u304c\u5927\u5e45\u306b\u5411\u4e0a\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part6/6_4_synthetic_textbook/#5","title":"5. \u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316 (\u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316)","text":"<ul> <li> <p>\u30ea\u30bd\u30fc\u30b9\u6d88\u8cbb\u91cf:</p> <ul> <li>API \u30b3\u30b9\u30c8: \u6709\u52b9\u306a\u30b5\u30f3\u30d7\u30eb\u3054\u3068\u306b\u3001\u6700\u5927 2 \u56de\u306e LLM \u547c\u3073\u51fa\u3057 (\u9032\u5316 + \u30bd\u30ea\u30e5\u30fc\u30b7\u30e7\u30f3) \u304c\u6d88\u8cbb\u3055\u308c\u307e\u3059\u3002 DeepSeek-V3 \u306e\u3088\u3046\u306a\u30b3\u30b9\u30c8\u52b9\u7387\u306e\u9ad8\u3044\u30e2\u30c7\u30eb\u3092\u4f7f\u7528\u3059\u308b\u3068\u30011,000 \u500b\u306e\u9ad8\u54c1\u8cea\u6559\u79d1\u66f8\u30b5\u30f3\u30d7\u30eb\u306e\u751f\u6210\u3092 5 \u30c9\u30eb\u672a\u6e80\u3067\u5236\u5fa1\u3067\u304d\u307e\u3059\u3002</li> <li>\u6642\u9593\u30b3\u30b9\u30c8: \u30ed\u30fc\u30ab\u30eb Python \u30b7\u30f3\u30b0\u30eb\u30b9\u30ec\u30c3\u30c9\u306f\u9045\u3044\u3067\u3059\u3002 1,000 \u500b\u306e\u30b3\u30fc\u30c9 \u30b5\u30f3\u30d7\u30eb\u306e\u691c\u8a3c\u306b\u306f\u7d04 5 \uff5e 10 \u5206\u304b\u304b\u308a\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u8b66\u544a (\u91cd\u5927):</p> <ul> <li>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306f\u30ed\u30fc\u30ab\u30eb\u5b9f\u884c\u306b <code>subprocess</code> \u3092\u4f7f\u7528\u3057\u307e\u3059\u3002\u672a\u77e5\u307e\u305f\u306f\u4fe1\u983c\u3067\u304d\u306a\u3044\u30e2\u30c7\u30eb\u751f\u6210\u30b3\u30fc\u30c9\u3092\u51e6\u7406\u3059\u308b\u5834\u5408\u3001\u975e\u5e38\u306b\u9ad8\u3044\u30ea\u30b9\u30af\u304c\u5b58\u5728\u3057\u307e\u3059 (\u4f8b: <code>os.system('rm -rf /')</code>)\u3002</li> <li>\u672c\u756a\u74b0\u5883\u306e\u5909\u9769\u8a08\u753b: \u30cd\u30c3\u30c8\u30ef\u30fc\u30af \u30a2\u30af\u30bb\u30b9\u3092\u7121\u52b9\u306b\u3057\u3066\u3001<code>sandbox.py</code> \u5b9f\u884c\u74b0\u5883\u3092 Docker \u30b3\u30f3\u30c6\u30ca \u307e\u305f\u306f AWS Firecracker \u30de\u30a4\u30af\u30ed VM \u306b\u79fb\u884c\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> </ul> </li> <li> <p>\u30b9\u30b1\u30fc\u30ea\u30f3\u30b0\u306b\u95a2\u3059\u308b\u8003\u616e\u4e8b\u9805:</p> <ul> <li>\u30c7\u30fc\u30bf\u304c\u6570\u767e\u4e07\u306b\u30b9\u30b1\u30fc\u30eb\u3059\u308b\u5834\u5408\u3001\u5358\u4e00\u30de\u30b7\u30f3\u306e\u30b9\u30af\u30ea\u30d7\u30c8\u3067\u306f\u30b5\u30dd\u30fc\u30c8\u3067\u304d\u307e\u305b\u3093\u3002\u30bf\u30b9\u30af\u5206\u6563\u306e\u305f\u3081\u306b <code>RabbitMQ</code> \u307e\u305f\u306f <code>Kafka</code> \u3092\u5c0e\u5165\u3057\u3001\u5206\u6563\u300c\u751f\u6210-\u691c\u8a3c\u300d\u30af\u30e9\u30b9\u30bf\u30fc\u3092\u69cb\u7bc9\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</li> </ul> </li> </ul>"},{"location":"ja/part6/6_5_mm_rag/","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c85: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30ebRAG\u4f01\u696d\u8ca1\u52d9\u30ec\u30dd\u30fc\u30c8\u30a2\u30b7\u30b9\u30bf\u30f3\u30c8","text":""},{"location":"ja/part6/6_5_mm_rag/#5-rag","title":"\u30d7\u30ed\u30b8\u30a7\u30af\u30c8 5: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb RAG \u30a8\u30f3\u30bf\u30fc\u30d7\u30e9\u30a4\u30ba\u8ca1\u52d9\u30ec\u30dd\u30fc\u30c8 \u30a2\u30b7\u30b9\u30bf\u30f3\u30c8","text":"<p>\u7bc4\u56f2: Capstone \u30d7\u30ed\u30b8\u30a7\u30af\u30c8 - \u8907\u96d1\u306a\u30c9\u30ad\u30e5\u30e1\u30f3\u30c8 (\u30c1\u30e3\u30fc\u30c8\u3001\u30c6\u30fc\u30d6\u30eb) \u691c\u7d22\u306e\u8ab2\u984c\u3092\u89e3\u6c7a\u3059\u308b</p>"},{"location":"ja/part6/6_5_mm_rag/#1","title":"1. \u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u80cc\u666f (\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6982\u8981)","text":"<ul> <li>\u30bf\u30b9\u30af\u5b9a\u7fa9: \u4f01\u696d\u306e\u5e74\u6b21\u5831\u544a\u66f8\u306e\u8907\u96d1\u306a\u30c1\u30e3\u30fc\u30c8\u3084\u30c7\u30fc\u30bf \u30c6\u30fc\u30d6\u30eb\u3092\u300c\u7406\u89e3\u300d\u3067\u304d\u308b RAG \u30b7\u30b9\u30c6\u30e0\u3092\u69cb\u7bc9\u3057\u3001\u30d3\u30b8\u30e5\u30a2\u30eb\u691c\u7d22 (Visual Retrieval) \u3068\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb LLM (VLM) \u3092\u901a\u3058\u3066\u8ca1\u52d9\u5831\u544a\u66f8\u306b\u95a2\u3059\u308b\u8a73\u7d30\u306a Q&amp;A \u3092\u5b9f\u73fe\u3057\u307e\u3059\u3002</li> <li>\u5165\u529b\u3068\u51fa\u529b:</li> <li>\u5165\u529b: PDF \u5f62\u5f0f\u306e\u4f01\u696d\u5e74\u6b21\u8ca1\u52d9\u5831\u544a\u66f8 (\u6df7\u5408\u30ec\u30a4\u30a2\u30a6\u30c8\u306e\u30c6\u30ad\u30b9\u30c8\u3001\u30af\u30ed\u30b9\u30da\u30fc\u30b8\u8868\u3001\u50be\u5411\u6298\u308c\u7dda\u30b0\u30e9\u30d5\u3001\u5186\u30b0\u30e9\u30d5\u306a\u3069\u3092\u542b\u3080)\u3002</li> <li>\u51fa\u529b: \u30c1\u30e3\u30fc\u30c8 \u30c7\u30fc\u30bf\u306e\u50be\u5411\u3068\u7279\u5b9a\u306e\u5024\u306b\u57fa\u3065\u3044\u305f\u81ea\u7136\u8a00\u8a9e\u5206\u6790\u306e\u56de\u7b54\u3002</li> <li>\u8ab2\u984c\u5206\u6790: </li> <li>\u69cb\u9020\u306e\u640d\u5931: \u5f93\u6765\u306e RAG \u306f\u30c6\u30ad\u30b9\u30c8\u306b\u5bfe\u3057\u3066 OCR \u3092\u4f7f\u7528\u3059\u308b\u305f\u3081\u3001\u30c6\u30fc\u30d6\u30eb\u306e\u884c\u3068\u5217\u306e\u5bfe\u5fdc\u304c\u7c21\u5358\u306b\u5931\u308f\u308c\u3001\u30c6\u30ad\u30b9\u30c8 \u30ad\u30e3\u30d7\u30b7\u30e7\u30f3\u306e\u306a\u3044\u50be\u5411\u30b0\u30e9\u30d5\u3092\u307e\u3063\u305f\u304f\u51e6\u7406\u3067\u304d\u307e\u305b\u3093\u3002</li> <li>\u30bb\u30de\u30f3\u30c6\u30a3\u30c3\u30af\u306a\u65ad\u7247\u5316: \u30ec\u30dd\u30fc\u30c8\u306b\u306f\u300c\u4e0b\u306e\u56f3\u3092\u53c2\u7167\u300d\u3068\u3044\u3046\u53c2\u7167\u304c\u542b\u307e\u308c\u308b\u3053\u3068\u304c\u3088\u304f\u3042\u308a\u307e\u3059\u3002\u30c6\u30ad\u30b9\u30c8\u3068\u30b0\u30e9\u30d5\u304c\u5206\u96e2\u3055\u308c\u3066\u3044\u308b\u3068\u3001\u691c\u7d22\u306e\u5207\u308a\u6368\u3066\u304c\u767a\u751f\u3057\u307e\u3059\u3002</li> <li>\u691c\u7d22\u30ce\u30a4\u30ba: \u76ee\u6b21\u30da\u30fc\u30b8\u306b\u306f\u30ad\u30fc\u30ef\u30fc\u30c9\u304c\u542b\u307e\u308c\u308b\u3053\u3068\u304c\u591a\u304f\u3001\u8aa4\u3063\u305f\u60f3\u8d77\u3092\u5f15\u304d\u8d77\u3053\u3057\u3084\u3059\u304f\u3001\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8 \u30a6\u30a3\u30f3\u30c9\u30a6\u304c\u6df7\u96d1\u3057\u307e\u3059\u3002</li> </ul>"},{"location":"ja/part6/6_5_mm_rag/#2","title":"2. \u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08 (\u30a2\u30fc\u30ad\u30c6\u30af\u30c1\u30e3\u8a2d\u8a08)","text":"<p>\u3053\u306e\u30d7\u30ed\u30b8\u30a7\u30af\u30c8\u306e\u6838\u3068\u306a\u308b\u30b3\u30f3\u30bb\u30d7\u30c8\u306f \u300cViR (Vision in Retrieval) + VLM (Vision Language Model)\u300d\u3067\u3059\u3002 PDF \u3092\u5f37\u5236\u7684\u306b\u30c6\u30ad\u30b9\u30c8\u5316\u3059\u308b\u3053\u3068\u306f\u3082\u3046\u3042\u308a\u307e\u305b\u3093\u3002\u4ee3\u308f\u308a\u306b ColPali \u3092\u4f7f\u7528\u3057\u3066\u3001\u5404 PDF \u30da\u30fc\u30b8\u3092\u8996\u899a\u7684\u30a8\u30f3\u30b3\u30fc\u30c9\u7528\u306e\u753b\u50cf\u3068\u3057\u3066\u6271\u3044\u3001\u8996\u899a\u7684\u7279\u5fb4\u3092\u76f4\u63a5\u53d6\u5f97\u3057\u3001\u53d6\u5f97\u3057\u305f\u753b\u50cf\u3092\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb LLM \u306b\u4f9b\u7d66\u3057\u3066\u89e3\u91c8\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part6/6_5_mm_rag/#_1","title":"\u30c7\u30fc\u30bf\u30d1\u30a4\u30d7\u30e9\u30a4\u30f3\u56f3","text":""},{"location":"ja/part6/6_5_mm_rag/#_2","title":"\u30c6\u30af\u30ce\u30ed\u30b8\u30fc\u30b9\u30bf\u30c3\u30af","text":"\u30b3\u30f3\u30dd\u30fc\u30cd\u30f3\u30c8 \u30c4\u30fc\u30eb/\u30e2\u30c7\u30eb \u9078\u629e\u7406\u7531 \u8996\u899a\u691c\u7d22\u30e2\u30c7\u30eb ColPali (v1.2) \u73fe\u5728\u306e SOTA \u30c9\u30ad\u30e5\u30e1\u30f3\u30c8\u691c\u7d22\u30e2\u30c7\u30eb\u3002 PaliGemma \u306b\u57fa\u3065\u304f\u3002\u30da\u30fc\u30b8 \u30ec\u30a4\u30a2\u30a6\u30c8\u3001\u30d5\u30a9\u30f3\u30c8 \u30b5\u30a4\u30ba\u3001\u30b0\u30e9\u30d5\u306e\u8996\u899a\u7684\u7279\u5fb4\u3092\u7406\u89e3\u3057\u307e\u3059\u3002 OCR\u306f\u5fc5\u8981\u3042\u308a\u307e\u305b\u3093\u3002 \u30a4\u30f3\u30c7\u30c3\u30af\u30b9 \u30d5\u30ec\u30fc\u30e0\u30ef\u30fc\u30af \u30d3\u30e4\u30eb\u30c7\u30a3 ColPali \u8efd\u91cf\u30e9\u30c3\u30d1\u30fc\u3002\u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30e2\u30c7\u30eb \u30c6\u30f3\u30bd\u30eb\u306e\u4fdd\u5b58\u3068\u53d6\u5f97\u30d5\u30ed\u30fc\u3092\u7c21\u7d20\u5316\u3057\u307e\u3059\u3002 \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb LLM Qwen2.5-VL-72B Alibaba Tongyi Qianwen \u6700\u65b0\u30d3\u30b8\u30e7\u30f3\u30e2\u30c7\u30eb;\u30c1\u30e3\u30fc\u30c8\u306e\u7406\u89e3 (ChartQA) \u3068\u6587\u66f8\u306e\u89e3\u6790 (DocVQA) \u306b\u512a\u308c\u3066\u3044\u307e\u3059\u3002"},{"location":"ja/part6/6_5_mm_rag/#3","title":"3. \u6bb5\u968e\u7684\u306a\u5b9f\u88c5","text":""},{"location":"ja/part6/6_5_mm_rag/#1_1","title":"\u30d5\u30a7\u30fc\u30ba 1: \u30d3\u30b8\u30e5\u30a2\u30eb \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u306e\u69cb\u7bc9 (\u30d3\u30b8\u30e5\u30a2\u30eb \u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210)","text":"<p>\u5f93\u6765\u306e RAG \u306e <code>Chunking -&gt; Embedding</code> \u3068\u306f\u7570\u306a\u308a\u3001\u3053\u3053\u3067\u306f <code>Page -&gt; Screenshot -&gt; Visual Embedding</code> \u3092\u5b9f\u884c\u3057\u307e\u3059\u3002</p> <p>\u30ad\u30fc \u30b3\u30fc\u30c9 \u30ed\u30b8\u30c3\u30af (<code>index.py</code>):</p> <pre><code>from byaldi import RAGMultiModalModel\n\n# 1. Load local ColPali model (solves HuggingFace connection issues)\nMODEL_PATH = \"/path/to/models/colpali-v1.2-merged\"\nINDEX_NAME = \"finance_report_2024\"\n\ndef build_index():\n    # 2. Initialize model (supports load_in_4bit for memory reduction)\n    RAG = RAGMultiModalModel.from_pretrained(MODEL_PATH, verbose=1)\n\n    # 3. Build index\n    # Principle: Byaldi converts PDF to images, computes visual vectors and stores\n    RAG.index(\n        input_path=\"annual_report_2024.pdf\",\n        index_name=INDEX_NAME,\n        store_collection_with_index=True, # Must store original image references\n        overwrite=True\n    )\n</code></pre> <p>\u5b9f\u8df5\u4e0a\u306e\u6ce8\u610f\u4e8b\u9805: * \u30c7\u30d0\u30c3\u30b0: \u6700\u521d\u306e\u5b9f\u884c\u3067 OOM (\u30e1\u30e2\u30ea\u4e0d\u8db3) \u304c\u767a\u751f\u3057\u307e\u3057\u305f\u3002 * \u89e3\u6c7a\u7b56: ColPali \u30d5\u30eb\u30d0\u30fc\u30b8\u30e7\u30f3\u306b\u306f\u6700\u5927 10GB \u4ee5\u4e0a\u306e\u30e1\u30e2\u30ea\u304c\u5fc5\u8981\u3067\u3059\u3002\u4e0d\u8db3\u3059\u308b\u5834\u5408\u306f\u3001<code>load_in_4bit=True</code> \u3092 <code>from_pretrained</code> \u306b\u8ffd\u52a0\u3057\u307e\u3059\u3002</p>"},{"location":"ja/part6/6_5_mm_rag/#2_1","title":"\u30d5\u30a7\u30fc\u30ba 2: \u8907\u6570\u30da\u30fc\u30b8\u306e\u8996\u899a\u7684\u691c\u7d22 (\u8907\u6570\u30da\u30fc\u30b8\u306e\u691c\u7d22)","text":"<p>\u8ca1\u52d9\u30ec\u30dd\u30fc\u30c8 Q&amp;A \u306e\u5178\u578b\u7684\u306a\u843d\u3068\u3057\u7a74: \u30ad\u30fc\u30ef\u30fc\u30c9\u300c\u55b6\u696d\u6210\u7e3e\u300d\u306f\u76ee\u6b21\u306b\u3082\u8868\u793a\u3055\u308c\u307e\u3059\u3002 \u30c8\u30c3\u30d7 1 \u306e\u307f\u3092\u53d6\u5f97\u3059\u308b\u5834\u5408\u3001\u76ee\u6b21\u306e\u307f\u304c\u53d6\u5f97\u3055\u308c\u308b\u53ef\u80fd\u6027\u304c\u3042\u308a\u3001\u30e2\u30c7\u30eb\u304c\u5fdc\u7b54\u3067\u304d\u306a\u3044\u53ef\u80fd\u6027\u304c\u3042\u308a\u307e\u3059\u3002\u3057\u305f\u304c\u3063\u3066\u3001\u6226\u7565\u3067\u306f\u3001Top-K (3 \uff5e 5 \u30da\u30fc\u30b8\u3092\u63a8\u5968) \u3092\u53d6\u5f97\u3057\u3066\u30d5\u30a3\u30eb\u30bf\u30fc\u3059\u308b\u5fc5\u8981\u304c\u3042\u308a\u307e\u3059\u3002</p> <p>\u30ad\u30fc \u30b3\u30fc\u30c9 \u30ed\u30b8\u30c3\u30af (<code>rag_chat.py</code> - \u53d6\u5f97\u90e8\u5206):</p> <pre><code># Load index\nRAG = RAGMultiModalModel.from_index(INDEX_NAME)\n\n# Increase retrieval pages to prevent only hitting table of contents\nRETRIEVAL_K = 4 \n\nresults = RAG.search(user_query, k=RETRIEVAL_K)\n\n# Results contain: page_num (page number), base64 (image data), score (relevance)\n</code></pre>"},{"location":"ja/part6/6_5_mm_rag/#3_1","title":"\u30d5\u30a7\u30fc\u30ba 3: \u30de\u30eb\u30c1\u30a4\u30e1\u30fc\u30b8 \u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u306e\u751f\u6210 (\u30de\u30eb\u30c1\u30a4\u30e1\u30fc\u30b8\u306e\u751f\u6210)","text":"<p>\u53d6\u5f97\u3057\u305f K \u500b\u306e\u753b\u50cf\u3059\u3079\u3066\u3092\u30b3\u30f3\u30c6\u30ad\u30b9\u30c8\u3068\u3057\u3066 VLM \u306b\u4f9b\u7d66\u3057\u3001\u30e2\u30c7\u30eb\u306e\u30ed\u30f3\u30b0 \u30a6\u30a3\u30f3\u30c9\u30a6\u3068\u30de\u30eb\u30c1\u753b\u50cf\u6a5f\u80fd\u3092\u6d3b\u7528\u3057\u3066\u5305\u62ec\u7684\u306a\u5206\u6790\u3092\u884c\u3044\u307e\u3059\u3002</p> <p>\u30ad\u30fc \u30b3\u30fc\u30c9 \u30ed\u30b8\u30c3\u30af (<code>rag_chat.py</code> - \u751f\u6210\u90e8\u5206):</p> <pre><code># Build multimodal payload\ncontent_payload = []\n\n# 1. System Prompt: Define role and anti-interference instructions\ncontent_payload.append({\n    \"type\": \"text\", \n    \"text\": f\"You are a professional CFO assistant... may contain table of contents, please ignore table of contents, directly answer based on pages with specific data...\"\n})\n\n# 2. Inject multiple images\nfor res in results:\n    content_payload.append({\n        \"type\": \"image_url\",\n        \"image_url\": {\n            \"url\": f\"data:image/jpeg;base64,{res.base64}\", \n            \"detail\": \"high\" # Enable high-res mode for small text recognition\n        }\n    })\n\n# 3. Send to Qwen2.5-VL-72B\nresponse = client.chat.completions.create(\n    model=\"Qwen/Qwen2.5-VL-72B-Instruct\",\n    messages=[{\"role\": \"user\", \"content\": content_payload}],\n    temperature=0.1 # Maintain factuality\n)\n</code></pre>"},{"location":"ja/part6/6_5_mm_rag/#4","title":"4. \u7d50\u679c\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9 (\u30b7\u30e7\u30fc\u30b1\u30fc\u30b9)","text":"<p>\u4ee5\u4e0b\u306f\u3001Huawei 2024 \u8ca1\u52d9\u5831\u544a\u66f8\u306b\u304a\u3051\u308b\u30b7\u30b9\u30c6\u30e0\u306e\u5b9f\u969b\u306e\u5b9f\u884c\u8a18\u9332\u3067\u3059\u3002\u76ee\u6b21\u3092\u7701\u7565\u3057\u300149\u30da\u30fc\u30b8\u300191\u30da\u30fc\u30b8\u3001130\u30da\u30fc\u30b8\u30018\u30da\u30fc\u30b8\u306e\u60c5\u5831\u3092\u7d71\u5408\u3057\u3001\u7814\u7a76\u958b\u767a\u6295\u8cc7\u3084\u7121\u5f62\u8cc7\u7523\u306e\u5909\u52d5\u3092\u5b9a\u91cf\u7684\u306b\u5206\u6790\u3059\u308b\u3053\u3068\u306b\u6210\u529f\u3057\u307e\u3057\u305f\u3002</p> <pre><code>&gt;&gt;&gt; Please ask: How are the operating results?\n\n\ud83d\udd0d Retrieving Top-4 relevant pages...\n\ud83d\udcc4 Hit pages: [49] [91] [130] [8]\n\ud83d\ude80 Sending to LLM for comprehensive analysis...\n\n\ud83e\udd16 Financial Report Assistant Answer:\n----------------------------------------\nBased on the provided financial report screenshots, operating results can be analyzed from the following aspects:\n\n### 1. **R&amp;D and Innovation Investment**\n- **R&amp;D Expenses**: In 2024, R&amp;D expenses were RMB 179.7 billion, accounting for 20.8% of annual revenue. Cumulative R&amp;D investment over the past decade exceeded RMB 1,249 billion. This indicates continued substantial investment in R&amp;D and innovation,committed to technology breakthrough and product upgrade.\n- **R&amp;D Personnel**: As of December 31, 2024, R&amp;D employees numbered approximately 113,000, accounting for 54.1% of total employees, showing company emphasis on R&amp;D team and sustained innovation investment.\n\n### 2. **Intangible Assets**\n- **Goodwill and Intangible Assets**: Screenshots show detailed data on goodwill, software, patents and royalties, trademark rights, and other intangible assets. From 2023 to 2024, goodwill increased from 4,424 to 4,496 million yuan... (abbreviated) ...indicating continued growth in intangible assets.\n\n### 3. **Corporate Social Responsibility and Sustainable Development**\n- **Tech Classroom Project**: Huawei officially launched \"Tech Classroom\" project... (abbreviated)\n- **Mobile Digital Classroom Project**: Huawei partnered in Kenya for DigiTruck project...\n\n### 4. **Chairman's Message**\n- **Strategic Focus and Continued Innovation**: Chairman noted in message that 2024 was a challenging year; Huawei employees remained confident and proactive, achieving business development goals with overall operations meeting expectations...\n\nIn summary, Huawei's 2024 operating results were outstanding, with significant achievements in R&amp;D and innovation, intangible assets, corporate social responsibility and sustainable development.\n----------------------------------------\n</code></pre>"},{"location":"ja/part6/6_5_mm_rag/#5","title":"5. \u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316 (\u30b3\u30b9\u30c8\u3068\u6700\u9069\u5316)","text":"<ul> <li>\u30ea\u30bd\u30fc\u30b9\u6d88\u8cbb\u91cf:</li> <li>\u30a4\u30f3\u30c7\u30c3\u30af\u30b9 \u30b3\u30b9\u30c8: ColPali \u306e\u51e6\u7406\u304c\u9045\u3044 (~0.5 \u79d2/\u30da\u30fc\u30b8)\u3002 200 \u30da\u30fc\u30b8\u306e\u30ec\u30dd\u30fc\u30c8\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u306b\u306f 2 \uff5e 3 \u5206\u304b\u304b\u308a\u307e\u3059\u3002</li> <li> <p>\u63a8\u8ad6\u30b3\u30b9\u30c8: \u30de\u30eb\u30c1\u30e2\u30fc\u30c0\u30eb \u30c8\u30fc\u30af\u30f3\u306e\u6d88\u8cbb\u91cf\u306f\u81a8\u5927\u3067\u3059\u3002 1 \u3064\u306e 1024x1024 \u753b\u50cf \u2248 1000 \uff5e 1500 \u30c8\u30fc\u30af\u30f3\u3002\u5404\u30c8\u30c3\u30d7 4 \u306e\u53d6\u5f97\u306f\u3001\u5c11\u306a\u304f\u3068\u3082 5000 \u4ee5\u4e0a\u306e\u5165\u529b\u30c8\u30fc\u30af\u30f3\u3092\u610f\u5473\u3057\u307e\u3059\u3002 Qwen2.5-VL-72B \u306e SiliconFlow API \u3092\u4f7f\u7528\u3059\u308b\u3068\u30011 \u56de\u306e Q&amp;A \u30b3\u30b9\u30c8\u306f\u7d04 0.05 \uff5e 0.1 RMB \u3067\u3059\u3002</p> </li> <li> <p>\u6700\u9069\u5316\u306e\u30a2\u30a4\u30c7\u30a2:</p> </li> <li>\u7cbe\u5ea6\u306e\u6700\u9069\u5316: \u8d85\u9ad8\u89e3\u50cf\u5ea6\u306e\u8ca1\u52d9\u8868\u306e\u5834\u5408\u3001\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u4f5c\u6210\u524d\u306b PDF \u30da\u30fc\u30b8\u3092\u300c\u30c8\u30ea\u30df\u30f3\u30b0\u300d\u3067\u304d\u307e\u3059\u30021 \u3064\u306e\u5927\u304d\u306a\u753b\u50cf\u3092 4 \u3064\u306e\u5c0f\u3055\u306a\u753b\u50cf\u306b\u5206\u5272\u3057\u3066\u500b\u5225\u306e\u30a4\u30f3\u30c7\u30c3\u30af\u30b9\u3092\u4f5c\u6210\u3057\u3001\u30ed\u30fc\u30ab\u30eb\u691c\u7d22\u306e\u660e\u77ad\u3055\u3092\u5411\u4e0a\u3055\u305b\u307e\u3059\u3002</li> <li>\u753b\u50cf\u306e\u30c8\u30ea\u30df\u30f3\u30b0: ColPali \u306f\u95a2\u9023\u9818\u57df\u3092\u898b\u3064\u3051\u308b\u3053\u3068\u304c\u3067\u304d\u307e\u3059 (\u30d1\u30c3\u30c1\u30ec\u30d9\u30eb\u306e\u53d6\u5f97)\u3002 future \u3067\u306f\u3001\u30da\u30fc\u30b8\u304b\u3089\u30d5\u30a3\u30fc\u30c9 LLM \u307e\u3067\u95a2\u9023\u3059\u308b\u300c\u30c1\u30e3\u30fc\u30c8\u9818\u57df\u300d\u306e\u307f\u3092\u30c8\u30ea\u30df\u30f3\u30b0\u3067\u304d\u308b\u305f\u3081\u3001\u30c8\u30fc\u30af\u30f3\u306e\u6d88\u8cbb\u304c\u5927\u5e45\u306b\u524a\u6e1b\u3055\u308c\u307e\u3059\u3002</li> <li>\u30ad\u30e3\u30c3\u30b7\u30e5 \u30e1\u30ab\u30cb\u30ba\u30e0: \u300c\u53ce\u76ca\u984d\u300d\u3084\u300c\u7d14\u5229\u76ca\u984d\u300d\u306a\u3069\u306e\u56fa\u5b9a\u306e\u9ad8\u983b\u5ea6\u8cea\u554f\u306b\u3064\u3044\u3066\u306f\u3001\u8996\u899a\u7684\u306a\u63a8\u8ad6\u306e\u7e70\u308a\u8fd4\u3057\u3092\u907f\u3051\u308b\u305f\u3081\u306b VLM \u89e3\u6790\u7d50\u679c\u3092\u30ad\u30e3\u30c3\u30b7\u30e5\u3057\u307e\u3059\u3002</li> </ul>"}]}